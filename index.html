
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="å¾®ä¿¡çº¢åŒ… åˆ«å‘Šè¯‰æˆ‘ä½ å¯¹çº¢åŒ…ä¸æ„Ÿå…´è¶£ï¼Œå¦‚æœçœŸçš„æ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆè¯·ç»•é“ï¼Œå“ˆå“ˆã€‚ ç°åœ¨ç”±äºå¾®ä¿¡å’ŒQQçš„æ™®åŠï¼Œå‡ ä¹æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä½¿ç”¨çº¢åŒ…è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ï¼Œæ¯çœ‹åˆ°ä¸€ä¸ªå¥½çš„åŠŸèƒ½éƒ½ä¼šåŠªåŠ›è¯•ç€ç ”ç©¶ä¸€ä¸‹ï¼Œå“ªæ€•ä¸èƒ½æˆåŠŸï¼Œç”±äºçœ‹åˆ°äº†ä¸€ç¯‡æ¯”è¾ƒçœ‹çš„æ–‡ç« ï¼Œæ‰€ä»¥å°±ä¸“é—¨èŠ±æ—¶é—´å»æä¸€é¡¿ï¼Œç»“æœå¤§åƒä¸€æƒŠã€‚ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>iCocosâ€”â€”ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">åšæ–‡</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/about">æ–‡ç« </a></li>
  <li><a href="/other">å…¶ä»–</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/01/weixinhongbao/">ç¦åˆ©ï¼šæŠ¢çº¢åŒ…ç¥å™¨å°±æ˜¯è¿™ä¹ˆæ¥çš„</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-01T21:52:15+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>9:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>å¾®ä¿¡çº¢åŒ…</p>

<p><img src="/images/weixinhongbao0001.jpg" title="Caption" ></p>

<p>åˆ«å‘Šè¯‰æˆ‘ä½ å¯¹çº¢åŒ…ä¸æ„Ÿå…´è¶£ï¼Œå¦‚æœçœŸçš„æ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆè¯·ç»•é“ï¼Œå“ˆå“ˆã€‚</p>

<p>ç°åœ¨ç”±äºå¾®ä¿¡å’ŒQQçš„æ™®åŠï¼Œå‡ ä¹æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä½¿ç”¨çº¢åŒ…è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ï¼Œæ¯çœ‹åˆ°ä¸€ä¸ªå¥½çš„åŠŸèƒ½éƒ½ä¼šåŠªåŠ›è¯•ç€ç ”ç©¶ä¸€ä¸‹ï¼Œå“ªæ€•ä¸èƒ½æˆåŠŸï¼Œç”±äºçœ‹åˆ°äº†ä¸€ç¯‡æ¯”è¾ƒçœ‹çš„æ–‡ç« ï¼Œæ‰€ä»¥å°±ä¸“é—¨èŠ±æ—¶é—´å»æä¸€é¡¿ï¼Œç»“æœå¤§åƒä¸€æƒŠã€‚</p>

<p>æœ€è¿‘æœ‰ä¸å°‘æœ‹å‹æ‰¾æˆ‘è¦çº¢åŒ…å°¾æ•°çš„åŠŸèƒ½ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä»–ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¸ªï¼Œå¯èƒ½æ˜¯ç¬”è€…å¤ªå¹´è½»äº†ã€‚ä½†æ˜¯æˆ‘è§‰å¾—è¿™ä¸ªå¯èƒ½ä¸ç®€å•ï¼Œè€Œä¸”è¿™æ ·çš„åŠŸèƒ½åšå¥½äº†ä¹Ÿä¸èƒ½å¤–æ¼ï¼Œä¸ç„¶ç¬”è€…çš„ç¨‹åºå‘˜èŒä¸šç”Ÿæ¶¯ä¼°è®¡å°±åˆ°å¤´äº†ï¼</p>

<pre><code>å‰è¨€ï¼šæœ€è¿‘ç¬”è€…åœ¨ç ”ç©¶iOSé€†å‘å·¥ç¨‹ï¼Œé¡ºä¾¿æ‹¿å¾®ä¿¡æ¥ç»ƒæ‰‹ï¼Œåœ¨éè¶Šç‹±æ‰‹æœºä¸Šå®ç°äº†å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…çš„åŠŸèƒ½ã€‚
</code></pre>

<p>é¢˜å¤–è¯ï¼šæ­¤æ•™ç¨‹æ˜¯ä¸€ç¯‡ä¸¥è‚ƒçš„å­¦æœ¯æ¢è®¨ç±»æ–‡ç« ï¼Œä»…ä»…ç”¨äºå­¦ä¹ ç ”ç©¶ï¼Œä¹Ÿè¯·è¯»è€…ä¸è¦ç”¨äºå•†ä¸šæˆ–å…¶ä»–éæ³•é€”å¾„ä¸Šï¼Œç¬”è€…ä¸€æ¦‚ä¸è´Ÿè´£å“Ÿ~~</p>

<p>å¥½äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥è¿›å…¥æ­£é¢˜äº†ï¼</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2016/09/01/weixinhongbao/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/26/chongzhengzhidao/">é‡æ•´ä¹‹é“ï¼ˆé¢è¯•+æŠ€æœ¯+åº•å±‚+é«˜çº§ï¼‰</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-26T13:53:19+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:53 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"></div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2016/08/26/chongzhengzhidao/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/10/duoxianc/">å¤šçº¿ç¨‹ä¹‹è‘µèŠ±å®å…¸</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-10T14:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:59 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>ä¸€ã€è¿›ç¨‹å’Œçº¿ç¨‹</h2>

<h4>1.ä»€ä¹ˆæ˜¯è¿›ç¨‹</h4>

<pre><code>è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åº

æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†…





æ¯”å¦‚åŒæ—¶æ‰“å¼€QQã€Xcodeï¼Œç³»ç»Ÿå°±ä¼šåˆ†åˆ«å¯åŠ¨2ä¸ªè¿›ç¨‹

é€šè¿‡â€œæ´»åŠ¨ç›‘è§†å™¨â€å¯ä»¥æŸ¥çœ‹Macç³»ç»Ÿä¸­æ‰€å¼€å¯çš„è¿›ç¨‹
</code></pre>

<h4>2.ä»€ä¹ˆæ˜¯çº¿ç¨‹</h4>

<pre><code>1ä¸ªè¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹ï¼ˆæ¯1ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰1æ¡çº¿ç¨‹ï¼‰

çº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ

æ¯”å¦‚ä½¿ç”¨é…·ç‹—æ’­æ”¾éŸ³ä¹ã€ä½¿ç”¨è¿…é›·ä¸‹è½½ç”µå½±ï¼Œéƒ½éœ€è¦åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ
</code></pre>

<p> ã€€ã€€</p>

<h4>3.çº¿ç¨‹çš„ä¸²è¡Œ</h4>

<pre><code>1ä¸ªçº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„

å¦‚æœè¦åœ¨1ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆåªèƒ½ä¸€ä¸ªä¸€ä¸ªåœ°æŒ‰é¡ºåºæ‰§è¡Œè¿™äº›ä»»åŠ¡

ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒä¸€æ—¶é—´å†…ï¼Œ1ä¸ªçº¿ç¨‹åªèƒ½æ‰§è¡Œ1ä¸ªä»»åŠ¡

æ¯”å¦‚åœ¨1ä¸ªçº¿ç¨‹ä¸­ä¸‹è½½3ä¸ªæ–‡ä»¶ï¼ˆåˆ†åˆ«æ˜¯æ–‡ä»¶Aã€æ–‡ä»¶Bã€æ–‡ä»¶Cï¼‰
</code></pre>

<h2>äºŒã€å¤šçº¿ç¨‹</h2>

<h4>1.ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹</h4>

<pre><code>1ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¯ä»¥å¹¶è¡Œï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œä¸åŒçš„ä»»åŠ¡

è¿›ç¨‹ -&gt;è½¦é—´ï¼Œçº¿ç¨‹-&gt;è½¦é—´å·¥äºº

å¤šçº¿ç¨‹æŠ€æœ¯å¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡

æ¯”å¦‚åŒæ—¶å¼€å¯3æ¡çº¿ç¨‹åˆ†åˆ«ä¸‹è½½3ä¸ªæ–‡ä»¶ï¼ˆåˆ†åˆ«æ˜¯æ–‡ä»¶Aã€æ–‡ä»¶Bã€æ–‡ä»¶Cï¼‰
</code></pre>

<h4>2.å¤šçº¿ç¨‹çš„åŸç†</h4>

<pre><code>åŒä¸€æ—¶é—´ï¼ŒCPUåªèƒ½å¤„ç†1æ¡çº¿ç¨‹ï¼Œåªæœ‰1æ¡çº¿ç¨‹åœ¨å·¥ä½œï¼ˆæ‰§è¡Œï¼‰
å¤šçº¿ç¨‹å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼Œå…¶å®æ˜¯CPUå¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰
å¦‚æœCPUè°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«ï¼Œå°±é€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡
æ€è€ƒï¼šå¦‚æœçº¿ç¨‹éå¸¸éå¸¸å¤šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ
CPUä¼šåœ¨Nå¤šçº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ŒCPUä¼šç´¯æ­»ï¼Œæ¶ˆè€—å¤§é‡çš„CPUèµ„æº
æ¯æ¡çº¿ç¨‹è¢«è°ƒåº¦æ‰§è¡Œçš„é¢‘æ¬¡ä¼šé™ä½ï¼ˆçº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡é™ä½ï¼‰
</code></pre>

<h4>3.å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹</h4>

<p>å¤šçº¿ç¨‹çš„ä¼˜ç‚¹</p>

<pre><code>èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡

èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜åˆ©ç”¨ç‡ï¼‰
</code></pre>

<p>å¤šçº¿ç¨‹çš„ç¼ºç‚¹</p>

<pre><code>å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å ç”¨1Mï¼Œå­çº¿ç¨‹å ç”¨512KBï¼‰ï¼Œå¦‚æœå¼€å¯å¤§é‡çš„çº¿ç¨‹ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ï¼Œé™ä½ç¨‹åºçš„æ€§èƒ½

çº¿ç¨‹è¶Šå¤šï¼ŒCPUåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§

ç¨‹åºè®¾è®¡æ›´åŠ å¤æ‚ï¼šæ¯”å¦‚çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€å¤šçº¿ç¨‹çš„æ•°æ®å…±äº«
</code></pre>

<h4>4.å¤šçº¿ç¨‹åœ¨iOSå¼€å‘ä¸­çš„åº”ç”¨</h4>

<pre><code>ä¸»çº¿ç¨‹:ä¸€ä¸ªiOSç¨‹åºè¿è¡Œåï¼Œé»˜è®¤ä¼šå¼€å¯1æ¡çº¿ç¨‹ï¼Œç§°ä¸ºâ€œä¸»çº¿ç¨‹â€æˆ–â€œUIçº¿ç¨‹â€

ä¸»çº¿ç¨‹çš„ä¸»è¦ä½œç”¨

æ˜¾ç¤º\åˆ·æ–°UIç•Œé¢

å¤„ç†UIäº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ã€æ»šåŠ¨äº‹ä»¶ã€æ‹–æ‹½äº‹ä»¶ç­‰ï¼‰
</code></pre>

<p>ä¸»çº¿ç¨‹çš„ä½¿ç”¨æ³¨æ„:åˆ«å°†æ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­ã€‚</p>

<p>è€—æ—¶æ“ä½œä¼šå¡ä½ä¸»çº¿ç¨‹ï¼Œä¸¥é‡å½±å“UIçš„æµç•…åº¦ï¼Œç»™ç”¨æˆ·ä¸€ç§â€œå¡â€çš„åä½“éªŒ</p>

<h2>å¤šçº¿ç¨‹çš„å››ä¸­æ–¹å¼</h2>

<h4>1. Pthreads</h4>

<h4>2. NSThread</h4>

<h4>3. GCD</h4>

<h4>4. NSOperation &amp; NSOperationQueue</h4>

<h2>å¤šçº¿ç¨‹çš„å…¨è§£æ-çœ‹äº†ä¸è¡Œä½ è¿˜ä¸ä¼š</h2>

<p><img src="/images/multithread.png" title="Caption" ></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/05/zsqlfmdbcoredata/">CoreData vs SQLite vs FMDB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-05T14:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:59 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>æ¦‚è§ˆ</p>

<p>åœ¨iOSå¼€å‘ä¸­æ•°æ®å­˜å‚¨çš„æ–¹å¼å¯ä»¥å½’çº³ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯å­˜å‚¨ä¸ºæ–‡ä»¶ï¼Œå¦ä¸€ç±»æ˜¯å­˜å‚¨åˆ°æ•°æ®åº“ã€‚ä¾‹å¦‚å‰é¢IOSå¼€å‘ç³»åˆ—â€”Objective-Cä¹‹Foundationæ¡†æ¶çš„æ–‡ç« ä¸­æåˆ°å½’æ¡£ã€plistæ–‡ä»¶å­˜å‚¨ï¼ŒåŒ…æ‹¬åå¥½è®¾ç½®å…¶æœ¬è´¨éƒ½æ˜¯å­˜å‚¨ä¸ºæ–‡ä»¶ï¼Œåªæ˜¯è¯´å½’æ¡£æˆ–è€…plistæ–‡ä»¶å­˜å‚¨å¯ä»¥é€‰æ‹©ä¿å­˜åˆ°æ²™ç›’ä¸­ï¼Œè€Œåå¥½è®¾ç½®ç³»ç»Ÿå·²ç»è§„å®šåªèƒ½ä¿å­˜åˆ°æ²™ç›’çš„Library/Preferencesç›®å½•ã€‚å½“ç„¶ï¼Œæ–‡ä»¶å­˜å‚¨å¹¶ä¸ä½œä¸ºæœ¬æ–‡çš„é‡ç‚¹å†…å®¹ã€‚æœ¬æ–‡é‡ç‚¹è¿˜æ˜¯è¯´æ•°æ®åº“å­˜å‚¨ï¼Œåšè¿‡æ•°æ®åº“å¼€å‘çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡SQLç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ORMè¿›è¡Œå¯¹è±¡å…³ç³»æ˜ å°„è®¿é—®æ•°æ®åº“ã€‚è¿™ä¸¤ç§æ–¹å¼æ°æ°å¯¹åº”iOSä¸­SQLiteå’ŒCore Dataçš„å†…å®¹ï¼Œåœ¨æ­¤å°†é‡ç‚¹è¿›è¡Œåˆ†æ:</p>

<h3>1. SQLite</h3>

<h3>2. Core Data</h3>

<h3>3. FMDB</h3>

<hr />

<h2>SQLite</h2>

<p>SQLiteæ˜¯ç›®å‰ä¸»æµçš„åµŒå…¥å¼å…³ç³»å‹æ•°æ®åº“ï¼Œå…¶æœ€ä¸»è¦çš„ç‰¹ç‚¹å°±æ˜¯è½»é‡çº§ã€è·¨å¹³å°ï¼Œå½“å‰å¾ˆå¤šåµŒå…¥å¼æ“ä½œç³»ç»Ÿéƒ½å°†å…¶ä½œä¸ºæ•°æ®åº“é¦–é€‰ã€‚è™½ç„¶SQLiteæ˜¯ä¸€æ¬¾è½»å‹æ•°æ®åº“ï¼Œä½†æ˜¯å…¶åŠŸèƒ½ä¹Ÿç»ä¸äºšäºå¾ˆå¤šå¤§å‹å…³ç³»æ•°æ®åº“ã€‚å­¦ä¹ æ•°æ®åº“å°±è¦å­¦ä¹ å…¶ç›¸å…³çš„å®šä¹‰ã€æ“ä½œã€æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶æ—¥å¸¸è¯´å¾—SQLè¯­å¥ã€‚å’Œå…¶ä»–æ•°æ®åº“ç›¸æ¯”ï¼ŒSQLiteä¸­çš„SQLè¯­æ³•å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ï¼Œå› æ­¤è¿™é‡Œå¯¹äºSQLè¯­å¥çš„å†…å®¹ä¸ä¼šè¿‡å¤šèµ˜è¿°ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒSQLiteä¸­å…¶ä»–SQLç›¸å…³çš„å†…å®¹ï¼Œè¿™é‡Œè¿˜æ˜¯é‡ç‚¹è®²è§£iOSä¸­å¦‚ä½•ä½¿ç”¨SQLiteæ„å»ºåº”ç”¨ç¨‹åºã€‚å…ˆçœ‹ä¸€ä¸‹SQLiteæ•°æ®åº“çš„å‡ ä¸ªç‰¹ç‚¹ï¼š</p>

<p>1.åŸºäºCè¯­è¨€å¼€å‘çš„è½»å‹æ•°æ®åº“</p>

<p>2.åœ¨iOSä¸­éœ€è¦ä½¿ç”¨Cè¯­è¨€è¯­æ³•è¿›è¡Œæ•°æ®åº“æ“ä½œã€è®¿é—®ï¼ˆæ— æ³•ä½¿ç”¨ObjCç›´æ¥è®¿é—®ï¼Œå› ä¸ºlibqlite3æ¡†æ¶åŸºäºCè¯­è¨€ç¼–å†™ï¼‰</p>

<p>3.SQLiteä¸­é‡‡ç”¨çš„æ˜¯åŠ¨æ€æ•°æ®ç±»å‹ï¼Œå³ä½¿åˆ›å»ºæ—¶å®šä¹‰äº†ä¸€ç§ç±»å‹ï¼Œåœ¨å®é™…æ“ä½œæ—¶ä¹Ÿå¯ä»¥å­˜å‚¨å…¶ä»–ç±»å‹ï¼Œä½†æ˜¯æ¨èå»ºåº“æ—¶ä½¿ç”¨åˆé€‚çš„ç±»å‹ï¼ˆç‰¹åˆ«æ˜¯åº”ç”¨éœ€è¦è€ƒè™‘è·¨å¹³å°çš„æƒ…å†µæ—¶ï¼‰</p>

<p>4.å»ºç«‹è¿æ¥åé€šå¸¸ä¸éœ€è¦å…³é—­è¿æ¥ï¼ˆå°½ç®¡å¯ä»¥æ‰‹åŠ¨å…³é—­ï¼‰</p>

<p>è¦ä½¿ç”¨SQLiteå¾ˆç®€å•ï¼Œå¦‚æœåœ¨Mac OSXä¸Šä½¿ç”¨å¯ä»¥è€ƒè™‘åˆ°SQLiteå®˜æ–¹ç½‘ç«™ä¸‹è½½å‘½ä»¤è¡Œå·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼äºSQLiteManagerã€Navicat for SQLiteç­‰å·¥å…·ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶å¼€å‘è°ƒè¯•ï¼Œå»ºè®®åœ¨å¼€å‘ç¯å¢ƒä¸­å®‰è£…ä¸Šè¿°å·¥å…·ã€‚</p>

<p>åœ¨iOSä¸­æ“ä½œSQLiteæ•°æ®åº“å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼ˆæ³¨æ„å…ˆåœ¨é¡¹ç›®ä¸­å¯¼å…¥libsqlite3æ¡†æ¶ï¼‰ï¼š</p>

<p>1.æ‰“å¼€æ•°æ®åº“ï¼Œåˆ©ç”¨sqlite3_open()æ‰“å¼€æ•°æ®åº“ä¼šæŒ‡å®šä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€ï¼Œå¦åˆ™åˆ›å»ºå¹¶æ‰“å¼€ã€‚æ‰“å¼€æ•°æ®åº“ä¼šå¾—åˆ°ä¸€ä¸ªsqlite3ç±»å‹çš„å¯¹è±¡ï¼Œåé¢éœ€è¦å€ŸåŠ©è¿™ä¸ªå¯¹è±¡è¿›è¡Œå…¶ä»–æ“ä½œã€‚</p>

<p>2.æ‰§è¡ŒSQLè¯­å¥ï¼Œæ‰§è¡ŒSQLè¯­å¥åˆåŒ…æ‹¬æœ‰è¿”å›å€¼çš„è¯­å¥å’Œæ— è¿”å›å€¼è¯­å¥ã€‚</p>

<p>3.å¯¹äºæ— è¿”å›å€¼çš„è¯­å¥ï¼ˆå¦‚å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ï¼‰ç›´æ¥é€šè¿‡sqlite3_exec()å‡½æ•°æ‰§è¡Œï¼›</p>

<p>4.å¯¹äºæœ‰è¿”å›å€¼çš„è¯­å¥åˆ™é¦–å…ˆé€šè¿‡sqlite3_prepare_v2()è¿›è¡Œsqlè¯­å¥è¯„ä¼°ï¼ˆè¯­æ³•æ£€æµ‹ï¼‰ï¼Œç„¶åé€šè¿‡sqlite3_step()ä¾æ¬¡å–å‡ºæŸ¥è¯¢ç»“æœçš„æ¯ä¸€è¡Œæ•°æ®ï¼Œå¯¹äºæ¯è¡Œæ•°æ®éƒ½å¯ä»¥é€šè¿‡å¯¹åº”çš„sqlite3_column_ç±»å‹()æ–¹æ³•è·å¾—å¯¹åº”åˆ—çš„æ•°æ®ï¼Œå¦‚æ­¤åå¤å¾ªç¯ç›´åˆ°éå†å®Œæˆã€‚å½“ç„¶ï¼Œæœ€åéœ€è¦é‡Šæ”¾å¥æŸ„ã€‚</p>

<p>åœ¨æ•´ä¸ªæ“ä½œè¿‡ç¨‹ä¸­æ— éœ€ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œå¯¹äºåµŒå…¥å¼SQLiteæ“ä½œæ˜¯æŒä¹…è¿æ¥ï¼ˆå°½ç®¡å¯ä»¥é€šè¿‡sqlite3_close()å…³é—­ï¼‰ï¼Œä¸éœ€è¦å¼€å‘äººå‘˜è‡ªå·±é‡Šæ”¾è¿æ¥ã€‚çºµè§‚æ•´ä¸ªæ“ä½œè¿‡ç¨‹ï¼Œå…¶å®ä¸å…¶ä»–å¹³å°çš„å¼€å‘æ²¡æœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼Œè¾ƒä¸ºéº»çƒ¦çš„å°±æ˜¯æ•°æ®è¯»å–ï¼Œåœ¨iOSå¹³å°ä¸­ä½¿ç”¨Cè¿›è¡Œæ•°æ®è¯»å–é‡‡ç”¨äº†æ¸¸æ ‡çš„å½¢å¼ï¼Œæ¯æ¬¡åªèƒ½è¯»å–ä¸€è¡Œæ•°æ®ï¼Œè¾ƒä¸ºéº»çƒ¦ã€‚å› æ­¤å®é™…å¼€å‘ä¸­ä¸å¦¨å¯¹è¿™äº›æ“ä½œè¿›è¡Œå°è£…ï¼š</p>

<p>KCDbManager.h
//
//  DbManager.h
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<h1>import &lt;sqlite3.h></h1>

<h1>import &ldquo;KCSingleton.h&rdquo;</h1>

<p>@interface KCDbManager : NSObject
singleton_interface(KCDbManager);</p>

<h1>pragma mark - å±æ€§</h1>

<h1>pragma mark æ•°æ®åº“å¼•ç”¨ï¼Œä½¿ç”¨å®ƒè¿›è¡Œæ•°æ®åº“æ“ä½œ</h1>

<p>@property (nonatomic) sqlite3 *database;</p>

<h1>pragma mark - å…±æœ‰æ–¹æ³•</h1>

<p>/<strong>
 *  æ‰“å¼€æ•°æ®åº“
 *
 *  @param dbname æ•°æ®åº“åç§°
 <em>/
-(void)openDb:(NSString </em>)dbname;
/</strong>
 *  æ‰§è¡Œæ— è¿”å›å€¼çš„sql
 *
 *  @param sql sqlè¯­å¥
 <em>/
-(void)executeNonQuery:(NSString </em>)sql;
/<em><em>
 *  æ‰§è¡Œæœ‰è¿”å›å€¼çš„sql
 *
 *  @param sql sqlè¯­å¥
 *
 *  @return æŸ¥è¯¢ç»“æœ
 </em>/
-(NSArray </em>)executeQuery:(NSString *)sql;
@end</p>

<p>KCDbManager.m
//
//  DbManager.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &ldquo;KCDbManager.h&rdquo;</h1>

<h1>import &lt;sqlite3.h></h1>

<h1>import &ldquo;KCSingleton.h&rdquo;</h1>

<h1>import &ldquo;KCAppConfig.h&rdquo;</h1>

<h1>ifndef kDatabaseName</h1>

<h1>define kDatabaseName @&ldquo;myDatabase.db&rdquo;</h1>

<h1>endif</h1>

<p>@interface KCDbManager()
@end
@implementation KCDbManager
singleton_implementation(KCDbManager)</p>

<h1>pragma mark é‡å†™åˆå§‹åŒ–æ–¹æ³•</h1>

<p>-(instancetype)init{
    KCDbManager <em>manager;
    if((manager=[super init]))
    {
        [manager openDb:kDatabaseName];
    }
    return manager;
}
-(void)openDb:(NSString </em>)dbname{
    //å–å¾—æ•°æ®åº“ä¿å­˜è·¯å¾„ï¼Œé€šå¸¸ä¿å­˜æ²™ç›’Documentsç›®å½•
    NSString <em>directory=[NSSearchPathForDirectoriesInDomains(NSDocumentationDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@&ldquo;%@&rdquo;,directory);
    NSString </em>filePath=[directory stringByAppendingPathComponent:dbname];
    //å¦‚æœæœ‰æ•°æ®åº“åˆ™ç›´æ¥æ‰“å¼€ï¼Œå¦åˆ™åˆ›å»ºå¹¶æ‰“å¼€ï¼ˆæ³¨æ„filePathæ˜¯ObjCä¸­çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦è½¬åŒ–ä¸ºCè¯­è¨€å­—ç¬¦ä¸²ç±»å‹ï¼‰
    if (SQLITE_OK ==sqlite3_open(filePath.UTF8String, &amp;<em>database)) {
        NSLog(@&ldquo;æ•°æ®åº“æ‰“å¼€æˆåŠŸ!&rdquo;);
    }else{
        NSLog(@&ldquo;æ•°æ®åº“æ‰“å¼€å¤±è´¥!&rdquo;);
    }
}
-(void)executeNonQuery:(NSString <em>)sql{
    char </em>error;
    //å•æ­¥æ‰§è¡Œsqlè¯­å¥ï¼Œç”¨äºæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤
    if (SQLITE_OK!=sqlite3_exec(</em>database, sql.UTF8String, NULL, NULL,&amp;error)) {
        NSLog(@&ldquo;æ‰§è¡ŒSQLè¯­å¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼é”™è¯¯ä¿¡æ¯ï¼š%s&rdquo;,error);
    }
}
-(NSArray <em>)executeQuery:(NSString </em>)sql{
    NSMutableArray *rows=[NSMutableArray array];//æ•°æ®è¡Œ</p>

<pre><code>//è¯„ä¼°è¯­æ³•æ­£ç¡®æ€§
sqlite3_stmt *stmt;
//æ£€æŸ¥è¯­æ³•æ­£ç¡®æ€§
if (SQLITE_OK==sqlite3_prepare_v2(_database, sql.UTF8String, -1, &amp;stmt, NULL)) {
    //å•æ­¥æ‰§è¡Œsqlè¯­å¥
    while (SQLITE_ROW==sqlite3_step(stmt)) {
        int columnCount= sqlite3_column_count(stmt);
        NSMutableDictionary *dic=[NSMutableDictionary dictionary];
        for (int i=0; i&lt;columnCount; i++) {
            const char *name= sqlite3_column_name(stmt, i);//å–å¾—åˆ—å
            const unsigned char *value= sqlite3_column_text(stmt, i);//å–å¾—æŸåˆ—çš„å€¼
            dic[[NSString stringWithUTF8String:name]]=[NSString stringWithUTF8String:(const char *)value];
        }
        [rows addObject:dic];
    }
}

//é‡Šæ”¾å¥æŸ„
sqlite3_finalize(stmt);

return rows;
</code></pre>

<p>}
@end</p>

<p>åœ¨ä¸Šé¢çš„ç±»ä¸­å¯¹äºæ•°æ®åº“æ“ä½œè¿›è¡Œäº†å°è£…ï¼Œå°è£…ä¹‹åæ•°æ®æ“ä½œæ›´åŠ æ–¹ä¾¿ï¼ŒåŒæ—¶æ‰€æœ‰çš„è¯­æ³•éƒ½ç”±Cè½¬æ¢æˆäº†ObjCã€‚</p>

<p>ä¸‹é¢ä»ç„¶ä»¥å¾®åšæŸ¥çœ‹ä¸ºä¾‹è¿›è¡ŒSQLiteæ¼”ç¤ºã€‚å½“ç„¶å®é™…å¼€å‘ä¸­å¾®åšæ•°æ®æ˜¯ä»ç½‘ç»œè¯»å–çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç¼“å­˜é—®é¢˜ï¼Œé€šå¸¸ä¼šé€‰æ‹©å°†å¾®åšæ•°æ®ä¿å­˜åˆ°æœ¬åœ°ï¼Œä¸‹é¢çš„Demoæ¼”ç¤ºäº†å°†æ•°æ®å­˜æ”¾åˆ°æœ¬åœ°æ•°æ®åº“ä»¥åŠæ•°æ®è¯»å–çš„è¿‡ç¨‹ã€‚å½“ç„¶ï¼Œå®é™…å¼€å‘ä¸­å¹¶ä¸ä¼šåœ¨è§†å›¾æ§åˆ¶å™¨ä¸­ç›´æ¥è°ƒç”¨æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼Œåœ¨è¿™é‡Œé€šå¸¸ä¼šå¼•å…¥ä¸¤ä¸ªæ¦‚å¿µModelå’ŒServiceã€‚Modelè‡ªä¸å¿…å¤šè¯´ï¼Œå°±æ˜¯MVCä¸­çš„æ¨¡å‹ã€‚è€ŒServiceæŒ‡çš„æ˜¯æ“ä½œæ•°æ®åº“çš„æœåŠ¡å±‚ï¼Œå®ƒå°è£…äº†å¯¹äºModelçš„åŸºæœ¬æ“ä½œæ–¹æ³•ï¼Œå®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚ä¸ºäº†è§£è€¦ï¼Œåœ¨æ§åˆ¶å™¨ä¸­æ˜¯ä¸ä¼šç›´æ¥æ¥è§¦æ•°æ®åº“çš„ï¼Œæ§åˆ¶å™¨ä¸­åªå’Œæ¨¡å‹ï¼ˆæ¨¡å‹æ˜¯é¢†åŸŸçš„æŠ½è±¡ï¼‰ã€æœåŠ¡å¯¹è±¡æœ‰å…³ç³»ï¼Œå€ŸåŠ©æœåŠ¡å±‚å¯¹æ¨¡å‹è¿›è¡Œå„ç±»æ“ä½œï¼Œæ¨¡å‹çš„æ“ä½œååº”åˆ°æ•°æ®åº“ä¸­å°±æ˜¯å¯¹è¡¨ä¸­æ•°æ®çš„æ“ä½œã€‚å…·ä½“å…³ç³»å¦‚ä¸‹ï¼š</p>

<p><img src="/images/CSR001.jpg" title="Caption" ></p>

<p>è¦å®Œæˆä¸Šè¿°åŠŸèƒ½ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªåº”ç”¨ç¨‹åºå…¨å±€å¯¹è±¡è¿›è¡Œæ•°æ®åº“ã€è¡¨çš„åˆ›å»ºã€‚ä¸ºäº†é¿å…æ¯æ¬¡éƒ½åˆ›å»ºæ•°æ®åº“å’Œè¡¨å‡ºé”™ï¼Œè¿™é‡Œåˆ©ç”¨äº†åå¥½è®¾ç½®è¿›è¡Œä¿å­˜å½“å‰åˆ›å»ºçŠ¶æ€ï¼ˆå…¶å®è¿™ä¹Ÿæ˜¯æ•°æ®å­˜å‚¨çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¦‚æœåˆ›å»ºè¿‡äº†æ•°æ®åº“åˆ™ä¸å†åˆ›å»ºï¼Œå¦åˆ™åˆ›å»ºæ•°æ®åº“å’Œè¡¨ã€‚</p>

<p>KCDatabaseCreator.m</p>

<p>//
//  KCDatabaseCreator.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &ldquo;KCDatabaseCreator.h&rdquo;</h1>

<h1>import &ldquo;KCDbManager.h&rdquo;</h1>

<p>@implementation KCDatabaseCreator
+(void)initDatabase{
    NSString <em>key=@&ldquo;IsCreatedDb&rdquo;;
    NSUserDefaults </em>defaults=[[NSUserDefaults alloc]init];
    if ([[defaults valueForKey:key] intValue]!=1) {
        [self createUserTable];
        [self createStatusTable];
        [defaults setValue:@1 forKey:key];
    }
}
+(void)createUserTable{
    NSString <em>sql=@&ldquo;CREATE TABLE User (Id integer PRIMARY KEY AUTOINCREMENT,name text,screenName text, profileImageUrl text,mbtype text,city text)&rdquo;;
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
+(void)createStatusTable{
    NSString </em>sql=@&ldquo;CREATE TABLE Status (Id integer PRIMARY KEY AUTOINCREMENT,source text,createdAt date,\"text\&rdquo; text,user integer REFERENCES User (Id))&ldquo;;
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
@end</p>

<p>å…¶æ¬¡ï¼Œå®šä¹‰æ•°æ®æ¨¡å‹ï¼Œè¿™é‡Œå®šä¹‰ç”¨æˆ·Userå’Œå¾®åšStatusä¸¤ä¸ªæ•°æ®æ¨¡å‹ç±»ã€‚æ³¨æ„æ¨¡å‹åº”è¯¥å°½é‡ä¿æŒå…¶å•çº¯æ€§ï¼Œä»…ä»…æ˜¯ç®€å•çš„POCOï¼Œä¸è¦å¼•å…¥è§†å›¾ã€æ§åˆ¶å™¨ç­‰ç›¸å…³å†…å®¹ã€‚</p>

<p>KCUser.h</p>

<p>//
//  KCUser.h
//  UrlConnection
//
//  Created by Kenshin Cui on 14-3-22.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<p>@interface KCUser : NSObject</p>

<h1>pragma mark ç¼–å·</h1>

<p>@property (nonatomic,strong) NSNumber *Id;</p>

<h1>pragma mark ç”¨æˆ·å</h1>

<p>@property (nonatomic,copy) NSString *name;</p>

<h1>pragma mark ç”¨æˆ·æ˜µç§°</h1>

<p>@property (nonatomic,copy) NSString *screenName;</p>

<h1>pragma mark å¤´åƒ</h1>

<p>@property (nonatomic,copy) NSString *profileImageUrl;</p>

<h1>pragma mark ä¼šå‘˜ç±»å‹</h1>

<p>@property (nonatomic,copy) NSString *mbtype;</p>

<h1>pragma mark åŸå¸‚</h1>

<p>@property (nonatomic,copy) NSString *city;</p>

<h1>pragma mark - åŠ¨æ€æ–¹æ³•</h1>

<p>/<strong>
 *  åˆå§‹åŒ–ç”¨æˆ·
 *
 *  @param name ç”¨æˆ·å
 *  @param city æ‰€åœ¨åŸå¸‚
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 <em>/
-(KCUser </em>)initWithName:(NSString <em>)name screenName:(NSString </em>)screenName profileImageUrl:(NSString <em>)profileImageUrl mbtype:(NSString </em>)mbtype city:(NSString *)city;
/</strong>
 *  ä½¿ç”¨å­—å…¸åˆå§‹åŒ–ç”¨æˆ·å¯¹è±¡
 *
 *  @param dic ç”¨æˆ·æ•°æ®
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 <em>/
-(KCUser </em>)initWithDictionary:(NSDictionary *)dic;</p>

<h1>pragma mark - é™æ€æ–¹æ³•</h1>

<p>+(KCUser <em>)userWithName:(NSString </em>)name screenName:(NSString <em>)screenName profileImageUrl:(NSString </em>)profileImageUrl mbtype:(NSString <em>)mbtype city:(NSString </em>)city;
@end</p>

<p>KCUser.m</p>

<p>//
//  KCUser.m
//  UrlConnection
//
//  Created by Kenshin Cui on 14-3-22.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &ldquo;KCUser.h&rdquo;</h1>

<p>@implementation KCUser
-(KCUser <em>)initWithName:(NSString </em>)name screenName:(NSString <em>)screenName profileImageUrl:(NSString </em>)profileImageUrl mbtype:(NSString <em>)mbtype city:(NSString </em>)city{
    if (self=[super init]) {
        self.name=name;
        self.screenName=screenName;
        self.profileImageUrl=profileImageUrl;
        self.mbtype=mbtype;
        self.city=city;
    }
    return self;
}
-(KCUser <em>)initWithDictionary:(NSDictionary </em>)dic{
    if (self=[super init]) {
        [self setValuesForKeysWithDictionary:dic];
    }
    return self;
}
+(KCUser <em>)userWithName:(NSString </em>)name screenName:(NSString <em>)screenName profileImageUrl:(NSString </em>)profileImageUrl mbtype:(NSString <em>)mbtype city:(NSString </em>)city{
    KCUser *user=[[KCUser alloc]initWithName:name screenName:screenName profileImageUrl:profileImageUrl mbtype:mbtype city:city];
    return user;
}
@end</p>

<p>KCStatus.h</p>

<p>//
//  KCStatus.h
//  UITableView
//
//  Created by Kenshin Cui on 14-3-1.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<h1>import &ldquo;KCUser.h&rdquo;</h1>

<p>@interface KCStatus : NSObject</p>

<h1>pragma mark - å±æ€§</h1>

<p>@property (nonatomic,strong) NSNumber <em>Id;//å¾®åšid
@property (nonatomic,strong) KCUser </em>user;//å‘é€ç”¨æˆ·
@property (nonatomic,copy) NSString <em>createdAt;//åˆ›å»ºæ—¶é—´
@property (nonatomic,copy) NSString </em>source;//è®¾å¤‡æ¥æº
@property (nonatomic,copy) NSString *text;//å¾®åšå†…å®¹</p>

<h1>pragma mark - åŠ¨æ€æ–¹æ³•</h1>

<p>/<strong>
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param user            å‘é€ç”¨æˆ·
 *
 *  @return å¾®åšå¯¹è±¡
 <em>/
-(KCStatus </em>)initWithCreateAt:(NSString <em>)createAt source:(NSString </em>)source text:(NSString <em>)text user:(KCUser </em>)user;
/</strong>
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param profileImageUrl ç”¨æˆ·å¤´åƒ
 *  @param mbtype          ä¼šå‘˜ç±»å‹
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param userId          ç”¨æˆ·ç¼–å·
 *
 *  @return å¾®åšå¯¹è±¡
 <em>/
-(KCStatus </em>)initWithCreateAt:(NSString <em>)createAt source:(NSString </em>)source text:(NSString <em>)text userId:(int)userId;
/**
 *  ä½¿ç”¨å­—å…¸åˆå§‹åŒ–å¾®åšå¯¹è±¡
 *
 *  @param dic å­—å…¸æ•°æ®
 *
 *  @return å¾®åšå¯¹è±¡
 </em>/
-(KCStatus <em>)initWithDictionary:(NSDictionary </em>)dic;</p>

<h1>pragma mark - é™æ€æ–¹æ³•</h1>

<p>/<strong>
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param user            å‘é€ç”¨æˆ·
 *
 *  @return å¾®åšå¯¹è±¡
 <em>/
+(KCStatus </em>)statusWithCreateAt:(NSString <em>)createAt source:(NSString </em>)source text:(NSString <em>)text user:(KCUser </em>)user;
/</strong>
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param profileImageUrl ç”¨æˆ·å¤´åƒ
 *  @param mbtype          ä¼šå‘˜ç±»å‹
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param userId          ç”¨æˆ·ç¼–å·
 *
 *  @return å¾®åšå¯¹è±¡
 <em>/
+(KCStatus </em>)statusWithCreateAt:(NSString <em>)createAt source:(NSString </em>)source text:(NSString *)text userId:(int)userId;
@end</p>

<p>KCStatus.m</p>

<p>//
//  KCStatus.m
//  UITableView
//
//  Created by Kenshin Cui on 14-3-1.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &ldquo;KCStatus.h&rdquo;</h1>

<p>@implementation KCStatus
-(KCStatus <em>)initWithDictionary:(NSDictionary </em>)dic{
    if (self=[super init]) {
        [self setValuesForKeysWithDictionary:dic];
        self.user=[[KCUser alloc]init];
        self.user.Id=dic[@&ldquo;user&rdquo;];
    }
    return self;
}
-(KCStatus <em>)initWithCreateAt:(NSString </em>)createAt source:(NSString <em>)source text:(NSString </em>)text user:(KCUser <em>)user{
    if (self=[super init]) {
        self.createdAt=createAt;
        self.source=source;
        self.text=text;
        self.user=user;
    }
    return self;
}
-(KCStatus </em>)initWithCreateAt:(NSString <em>)createAt source:(NSString </em>)source text:(NSString <em>)text userId:(int)userId{
    if (self=[super init]) {
        self.createdAt=createAt;
        self.source=source;
        self.text=text;
        KCUser </em>user=[[KCUser alloc]init];
        user.Id=[NSNumber numberWithInt:userId];
        self.user=user;
    }
    return self;
}
-(NSString <em>)source{
    return [NSString stringWithFormat:@&ldquo;æ¥è‡ª %@&rdquo;,_source];
}
+(KCStatus </em>)statusWithCreateAt:(NSString <em>)createAt source:(NSString </em>)source text:(NSString <em>)text user:(KCUser </em>)user{
    KCStatus <em>status=[[KCStatus alloc]initWithCreateAt:createAt source:source text:text user:user];
    return status;
}
+(KCStatus </em>)statusWithCreateAt:(NSString <em>)createAt source:(NSString </em>)source text:(NSString <em>)text userId:(int)userId{
    KCStatus </em>status=[[KCStatus alloc]initWithCreateAt:createAt source:source text:text userId:userId];
    return status;
}
@end</p>

<p>ç„¶åï¼Œç¼–å†™æœåŠ¡ç±»ï¼Œè¿›è¡Œæ•°æ®çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œï¼Œç”±äºæœåŠ¡ç±»æ–¹æ³•åŒæ ·ä¸éœ€è¦è¿‡å¤šçš„é…ç½®ï¼Œå› æ­¤å®šä¹‰ä¸ºå•ä¾‹ï¼Œä¿è¯ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹å³å¯ã€‚æœåŠ¡ç±»ä¸­è°ƒç”¨å‰é¢å°è£…çš„æ•°æ®åº“æ–¹æ³•å°†å¯¹æ•°æ®åº“çš„æ“ä½œè½¬æ¢ä¸ºå¯¹æ¨¡å‹çš„æ“ä½œã€‚</p>

<p>KCUserService.h</p>

<p>//
//  KCUserService.h
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<h1>import &ldquo;KCUser.h&rdquo;</h1>

<h1>import &ldquo;KCSingleton.h&rdquo;</h1>

<p>@interface KCUserService : NSObject
singleton_interface(KCUserService)
/<strong>
 *  æ·»åŠ ç”¨æˆ·ä¿¡æ¯
 *
 *  @param user ç”¨æˆ·å¯¹è±¡
 <em>/
-(void)addUser:(KCUser </em>)user;
/</strong>
 *  åˆ é™¤ç”¨æˆ·
 *
 *  @param user ç”¨æˆ·å¯¹è±¡
 <em>/
-(void)removeUser:(KCUser </em>)user;
/<strong>
 *  æ ¹æ®ç”¨æˆ·ååˆ é™¤ç”¨æˆ·
 *
 *  @param name ç”¨æˆ·å
 <em>/
-(void)removeUserByName:(NSString </em>)name;
/</strong>
 *  ä¿®æ”¹ç”¨æˆ·å†…å®¹
 *
 *  @param user ç”¨æˆ·å¯¹è±¡
 <em>/
-(void)modifyUser:(KCUser </em>)user;
/<strong>
 *  æ ¹æ®ç”¨æˆ·ç¼–å·å–å¾—ç”¨æˆ·
 *
 *  @param Id ç”¨æˆ·ç¼–å·
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 <em>/
-(KCUser </em>)getUserById:(int)Id;
/</strong>
 *  æ ¹æ®ç”¨æˆ·åå–å¾—ç”¨æˆ·
 *
 *  @param name ç”¨æˆ·å
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 <em>/
-(KCUser </em>)getUserByName:(NSString *)name;
@end</p>

<p>KCUserService.m</p>

<p>//
//  KCUserService.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &ldquo;KCUserService.h&rdquo;</h1>

<h1>import &ldquo;KCUser.h&rdquo;</h1>

<h1>import &ldquo;KCDbManager.h&rdquo;</h1>

<p>@implementation KCUserService
singleton_implementation(KCUserService)
-(void)addUser:(KCUser <em>)user{
    NSString </em>sql=[NSString stringWithFormat:@&ldquo;INSERT INTO User (name,screenName, profileImageUrl,mbtype,city) VALUES(&lsquo;%@&rsquo;,&lsquo;%@&rsquo;,&lsquo;%@&rsquo;,&lsquo;%@&rsquo;,&lsquo;%@&rsquo;)&rdquo;,user.name,user.screenName, user.profileImageUrl,user.mbtype,user.city];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)removeUser:(KCUser <em>)user{
    NSString </em>sql=[NSString stringWithFormat:@&ldquo;DELETE FROM User WHERE Id=&lsquo;%@&rsquo;&rdquo;,user.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)removeUserByName:(NSString <em>)name{
    NSString </em>sql=[NSString stringWithFormat:@&ldquo;DELETE FROM User WHERE name=&lsquo;%@&rsquo;&rdquo;,name];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)modifyUser:(KCUser <em>)user{
    NSString </em>sql=[NSString stringWithFormat:@&ldquo;UPDATE User SET name=&lsquo;%@&rsquo;,screenName=&lsquo;%@&rsquo;,profileImageUrl=&lsquo;%@&rsquo;,mbtype=&lsquo;%@&rsquo;,city=&lsquo;%@&rsquo; WHERE Id=&lsquo;%@&rsquo;&rdquo;,user.name,user.screenName,user.profileImageUrl,user.mbtype,user.city,user.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(KCUser <em>)getUserById:(int)Id{
    KCUser </em>user=[[KCUser alloc]init];
    NSString <em>sql=[NSString stringWithFormat:@&ldquo;SELECT name,screenName,profileImageUrl,mbtype,city FROM User WHERE Id=&lsquo;%i&rsquo;&rdquo;, Id];
    NSArray </em>rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    if (rows&amp;&amp;rows.count>0) {
        [user setValuesForKeysWithDictionary:rows[0]];
    }
    return user;
}
-(KCUser <em>)getUserByName:(NSString </em>)name{
    KCUser <em>user=[[KCUser alloc]init];
    NSString </em>sql=[NSString stringWithFormat:@&ldquo;SELECT Id, name,screenName,profileImageUrl,mbtype,city FROM User WHERE name=&lsquo;%@&rsquo;&rdquo;, name];
    NSArray *rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    if (rows&amp;&amp;rows.count>0) {
        [user setValuesForKeysWithDictionary:rows[0]];
    }
    return user;
}
@end</p>

<p>KCStatusService.h</p>

<p>//
//  KCStatusService.h
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<h1>import &ldquo;KCSingleton.h&rdquo;</h1>

<p>@class KCStatus;
@interface KCStatusService : NSObject
singleton_interface(KCStatusService)
/<strong>
 *  æ·»åŠ å¾®åšä¿¡æ¯
 *
 *  @param status å¾®åšå¯¹è±¡
 <em>/
-(void)addStatus:(KCStatus </em>)status;
/</strong>
 *  åˆ é™¤å¾®åš
 *
 *  @param status å¾®åšå¯¹è±¡
 <em>/
-(void)removeStatus:(KCStatus </em>)status;
/<strong>
 *  ä¿®æ”¹å¾®åšå†…å®¹
 *
 *  @param status å¾®åšå¯¹è±¡
 <em>/
-(void)modifyStatus:(KCStatus </em>)status;
/</strong>
 *  æ ¹æ®ç¼–å·å–å¾—å¾®åš
 *
 *  @param Id å¾®åšç¼–å·
 *
 *  @return å¾®åšå¯¹è±¡
 <em>/
-(KCStatus </em>)getStatusById:(int)Id;
/<em><em>
 *  å–å¾—æ‰€æœ‰å¾®åšå¯¹è±¡
 *
 *  @return æ‰€æœ‰å¾®åšå¯¹è±¡
 </em>/
-(NSArray </em>)getAllStatus;
@end</p>

<p>KCStatusService.m</p>

<p>//
//  KCStatusService.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &ldquo;KCStatusService.h&rdquo;</h1>

<h1>import &ldquo;KCDbManager.h&rdquo;</h1>

<h1>import &ldquo;KCStatus.h&rdquo;</h1>

<h1>import &ldquo;KCUserService.h&rdquo;</h1>

<h1>import &ldquo;KCSingleton.h&rdquo;</h1>

<p>@interface KCStatusService(){</p>

<p>}
@end
@implementation KCStatusService
singleton_implementation(KCStatusService)
-(void)addStatus:(KCStatus <em>)status{
    NSString </em>sql=[NSString stringWithFormat:@&ldquo;INSERT INTO Status (source,createdAt,\"text\&rdquo; ,user) VALUES(&lsquo;%@&rsquo;,&lsquo;%@&rsquo;,&lsquo;%@&rsquo;,&lsquo;%@&rsquo;)&ldquo;,status.source,status.createdAt,status.text,status.user.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)removeStatus:(KCStatus <em>)status{
    NSString </em>sql=[NSString stringWithFormat:@"DELETE FROM Status WHERE Id=&lsquo;%@&rsquo;&rdquo;,status.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)modifyStatus:(KCStatus <em>)status{
    NSString </em>sql=[NSString stringWithFormat:@&ldquo;UPDATE Status SET source=&lsquo;%@&rsquo;,createdAt=&lsquo;%@&rsquo;,\"text\&rdquo;=&lsquo;%@&rsquo; ,user=&lsquo;%@&rsquo; WHERE Id=&lsquo;%@&rsquo;&ldquo;,status.source,status.createdAt,status.text,status.user, status.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(KCStatus <em>)getStatusById:(int)Id{
    KCStatus </em>status=[[KCStatus alloc]init];
    NSString <em>sql=[NSString stringWithFormat:@"SELECT Id, source,createdAt,\"text\&rdquo; ,user FROM Status WHERE Id=&lsquo;%i&rsquo;&ldquo;, Id];
    NSArray </em>rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    if (rows&amp;&amp;rows.count>0) {
        [status setValuesForKeysWithDictionary:rows[0]];
        status.user=[[KCUserService sharedKCUserService] getUserById:[(NSNumber <em>)rows[0][@"user&rdquo;] intValue]] ;
    }
    return status;
}
-(NSArray </em>)getAllStatus{
    NSMutableArray <em>array=[NSMutableArray array];
    NSString </em>sql=@&ldquo;SELECT Id, source,createdAt,\"text\&rdquo; ,user FROM Status ORDER BY Id";
    NSArray <em>rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    for (NSDictionary </em>dic in rows) {
        KCStatus <em>status=[self getStatusById:[(NSNumber </em>)dic[@&ldquo;Id&rdquo;] intValue]];
        [array addObject:status];
    }
    return array;
}
@end</p>

<p>æœ€åï¼Œåœ¨è§†å›¾æ§åˆ¶å™¨ä¸­è°ƒç”¨ç›¸åº”çš„æœåŠ¡å±‚è¿›è¡Œå„ç±»æ•°æ®æ“ä½œï¼Œåœ¨ä¸‹é¢çš„ä»£ç ä¸­åˆ†åˆ«æ¼”ç¤ºäº†å¢ã€åˆ ã€æ”¹ã€æŸ¥å››ç±»æ“ä½œã€‚</p>

<p>KCMainViewController.m
//
//  KCMainTableViewController.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
//</p>

<h1>import &ldquo;KCMainTableViewController.h&rdquo;</h1>

<h1>import &ldquo;KCDbManager.h&rdquo;</h1>

<h1>import &ldquo;KCDatabaseCreator.h&rdquo;</h1>

<h1>import &ldquo;KCUser.h&rdquo;</h1>

<h1>import &ldquo;KCStatus.h&rdquo;</h1>

<h1>import &ldquo;KCUserService.h&rdquo;</h1>

<h1>import &ldquo;KCStatusService.h&rdquo;</h1>

<h1>import &ldquo;KCStatusTableViewCell.h&rdquo;</h1>

<p>@interface KCMainTableViewController (){
    NSArray <em>_status;
    NSMutableArray </em>_statusCells;
}
@end
@implementation KCMainTableViewController
- (void)viewDidLoad {
    [super viewDidLoad];
    [KCDatabaseCreator initDatabase];</p>

<p>//    [self addUsers];
//    [self removeUser];
//    [self modifyUserInfo];</p>

<p>//    [self addStatus];</p>

<pre><code>[self loadStatusData];
</code></pre>

<p>}
-(void)addUsers{
    KCUser <em>user1=[KCUser userWithName:@&ldquo;Binger&rdquo; screenName:@&ldquo;å†°å„¿&rdquo; profileImageUrl:@&ldquo;binger.jpg&rdquo; mbtype:@&ldquo;mbtype.png&rdquo; city:@&ldquo;åŒ—äº¬&rdquo;];
    [[KCUserService sharedKCUserService] addUser:user1];
    KCUser </em>user2=[KCUser userWithName:@&ldquo;Xiaona&rdquo; screenName:@&ldquo;å°å¨œ&rdquo; profileImageUrl:@&ldquo;xiaona.jpg&rdquo; mbtype:@&ldquo;mbtype.png&rdquo; city:@&ldquo;åŒ—äº¬&rdquo;];
    [[KCUserService sharedKCUserService] addUser:user2];
    KCUser <em>user3=[KCUser userWithName:@&ldquo;Lily&rdquo; screenName:@&ldquo;ä¸½ä¸½&rdquo; profileImageUrl:@&ldquo;lily.jpg&rdquo; mbtype:@&ldquo;mbtype.png&rdquo; city:@&ldquo;åŒ—äº¬&rdquo;];
    [[KCUserService sharedKCUserService] addUser:user3];
    KCUser </em>user4=[KCUser userWithName:@&ldquo;Qianmo&rdquo; screenName:@&ldquo;é˜¡é™Œ&rdquo; profileImageUrl:@&ldquo;qianmo.jpg&rdquo; mbtype:@&ldquo;mbtype.png&rdquo; city:@&ldquo;åŒ—äº¬&rdquo;];
    [[KCUserService sharedKCUserService] addUser:user4];
    KCUser <em>user5=[KCUser userWithName:@&ldquo;Yanyue&rdquo; screenName:@&ldquo;ç‚æœˆ&rdquo; profileImageUrl:@&ldquo;yanyue.jpg&rdquo; mbtype:@&ldquo;mbtype.png&rdquo; city:@&ldquo;åŒ—äº¬&rdquo;];
    [[KCUserService sharedKCUserService] addUser:user5];
}
-(void)addStatus{
    KCStatus </em>status1=[KCStatus statusWithCreateAt:@&ldquo;9:00&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;ä¸€åªé›ªçŒ´åœ¨æ—¥æœ¬è¾¹æ³¡æ¸©æ³‰è¾¹ç©iPhoneçš„ç…§ç‰‡ï¼Œè·å¾—äº†\"2014å¹´é‡ç”ŸåŠ¨ç‰©æ‘„å½±å¸ˆ\"å¤§èµ›ç‰¹ç­‰å¥–ã€‚ä¸€èµ·æ¥ä¸ºçŒ´å­é…ä¸ªè¯&rdquo; userId:1];
    [[KCStatusService sharedKCStatusService] addStatus:status1];
    KCStatus <em>status2=[KCStatus statusWithCreateAt:@&ldquo;9:00&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;ä¸€åªé›ªçŒ´åœ¨æ—¥æœ¬è¾¹æ³¡æ¸©æ³‰è¾¹ç©iPhoneçš„ç…§ç‰‡ï¼Œè·å¾—äº†\"2014å¹´é‡ç”ŸåŠ¨ç‰©æ‘„å½±å¸ˆ\"å¤§èµ›ç‰¹ç­‰å¥–ã€‚ä¸€èµ·æ¥ä¸ºçŒ´å­é…ä¸ªè¯&rdquo; userId:1];
    [[KCStatusService sharedKCStatusService] addStatus:status2];
    KCStatus </em>status3=[KCStatus statusWithCreateAt:@&ldquo;9:30&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;ã€æˆ‘ä»¬é€iPhone6äº† è¦æ±‚å¾ˆç®€å•ã€‘çœŸå¿ƒå›é¦ˆç²‰ä¸ï¼Œå°ç¼–è§‰å¾—ç°åœ¨æœ€å¥½çš„å¥–å“å°±æ˜¯iPhone6äº†ã€‚ä»Šèµ·åˆ°12æœˆ31æ—¥ï¼Œå…³æ³¨æˆ‘ä»¬ï¼Œè½¬å‘å¾®åšï¼Œå°±æœ‰æœºä¼šè·iPhone6(å¥–å“å¯èƒ½éœ€è¦ç­‰å¾…)ï¼æ¯æœˆæŠ½ä¸€å°[é¼“æŒ]ã€‚ä¸è´¹äº‹ï¼Œè¿˜æ˜¯è¯•è¯•å§ï¼Œä¸‡ä¸€ä¸­äº†å‘¢&rdquo; userId:2];
    [[KCStatusService sharedKCStatusService] addStatus:status3];
    KCStatus <em>status4=[KCStatus statusWithCreateAt:@&ldquo;9:45&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;é‡å¤§æ–°é—»ï¼šè’‚å§†åº“å…‹å®£å¸ƒå‡ºæŸœåï¼ŒISISæˆ˜å£«æ€’æ‰”iPhoneï¼Œæ²™ç‰¹ç¥èŒäººå‘˜å‘¼åäººä»¬æ¢å›iPhone 4ã€‚[via Pan-Arabia Enquirer]&rdquo; userId:3];
    [[KCStatusService sharedKCStatusService] addStatus:status4];
    KCStatus </em>status5=[KCStatus statusWithCreateAt:@&ldquo;10:05&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;å°ä¼™ä¼´ä»¬ï¼Œæœ‰è°çŸ¥é“æ€ä¹ˆå¾€Iphone4Sé‡Œå€’ä¸œè¥¿ï¼Ÿå€’å…¥çš„ä¸œè¥¿åˆè¯¥åœ¨å“ªé‡Œæ‰¾ï¼Ÿç”¨äº†Iphoneè¿™ä¹ˆé•¿æ—¶é—´ï¼Œè¿˜çœŸçš„ä¸çŸ¥é“æ€ä¹ˆå¼„ï¼æœ‰è°çŸ¥é“å•Šï¼Ÿè°¢è°¢ï¼&rdquo; userId:4];
    [[KCStatusService sharedKCStatusService] addStatus:status5];
    KCStatus <em>status6=[KCStatus statusWithCreateAt:@&ldquo;10:07&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;åœ¨éŸ³æ‚¦å°iPhoneå®¢æˆ·ç«¯é‡Œå‘ç°ä¸€ä¸ªæ‚¦å•ã€ŠInfinite é‡‘æ˜æ´™ã€‹ï¼Œæ¨èç»™å¤§å®¶! &rdquo; userId:1];
    [[KCStatusService sharedKCStatusService] addStatus:status6];
    KCStatus </em>status7=[KCStatus statusWithCreateAt:@&ldquo;11:20&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;å¦‚æœsonyå§mp3æ’­æ”¾å™¨äº§å“å‘å±•ä¸‹å»ï¼Œä¸è´ªå›¾æ‰‹å¤´èŠ‚ç›®æºçš„ç°å®åˆ©ç›Šï¼Œå°±æœ¨æœ‰è‹¹æœçš„ipodï¼Œä¹Ÿå°±æœ¨æœ‰iphoneã€‚æŸ¯è¾¾ç±»ä¼¼çš„ç°å®åˆ©ç›Šï¼Œä¸è‡ªæˆ‘é©å‘½çš„æ¡ˆä¾‹ä¹Ÿæ˜¯ä¸€ç§å·¨å¤´çš„å®¿å‘½ã€‚&rdquo; userId:2];
    [[KCStatusService sharedKCStatusService] addStatus:status7];
    KCStatus <em>status8=[KCStatus statusWithCreateAt:@&ldquo;13:00&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;ã€iPhone 7 Plusã€‘æ–°ä¹°çš„iPhone 7 Plus ï¼Œå¦‚ä½•ï¼Ÿå¤Ÿé…·ç‚«ä¹ˆï¼Ÿ&rdquo; userId:2];
    [[KCStatusService sharedKCStatusService] addStatus:status8];
    KCStatus </em>status9=[KCStatus statusWithCreateAt:@&ldquo;13:24&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;è‡ªæ‹ç¥å™¨#å¡è¥¿æ¬§TR500#ï¼Œtr350Sï½ä»·æ ¼ç¾ä¸½ï¼Œè¡Œè´§ï¼Œå…¨å›½è”ä¿ï½iPhone6 iPhone6Pluså¡è¥¿æ¬§TR150 TR200 TR350 TR350Så…¨é¢åˆ°è´§ æ‹›æ”¶å„ç§ä»£ç†ï¼[ç»™åŠ›]å¾®ä¿¡ï¼š39017366&rdquo; userId:3];
    [[KCStatusService sharedKCStatusService] addStatus:status9];
    KCStatus <em>status10=[KCStatus statusWithCreateAt:@&ldquo;13:26&rdquo; source:@&ldquo;iPhone 6&rdquo; text:@&ldquo;çŒœåˆ°çŒ´å“¥ç©æ‰‹æœºæ—¶æ‰€æ€æ‰€æƒ³è€…ï¼Œå†å¥–iPhoneä¸€éƒ¨ã€‚ï¼ˆå¥–å“ç”±â€œ2014å¹´é‡ç”ŸåŠ¨ç‰©æ‘„å½±å¸ˆâ€è¯„å§”ä¼šé¢å‘ï¼‰&rdquo; userId:3];
    [[KCStatusService sharedKCStatusService] addStatus:status10];
}
-(void)removeUser{
    //æ³¨æ„åœ¨SQLiteä¸­åŒºåˆ†å¤§å°å†™
    [[KCUserService sharedKCUserService] removeUserByName:@&ldquo;Yanyue&rdquo;];
}
-(void)modifyUserInfo{
    KCUser </em>user1= [[KCUserService sharedKCUserService]getUserByName:@&ldquo;Xiaona&rdquo;];
    user1.city=@&ldquo;ä¸Šæµ·&rdquo;;
    [[KCUserService sharedKCUserService] modifyUser:user1];</p>

<pre><code>KCUser *user2= [[KCUserService sharedKCUserService]getUserByName:@"Lily"];
user2.city=@"æ·±åœ³";
[[KCUserService sharedKCUserService] modifyUser:user2];
</code></pre>

<p>}</p>

<h1>pragma mark åŠ è½½æ•°æ®</h1>

<p>-(void)loadStatusData{
    <em>statusCells=[[NSMutableArray alloc]init];
    </em>status=[[KCStatusService sharedKCStatusService]getAllStatus];
    [<em>status enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL <em>stop) {
        KCStatusTableViewCell </em>cell=[[KCStatusTableViewCell alloc]init];
        cell.status=(KCStatus *)obj;
        [</em>statusCells addObject:cell];
    }];
    NSLog(@&ldquo;%@&rdquo;,[_status lastObject]);
}</p>

<h1>pragma mark - Table view data source</h1>

<ul>
<li>(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {
  return 1;
}</li>
<li>(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
  return _status.count;
}</li>
<li>(UITableViewCell <em>)tableView:(UITableView </em>)tableView cellForRowAtIndexPath:(NSIndexPath <em>)indexPath {
  static NSString </em>identtityKey=@&ldquo;myTableViewCellIdentityKey1&rdquo;;
  KCStatusTableViewCell <em>cell=[self.tableView dequeueReusableCellWithIdentifier:identtityKey];
  if(cell==nil){
      cell=[[KCStatusTableViewCell alloc]initWithStyle:UITableViewCellStyleValue1 reuseIdentifier:identtityKey];
  }
  cell.status=_status[indexPath.row];
  return cell;
}
-(CGFloat)tableView:(UITableView </em>)tableView heightForRowAtIndexPath:(NSIndexPath <em>)indexPath{
  return ((KCStatusTableViewCell </em>)_statusCells[indexPath.row]).height;
}
-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{
  return 20.0f;
}
@end</li>
</ul>


<p>é¡¹ç›®ç›®å½•ç»“æ„ï¼š</p>

<p><img src="/images/CSR002.jpg" title="Caption" ></p>

<p>è¿è¡Œæ•ˆæœ</p>

<p><img src="/images/CSR003.jpg" title="Caption" >
Core Data</p>

<p>åŸºæœ¬æ¦‚å¿µ</p>

<p>å½“å‰ï¼Œå„ç±»åº”ç”¨å¼€å‘ä¸­åªè¦ç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œé€šå¸¸éƒ½ä¼šç”¨åˆ°ä¸€ä¸ªæ¦‚å¿µâ€œå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰â€ã€‚ä¾‹å¦‚åœ¨Javaå¹³å°ä½¿ç”¨Hibernateï¼Œåœ¨.NETå¹³å°ä½¿ç”¨Entity Frameworkã€Linqã€NHibernateç­‰ã€‚åœ¨iOSä¸­ä¹Ÿä¸ä¾‹å¤–ï¼ŒiOSä¸­ORMæ¡†æ¶é¦–é€‰Core Dataï¼Œè¿™æ˜¯å®˜æ–¹æ¨èçš„ï¼Œä¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚æ— è®ºæ˜¯å“ªç§å¹³å°ã€å“ªç§æŠ€æœ¯ï¼ŒORMæ¡†æ¶çš„ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£å°±æ˜¯å°†å…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ï¼ˆå‡†ç¡®çš„è¯´æ˜¯å®ä½“ï¼‰è½¬æ¢ä¸ºç¨‹åºä¸­çš„å¯¹è±¡ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯å¯¹æ•°æ®åº“çš„æ“ä½œï¼ˆä¾‹å¦‚Core Dataä¸­å¦‚æœå­˜å‚¨ç±»å‹é…ç½®ä¸ºSQLiteåˆ™æœ¬è´¨è¿˜æ˜¯æ“ä½œçš„SQLiteæ•°æ®åº“ï¼‰ã€‚ç»†å¿ƒçš„æœ‹å‹åº”è¯¥å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä¸Šé¢çš„SQLiteä¸­å…¶å®æˆ‘ä»¬åœ¨KCMainViewControllerä¸­è¿›è¡Œçš„æ•°æ®åº“æ“ä½œå·²ç»è½¬æ¢ä¸ºäº†å¯¹è±¡æ“ä½œï¼ŒæœåŠ¡å±‚ä¸­çš„æ–¹æ³•ä¸­å·²ç»å°†å¯¹æ•°æ®åº“çš„æ“ä½œå°è£…èµ·æ¥ï¼Œè½¬æ¢ä¸ºäº†å¯¹Modelçš„æ“ä½œï¼Œè¿™ç§æ–¹å¼å·²ç»æ˜¯é¢å‘å¯¹è±¡çš„ã€‚ä¸Šè¿°é€šè¿‡å°†å¯¹è±¡æ˜ å°„åˆ°å®ä½“çš„è¿‡ç¨‹å®Œå…¨æ˜¯æ‰‹åŠ¨å®Œæˆçš„ï¼Œç›¸å¯¹æ¥è¯´æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œå°±æ‹¿å¯¹KCStatuså¯¹è±¡çš„æ“ä½œæ¥è¯´ï¼šé¦–å…ˆè¦æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ï¼ˆStatusè¡¨ï¼‰ï¼Œå…¶æ¬¡æ‰‹åŠ¨åˆ›å»ºæ¨¡å‹KCStatusï¼Œæ¥ç€åˆ›å»ºæœåŠ¡å±‚KCStatusServiceã€‚Core Dataæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œå®ƒå°†æ•°æ®åº“çš„åˆ›å»ºã€è¡¨çš„åˆ›å»ºã€å¯¹è±¡å’Œè¡¨çš„è½¬æ¢ç­‰æ“ä½œå°è£…èµ·æ¥ï¼Œç®€åŒ–äº†æˆ‘ä»¬çš„æ“ä½œï¼ˆæ³¨æ„Core Dataåªæ˜¯å°†å¯¹è±¡å…³ç³»çš„æ˜ å°„ç®€åŒ–äº†ï¼Œå¹¶ä¸æ˜¯æŠŠæœåŠ¡å±‚æ›¿ä»£äº†ï¼Œè¿™ä¸€ç‚¹å¤§å®¶éœ€è¦æ˜ç™½ï¼‰ã€‚</p>

<p>ä½¿ç”¨Core Dataè¿›è¡Œæ•°æ®åº“å­˜å–å¹¶ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨ç”±Core Dataæ¡†æ¶å®Œæˆï¼Œå¼€å‘äººå‘˜é¢å¯¹çš„æ˜¯æ¨¡å‹ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯æŠŠæ¨¡å‹åˆ›å»ºèµ·æ¥ï¼Œå…·ä½“æ•°æ®åº“å¦‚ä½•åˆ›å»ºåˆ™ä¸ç”¨ç®¡ã€‚åœ¨iOSé¡¹ç›®ä¸­æ·»åŠ â€œData Modelâ€æ–‡ä»¶ã€‚ç„¶ååœ¨å…¶ä¸­åˆ›å»ºå®ä½“å’Œå…³ç³»ï¼š</p>

<p><img src="/images/CSR004.jpg" title="Caption" >
<img src="/images/CSR005.jpg" title="Caption" ></p>

<p>æ¨¡å‹åˆ›å»ºçš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ï¼š</p>

<p>1.å®ä½“å¯¹è±¡ä¸éœ€è¦åˆ›å»ºIDä¸»é”®ï¼ŒAttributesä¸­åº”è¯¥æ˜¯æœ‰æ„ä¹‰å±æ€§ï¼ˆåˆ›å»ºè¿‡ç¨‹ä¸­åº”è¯¥è€ƒè™‘å¯¹è±¡çš„å±æ€§è€Œä¸æ˜¯æ•°æ®åº“ä¸­è¡¨æœ‰å‡ ä¸ªå­—æ®µï¼Œå°½ç®¡å¤šæ•°å±æ€§ä¼šå¯¹åº”è¡¨çš„å­—æ®µï¼‰ã€‚</p>

<p>2.æ‰€æœ‰çš„å±æ€§åº”è¯¥æŒ‡å®šå…·ä½“ç±»å‹ï¼ˆå°½ç®¡åœ¨SQLiteä¸­å¯ä»¥ä¸æŒ‡å®šï¼‰ï¼Œå› ä¸ºå®ä½“å¯¹è±¡ä¼šå¯¹åº”ç”ŸæˆObjCæ¨¡å‹ç±»ã€‚</p>

<p>3.å®ä½“å¯¹è±¡ä¸­å…¶ä»–å®ä½“å¯¹è±¡ç±»å‹çš„å±æ€§åº”è¯¥é€šè¿‡Relationshipså»ºç«‹ï¼Œå¹¶ä¸”æ³¨æ„å®ä½“ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼ˆä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡å¾®åšï¼Œè€Œä¸€æ¡å¾®åšåˆ™åªå±äºä¸€ä¸ªç”¨æˆ·,ç”¨æˆ·å’Œå¾®åšå½¢æˆä¸€å¯¹å¤šçš„å…³ç³»ï¼‰ã€‚</p>

<p>ä»¥ä¸Šæ¨¡å‹åˆ›å»ºåï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®ä¸Šé¢çš„æ¨¡å‹æ–‡ä»¶ï¼ˆ.xcdatamodeldæ–‡ä»¶ï¼‰ç”Ÿæˆå…·ä½“çš„å®ä½“ç±»ã€‚åœ¨Xcodeä¸­æ·»åŠ â€œNSManagedObject Subclassâ€æ–‡ä»¶ï¼ŒæŒ‰ç…§æ­¥éª¤é€‰æ‹©åˆ›å»ºçš„æ¨¡å‹åŠå®ä½“ï¼ŒXcodeå°±ä¼šæ ¹æ®æ‰€åˆ›å»ºæ¨¡å‹ç”Ÿæˆå…·ä½“çš„å®ä½“ç±»ã€‚</p>

<p>User.h</p>

<p>//
//  User.h
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright &copy; 2014å¹´ cmjstudio. All rights reserved.
//</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<h1>import &lt;CoreData/CoreData.h></h1>

<p>@class Status;
@interface User : NSManagedObject
@property (nonatomic, retain) NSString * city;
@property (nonatomic, retain) NSString * mbtype;
@property (nonatomic, retain) NSString * name;
@property (nonatomic, retain) NSString * profileImageUrl;
@property (nonatomic, retain) NSString * screenName;
@property (nonatomic, retain) NSSet <em>statuses;
@end
@interface User (CoreDataGeneratedAccessors)
- (void)addStatusesObject:(Status </em>)value;
- (void)removeStatusesObject:(Status <em>)value;
- (void)addStatuses:(NSSet </em>)values;
- (void)removeStatuses:(NSSet *)values;
@end</p>

<p>User.m</p>

<p>//
//  User.m
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright &copy; 2014å¹´ cmjstudio. All rights reserved.
//</p>

<h1>import &ldquo;User.h&rdquo;</h1>

<h1>import &ldquo;Status.h&rdquo;</h1>

<p>@implementation User
@dynamic city;
@dynamic mbtype;
@dynamic name;
@dynamic profileImageUrl;
@dynamic screenName;
@dynamic statuses;
@end</p>

<p>Status.h
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</p>

<p>//
//  Status.h
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright &copy; 2014å¹´ cmjstudio. All rights reserved.
//</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<h1>import &lt;CoreData/CoreData.h></h1>

<p>@interface Status : NSManagedObject
@property (nonatomic, retain) NSDate * createdAt;
@property (nonatomic, retain) NSString * source;
@property (nonatomic, retain) NSString * text;
@property (nonatomic, retain) NSManagedObject *user;
@end</p>

<p>Status.m</p>

<p>//
//  Status.m
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright &copy; 2014å¹´ cmjstudio. All rights reserved.
//</p>

<h1>import &ldquo;Status.h&rdquo;</h1>

<p>@implementation Status
@dynamic createdAt;
@dynamic source;
@dynamic text;
@dynamic user;
@end</p>

<p>å¾ˆæ˜¾ç„¶ï¼Œé€šè¿‡æ¨¡å‹ç”Ÿæˆç±»çš„è¿‡ç¨‹ç›¸å½“ç®€å•ï¼Œé€šå¸¸è¿™äº›ç±»ä¹Ÿä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ï¼Œå¦‚æœæ¨¡å‹å‘ç”Ÿçš„å˜åŒ–åªè¦é‡æ–°ç”Ÿæˆå³å¯ã€‚æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>

<p>1.æ‰€æœ‰çš„å®ä½“ç±»å‹éƒ½ç»§æ‰¿äºNSManagedObjectï¼Œæ¯ä¸ªNSManagedObjectå¯¹è±¡å¯¹åº”ç€æ•°æ®åº“ä¸­ä¸€æ¡è®°å½•ã€‚</p>

<p>2.é›†åˆå±æ€§ï¼ˆä¾‹å¦‚Userä¸­çš„statusï¼‰ç”Ÿæˆäº†è®¿é—®æ­¤å±æ€§çš„åˆ†ç±»æ–¹æ³•ã€‚</p>

<p>3.ä½¿ç”¨@dynamicä»£è¡¨å…·ä½“å±æ€§å®ç°ï¼Œå…·ä½“å®ç°ç»†èŠ‚ä¸éœ€è¦å¼€å‘äººå‘˜å…³å¿ƒã€‚</p>

<p>å½“ç„¶ï¼Œäº†è§£äº†è¿™äº›è¿˜ä¸è¶³ä»¥å®Œæˆæ•°æ®çš„æ“ä½œã€‚ç©¶ç«ŸCore Dataå…·ä½“çš„è®¾è®¡å¦‚ä½•ï¼Œè¦å®Œæˆæ•°æ®çš„å­˜å–æˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸€ä¸‹Core Dataå‡ ä¸ªæ ¸å¿ƒçš„ç±»ã€‚</p>

<p><img src="/images/CSR006.jpg" title="Caption" ></p>

<p>1.Persistent Object Storeï¼šå¯ä»¥ç†è§£ä¸ºå­˜å‚¨æŒä¹…å¯¹è±¡çš„æ•°æ®åº“ï¼ˆä¾‹å¦‚SQLiteï¼Œæ³¨æ„Core Dataä¹Ÿæ”¯æŒå…¶ä»–ç±»å‹çš„æ•°æ®å­˜å‚¨ï¼Œä¾‹å¦‚xmlã€äºŒè¿›åˆ¶æ•°æ®ç­‰ï¼‰ã€‚</p>

<p>2.Managed Object Modelï¼šå¯¹è±¡æ¨¡å‹ï¼Œå¯¹åº”Xcodeä¸­åˆ›å»ºçš„æ¨¡å‹æ–‡ä»¶ã€‚</p>

<p>3.Persistent Store Coordinatorï¼šå¯¹è±¡æ¨¡å‹å’Œå®ä½“ç±»ä¹‹é—´çš„è½¬æ¢åè°ƒå™¨ï¼Œç”¨äºç®¡ç†ä¸åŒå­˜å‚¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ã€‚</p>

<p>4.Managed Object Context:å¯¹è±¡ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œè´Ÿè´£å®ä½“å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´çš„äº¤äº’ã€‚</p>

<p>Core Dataä½¿ç”¨</p>

<p>Core Dataä½¿ç”¨èµ·æ¥ç›¸å¯¹ç›´æ¥ä½¿ç”¨SQLite3çš„APIè€Œè¨€æ›´åŠ çš„é¢å‘å¯¹è±¡ï¼Œæ“ä½œè¿‡ç¨‹é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>

<p>1.åˆ›å»ºç®¡ç†ä¸Šä¸‹æ–‡</p>

<p>åˆ›å»ºç®¡ç†ä¸Šä¸‹å¯ä»¥ç»†åˆ†ä¸ºï¼šåŠ è½½æ¨¡å‹æ–‡ä»¶->æŒ‡å®šæ•°æ®å­˜å‚¨è·¯å¾„->åˆ›å»ºå¯¹åº”æ•°æ®ç±»å‹çš„å­˜å‚¨->åˆ›å»ºç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–¹å¹¶æŒ‡å®šå­˜å‚¨ã€‚</p>

<p>ç»è¿‡è¿™å‡ ä¸ªæ­¥éª¤ä¹‹åå¯ä»¥å¾—åˆ°ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡NSManagedObjectContextï¼Œä»¥åæ‰€æœ‰çš„æ•°æ®æ“ä½œéƒ½ç”±æ­¤å¯¹è±¡è´Ÿè´£ã€‚åŒæ—¶å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºä¸Šä¸‹æ–‡ï¼ŒCore Dataä¼šè‡ªåŠ¨åˆ›å»ºå­˜å‚¨æ–‡ä»¶ï¼ˆä¾‹å¦‚è¿™é‡Œä½¿ç”¨SQLite3å­˜å‚¨ï¼‰ï¼Œå¹¶ä¸”æ ¹æ®æ¨¡å‹å¯¹è±¡åˆ›å»ºå¯¹åº”çš„è¡¨ç»“æ„ã€‚ä¸‹å›¾ä¸ºç¬¬ä¸€æ¬¡è¿è¡Œç”Ÿæˆçš„æ•°æ®åº“åŠç›¸å…³æ˜ å°„æ–‡ä»¶ï¼š</p>

<p><img src="/images/CSR007.jpg" title="Caption" ></p>

<p>ä¸ºäº†æ–¹ä¾¿åé¢ä½¿ç”¨ï¼ŒNSManagedObjectContextå¯¹è±¡å¯ä»¥ä½œä¸ºå•ä¾‹æˆ–é™æ€å±æ€§æ¥ä¿å­˜ï¼Œä¸‹é¢æ˜¯åˆ›å»ºçš„ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„ä¸»è¦ä»£ç ï¼š</p>

<p>-(NSManagedObjectContext <em>)createDbContext{
    NSManagedObjectContext </em>context;
    //æ‰“å¼€æ¨¡å‹æ–‡ä»¶ï¼Œå‚æ•°ä¸ºnilåˆ™æ‰“å¼€åŒ…ä¸­æ‰€æœ‰æ¨¡å‹æ–‡ä»¶å¹¶åˆå¹¶æˆä¸€ä¸ª
    NSManagedObjectModel <em>model=[NSManagedObjectModel mergedModelFromBundles:nil];
    //åˆ›å»ºè§£æå™¨
    NSPersistentStoreCoordinator </em>storeCoordinator=[[NSPersistentStoreCoordinator alloc]initWithManagedObjectModel:model];
    //åˆ›å»ºæ•°æ®åº“ä¿å­˜è·¯å¾„
    NSString <em>dir=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@&ldquo;%@&rdquo;,dir);
    NSString </em>path=[dir stringByAppendingPathComponent:@&ldquo;myDatabase.db&rdquo;];
    NSURL <em>url=[NSURL fileURLWithPath:path];
    //æ·»åŠ SQLiteæŒä¹…å­˜å‚¨åˆ°è§£æå™¨
    NSError </em>error;
    [storeCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:url options:nil error:&amp;error];
    if(error){
        NSLog(@&ldquo;æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼é”™è¯¯:%@&rdquo;,error.localizedDescription);
    }else{
        context=[[NSManagedObjectContext alloc]init];
        context.persistentStoreCoordinator=storeCoordinator;
        NSLog(@&ldquo;æ•°æ®åº“æ‰“å¼€æˆåŠŸï¼&rdquo;);
    }
    return context;
}</p>

<p>2.æŸ¥è¯¢æ•°æ®</p>

<p>å¯¹äºæœ‰æ¡ä»¶çš„æŸ¥è¯¢ï¼Œåœ¨Core Dataä¸­æ˜¯é€šè¿‡è°“è¯æ¥å®ç°çš„ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åè®¾ç½®è¯·æ±‚æ¡ä»¶ï¼Œæœ€åè°ƒç”¨ä¸Šä¸‹æ–‡æ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•ã€‚</p>

<p>-(void)addUserWithName:(NSString <em>)name screenName:(NSString </em>)screenName profileImageUrl:(NSString <em>)profileImageUrl mbtype:(NSString </em>)mbtype city:(NSString <em>)city{
    //æ·»åŠ ä¸€ä¸ªå¯¹è±¡
    User </em>us= [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;User&rdquo; inManagedObjectContext:self.context];
    us.name=name;
    us.screenName=screenName;
    us.profileImageUrl=profileImageUrl;
    us.mbtype=mbtype;
    us.city=city;
    NSError *error;
    //ä¿å­˜ä¸Šä¸‹æ–‡
    if (![self.context save:&amp;error]) {
        NSLog(@&ldquo;æ·»åŠ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯,é”™è¯¯ä¿¡æ¯ï¼š%@ï¼&rdquo;,error.localizedDescription);
    }
}</p>

<p>å¦‚æœæœ‰å¤šä¸ªæ¡ä»¶ï¼Œåªè¦ä½¿ç”¨è°“è¯ç»„åˆå³å¯ï¼Œé‚£ä¹ˆå¯¹äºå…³è”å¯¹è±¡æ¡ä»¶æ€ä¹ˆæŸ¥è¯¢å‘¢ï¼Ÿè¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µè¿›è¡Œä»‹ç»ï¼š</p>

<p>a.æŸ¥æ‰¾ä¸€ä¸ªå¯¹è±¡åªæœ‰å”¯ä¸€ä¸€ä¸ªå…³è”å¯¹è±¡çš„æƒ…å†µï¼Œä¾‹å¦‚æŸ¥æ‰¾ç”¨æˆ·åä¸ºâ€œBingerâ€çš„å¾®åšï¼ˆä¸€ä¸ªå¾®åšåªèƒ½å±äºä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œé€šè¿‡keypathæŸ¥è¯¢</p>

<p>-(NSArray <em>)getStatusesByUserName:(NSString </em>)name{
    NSFetchRequest <em>request=[NSFetchRequest fetchRequestWithEntityName:@&ldquo;Status&rdquo;];
    request.predicate=[NSPredicate predicateWithFormat:@&ldquo;user.name=%@&rdquo;,name];
    NSArray </em>array=[self.context executeFetchRequest:request error:nil];
    return  array;
}</p>

<p>æ­¤æ—¶å¦‚æœè·Ÿè¸ªCore Dataç”Ÿæˆçš„SQLè¯­å¥ä¼šå‘ç°å…¶å®å°±æ˜¯æŠŠStatusè¡¨å’ŒUserè¡¨è¿›è¡Œäº†å…³è”æŸ¥è¯¢ï¼ˆJOINè¿æ¥ï¼‰ã€‚</p>

<p>b.æŸ¥æ‰¾ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå…³è”å¯¹è±¡çš„æƒ…å†µï¼Œä¾‹å¦‚æŸ¥æ‰¾å‘é€å¾®åšå†…å®¹ä¸­åŒ…å«â€œWatchâ€å¹¶ä¸”ç”¨æˆ·æ˜µç§°ä¸ºâ€œå°å¨œâ€çš„ç”¨æˆ·ï¼ˆä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡å¾®åšï¼‰ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åˆ©ç”¨è°“è¯è¿›è¡Œè¿‡æ»¤ã€‚</p>

<p>-(NSArray <em>)getUsersByStatusText:(NSString </em>)text screenName:(NSString <em>)screenName{
    NSFetchRequest </em>request=[NSFetchRequest fetchRequestWithEntityName:@&ldquo;Status&rdquo;];
    request.predicate=[NSPredicate predicateWithFormat:@&ldquo;text LIKE &lsquo;<em>Watch</em>&rsquo;&rdquo;,text];
    NSArray *statuses=[self.context executeFetchRequest:request error:nil];</p>

<pre><code>NSPredicate *userPredicate= [NSPredicate predicateWithFormat:@"user.screenName=%@",screenName];
NSArray *users= [statuses filteredArrayUsingPredicate:userPredicate];
return users;
</code></pre>

<p>}</p>

<p>æ³¨æ„ï¼šå¦‚æœå•çº¯æŸ¥æ‰¾å¾®åšä¸­åŒ…å«â€œWatchâ€çš„ç”¨æˆ·ï¼Œç›´æ¥æŸ¥å‡ºå¯¹åº”çš„å¾®åšï¼Œç„¶åé€šè¿‡æ¯ä¸ªå¾®åšçš„userå±æ€§å³å¯è·å¾—ç”¨æˆ·ï¼Œæ­¤æ—¶å°±ä¸ç”¨ä½¿ç”¨é¢å¤–çš„è°“è¯è¿‡æ»¤æ¡ä»¶ã€‚</p>

<p>3.æ’å…¥æ•°æ®</p>

<p>æ’å…¥æ•°æ®éœ€è¦è°ƒç”¨å®ä½“æè¿°å¯¹è±¡NSEntityDescriptionè¿”å›ä¸€ä¸ªå®ä½“å¯¹è±¡ï¼Œç„¶åè®¾ç½®å¯¹è±¡å±æ€§ï¼Œæœ€åä¿å­˜å½“å‰ä¸Šä¸‹æ–‡å³å¯ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¢ã€åˆ ã€æ”¹æ“ä½œå®Œæœ€åå¿…é¡»è°ƒç”¨ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„ä¿å­˜æ–¹æ³•ï¼Œå¦åˆ™æ“ä½œä¸ä¼šæ‰§è¡Œã€‚</p>

<p>-(void)addUserWithName:(NSString <em>)name screenName:(NSString </em>)screenName profileImageUrl:(NSString <em>)profileImageUrl mbtype:(NSString </em>)mbtype city:(NSString <em>)city{
    //æ·»åŠ ä¸€ä¸ªå¯¹è±¡
    User </em>us= [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;User&rdquo; inManagedObjectContext:self.context];
    us.name=name;
    us.screenName=screenName;
    us.profileImageUrl=profileImageUrl;
    us.mbtype=mbtype;
    us.city=city;
    NSError *error;
    //ä¿å­˜ä¸Šä¸‹æ–‡
    if (![self.context save:&amp;error]) {
        NSLog(@&ldquo;æ·»åŠ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯,é”™è¯¯ä¿¡æ¯ï¼š%@ï¼&rdquo;,error.localizedDescription);
    }
}</p>

<p>4.åˆ é™¤æ•°æ®</p>

<p>åˆ é™¤æ•°æ®å¯ä»¥ç›´æ¥è°ƒç”¨ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„deleteObjectæ–¹æ³•ï¼Œåˆ é™¤å®Œä¿å­˜ä¸Šä¸‹æ–‡å³å¯ã€‚æ³¨æ„ï¼Œåˆ é™¤æ•°æ®å‰å¿…é¡»å…ˆæŸ¥è¯¢åˆ°å¯¹åº”å¯¹è±¡ã€‚</p>

<p>-(void)removeUser:(User <em>)user{
    [self.context deleteObject:user];
    NSError </em>error;
    if (![self.context save:&amp;error]) {
        NSLog(@&ldquo;åˆ é™¤è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ï¼š%@!&rdquo;,error.localizedDescription);
    }
}</p>

<p>5.ä¿®æ”¹æ•°æ®</p>

<p>ä¿®æ”¹æ•°æ®é¦–å…ˆä¹Ÿæ˜¯å–å‡ºå¯¹åº”çš„å®ä½“å¯¹è±¡ï¼Œç„¶åé€šè¿‡ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œæœ€åä¿å­˜ä¸Šä¸‹æ–‡ã€‚</p>

<p>-(void)modifyUserWithName:(NSString <em>)name screenName:(NSString </em>)screenName profileImageUrl:(NSString <em>)profileImageUrl mbtype:(NSString </em>)mbtype city:(NSString <em>)city{
    User </em>us=[self getUserByName:name];
    us.screenName=screenName;
    us.profileImageUrl=profileImageUrl;
    us.mbtype=mbtype;
    us.city=city;
    NSError *error;
    if (![self.context save:&amp;error]) {
        NSLog(@&ldquo;ä¿®æ”¹è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯,é”™è¯¯ä¿¡æ¯ï¼š%@&rdquo;,error.localizedDescription);
    }
}</p>

<p>è°ƒè¯•</p>

<p>è™½ç„¶Core Dataï¼ˆå¦‚æœä½¿ç”¨SQLiteæ•°æ®åº“ï¼‰æ“ä½œæœ€ç»ˆè½¬æ¢ä¸ºSQLæ“ä½œï¼Œä½†æ˜¯è°ƒè¯•èµ·æ¥å´ä¸æƒ³æ“ä½œSQLé‚£ä¹ˆæ–¹ä¾¿ã€‚ç‰¹åˆ«æ˜¯å¯¹äºåˆå­¦è€…è€Œè¨€ç»å¸¸å‡ºç°æŸ¥è¯¢æŠ¥é”™çš„é—®é¢˜ï¼Œå¦‚æœèƒ½çœ‹åˆ°æœ€ç»ˆç”Ÿæˆçš„SQLè¯­å¥è‡ªç„¶å¯¹äºè°ƒè¯•å¾ˆæœ‰å¸®åŠ©ã€‚äº‹å®ä¸Šåœ¨Xcodeä¸­æ˜¯æ”¯æŒCore Dataè°ƒè¯•çš„ï¼Œå…·ä½“æ“ä½œï¼šProduct-Scheme-Edit Scheme-Run-Argumentsä¸­ä¾æ¬¡æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼ˆæ³¨æ„å‚æ•°é¡ºåºä¸èƒ½é”™ï¼‰ï¼š-com.apple.CoreData.SQLDebugã€1ã€‚ç„¶ååœ¨è¿è¡Œç¨‹åºè¿‡ç¨‹ä¸­å¦‚æœæ“ä½œäº†æ•°æ®åº“å°±ä¼šå°†SQLè¯­å¥æ‰“å°åœ¨è¾“å‡ºé¢æ¿ã€‚</p>

<p><img src="/images/CSR008.jpg" title="Caption" ></p>

<p>æ³¨æ„ï¼šå¦‚æœæ¨¡å‹å‘ç”Ÿäº†å˜åŒ–ï¼Œæ­¤æ—¶å¯ä»¥é‡æ–°ç”Ÿæˆå®ä½“ç±»æ–‡ä»¶ï¼Œä½†æ˜¯æ‰€ç”Ÿæˆçš„æ•°æ®åº“å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘é‡æ–°ç”Ÿæˆæ•°æ®åº“å¹¶è¿ç§»åŸæœ‰çš„æ•°æ®ã€‚</p>

<p>FMDB</p>

<p>åŸºæœ¬ä½¿ç”¨</p>

<p>ç›¸æ¯”äºSQLite3æ¥è¯´Core Dataå­˜åœ¨ç€è¯¸å¤šä¼˜åŠ¿ï¼Œå®ƒé¢å‘å¯¹è±¡ï¼Œå¼€å‘äººå‘˜ä¸å¿…è¿‡å¤šçš„å…³å¿ƒæ›´å¤šæ•°æ®åº“æ“ä½œçŸ¥è¯†ï¼ŒåŒæ—¶å®ƒåŸºäºObjCæ“ä½œï¼Œä¹¦å†™æ›´åŠ ä¼˜é›…ç­‰ã€‚ä½†æ˜¯å®ƒæœ¬èº«ä¹Ÿå­˜åœ¨ç€ä¸€å®šçš„é™åˆ¶ï¼Œä¾‹å¦‚å¦‚æœè€ƒè™‘åˆ°è·¨å¹³å°ï¼Œåˆ™åªèƒ½é€‰æ‹©SQLiteï¼Œå› ä¸ºæ— è®ºæ˜¯iOSè¿˜æ˜¯Androidéƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“ï¼Œé™ä½äº†å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚å…¶æ¬¡æ˜¯å½“å‰å¤šæ•°ORMæ¡†æ¶éƒ½å­˜åœ¨çš„æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºORMæœ€ç»ˆè½¬åŒ–ä¸ºSQLæ“ä½œï¼Œå…¶ä¸­ç‰µæ‰¯åˆ°æ¨¡å‹æ•°æ®è½¬åŒ–ï¼Œå…¶æ€§èƒ½è‡ªç„¶æ¯”ä¸ä¸Šç›´æ¥ä½¿ç”¨SQLæ“ä½œæ•°æ®åº“ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„é€‰æ‹©å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¯¹SQLiteè¿›è¡Œå°è£…ã€‚</p>

<p>å…¶å®é€šè¿‡å‰é¢å¯¹äºSQLiteçš„åˆ†æï¼Œå¤§å®¶åº”è¯¥å·²ç»çœ‹åˆ°KCDbManagerå°±æ˜¯å¯¹äºSQLiteå°è£…çš„ç»“æœï¼Œå¼€å‘äººå‘˜é¢å¯¹çš„åªæœ‰SQLå’ŒObjCæ–¹æ³•ï¼Œä¸ç”¨è¿‡å¤šlibsqlite3çš„Cè¯­è¨€APIã€‚ä½†å®ƒæ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªç®€å•çš„å°è£…ï¼Œè¿˜æœ‰æ›´å¤šçš„ç»†èŠ‚æ²¡æœ‰è€ƒè™‘ï¼Œä¾‹å¦‚å¦‚ä½•å¤„ç†å¹¶å‘å®‰å…¨æ€§ï¼Œå¦‚ä½•æ›´å¥½çš„å¤„ç†äº‹åŠ¡ç­‰ã€‚å› æ­¤ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶FMDBï¼Œæ•´ä¸ªæ¡†æ¶éå¸¸è½»é‡çº§ä½†åˆä¸å¤±çµæ´»æ€§ï¼Œä¹Ÿæ˜¯å¾ˆå¤šä¼ä¸šå¼€å‘çš„é¦–é€‰ã€‚</p>

<p>1.FMDBæ—¢ç„¶æ˜¯å¯¹äºlibsqlite3æ¡†æ¶çš„å°è£…ï¼Œè‡ªç„¶ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½¿ç”¨å‰ä¹Ÿè¦æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“æ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€å¦åˆ™ä¼šåˆ›å»ºå¹¶æ‰“å¼€ã€‚è¿™é‡ŒFMDBå¼•å…¥äº†ä¸€ä¸ªMFDatabaseå¯¹è±¡æ¥è¡¨ç¤ºæ•°æ®åº“ï¼Œæ‰“å¼€æ•°æ®åº“å’Œåé¢çš„æ•°æ®åº“æ“ä½œå…¨éƒ¨ä¾èµ–æ­¤å¯¹è±¡ã€‚ä¸‹é¢æ˜¯æ‰“å¼€æ•°æ®åº“è·å¾—MFDatabaseå¯¹è±¡çš„ä»£ç ï¼š</p>

<p>-(void)openDb:(NSString <em>)dbname{
    //å–å¾—æ•°æ®åº“ä¿å­˜è·¯å¾„ï¼Œé€šå¸¸ä¿å­˜æ²™ç›’Documentsç›®å½•
    NSString </em>directory=[NSSearchPathForDirectoriesInDomains(NSDocumentationDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@&ldquo;%@&rdquo;,directory);
    NSString *filePath=[directory stringByAppendingPathComponent:dbname];
    //åˆ›å»ºFMDatabaseå¯¹è±¡
    self.database=[FMDatabase databaseWithPath:filePath];
    //æ‰“å¼€æ•°æ®ä¸Š
    if ([self.database open]) {
        NSLog(@&ldquo;æ•°æ®åº“æ‰“å¼€æˆåŠŸ!&rdquo;);
    }else{
        NSLog(@&ldquo;æ•°æ®åº“æ‰“å¼€å¤±è´¥!&rdquo;);
    }
}</p>

<p>æ³¨æ„ï¼šdataWithPathä¸­çš„è·¯å¾„å‚æ•°ä¸€èˆ¬ä¼šé€‰æ‹©ä¿å­˜åˆ°æ²™ç®±ä¸­çš„Documentsç›®å½•ä¸­ï¼›å¦‚æœè¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºnilåˆ™æ•°æ®åº“ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºï¼›å¦‚æœè®¾ç½®ä¸º@â€â€åˆ™ä¼šåœ¨æ²™ç®±ä¸­çš„ä¸´æ—¶ç›®å½•åˆ›å»º,åº”ç”¨ç¨‹åºå…³é—­åˆ™æ–‡ä»¶åˆ é™¤ã€‚</p>

<p>2.å¯¹äºæ•°æ®åº“çš„æ“ä½œè·Ÿå‰é¢KCDbManagerçš„å°è£…æ˜¯ç±»ä¼¼çš„ï¼Œåœ¨FMDBä¸­FMDatabaseç±»æä¾›äº†ä¸¤ä¸ªæ–¹æ³•executeUpdate:å’ŒexecuteQuery:åˆ†åˆ«ç”¨äºæ‰§è¡Œæ— è¿”å›ç»“æœçš„æŸ¥è¯¢å’Œæœ‰è¿”å›ç»“æœçš„æŸ¥è¯¢ã€‚å½“ç„¶è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å¾ˆå¤šçš„é‡è½½è¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šäº†ã€‚å”¯ä¸€éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå¦‚æœè°ƒç”¨æœ‰æ ¼å¼åŒ–å‚æ•°çš„sqlè¯­å¥æ—¶ï¼Œæ ¼å¼åŒ–ç¬¦å·ä½¿ç”¨â€œ?â€è€Œä¸æ˜¯â€œ%@â€ã€ç­‰ã€‚ä¸‹é¢æ˜¯ä¸¤ç§æƒ…å†µçš„ä»£ç ç‰‡æ®µï¼š</p>

<p>a.æ— è¿”å›ç»“æœ</p>

<p>-(void)executeNonQuery:(NSString *)sql{
    //æ‰§è¡Œæ›´æ–°sqlè¯­å¥ï¼Œç”¨äºæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤
    if (![self.database executeUpdate:sql]) {
        NSLog(@&ldquo;æ‰§è¡ŒSQLè¯­å¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼&rdquo;);
    }
}</p>

<p>b.æœ‰è¿”å›ç»“æœ</p>

<p>-(NSArray <em>)executeQuery:(NSString </em>)sql{
    NSMutableArray <em>array=[NSMutableArray array];
    //æ‰§è¡ŒæŸ¥è¯¢sqlè¯­å¥
    FMResultSet </em>result= [self.database executeQuery:sql];
    while (result.next) {
        NSMutableDictionary *dic=[NSMutableDictionary dictionary];
        for (int i=0; i&lt;result.columnCount; ++i) {
            dic[[result columnNameForIndex:i]]=[result stringForColumnIndex:i];
        }
        [array addObject:dic];
    }
    return array;
}</p>

<p>å¯¹äºæœ‰è¿”å›ç»“æœçš„æŸ¥è¯¢è€Œè¨€ï¼ŒæŸ¥è¯¢å®Œè¿”å›ä¸€ä¸ªæ¸¸æ ‡FMResultSetï¼Œé€šè¿‡éå†æ¸¸æ ‡è¿›è¡ŒæŸ¥è¯¢ã€‚è€Œä¸”FMDBä¸­æä¾›äº†å¤§é‡intForColumnã€stringForColumnç­‰æ–¹æ³•è¿›è¡Œå–å€¼ã€‚</p>

<p>å¹¶å‘å’Œäº‹åŠ¡</p>

<p>æˆ‘ä»¬çŸ¥é“ç›´æ¥ä½¿ç”¨libsqlite3è¿›è¡Œæ•°æ®åº“æ“ä½œå…¶å®æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœé‡åˆ°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªè¡¨çš„æ—¶å€™å¯èƒ½ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨FMDatabaseQueueå¯¹è±¡ï¼Œç›¸æ¯”FMDatabaseè€Œè¨€ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>

<p>åˆ›å»ºFMDatabaseQueueçš„æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œè°ƒç”¨databaseQueueWithPath:æ–¹æ³•å³å¯ã€‚æ³¨æ„è¿™é‡Œä¸éœ€è¦è°ƒç”¨æ‰“å¼€æ“ä½œã€‚</p>

<p>-(void)openDb:(NSString <em>)dbname{
    //å–å¾—æ•°æ®åº“ä¿å­˜è·¯å¾„ï¼Œé€šå¸¸ä¿å­˜æ²™ç›’Documentsç›®å½•
    NSString </em>directory=[NSSearchPathForDirectoriesInDomains(NSDocumentationDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@&ldquo;%@&rdquo;,directory);
    NSString *filePath=[directory stringByAppendingPathComponent:dbname];
    //åˆ›å»ºFMDatabaseQueueå¯¹è±¡
    self.database=[FMDatabaseQueue databaseQueueWithPath:filePath];
}</p>

<p>ç„¶åæ‰€æœ‰çš„å¢åˆ æ”¹æŸ¥æ“ä½œè°ƒç”¨FMDatabaseQueueçš„inDatabase:æ–¹æ³•åœ¨blockä¸­æ‰§è¡Œæ“ä½œsqlè¯­å¥å³å¯ã€‚</p>

<p>-(void)executeNonQuery:(NSString <em>)sql{
    //æ‰§è¡Œæ›´æ–°sqlè¯­å¥ï¼Œç”¨äºæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤
    [self.database inDatabase:^(FMDatabase </em>db) {
        [db executeQuery:sql];
    }];
}
-(NSArray <em>)executeQuery:(NSString </em>)sql{
    NSMutableArray <em>array=[NSMutableArray array];
    [self.database inDatabase:^(FMDatabase </em>db) {
        //æ‰§è¡ŒæŸ¥è¯¢sqlè¯­å¥
        FMResultSet <em>result= [db executeQuery:sql];
        while (result.next) {
            NSMutableDictionary </em>dic=[NSMutableDictionary dictionary];
            for (int i=0; i&lt;result.columnCount; ++i) {
                dic[[result columnNameForIndex:i]]=[result stringForColumnIndex:i];
            }
            [array addObject:dic];
        }
    }];
    return array;
}</p>

<p>ä¹‹æ‰€ä»¥å°†äº‹åŠ¡æ”¾åˆ°FMDBä¸­å»è¯´å¹¶ä¸æ˜¯å› ä¸ºåªæœ‰FMDBæ‰æ”¯æŒäº‹åŠ¡ï¼Œè€Œæ˜¯å› ä¸ºFMDBå°†å…¶å°è£…æˆäº†å‡ ä¸ªæ–¹æ³•æ¥è°ƒç”¨ï¼Œä¸ç”¨è‡ªå·±å†™å¯¹åº”çš„sqlè€Œå·²ã€‚å…¶å®åœ¨åœ¨ä½¿ç”¨libsqlite3æ“ä½œæ•°æ®åº“æ—¶ä¹Ÿæ˜¯åŸç”Ÿæ”¯æŒäº‹åŠ¡çš„ï¼ˆå› ä¸ºè¿™é‡Œçš„äº‹åŠ¡æ˜¯åŸºäºæ•°æ®åº“çš„ï¼ŒFMDBè¿˜æ˜¯ä½¿ç”¨çš„SQLiteæ•°æ®åº“ï¼‰ï¼Œåªè¦åœ¨æ‰§è¡Œsqlè¯­å¥å‰åŠ ä¸Šâ€œbegin transaction;â€æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œâ€œcommit transaction;â€æˆ–è€…â€œrollback transaction;â€è¿›è¡Œæäº¤æˆ–å›æ»šå³å¯ã€‚å¦å¤–åœ¨Core Dataä¸­å¤§å®¶ä¹Ÿå¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„å¢ã€åˆ ã€æ”¹æ“ä½œä¹‹åå¿…é¡»è°ƒç”¨ä¸Šä¸‹æ–‡çš„ä¿å­˜æ–¹æ³•ï¼Œå…¶å®æœ¬èº«å°±æä¾›äº†äº‹åŠ¡çš„æ”¯æŒï¼Œåªè¦ä¸è°ƒç”¨ä¿å­˜æ–¹æ³•ï¼Œä¹‹å‰æ‰€æœ‰çš„æ“ä½œæ˜¯ä¸ä¼šæäº¤çš„ã€‚åœ¨FMDBä¸­FMDatabaseæœ‰beginTransactionã€commitã€rollbackä¸‰ä¸ªæ–¹æ³•è¿›è¡Œå¼€å¯äº‹åŠ¡ã€æäº¤äº‹åŠ¡å’Œå›æ»šäº‹åŠ¡ã€‚</p>

<p>æ€»ç»“ï¼š</p>

<p>core data</p>

<p>core data åŸºäºmodel-view-controllerï¼ˆmvcï¼‰æ¨¡å¼ä¸‹ï¼Œä¸ºåˆ›å»ºåˆ†è§£çš„cocoaåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªçµæ´»å’Œå¼ºå¤§çš„æ•°æ®æ¨¡å‹æ¡†æ¶ã€‚</p>

<p>core dataå¯ä»¥ä½¿ä½ ä»¥å›¾å½¢ç•Œé¢çš„æ–¹å¼å¿«é€Ÿçš„å®šä¹‰appçš„æ•°æ®æ¨¡å‹ï¼ŒåŒæ—¶åœ¨ä½ çš„ä»£ç ä¸­å®¹æ˜“è·å–åˆ°å®ƒã€‚core dataæä¾›äº†åŸºç¡€ç»“æ„å»å¤„ç†å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ä¿å­˜ï¼Œæ¢å¤ï¼Œæ’¤é”€å’Œé‡åšï¼Œå…è®¸ä½ åœ¨appä¸­ç»§ç»­åˆ›å»ºæ–°çš„ä»»åŠ¡ã€‚åœ¨ä½¿ç”¨core dataçš„æ—¶å€™ï¼Œä½ ä¸ç”¨å®‰è£…é¢å¤–çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå› ä¸ºcore dataä½¿ç”¨å†…ç½®çš„sqliteæ•°æ®åº“ã€‚</p>

<p>core dataæä¾›äº†ä¸€ä¸ªé€šç”¨çš„æ•°æ®ç®¡ç†è§£å†³æ–¹æ¡ˆæ¥å¤„ç†é‚£äº›æ‰€æœ‰éœ€è¦æ•°æ®æ¨¡å‹çš„app(æˆ–å¤§æˆ–å°)ã€‚appä½¿ç”¨core dataæ¥ç®¡ç†æ•°æ®å¯¹è±¡æ˜¯å¾ˆå¤šçš„ç›Šå¤„ã€‚</p>

<p>è‹¹æœçš„å›¾å½¢ç”¨æˆ·ç•Œé¢ç¼–è¯‘å™¨-interface builderï¼ˆIBï¼‰ï¼Œæä¾›äº†å¯¹core data controllerå¯¹è±¡çš„é¢„æ„å»ºï¼Œä»è€Œæ¥å‡å°‘appçš„ç”¨æˆ·ç•Œé¢å’Œå®ƒçš„æ•°æ®æ¨¡å‹ä¹‹é—´çš„ç²˜æ»ä»£ç ã€‚åœ¨ä½¿ç”¨core dataçš„æ—¶å€™ä½ ä¸éœ€è¦è€ƒè™‘sqlçš„è¯­æ³•é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦ç®¡ç†ç›¸å…³çš„é€»è¾‘æ ‘å»è¿½è¸ªç”¨æˆ·çš„è¡Œä¸ºï¼Œæ›´ä¸ç”¨å»ºç«‹æ–°çš„æ°¸ä¹…æœºåˆ¶ã€‚å½“ä½ å†™ä½ appçš„ç”¨æˆ·ç•Œé¢åˆ°å®ƒçš„ core dataæ¨¡å‹çš„æ—¶å€™ï¼Œå®ƒå·²ç»ä¸ºä½ æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½åšå¥½äº†ã€‚</p>

<p>core dataå°†ä½ appçš„æ¨¡å‹å±‚æ”¾å…¥åˆ°ä¸€ç»„å®šä¹‰åœ¨å†…å­˜ä¸­çš„æ•°æ®å¯¹è±¡ã€‚core dataä¼šè¿½è¸ªè¿™äº›å¯¹è±¡çš„æ”¹å˜ï¼ŒåŒæ—¶å¯ä»¥æ ¹æ®éœ€è¦åšç›¸åçš„æ”¹å˜ï¼Œä¾‹å¦‚ç”¨æˆ·æ‰§è¡Œæ’¤é”€å‘½ä»¤ã€‚å½“core dataåœ¨å¯¹ä½ appæ•°æ®çš„æ”¹å˜è¿›è¡Œä¿å­˜çš„æ—¶å€™ï¼Œcore dataä¼šæŠŠè¿™äº›æ•°æ®å½’æ¡£ï¼Œå¹¶æ°¸ä¹…æ€§ä¿å­˜ã€‚å®ƒä¿å­˜çš„æ•°æ®åœ¨ä¸€äº›å¸¸è§„çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨Finderä¸­å¯ä»¥è¿›è¡Œç®¡ç†ï¼Œç”¨spotlightè¿›è¡Œæœç´¢ï¼Œå¤‡ä»½åˆ° cdï¼Œå’Œemailç»™æœ‹å‹æˆ–è€…å®¶äººã€‚</p>

<p>åœ¨ä½¿ç”¨core dataæ¡†æ¶çš„æ—¶å€™ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç®¡ç†å¯¹è±¡çš„æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æä¾›äº†å¯¹æ¨¡å‹å¯¹è±¡çš„æŠ½è±¡å®šä¹‰ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€çŸ¥é“çš„entitiesï¼Œå®ƒå¯ä»¥åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ä½¿ç”¨ã€‚</p>

<p>core dataæ˜¯ä¸€ä¸ªå®ä½“-å…³ç³»æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ˜¯ä½¿ç”¨Xcodeçš„æ•°æ®æ¨¡å‹è®¾è®¡å·¥å…·æ¥å®šä¹‰çš„ï¼Œå¯¹æ•°æ®å®ä½“ä»¥åŠä»–ä»¬çš„å…³ç³»æä¾›äº†ä¸°å¯Œçš„ç¯å¢ƒã€‚</p>

<p>sqlite</p>

<p>mac os xä¸­sqliteåº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§åŠŸèƒ½å¼ºå¤§çš„å…³ç³»æ•°æ®å¼•æ“ï¼Œä¹Ÿå¾ˆå®¹æ˜“åµŒå…¥åˆ°åº”ç”¨ç¨‹åºã€‚å¯ä»¥åœ¨å¤šä¸ªå¹³å°ä½¿ç”¨ï¼Œsqliteæ˜¯ä¸€ä¸ªè½»é‡çº§çš„åµŒå…¥å¼sqlæ•°æ®åº“ç¼–ç¨‹ã€‚ä¸core dataæ¡†æ¶ä¸åŒçš„æ˜¯ï¼Œsqliteæ˜¯ä½¿ç”¨ç¨‹åºå¼çš„ï¼Œsqlçš„ä¸»è¦çš„APIæ¥ç›´æ¥æ“ä½œæ•°æ®è¡¨ã€‚</p>

<p>fmdb
FMDBæ¡†æ¶å…¶å®åªæ˜¯ä¸€å±‚å¾ˆè–„çš„å°è£…ï¼Œä¸»è¦çš„ç±»ä¹Ÿå°±ä¸¤ä¸ªï¼šFMDatabaseå’ŒFMResultSetã€‚åœ¨ä½¿ç”¨fmdbçš„æ—¶å€™è¿˜éœ€è¦å¯¼å…¥libsqlite3.0.dylibã€‚</p>

<p>core dataå…è®¸ç”¨æˆ·ä½¿ç”¨ä»£è¡¨å®ä½“å’Œå®ä½“é—´å…³ç³»çš„é«˜å±‚å¯¹è±¡æ¥æ“ä½œæ•°æ®ã€‚å®ƒä¹Ÿå¯ä»¥ç®¡ç†ä¸²è¡ŒåŒ–çš„æ•°æ®ï¼Œæä¾›å¯¹è±¡ç”Ÿå­˜æœŸç®¡ç†ä¸object_graph ç®¡ç†ï¼ŒåŒ…æ‹¬å­˜å‚¨ã€‚Core Dataç›´æ¥ä¸Sqliteäº¤äº’ï¼Œé¿å…å¼€å‘è€…ä½¿ç”¨åŸæœ¬çš„SQLè¯­å¥.</p>

<p>ä¸Šé¢çš„ä¸‰ç§ï¼Œéƒ½æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å‘¢ï¼Ÿ
åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™å°½é‡ä½¿ç”¨core dataï¼Œè¿™æ ·æ‰æ˜¯æœ€ä¼˜çš„é€‰æ‹©ã€‚
è‡³äºsqliteå’Œfmdbçš„ä½¿ç”¨æƒ…å†µï¼Œè¿™ä¸ªçœ‹ä¸ªäººå–œå¥½äº†ï¼Œä¸ªäººè§‰å¾—æ²¡ä»€ä¹ˆæ ‡å‡†ã€‚fmdbå°±æ˜¯å¯¹sqliteçš„å°è£…ï¼Œä½¿ç”¨èµ·æ¥æœ‰æ–¹ä¾¿çš„æ¥å£ï¼Œæ²¡é‚£ä¹ˆéº»çƒ¦è€Œå·²ã€‚</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/05/xsqlyucoredata/">CoreData vs SQLite</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-05T14:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:59 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>å‡­è‰¯å¿ƒè®²ï¼Œæˆ‘ä¸èƒ½å‘Šè¯‰ä½ ä¸å»ä½¿ç”¨Core Dataã€‚å®ƒä¸é”™ï¼Œè€Œä¸”ä¹Ÿåœ¨å˜å¥½ï¼Œå¹¶ä¸”å®ƒè¢«å¾ˆå¤šå…¶ä»–Cocoaå¼€å‘è€…æ‰€ç†è§£ï¼Œå½“æœ‰æ–°äººåŠ å…¥ä½ çš„ç»„æˆ–è€…éœ€è¦åˆ«äººæ¥æ‰‹ä½ çš„é¡¹ç›®çš„æ—¶å€™ï¼Œè¿™ç‚¹å¾ˆé‡è¦ã€‚</p>

<p>æ›´é‡è¦çš„æ˜¯ï¼Œä¸å€¼å¾—èŠ±æ—¶é—´å’Œç²¾åŠ›å»å†™è‡ªå·±çš„ç³»ç»Ÿå»ä»£æ›¿å®ƒã€‚çœŸçš„ï¼Œä½¿ç”¨Core Dataå§ã€‚</p>

<p>ä¸ºä»€ä¹ˆæˆ‘ä¸ä½¿ç”¨Core Data<br/>
 Mike Ashå†™åˆ°ï¼šå°±æˆ‘è‡ªå·±è€Œè¨€ï¼Œæˆ‘ä¸æ˜¯ä¸ªç‹‚çƒ­ç²‰ä¸ã€‚æˆ‘å‘ç°APIæ˜¯ç¬¨æ‹™çš„ï¼Œå¹¶ä¸”æ¡†æ¶æœ¬èº«å¯¹äºå¤§é‡çš„æ•°æ®æ˜¯æå…¶ç¼“æ…¢çš„ã€‚</p>

<p>ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š10,000æ¡ç›®
æƒ³è±¡ä¸€ä¸ªRSSé˜…è¯»å™¨ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥åœ¨ä¸€ä¸ªfeedä¸Šç‚¹å‡»å³é”®ï¼Œå¹¶ä¸”é€‰æ‹©æ ‡è®°æ‰€æœ‰ä¸ºå·²è¯»ã€‚</p>

<p>å¼•æ“ä¸‹ï¼Œæœ‰ä¸€ä¸ªå¸¦æœ‰readå±æ€§çš„Articleå®ä½“ã€‚æŠŠæ‰€æœ‰æ¡ç›®æ ‡è®°ä¸ºå·²è¯»ï¼Œç¨‹åºéœ€è¦åŠ è½½è¿™ä¸ªfeedçš„æ‰€æœ‰æ–‡ç« (å¯èƒ½é€šè¿‡ä¸€å¯¹å¤šçš„å…³ç³»)ï¼Œç„¶åè®¾ç½®readå±æ€§ä¸ºYESã€‚</p>

<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™æ ·æ²¡å…³ç³»ã€‚ä½†æ˜¯è®¾æƒ³é‚£ä¸ªfeedé‡Œæœ‰200ä¸ªæ–‡ç« ï¼Œä¸ºäº†é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½ å¯èƒ½è€ƒè™‘åœ¨åå°çº¿ç¨‹é‡Œåšè¿™ä¸ªå·¥ä½œ(ç‰¹åˆ«å½“ä½ çš„ç¨‹åºæ˜¯ä¸€ä¸ªiPhoneåº”ç”¨)ã€‚å½“ä½ ä¸€å¼€å§‹ä½¿ç”¨Core Dataå¤šçº¿ç¨‹ï¼Œäº‹æƒ…å°±å¼€å§‹å˜çš„ä¸å¥½å¤„ç†äº†ã€‚</p>

<p>è¿™å¯èƒ½è¿˜å‡‘åˆï¼Œè‡³å°‘ä¸å€¼å¾—åˆ‡æ¢èµ°Core Dataã€‚</p>

<p>ä½†æ˜¯æ¥ä¸‹æ¥åŠ åŒæ­¥ã€‚</p>

<p>æˆ‘ç”¨è¿‡ä¸¤ç§ä¸åŒçš„è·å–å·²è¯»æ–‡ç« IDåˆ—è¡¨çš„RSSåŒæ­¥æ¥å£ã€‚å…¶ä¸­ä¸€ä¸ªè¿”å›è¿‘10,000ä¸ªIDã€‚</p>

<p>ä½ ä¸ä¼šæ‰“ç®—åœ¨ä¸»çº¿ç¨‹ä¸­åŠ è½½10,000ä¸ªæ–‡ç« ï¼Œç„¶åè®¾ç½®readä¸ºNOã€‚ä½ ç”šè‡³ä¸æƒ³åœ¨åå°çº¿ç¨‹é‡ŒåŠ è½½10,000ä¸ªæ–‡ç« ï¼Œå³ä½¿å¾ˆå°å¿ƒçš„ç®¡ç†å†…å­˜ï¼Œè¿™æœ‰å¤ªå¤šçš„å·¥ä½œï¼ˆå¦‚æœä½ é¢‘ç¹çš„è¿™ä¹ˆåšï¼Œæƒ³ä¸€ä¸‹å¯¹ç”µæ± å¯¿å‘½çš„å½±å“ï¼‰ã€‚</p>

<p>ä½ çœŸæ­£æƒ³è¦åšçš„æ˜¯ï¼Œè®©æ•°æ®åº“ç»™åœ¨IDåˆ—è¡¨é‡Œçš„æ¯ä¸€ä¸ªæ–‡ç« è®¾ç½®readä¸ºYESã€‚</p>

<p>SQLiteå¯ä»¥åšåˆ°è¿™ä¸ªï¼Œåªç”¨ä¸€æ¬¡è°ƒç”¨ã€‚å‡è®¾uniqueIDä¸Šæœ‰ç´¢å¼•ï¼Œè¿™ä¼šå¾ˆå¿«ã€‚è€Œä¸”ä½ å¯ä»¥åœ¨åå°çº¿ç¨‹æ‰§è¡Œåƒåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä¸€æ ·å®¹æ˜“ã€‚</p>

<p>å¦ä¸€ä¸ªä¾‹å­ï¼šå¿«é€Ÿå¯åŠ¨
æˆ‘æƒ³å‡å°‘æˆ‘çš„å¦ä¸€ä¸ªç¨‹åºçš„å¯åŠ¨æ—¶é—´ï¼Œä¸åªæ˜¯å¼€å§‹çš„æ—¶é—´ï¼Œè€Œæ˜¯åœ¨æ•°æ®æ˜¾ç¤ºä¹‹å‰çš„æ‰€æœ‰æ—¶é—´ã€‚</p>

<p>é‚£æ˜¯ä¸ªç±»ä¼¼Twitterçš„åº”ç”¨(è™½ç„¶å®ƒä¸æ˜¯)ï¼Œå®ƒæ˜¾ç¤ºæ¶ˆæ¯çš„æ—¶é—´è½´ã€‚æ˜¾ç¤ºæ—¶é—´è½´æ„å‘³ç€è·å–æ¶ˆæ¯ï¼ŒåŠ è½½ç›¸å…³ç”¨æˆ·ã€‚å®ƒå¾ˆå¿«ï¼Œä½†æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå¡«å……UIï¼Œç„¶åå¡«å……æ•°æ®ã€‚</p>

<p>å…³äºiPhoneçš„åº”ç”¨ï¼ˆæˆ–è€…æ‰€æœ‰åº”ç”¨ï¼‰æˆ‘çš„ç†è®ºæ˜¯ï¼Œå¯åŠ¨æ—¶é—´å¾ˆé‡è¦ï¼Œæ¯”å…¶ä»–å¤§éƒ¨åˆ†å¼€å‘è€…æƒ³çš„éƒ½è¦é‡è¦ã€‚åº”ç”¨çš„å¯åŠ¨å¾ˆæ…¢çœ‹èµ·æ¥ä¸åƒæ˜¯è¦å¯åŠ¨ä¸€æ ·ï¼Œå› ä¸ºäººä»¬æ½œæ„è¯†é‡Œè®°å¾—ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿé˜»æ­¢å¯åŠ¨åº”ç”¨çš„æƒ³æ³•ã€‚å‡å°‘å¯åŠ¨æ—¶é—´å°±å‡å°‘äº†æ‘©æ“¦ï¼Œè®©ç”¨æˆ·æ›´æœ‰å¯èƒ½ç»§ç»­ä½¿ç”¨ä½ çš„åº”ç”¨ï¼Œå¹¶ä¸”æ¨èç»™å…¶ä»–äººã€‚è¿™æ˜¯ä½ è®©ä½ çš„åº”ç”¨æˆåŠŸçš„ä¸€éƒ¨åˆ†ã€‚</p>

<p>å› ä¸ºæˆ‘ä¸ä½¿ç”¨Core Dataï¼Œæˆ‘æ‰‹è¾¹æœ‰ä¸€ä¸ªç®€å•çš„ï¼Œä¿å®ˆçš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘æŠŠtimelineï¼ˆæ¶ˆæ¯å’Œäººç‰©å¯¹è±¡ï¼‰é€šè¿‡NSCodingä¿å­˜åˆ°ä¸€ä¸ªplistæ–‡ä»¶ä¸­ã€‚å¯åŠ¨çš„æ—¶å€™å®ƒè¯»è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ›å»ºæ¶ˆæ¯å’Œäººç‰©å¯¹è±¡ï¼ŒUIä¸€å‡ºç°å°±æ˜¾ç¤ºæ—¶é—´è½´ã€‚</p>

<p>è¿™æ˜æ˜¾çš„å‡å°‘äº†å»¶è¿Ÿã€‚</p>

<p>æŠŠæ¶ˆæ¯å’Œäººç‰©å¯¹è±¡ä½œä¸ºNSManagedObjectçš„å®ä¾‹å¯¹è±¡ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå‡è®¾æˆ‘æœ‰ç¼–ç çš„å¹¶ä¸”å­˜å‚¨çš„IDså¯¹è±¡ï¼Œä½†æ˜¯é‚£æ„å‘³ç€è¯»plistç„¶åè§¦åŠæ•°æ®åº“ã€‚è¿™ç§æ–¹å¼æˆ‘å®Œå…¨é¿å…äº†æ•°æ®åº“ï¼‰ã€‚</p>

<p>åœ¨æ›´æ–°æ›´å¿«çš„æœºå™¨å‡ºæ¥å, æˆ‘å»æ‰äº†é‚£äº›ä»£ç ã€‚å›é¡¾è¿‡å»ï¼Œæˆ‘å¸Œæœ›æˆ‘å¯ä»¥æŠŠå®ƒç•™ä¸‹æ¥ã€‚</p>

<p>æˆ‘æ€ä¹ˆè€ƒè™‘è¿™ä¸ªé—®é¢˜
å½“è€ƒè™‘æ˜¯å¦ä½¿ç”¨Core Dataæ—¶ï¼Œæˆ‘è€ƒè™‘ä¸‹é¢è¿™äº›äº‹æƒ…ï¼š</p>

<p>ä¼šæœ‰éš¾ä»¥ç½®ä¿¡æ•°é‡çš„æ•°æ®å—ï¼Ÿ
å¯¹äºä¸€ä¸ªRSSé˜…è¯»å™¨æˆ–è€…Twitteråº”ç”¨ï¼Œç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼šæ˜¯çš„ã€‚æœ‰äº›äººå…³æ³¨ä¸Šç™¾ä¸ªäººã€‚ä¸€ä¸ªäººå¯èƒ½è®¢é˜…äº†ä¸Šåƒä¸ªfeedsã€‚</p>

<p>å³ä½¿ä½ çš„åº”ç”¨ä¸ä»ç½‘ç»œè·å–æ•°æ®ï¼Œä»ç„¶æœ‰å¯èƒ½è®©ç”¨æˆ·è‡ªåŠ¨æ·»åŠ æ•°æ®ã€‚å¦‚æœä½ ç”¨ä¸€ä¸ªæ”¯æŒAppleScriptçš„Macï¼Œæœ‰äº›äººä¼šå†™è„šæœ¬å»åŠ è½½éå¸¸å¤šçš„æ•°æ®ã€‚å¦‚æœé€šè¿‡web APIå»åŠ æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>

<p>ä¼šæœ‰ä¸€ä¸ªWeb APIåŒ…å«ç±»ä¼¼äºæ•°æ®åº“çš„ç»ˆç«¯å—ï¼ˆå¯¹æ¯”ç±»å¯¹è±¡ç»ˆç«¯ï¼‰ï¼Ÿ
ä¸€ä¸ªRSSåŒæ­¥APIèƒ½å¤Ÿè¿”å›ä¸€ä¸ªå·²è¯»æ–‡ç« çš„uniquelIDsåˆ—è¡¨ã€‚ä¸€ä¸ªè®°ç¬”è®°çš„åº”ç”¨çš„ä¸€ä¸ªåŒæ­¥APIå¯èƒ½è¿”å›å·²å­˜æ¡£çš„å’Œå·²åˆ é™¤çš„ç¬”è®°çš„uniquelIDsã€‚</p>

<p>ç”¨æˆ·å¯èƒ½é€šè¿‡æ“ä½œå¤„ç†å¤§é‡å¯¹è±¡å—ï¼Ÿ
åœ¨åº•å±‚ï¼Œéœ€è¦è€ƒè™‘å’Œä¹‹å‰ä¸€æ ·çš„é—®é¢˜ã€‚å½“æœ‰äººåˆ é™¤æ‰€æœ‰ä¸‹è½½çš„5ï¼Œ000ä¸ªé¢é£Ÿé£Ÿè°±ï¼Œä½ çš„é£Ÿè°±åº”ç”¨å¯ä»¥å¤šå¥½çš„å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼ˆåœ¨iPhoneä¸Šï¼Ÿï¼‰ï¼Ÿ</p>

<p>å½“æˆ‘å†³å®šä½¿ç”¨Core Dataï¼ˆæˆ‘å·²ç»å‘å¸ƒè¿‡ä½¿ç”¨Core Dataçš„åº”ç”¨ï¼‰ï¼Œæˆ‘ä¼šå°å¿ƒç•™æ„æˆ‘æ€ä¹ˆä½¿ç”¨å®ƒã€‚ä¸ºäº†å¾—åˆ°å¥½çš„æ€§èƒ½ï¼Œæˆ‘å‘ç°æˆ‘æŠŠå®ƒå½“åšä¸€ä¸ªSQLæ•°æ®åº“çš„ä¸€ä¸ªå¥‡æ€ªæ¥å£æ¥ä½¿ç”¨ï¼Œç„¶åæˆ‘çŸ¥é“æˆ‘åº”è¯¥èˆå¼ƒCore Dataï¼Œç›´æ¥ä½¿ç”¨SQLiteã€‚</p>

<p>æˆ‘æ€ä¹ˆä½¿ç”¨SQLite
æˆ‘é€šè¿‡FMDB Wrapperæ¥ä½¿ç”¨SQLiteï¼ŒFMDBæ¥è‡ªFlying Meat Softwareï¼Œç”±Gus Muelleræä¾›ã€‚</p>

<p>åŸºæœ¬æ“ä½œ
æˆ‘åœ¨iPhoneä»¥å‰ï¼ŒCore Dataä»¥å‰å°±ä½¿ç”¨è¿‡SQLiteã€‚è¿™æ˜¯å®ƒæ€ä¹ˆå·¥ä½œçš„çš„è¦ç‚¹ï¼š
1. æ‰€æœ‰æ•°æ®åº“è®¿é—®-è¯»å’Œå†™-å‘ç”Ÿåœ¨è¿ç»­çš„é˜Ÿåˆ—é‡Œï¼Œåœ¨ä¸€ä¸ªåå°çº¿ç¨‹ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­è§¦åŠæ•°æ®åº“æ˜¯ä»æ¥ä¸è¢«å…è®¸çš„ã€‚ä½¿ç”¨ä¸€ä¸ªè¿ç»­é˜Ÿåˆ—æ¥ä¿è¯æ¯ä¸€ä»¶äº‹æ˜¯æŒ‰é¡ºåºå‘ç”Ÿçš„ã€‚
2. æˆ‘å¤§é‡ä½¿ç”¨blocksæ¥è®©å¼‚æ­¥ç¨‹åºå®¹æ˜“ç‚¹ã€‚
3. æ¨¡å‹å¯¹è±¡åªå­˜åœ¨åœ¨ä¸»çº¿ç¨‹ï¼ˆä½†æœ‰ä¸¤ä¸ªé‡è¦çš„ä¾‹å¤–ï¼‰ï¼Œæ”¹å˜ä¼šè§¦å‘ä¸€ä¸ªåå°ä¿å­˜ã€‚
4. æ¨¡å‹å¯¹è±¡åˆ—å‡ºæ¥ä»–ä»¬åœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„å±æ€§ã€‚å¯èƒ½åœ¨ä»£ç é‡Œæˆ–è€…åœ¨plistæ–‡ä»¶é‡Œã€‚
5, ä¸€äº›æ¨¡å‹å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œä¸€äº›ä¸æ˜¯ã€‚å–å†³äºåº”ç”¨çš„éœ€è¦ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µæ˜¯å”¯ä¸€çš„ï¼‰ã€‚
6. å¯¹å…³ç³»å‹æ•°æ®ï¼Œæˆ‘å°½å¯èƒ½é¿å…è¿è¡¨æŸ¥è¯¢ã€‚
7. ä¸€äº›å¯¹è±¡ç±»å‹åœ¨å¯åŠ¨çš„æ—¶å€™å°±å®Œå…¨è¯»å…¥å†…å­˜ï¼Œå¦ä¸€äº›å¯¹è±¡ç±»å‹å¯èƒ½åªéœ€è¦åˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ªä»–ä»¬çš„uniqueIDsçš„ã€‚NSMutableSetï¼Œæ‰€ä»¥ä¸éœ€è¦å»è§¦åŠæ•°æ®åº“ï¼Œæˆ‘å°±çŸ¥é“å·²ç»æœ‰ä»€ä¹ˆã€‚
8. Web APIçš„è°ƒç”¨å‘ç”Ÿåœ¨åå°çº¿ç¨‹ï¼Œä»–ä»¬ä½¿ç”¨åˆ†å¼€çš„æ¨¡å‹å¯¹è±¡ã€‚
æˆ‘ä¼šé€šè¿‡æˆ‘ç°åœ¨çš„åº”ç”¨çš„ä»£ç æ¥è¯¦ç»†æè¿°ã€‚</p>

<p>æ•°æ®åº“æ›´æ–°
åœ¨æˆ‘æœ€è¿‘çš„åº”ç”¨ä¸­ï¼Œæœ‰ä¸€ä¸ªå•ä¸€çš„æ•°æ®åº“æ§åˆ¶å™¨-VSDatabaseControllerï¼Œå®ƒé€šè¿‡FMDBæ¥ä¸SQLiteå¯¹è¯ã€‚</p>

<p>FMDBåŒºåˆ†æ›´æ–°å’ŒæŸ¥è¯¢ã€‚æ›´æ–°æ•°æ®åº“ï¼Œappè°ƒç”¨ï¼š</p>

<pre><code>-[VSDatabaseController runDatabaseBlockInTransaction:(VSDatabaseUpdateBlock)databaseBlock] 
</code></pre>

<p>VSDatabaseUpdateBlockå¾ˆç®€å•ï¼š</p>

<pre><code>typedef void (^VSDatabaseUpdateBlock)(FMDatabase *database); 
</code></pre>

<p>runDatabaseBlockInTransactionä¹Ÿå¾ˆç®€å•ï¼š</p>

<pre><code>- (void)runDatabaseBlockInTransaction:(VSDatabaseUpdateBlock)databaseBlock { 
    dispatch_async(self.serialDispatchQueue, ^{ 
        @autoreleasepool { 
            [self beginTransaction]; 
            databaseBlock(self.database); 
            [self endTransaction]; 
        } 
    }); 
} 
</code></pre>

<p>ï¼ˆæ³¨æ„æˆ‘ç”¨è‡ªå·±çš„è¿ç»­è°ƒåº¦é˜Ÿåˆ—ã€‚Guså»ºè®®çœ‹ä¸€ä¸‹FMDatabaseQueueï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¿ç»­è°ƒåº¦é˜Ÿåˆ—ã€‚æˆ‘è¿˜æ²¡èƒ½å»çœ‹ä¸€ä¸‹ï¼Œå› ä¸ºå®ƒæ¯”FMDBçš„å…¶ä»–ä¸œè¥¿éƒ½è¦æ–°ã€‚ï¼‰</p>

<p>beginTransactionå’ŒendTransactionçš„è°ƒç”¨æ˜¯å¯åµŒå¥—çš„ï¼ˆåœ¨æˆ‘çš„æ•°æ®åº“æ§åˆ¶å™¨é‡Œï¼‰ã€‚åœ¨åˆé€‚çš„æ—¶å€™ä»–ä»¬ä¼šè°ƒç”¨-[FMDatabase beginTransaction] å’Œ -[FMDatabase commit]ã€‚ï¼ˆä½¿ç”¨äº‹åŠ¡æ˜¯è®©SQLiteå˜å¿«çš„å…³é”®ã€‚ï¼‰æç¤ºï¼šæˆ‘æŠŠå½“å‰äº‹åŠ¡å­˜å‚¨åœ¨-[NSThread threadDictionary]ã€‚å®ƒå¾ˆå¥½è·å–æ¯ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®ï¼Œæˆ‘å‡ ä¹ä»ä¸ç”¨å…¶ä»–çš„ã€‚</p>

<p>è¿™å„¿æœ‰ä¸ªè°ƒç”¨æ›´æ–°æ•°æ®åº“çš„ç®€å•ä¾‹å­ï¼š</p>

<pre><code>- (void)emptyTagsLookupTableForNote:(VSNote *)note { 
    NSString *uniqueID = note.uniqueID; 
    [self runDatabaseBlockInTransaction:^(FMDatabase *database) { 
        [database executeUpdate: 
            @"delete from tagsNotesLookup where noteUniqueID = ?;", uniqueID]; 
    }]; 
} 
</code></pre>

<p>è¿™è¯´æ˜ä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆSQLä¸å¯æ€•ã€‚å³ä½¿ä½ ä»æ²¡è§è¿‡å®ƒï¼Œä½ ä¹ŸçŸ¥é“è¿™è¡Œä»£ç åšäº†ä»€ä¹ˆã€‚</p>

<p>åƒVSDatabaseControllerçš„æ‰€æœ‰å…¶ä»–å…¬å…±æ¥å£ï¼ŒemptyTagsLookupTableForNoteåº”è¯¥åœ¨ä¸»çº¿ç¨‹ä¸­è¢«è°ƒç”¨ã€‚æ¨¡å‹å¯¹è±¡åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¢«å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨blockä¸­ç”¨uniqueIDï¼Œè€Œä¸æ˜¯VSNoteå¯¹è±¡ã€‚</p>

<p>æ³¨æ„åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘æ›´æ–°äº†ä¸€ä¸ªæŸ¥æ‰¾è¡¨ã€‚Noteså’Œtagsæ˜¯å¤šå¯¹å¤šå…³ç³»ï¼Œä¸€ç§è¡¨ç°æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªæ•°æ®åº“è¡¨æ˜ å°„note uniqueIDså’Œtag uniqueIDsã€‚è¿™äº›è¡¨ä¸ä¼šå¾ˆéš¾ç»´æŠ¤ï¼Œä½†æ˜¯å¦‚æœå¯èƒ½ï¼Œæˆ‘ç¡®å®å°è¯•é¿å…ä»–ä»¬çš„ä½¿ç”¨ã€‚</p>

<p>æ³¨æ„åœ¨æ›´æ–°å­—ç¬¦ä¸²ä¸­çš„?ã€‚-[FMDatabase executeUpdate:] æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ã€‚SQLiteæ”¯æŒä½¿ç”¨å ä½ç¬¦?ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æŠŠæ­£çœŸçš„å€¼æ”¾å…¥å­—ç¬¦ä¸²ã€‚è¿™å„¿æœ‰ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼šå®ƒå¸®åŠ©å®ˆæŠ¤ç¨‹åºåå¯¹SQLæ’å…¥ã€‚å¦‚æœä½ éœ€è¦é¿å¼€æŸäº›å€¼ï¼Œå®ƒä¹Ÿä¸ºä½ çœäº†éº»çƒ¦ã€‚</p>

<p>æœ€åï¼Œåœ¨tagsNotesLookupè¡¨ä¸­ï¼Œæœ‰ä¸€ä¸ªnoteUniquelIDçš„ç´¢å¼•ï¼ˆç´¢å¼•æ˜¯SQLiteæ€§èƒ½çš„åˆä¸€ä¸ªå…³é”®ï¼‰ã€‚è¿™è¡Œä»£ç åœ¨æ¯æ¬¡å¯åŠ¨æ—¶éƒ½è°ƒç”¨ï¼š</p>

<pre><code>[self.database executeUpdate: 
    @"CREATE INDEX if not exists noteUniqueIDIndex on tagsNotesLookup (noteUniqueID);"]; 
</code></pre>

<p>æ•°æ®åº“è·å–
è¦è·å–å¯¹è±¡ï¼Œappè°ƒç”¨ï¼š</p>

<pre><code>-[VSDatabaseController runFetchForClass:(Class)databaseObjectClass  
                             fetchBlock:(VSDatabaseFetchBlock)fetchBlock  
                      fetchResultsBlock:(VSDatabaseFetchResultsBlock)fetchResultsBlock]; 
</code></pre>

<p>è¿™ä¸¤è¡Œä»£ç åšäº†å¤§éƒ¨åˆ†å·¥ä½œï¼š</p>

<pre><code>FMResultSet *resultSet = fetchBlock(self.database); 
NSArray *fetchedObjects = [self databaseObjectsWithResultSet:resultSet  
                                                       class:databaseObjectClass]; 
</code></pre>

<p>ç”¨FMDBæŸ¥æ‰¾æ•°æ®åº“è¿”å›ä¸€ä¸ªFMResultSet. é€šè¿‡resultSetä½ å¯ä»¥é€å¥å¾ªç¯ï¼Œåˆ›å»ºæ¨¡å‹å¯¹è±¡ã€‚</p>

<p>æˆ‘å»ºè®®å†™é€šç”¨çš„ä»£ç å»è½¬æ¢æ•°æ®åº“è¡Œåˆ°å¯¹è±¡ã€‚ä¸€ç§æˆ‘ä½¿ç”¨çš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªplistï¼Œæ˜ å°„columnåå­—åˆ°å¯¹è±¡å±æ€§ã€‚å®ƒä¹ŸåŒ…å«ç±»å‹ï¼Œæ‰€ä»¥ä½ çŸ¥é“æ˜¯å¦éœ€è¦è°ƒç”¨ -[FMResultSet dateForColumn:]ï¼Œ -[FMResultSet stringForColumn:]æˆ–å…¶ä»–ã€‚</p>

<p>åœ¨æˆ‘çš„æœ€æ–°åº”ç”¨é‡Œæˆ‘åšäº†äº›ç®€å•çš„äº‹æƒ…ã€‚æ•°æ®åº“è¡Œåˆšå¥½å¯¹åº”æ¨¡å‹å¯¹è±¡å±æ€§çš„åå­—ã€‚æ‰€æœ‰å±æ€§éƒ½æ˜¯stringsï¼Œé™¤äº†é‚£äº›åå­—ä»¥â€œDateâ€ç»“å°¾çš„å±æ€§ã€‚å¾ˆç®€å•ï¼Œä½†æ˜¯ä½ å¯ä»¥çœ‹åˆ°éœ€è¦ä¸€ä¸ªæ¸…æ™°çš„å¯¹åº”å…³ç³»ã€‚</p>

<p>å”¯ä¸€å¯¹è±¡
åˆ›å»ºæ¨¡å‹å¯¹è±¡å’Œä»æ•°æ®åº“è·å–æ•°æ®åœ¨åŒä¸€ä¸ªåå°çº¿ç¨‹ã€‚ä¸€è·å–åˆ°ï¼Œç¨‹åºä¼šæŠŠä»–ä»¬è½¬åˆ°ä¸»çº¿ç¨‹ã€‚</p>

<p>é€šå¸¸æˆ‘æœ‰uniquedå¯¹è±¡ã€‚åŒä¸€ä¸ªæ•°æ®åº“è¡Œç»“æœå§‹ç»ˆå¯¹åº”åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>

<p>ä¸ºäº†åšåˆ°å”¯ä¸€ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ç¼“å­˜ï¼Œä¸€ä¸ªNSMapTableï¼Œåœ¨initå‡½æ•°é‡Œï¼š_objectCache = [NSMapTable weakToWeakObjectsMapTable]ã€‚æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼š</p>

<p>ä¾‹å¦‚ï¼Œå½“ä½ åšä¸€ä¸ªæ•°æ®åº“è·å–å¹¶ä¸”æŠŠå¯¹è±¡è½¬äº¤ç»™ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨ï¼Œä½ å¸Œæœ›åœ¨è§†å›¾æ§åˆ¶å™¨ä½¿ç”¨å®Œè¿™äº›å¯¹è±¡åï¼Œæˆ–è€…ä¸€ä¸ªä¸ä¸€æ ·çš„è§†å›¾æ§åˆ¶å™¨æ˜¾ç¤ºäº†ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥æ¶ˆå¤±ã€‚</p>

<p>å¦‚æœä½ çš„å¯¹è±¡ç¼“å­˜æ˜¯ä¸€ä¸ªNSMutableDictionaryï¼Œä½ å°†éœ€è¦åšä¸€äº›é¢å¤–çš„å·¥ä½œæ¥æ¸…ç©ºç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚ç¡®å®šå®ƒå¯¹åº”çš„å¯¹è±¡åœ¨åˆ«çš„åœ°æ–¹æ˜¯å¦æœ‰å¼•ç”¨å°±å˜çš„å¾ˆç—›è‹¦ã€‚NSMapTableæ˜¯å¼±å¼•ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p>

<p>æ‰€ä»¥ï¼šæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­è®©å¯¹è±¡å”¯ä¸€ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å·²ç»åœ¨å¯¹è±¡ç¼“å­˜ä¸­å­˜åœ¨ï¼Œæˆ‘ä»¬å°±ç”¨é‚£ä¸ªå­˜åœ¨çš„å¯¹è±¡ã€‚ï¼ˆä¸»çº¿ç¨‹èƒœå‡ºï¼Œå› ä¸ºå®ƒå¯èƒ½æœ‰æ–°çš„æ”¹å˜ã€‚ï¼‰å¦‚æœå¯¹è±¡ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå®ƒä¼šè¢«åŠ ä¸Šã€‚</p>

<p>ä¿æŒå¯¹è±¡åœ¨å†…å­˜ä¸­
æœ‰å¾ˆå¤šæ¬¡ï¼ŒæŠŠæ•´ä¸ªå¯¹è±¡ç±»å‹ä¿ç•™åœ¨å†…å­˜ä¸­æ˜¯æœ‰é“ç†çš„ã€‚æˆ‘æœ€æ–°çš„appæœ‰ä¸€ä¸ªVSTagå¯¹è±¡ã€‚è™½ç„¶å¯èƒ½æœ‰æˆç™¾ä¸Šåƒä¸ªç¬”è®°ï¼Œä½†tagsçš„æ•°é‡å¾ˆå°ï¼ŒåŸºæœ¬å°‘äº10ã€‚ä¸€ä¸ªtagåªæœ‰6ä¸ªå±æ€§ï¼š3ä¸ªBOOLï¼Œä¸¤ä¸ªå¾ˆå°çš„NSstringï¼Œè¿˜æœ‰ä¸€ä¸ªNSDateã€‚</p>

<p>å¯åŠ¨çš„æ—¶å€™ï¼Œappè·å–æ‰€æœ‰tagså¹¶ä¸”æŠŠä»–ä»¬ä¿å­˜åœ¨ä¸¤ä¸ªå­—å…¸é‡Œï¼Œä¸€ä¸ªä¸»é”®æ˜¯tagçš„uniqueIDï¼Œå¦ä¸€ä¸ªä¸»é”®æ˜¯tagåå­—çš„å°å†™ã€‚</p>

<p>è¿™ç®€åŒ–äº†å¾ˆå¤šäº‹ï¼Œä¸åªæ˜¯tagè‡ªåŠ¨è¡¥å…¨ç³»ç»Ÿï¼Œè¿™ä¸ªå¯ä»¥å®Œå…¨åœ¨å†…å­˜ä¸­æ“ä½œï¼Œä¸éœ€è¦æ•°æ®åº“è·å–ã€‚</p>

<p>ä½†æ˜¯å¾ˆå¤šæ¬¡ï¼ŒæŠŠæ‰€æœ‰æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­æ˜¯ä¸å®é™…çš„ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸ä¼šåœ¨å†…å­˜ä¸­ä¿ç•™æ‰€æœ‰ç¬”è®°ã€‚</p>

<p>ä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šæ¬¡ï¼Œå½“ä¸èƒ½åœ¨å†…å­˜ä¸­ä¿ç•™å¯¹è±¡æ—¶ï¼Œä½ å¸Œæœ›åœ¨å†…å­˜ä¸­ä¿ç•™æ‰€æœ‰uniqueIDsã€‚ä½ ä¼šåƒè¿™æ ·åšä¸€ä¸ªè·å–ï¼š</p>

<pre><code>FMResultSet *resultSet = [self.database executeQuery:@"select uniqueID from some_table"]; 
</code></pre>

<p>resultSetåªåŒ…å«äº†uniqueIDsï¼Œ ä½ å¯ä»¥å­˜å‚¨åˆ°ä¸€ä¸ªNSMutableSeté‡Œã€‚</p>

<p>æˆ‘å‘ç°æœ‰æ—¶è¿™ä¸ªå¯¹web APIså¾ˆæœ‰ç”¨ã€‚æƒ³è±¡ä¸€ä¸ªAPIè°ƒç”¨è¿”å›ä»æŸä¸ªç¡®å®šçš„æ—¶é—´ä»¥åçš„ï¼Œå·²åˆ›å»ºç¬”è®°çš„uniqueIDsåˆ—è¡¨ã€‚å¦‚æœæˆ‘æœ¬åœ°å·²ç»æœ‰äº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç¬”è®°uniqueIDsçš„NSMutableSetï¼Œæˆ‘å¯ä»¥å¿«é€Ÿæ£€æŸ¥(é€šè¿‡ -[NSMutableSet minusSet])æ˜¯å¦æœ‰æ¼æ‰çš„ç¬”è®°ï¼Œç„¶åå»è°ƒç”¨å¦ä¸€ä¸ªAPIä¸‹è½½é‚£äº›æ¼æ‰çš„ç¬”è®°ã€‚è¿™äº›å®Œå…¨ä¸éœ€è¦è§¦åŠæ•°æ®åº“ã€‚</p>

<p>ä½†æ˜¯ï¼Œåƒè¿™æ ·çš„äº‹æƒ…åº”è¯¥å°å¿ƒå¤„ç†ã€‚appå¯ä»¥æä¾›è¶³å¤Ÿçš„å†…å­˜å—ï¼Ÿå®ƒçœŸçš„ç®€åŒ–ç¼–ç¨‹å¹¶ä¸”æé«˜æ€§èƒ½äº†å—ï¼Ÿ</p>

<p>ç”¨SQLiteå’ŒFMDBè€Œä¸æ˜¯Core Dataï¼Œç»™ä½ å¸¦æ¥å¤§é‡çš„çµæ´»æ€§å’Œèªæ˜è§£å†³åŠæ³•çš„ç©ºé—´ã€‚è®°ä½æœ‰çš„æ—¶å€™èªæ˜æ˜¯å¥½çš„ï¼Œä¹Ÿæœ‰çš„æ—¶å€™èªæ˜æ˜¯ä¸€ä¸ªå¤§é”™è¯¯ã€‚</p>

<p>Web APIs
æˆ‘çš„APIè°ƒç”¨åœ¨åå°è¿›ç¨‹ï¼ˆç»å¸¸ç”¨ä¸€ä¸ªNSOperationQueueï¼Œæ‰€ä»¥æˆ‘å¯ä»¥å–æ¶ˆæ“ä½œï¼‰ã€‚æ¨¡å‹å¯¹è±¡åªåœ¨ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯æˆ‘è¿˜ä¼ é€’æ¨¡å‹å¯¹è±¡ç»™æˆ‘çš„APIè°ƒç”¨ã€‚</p>

<p>æ˜¯è¿™æ ·çš„ï¼šä¸€ä¸ªæ•°æ®åº“å¯¹è±¡æœ‰ä¸€ä¸ªdetachedCopyæ–¹æ³•ï¼Œå¯ä»¥å¤åˆ¶æ•°æ®åº“å¯¹è±¡ã€‚è¿™ä¸ªå¤åˆ¶å¯¹è±¡ä¸æ˜¯å¼•ç”¨è‡ªæˆ‘ç”¨æ¥å”¯ä¸€åŒ–çš„å¯¹è±¡ç¼“å­˜ã€‚å”¯ä¸€å¼•ç”¨é‚£ä¸ªå¯¹è±¡çš„åœ°æ–¹æ˜¯APIè°ƒç”¨ï¼Œå½“APIè°ƒç”¨ç»“æŸï¼Œé‚£ä¸ªå¤åˆ¶çš„å¯¹è±¡å°±æ¶ˆå¤±äº†ã€‚</p>

<p>è¿™æ˜¯ä¸€ä¸ªå¥½çš„ç³»ç»Ÿï¼Œå› ä¸ºå®ƒæ„å‘³ç€æˆ‘å¯ä»¥åœ¨APIè°ƒç”¨é‡Œä½¿ç”¨æ¨¡å‹å¯¹è±¡ã€‚æ–¹æ³•çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>

<pre><code>- (void)uploadNote:(VSNote *)note { 
    VSNoteAPICall *apiCall = [[VSNoteAPICall alloc] initWithNote:[note detachedCopy]]; 
    [self enqueueAPICall:apiCall]; 
} 
</code></pre>

<p>VSNoteAPICallä»å¤åˆ¶çš„VSNoteè·å–å€¼ï¼Œå¹¶ä¸”åˆ›å»ºHTTPè¯·æ±‚ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—å…¸æˆ–å…¶ä»–ç¬”è®°çš„è¡¨ç°å½¢å¼ã€‚</p>

<p>å¤„ç†Web APIè¿”å›å€¼
æˆ‘å¯¹webè¿”å›å€¼åšäº†ä¸€äº›ç±»ä¼¼çš„äº‹æƒ…ã€‚æˆ‘ä¼šå¯¹è¿”å›çš„JSONæˆ–è€…XMLåˆ›å»ºä¸€ä¸ªæ¨¡å‹å¯¹è±¡ï¼Œè¿™ä¸ªæ¨¡å‹å¯¹è±¡ä¹Ÿæ˜¯åˆ†ç¦»çš„ã€‚å®ƒä¸æ˜¯å­˜å‚¨åœ¨ä¸ºäº†å”¯ä¸€æ€§çš„æ¨¡å‹ç¼“å­˜é‡Œã€‚</p>

<p>è¿™å„¿æœ‰äº›äº‹æƒ…æ˜¯ä¸ç¡®å®šçš„ã€‚æœ‰æ—¶æœ‰å¿…è¦ç”¨é‚£ä¸ªæ¨¡å‹å¯¹è±¡åœ¨ä¸¤ä¸ªåœ°æ–¹åšæœ¬åœ°ä¿®æ”¹ï¼šåœ¨å†…å­˜ç¼“å­˜å’Œæ•°æ®åº“ã€‚</p>

<p>æ•°æ®åº“é€šå¸¸æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚æ¯”å¦‚ï¼šæˆ‘çš„åº”ç”¨å·²ç»æœ‰ä¸€ä¸ªæ–¹æ³•æ¥ä¿å­˜ç¬”è®°å¯¹è±¡ã€‚å®ƒç”¨ä¸€ä¸ªSQL insertæˆ–è€…replaceå­—ç¬¦ä¸²ã€‚æˆ‘åªéœ€è°ƒç”¨é‚£ä¸ªä»web APIè¿”å›å€¼ç”Ÿæˆçš„ç¬”è®°å¯¹è±¡ï¼Œæ•°æ®åº“å°±ä¼šæ›´æ–°ã€‚</p>

<p>ä½†æ˜¯å¯èƒ½é‚£ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„ç‰ˆæœ¬ï¼Œå¹¸è¿çš„æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“æ‰¾åˆ°ï¼š</p>

<pre><code>VSNote *cachedNote = [self.mapTable objectForKey:downloadedNote.uniqueID]; 
</code></pre>

<p>å¦‚æœcachedNoteå­˜åœ¨ï¼Œæˆ‘ä¼šè®©å®ƒä»downloadedNoteä¸­è·å–å€¼ï¼Œè€Œä¸æ˜¯æ›¿æ¢å®ƒï¼ˆè¿™æ ·å¯èƒ½è¿åå”¯ä¸€æ€§ï¼‰ã€‚è¿™å¯ä»¥å…±äº«detachedCopyæ–¹æ³•çš„ä»£ç ã€‚</p>

<p>ä¸€æ—¦cachedNoteæ›´æ–°äº†ï¼Œè§‚å¯Ÿè€…ä¼šé€šè¿‡KVOé€šçŸ¥ç¬”è®°ï¼Œæˆ–è€…æˆ‘ä¼šå‘é€ä¸€ä¸ªNSNotificationï¼Œæˆ–è€…ä¸¤è€…éƒ½åšã€‚</p>

<p>Web APIè°ƒç”¨ä¹Ÿä¼šè¿”å›ä¸€äº›å…¶ä»–å€¼ã€‚æˆ‘æåˆ°è¿‡RSSé˜…è¯»å™¨å¯èƒ½è·å¾—ä¸€ä¸ªå·²è¯»æ¡ç›®çš„å¤§åˆ—è¡¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ç”¨é‚£ä¸ªåˆ—è¡¨åˆ›å»ºäº†ä¸€ä¸ªNSSetï¼Œåœ¨å†…å­˜ä¸­æ›´æ–°æ¯ä¸€ä¸ªç¼“å­˜æ–‡ç« çš„readå±æ€§ï¼Œç„¶åè°ƒç”¨-[FMDatabase executeUpdate:]ã€‚</p>

<p>è®©å®ƒå·¥ä½œå¿«é€Ÿçš„å…³é”®æ˜¯NSMapTableçš„æŸ¥æ‰¾æ˜¯å¿«é€Ÿçš„ã€‚å¦‚æœä½ æ‰¾çš„å¯¹è±¡åœ¨ä¸€ä¸ªNSArrayé‡Œï¼Œæˆ‘ä»¬è¯¥é‡æ–°è€ƒè™‘ã€‚</p>

<p>æ•°æ®åº“è¿ç§»
Core Dataçš„æ•°æ®åº“è¿ç§»å¾ˆé…·ï¼Œå½“å®ƒå¯è¡Œçš„æ—¶å€™ã€‚ä½†æ˜¯ä¸å¯é¿å…çš„ï¼Œå®ƒæ˜¯ä»£ç å’Œæ•°æ®åº“ä¸­çš„ä¸€å±‚ã€‚å¦‚æœä½ è¶Šç›´æ¥ä½¿ç”¨SQLiteï¼Œä½ æ›´æ–°æ•°æ®åº“è¶Šç›´æ¥ã€‚ä½ å¯ä»¥å®‰å…¨å®¹æ˜“çš„åšåˆ°è¿™ç‚¹ã€‚</p>

<p>æ¯”å¦‚åŠ ä¸€ä¸ªè¡¨ï¼š</p>

<pre><code>[self.database executeUpdate:@"CREATE TABLE if not exists tags " 
    "(uniqueID TEXT UNIQUE, name TEXT, deleted INTEGER, deletedModificationDate DATE);"]; 
</code></pre>

<p>æˆ–è€…åŠ ä¸€ä¸ªç´¢å¼•ï¼š</p>

<pre><code>[self.database executeUpdate:@"CREATE INDEX if not exists " 
    "archivedSortDateIndex on notes (archived, sortDate);"]; 
</code></pre>

<p>æˆ–è€…åŠ ä¸€åˆ—ï¼š</p>

<pre><code>[self.database executeUpdate:@"ALTER TABLE tags ADD deletedDate DATE"]; 
</code></pre>

<p>åº”ç”¨åº”è¯¥åœ¨ä»£ç çš„ç¬¬ä¸€ä¸ªåœ°æ–¹ç”¨ä¸Šé¢è¿™äº›ä»£ç è®¾ç½®æ•°æ®åº“ã€‚ä»¥åçš„æ”¹å˜åªéœ€åŠ executeUpdateçš„è°ƒç”¨ â€” æˆ‘è®©ä»–ä»¬æŒ‰é¡ºåºæ‰§è¡Œã€‚å› ä¸ºæˆ‘çš„æ•°æ®åº“æ˜¯æˆ‘è®¾è®¡çš„ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆæˆ‘ä»æ²¡ç¢°åˆ°æ€§èƒ½é—®é¢˜ï¼Œå®ƒå¾ˆå¿«ï¼‰ã€‚</p>

<p>å½“ç„¶å¤§çš„æ”¹å˜éœ€è¦æ›´å¤šä»£ç ã€‚å¦‚æœä½ çš„æ•°æ®é€šè¿‡webè·å–ï¼Œæœ‰æ—¶ä½ å¯ä»¥ä»ä¸€ä¸ªæ–°æ•°æ®åº“æ¨¡å‹å¼€å§‹ï¼Œé‡æ–°ä¸‹è½½ä½ éœ€è¦çš„æ•°æ®ã€‚</p>

<p>æ€§èƒ½æŠ€å·§
SQLiteå¯ä»¥éå¸¸éå¸¸å¿«ï¼Œå®ƒä¹Ÿå¯ä»¥éå¸¸æ…¢ã€‚å®Œå…¨å–å†³äºä½ æ€ä¹ˆä½¿ç”¨å®ƒã€‚</p>

<p>äº‹åŠ¡
æŠŠæ›´æ–°åŒ…è£…åœ¨äº‹åŠ¡é‡Œã€‚åœ¨æ›´æ–°å‰è°ƒç”¨ -[FMDatabase beginTransaction] ï¼Œæ›´æ–°åè°ƒç”¨-[FMDatabase commit]ã€‚</p>

<p>å¦‚æœä½ ä¸å¾—ä¸åè§„èŒƒåŒ–ï¼ˆ Denormalizeï¼‰
åè§„èŒƒåŒ–è®©äººå¾ˆä¸çˆ½ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ï¼Œä¸ºäº†åŠ é€Ÿæ£€ç´¢è€Œæ·»åŠ å†—ä½™æ•°æ®ï¼Œä½†æ˜¯å®ƒæ„å‘³ç€ä½ éœ€è¦ç»´æŠ¤å†—ä½™æ•°æ®ã€‚</p>

<p>æˆ‘æ€»æ˜¯ç–¯ç‹‚é¿å…å®ƒï¼Œç›´åˆ°è¿™æ ·èƒ½æœ‰ä¸¥é‡çš„æ€§èƒ½åŒºåˆ«ã€‚ç„¶åæˆ‘ä¼šå°½å¯èƒ½å°‘å¾—è¿™ä¹ˆåšã€‚</p>

<p>ä½¿ç”¨ç´¢å¼•
æˆ‘çš„åº”ç”¨ä¸­tagsè¡¨çš„åˆ›å»ºè¯­å¥åƒè¿™æ ·ï¼š</p>

<pre><code>CREATE TABLE if not exists tags  
  (uniqueID TEXT UNIQUE, name TEXT, deleted INTEGER, deletedModificationDate DATE); 
</code></pre>

<p>uniqueIDåˆ—æ˜¯è‡ªåŠ¨ç´¢å¼•çš„ï¼Œå› ä¸ºå®ƒå®šä¹‰ä¸ºuniqueã€‚ä½†æ˜¯å¦‚æœæˆ‘æƒ³ç”¨nameæ¥æŸ¥è¯¢è¡¨ï¼Œæˆ‘å¯èƒ½ä¼šåœ¨nameä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œåƒè¿™æ ·ï¼š</p>

<pre><code>CREATE INDEX if not exists tagNameIndex on tags (name); 
</code></pre>

<p>ä½ å¯ä»¥ä¸€æ¬¡æ€§åœ¨å¤šåˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œåƒè¿™æ ·ï¼š</p>

<pre><code>CREATE INDEX if not exists archivedSortDateIndex on notes (archived, sortDate); 
</code></pre>

<p>ä½†æ˜¯æ³¨æ„å¤ªå¤šç´¢å¼•ä¼šé™ä½ä½ çš„æ’å…¥é€Ÿåº¦ã€‚ä½ åªéœ€è¦è¶³å¤Ÿæ•°é‡å¹¶ä¸”æ˜¯å¯¹çš„é‚£äº›ã€‚</p>

<p>ä½¿ç”¨å‘½ä»¤è¡Œåº”ç”¨
å½“æˆ‘çš„appåœ¨æ¨¡æ‹Ÿå™¨é‡Œè¿è¡Œæ—¶ï¼Œæˆ‘ä¼šæ‰“å°æ•°æ®åº“çš„è·¯å¾„ã€‚æˆ‘å¯ä»¥é€šè¿‡sqlite3çš„å‘½ä»¤è¡Œæ¥æ‰“å¼€æ•°æ®åº“ã€‚ï¼ˆé€šè¿‡man sqlite3å‘½ä»¤æ¥äº†è§£è¿™ä¸ªåº”ç”¨çš„æ›´å¤šä¿¡æ¯ï¼‰ã€‚</p>

<p>æ‰“å¼€æ•°æ®åº“çš„å‘½ä»¤ï¼šsqlite3 â€œæ•°æ®åº“çš„è·¯å¾„â€ã€‚</p>

<p>æ‰“å¼€ä»¥åï¼Œä½ å¯ä»¥çœ‹schema: type .schemaã€‚</p>

<p>ä½ å¯ä»¥æ›´æ–°å’ŒæŸ¥è¯¢ï¼Œè¿™æ˜¯åœ¨ä½¿ç”¨ä½ çš„appä¹‹å‰æ£€æŸ¥SQLæ˜¯å¦æ­£ç¡®çš„å¾ˆå¥½çš„æ–¹å¼ã€‚</p>

<p>è¿™é‡Œé¢æœ€é…·çš„ä¸€éƒ¨åˆ†æ˜¯ï¼ŒSQLite Explain Query Planå‘½ä»¤ï¼Œä½ ä¼šå¸Œæœ›ç¡®ä¿ä½ çš„è¯­å¥æ‰§è¡Œçš„å°½å¯èƒ½å¿«ã€‚</p>

<p>çœŸå®çš„ä¾‹å­
æˆ‘çš„åº”ç”¨æ˜¾ç¤ºæ‰€æœ‰æ²¡æœ‰å½’æ¡£ç¬”è®°çš„æ ‡ç­¾åˆ—è¡¨ã€‚æ¯å½“ç¬”è®°æˆ–è€…æ ‡ç­¾æœ‰å˜åŒ–ï¼Œè¿™ä¸ªæŸ¥è¯¢å°±ä¼šé‡æ–°æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å®ƒéœ€è¦å¾ˆå¿«ã€‚</p>

<p>æˆ‘å¯ä»¥ç”¨SQL joinæ¥æŸ¥è¯¢ï¼Œä½†æ˜¯å¾ˆæ…¢ï¼ˆjoinséƒ½å¾ˆæ…¢ï¼‰ã€‚</p>

<p>æ‰€ä»¥æˆ‘æ”¾å¼ƒsqlite3å¹¶å¼€å§‹å°è¯•åˆ«çš„æ–¹æ³•ã€‚æˆ‘åˆçœ‹äº†ä¸€æ¬¡æˆ‘çš„schemaï¼Œæ„è¯†åˆ°æˆ‘å¯ä»¥åè§„èŒƒåŒ–ã€‚ä¸€ä¸ªç¬”è®°çš„å½’æ¡£çŠ¶æ€å¯ä»¥å­˜å‚¨åœ¨notesè¡¨é‡Œï¼Œå®ƒä¹Ÿå¯ä»¥å­˜å‚¨åœ¨tagsNotesLookupè¡¨ã€‚</p>

<p>ç„¶åæˆ‘å¯ä»¥æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼š</p>

<pre><code>select distinct tagUniqueID from tagsNotesLookup where archived=0; 
</code></pre>

<p>æˆ‘å·²ç»æœ‰äº†ä¸€ä¸ªåœ¨tagUniqueIDä¸Šçš„ç´¢å¼•ã€‚æ‰€ä»¥æˆ‘ç”¨explain query planæ¥å‘Šè¯‰æˆ‘å½“æˆ‘æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>

<pre><code>sqlite&gt; explain query plan select distinct tagUniqueID from tagsNotesLookup where archived=0; 
0|0|0|SCAN TABLE tagsNotesLookup USING INDEX tagUniqueIDIndex (~100000 rows) 
</code></pre>

<p>å®ƒç”¨äº†ä¸€ä¸ªç´¢å¼•ï¼Œä½†æ˜¯SCAN TABLEå¬èµ·æ¥ä¸å¤ªå¥½ï¼Œæœ€å¥½æ˜¯ä¸€ä¸ªSEARCH TABLEå¹¶ä¸”è¦†ç›–ä¸€ä¸ªç´¢å¼•ã€‚
æˆ‘åœ¨tagUniqueIDå’Œarchiveä¸Šå»ºäº†ç´¢å¼•ï¼š</p>

<pre><code>CREATE INDEX archivedTagUniqueID on tagsNotesLookup(archived, tagUniqueID); 
</code></pre>

<p>å†æ¬¡æ‰§è¡Œexplain query plan:</p>

<pre><code>sqlite&gt; explain query plan select distinct tagUniqueID from tagsNotesLookup where archived=0; 
0|0|0|SEARCH TABLE tagsNotesLookup USING COVERING INDEX archivedTagUniqueID (archived=?) (~10 rows) 
</code></pre>

<p>å¥½å¤šäº†ã€‚</p>

<p>æ›´å¤šæ€§èƒ½æç¤º
FMDBçš„æŸå¤„åŠ äº†ç¼“å­˜statementsçš„èƒ½åŠ›ï¼Œæ‰€ä»¥å½“åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“çš„æ—¶å€™ï¼Œæˆ‘æ€»æ˜¯è°ƒç”¨[self.database setShouldCacheStatements:YES] ã€‚è¿™æ„å‘³ç€å¯¹æ¯ä¸ªè°ƒç”¨ä½ ä¸éœ€è¦å†æ¬¡ç¼–è¯‘æ¯ä¸ªstatementã€‚</p>

<p>æˆ‘ä»æ¥æ²¡æœ‰æ‰¾åˆ°ä½¿ç”¨vacuumçš„å¥½çš„æŒ‡å¼•ï¼Œå¦‚æœæ•°æ®åº“æ²¡æœ‰å®šæœŸå‹ç¼©ï¼Œå®ƒä¼šè¶Šæ¥è¶Šæ…¢ã€‚æˆ‘çš„åº”ç”¨ä¼šè·‘ä¸€ä¸ªvacuumï¼Œä½†åªæ˜¯æ¯å‘¨ä¸€æ¬¡ï¼ˆå®ƒåœ¨NSUserDefaultsé‡Œå­˜å‚¨ä¸Šæ¬¡vacuumçš„æ—¶é—´ï¼Œç„¶ååœ¨å¼€å§‹çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦è¿‡äº†ä¸€å‘¨ï¼‰ã€‚</p>

<p>å¦‚æœèƒ½auto_vacuumé‚£æ›´å¥½ï¼Œçœ‹pragma statements supported by SQLiteåˆ—è¡¨ã€‚</p>

<p>å…¶ä»–é…·çš„ä¸œè¥¿
Gus Muellerè®©æˆ‘æ¶‰åŠè‡ªå®šä¹‰SQLiteæ–¹æ³•çš„å†…å®¹ã€‚æˆ‘å¹¶æ²¡æœ‰çœŸçš„ä½¿ç”¨è¿™äº›ä¸œè¥¿ï¼Œæ—¢ç„¶ä»–æŒ‡å‡ºäº†ï¼Œæˆ‘å¯ä»¥æ”¾å¿ƒçš„è¯´æˆ‘èƒ½æ‰¾åˆ°å®ƒçš„ç”¨å¤„ã€‚å› ä¸ºå®ƒå¾ˆé…·ã€‚</p>

<p>åœ¨Gusçš„å¸–å­é‡Œï¼Œæœ‰ä¸€ä¸ªæŸ¥è¯¢æ˜¯è¿™æ ·çš„ï¼š</p>

<pre><code>select displayName, key from items where UTTypeConformsTo(uti, ?) order by 2; 
</code></pre>

<p>SQLiteå®Œå…¨ä¸çŸ¥é“UITypesã€‚ä½†æ˜¯ä½ å¯ä»¥åŠ æ ¸å¿ƒæ–¹æ³•ï¼ŒæŸ¥çœ‹-[FMDatabase makeFunctionNamed:maximumArguments:withBlock:]ã€‚</p>

<p>ä½ å¯ä»¥æ‰§è¡Œä¸€ä¸ªå¤§çš„æŸ¥è¯¢æ¥æ›¿ä»£ï¼Œç„¶åè¯„ä¼°æ¯ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯é‚£éœ€è¦æ›´å¤šå·¥ä½œã€‚æœ€å¥½åœ¨SQLçº§å°±è¿‡æ»¤ï¼Œè€Œä¸æ˜¯åœ¨å°†è¡¨æ ¼è¡Œè½¬ä¸ºå¯¹è±¡ä»¥åã€‚</p>

<p>æœ€å
ä½ çœŸçš„åº”è¯¥ä½¿ç”¨Core Dataï¼Œæˆ‘ä¸æ˜¯åœ¨å¼€ç©ç¬‘ã€‚</p>

<p>æˆ‘ç”¨SQLiteå’ŒFMDBä¸€æ®µæ—¶é—´äº†ï¼Œæˆ‘å¯¹å¤šå¾—çš„å¥½å¤„æ„Ÿåˆ°å¾ˆå…´å¥‹ï¼Œä¹Ÿå¾—åˆ°éåŒä¸€èˆ¬çš„æ€§èƒ½ã€‚ä½†æ˜¯è®°ä½æœºå™¨åœ¨å˜å¿«ï¼Œå…¶ä»–çœ‹ä½ ä»£ç çš„äººæœŸæœ›çœ‹åˆ°ä»–å·²ç»çŸ¥é“çš„Core Data, å¦ä¸€äº›ä¸æ‰“ç®—çœ‹ä½ çš„æ•°æ®åº“ä»£ç ã€‚æ‰€ä»¥è¯·æŠŠè¿™æ•´ç¯‡æ–‡ç« çœ‹åšä¸€ä¸ªç–¯å­çš„å«å–Šï¼Œå…³äºä»–ä¸ºè‡ªå·±å»ºç«‹çš„ç»†èŠ‚çš„ç–¯ç‹‚çš„ä¸–ç•Œï¼Œå¹¶æŠŠè‡ªå·±é”åœ¨é‡Œé¢ã€‚</p>

<p>è¯·äº«å—äº†ä¸èµ·çš„Core Dataçš„æ–‡ç« ï¼ˆæœ‰ç‚¹éš¾è¿‡çš„æ‘‡å¤´ï¼‰ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œåœ¨æŸ¥å®ŒGusæŒ‡å‡ºçš„è‡ªå®šä¹‰SQLiteæ–¹æ³•ç‰¹æ€§åï¼Œæˆ‘ä¼šç ”ç©¶SQLiteçš„full-text search extension. æ€»æœ‰æ›´å¤šçš„å†…å®¹éœ€è¦å»å­¦ä¹ ã€‚</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/05/ycoredatayurealm/">CoreData vs Realm</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-05T04:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:59 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­ã€‚æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨ï¼Œä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–ä½¿ç”¨ï¼Œè¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥ï¼Œè°¢è°¢æ‚¨çš„ç†è§£åˆä½œã€‚å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™ï¼Œè¿™æ ·æ‚¨å°†èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è·å–æœ¬ç«™ä¿¡æ¯ã€‚
ç¢ç¢å¿µ</p>

<p>OhMyStar 2 ä¹Ÿè¿›è¡Œäº†ä¸€æ®µæ—¶æ—¥ï¼Œæˆ‘æŠŠæŒä¹…åŒ–çš„æ–¹å¼ä»CoreData æ¢åˆ°äº† Realmã€‚æœ‰äº›æ„Ÿæ‚Ÿï¼Œé¡ºæ‰‹å°±è®°å½•ä¸€ä¸‹å§ã€‚ä»¥ä¸‹è¯„è®ºéƒ½æ˜¯è‡ªå·±å¾ˆä¸»è§‚çš„æ„Ÿå—ï¼Œæ— å®é™…æµ‹è¯•æ•°æ®æ”¯æŒã€‚
è®º iOS çš„æŒä¹…åŒ–</p>

<p>iOS æŒä¹…åŒ–å…¶å®ä¹Ÿæ²¡å¤šå°‘é€‰æ‹©ï¼Œ é«˜ç«¯ä¸€ç‚¹CoreDataã€Realmã€FMDBã€KVç±»(LevelDBç­‰)ã€‚ä½ç«¯ä¸€äº›ç›´æ¥ä¸€ä¸ª NSArray å°±å†™æˆ Plist ä¹Ÿèƒ½æŒä¹…åŒ–ä¸‹æ¥ã€‚</p>

<p>åœ¨ç½‘ç»œç¯å¢ƒè¶Šæ¥è¶Šå¿«çš„å½“ä¸‹å’Œå¤§éƒ¨åˆ†åº”ç”¨æ•°æ®éƒ½å¯èƒ½æ˜¯ç½‘ç»œåº”ç”¨ï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œå…¶å®æç«¯ä¸€ç‚¹å°±åªç”¨å†™åˆ° JSON è½¬ Object å°±å¥½äº†ã€‚è€Œä¸”ä¸€å †è¿™æ ·å¥½ç”¨çš„å°è£…ï¼Œè¿œæœ‰Mantle è¿‘æœ‰YYModelã€‚</p>

<p>æ‰€ä»¥éœ€è¦æŒä¹…åŒ–çš„æ—¶å€™ï¼Œæˆ‘è§‰çš„å¯ä»¥æ…é‡çš„è¯„ä¼°ä¸€ä¸‹éœ€æ±‚ã€‚æƒ³æ˜ç™½äº†ï¼Œåé¢å¯ä»¥èŠ‚çœå¾ˆå¤šäº‹æƒ…ã€‚</p>

<p>æœ¬æ–‡ç« ä¸»è¦å¯¹æ¯” Realm å’Œ CoreDataï¼Œå…¶ä»–çš„å°±ä¸æ¶‰åŠäº†ã€‚</p>

<p>Realm
ä¼˜ç‚¹
å…¥é—¨é—¨æ§›ä½</p>

<p>Realmæ–‡æ¡£å°±ç®—ä¸€ä¸ªå­—ä¸€ä¸ªå­—æ‰£ç€è¯»å®Œï¼Œä¸€ä¸ªä¸‹åˆå°±è¶³å¤Ÿäº†ã€‚è€Œä¸”è¿˜æœ‰ä¸­æ–‡ç‰ˆæœ¬ï¼Œä¸è¦å¤ªå‹å¥½å“¦ï¼Œæœ‰ç‚¹ä¸ä¹ æƒ¯è¯¶ã€‚</p>

<p>æ–‡æ¡£è¦†ç›–äº†80%çš„ä½¿ç”¨æƒ…å†µï¼Œç”šè‡³æœ‰äº›å¤ªç®€é™‹çš„å«Œç–‘ã€‚ä½†ä¸ç®¡æ€ä¹ˆæ ·ï¼Œè¿™ç§å…¥é—¨æ¡ä»¶æ¯”èµ· CoreData å†™äº†ä¸‰ä¸ªæœˆéƒ½æ²¡ææ¸…æ¥š Context è¦å¥½çš„å¤šã€‚</p>

<p>åœ¨åº“çš„å·¥å…·é“¾ä¸Šï¼Œå®‰è£…ä¸€ä¸ª Realm Browser ä»¥åå°±ä¸éœ€è¦å…¶ä»–è¾…åŠ©äº†ã€‚è¿˜æ˜¯ç®€å•ã€‚</p>

<p>å‡ ä¹åšåˆ°äº†ä¸Šæ‰‹å³ç”¨çš„ç¨‹åº¦ã€‚äº”æ˜Ÿå¥½è¯„ã€‚</p>

<p>PSï¼šæˆ‘ç”¨äº†ä¸€ä¸ªé€šå®µæŠŠ OhMyStar 2 çš„æŒä¹…åŒ–ä» CoreData æ¢åˆ°äº† Realm ï¼Œä¼˜åŒ–è°ƒæ•´äº†å¤§æ¦‚5å¤©å·¦å³è¾¾åˆ°å‹‰å¼ºå¯ä»¥ç”¨çš„æƒ…å†µ ã€‚åœ¨è¿™ä¹‹å‰å¹¶æ²¡æœ‰ä»»ä½• Realm çš„ç»éªŒã€‚
æ®è¯´æ€§èƒ½å¥½ä¸€äº›</p>

<p>Realmå®˜æ–¹ä»‹ç»Fastä¸€æ®µä¸­</p>

<p>Counts</p>

<p><img src="/images/benchmarks.001b.png" title="Caption" ></p>

<p>Queries</p>

<p><img src="/images/benchmarks.002b.png" title="Caption" ></p>

<p>Inserts</p>

<p><img src="/images/benchmarks.003b.png" title="Caption" ></p>

<p>åœ¨å†™è¿™é‡Œçš„æ—¶å€™æˆ‘é¡ºæ‰‹Googleäº†ä¸€ä¸‹ å‘ç°ä¸€ç¯‡Core Data, FMDB, Realm æ€§èƒ½æµ‹è¯•ã€‚æˆ‘å°±å¤šè¯´å‡ å¥</p>

<p>æ€»è§‰å¾—å¤§å®¶å¯¹ CoreData è¯¯ä¼šè›®æ·±ï¼Œä»£ç  Fork çœ‹äº†ä¸€ä¸‹ï¼Œ æ€»è§‰å¾—ä¸åº”è¯¥è¿™æ ·å†™æ¥æ¯”æ€§èƒ½çš„ï¼Œä½†æ˜¯ä¸€æ—¶åŠä¼šä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ”¹ã€‚æˆ‘åªèƒ½è¯´æˆ‘åœ¨ä¼˜åŒ– CoreData çš„æ—¶å€™æ ¹æ® WWDC ä¸Šæ•™çš„è¿˜æ˜¯æå‡å¾ˆé«˜ï¼Œå¦å¤–ä¸€ä¸ªäº‹æƒ…æ˜¯ CoreData ä¸€èˆ¬éƒ½ç”¨ Sqlite åšåç«¯ã€‚æ‰€ä»¥å¦‚æœä½ çš„æŸ¥è¯¢æ˜¯ç»è¿‡ä¼˜åŒ–çš„ï¼Œç¡®è®¤æ‰“å‡ºæ¥çš„SQLè¯­å¥ç§‘å­¦ä»¥åï¼ŒSqlite(CoreData) è·Ÿ Sqlite(FMDB)æˆ‘è§‰å¾—æ€§èƒ½å°±ç®—æœ‰å·®è·ï¼Œè¿™å·®è·æ²¡æœ‰èƒ½å¤§åˆ°é€‰æ‹©æ–¹æ¡ˆçš„å†³å®šæ€§å› ç´ ã€‚å¦‚æœä½¿ç”¨ CoreData é‡åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œä½ åº”è¯¥ä»”ç»†çš„ç ”ç©¶ WWDC å’Œå‡ ç¯‡å¾ˆå¥½çš„æ–‡ç« ã€‚ç¡®ä¿ä½ çš„ CoreData ä½¿ç”¨æ–¹å¼æ˜¯æ­£ç¡®ç§‘å­¦çš„ã€‚
æ²¡æœ‰éœ€è¦æ¶æ„Contexté‚£ç§çƒ¦äººçš„ä¸œè¥¿</p>

<p>åº”è¯¥ä¹Ÿç®—Realmç®€å•çš„ä¸€ä¸ªæ–¹é¢ï¼ŒRealm åªè¦ä¿æŒè‡ªå·±çº¿ç¨‹é‡Œé¢ï¼Œè‡ªå·±çš„ Realm Store æ“ä½œæ˜¯æ­£ç¡®çš„å³å¯ã€‚å¦‚æœæ˜¯ CoreDataï¼Œæ€ä¹ˆæ¶æ„ä¸€ä¸ªç§‘å­¦çš„ Context Stack å°±è¶³å¤Ÿè®©æˆ‘å¤´ç–¼ä¸€æ•´ï¼ŒiOS è¿˜å¥½ï¼Œç•Œé¢æ˜¯ä¸€ä¸ªæ¥ç€ä¸€ä¸ª(VCè·ŸVCä¹‹é—´çš„å±‚çº§å…³ç³»å¾ˆæ¸…æ™°)ã€‚è€Œ OhMyStar 2 è¿™ç§ OS X æ¡Œé¢åº”ç”¨åœºæ™¯VCä¹‹é—´å¾ˆå¤æ‚ï¼Œçº¿ç¨‹ä¹‹é—´Contextçš„å…³ç³»è®©å‡ºç°å¾ˆå¤šé—®é¢˜ã€‚
æ”¯æŒ NSPredicate</p>

<p>ä» CoreData è½¬è¿‡æ¥å¹¶æ²¡æœ‰å¤ªå¤šçš„ä¸é€‚åº”
å¾ˆç®€å•çš„ä½¿ç”¨å¤šä¸ªå­˜å‚¨æ–‡ä»¶</p>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¤šç”¨æˆ·ç™»é™†æƒ…å†µä¸‹ã€‚ç”¨æˆ·æ˜¯å•ç‹¬çš„å­˜å‚¨æ–‡ä»¶ï¼Œå’Œå…¨éƒ¨ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªå­˜å‚¨æ–‡ä»¶ã€‚åè€…éœ€è¦æ¯æ¡ç”¨æˆ·æ•°æ®éƒ½è¦å…³è”ä¸€æ¬¡å½“å‰ç”¨æˆ·ï¼Œæ‰€æœ‰æŸ¥è¯¢ç”¨æˆ·æ•°æ®çš„æ—¶å€™ï¼Œä½ éƒ½å¿…é¡»åŠ ä¸Šå½“å‰ç”¨æˆ·çš„æŸ¥è¯¢é¡¹ã€‚è€Œä½¿ç”¨æ¯ä¸ªç”¨æˆ·å•ç‹¬ä¸€ä¸ªæ•°æ®æ–‡ä»¶çš„æ—¶å€™ï¼Œæ•´ä¸ªå­˜å‚¨ç»“æ„ä¼šæ¸…çˆ½å¾ˆå¤šã€‚
æŠ€æœ¯æ”¯æŒ</p>

<p>è‡³å°‘å®åœ¨æ²¡æ³•çš„æ—¶å€™è¿˜å¯ä»¥å»å¾®åšä¸Šåæ§½ä»–ä»¬ï¼Œä»–ä»¬å…¶å®ä¹Ÿæœ‰æå¤§çš„çƒ­æƒ…æ¥è§£å†³ä½ é‡åˆ°çš„é—®é¢˜ã€‚CoreData è¿™ç§é‡åˆ°é—®é¢˜å°±åªèƒ½è‡ªå·±é»˜é»˜çš„åä¸‹ã€‚
ç¼ºç‚¹
å…³è”å…³ç³»å¼±çš„ä¸€é€¼</p>

<p>ç®€å•è¯´æ¥å°±æ˜¯å¯¹è±¡è·Ÿå¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»å’Œå¤šå¯¹å¤šå…³ç³»ã€‚å¹¶ä¸èƒ½æ˜ å°„ï¼Œéœ€è¦åœ¨åŒæ–¹é‡Œé¢éƒ½å†™ä¸Šå±æ€§ï¼Œæ­¤å¤–è¿˜éœ€è¦åœ¨è®¾ç½®çš„æ—¶å€™ä¸¤è¾¹åŒæ—¶è®¾ç½®ã€‚æŸ¥è¯¢æ—¶å€™ä¹Ÿæ˜¯ NSPredicate ä¹Ÿä»…ä»…åªæ”¯æŒä¸€äº›ä¸€å±‚çš„æŸ¥è¯¢ï¼Œæ²¡æ³•åšå‡ºå¸¦SUBQUERYçš„å¤æ‚æŸ¥è¯¢å‡ºæ¥ã€‚
å¼ºåˆ¶å†…çœå®¹é”™æœºåˆ¶å¯¼è‡´å­˜å‚¨æ–‡ä»¶ä¸æ–­å˜å¤§</p>

<p>Realmæœ¬èº«æ„Ÿè§‰æœ‰ä¸€ä¸ªæ•°æ®å®¹é”™æœºåˆ¶ã€‚ä½†æ˜¯è¿™ä¸ªæœºåˆ¶åœ¨æ•°æ®åº“æ–‡ä»¶æœ‰é”™è¯¯çš„æƒ…å†µè‡ªå·±ä¿®å¤çš„æ—¶å€™ï¼Œä¼šæ— é™å¢å¤§ã€‚å…·ä½“æˆ‘è¿™é‡Œè¡¨ç°ä¸ºï¼Œæ‰“å¼€çœ‹åªæœ‰3000æ¡æ•°æ®ï¼Œä½†æ˜¯æ–‡ä»¶å¤§å°å·²ç»æœ‰3GBã€‚é‡ç°Bugä¹Ÿå¾ˆå®¹æ˜“ï¼Œåªè¦ä½ åœ¨å†™æ•°æ®åº“çš„æ—¶å€™,ç”¨Realm BrowseræŸ¥çœ‹ä¸€ä¸‹ï¼Œcrashä¹‹ååœ¨æ‰“å¼€å°±å¾ˆå®¹æ˜“å‡ºç°ã€‚</p>

<p>å®˜æ–¹æ–‡æ¡£é‡Œé¢æœ‰è¯´åˆ°ä¼šé€ æˆè¿™ç§æƒ…å½¢çš„åŸå› ï¼Œæˆ‘åœ¨å°½æˆ‘æ‰€èƒ½çš„é¿å…é—®é¢˜ä»¥åã€‚å­˜å‚¨æ–‡ä»¶è¿˜æ˜¯ä¼šæœ‰å¯èƒ½ä¸é‚£ä¹ˆå¤¸å¼ çš„å˜å¤§ä¸€äº›ã€‚ä½†æ˜¯ç”¨Realm BrowseræŸ¥çœ‹æ•°æ®æ˜¯æ­£å¸¸çš„ã€‚æ‰€ä»¥æˆ‘è§‰å¾—å®˜æ–¹åº”è¯¥æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥åˆ é™¤æ‰é‚£äº›å®¹æ˜“çš„ä¸œè¥¿ã€‚ä¿æŒå­˜å‚¨æ–‡ä»¶çš„å¹²å‡€ã€‚
æ²¡æœ‰ç»†ç²’åŒ–é€šçŸ¥</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘åœ¨æŸä¸ªåœ°æ–¹åšå‡ºä¿®æ”¹ã€‚ æˆ‘å…¶ä»–åœ°æ–¹åªçŸ¥é“Realmæœ‰ä¿®æ”¹ï¼Œä½†æ˜¯æ²¡æ³•çŸ¥é“æˆ‘æ˜¯å¢åŠ ã€ä¿®æ”¹è¿˜æ˜¯åˆ é™¤äº†æ•°æ®ã€‚ä¸çŸ¥é“æˆ‘æ›´æ–°çš„æ˜¯é‚£ä¸€æ¡æ•°æ®ã€‚æ®æ–‡æ¡£è¯´ï¼Œå°†æ¥ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±åªæœ‰æ‹­ç›®ä»¥å¾…ã€‚
å¢åŠ åŒ…ä½“ç§¯</p>

<p>æ®å®˜æ–¹è¯´ä¼šå¢åŠ 1MBå·¦å³çš„åŒ…å¤§å°ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªå°ä½“ç§¯åº”ç”¨ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå‡ åƒä¸‡ç”¨æˆ·çš„ä¸»æµåº”ç”¨ã€‚å¯¹åŒ…å¤§å°æ•æ„Ÿçš„è¯æ…ç”¨ã€‚
æ ¸å¿ƒä»£ç ç›®å‰é—­æº</p>

<p>å¯¹äºåœ¨æˆ‘ä»¬è¿™æ ·ä¸€ä¸ªä½œæ¶æ»¡å¤©é£çš„å¤©æœé•¿å¤§çš„å­©å­æ¥è¯´ï¼Œæœ‰äº›å­©å­å¯¹é—­æºè¿™ä¸ªäº‹æƒ…è¿˜æ˜¯æŒºåœ¨æ„çš„ã€‚ä¸è¿‡å®˜æ–¹è¯´å°†æ¥ä¼šå¼€æºï¼Œæˆ‘è¿˜æ˜¯å€¾å‘äºç›¸ä¿¡ Realm ä»–ä»¬çš„äººå“ã€‚
CoreData</p>

<p>CoreData ç›¸å…³èµ„æ–™ç›¸å¯¹å¤šä¸€äº›æˆ‘å°±ç®€å•è¯´
ä¼˜ç‚¹
å®˜æ–¹æ”¯æŒ &amp;&amp; äº²å„¿å­</p>

<p>ç³»ç»Ÿè‡ªå¸¦ï¼ŒAppleæ”¯æŒ
å¸¦å›¾å½¢åŒ–çš„Modelç¼–è¾‘</p>

<p>å¯¹äºè§†è§‰åŒ–åŠ¨ç‰©æ¥è¯´æ¯”è¾ƒå‹å¥½ï¼Œä¹Ÿå¯ä»¥æ¸…æ¥šçš„çŸ¥é“è‡ªå·±è®¾è®¡çš„ Model ä¹‹é—´çš„å…³ç³»
å¼ºå¤§çš„å…³è”å…³ç³»</p>

<p>ä»¥å‰ä¸è§‰å¾—ï¼Œç”¨äº† Realm æ‰å‘ç° CoreData çš„å…³è”å…³ç³»å¦‚æ­¤å¥½ç”¨ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šã€‚æƒ³æ€ä¹ˆæŸ¥è¯¢å°±æ€ä¹ˆæŸ¥è¯¢ï¼Œå¯ä»¥å†™å‡ºå¾ˆå¤æ‚çš„æŸ¥è¯¢é€»è¾‘æ¥ã€‚
å¼ºå¤§çš„æŸ¥è¯¢</p>

<p>è™½ç„¶å¯èƒ½åœ¨è®¾ç½®NSFetchRequestçš„æ—¶å€™æ„Ÿè§‰å¾ˆå¤šä¸œè¥¿è¦å¼„ï¼Œä½†æ˜¯å¤æ‚ä¹Ÿå¸¦æ¥äº†å¼ºå¤§çš„åŠŸèƒ½ï¼ŒNSFetchRequest å¯ä»¥è®¾ç½®å¾ˆå¤šï¼Œæ¯”å¦‚é™åˆ¶æŸ¥è¯¢æ•°é‡ï¼Œ é™åˆ¶åªè¿”å›æŸäº›å±æ€§å€¼ç­‰ç­‰ã€‚å°±ä¸å±•å¼€è¯´äº†ã€‚
ç²¾ç»†åŒ–çš„é€šçŸ¥</p>

<p>å¯ä»¥çŸ¥é“å…·ä½“æ’å…¥äº†ä»€ä¹ˆã€æ›´æ–°äº†ä»€ä¹ˆã€åˆ é™¤äº†ä»€ä¹ˆã€‚è¿™æ ·åœ¨åˆ·UIï¼Œæ¯”å¦‚ä¸€ä¸ªtableviewçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥æ§åˆ¶çš„å¾ˆå‡†ç¡®ã€‚
ç¼ºç‚¹
å…¥é—¨é—¨æ§›é«˜</p>

<p>CoreData æ˜¯ä¸€ä¸ªåšå¤§ç²¾æ·±çš„æŠ€æœ¯ï¼Œä¸è¦å¦„æƒ³å‡ å¤©ä¹‹å†…å¯ä»¥ç”¨çš„å¾ˆæºœã€‚
CoreData æ˜¯ä¸€ä¸ªåšå¤§ç²¾æ·±çš„æŠ€æœ¯ï¼Œä¸è¦å¦„æƒ³å‡ å¤©ä¹‹å†…å¯ä»¥ç”¨çš„å¾ˆæºœã€‚
CoreData æ˜¯ä¸€ä¸ªåšå¤§ç²¾æ·±çš„æŠ€æœ¯ï¼Œä¸è¦å¦„æƒ³å‡ å¤©ä¹‹å†…å¯ä»¥ç”¨çš„å¾ˆæºœã€‚</p>

<p>å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å’Œç²¾åŠ›å»æ¥å…¥ CoreDataã€‚ é‚£é€‰å‹çš„æ—¶å€™åº”å½“æ…é‡è€ƒè™‘ã€‚
éœ€è¦ä¸€äº›å·¥å…·æ‰æ„Ÿè§‰å¥½ä½¿</p>

<p>ä¸ç®¡æ˜¯è€æ‰‹è¿˜æ˜¯æ–°æ‰‹ï¼Œä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹çš„å°è£…åº“å’Œå·¥å…·éƒ½ä¼šå¤§å¤§çš„æé«˜ä½¿ç”¨ CoreData çš„å¹¸ç¦æŒ‡æ•°ã€‚</p>

<p>mogenerator æ˜¯å¿…é¡»å¿…é¡»è¦çš„ã€‚</p>

<p>MagicalRecord æ— æ„§ CoreData ç¬¬ä¸€åº“ï¼Œæ®å°é“æ¶ˆæ¯ ä¸»è¦è´¡çŒ®è€… Saul Mora å¯èƒ½å»äº†å¾®ä¿¡äº†ã€‚
Context</p>

<p>å…¶å®è¿˜æ˜¯ CoreData é—¨æ§›é«˜çš„é—®é¢˜ï¼Œå¯¹æˆ‘æ¥è¯´ã€‚Contextä¹‹é—´çš„å…³ç³»å’Œçº¿ç¨‹ä¹‹é—´çš„å¤„ç†è®©æˆ‘æ„Ÿåˆ°å¾ˆå¤´ç—›ï¼Œç‰¹åˆ«æ˜¯ OS X  æ˜¯ä¸€å¤§å †VCé“ºåˆ°å±å¹•ä¸Šï¼Œæˆ‘æ°´å¹³åˆèœï¼Œå‡ºçš„é—®é¢˜å¾ˆå¤šã€‚
å¤šä¸ªæŒä¹…åŒ–æ–‡ä»¶å¾ˆéº»çƒ¦</p>

<p>ä¸æ˜¯è¯´ä¸å¯ä»¥ï¼Œä½†æ˜¯çœŸçš„å¥½éº»çƒ¦ã€‚</p>

<p>æœ‰ä¸ªç¬¬ä¸‰æ–¹åº“æœ‰è§£å†³CoreDataè¿™ä¸ªé—®é¢˜ CoreStore ä½†æ˜¯æˆ‘ç”¨ç€ä¸æ˜¯å¾ˆé¡ºæ‰‹æœ€åå¼ƒç”¨.
æ€»ç»“</p>

<p>å…¶å®å§ç”¨å•¥æŒä¹…åŒ–éƒ½è¡Œï¼Œå…·ä½“è¿˜æ˜¯éœ€è¦çœ‹ä½ çš„éœ€æ±‚å’Œæ–¹æ¡ˆä¸Šæ¥è¯´å“ªä¸€ä¸ªæ–¹æ¡ˆæ›´åŠ é€‚åˆã€‚</p>

<p>å¦‚æœç®€å•è¯´æ¥ï¼Œå°±æ˜¯ Realm æ›´åŠ é€‚åˆä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸æ€ä¹ˆå¤æ‚çš„åœºæ™¯ï¼Œå›¢é˜Ÿé…ç½®è¦æ±‚ä¸é«˜ï¼Œæœ‰ç»éªŒçš„äººç¨å¾®çœ‹ä¸€ä¸‹åˆå°±èƒ½ä¸Šæ‰‹ã€‚</p>

<p>CoreData æ›´åŠ é€‚åˆä¸šåŠ¡é€»è¾‘å¤æ‚çš„æƒ…å†µï¼Œå›¢é˜Ÿé…ç½®è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæœ‰ç»éªŒçš„è€æ‰‹ä¹Ÿéœ€è¦å‡ å‘¨ç”šè‡³æ›´é•¿çš„æ—¶é—´æ‰èƒ½ç§‘å­¦çš„ä½¿ç”¨CoreDataã€‚</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/04/coredatedzhuangbi/">CoreDataè£…é€¼æŠ€èƒ½ï¼Ÿ</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-04T14:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:59 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>æ­£æ–‡ï¼š</p>

<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œå·²ç»è®²äº†å¾ˆå¤šå…³äºCoreDataä½¿ç”¨ç›¸å…³çš„çŸ¥è¯†ç‚¹ã€‚è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®²ä¸¤ä¸ªæ–¹é¢ï¼ŒNSFetchedResultsControllerå’Œç‰ˆæœ¬è¿ç§»ã€‚</p>

<p>æ–‡ç« é¢˜ç›®ä¸­è™½ç„¶æœ‰â€œé«˜çº§â€ä¸¤ä¸ªå­—ï¼Œå…¶å®è®²çš„ä¸œè¥¿å¹¶ä¸é«˜çº§ï¼Œåªæ˜¯å› ä¸ºä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä¸œè¥¿å¤ªå¤šäº†ï¼ŒæŠŠä¸¤ä¸ªè¾ƒå¤æ‚çš„çŸ¥è¯†ç‚¹æŒªåˆ°è¿™ç¯‡æ–‡ç« ä¸­ã€‚</p>

<p>æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼</p>

<p>NSFetchedResultsController</p>

<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¼šç»å¸¸ç”¨åˆ°UITableViewè¿™æ ·çš„è§†å›¾ç±»ï¼Œè¿™äº›è§†å›¾ç±»éœ€è¦è‡ªå·±ç®¡ç†å…¶æ•°æ®æºï¼ŒåŒ…æ‹¬ç½‘ç»œè·å–ã€æœ¬åœ°å­˜å‚¨éƒ½éœ€è¦å†™ä»£ç è¿›è¡Œç®¡ç†ã€‚</p>

<p>è€Œåœ¨CoreDataä¸­æä¾›äº†NSFetchedResultsControllerç±»(fetched results controllerï¼Œä¹Ÿå«FRC)ï¼ŒFRCå¯ä»¥ç®¡ç†UITableViewæˆ–UICollectionViewçš„æ•°æ®æºã€‚è¿™ä¸ªæ•°æ®æºä¸»è¦æŒ‡æœ¬åœ°æŒä¹…åŒ–çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ•°æ®æºé…åˆç€ç½‘ç»œè¯·æ±‚æ•°æ®ä¸€èµ·ä½¿ç”¨ï¼Œä¸»è¦çœ‹ä¸šåŠ¡éœ€æ±‚äº†ã€‚</p>

<p>æœ¬ç¯‡æ–‡ç« ä¼šä½¿ç”¨UITableViewä½œä¸ºè§†å›¾ç±»ï¼Œé…åˆNSFetchedResultsControllerè¿›è¡Œåé¢çš„æ¼”ç¤ºï¼ŒUICollectionViewé…åˆNSFetchedResultsControllerçš„ä½¿ç”¨ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸éƒ½è®²äº†ã€‚</p>

<p>ç®€å•ä»‹ç»</p>

<p>å°±åƒä¸Šé¢è¯´åˆ°çš„ï¼ŒNSFetchedResultsControllerå°±åƒæ˜¯ä¸Šé¢ä¸¤ç§è§†å›¾çš„æ•°æ®ç®¡ç†è€…ä¸€æ ·ã€‚FRCå¯ä»¥ç›‘å¬ä¸€ä¸ªMOCçš„æ”¹å˜ï¼Œå¦‚æœMOCæ‰§è¡Œäº†æ‰˜ç®¡å¯¹è±¡çš„å¢åˆ æ”¹æ“ä½œï¼Œå°±ä¼šå¯¹æœ¬åœ°æŒä¹…åŒ–æ•°æ®å‘ç”Ÿæ”¹å˜ï¼ŒFRCå°±ä¼šå›è°ƒå¯¹åº”çš„ä»£ç†æ–¹æ³•ï¼Œå›è°ƒæ–¹æ³•çš„å‚æ•°ä¼šåŒ…æ‹¬æ‰§è¡Œæ“ä½œçš„ç±»å‹ã€æ“ä½œçš„å€¼ã€indexPathç­‰å‚æ•°ã€‚</p>

<p>å®é™…ä½¿ç”¨æ—¶ï¼Œé€šè¿‡FRCâ€œç»‘å®šâ€ä¸€ä¸ªMOCï¼Œå°†UITableViewåµŒå…¥åœ¨FRCçš„æ‰§è¡Œæµç¨‹ä¸­ã€‚åœ¨ä»»ä½•åœ°æ–¹å¯¹è¿™ä¸ªâ€œç»‘å®šâ€çš„MOCå­˜å‚¨åŒºåšä¿®æ”¹ï¼Œéƒ½ä¼šè§¦å‘FRCçš„å›è°ƒæ–¹æ³•ï¼Œåœ¨FRCçš„å›è°ƒæ–¹æ³•ä¸­åµŒå…¥UITableViewä»£ç å¹¶åšå¯¹åº”ä¿®æ”¹å³å¯ã€‚</p>

<p>ç”±æ­¤å¯ä»¥çœ‹å‡ºFRCæœ€å¤§ä¼˜åŠ¿å°±æ˜¯ï¼Œå§‹ç»ˆå’Œæœ¬åœ°æŒä¹…åŒ–çš„æ•°æ®ä¿æŒç»Ÿä¸€ã€‚åªè¦æœ¬åœ°æŒä¹…åŒ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šè§¦å‘FRCçš„å›è°ƒæ–¹æ³•ï¼Œä»è€Œåœ¨å›è°ƒæ–¹æ³•ä¸­æ›´æ–°ä¸Šå±‚æ•°æ®æºå’ŒUIã€‚è¿™ç§æ–¹å¼è®²çš„ç®€å•ä¸€ç‚¹ï¼Œå°±å¯ä»¥å«åšæ•°æ®å¸¦åŠ¨UIã€‚</p>

<p><img src="/images/4001.png" title="Caption" ></p>

<p>FRC</p>

<p>ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨FRCçš„åˆå§‹åŒ–ä¸­ä¼ å…¥äº†ä¸€ä¸ªMOCå‚æ•°ï¼ŒFRCåªèƒ½ç›‘æµ‹ä¼ å…¥çš„MOCå‘ç”Ÿçš„æ”¹å˜ã€‚å‡è®¾å…¶ä»–MOCå¯¹åŒä¸€ä¸ªå­˜å‚¨åŒºå‘ç”Ÿäº†æ”¹å˜ï¼ŒFRCåˆ™ä¸èƒ½ç›‘æµ‹åˆ°è¿™ä¸ªå˜åŒ–ï¼Œä¸ä¼šåšå‡ºä»»ä½•ååº”ã€‚</p>

<p>æ‰€ä»¥ä½¿ç”¨FRCæ—¶ï¼Œéœ€è¦æ³¨æ„FRCåªèƒ½å¯¹ä¸€ä¸ªMOCçš„å˜åŒ–åšå‡ºååº”ï¼Œæ‰€ä»¥åœ¨CoreDataæŒä¹…åŒ–å±‚è®¾è®¡æ—¶ï¼Œå°½é‡ä¸€ä¸ªå­˜å‚¨åŒºåªå¯¹åº”ä¸€ä¸ªMOCï¼Œæˆ–è®¾ç½®ä¸€ä¸ªè´Ÿè´£UIçš„MOCï¼Œè¿™åœ¨åé¢å¤šçº¿ç¨‹éƒ¨åˆ†ä¼šè¯¦ç»†è®²è§£ã€‚</p>

<p>ä¿®æ”¹æ¨¡å‹æ–‡ä»¶ç»“æ„</p>

<p>åœ¨å†™ä»£ç ä¹‹å‰ï¼Œå…ˆå¯¹ä¹‹å‰çš„æ¨¡å‹æ–‡ä»¶ç»“æ„åšä¸€äº›ä¿®æ”¹ã€‚</p>

<p><img src="/images/4002.png" title="Caption" ></p>

<p>Employeeç»“æ„</p>

<p>è®²FRCçš„æ—¶å€™ï¼Œåªéœ€è¦ç”¨åˆ°Employeeè¿™ä¸€å¼ è¡¨ï¼Œå…¶ä»–è¡¨å’Œè®¾ç½®ç›´æ¥å¿½ç•¥ã€‚éœ€è¦åœ¨EmployeeåŸæœ‰å­—æ®µçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªStringç±»å‹çš„sectionNameå­—æ®µï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯ç”¨æ¥å­˜å‚¨section titleçš„ï¼Œåœ¨ä¸‹é¢çš„æ–‡ç« ä¸­å°†ä¼šè¯¦ç»†è®²åˆ°ã€‚</p>

<p>åˆå§‹åŒ–FRC</p>

<p>ä¸‹é¢ä¾‹å­æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„FRCåˆå§‹åŒ–æ–¹å¼ï¼Œåˆå§‹åŒ–æ—¶æŒ‡å®šçš„MOCï¼Œè¿˜ç”¨ä¹‹å‰è®²è¿‡çš„MOCåˆå§‹åŒ–ä»£ç ï¼ŒUITableViewåˆå§‹åŒ–ä»£ç è¿™é‡Œä¹Ÿçœç•¥äº†ï¼Œä¸»è¦çªå‡ºFRCçš„åˆå§‹åŒ–ã€‚</p>

<p>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// è®¾ç½®æ’åºè§„åˆ™ï¼ŒæŒ‡æ˜æ ¹æ®heightå­—æ®µå‡åºæ’åº
NSSortDescriptor </em>heightSort = [NSSortDescriptor sortDescriptorWithKey:@&ldquo;height&rdquo; ascending:YES];
request.sortDescriptors = @[heightSort];
// åˆ›å»ºNSFetchedResultsControlleræ§åˆ¶å™¨å®ä¾‹ï¼Œå¹¶ç»‘å®šMOC
NSError *error = nil;
fetchedResultController = [[NSFetchedResultsController alloc] initWithFetchRequest:request
                                                     managedObjectContext:context
                                            sectionNameKeyPath:@&ldquo;sectionName&rdquo;
                                                   cacheName:nil];
// è®¾ç½®ä»£ç†ï¼Œå¹¶éµå®ˆåè®®
fetchedResultController.delegate = self;
// æ‰§è¡Œè·å–è¯·æ±‚ï¼Œæ‰§è¡ŒåFRCä¼šä»æŒä¹…åŒ–å­˜å‚¨åŒºåŠ è½½æ•°æ®ï¼Œå…¶ä»–åœ°æ–¹å¯ä»¥é€šè¿‡FRCè·å–æ•°æ®
[fetchedResultController performFetch:&amp;error];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;NSFetchedResultsController init error : %@&rdquo;, error);
}
// åˆ·æ–°UI
[tableView reloadData];</p>

<p>åœ¨ä¸Šé¢åˆå§‹åŒ–FRCæ—¶ï¼Œä¼ å…¥çš„sectionNameKeyPath:å‚æ•°ï¼Œæ˜¯æŒ‡æ˜å½“å‰æ‰˜ç®¡å¯¹è±¡çš„å“ªä¸ªå±æ€§å½“åšsectionçš„titleï¼Œåœ¨æœ¬æ–‡ä¸­å°±æ˜¯Employeeè¡¨çš„sectionNameå­—æ®µä¸ºsectionçš„titleã€‚ä»NSFetchedResultsSectionInfoåè®®çš„indexTitleå±æ€§è·å–è¿™ä¸ªå€¼ã€‚</p>

<p>åœ¨sectionNameKeyPath:è®¾ç½®å±æ€§ååï¼Œå°±ä»¥è¿™ä¸ªå±æ€§åä½œä¸ºåˆ†ç»„titleï¼Œç›¸åŒçš„titleä¼šè¢«åˆ†åˆ°ä¸€ä¸ªsectionä¸­ã€‚</p>

<p>åˆå§‹åŒ–FRCæ—¶å‚æ•°managedObjectContext:ä¼ å…¥äº†ä¸€ä¸ªMOCå‚æ•°ï¼ŒFRCåªèƒ½ç›‘æµ‹è¿™ä¸ªä¼ å…¥çš„MOCå‘ç”Ÿçš„æœ¬åœ°æŒä¹…åŒ–æ”¹å˜ã€‚å°±åƒä¸Šé¢ä»‹ç»æ—¶è¯´çš„ï¼Œå…¶ä»–MOCå¯¹åŒä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åŒºå‘ç”Ÿçš„æ”¹å˜ï¼ŒFRCåˆ™ä¸èƒ½ç›‘æµ‹åˆ°è¿™ä¸ªå˜åŒ–ã€‚</p>

<p>å†å¾€åé¢çœ‹åˆ°cacheName:å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æˆ‘è®¾ç½®çš„æ˜¯nilã€‚å‚æ•°çš„ä½œç”¨æ˜¯å¼€å¯FRCçš„ç¼“å­˜ï¼Œå¯¹è·å–çš„æ•°æ®è¿›è¡Œç¼“å­˜å¹¶æŒ‡å®šä¸€ä¸ªåå­—ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨deleteCacheWithName:æ–¹æ³•æ‰‹åŠ¨åˆ é™¤ç¼“å­˜ã€‚</p>

<p>ä½†æ˜¯è¿™ä¸ªç¼“å­˜å¹¶æ²¡æœ‰å¿…è¦ï¼Œç¼“å­˜æ˜¯æ ¹æ®NSFetchRequestå¯¹è±¡æ¥åŒ¹é…çš„ï¼Œå¦‚æœå½“å‰è·å–çš„æ•°æ®å’Œä¹‹å‰ç¼“å­˜çš„ç›¸åŒ¹é…åˆ™ç›´æ¥æ‹¿æ¥ç”¨ï¼Œä½†æ˜¯åœ¨è·å–æ•°æ®æ—¶æ¯æ¬¡è·å–çš„æ•°æ®éƒ½å¯èƒ½ä¸åŒï¼Œç¼“å­˜ä¸èƒ½è¢«å‘½ä¸­åˆ™å¾ˆéš¾æ´¾ä¸Šç”¨åœºï¼Œè€Œä¸”ç¼“å­˜è¿˜å ç”¨ç€å†…å­˜èµ„æºã€‚</p>

<p>åœ¨FRCåˆå§‹åŒ–å®Œæˆåï¼Œè°ƒç”¨performFetch:æ–¹æ³•æ¥åŒæ­¥è·å–æŒä¹…åŒ–å­˜å‚¨åŒºæ•°æ®ï¼Œè°ƒç”¨æ­¤æ–¹æ³•åFRCä¿å­˜æ•°æ®çš„å±æ€§æ‰ä¼šæœ‰å€¼ã€‚è·å–åˆ°æ•°æ®åï¼Œè°ƒç”¨tableViewçš„reloadDataæ–¹æ³•ï¼Œä¼šå›è°ƒtableViewçš„ä»£ç†æ–¹æ³•ï¼Œå¯ä»¥åœ¨tableViewçš„ä»£ç†æ–¹æ³•ä¸­è·å–åˆ°FRCçš„æ•°æ®ã€‚è°ƒç”¨performFetch:æ–¹æ³•ç¬¬ä¸€æ¬¡è·å–åˆ°æ•°æ®å¹¶ä¸ä¼šå›è°ƒFRCä»£ç†æ–¹æ³•ã€‚</p>

<p>ä»£ç†æ–¹æ³•</p>

<p>FRCä¸­åŒ…å«UITableViewæ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦çš„ç›¸å…³æ•°æ®ï¼Œå¯ä»¥é€šè¿‡FRCçš„sectionså±æ€§ï¼Œè·å–ä¸€ä¸ªéµå®ˆåè®®çš„å¯¹è±¡æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªsectionã€‚</p>

<p>åœ¨è¿™ä¸ªåè®®ä¸­æœ‰å¦‚ä¸‹å®šä¹‰ï¼Œå¯ä»¥çœ‹å‡ºè¿™äº›å±æ€§å’ŒUITableViewçš„æ‰§è¡Œæµç¨‹æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚</p>

<p>@protocol NSFetchedResultsSectionInfo
/<em> Name of the section </em>/
@property (nonatomic, readonly) NSString <em>name;
/</em> Title of the section (used when displaying the index) <em>/
@property (nullable, nonatomic, readonly) NSString </em>indexTitle;
/<em> Number of objects in section </em>/
@property (nonatomic, readonly) NSUInteger numberOfObjects;
/<em> Returns the array of objects in the section. </em>/
@property (nullable, nonatomic, readonly) NSArray *objects;
@end // NSFetchedResultsSectionInfo</p>

<p>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åº”è¯¥å°†FRCå’ŒUITableViewç›¸äº’åµŒå¥—ï¼Œåœ¨FRCçš„å›è°ƒæ–¹æ³•ä¸­åµŒå¥—UITableViewçš„è§†å›¾æ”¹å˜é€»è¾‘ï¼Œåœ¨UITableViewçš„å›è°ƒä¸­åµŒå¥—æ•°æ®æ›´æ–°çš„é€»è¾‘ã€‚è¿™æ ·å¯ä»¥å§‹ç»ˆä¿è¯æ•°æ®å’ŒUIçš„åŒæ­¥ï¼Œåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­å°†ä¼šæ¼”ç¤ºFRCå’ŒUITableViewçš„ç›¸äº’åµŒå¥—ã€‚</p>

<p>Table View Delegate</p>

<p>// é€šè¿‡FRCçš„sectionsæ•°ç»„å±æ€§ï¼Œè·å–æ‰€æœ‰sectionçš„countå€¼
- (NSInteger)numberOfSectionsInTableView:(UITableView <em>)tableView {
    return fetchedResultController.sections.count;
}
// é€šè¿‡å½“å‰sectionçš„ä¸‹æ ‡ä»sectionsæ•°ç»„ä¸­å–å‡ºå¯¹åº”çš„sectionå¯¹è±¡ï¼Œå¹¶ä»sectionå¯¹è±¡ä¸­è·å–æ‰€æœ‰å¯¹è±¡count
- (NSInteger)tableView:(UITableView </em>)tableView numberOfRowsInSection:(NSInteger)section {
    return fetchedResultController.sections[section].numberOfObjects;
}
// FRCæ ¹æ®indexPathè·å–æ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶ç»™cellèµ‹å€¼
- (UITableViewCell <em>)tableView:(UITableView </em>)tableView cellForRowAtIndexPath:(NSIndexPath <em>)indexPath {
    Employee </em>emp = [fetchedResultController objectAtIndexPath:indexPath];
    UITableViewCell <em>cell = [tableView dequeueReusableCellWithIdentifier:@&ldquo;identifier&rdquo; forIndexPath:indexPath];
    cell.textLabel.text = emp.name;
    return cell;
}
// åˆ›å»ºFRCå¯¹è±¡æ—¶ï¼Œé€šè¿‡sectionNameKeyPath:ä¼ é€’è¿›å»çš„section titleçš„å±æ€§åï¼Œåœ¨è¿™é‡Œè·å–å¯¹åº”çš„å±æ€§å€¼
- (NSString </em>)tableView:(UITableView <em>)tableView titleForHeaderInSection:(NSInteger)section {
    return fetchedResultController.sections[section].indexTitle;
}
// æ˜¯å¦å¯ä»¥ç¼–è¾‘
- (BOOL)tableView:(UITableView </em>)tableView canEditRowAtIndexPath:(NSIndexPath <em>)indexPath {
    return YES;
}
// è¿™é‡Œæ˜¯ç®€å•æ¨¡æ‹ŸUIåˆ é™¤cellåï¼Œæœ¬åœ°æŒä¹…åŒ–åŒºæ•°æ®å’ŒUIåŒæ­¥çš„æ“ä½œã€‚åœ¨è°ƒç”¨ä¸‹é¢MOCä¿å­˜ä¸Šä¸‹æ–‡æ–¹æ³•åï¼ŒFRCä¼šå›è°ƒä»£ç†æ–¹æ³•å¹¶æ›´æ–°UI
- (void)tableView:(UITableView </em>)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath <em>)indexPath {
     if (editingStyle == UITableViewCellEditingStyleDelete) {
        // åˆ é™¤æ‰˜ç®¡å¯¹è±¡
        Employee </em>emp = [fetchedResultController objectAtIndexPath:indexPath];
        [context deleteObject:emp];
        // ä¿å­˜ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶åšé”™è¯¯å¤„ç†
        NSError *error = nil;
        if (![context save:&amp;error]) {
            NSLog(@&ldquo;tableView delete cell error : %@&rdquo;, error);
        }
    }
}</p>

<p>ä¸Šé¢æ˜¯UITableViewçš„ä»£ç†æ–¹æ³•ï¼Œä»£ç†æ–¹æ³•ä¸­åµŒå¥—äº†FRCçš„æ•°æ®è·å–ä»£ç ï¼Œè¿™æ ·åœ¨åˆ·æ–°è§†å›¾æ—¶å°±å¯ä»¥ä¿è¯ä½¿ç”¨æœ€æ–°çš„æ•°æ®ã€‚å¹¶ä¸”åœ¨ä»£ç ä¸­ç®€å•å®ç°äº†åˆ é™¤cellåï¼Œé€šè¿‡MOCè°ƒç”¨åˆ é™¤æ“ä½œï¼Œä½¿æœ¬åœ°æŒä¹…åŒ–æ•°æ®å’ŒUIä¿æŒä¸€è‡´ã€‚</p>

<p>å°±åƒä¸Šé¢cellForRowAtIndexPath:æ–¹æ³•ä¸­ä½¿ç”¨çš„ä¸€æ ·ï¼ŒFRCæä¾›äº†ä¸¤ä¸ªæ–¹æ³•è½»æ¾è½¬æ¢indexPathå’ŒNSManagedObjectçš„å¯¹è±¡ï¼Œåœ¨å®é™…å¼€å‘ä¸­è¿™ä¸¤ä¸ªæ–¹æ³•éå¸¸å®ç”¨ï¼Œè¿™ä¹Ÿæ˜¯FRCå’ŒUITableViewã€UICollectionViewæ·±åº¦èåˆçš„è¡¨ç°ã€‚</p>

<ul>
<li>(id)objectAtIndexPath:(NSIndexPath *)indexPath;</li>
<li>(nullable NSIndexPath *)indexPathForObject:(id)object;</li>
</ul>


<p>Fetched Results Controller Delegate</p>

<p>// Cellæ•°æ®æºå‘ç”Ÿæ”¹å˜ä¼šå›è°ƒæ­¤æ–¹æ³•ï¼Œä¾‹å¦‚æ·»åŠ æ–°çš„æ‰˜ç®¡å¯¹è±¡ç­‰
- (void)controller:(NSFetchedResultsController <em>)controller didChangeObject:(id)anObject atIndexPath:(nullable NSIndexPath </em>)indexPath forChangeType:(NSFetchedResultsChangeType)type newIndexPath:(nullable NSIndexPath <em>)newIndexPath {
    switch (type) {
        case NSFetchedResultsChangeInsert:
            [tableView insertRowsAtIndexPaths:@[newIndexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeDelete:
            [tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeMove:
            [tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            [tableView insertRowsAtIndexPaths:@[newIndexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeUpdate: {
            UITableViewCell </em>cell = [tableView cellForRowAtIndexPath:indexPath];
            Employee <em>emp = [fetchedResultController objectAtIndexPath:indexPath];
            cell.textLabel.text = emp.name;
        }
            break;
    }
}
// Sectionæ•°æ®æºå‘ç”Ÿæ”¹å˜å›è°ƒæ­¤æ–¹æ³•ï¼Œä¾‹å¦‚ä¿®æ”¹section titleç­‰ã€‚
- (void)controller:(NSFetchedResultsController </em>)controller didChangeSection:(id <nsfetchedresultssectioninfo>)sectionInfo atIndex:(NSUInteger)sectionIndex forChangeType:(NSFetchedResultsChangeType)type {
    switch (type) {
        case NSFetchedResultsChangeInsert:
            [tableView insertSections:[NSIndexSet indexSetWithIndex:sectionIndex] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeDelete:
            [tableView deleteSections:[NSIndexSet indexSetWithIndex:sectionIndex] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        default:
            break;
    }
}
// æœ¬åœ°æ•°æ®æºå‘ç”Ÿæ”¹å˜ï¼Œå°†è¦å¼€å§‹å›è°ƒFRCä»£ç†æ–¹æ³•ã€‚
- (void)controllerWillChangeContent:(NSFetchedResultsController <em>)controller {
    [tableView beginUpdates];
}
// æœ¬åœ°æ•°æ®æºå‘ç”Ÿæ”¹å˜ï¼ŒFRCä»£ç†æ–¹æ³•å›è°ƒå®Œæˆã€‚
- (void)controllerDidChangeContent:(NSFetchedResultsController </em>)controller {
    [tableView endUpdates];
}
// è¿”å›sectionçš„titleï¼Œå¯ä»¥åœ¨è¿™é‡Œå¯¹titleåšè¿›ä¸€æ­¥å¤„ç†ã€‚è¿™é‡Œä¿®æ”¹titleåï¼Œå¯¹åº”sectionçš„indexTitleå±æ€§ä¼šè¢«æ›´æ–°ã€‚
- (nullable NSString <em>)controller:(NSFetchedResultsController </em>)controller sectionIndexTitleForSectionName:(NSString *)sectionName {
    return [NSString stringWithFormat:@&ldquo;sectionName %@&rdquo;, sectionName];
}</nsfetchedresultssectioninfo></p>

<p>ä¸Šé¢å°±æ˜¯å½“æœ¬åœ°æŒä¹…åŒ–æ•°æ®å‘ç”Ÿæ”¹å˜åï¼Œè¢«å›è°ƒçš„FRCä»£ç†æ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥åœ¨å¯¹åº”çš„å®ç°ä¸­å®Œæˆè‡ªå·±çš„ä»£ç é€»è¾‘ã€‚</p>

<p>åœ¨ä¸Šé¢çš„ç« èŠ‚ä¸­è®²åˆ°åˆ é™¤cellåï¼Œæœ¬åœ°æŒä¹…åŒ–æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚åœ¨åˆ é™¤cellååœ¨tableViewä»£ç†æ–¹æ³•çš„å›è°ƒä¸­ï¼Œè°ƒç”¨äº†MOCçš„åˆ é™¤æ–¹æ³•ï¼Œä½¿æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨å’ŒUIä¿æŒåŒæ­¥ï¼Œå¹¶å›è°ƒåˆ°ä¸‹é¢çš„FRCä»£ç†æ–¹æ³•ä¸­ï¼Œåœ¨ä»£ç†æ–¹æ³•ä¸­å¯¹UIåšåˆ é™¤æ“ä½œï¼Œè¿™æ ·ä¸€å¥—ç”±UIçš„æ”¹å˜å¼•å‘çš„åˆ é™¤æµç¨‹å°±å®Œæˆäº†ã€‚</p>

<p>ç›®å‰ä¸ºæ­¢å·²ç»å®ç°äº†æ•°æ®å’ŒUIçš„åŒå‘åŒæ­¥ï¼Œå³UIå‘ç”Ÿæ”¹å˜åæœ¬åœ°å­˜å‚¨å‘ç”Ÿæ”¹å˜ï¼Œæœ¬åœ°å­˜å‚¨å‘ç”Ÿæ”¹å˜åUIä¹Ÿéšä¹‹æ”¹å˜ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢æ·»åŠ æ•°æ®çš„ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹ï¼ŒNSFetchedResultsControllerå°±è®²åˆ°è¿™é‡Œäº†ã€‚</p>

<ul>
<li>(void)addMoreData {
  Employee <em>employee = [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;Employee&rdquo; inManagedObjectContext:context];
  employee.name = [NSString stringWithFormat:@&ldquo;lxz 15&rdquo;];
  employee.height = @(15);
  employee.brithday = [NSDate date];
  employee.sectionName = [NSString stringWithFormat:@&ldquo;3&rdquo;];
  NSError </em>error = nil;
  if (![context save:&amp;error]) {
      NSLog(@&ldquo;MOC save error : %@&rdquo;, error);
  }
}</li>
</ul>


<p>ç‰ˆæœ¬è¿ç§»</p>

<p>CoreDataç‰ˆæœ¬è¿ç§»çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆåœ¨Xcodeä¸­ï¼ŒåŸæœ‰æ¨¡å‹æ–‡ä»¶çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šåšä¸åŒæ–¹å¼çš„ç‰ˆæœ¬è¿ç§»ã€‚</p>

<p>æœ¬ç« èŠ‚å°†ä¼šè®²ä¸‰ç§ä¸åŒçš„ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆï¼Œä½†éƒ½ä¸ä¼šè®²å¤ªæ·±ï¼Œéƒ½æ˜¯ä»ä½¿ç”¨çš„è§’åº¦è®²èµ·ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°ç‰ˆæœ¬è¿ç§»çš„éœ€æ±‚ã€‚</p>

<p>ä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬è¿ç§»ï¼Ÿ</p>

<p>åœ¨å·²ç»è¿è¡Œç¨‹åºå¹¶é€šè¿‡æ¨¡å‹æ–‡ä»¶ç”Ÿæˆæ•°æ®åº“åï¼Œå†å¯¹æ¨¡å‹æ–‡ä»¶è¿›è¡Œçš„ä¿®æ”¹ï¼Œå¦‚æœåªæ˜¯ä¿®æ”¹å·²æœ‰å®ä½“å±æ€§çš„é»˜è®¤å€¼ã€æœ€å¤§æœ€å°å€¼ã€Fetch Requestç­‰å±æ€§è‡ªèº«åŒ…å«çš„å‚æ•°æ—¶ï¼Œå¹¶ä¸ä¼šå‘ç”Ÿé”™è¯¯ã€‚å¦‚æœä¿®æ”¹æ¨¡å‹æ–‡ä»¶çš„ç»“æ„ï¼Œæˆ–ä¿®æ”¹å±æ€§åã€å®ä½“åç­‰ï¼Œé€ æˆæ¨¡å‹æ–‡ä»¶çš„ç»“æ„å‘ç”Ÿæ”¹å˜ï¼Œè¿™æ ·å†æ¬¡è¿è¡Œç¨‹åºå°±ä¼šå¯¼è‡´å´©æºƒã€‚</p>

<p>åœ¨å¼€å‘æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥å°†åŸæœ‰ç¨‹åºå¸è½½å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æœ¬åœ°ä¹‹å‰å­˜å‚¨çš„æ•°æ®ä¹Ÿä¼šæ¶ˆå¤±ã€‚å¦‚æœæ˜¯çº¿ä¸Šç¨‹åºï¼Œå°±æ¶‰åŠåˆ°ç‰ˆæœ¬è¿ç§»çš„é—®é¢˜ï¼Œå¦åˆ™ä¼šå¯¼è‡´å´©æºƒï¼Œå¹¶æç¤ºå¦‚ä¸‹é”™è¯¯ï¼š</p>

<p>CoreData: error: Illegal attempt to save to a file that was never opened. &ldquo;This NSPersistentStoreCoordinator has no persistent stores (unknown).  It cannot perform a save operation.&rdquo;. No last error recorded.</p>

<p>ç„¶è€Œåœ¨éœ€æ±‚ä¸æ–­å˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œåç»­ç‰ˆæœ¬è‚¯å®šä¼šå¯¹åŸæœ‰çš„æ¨¡å‹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°ç‰ˆæœ¬è¿ç§»çš„æŠ€æœ¯ï¼Œä¸‹é¢å¼€å§‹è®²ç‰ˆæœ¬è¿ç§»çš„æ–¹æ¡ˆã€‚</p>

<p>åˆ›å»ºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶</p>

<p>æœ¬æ–‡ä¸­è®²çš„å‡ ç§ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆï¼Œåœ¨è¿ç§»ä¹‹å‰éƒ½éœ€è¦å¯¹åŸæœ‰çš„æ¨¡å‹æ–‡ä»¶åˆ›å»ºæ–°ç‰ˆæœ¬ã€‚</p>

<p>é€‰ä¸­éœ€è¦åšè¿ç§»çš„æ¨¡å‹æ–‡ä»¶ -> ç‚¹å‡»èœå•æ Editor -> Add Model Version -> é€‰æ‹©åŸºäºå“ªä¸ªç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶(ä¸€èˆ¬éƒ½æ˜¯é€‰æ‹©ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬)ï¼Œæ–°å»ºæ¨¡å‹æ–‡ä»¶å®Œæˆã€‚</p>

<p>å¯¹äºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶çš„å‘½åï¼Œæˆ‘åœ¨åˆ›å»ºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶æ—¶ï¼Œä¸€èˆ¬ä¼šæ‹¿å½“å‰å·¥ç¨‹ç‰ˆæœ¬å·å½“åšåç¼€ï¼Œè¿™æ ·åœ¨æ¨¡å‹æ–‡ä»¶ç‰ˆæœ¬æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“å°†æ¨¡å‹æ–‡ä»¶ç‰ˆæœ¬å’Œå·¥ç¨‹ç‰ˆæœ¬å¯¹åº”èµ·æ¥ã€‚</p>

<p><img src="/images/4003.png" title="Caption" ></p>

<p>åˆ›å»ºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶</p>

<p>æ·»åŠ å®Œæˆåï¼Œä¼šå‘ç°ä¹‹å‰çš„æ¨¡å‹æ–‡ä»¶ä¼šå˜æˆä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«ç€å¤šä¸ªæ¨¡å‹æ–‡ä»¶ã€‚</p>

<p><img src="/images/4004.png" title="Caption" >
æ¨¡å‹æ–‡ä»¶å¤¹</p>

<p>åœ¨æ–°å»ºçš„æ¨¡å‹æ–‡ä»¶ä¸­ï¼Œé‡Œé¢çš„æ–‡ä»¶ç»“æ„å’Œä¹‹å‰çš„æ–‡ä»¶ç»“æ„ç›¸åŒã€‚åç»­çš„ä¿®æ”¹éƒ½åº”è¯¥åœ¨æ–°çš„æ¨¡å‹æ–‡ä»¶ä¸Šï¼Œä¹‹å‰çš„æ¨¡å‹æ–‡ä»¶ä¸è¦å†åŠ¨äº†ï¼Œåœ¨ä¿®æ”¹å®Œæ¨¡å‹æ–‡ä»¶åï¼Œè®°å¾—æ›´æ–°å¯¹åº”çš„æ¨¡å‹ç±»æ–‡ä»¶ã€‚</p>

<p>åŸºäºæ–°çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¯¹Employeeå®ä½“åšå¦‚ä¸‹ä¿®æ”¹ï¼Œä¸‹é¢çš„ç‰ˆæœ¬è¿ç§»ä¹Ÿä»¥æ­¤ä¸ºä¾‹ã€‚</p>

<p><img src="/images/4005.png" title="Caption" ></p>

<p>ä¿®æ”¹ä¹‹å‰</p>

<p>æ·»åŠ ä¸€ä¸ªStringç±»å‹çš„å±æ€§ï¼Œè®¾ç½®å±æ€§åä¸ºsectionNameã€‚</p>

<p><img src="/images/4006.png" title="Caption" ></p>

<p>ä¿®æ”¹ä¹‹å</p>

<p>æ­¤æ—¶è¿˜åº”è¯¥é€‰ä¸­æ¨¡å‹æ–‡ä»¶ï¼Œè®¾ç½®å½“å‰æ¨¡å‹æ–‡ä»¶çš„ç‰ˆæœ¬ã€‚è¿™é‡Œé€‰æ‹©å°†æœ€æ–°ç‰ˆæœ¬è®¾ç½®ä¸ºåˆšæ‰æ–°å»ºçš„1.1.0ç‰ˆæœ¬ï¼Œæ¨¡å‹æ–‡ä»¶è®¾ç½®å·¥ä½œå®Œæˆã€‚</p>

<p>Show The File Inspector -> Model Version -> Current è®¾ç½®ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚</p>

<p><img src="/images/4007.png" title="Caption" ></p>

<p>è®¾ç½®ç‰ˆæœ¬</p>

<p>å¯¹æ¨¡å‹æ–‡ä»¶çš„è®¾ç½®å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥ç³»ç»Ÿè¿˜è¦çŸ¥é“æˆ‘ä»¬æƒ³è¦æ€æ ·è¿ç§»æ•°æ®ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå­˜åœ¨å¤šç§å¯èƒ½ï¼Œè‹¹æœå°†è¿™ä¸ªçµæ´»æ€§ç•™ç»™äº†æˆ‘ä»¬å®Œæˆã€‚å‰©ä¸‹è¦åšçš„å°±æ˜¯ç¼–å†™è¿ç§»æ–¹æ¡ˆä»¥åŠç»†èŠ‚çš„ä»£ç ã€‚</p>

<p>è½»é‡çº§ç‰ˆæœ¬è¿ç§»</p>

<p>è½»é‡çº§ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆéå¸¸ç®€å•ï¼Œå¤§å¤šæ•°è¿ç§»å·¥ä½œéƒ½æ˜¯ç”±ç³»ç»Ÿå®Œæˆçš„ï¼Œåªéœ€è¦å‘Šè¯‰ç³»ç»Ÿè¿ç§»æ–¹å¼å³å¯ã€‚åœ¨æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨(PSC)åˆå§‹åŒ–å¯¹åº”çš„æŒä¹…åŒ–å­˜å‚¨(NSPersistentStore)å¯¹è±¡æ—¶ï¼Œè®¾ç½®optionså‚æ•°å³å¯ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ã€‚PSCä¼šæ ¹æ®ä¼ å…¥çš„å­—å…¸ï¼Œè‡ªåŠ¨æ¨æ–­ç‰ˆæœ¬è¿ç§»çš„è¿‡ç¨‹ã€‚</p>

<p>å­—å…¸ä¸­è®¾ç½®çš„keyï¼š</p>

<pre><code>NSMigratePersistentStoresAutomaticallyOptionè®¾ç½®ä¸ºYESï¼ŒCoreDataä¼šè¯•ç€æŠŠä½ç‰ˆæœ¬çš„æŒä¹…åŒ–å­˜å‚¨åŒºè¿ç§»åˆ°æœ€æ–°ç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶ã€‚

NSInferMappingModelAutomaticallyOptionè®¾ç½®ä¸ºYESï¼ŒCoreDataä¼šè¯•ç€ä»¥æœ€ä¸ºåˆç†åœ°æ–¹å¼è‡ªåŠ¨æ¨æ–­å‡ºæºæ¨¡å‹æ–‡ä»¶çš„å®ä½“ä¸­ï¼ŒæŸä¸ªå±æ€§åˆ°åº•å¯¹åº”äºç›®æ ‡æ¨¡å‹æ–‡ä»¶å®ä½“ä¸­çš„å“ªä¸€ä¸ªå±æ€§ã€‚
</code></pre>

<p>ç‰ˆæœ¬è¿ç§»çš„è®¾ç½®æ˜¯åœ¨åˆ›å»ºMOCæ—¶ç»™PSCè®¾ç½®çš„ï¼Œä¸ºäº†ä½¿ä»£ç æ›´ç›´è§‚ï¼Œä¸‹é¢åªç»™å‡ºå‘ç”Ÿå˜åŒ–éƒ¨åˆ†çš„ä»£ç ï¼Œå…¶ä»–MOCçš„åˆå§‹åŒ–ä»£ç éƒ½ä¸å˜ã€‚</p>

<p>// è®¾ç½®ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆ
NSDictionary *options = @{NSMigratePersistentStoresAutomaticallyOption : @YES,
                                NSInferMappingModelAutomaticallyOption : @YES};
// åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨ï¼Œå¹¶å°†è¿ç§»æ–¹æ¡ˆçš„å­—å…¸å½“åšå‚æ•°ä¼ å…¥
[coordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[NSURL fileURLWithPath:dataPath] options:options error:nil];</p>

<p>ä¿®æ”¹å®ä½“å</p>

<p>å‡è®¾éœ€è¦å¯¹å·²å­˜åœ¨å®ä½“è¿›è¡Œæ”¹åæ“ä½œï¼Œéœ€è¦å°†é‡å‘½ååçš„å®ä½“Renaming IDï¼Œè®¾ç½®ä¸ºä¹‹å‰çš„å®ä½“åã€‚ä¸‹é¢æ˜¯Employeeå®ä½“è¿›è¡Œæ“ä½œã€‚</p>

<p><img src="/images/4008.png" title="Caption" ></p>

<p>ä¿®æ”¹å®ä½“å</p>

<p>ä¿®æ”¹åå†ä½¿ç”¨å®ä½“æ—¶ï¼Œåº”è¯¥å°†å®ä½“åè®¾ä¸ºæœ€æ–°çš„å®ä½“åï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯Employee2ï¼Œè€Œä¸”æ•°æ®åº“ä¸­çš„æ•°æ®ä¹Ÿä¼šè¿ç§»åˆ°Employee2è¡¨ä¸­ã€‚</p>

<p>Employee2 *emp = [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;Employee2&rdquo; inManagedObjectContext:context];
emp.name = @&ldquo;lxz&rdquo;;
emp.brithday = [NSDate date];
emp.height = @1.9;
[context save:nil];</p>

<p>Mapping Model è¿ç§»æ–¹æ¡ˆ</p>

<p>è½»é‡çº§è¿ç§»æ–¹æ¡ˆåªæ˜¯é’ˆå¯¹å¢åŠ å’Œæ”¹å˜å®ä½“ã€å±æ€§è¿™æ ·çš„ä¸€äº›ç®€å•æ“ä½œï¼Œå‡è®¾æœ‰æ›´å¤æ‚çš„è¿ç§»éœ€æ±‚ï¼Œå°±åº”è¯¥ä½¿ç”¨Xcodeæä¾›çš„è¿ç§»æ¨¡æ¿(Mapping Model)ã€‚é€šè¿‡Xcodeåˆ›å»ºä¸€ä¸ªåç¼€ä¸º.xcmappingmodelçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸“é—¨ç”¨æ¥è¿›è¡Œæ•°æ®è¿ç§»ç”¨çš„ï¼Œä¸€äº›å˜åŒ–å…³ç³»ä¹Ÿä¼šä½“ç°åœ¨æ¨¡æ¿ä¸­ï¼Œçœ‹èµ·æ¥éå¸¸ç›´è§‚ã€‚</p>

<p>è¿™é‡Œè¿˜ä»¥ä¸Šé¢æ›´æ”¹å®ä½“åï¼Œå¹¶è¿ç§»å®ä½“æ•°æ®ä¸ºä¾‹å­ï¼Œå°†Employeeå®ä½“è¿ç§»åˆ°Employee2ä¸­ã€‚é¦–å…ˆå°†Employeeå®ä½“æ”¹åä¸ºEmployee2ï¼Œç„¶ååˆ›å»ºMapping Modelæ–‡ä»¶ã€‚</p>

<p>Command + N æ–°å»ºæ–‡ä»¶ -> é€‰æ‹© Mapping Model -> é€‰æ‹©æºæ–‡ä»¶ Source Model -> é€‰æ‹©ç›®æ ‡æ–‡ä»¶ Target Model -> å‘½å Mapping Model æ–‡ä»¶å -> Create åˆ›å»ºå®Œæˆã€‚</p>

<p><img src="/images/4009.png" title="Caption" ></p>

<p>Mapping Model æ–‡ä»¶</p>

<p>ç°åœ¨å°±åˆ›å»ºå¥½ä¸€ä¸ªMapping Modelæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æ˜¾ç¤ºäº†å®ä½“ã€å±æ€§ã€Relationshipsï¼Œæºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶ä¹‹é—´çš„å…³ç³»ã€‚å®ä½“å‘½åæ˜¯EntityToEntityçš„æ–¹å¼å‘½åçš„ï¼Œå®ä½“åŒ…å«çš„å±æ€§å’Œå…³è”å…³ç³»ï¼Œéƒ½ä¼šè¢«æ·»åŠ åˆ°è¿ç§»æ–¹æ¡ˆä¸­(Entity Mappingï¼ŒAttribute Mappingï¼ŒRelationship Mapping)ã€‚</p>

<p>åœ¨è¿ç§»æ–‡ä»¶çš„ä¸‹æ–¹æ˜¯æºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶çš„å…³ç³»ã€‚</p>

<p><img src="/images/4010.png" title="Caption" ></p>

<p>å¯¹åº”å…³ç³»</p>

<p>åœ¨ä¸Šé¢å›¾ä¸­æ”¹ååçš„Employee2å®ä½“å¹¶æ²¡æœ‰è¿ç§»å…³ç³»ï¼Œç”±äºæ˜¯æ”¹ååçš„å®ä½“ï¼Œç³»ç»Ÿè¿˜ä¸çŸ¥é“å®ä½“åº”è¯¥æ€æ ·åšè¿ç§»ã€‚æ‰€ä»¥é€‰ä¸­Mapping Modelæ–‡ä»¶çš„Employee2 Mappingsï¼Œå¯ä»¥çœ‹åˆ°å³ä¾§è¾¹æ çš„Sourceä¸ºinvalid valueã€‚å› ä¸ºè¦ä»Employeeå®ä½“è¿ç§»æ•°æ®è¿‡æ¥ï¼Œæ‰€ä»¥å°†å…¶é€‰æ‹©ä¸ºEmployeeï¼Œè¿ç§»å…³ç³»å°±è®¾ç½®å®Œæˆäº†ã€‚</p>

<p>è®¾ç½®å®Œæˆåï¼Œè¿˜åº”è¯¥å°†ä¹‹å‰EmployeeToEmployeeçš„Mappingsåˆ é™¤ï¼Œå› ä¸ºè¿™ä¸ªå®ä½“å·²ç»è¢«Employee2æ›¿ä»£ï¼Œå®ƒçš„Mappingsä¹Ÿè¢«Employee2 Mappingsæ‰€æ›¿ä»£ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>

<p><img src="/images/4011.png" title="Caption" ></p>

<p>è®¾ç½®è¿ç§»å…³ç³»</p>

<p>åœ¨å®ä½“çš„è¿ç§»è¿‡ç¨‹ä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡è®¾ç½®Predicateçš„æ–¹å¼ï¼Œæ¥ç®€å•çš„æ§åˆ¶è¿ç§»è¿‡ç¨‹ã€‚ä¾‹å¦‚åªéœ€è¦è¿ç§»ä¸€éƒ¨åˆ†æŒ‡å®šçš„æ•°æ®ï¼Œå°±å¯ä»¥é€šè¿‡Predicateæ¥æŒ‡å®šã€‚å¯ä»¥ç›´æ¥åœ¨å³ä¾§Filter Predicateçš„ä½ç½®è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œæ ¼å¼æ˜¯$source.height &lt; 100ï¼Œ$sourceä»£è¡¨æ•°æ®æºçš„å®ä½“ã€‚</p>

<p><img src="/images/4012.png" title="Caption" ></p>

<p>Filter Predicate</p>

<p>æ›´å¤æ‚çš„è¿ç§»éœ€æ±‚</p>

<p>å¦‚æœè¿˜å­˜åœ¨æ›´å¤æ‚çš„è¿ç§»éœ€æ±‚ï¼Œè€Œä¸”ä¸Šé¢çš„è¿ç§»æ–¹å¼ä¸èƒ½æ»¡è¶³ï¼Œå¯ä»¥è€ƒè™‘æ›´å¤æ‚çš„è¿ç§»æ–¹å¼ã€‚å‡è®¾è¦åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå¯¹è¿ç§»çš„æ•°æ®è¿›è¡Œæ›´æ”¹ï¼Œè¿™æ—¶å€™ä¸Šé¢çš„è¿ç§»æ–¹æ¡ˆå°±ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†ã€‚</p>

<p>å¯¹äºä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œåœ¨Mapping Modelæ–‡ä»¶ä¸­é€‰ä¸­å®ä½“ï¼Œå¯ä»¥çœ‹åˆ°Custom Policyè¿™ä¸ªé€‰é¡¹ï¼Œé€‰é¡¹å¯¹åº”çš„æ˜¯NSEntityMigrationPolicyçš„å­ç±»ï¼Œå¯ä»¥åˆ›å»ºå¹¶è®¾ç½®ä¸€ä¸ªå­ç±»ï¼Œå¹¶é‡å†™è¿™ä¸ªç±»çš„æ–¹æ³•æ¥æ§åˆ¶è¿ç§»è¿‡ç¨‹ã€‚</p>

<ul>
<li>(BOOL)createDestinationInstancesForSourceInstance:(NSManagedObject <em>)sInstance entityMapping:(NSEntityMapping </em>)mapping manager:(NSMigrationManager *)manager error:(NSError **)error;</li>
</ul>


<p>ç‰ˆæœ¬è¿ç§»æ€»ç»“</p>

<p>ç‰ˆæœ¬è¿ç§»åœ¨éœ€æ±‚çš„å˜æ›´ä¸­è‚¯å®šæ˜¯è¦å‘ç”Ÿçš„ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…è¿™æ ·çš„æƒ…å†µå‘ç”Ÿã€‚åœ¨æœ€å¼€å§‹è®¾è®¡æ¨¡å‹æ–‡ä»¶æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå°±åº”è¯¥è®¾è®¡ä¸€ä¸ªæ¯”è¾ƒå®Œå–„å¹¶ä¸”å®¹æ˜“åº”å¯¹å˜åŒ–çš„ç»“æ„ï¼Œè¿™æ ·åé¢å°±ç®—å‘ç”Ÿå˜åŒ–ä¹Ÿä¸ä¼šå¯¹ç»“æ„ä¸»ä½“é€ æˆå¤§çš„æ”¹åŠ¨ã€‚</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/04/coredatechaiyousa/">CoreDataè¿˜æœ‰æ’’ï¼Ÿ</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-04T06:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:59 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ä¹‹å‰ä¸¤ç¯‡æ–‡ç« éƒ½æ¯”è¾ƒåç†è®ºï¼Œæ–‡å­—è¡¨è¾¾æ¯”è¾ƒå¤šä¸€äº›ï¼Œä½†éƒ½æ˜¯å¹²è´§ï¼å­¦ä¹ æ—¶å…ˆç†è§£ç†è®ºçŸ¥è¯†ï¼Œæ‰èƒ½æ›´å¥½çš„å¸®åŠ©åé¢çš„ç†è§£ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå°†ä¼šæ¶‰åŠå…³äºCoreDataçš„ä¸€äº›å¤æ‚æ“ä½œï¼Œè¿™äº›æ“ä½œä¼šæ¶‰åŠåˆ†é¡µæŸ¥è¯¢ã€æ¨¡ç³ŠæŸ¥è¯¢ã€æ‰¹å¤„ç†ç­‰é«˜çº§æ“ä½œã€‚é€šè¿‡è¿™äº›æ“ä½œå¯ä»¥æ›´å¥½çš„ä½¿ç”¨CoreDataï¼Œæå‡CoreDataæ€§èƒ½ã€‚æ–‡ç« ä¸­å°†ä¼šå‡ºç°å¤§é‡ç¤ºä¾‹ä»£ç ï¼Œé€šè¿‡ä»£ç çš„æ–¹å¼æ›´æœ‰åŠ©äºç†è§£ã€‚</p>

<p>æ–‡ç« å†…å®¹è¿˜ä¼šæ¯”è¾ƒå¤šï¼Œå¸Œæœ›å„ä½è€å¿ƒçœ‹å®Œã€‚æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼</p>

<p>NSPredicate</p>

<p>æ¦‚è¿°</p>

<p>åœ¨iOSå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šéœ€æ±‚éƒ½éœ€è¦ç”¨åˆ°è¿‡æ»¤æ¡ä»¶ã€‚ä¾‹å¦‚è¿‡æ»¤ä¸€ä¸ªé›†åˆå¯¹è±¡ä¸­å­˜å‚¨çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡Foundationæ¡†æ¶ä¸‹çš„NSPredicateç±»æ¥æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</p>

<p>CoreDataä¸­å¯ä»¥é€šè¿‡è®¾ç½®NSFetchRequestç±»çš„predicateå±æ€§ï¼Œæ¥è®¾ç½®ä¸€ä¸ªNSPredicateç±»å‹çš„è°“è¯å¯¹è±¡å½“åšè¿‡æ»¤æ¡ä»¶ã€‚é€šè¿‡è®¾ç½®è¿™ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œå¯ä»¥åªè·å–ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä¸ä¼šå°†æ‰€æœ‰æ‰˜ç®¡å¯¹è±¡éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·æ˜¯éå¸¸èŠ‚çœå†…å­˜å’ŒåŠ å¿«æŸ¥æ‰¾é€Ÿåº¦çš„ï¼Œè®¾è®¡ä¸€ä¸ªå¥½çš„NSPredicateå¯ä»¥ä¼˜åŒ–CoreDataæœç´¢æ€§èƒ½ã€‚</p>

<p>è¯­æ³•</p>

<p>NSPredicateæ›´åŠ åå‘äºè‡ªç„¶è¯­è¨€ï¼Œä¸åƒSQLiteä¸€æ ·æœ‰å¾ˆå¤šå›ºå®šçš„è¯­æ³•ï¼Œçœ‹èµ·æ¥ä¹Ÿæ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚ä¾‹å¦‚ä¸‹é¢éœ€è¦æŸ¥æ‰¾æ¡ä»¶ä¸ºå¹´é¾„30å²ä»¥ä¸Šï¼Œå¹¶ä¸”åŒ…æ‹¬30å²çš„æ¡ä»¶ã€‚
1</p>

<p>[NSPredicate predicateWithFormat:@&ldquo;age >= 30&rdquo;]</p>

<p>è¿‡æ»¤é›†åˆå¯¹è±¡</p>

<p>å¯ä»¥é€šè¿‡NSPredicateå¯¹iOSä¸­çš„é›†åˆå¯¹è±¡æ‰§è¡Œè¿‡æ»¤æ“ä½œï¼Œå¯ä»¥æ˜¯NSArrayã€NSSetåŠå…¶å­ç±»ã€‚</p>

<p>å¯¹ä¸å¯å˜æ•°ç»„NSArrayæ‰§è¡Œçš„è¿‡æ»¤ï¼Œè¿‡æ»¤åä¼šè¿”å›ä¸€ä¸ªNSArrayç±»å‹çš„ç»“æœæ•°ç»„ï¼Œå…¶ä¸­å­˜å‚¨ç€ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„å¯¹è±¡ã€‚
1</p>

<p>NSArray *results = [array filteredArrayUsingPredicate:predicate]</p>

<p>å¯¹å¯å˜æ•°ç»„NSMutableArrayæ‰§è¡Œçš„è¿‡æ»¤æ¡ä»¶ï¼Œè¿‡æ»¤åä¼šç›´æ¥æ”¹å˜åŸé›†åˆå¯¹è±¡å†…éƒ¨å­˜å‚¨çš„å¯¹è±¡ï¼Œåˆ é™¤ä¸ç¬¦åˆæ¡ä»¶çš„å¯¹è±¡ã€‚
1</p>

<p>[arrayM filterUsingPredicate:predicate]</p>

<p>å¤åˆè¿‡æ»¤æ¡ä»¶</p>

<p>è°“è¯ä¸åªå¯ä»¥è¿‡æ»¤ç®€å•æ¡ä»¶ï¼Œè¿˜å¯ä»¥è¿‡æ»¤å¤æ‚æ¡ä»¶ï¼Œè®¾ç½®å¤åˆè¿‡æ»¤æ¡ä»¶ã€‚
1</p>

<p>[NSPredicate predicateWithFormat:@&ldquo;(age &lt; 25) AND (firstName = XiaoZhuang)&rdquo;]</p>

<p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡NSCompoundPredicateå¯¹è±¡æ¥è®¾ç½®å¤åˆè¿‡æ»¤æ¡ä»¶ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªNSPredicateçš„å­ç±»NSCompoundPredicateå¯¹è±¡ã€‚
1</p>

<p>[[NSCompoundPredicate alloc] initWithType:NSAndPredicateType subpredicates:@[predicate1, predicate2]]</p>

<p>æšä¸¾å€¼NSCompoundPredicateTypeå‚æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸‰ç§å¤åˆæ¡ä»¶ï¼Œæšä¸¾å€¼éå¸¸ç›´è§‚å¾ˆå®¹æ˜“çœ‹æ‡‚ã€‚</p>

<pre><code>NSNotPredicateType

NSAndPredicateType

NSOrPredicateType
</code></pre>

<p>åŸºç¡€è¯­æ³•</p>

<p>ä¸‹é¢æ˜¯åˆ—ä¸¾çš„ä¸€äº›NSPredicateçš„åŸºç¡€è¯­æ³•ï¼Œè¿™äº›è¯­æ³•çœ‹èµ·æ¥éå¸¸å®¹æ˜“ç†è§£ï¼Œæ›´å¤æ‚çš„ç”¨æ³•å¯ä»¥å»çœ‹è‹¹æœçš„å®˜æ–¹APIã€‚</p>

<p><img src="/images/3001.png" title="Caption" ></p>

<p>æ­£åˆ™è¡¨è¾¾å¼</p>

<p>NSPredicateä¸­è¿˜å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å®Œæˆä¸€äº›å¤æ‚éœ€æ±‚ï¼Œè¿™ä½¿å¾—è°“è¯çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œä¾‹å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰‹æœºå·éªŒè¯çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
1
2</p>

<p>NSString <em>mobile = @&ldquo;^1(3[0-9]|5[0-35-9]|8[025-9])\d{8}$&rdquo;;
NSPredicate </em>regexmobile = [NSPredicate predicateWithFormat:@&ldquo;SELF MATCHES %@&rdquo;, mobile];</p>

<p>æ¨¡ç³ŠæŸ¥è¯¢</p>

<p>NSPredicateæ”¯æŒå¯¹æ•°æ®çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¾‹å¦‚ä¸‹é¢ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…åŒ…å«lxzçš„ç»“æœï¼Œå…·ä½“CoreDataä¸­çš„ä½¿ç”¨åœ¨ä¸‹é¢ä¼šè®²åˆ°ã€‚
1</p>

<p>[NSPredicate predicateWithFormat:@&ldquo;name LIKE %@&rdquo;, @&ldquo;<em>lxz</em>&rdquo;]</p>

<p>keyPath</p>

<p>NSPredicateåœ¨åˆ›å»ºæŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œè¿˜æ”¯æŒè®¾ç½®è¢«åŒ¹é…ç›®æ ‡çš„keyPathï¼Œä¹Ÿå°±æ˜¯è®¾ç½®æ›´æ·±å±‚è¢«åŒ¹é…çš„ç›®æ ‡ã€‚ä¾‹å¦‚ä¸‹é¢è®¾ç½®employeeçš„nameå±æ€§ä¸ºæŸ¥æ‰¾æ¡ä»¶ï¼Œå°±æ˜¯ç”¨ç‚¹è¯­æ³•è®¾ç½®çš„keyPathã€‚
1</p>

<p>[NSPredicate predicateWithFormat:@&ldquo;employee.name = %@&rdquo;, @&ldquo;lxz&rdquo;]</p>

<p>è®¾ç½®æŸ¥è¯¢æ¡ä»¶</p>

<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæ‰§è¡Œä¸‹é¢MOCçš„fetchRequestæ–¹æ³•ï¼Œä¸€èˆ¬éƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ªNSFetchRequestç±»å‹çš„å‚æ•°ã€‚è¿™ä¸ªrequestå‚æ•°å¯ä»¥åšä¸€äº›è®¾ç½®æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥ä»¥è¾ƒä¼˜çš„æ€§èƒ½è·å–æŒ‡å®šçš„æ•°æ®ã€‚
1</p>

<ul>
<li>(nullable NSArray <em>)executeFetchRequest:(NSFetchRequest </em>)request error:(NSError **)error;</li>
</ul>


<p>NSFetchRequest</p>

<p>åœ¨æ‰§è¡Œfetchæ“ä½œå‰ï¼Œå¯ä»¥ç»™NSFetchRequestè®¾ç½®ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°åŒ…æ‹¬è°“è¯ã€æ’åºç­‰æ¡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€äº›åŸºç¡€çš„è®¾ç½®ã€‚</p>

<pre><code>è®¾ç½®æŸ¥æ‰¾å“ªä¸ªå®ä½“ï¼Œä»æ•°æ®åº“çš„è§’åº¦æ¥çœ‹å°±æ˜¯æŸ¥æ‰¾å“ªå¼ è¡¨ï¼Œé€šè¿‡fetchRequestWithEntityName:æˆ–åˆå§‹åŒ–æ–¹æ³•æ¥æŒ‡å®šè¡¨åã€‚

é€šè¿‡NSPredicateç±»å‹çš„å±æ€§ï¼Œå¯ä»¥è®¾ç½®æŸ¥æ‰¾æ¡ä»¶ï¼Œè¿™ä¸ªå±æ€§åœ¨å¼€å‘ä¸­ç”¨å¾—æœ€å¤šã€‚NSPredicateå¯ä»¥åŒ…æ‹¬å›ºå®šæ ¼å¼çš„æ¡ä»¶ä»¥åŠæ­£åˆ™è¡¨è¾¾å¼ã€‚

é€šè¿‡sortDescriptorså±æ€§ï¼Œå¯ä»¥è®¾ç½®è·å–ç»“æœæ•°ç»„çš„æ’åºæ–¹å¼ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è®¾ç½®å¤šç§æ’åºæ¡ä»¶ã€‚(ä½†æ˜¯æ³¨æ„æ¡ä»¶ä¸è¦å†²çª)

é€šè¿‡fetchOffsetå±æ€§è®¾ç½®ä»æŸ¥è¯¢ç»“æœçš„ç¬¬å‡ ä¸ªå¼€å§‹è·å–ï¼Œé€šè¿‡fetchLimitå±æ€§è®¾ç½®æ¯æ¬¡è·å–å¤šå°‘ä¸ªã€‚ä¸»è¦ç”¨äºåˆ†é¡µæŸ¥è¯¢ï¼Œåé¢ä¼šè®²ã€‚
</code></pre>

<p>MOCæ‰§è¡Œfetchæ“ä½œåï¼Œè·å–çš„ç»“æœæ˜¯ä»¥æ•°ç»„çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„å°±æ˜¯æ‰˜ç®¡å¯¹è±¡ã€‚NSFetchRequestæä¾›äº†å‚æ•°resultTypeï¼Œå‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥è®¾ç½®æ‰§è¡Œfetchæ“ä½œåè¿”å›çš„æ•°æ®ç±»å‹ã€‚</p>

<pre><code>NSManagedObjectResultType: è¿”å›å€¼æ˜¯NSManagedObjectçš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯æ‰˜ç®¡å¯¹è±¡ï¼Œè¿™æ˜¯é»˜è®¤é€‰é¡¹

NSManagedObjectIDResultType: è¿”å›NSManagedObjectIDç±»å‹çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯NSManagedObjectçš„IDï¼Œå¯¹å†…å­˜å ç”¨æ¯”è¾ƒå°ã€‚MOCå¯ä»¥é€šè¿‡NSManagedObjectIDå¯¹è±¡è·å–å¯¹åº”çš„æ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç¼“å­˜NSManagedObjectIDå‚æ•°æ¥èŠ‚çœå†…å­˜æ¶ˆè€—

NSDictionaryResultType: è¿”å›å­—å…¸ç±»å‹å¯¹è±¡

NSCountResultType: è¿”å›è¯·æ±‚ç»“æœçš„countå€¼ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å‘ç”Ÿåœ¨æ•°æ®åº“å±‚çº§çš„ï¼Œå¹¶ä¸éœ€è¦å°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­
</code></pre>

<p>è®¾ç½®è·å–æ¡ä»¶</p>

<p>// å»ºç«‹è·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// è®¾ç½®è¯·æ±‚æ¡ä»¶ï¼Œé€šè¿‡è®¾ç½®çš„æ¡ä»¶ï¼Œæ¥è¿‡æ»¤å‡ºéœ€è¦çš„æ•°æ®
NSPredicate </em>predicate = [NSPredicate predicateWithFormat:@&ldquo;name = %@&rdquo;, @&ldquo;lxz&rdquo;];
request.predicate = predicate;
// è®¾ç½®è¯·æ±‚ç»“æœæ’åºæ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–ä¸€ç»„æ’åºæ–¹å¼ï¼Œæœ€åå°†æ‰€æœ‰çš„æ’åºæ–¹å¼æ·»åŠ åˆ°æ’åºæ•°ç»„ä¸­
NSSortDescriptor <em>sort = [NSSortDescriptor sortDescriptorWithKey:@&ldquo;height&rdquo; ascending:YES];
// NSSortDescriptorçš„æ“ä½œéƒ½æ˜¯åœ¨SQLiteå±‚çº§å®Œæˆçš„ï¼Œä¸ä¼šå°†å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥å¯¹å†…å­˜çš„æ¶ˆè€—æ˜¯éå¸¸å°çš„
request.sortDescriptors = @[sort];
// æ‰§è¡Œè·å–è¯·æ±‚æ“ä½œï¼Œè·å–çš„æ‰˜ç®¡å¯¹è±¡å°†ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­å¹¶è¿”å›
NSError </em>error = nil;
NSArray *employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    NSLog(@&ldquo;Employee Name : %@, Height : %@, Brithday : %@&rdquo;, obj.name, obj.height, obj.brithday);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;CoreData Fetch Data Error : %@&rdquo;, error);
}</p>

<p>è¿™é‡Œè®¾ç½®NSFetchRequestå¯¹è±¡çš„ä¸€äº›è¯·æ±‚æ¡ä»¶ï¼Œè®¾ç½®æŸ¥æ‰¾Employeeè¡¨ä¸­nameä¸ºlxzçš„æ•°æ®ï¼Œå¹¶ä¸”å°†æ‰€æœ‰ç¬¦åˆçš„æ•°æ®ç”¨heightå€¼å‡åºçš„æ–¹å¼æ’åˆ—ã€‚</p>

<p>æœ‰å®ä½“å…³è”å…³ç³»</p>

<p>ä¸€ä¸ªæ¨¡å‹æ–‡ä»¶ä¸­çš„ä¸åŒå®ä½“é—´ï¼Œå¯ä»¥è®¾ç½®å®ä½“é—´çš„å…³è”å…³ç³»ï¼Œè¿™ä¸ªåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è®²è¿‡ã€‚å®ä½“å…³è”å…³ç³»åˆ†ä¸ºå¯¹ä¸€æˆ–å¯¹å¤šï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ˜¯å¦åŒå‘å…³è”ã€‚</p>

<p>è¿™é‡Œæ¼”ç¤ºçš„å®ä½“åªæ˜¯ç®€å•çš„To Oneçš„å…³ç³»ï¼Œå¹¶ä¸”ä¸‹é¢ä¼šç»™å‡ºè®¾ç½®æ˜¯å¦åŒå‘å…³è”çš„åŒºåˆ«å¯¹æ¯”ã€‚</p>

<p>æ’å…¥å®ä½“</p>

<p>// åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶å°†å…¶å…³è”åˆ°æŒ‡å®šçš„MOCä¸Š
Employee <em>zsEmployee = [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;Employee&rdquo; inManagedObjectContext:context];
zsEmployee.name = @&ldquo;zhangsan&rdquo;;
zsEmployee.height = @1.9f;
zsEmployee.brithday = [NSDate date];
Employee </em>lsEmployee = [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;Employee&rdquo; inManagedObjectContext:context];
lsEmployee.name = @&ldquo;lisi&rdquo;;
lsEmployee.height = @1.7f;
lsEmployee.brithday = [NSDate date];
Department <em>iosDepartment = [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;Department&rdquo; inManagedObjectContext:context];
iosDepartment.departName = @&ldquo;iOS&rdquo;;
iosDepartment.createDate = [NSDate date];
iosDepartment.employee = zsEmployee;
Department </em>androidDepartment = [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;Department&rdquo; inManagedObjectContext:context];
androidDepartment.departName = @&ldquo;android&rdquo;;
androidDepartment.createDate = [NSDate date];
androidDepartment.employee = lsEmployee;
// æ‰§è¡Œå­˜å‚¨æ“ä½œ
NSError *error = nil;
if (context.hasChanges) {
    [context save:&amp;error];
}
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;Association Table Add Data Error : %@&rdquo;, error);
}</p>

<p>ä¸Šé¢åˆ›å»ºäº†å››ä¸ªå®ä½“ï¼Œå¹¶ä¸”å°†Employeeéƒ½å…³è”åˆ°Departmentä¸Šï¼Œå®Œæˆå…³è”æ“ä½œåé€šè¿‡MOCå­˜å‚¨åˆ°æœ¬åœ°ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢æ‰€æœ‰çš„æ‰˜ç®¡å¯¹è±¡åˆ›å»ºæ—¶ï¼Œéƒ½ä½¿ç”¨NSEntityDescriptionçš„insertæ–¹æ³•åˆ›å»ºï¼Œå¹¶å’Œä¸Šä¸‹æ–‡å»ºç«‹å…³ç³»ã€‚è¿™æ—¶å°±æƒ³é—®äº†ï¼Œæˆ‘èƒ½ç›´æ¥é‡‡ç”¨ä¼ ç»Ÿçš„initæ–¹æ³•åˆ›å»ºå—ï¼Ÿ</p>

<p>ä¼šå´©çš„ï¼åˆ›å»ºæ‰˜ç®¡å¯¹è±¡æ—¶éœ€è¦æŒ‡å®šMOCï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€çš„ç”Ÿæˆsetã€getæ–¹æ³•ã€‚ä½†æ˜¯ç›´æ¥é€šè¿‡initæ–¹æ³•åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œç³»ç»Ÿæ˜¯ä¸çŸ¥é“è¿™é‡Œæ˜¯éœ€è¦ç³»ç»Ÿè‡ªèº«ç”Ÿæˆsetã€getæ–¹æ³•çš„ï¼Œè€Œä¸”ç³»ç»Ÿä¹Ÿä¸çŸ¥é“åº”è¯¥å¯¹åº”å“ªä¸ªMOCï¼Œä¼šå¯¼è‡´æ–¹æ³•æœªå®ç°çš„å´©æºƒã€‚æ‰€ä»¥å°±å‡ºç°äº†å¼€å‘ä¸­ç»å¸¸å‡ºç°çš„é”™è¯¯ï¼Œå¦‚ä¸‹é¢å´©æºƒä¿¡æ¯ï¼š
1</p>

<p>-[Employee setName:]: unrecognized selector sent to instance 0x7fa665900f60</p>

<p>åŒå‘å…³è”</p>

<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°è¿‡åŒå‘å…³è”çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è®¾ç½®Relationshipæ—¶Inverseæ˜¯å¦ä¸ºç©ºã€‚ä¸‹é¢æ˜¯Employeeå’ŒDepartmentåœ¨æ•°æ®åº“ä¸­ï¼Œè®¾ç½®inverseå’Œæ²¡æœ‰è®¾ç½®inverseçš„ä¸¤ç§æ•°æ®å­˜å‚¨ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çš„å¯¹æ¯”å‡ºè®¾ç½®åŒå‘å…³è”çš„åŒºåˆ«ã€‚</p>

<p>æµ‹è¯•ä»£ç è¿˜æ˜¯ç”¨ä¸Šé¢æ’å…¥å®ä½“çš„ä»£ç ï¼Œåªæ˜¯æ›´æ”¹inverseé€‰é¡¹ã€‚</p>

<p>è®¾ç½®åŒå‘å…³è”</p>

<p><img src="/images/3002.png" title="Caption" ></p>

<p>Employee</p>

<p><img src="/images/3003.png" title="Caption" ></p>

<p>Department</p>

<p>æœªè®¾ç½®åŒå‘å…³è”</p>

<p><img src="/images/3004.png" title="Caption" ></p>

<p>Employee</p>

<p><img src="/images/3005.png" title="Caption" ></p>

<p>Department</p>

<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœªè®¾ç½®åŒå‘å…³è”çš„å®ä½“ï¼ŒDepartmentå…³è”Employeeä¸ºå±æ€§å¹¶å­˜å‚¨åï¼ŒDepartmentè¡¨ä¸­çš„å…³ç³»æ˜¯å­˜åœ¨çš„ï¼Œä½†Employeeè¡¨ä¸­çš„å…³ç³»ä¾ç„¶æ˜¯ç©ºçš„ã€‚è€Œè®¾ç½®åŒå‘å…³è”åçš„å®ä½“ï¼Œåœ¨Departmentå…³è”Employeeä¸ºå±æ€§å¹¶å­˜å‚¨åï¼ŒEmployeeåœ¨è¡¨ä¸­è‡ªåŠ¨è®¾ç½®äº†å’ŒDepartmentçš„å…³ç³»ã€‚</p>

<p>åŒå‘å…³è”çš„å…³ç³»ä¸åªä½“ç°åœ¨æ•°æ®åº“ä¸­ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ‰˜ç®¡å¯¹è±¡çš„å…³è”å±æ€§ï¼Œä¹Ÿæ˜¯éšç€å‘ç”Ÿå˜åŒ–çš„ã€‚åŒå‘å…³è”çš„åŒæ–¹ï¼Œä¸€æ–¹çš„å…³è”å±æ€§è®¾ç½®å…³ç³»åï¼Œå¦ä¸€æ–¹å…³è”å±æ€§çš„å…³ç³»ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚ç”¨ä¸‹é¢çš„ä»£ç æ‰“å°ä¸€ä¸‹å„è‡ªçš„å…³è”å±æ€§ï¼Œç»“æœå’Œä¸Šé¢æ•°æ®åº“çš„å˜åŒ–æ˜¯ä¸€æ ·çš„ã€‚
1</p>

<p>NSLog(@&ldquo;Department : %@, Employee : %@&rdquo;, androidDepartment.employee, lsEmployee.department);</p>

<p>æŸ¥è¯¢æ“ä½œ</p>

<p>// åˆ›å»ºè·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œDepartmentè¡¨
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Department&rdquo;];
// è®¾ç½®è¯·æ±‚æ¡ä»¶ï¼Œè®¾ç½®employeeçš„nameä¸ºè¯·æ±‚æ¡ä»¶ã€‚NSPredicateçš„å¥½å¤„åœ¨äºï¼Œå¯ä»¥è®¾ç½®keyPathæ¡ä»¶
NSPredicate </em>predicate = [NSPredicate predicateWithFormat:@&ldquo;employee.name = %@&rdquo;, @&ldquo;lxz&rdquo;];
request.predicate = predicate;
// æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œ
NSError <em>error = nil;
NSArray </em>departments = [context executeFetchRequest:request error:&amp;error];
[departments enumerateObjectsUsingBlock:^(Department * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    NSLog(@&ldquo;Department Search Result DepartName : %@, employee name : %@&rdquo;, obj.departName, obj.employee.name);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;Department Search Error : %@&rdquo;, error);
}</p>

<p>æŸ¥æ‰¾Departmentå®ä½“ï¼Œå¹¶æ‰“å°å®ä½“å†…å®¹ã€‚å°±åƒä¸Šé¢è®²çš„åŒå‘å…³ç³»ä¸€æ ·ï¼Œæœ‰å…³è”å…³ç³»çš„å®ä½“ï¼Œè‡ªå·±è¢«æŸ¥æ‰¾å‡ºæ¥åï¼Œä¹Ÿä¼šå°†ä¸ä¹‹å…³è”çš„å…¶ä»–å®ä½“ä¹ŸæŸ¥æ‰¾å‡ºæ¥ï¼Œå¹¶ä¸”æŸ¥æ‰¾å‡ºæ¥çš„å®ä½“éƒ½æ˜¯å…³è”ç€MOCçš„ã€‚</p>

<p>åˆ†é¡µæŸ¥è¯¢</p>

<p>åœ¨ä»æœ¬åœ°å­˜å‚¨åŒºè·å–æ•°æ®æ—¶ï¼Œå¯ä»¥æŒ‡å®šä»ç¬¬å‡ ä¸ªè·å–ï¼Œä»¥åŠæœ¬æ¬¡æŸ¥è¯¢è·å–å¤šå°‘ä¸ªæ•°æ®ï¼Œè”åˆèµ·æ¥ä½¿ç”¨å°±æ˜¯åˆ†é¡µæŸ¥è¯¢ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œå•ç‹¬ä½¿ç”¨è¿™ä¸¤ä¸ªAPIã€‚</p>

<p>è¿™ç§éœ€æ±‚åœ¨å®é™…å¼€å‘ä¸­éå¸¸å¸¸è§ï¼Œä¾‹å¦‚TableViewä¸­ï¼Œä¸Šæ‹‰åŠ è½½æ•°æ®ï¼Œæ¯æ¬¡åŠ è½½20æ¡æ•°æ®ï¼Œå°±å¯ä»¥åˆ©ç”¨åˆ†é¡µæŸ¥è¯¢è½»æ¾å®ç°ã€‚</p>

<p>// åˆ›å»ºè·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// è®¾ç½®æŸ¥æ‰¾èµ·å§‹ç‚¹ï¼Œè¿™é‡Œæ˜¯ä»æœç´¢ç»“æœçš„ç¬¬å…­ä¸ªå¼€å§‹è·å–
request.fetchOffset = 6;
// è®¾ç½®åˆ†é¡µï¼Œæ¯æ¬¡è¯·æ±‚è·å–å…­ä¸ªæ‰˜ç®¡å¯¹è±¡
request.fetchLimit = 6;
// è®¾ç½®æ’åºè§„åˆ™ï¼Œè¿™é‡Œè®¾ç½®èº«é«˜å‡åºæ’åº
NSSortDescriptor </em>descriptor = [NSSortDescriptor sortDescriptorWithKey:@&ldquo;height&rdquo; ascending:YES];
request.sortDescriptors = @[descriptor];
// æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ
NSError <em>error = nil;
NSArray </em>employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    NSLog(@&ldquo;Page Search Result Name : %@, height : %@&rdquo;, obj.name, obj.height);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;Page Search Data Error : %@&rdquo;, error);
}</p>

<p>ä¸Šé¢æ˜¯ä¸€ä¸ªæŒ‰ç…§èº«é«˜å‡åºæ’åºï¼Œåˆ†é¡µè·å–æœç´¢ç»“æœçš„ä¾‹å­ã€‚æŸ¥æ‰¾Employeeè¡¨ä¸­çš„å®ä½“ï¼Œå°†ç»“æœæŒ‰ç…§heightå­—æ®µå‡åºæ’åºï¼Œå¹¶ä»ç»“æœçš„ç¬¬å…­ä¸ªå¼€å§‹æŸ¥æ‰¾ï¼Œå¹¶ä¸”è®¾ç½®è·å–çš„æ•°é‡ä¹Ÿæ˜¯å…­ä¸ªã€‚</p>

<p>æ¨¡ç³ŠæŸ¥è¯¢</p>

<p>æœ‰æ—¶éœ€è¦è·å–å…·æœ‰æŸäº›ç›¸åŒç‰¹å¾çš„æ•°æ®ï¼Œè¿™æ ·å°±éœ€è¦å¯¹æŸ¥è¯¢çš„ç»“æœåšæ¨¡ç³ŠåŒ¹é…ã€‚åœ¨CoreDataæ‰§è¡Œæ¨¡ç³ŠåŒ¹é…æ—¶ï¼Œå¯ä»¥é€šè¿‡NSPredicateæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</p>

<p>// åˆ›å»ºè·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œè®¾ç½®å¯¹Employeeè¡¨è¿›è¡Œæ“ä½œ
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// åˆ›å»ºæ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶ã€‚è¿™é‡Œè®¾ç½®çš„å¸¦é€šé…ç¬¦çš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯ç»“æœåŒ…å«lxz
NSPredicate </em>predicate = [NSPredicate predicateWithFormat:@&ldquo;name LIKE %@&rdquo;, @&ldquo;<em>lxz</em>&rdquo;];
request.predicate = predicate;
// æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ
NSError <em>error = nil;
NSArray </em>employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    NSLog(@&ldquo;Fuzzy Search Result Name : %@, height : %@&rdquo;, obj.name, obj.height);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;Fuzzy Search Data Error : %@&rdquo;, error);
}</p>

<p>ä¸Šé¢æ˜¯ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼ŒNSPredicateæ”¯æŒå¤šç§å½¢å¼çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¸‹é¢åˆ—ä¸¾ä¸€äº›ç®€å•çš„åŒ¹é…æ–¹å¼ã€‚æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥æŸ¥è¯¢æ¡ä»¶å¤§å°å†™å‡å¯ã€‚</p>

<pre><code>ä»¥lxzå¼€å¤´
</code></pre>

<p>1</p>

<p>NSPredicate *predicate = [NSPredicate predicateWithFormat:@&ldquo;name BEGINSWITH %@&rdquo;, @&ldquo;lxz&rdquo;];</p>

<pre><code>ä»¥lxzç»“å°¾
</code></pre>

<p>1</p>

<p>NSPredicate *predicate = [NSPredicate predicateWithFormat:@&ldquo;name ENDSWITH %@&rdquo;, @&ldquo;lxz&rdquo;];</p>

<pre><code>å…¶ä¸­åŒ…å«lxz
</code></pre>

<p>1</p>

<p>NSPredicate *predicate = [NSPredicate predicateWithFormat:@&ldquo;name contains %@&rdquo;, @&ldquo;lxz&rdquo;];</p>

<pre><code>æŸ¥è¯¢æ¡ä»¶ç»“æœåŒ…å«lxz
</code></pre>

<p>1</p>

<p>NSPredicate <em>predicate = [NSPredicate predicateWithFormat:@&ldquo;name LIKE %@&rdquo;, @&ldquo;</em>lxz*&rdquo;];</p>

<p>åŠ è½½è¯·æ±‚æ¨¡æ¿</p>

<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è°ˆåˆ°åœ¨æ¨¡å‹æ–‡ä»¶ä¸­è®¾ç½®è¯·æ±‚æ¨¡æ¿ï¼Œä¹Ÿå°±æ˜¯åœ¨.xcdatamodeldæ–‡ä»¶ä¸­ï¼Œè®¾ç½®Fetch Requestsï¼Œä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡å¯¹åº”çš„NSManagedObjectModelè·å–è®¾ç½®å¥½çš„æ¨¡æ¿ã€‚</p>

<p>&hellip;. çœç•¥ä¸Šä¸‹æ–‡åˆ›å»ºæ­¥éª¤ &hellip;.</p>

<p>// é€šè¿‡MOCè·å–æ¨¡å‹æ–‡ä»¶å¯¹åº”çš„æ‰˜ç®¡å¯¹è±¡æ¨¡å‹
NSManagedObjectModel <em>model = context.persistentStoreCoordinator.managedObjectModel;
// é€šè¿‡.xcdatamodeldæ–‡ä»¶ä¸­è®¾ç½®çš„æ¨¡æ¿åï¼Œè·å–è¯·æ±‚å¯¹è±¡
NSFetchRequest </em>fetchRequest = [model fetchRequestTemplateForName:@&ldquo;EmployeeFR&rdquo;];
// è¯·æ±‚æ•°æ®ï¼Œä¸‹é¢çš„æ“ä½œå’Œæ™®é€šè¯·æ±‚ä¸€æ ·
NSError <em>error = nil;
NSArray </em>dataList = [context executeFetchRequest:fetchRequest error:&amp;error];
[dataList enumerateObjectsUsingBlock:^(Employee * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    NSLog(@&ldquo;Employee.count = %ld, Employee.height = %f&rdquo;, dataList.count, [obj.height floatValue]);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;Execute Fetch Request Error : %@&rdquo;, error);
}</p>

<p>è·å–ç»“æœCountå€¼</p>

<p>å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ—¶éœ€è¦åªè·å–æ‰€éœ€æ•°æ®çš„Countå€¼ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œè·å–æ“ä½œåæ•°ç»„ä¸­æ‰€å­˜å‚¨çš„å¯¹è±¡æ•°é‡ã€‚é‡åˆ°è¿™ä¸ªéœ€æ±‚ï¼Œå¦‚æœåƒä¹‹å‰ä¸€æ ·MOCæ‰§è¡Œè·å–æ“ä½œï¼Œè·å–åˆ°æ•°ç»„ç„¶åå–Countï¼Œè¿™æ ·å¯¹å†…å­˜æ¶ˆè€—æ˜¯å¾ˆå¤§çš„ã€‚</p>

<p>å¯¹äºè¿™ä¸ªéœ€æ±‚ï¼Œè‹¹æœæä¾›äº†ä¸¤ç§å¸¸ç”¨çš„æ–¹å¼è·å–è¿™ä¸ªCountå€¼ã€‚è¿™ä¸¤ç§è·å–æ“ä½œï¼Œéƒ½æ˜¯åœ¨æ•°æ®åº“ä¸­å®Œæˆçš„ï¼Œå¹¶ä¸éœ€è¦å°†æ‰˜ç®¡å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¯¹å†…å­˜çš„å¼€é”€ä¹Ÿæ˜¯å¾ˆå°çš„ã€‚</p>

<pre><code>æ–¹æ³•1ï¼Œè®¾ç½®resultType
</code></pre>

<p>// è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è®¾ç½®è‡ªå·±çš„è¿‡æ»¤æ¡ä»¶
NSPredicate <em>predicate = [NSPredicate predicateWithFormat:@&ldquo;height &lt; 2&rdquo;];
// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest </em>fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
fetchRequest.predicate = predicate;
// è¿™ä¸€æ­¥æ˜¯å…³é”®ã€‚è®¾ç½®è¿”å›ç»“æœç±»å‹ä¸ºCountï¼Œè¿”å›ç»“æœä¸ºNSNumberç±»å‹
fetchRequest.resultType = NSCountResultType;
// æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›çš„ç»“æœè¿˜æ˜¯æ•°ç»„ï¼Œæ•°ç»„ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯è®¡ç®—å‡ºçš„Countå€¼
NSError <em>error = nil;
NSArray </em>dataList = [context executeFetchRequest:fetchRequest error:&amp;error];
NSInteger count = [dataList.firstObject integerValue];
NSLog(@&ldquo;fetch request result Employee.count = %ld&rdquo;, count);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;fetch request result error : %@&rdquo;, error);
}</p>

<p>æ–¹æ³•1ä¸­è®¾ç½®NSFetchRequestå¯¹è±¡çš„resultTypeä¸ºNSCountResultTypeï¼Œè·å–åˆ°ç»“æœçš„Countå€¼ã€‚è¿™ä¸ªæšä¸¾å€¼åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æåˆ°è¿‡ï¼Œé™¤äº†Countå‚æ•°ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–ä¸‰ç§å‚æ•°ã€‚</p>

<pre><code>æ–¹æ³•2ï¼Œä½¿ç”¨MOCæä¾›çš„æ–¹æ³•
</code></pre>

<p>// è®¾ç½®è¿‡æ»¤æ¡ä»¶
NSPredicate <em>predicate = [NSPredicate predicateWithFormat:@&ldquo;height &lt; 2&rdquo;];
// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest </em>fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
fetchRequest.predicate = predicate;
// é€šè¿‡è°ƒç”¨MOCçš„countForFetchRequest:error:æ–¹æ³•ï¼Œè·å–è¯·æ±‚ç»“æœcountå€¼ï¼Œè¿”å›ç»“æœç›´æ¥æ˜¯NSUIntegerç±»å‹å˜é‡
NSError *error = nil;
NSUInteger count = [context countForFetchRequest:fetchRequest error:&amp;error];
NSLog(@&ldquo;fetch request result count is : %ld&rdquo;, count);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;fetch request result error : %@&rdquo;, error);
}</p>

<p>MOCæä¾›äº†ä¸“é—¨è·å–è¯·æ±‚ç»“æœCountå€¼çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªNSUIntegerç±»å‹çš„Countå€¼ï¼Œä½¿ç”¨èµ·æ¥æ¯”ä¸Šé¢çš„æ–¹æ³•æ›´æ–¹ä¾¿ç‚¹ï¼Œå…¶ä»–éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>ä½è¿ç®—</p>

<p>å‡è®¾æœ‰éœ€æ±‚æ˜¯å¯¹Employeeè¡¨ä¸­ï¼Œæ‰€æœ‰æ‰˜ç®¡å¯¹è±¡çš„heightå±æ€§è®¡ç®—æ€»å’Œã€‚è¿™ä¸ªéœ€æ±‚åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå°†æ‰€æœ‰æ‰˜ç®¡å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­æ˜¯éå¸¸æ¶ˆè€—å†…å­˜çš„ï¼Œå°±ç®—æ‰¹é‡åŠ è½½ä¹Ÿæ¯”è¾ƒè€—æ—¶è€—å†…å­˜ã€‚</p>

<p>CoreDataå¯¹äºè¿™æ ·çš„éœ€æ±‚ï¼Œæä¾›äº†ä½è¿ç®—çš„åŠŸèƒ½ã€‚MOCåœ¨æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œæ˜¯æ”¯æŒå¯¹æ•°æ®è¿›è¡Œä½è¿ç®—çš„ã€‚è¿™ä¸ªæ“ä½œä¾ç„¶æ˜¯åœ¨æ•°æ®åº“å±‚å®Œæˆçš„ï¼Œå¯¹å†…å­˜çš„å ç”¨éå¸¸å°ã€‚</p>

<p>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest <em>fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// è®¾ç½®è¿”å›å€¼ä¸ºå­—å…¸ç±»å‹ï¼Œè¿™æ˜¯ä¸ºäº†ç»“æœå¯ä»¥é€šè¿‡è®¾ç½®çš„nameåå–å‡ºï¼Œè¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„
fetchRequest.resultType = NSDictionaryResultType;
// åˆ›å»ºæè¿°å¯¹è±¡
NSExpressionDescription </em>expressionDes = [[NSExpressionDescription alloc] init];
// è®¾ç½®æè¿°å¯¹è±¡çš„nameï¼Œæœ€åç»“æœéœ€è¦ç”¨è¿™ä¸ªnameå½“åškeyæ¥å–å‡ºç»“æœ
expressionDes.name = @&ldquo;sumOperatin&rdquo;;
// è®¾ç½®è¿”å›å€¼ç±»å‹ï¼Œæ ¹æ®è¿ç®—ç»“æœè®¾ç½®ç±»å‹
expressionDes.expressionResultType = NSFloatAttributeType;
// åˆ›å»ºå…·ä½“æè¿°å¯¹è±¡ï¼Œç”¨æ¥æè¿°å¯¹é‚£ä¸ªå±æ€§è¿›è¡Œä»€ä¹ˆè¿ç®—(å¯æ‰§è¡Œçš„è¿ç®—ç±»å‹å¾ˆå¤šï¼Œè¿™é‡Œæè¿°çš„æ˜¯å¯¹heightå±æ€§ï¼Œåšsumè¿ç®—)
NSExpression <em>expression = [NSExpression expressionForFunction:@&ldquo;sum:&rdquo; arguments:@[[NSExpression expressionForKeyPath:@&ldquo;height&rdquo;]]];
// åªèƒ½å¯¹åº”ä¸€ä¸ªå…·ä½“æè¿°å¯¹è±¡
expressionDes.expression = expression;
// ç»™è¯·æ±‚å¯¹è±¡è®¾ç½®æè¿°å¯¹è±¡ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è®¾ç½®å¤šä¸ªæè¿°å¯¹è±¡
fetchRequest.propertiesToFetch = @[expressionDes];
// æ‰§è¡Œè¯·æ±‚ï¼Œè¿”å›å€¼è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯å­˜å‚¨è®¡ç®—ç»“æœçš„å­—å…¸
NSError </em>error = nil;
NSArray <em>resultArr = [context executeFetchRequest:fetchRequest error:&amp;error];
// é€šè¿‡ä¸Šé¢è®¾ç½®çš„nameå€¼ï¼Œå½“åšè¯·æ±‚ç»“æœçš„keyå–å‡ºè®¡ç®—ç»“æœ
NSNumber </em>number = resultArr.firstObject[@&ldquo;sumOperatin&rdquo;];
NSLog(@&ldquo;fetch request result is %f&rdquo;, [number floatValue]);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;fetch request result error : %@&rdquo;, error);
}</p>

<p>æ‰§è¡Œç»“æœï¼š</p>

<p><img src="/images/3006.png" title="Caption" ></p>

<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒMOCå¯¹æ‰€æœ‰æŸ¥æ‰¾åˆ°çš„æ‰˜ç®¡å¯¹è±¡heightå±æ€§æ‰§è¡Œäº†æ±‚å’Œæ“ä½œï¼Œå¹¶å°†ç»“æœæ”¾åœ¨å­—å…¸ä¸­è¿”å›ã€‚ä½è¿ç®—ä¸»è¦æ˜¯é€šè¿‡NSFetchRequestå¯¹è±¡çš„propertiesToFetchå±æ€§è®¾ç½®ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥è®¾ç½®å¤šä¸ªæè¿°å¯¹è±¡ï¼Œæœ€åé€šè¿‡ä¸åŒçš„nameå½“åškeyæ¥å–å‡ºç»“æœå³å¯ã€‚</p>

<p>NSExpressionç±»å¯ä»¥æè¿°å¤šç§è¿ç®—ï¼Œå¯ä»¥åœ¨NSExpression.hæ–‡ä»¶ä¸­çš„æ³¨é‡Šéƒ¨åˆ†ï¼Œçœ‹åˆ°æ‰€æœ‰æ”¯æŒçš„è¿ç®—ç±»å‹ï¼Œå¤§æ¦‚çœ‹äº†ä¸€ä¸‹æœ‰äºŒåå¤šç§è¿ç®—ã€‚è€Œä¸”é™¤äº†ä¸Šé¢NSExpressionè°ƒç”¨çš„æ–¹æ³•ï¼Œæ­¤ç±»è¿˜æ”¯æŒç‚¹è¯­æ³•çš„ä½è¿ç®—ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚
1</p>

<p>[NSExpression expressionWithFormat:@&ldquo;@sum.height&rdquo;];</p>

<p>æ‰¹å¤„ç†</p>

<p>åœ¨ä½¿ç”¨CoreDataä¹‹å‰ï¼Œæˆ‘å’Œå…¬å¸åŒäº‹ä¹Ÿè®¨è®ºè¿‡ï¼Œå‡è®¾é‡åˆ°éœ€è¦å¤§é‡æ•°æ®å¤„ç†çš„æ—¶å€™æ€ä¹ˆåŠã€‚CoreDataå¯¹äºå¤§é‡æ•°æ®å¤„ç†çš„çµæ´»æ€§è‚¯å®šä¸å¦‚SQLiteï¼Œè¿™æ—¶å€™è¿˜éœ€è¦è‡ªå·±ä½¿ç”¨å…¶ä»–æ–¹å¼ä¼˜åŒ–æ•°æ®å¤„ç†ã€‚è™½ç„¶åœ¨ç§»åŠ¨ç«¯è¿™ç§æƒ…å†µå¾ˆå°‘å‡ºç°ï¼Œä½†æ˜¯åœ¨æŒä¹…å±‚è®¾è®¡æ—¶è¿˜æ˜¯è¦è€ƒè™‘è¿™æ–¹é¢ã€‚</p>

<p>å½“éœ€è¦è¿›è¡Œæ•°æ®çš„å¤„ç†æ—¶ï¼ŒCoreDataéœ€è¦å…ˆå°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åæ‰èƒ½å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚è¿™æ ·å¯¹äºå¤§é‡æ•°æ®æ¥è¯´ï¼Œéƒ½åŠ è½½åˆ°å†…å­˜ä¸­æ˜¯éå¸¸æ¶ˆè€—å†…å­˜çš„ï¼Œè€Œä¸”å®¹æ˜“å¯¼è‡´å´©æºƒçš„å‘ç”Ÿã€‚å¦‚æœé‡åˆ°æ›´æ”¹æ‰€æœ‰æ•°æ®çš„æŸä¸ªå­—æ®µè¿™æ ·çš„ç®€å•éœ€æ±‚ï¼Œéœ€è¦å°†ç›¸å…³çš„æ‰˜ç®¡å¯¹è±¡éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åè¿›è¡Œæ›´æ”¹ã€ä¿å­˜ã€‚</p>

<p>å¯¹äºä¸Šé¢è¿™æ ·çš„é—®é¢˜ï¼ŒCoreDataåœ¨iOS8æ¨å‡ºäº†æ‰¹é‡æ›´æ–°APIï¼Œé€šè¿‡è¿™ä¸ªAPIå¯ä»¥ç›´æ¥åœ¨æ•°æ®åº“ä¸€å±‚å°±å®Œæˆæ›´æ–°æ“ä½œï¼Œè€Œä¸éœ€è¦å°†æ•°æ®åŠ è½½åˆ°å†…å­˜ã€‚é™¤äº†æ‰¹é‡æ›´æ–°æ“ä½œï¼Œåœ¨iOS9ä¸­è¿˜æ¨å‡ºäº†æ‰¹é‡åˆ é™¤APIï¼Œä¹Ÿæ˜¯åœ¨æ•°æ®åº“ä¸€å±‚å®Œæˆçš„æ“ä½œã€‚å…³äºæ‰¹å¤„ç†çš„APIå¾ˆå¤šéƒ½æ˜¯iOS8ã€iOS9å‡ºæ¥çš„ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ç‰ˆæœ¬å…¼å®¹ã€‚</p>

<p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæ‰¹é‡æ›´æ–°å’Œæ‰¹é‡åˆ é™¤çš„ä¸¤ä¸ªAPIï¼Œéƒ½æ˜¯ç›´æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œæ›´æ–°å®Œä¹‹åä¼šå¯¼è‡´MOCç¼“å­˜å’Œæœ¬åœ°æŒä¹…åŒ–æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚æ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ·æ–°å—å½±å“çš„MOCä¸­å­˜å‚¨çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä½¿MOCå’Œæœ¬åœ°ç»Ÿä¸€ã€‚å‡è®¾ä½ ä½¿ç”¨äº†NSFetchedResultsControllerï¼Œä¸ºäº†ä¿è¯ç•Œé¢å’Œæ•°æ®çš„ç»Ÿä¸€ï¼Œè¿™ä¸€æ­¥æ›´æ–°æ“ä½œæ›´éœ€è¦åšã€‚</p>

<p>æ‰¹é‡æ›´æ–°</p>

<p>// åˆ›å»ºæ‰¹é‡æ›´æ–°å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨ã€‚
NSBatchUpdateRequest <em>updateRequest = [NSBatchUpdateRequest batchUpdateRequestWithEntityName:@&ldquo;Employee&rdquo;];
// è®¾ç½®è¿”å›å€¼ç±»å‹ï¼Œé»˜è®¤æ˜¯ä»€ä¹ˆéƒ½ä¸è¿”å›(NSStatusOnlyResultType)ï¼Œè¿™é‡Œè®¾ç½®è¿”å›å‘ç”Ÿæ”¹å˜çš„å¯¹è±¡Countå€¼
updateRequest.resultType = NSUpdatedObjectsCountResultType;
// è®¾ç½®å‘ç”Ÿæ”¹å˜å­—æ®µçš„å­—å…¸
updateRequest.propertiesToUpdate = @{@&ldquo;height&rdquo; : [NSNumber numberWithFloat:5.f]};
// æ‰§è¡Œè¯·æ±‚åï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªç‰¹å®šçš„resultå¯¹è±¡ï¼Œé€šè¿‡resultçš„å±æ€§è·å–è¿”å›çš„ç»“æœã€‚MOCçš„è¿™ä¸ªAPIæ˜¯ä»iOS8å‡ºæ¥çš„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ç‰ˆæœ¬å…¼å®¹ã€‚
NSError </em>error = nil;
NSBatchUpdateResult *result = [context executeRequest:updateRequest error:&amp;error];
NSLog(@&ldquo;batch update count is %ld&rdquo;, [result.result integerValue]);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;batch update request result error : %@&rdquo;, error);
}
// æ›´æ–°MOCä¸­çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä½¿MOCå’Œæœ¬åœ°æŒä¹…åŒ–åŒºæ•°æ®åŒæ­¥
[context refreshAllObjects];</p>

<p>ä¸Šé¢å¯¹Employeeè¡¨ä¸­æ‰€æœ‰çš„æ‰˜ç®¡å¯¹è±¡heightå€¼åšäº†æ‰¹é‡æ›´æ–°ï¼Œåœ¨æ›´æ–°æ—¶é€šè¿‡è®¾ç½®propertiesToUpdateå­—å…¸æ¥æ§åˆ¶æ›´æ–°å­—æ®µå’Œæ›´æ–°çš„å€¼ï¼Œè®¾ç½®æ ¼å¼æ˜¯å­—æ®µå : æ–°å€¼ã€‚é€šè¿‡è®¾ç½®æ‰¹å¤„ç†å¯¹è±¡çš„predicateå±æ€§ï¼Œè®¾ç½®ä¸€ä¸ªè°“è¯å¯¹è±¡æ¥æ§åˆ¶å—å½±å“çš„å¯¹è±¡ã€‚</p>

<p>è¿˜å¯ä»¥å¯¹å¤šä¸ªå­˜å‚¨åŒº(æ•°æ®åº“)åšåŒæ ·æ‰¹å¤„ç†æ“ä½œï¼Œé€šè¿‡è®¾ç½®å…¶çˆ¶ç±»çš„affectedStoreså±æ€§ï¼Œç±»å‹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥åŒ…å«å—å½±å“çš„å­˜å‚¨åŒºï¼Œå¤šä¸ªå­˜å‚¨åŒºçš„æ“ä½œå¯¹æ‰¹é‡åˆ é™¤åŒæ ·é€‚ç”¨ã€‚</p>

<p>MOCåœ¨æ‰§è¡Œè¯·æ±‚æ–¹æ³•æ—¶ï¼Œå‘ç°æ–¹æ³•åä¹Ÿä¸ä¸€æ ·äº†ï¼Œæ‰§è¡Œçš„æ˜¯executeRequest: error:æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä»iOS8ä¹‹åå‡ºæ¥çš„ã€‚æ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯NSBatchUpdateRequestç±»ï¼Œæ­¤ç±»å¹¶ä¸æ˜¯ç»§æ‰¿è‡ªNSFetchRequestç±»ï¼Œè€Œæ˜¯ç›´æ¥ç»§æ‰¿è‡ªNSPersistentStoreRequestï¼Œå’ŒNSFetchRequestæ˜¯å¹³çº§å…³ç³»ã€‚</p>

<p>æ‰¹é‡åˆ é™¤</p>

<p>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜å¯¹Employeeè¡¨åšæ“ä½œ
NSFetchRequest <em>fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// é€šè¿‡è°“è¯è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œè®¾ç½®æ¡ä»¶ä¸ºheightå°äº1.7
NSPredicate </em>predicate = [NSPredicate predicateWithFormat:@&ldquo;height &lt; %f&rdquo;, 1.7f];
fetchRequest.predicate = predicate;
// åˆ›å»ºæ‰¹é‡åˆ é™¤è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„è¯·æ±‚å¯¹è±¡å½“åšå‚æ•°è¿›è¡Œåˆå§‹åŒ–
NSBatchDeleteRequest <em>deleteRequest = [[NSBatchDeleteRequest alloc] initWithFetchRequest:fetchRequest];
// è®¾ç½®è¯·æ±‚ç»“æœç±»å‹ï¼Œè®¾ç½®ä¸ºå—å½±å“å¯¹è±¡çš„Count
deleteRequest.resultType = NSBatchDeleteResultTypeCount;
// ä½¿ç”¨NSBatchDeleteResultå¯¹è±¡æ¥æ¥å—è¿”å›ç»“æœï¼Œé€šè¿‡idç±»å‹çš„å±æ€§resultè·å–ç»“æœ
NSError </em>error = nil;
NSBatchDeleteResult *result = [context executeRequest:deleteRequest error:&amp;error];
NSLog(@&ldquo;batch delete request result count is %ld&rdquo;, [result.result integerValue]);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;batch delete request error : %@&rdquo;, error);
}
// æ›´æ–°MOCä¸­çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä½¿MOCå’Œæœ¬åœ°æŒä¹…åŒ–åŒºæ•°æ®åŒæ­¥
[context refreshAllObjects];</p>

<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¶‰åŠåˆ°æ‰˜ç®¡å¯¹è±¡çš„æ“ä½œï¼Œéƒ½éœ€è¦å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­å®Œæˆã€‚æ‰€ä»¥ä½¿ç”¨CoreDataæ—¶ï¼Œéœ€è¦æ³¨æ„å†…å­˜çš„ä½¿ç”¨ï¼Œä¸è¦åœ¨å†…å­˜ä¸­å­˜åœ¨è¿‡å¤šçš„æ‰˜ç®¡å¯¹è±¡ã€‚åœ¨å·²ç»åšç³»ç»Ÿå…¼å®¹çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå¤§é‡æ•°æ®çš„æ“ä½œæ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨æ‰¹å¤„ç†æ¥å®Œæˆæ“ä½œã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒrefreshAllObjectsæ˜¯ä»iOS9å‡ºæ¥çš„ï¼Œåœ¨iOS9ä¹‹å‰å› ä¸ºè¦åšç‰ˆæœ¬å…¼å®¹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨refreshObject: mergeChanges:æ–¹æ³•æ›´æ–°æ‰˜ç®¡å¯¹è±¡ã€‚</p>

<p>å¼‚æ­¥è¯·æ±‚</p>

<p>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest <em>fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// åˆ›å»ºå¼‚æ­¥è¯·æ±‚å¯¹è±¡ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªblockè¿›è¡Œå›è°ƒï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªNSAsynchronousFetchResultç±»å‹å‚æ•°
NSAsynchronousFetchRequest </em>asycFetchRequest = [[NSAsynchronousFetchRequest alloc] initWithFetchRequest:fetchRequest completionBlock:^(NSAsynchronousFetchResult * <em>Nonnull result) {
    [result.finalResult enumerateObjectsUsingBlock:^(Employee * </em>Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        NSLog(@&ldquo;fetch request result Employee.count = %ld, Employee.name = %@&rdquo;, result.finalResult.count, obj.name);
    }];
}];
// æ‰§è¡Œå¼‚æ­¥è¯·æ±‚ï¼Œå’Œæ‰¹é‡å¤„ç†æ‰§è¡ŒåŒä¸€ä¸ªè¯·æ±‚æ–¹æ³•
NSError *error = nil;
[context executeRequest:asycFetchRequest error:&amp;error];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;fetch request result error : %@&rdquo;, error);
}</p>

<p>ä¸Šé¢é€šè¿‡NSAsynchronousFetchRequestå¯¹è±¡åˆ›å»ºäº†ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå¹¶é€šè¿‡blockè¿›è¡Œå›è°ƒã€‚å¦‚æœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶å‘èµ·ï¼Œä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œç³»ç»Ÿä¼šå°†æ‰€æœ‰çš„å¼‚æ­¥è¯·æ±‚æ·»åŠ åˆ°ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ï¼Œåœ¨å‰ä¸€ä¸ªä»»åŠ¡è®¿é—®æ•°æ®åº“æ—¶ï¼ŒCoreDataä¼šå°†æ•°æ®åº“åŠ é”ï¼Œç­‰å‰é¢çš„æ‰§è¡Œå®Œæˆæ‰ä¼šç»§ç»­æ‰§è¡Œåé¢çš„æ“ä½œã€‚</p>

<p>NSAsynchronousFetchRequestæä¾›äº†cancelæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå°†è¿™ä¸ªè¯·æ±‚å–æ¶ˆã€‚è¿˜å¯ä»¥é€šè¿‡ä¸€ä¸ªNSProgressç±»å‹çš„å±æ€§ï¼Œè·å–è¯·æ±‚å®Œæˆè¿›åº¦ã€‚NSAsynchronousFetchRequestç±»ä»iOS8å¼€å§‹å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥ä½ç‰ˆæœ¬éœ€è¦åšç‰ˆæœ¬å…¼å®¹ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œè¯·æ±‚æ—¶MOCå¹¶å‘ç±»å‹ä¸èƒ½æ˜¯NSConfinementConcurrencyTypeï¼Œè¿™ä¸ªå¹¶å‘ç±»å‹å·²ç»è¢«æŠ›å¼ƒï¼Œä¼šå¯¼è‡´å´©æºƒã€‚</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/04/coredatebzmshiyong/">CoreDataæ€ä¹ˆç”¨ï¼Ÿ</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-04T04:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:59 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­å¹¶æ²¡æœ‰è®²CoreDataçš„å…·ä½“ç”¨æ³•ï¼Œåªæ˜¯å¯¹CoreDataåšäº†ä¸€ä¸ªè¯¦ç»†çš„ä»‹ç»ï¼Œç®—æ˜¯ä¸€ä¸ªå¼€å§‹å’Œæ€»ç»“å§ã€‚</p>

<p>è¿™ç¯‡æ–‡ç« ä¸­ä¼šä¸»è¦è®²CoreDataçš„åŸºç¡€ä½¿ç”¨ï¼Œä»¥åŠåœ¨ä½¿ç”¨ä¸­éœ€è¦æ³¨æ„çš„ä¸€äº›ç»†èŠ‚ã€‚å› ä¸ºæ–‡ç« ä¸­ä¼šæ’å…¥ä»£ç å’Œå›¾ç‰‡ï¼Œå†…å®¹å¯èƒ½ä¼šæ¯”è¾ƒå¤šï¼Œæ¯”è¾ƒè€ƒéªŒå„ä½è€å¿ƒã€‚</p>

<p>æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼??</p>

<p>åˆ›å»ºè‡ªå¸¦CoreDataçš„å·¥ç¨‹</p>

<p>åœ¨æ–°å»ºä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œå¯ä»¥å‹¾é€‰Use Core Dataé€‰é¡¹ï¼Œè¿™æ ·åˆ›å»ºå‡ºæ¥çš„å·¥ç¨‹ç³»ç»Ÿä¼šé»˜è®¤ç”Ÿæˆä¸€äº›CoreDataçš„ä»£ç ä»¥åŠä¸€ä¸ª.xcdatamodeldåç¼€çš„æ¨¡å‹æ–‡ä»¶ï¼Œæ¨¡å‹æ–‡ä»¶é»˜è®¤ä»¥å·¥ç¨‹åå¼€å¤´ã€‚è¿™äº›ä»£ç åœ¨AppDelegateç±»ä¸­ï¼Œä¹Ÿå°±æ˜¯ä»£è¡¨å¯ä»¥åœ¨å…¨å±€ä½¿ç”¨AppDelegate.hæ–‡ä»¶ä¸­å£°æ˜çš„CoreDataæ–¹æ³•å’Œå±æ€§ã€‚</p>

<p>ç³»ç»Ÿé»˜è®¤ç”Ÿæˆçš„ä»£ç æ˜¯éå¸¸ç®€å•çš„ï¼Œåªæ˜¯ç”Ÿæˆäº†åŸºç¡€çš„æ‰˜ç®¡å¯¹è±¡æ¨¡å‹ã€æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡ã€æŒä¹…åŒ–å­˜å‚¨è°ƒåº¦å™¨ï¼Œä»¥åŠMOCçš„saveæ–¹æ³•ã€‚ä½†æ˜¯è¿™äº›ä»£ç å·²ç»å¯ä»¥å®ŒæˆåŸºç¡€çš„CoreDataæ“ä½œäº†ã€‚</p>

<p>1469788227988682.png</p>

<p>ç³»ç»Ÿç”Ÿæˆä»£ç </p>

<p>è¿™éƒ¨åˆ†ä»£ç ä¸åº”è¯¥æ”¾åœ¨AppDelegateä¸­ï¼Œå°¤å…¶å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œæ›´åº”è¯¥æŠŠè¿™éƒ¨åˆ†ä»£ç å•ç‹¬æŠ½ç¦»å‡ºå»ï¼Œæ”¾åœ¨ä¸“é—¨çš„ç±»æˆ–æ¨¡å—æ¥ç®¡ç†CoreDataç›¸å…³çš„é€»è¾‘ã€‚æ‰€ä»¥æˆ‘ä¸€èˆ¬ä¸ä¼šé€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºCoreDataï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯æ–°å»ºä¸€ä¸ªâ€œå¹²å‡€â€çš„é¡¹ç›®ï¼Œç„¶åè‡ªå·±å¾€é‡Œé¢æ·»åŠ ï¼Œè¿™æ ·å¯¹äºCoreDataçš„å®Œæ•´ä½¿ç”¨æµç¨‹æŒæ¡çš„ä¹Ÿæ¯”è¾ƒç‰¢å›ºã€‚</p>

<p>CoreDataæ¨¡å‹æ–‡ä»¶çš„åˆ›å»º</p>

<p>æ„å»ºæ¨¡å‹æ–‡ä»¶</p>

<p>ä½¿ç”¨CoreDataçš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºåç¼€ä¸º.xcdatamodeldçš„æ¨¡å‹æ–‡ä»¶ï¼Œä½¿ç”¨å¿«æ·é”®Command + Nï¼Œé€‰æ‹©Core Data -> Data Model -> Nextï¼Œå®Œæˆæ¨¡å‹æ–‡ä»¶çš„åˆ›å»ºã€‚</p>

<p>åˆ›å»ºå®Œæˆåå¯ä»¥çœ‹åˆ°æ¨¡å‹æ–‡ä»¶å·¦ä¾§åˆ—è¡¨ï¼Œæœ‰ä¸‰ä¸ªé€‰é¡¹Entitiesã€Fetch Requestsã€Configurationsï¼Œåˆ†åˆ«å¯¹åº”ç€å®ä½“ã€è¯·æ±‚æ¨¡æ¿ã€é…ç½®ä¿¡æ¯ã€‚</p>

<p><img src="/images/2001.png" title="Caption" >
æ¨¡å‹æ–‡ä»¶</p>

<p>æ·»åŠ å®ä½“</p>

<p>ç°åœ¨å¯ä»¥é€šè¿‡é•¿æŒ‰å·¦ä¾§åˆ—è¡¨ä¸‹æ–¹çš„Add EntityæŒ‰é’®ï¼Œä¼šå¼¹å‡ºAdd Entityã€Add Fetch Requestã€Add Configurationé€‰é¡¹ï¼Œå¯ä»¥æ·»åŠ å®ä½“ã€è¯·æ±‚æ¨¡æ¿ã€é…ç½®ä¿¡æ¯ã€‚è¿™é‡Œå…ˆé€‰æ‹©Add Entityæ¥æ·»åŠ ä¸€ä¸ªå®ä½“ï¼Œå‘½åä¸ºPersonã€‚</p>

<p>æ·»åŠ Personå®ä½“åï¼Œä¼šå‘ç°ä¸€ä¸ªå®ä½“å¯¹åº”ç€ä¸‰éƒ¨åˆ†å†…å®¹ï¼ŒAttributesã€Relationshipsã€Fetched Propertiesï¼Œåˆ†åˆ«å¯¹åº”ç€å±æ€§ã€å…³è”å…³ç³»ã€è·å–æ“ä½œã€‚</p>

<p><img src="/images/2002.png" title="Caption" ></p>

<p>ç©ºå®ä½“</p>

<p>ç°åœ¨å¯¹Personå®ä½“æ·»åŠ ä¸¤ä¸ªå±æ€§ï¼Œæ·»åŠ ageå±æ€§å¹¶è®¾ç½®typeä¸ºInteger 16ï¼Œæ·»åŠ nameå±æ€§å¹¶è®¾ç½®typeä¸ºStringã€‚</p>

<p><img src="/images/2003.png" title="Caption" >
æ·»åŠ å±æ€§</p>

<p>å®ä½“å±æ€§ç±»å‹</p>

<p>åœ¨æ¨¡å‹æ–‡ä»¶çš„å®ä½“ä¸­ï¼Œå‚æ•°ç±»å‹å’Œå¹³æ—¶åˆ›å»ºç»§æ‰¿è‡ªNSObjectçš„æ¨¡å‹ç±»å¤§ä½“ç±»ä¼¼ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›å…³äºç±»å‹çš„è¯´æ˜ï¼Œä¸‹é¢ç®€å•çš„åˆ—ä¸¾äº†ä¸€ä¸‹ã€‚</p>

<pre><code>Undefined: é»˜è®¤å€¼ï¼Œå‚ä¸ç¼–è¯‘ä¼šæŠ¥é”™

Integer 16: æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´ -32768 ~ 32767

Integer 32: æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´ -2147483648 ~ 2147483647

Integer 64: æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´ â€“9223372036854775808 ~ 9223372036854775807

Float: å°æ•°ï¼Œé€šè¿‡MAXFLOATå®å®šä¹‰æ¥çœ‹ï¼Œæœ€å¤§å€¼ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºæ˜¯ 0x1.fffffep+127f

Double: å°æ•°ï¼Œå°æ•°ä½æ¯”Floatæ›´ç²¾ç¡®ï¼Œè¡¨ç¤ºèŒƒå›´æ›´å¤§

String: å­—ç¬¦ä¸²ï¼Œç”¨NSStringè¡¨ç¤º

Boolean: å¸ƒå°”å€¼ï¼Œç”¨NSNumberè¡¨ç¤º

Date: æ—¶é—´ï¼Œç”¨NSDateè¡¨ç¤º

Binary Data: äºŒè¿›åˆ¶ï¼Œç”¨NSDataè¡¨ç¤º

Transformable: OCå¯¹è±¡ï¼Œç”¨idè¡¨ç¤ºã€‚å¯ä»¥åœ¨åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶åï¼Œæ‰‹åŠ¨æ”¹ä¸ºå¯¹åº”çš„OCç±»åã€‚ä½¿ç”¨çš„å‰ææ˜¯ï¼Œè¿™ä¸ªOCå¯¹è±¡å¿…é¡»éµå®ˆå¹¶å®ç°NSCodingåè®®
</code></pre>

<p>æ·»åŠ å®ä½“å…³è”å…³ç³»</p>

<p>åˆ›å»ºä¸¤ä¸ªå®ä½“Departmentå’ŒEmployeeï¼Œå¹¶ä¸”åœ¨è¿™ä¸¤ä¸ªå®ä½“ä¸­åˆ†åˆ«æ·»åŠ ä¸€äº›å±æ€§ï¼Œä¸‹é¢å°†ä¼šæ ¹æ®è¿™ä¸¤ä¸ªå®ä½“æ¥æ·»åŠ å…³è”å…³ç³»ã€‚
<img src="/images/2004.png" title="Caption" ></p>

<p>åˆ›å»ºå®ä½“</p>

<p>ç»™Employeeå®ä½“æ·»åŠ å…³ç³»ï¼Œåœ¨Relationshipsçš„ä½ç½®ç‚¹å‡»åŠ å·ï¼Œæ·»åŠ ä¸€ä¸ªå…³è”å…³ç³»ã€‚æ·»åŠ å…³ç³»çš„åç§°è®¾ä¸ºdepartmentï¼Œç±»å‹è®¾ç½®ä¸ºDepartmentï¼ŒInverseè®¾ç½®ä¸ºemployee(åé¢ä¼šè®²è§£è¿™ä¸ªinverseçš„ä½œç”¨)ã€‚</p>

<p><img src="/images/2005.png" title="Caption" ></p>

<p>æ·»åŠ Relationships</p>

<p>é€‰æ‹©Departmentå®ä½“ï¼Œç‚¹å‡»Relationshipsä½ç½®çš„åŠ å·ï¼Œæ·»åŠ å…³è”å…³ç³»ã€‚</p>

<p>Departmentå®ä½“æ·»åŠ Relationshipsçš„æ“ä½œå’ŒEmployeeéƒ½ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºç”¨çº¢åœˆæ ‡å‡ºçš„Typeï¼Œè¿™é‡Œè®¾ç½®çš„To Manyä¸€å¯¹å¤šçš„å…³ç³»ã€‚è¿™é‡Œé»˜è®¤æ˜¯To Oneä¸€å¯¹ä¸€ï¼Œä¸Šé¢çš„Employeeå°±æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ä¹Ÿå°±ç¬¦åˆä¸€ä¸ªDepartmentå¯ä»¥æœ‰å¤šä¸ªEmployeeï¼Œè€ŒEmployeeåªèƒ½æœ‰ä¸€ä¸ªDepartmentçš„æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯ç¬¦åˆå¸¸ç†çš„ã€‚</p>

<p><img src="/images/2006.png" title="Caption" ></p>

<p>æ·»åŠ Relationships</p>

<p>Relationshipsç±»ä¼¼äºSQLiteçš„å¤–é”®ï¼Œå®šä¹‰äº†åœ¨åŒä¸€ä¸ªæ¨¡å‹ä¸­ï¼Œå®ä½“ä¸å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚å¯ä»¥å®šä¹‰ä¸ºå¯¹ä¸€å…³ç³»æˆ–å¯¹å¤šå…³ç³»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰å•å‘æˆ–åŒå‘çš„å…³ç³»ï¼Œæ ¹æ®éœ€æ±‚æ¥ç¡®å®šã€‚å¦‚æœæ˜¯å¯¹å¤šçš„å…³ç³»ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨NSSeté›†åˆæ¥å­˜å‚¨æ¨¡å‹ã€‚</p>

<p>Inverseæ˜¯ä¸¤ä¸ªå®ä½“åœ¨Relationshipsä¸­è®¾ç½®å…³è”å…³ç³»åï¼Œé€šè¿‡è®¾ç½®inverseä¸ºå¯¹åº”çš„å®ä½“ï¼Œè¿™æ ·å¯ä»¥ä»ä¸€ä¸ªå®ä½“æ‰¾åˆ°å¦ä¸€ä¸ªå®ä½“ï¼Œä½¿ä¸¤ä¸ªå®ä½“å…·æœ‰åŒå‘çš„å…³è”å…³ç³»ã€‚</p>

<p>Fetched Properties</p>

<p>åœ¨å®ä½“æœ€ä¸‹é¢ï¼Œæœ‰ä¸€ä¸ªFetched Propertiesé€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹ç”¨çš„ä¸å¤šï¼Œè¿™é‡Œå°±ä¸ç»†è®²äº†ã€‚</p>

<p>Fetched Propertiesç”¨äºå®šä¹‰æŸ¥è¯¢æ“ä½œï¼Œå’ŒNSFetchRequeståŠŸèƒ½ç›¸åŒã€‚å®šä¹‰fetchedPropertyå¯¹è±¡åï¼Œå¯ä»¥é€šè¿‡NSManagedObjectModelç±»çš„fetchRequestFromTemplateWithName:substitutionVariables:æ–¹æ³•æˆ–å…¶ä»–ç›¸å…³æ–¹æ³•è·å–è¿™ä¸ªfetchedPropertyå¯¹è±¡ã€‚</p>

<p><img src="/images/2007.png" title="Caption" ></p>

<p>fetched Property</p>

<p>è·å–è¿™ä¸ªå¯¹è±¡åï¼Œç³»ç»Ÿä¼šé»˜è®¤å°†è¿™ä¸ªå¯¹è±¡ç¼“å­˜åˆ°ä¸€ä¸ªå­—å…¸ä¸­ï¼Œç¼“å­˜ä¹‹åä¹Ÿå¯ä»¥é€šè¿‡fetchedPropertyå­—å…¸è·å–fetchedPropertyå¯¹è±¡ã€‚</p>

<p>Data Model Inspector</p>

<p>é€‰ä¸­ä¸€ä¸ªå®ä½“åï¼Œå³ä¾§çš„ä¾§è¾¹æ (Data Model Inspector)è¿˜æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹å¯ä»¥å¯¹å±æ€§è¿›è¡Œé…ç½®ã€‚æ ¹æ®ä¸åŒçš„å±æ€§ç±»å‹ï¼Œä¾§è¾¹æ çš„æ˜¾ç¤ºä¹Ÿä¸å¤ªä¸€æ ·ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªStringç±»å‹çš„å±æ€§ã€‚</p>

<p><img src="/images/2008.png" title="Caption" ></p>

<p>Data Model Inspector</p>

<p>å±æ€§è®¾ç½®</p>

<pre><code>default Value: è®¾ç½®é»˜è®¤å€¼ï¼Œé™¤äº†äºŒè¿›åˆ¶ä¸èƒ½è®¾ç½®ï¼Œå…¶ä»–ç±»å‹å‡ ä¹éƒ½èƒ½è®¾ç½®ã€‚

optional: åœ¨ä½¿ç”¨æ—¶æ˜¯å¦å¯é€‰ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå¦‚æœè®¾ç½®ä¸ºNOï¼Œåªè¦å‘MOCè¿›è¡Œsaveæ“ä½œï¼Œè¿™ä¸ªå±æ€§æ˜¯å¦å¿…é¡»æœ‰å€¼ã€‚å¦åˆ™MOCè¿›è¡Œæ“ä½œæ—¶ä¼šå¤±è´¥å¹¶è¿”å›ä¸€ä¸ªerrorï¼Œè¯¥é€‰é¡¹é»˜è®¤ä¸ºYESã€‚

transient: è®¾ç½®å½“å‰å±æ€§æ˜¯å¦åªå­˜åœ¨äºå†…å­˜ï¼Œä¸è¢«æŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œå¦‚æœè®¾ç½®ä¸ºYESï¼Œè¿™ä¸ªå±æ€§å°±ä¸å‚ä¸æŒä¹…åŒ–æ“ä½œï¼Œå±æ€§çš„å…¶ä»–æ“ä½œæ²¡æœ‰åŒºåˆ«ã€‚transientéå¸¸é€‚åˆå­˜å‚¨ä¸€äº›åœ¨å†…å­˜ä¸­ç¼“å­˜çš„æ•°æ®ï¼Œä¾‹å¦‚å­˜å‚¨ä¸´æ—¶æ•°æ®ï¼Œè¿™äº›æ•°æ®æ¯æ¬¡éƒ½æ˜¯ä¸åŒçš„ï¼Œè€Œä¸”ä¸éœ€è¦è¿›è¡Œæœ¬åœ°æŒä¹…åŒ–ï¼Œæ‰€ä»¥å¯ä»¥å£°æ˜ä¸ºtransientçš„å±æ€§ã€‚

indexed: è®¾ç½®å½“å‰å±æ€§æ˜¯å¦æ˜¯ç´¢å¼•ã€‚æ·»åŠ ç´¢å¼•åå¯ä»¥æœ‰æ•ˆçš„æå‡æ£€ç´¢æ“ä½œçš„é€Ÿåº¦ã€‚ä½†æ˜¯å¯¹äºåˆ é™¤è¿™æ ·çš„æ“ä½œï¼Œåˆ é™¤ç´¢å¼•åå…¶ä»–åœ°æ–¹è¿˜éœ€è¦åšå‡ºç›¸åº”çš„å˜åŒ–ï¼Œæ‰€ä»¥é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚

Validation: é€šè¿‡Validationå¯ä»¥è®¾ç½®Max Valueå’ŒMin Valueï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ¡ä»¶æ¥çº¦å®šæ•°æ®ï¼Œå¯¹æ•°æ®çš„å­˜å‚¨è¿›è¡Œä¸€ä¸ªéªŒè¯ã€‚æ•°å€¼ç±»å‹éƒ½æœ‰ç›¸åŒçš„çº¦å®šæ–¹å¼ï¼Œè€Œå­—ç¬¦ä¸²åˆ™æ˜¯çº¦å®šé•¿åº¦ï¼Œdateæ˜¯çº¦å®šæ—¶é—´ã€‚

Reg. Ex.(Regular Expression): å¯ä»¥è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥éªŒè¯å’Œæ§åˆ¶æ•°æ®ï¼Œä¸å¯¹æ•°æ®è‡ªèº«äº§ç”Ÿå½±å“ã€‚(åªèƒ½åº”ç”¨äºStringç±»å‹)

Allows External Storage: å½“å­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå¦‚æœé‡åˆ°æ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œæ˜¯å¦å­˜å‚¨åœ¨å­˜å‚¨åŒºä¹‹å¤–ã€‚å¦‚æœé€‰æ‹©YESï¼Œå­˜å‚¨æ–‡ä»¶å¤§å°è¶…è¿‡1MBçš„æ–‡ä»¶ï¼Œéƒ½ä¼šå­˜å‚¨åœ¨å­˜å‚¨åŒºä¹‹å¤–ã€‚å¦åˆ™å¤§å‹æ–‡ä»¶å­˜å‚¨åœ¨å­˜å‚¨åŒºå†…ï¼Œä¼šé€ æˆSQLiteè¿›è¡Œè¡¨æ“ä½œæ—¶ï¼Œæ•ˆç‡å—åˆ°å½±å“ã€‚
</code></pre>

<p>Relationshipsè®¾ç½®</p>

<pre><code>delete rule: å®šä¹‰å…³è”å±æ€§çš„åˆ é™¤è§„åˆ™ã€‚åœ¨å½“å‰å¯¹è±¡å’Œå…¶ä»–å¯¹è±¡æœ‰å…³è”å…³ç³»æ—¶ï¼Œå½“å‰å¯¹è±¡è¢«åˆ é™¤åä¸ä¹‹å…³è”å¯¹è±¡çš„ååº”ã€‚è¿™ä¸ªå‚æ•°æœ‰å››ä¸ªæšä¸¾å€¼ï¼Œä»£ç å¯¹åº”ç€æ¨¡å‹æ–‡ä»¶çš„ç›¸åŒé€‰é¡¹ã€‚

NSNoActionDeleteRule åˆ é™¤åæ²¡æœ‰ä»»ä½•æ“ä½œï¼Œä¹Ÿä¸ä¼šå°†å…³è”å¯¹è±¡çš„å…³è”å±æ€§æŒ‡å‘nilã€‚åˆ é™¤åä½¿ç”¨å…³è”å¯¹è±¡çš„å…³è”å±æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–é—®é¢˜ã€‚

NSNullifyDeleteRule åˆ é™¤åä¼šå°†å…³è”å¯¹è±¡çš„å…³è”å±æ€§æŒ‡å‘nilï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚

NSCascadeDeleteRule åˆ é™¤å½“å‰å¯¹è±¡åï¼Œä¼šå°†ä¸ä¹‹å…³è”çš„å¯¹è±¡ä¹Ÿä¸€å¹¶åˆ é™¤ã€‚

NSDenyDeleteRule åœ¨åˆ é™¤å½“å‰å¯¹è±¡æ—¶ï¼Œå¦‚æœå½“å‰å¯¹è±¡è¿˜æŒ‡å‘å…¶ä»–å…³è”å¯¹è±¡ï¼Œåˆ™å½“å‰å¯¹è±¡ä¸èƒ½è¢«åˆ é™¤ã€‚

Type: ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼ŒTo Oneå’ŒTo Manyï¼Œè¡¨ç¤ºå½“å‰å…³ç³»æ˜¯ä¸€å¯¹å¤šè¿˜æ˜¯ä¸€å¯¹ä¸€ã€‚
</code></pre>

<p>å®ä½“</p>

<pre><code>Parent Entity: å¯ä»¥åœ¨å®ä½“ä¸­åˆ›å»ºç»§æ‰¿å…³ç³»ï¼Œåœ¨ä¸€ä¸ªå®ä½“çš„èœå•æ ä¸­é€šè¿‡Parent Entityå¯ä»¥è®¾ç½®çˆ¶å®ä½“ï¼Œè¿™æ ·å°±å­˜åœ¨äº†å®ä½“çš„ç»§æ‰¿å…³ç³»ï¼Œæœ€ååˆ›å»ºå‡ºæ¥çš„æ‰˜ç®¡æ¨¡å‹ç±»ä¹Ÿæ˜¯å…·æœ‰ç»§æ‰¿å…³ç³»çš„ã€‚æ³¨æ„ç»§æ‰¿å…³ç³»ä¸­å±æ€§åä¸è¦ç›¸åŒã€‚
</code></pre>

<p>ä½¿ç”¨äº†è¿™æ ·çš„ç»§æ‰¿å…³ç³»åï¼Œç³»ç»Ÿä¼šå°†å­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ•°æ®ï¼Œå­˜åœ¨çˆ¶ç±»çš„è¡¨ä¸­ï¼Œæ‰€æœ‰ç»§æ‰¿è‡ªåŒä¸€çˆ¶ç±»çš„å­ç±»éƒ½ä¼šå°†çˆ¶ç±»éƒ¨åˆ†å­˜æ”¾åœ¨çˆ¶ç±»çš„è¡¨ä¸­ã€‚è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´çˆ¶ç±»çš„è¡¨ä¸­æ•°æ®é‡è¿‡å¤šï¼Œé€ æˆæ€§èƒ½é—®é¢˜ã€‚</p>

<p>Fetch Requests</p>

<p>åœ¨æ¨¡å‹æ–‡ä»¶ä¸­Entitiesä¸‹é¢æœ‰ä¸€ä¸ªFetch Requestsï¼Œè¿™ä¸ªä¹Ÿæ˜¯é…ç½®è¯·æ±‚å¯¹è±¡çš„ã€‚ä½†æ˜¯è¿™ä¸ªä½¿ç”¨èµ·æ¥æ›´åŠ ç›´è§‚ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆä¸€äº›ç®€å•çš„è¯·æ±‚é…ç½®ã€‚ç›¸å¯¹äºä¸Šé¢è®²åˆ°çš„Fetched Propertiesï¼Œè¿™ä¸ªè¿˜æ˜¯æ›´æ–¹ä¾¿ä½¿ç”¨ä¸€äº›ã€‚</p>

<p><img src="/images/2009.png" title="Caption" ></p>

<p>Fetch Requests</p>

<p>ä¸Šé¢æ˜¯å¯¹Employeeå®ä½“çš„heightå±æ€§é…ç½®çš„Fetch Requestï¼Œè¿™é‡Œé…ç½®çš„heightè¦å°äº2ç±³ã€‚é…ç½®ä¹‹åå¯ä»¥é€šè¿‡NSManagedObjectModelç±»çš„fetchRequestTemplateForName:æ–¹æ³•è·å–è¿™ä¸ªè¯·æ±‚å¯¹è±¡ï¼Œå‚æ•°æ˜¯è¿™ä¸ªè¯·æ±‚é…ç½®çš„åç§°ï¼Œä¹Ÿå°±æ˜¯EmployeeFRã€‚</p>

<p>Editor Style</p>

<p>è¿™æ˜¯æˆ‘è®¤ä¸ºCoreDataæœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œå¯è§†åŒ–çš„æ¨¡å‹æ–‡ä»¶ç»“æ„ã€‚å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°å®ä½“å’Œå±æ€§çš„å…³ç³»ï¼Œä»¥åŠå®ä½“ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p>

<p><img src="/images/2010.png" title="Caption" ></p>

<p>Editor Style</p>

<p>ä¸€ä¸ª.xcdatamodeldæ¨¡å‹æ–‡ä»¶çš„å±•ç¤ºé£æ ¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åˆ—è¡¨çš„å½¢å¼(Table)ï¼Œå¦ä¸€ç§æ˜¯å›¾è¡¨çš„å½¢å¼å±•ç¤º(Graph)ã€‚</p>

<p>å›¾è¡¨çœ‹èµ·æ¥æ›´åŠ ç›´è§‚ï¼Œè€Œå›¾è¡¨åœ¨æ“ä½œä¸Šä¹Ÿæœ‰ä¸€äº›æ¯”Tableæ›´æ–¹ä¾¿çš„åœ°æ–¹ã€‚ä¾‹å¦‚åœ¨Tableçš„çŠ¶æ€ä¸‹æ·»åŠ ä¸¤ä¸ªå®ä½“çš„å…³è”å…³ç³»ï¼Œå¦‚æœåªåšä¸€æ¬¡å…³è”æ“ä½œï¼Œé»˜è®¤æ˜¯å•å‘çš„å…³ç³»ã€‚è€Œåœ¨Graphçš„çŠ¶æ€ä¸‹ï¼ŒæŒ‰ä½Controlå¯¹ä¸¤ä¸ªå›¾è¡¨è¿›è¡Œè¿çº¿ï¼Œä¸¤ä¸ªå®ä½“çš„ç»“æœå°±æ˜¯åŒå‘å…³è”çš„å…³ç³»ã€‚</p>

<p>æ‰‹åŠ¨åˆ›å»ºå®ä½“</p>

<p>å‡è®¾ä¸ä½¿ç”¨.xcdatamodeldæ¨¡å‹æ–‡ä»¶ï¼Œå…¨éƒ½æ˜¯çº¯ä»£ç ï¼Œæ€ä¹ˆåœ¨é¡¹ç›®é‡Œåˆ›å»ºå®ä½“å•Šï¼Ÿè¿™æ ·çš„è¯å°±éœ€è¦é€šè¿‡ä»£ç åˆ›å»ºå®ä½“æè¿°ã€å…³è”æè¿°ç­‰ä¿¡æ¯ï¼Œç„¶åè®¾ç½®ç»™NSManagedObjectModelå¯¹è±¡ã€‚è€Œä½¿ç”¨æ¨¡å‹æ–‡ä»¶çš„è¯ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡NSManagedObjectModelå¯¹è±¡æ¥è¯»å–æ–‡ä»¶ã€‚</p>

<p>å¦‚æœæ˜¯çº¯ä»£ç çš„è¯ï¼Œè‹¹æœæ›´æ¨èä½¿ç”¨KVCçš„æ–¹å¼å­˜å–å€¼ï¼Œç„¶åæ‰€æœ‰æ‰˜ç®¡å¯¹è±¡éƒ½ç”¨NSManagedObjectåˆ›å»ºã€‚ä½†æ˜¯è¿™æ ·å­˜åœ¨çš„é—®é¢˜å¾ˆå¤šï¼Œå¼€å‘æˆæœ¬æ¯”è¾ƒå¤§ã€ä½¿ç”¨ä¸æ–¹ä¾¿ç­‰ç­‰ã€‚æœ€å¤§çš„é—®é¢˜å°±æ˜¯å†™å±æ€§åçš„keyå­—ç¬¦ä¸²ï¼Œå¾ˆå®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”è¿™æ ·å¤±å»äº†CoreDataåŸæœ‰çš„ä¼˜ç‚¹ã€‚æ‰€ä»¥è¿˜æ˜¯æ¨èä½¿ç”¨.xcdatamodeldæ¨¡å‹æ–‡ä»¶çš„å¼€å‘æ–¹å¼ã€‚</p>

<p>åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶</p>

<p>åˆ›å»ºæ–‡ä»¶</p>

<p>åˆ›å»ºå®ä½“åï¼Œå°±å¯ä»¥æ ¹æ®å¯¹åº”çš„å®ä½“ï¼Œç”Ÿæˆå¼€å‘ä¸­ä½¿ç”¨çš„åŸºäºNSManagedObjectç±»çš„æ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶ã€‚</p>

<p>è¿˜æ˜¯æŒ‰ç…§ä¸Šé¢Departmentå’ŒEmployeeçš„ä¾‹å­ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªDepartmentå®ä½“ã€‚å› ä¸ºDepartmentå®ä½“æœ‰å¯¹å¤šå…³ç³»ï¼Œç”Ÿæˆæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶çš„å…³è”å±æ€§ä¸ä¸€æ ·ï¼Œå¯ä»¥ä½“ç°å‡ºå’Œå¯¹ä¸€å…³ç³»çš„åŒºåˆ«ï¼Œæ‰€ä»¥ä½¿ç”¨Departmentå®ä½“ç”Ÿæˆæ–‡ä»¶ã€‚</p>

<p>å¿«æ·é”®Command + N -> NSManagedObject subclass -> é€‰æ‹©æ¨¡å‹æ–‡ä»¶ -> é€‰æ‹©å®ä½“ï¼Œç”ŸæˆDepartmentå®ä½“å¯¹åº”çš„æ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶ã€‚</p>

<p><img src="/images/2012.png" title="Caption" ></p>

<p>ç”Ÿæˆçš„æ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶</p>

<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢ç”Ÿæˆäº†å››ä¸ªæ–‡ä»¶ï¼Œä»¥å®ä½“åå¼€å¤´çš„.hå’Œ.mæ–‡ä»¶ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯è¿™ä¸ªå®ä½“çš„Categoryæ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆç”ŸæˆCategoryæ–‡ä»¶ï¼Ÿä¸€ä¼šå†è¯´ï¼Œå…ˆæ‰“å¼€ç±»æ–‡ä»¶è¿›å»çœ‹çœ‹ã€‚</p>

<p>Category</p>

<p><img src="/images/2013.png" title="Caption" ></p>

<p>å®ä½“Category</p>

<p>å¯ä»¥çœ‹åˆ°ç±»æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªCategoryï¼Œåˆ†åˆ«æ˜¯CoreDataPropertieså’ŒCoreDataGeneratedAccessorsã€‚å…¶ä¸­å¦‚æœæ²¡æœ‰è®¾ç½®å¯¹å¤šå…³ç³»çš„å®ä½“ï¼Œåªä¼šæœ‰CoreDataPropertiesï¼Œè€Œè®¾ç½®äº†å¯¹å¤šå…³ç³»çš„å®ä½“ç³»ç»Ÿä¼šä¸ºå…¶ç”ŸæˆCoreDataGeneratedAccessorsã€‚</p>

<p>CoreDataPropertiesä¸­ä¼šç”Ÿæˆå®ä½“ä¸­å£°æ˜çš„Attributeså’ŒRelationshipsä¸­çš„å±æ€§ï¼Œå…¶ä¸­å¯¹å¤šå…³ç³»æ˜¯ç”¨NSSetå­˜å‚¨çš„å±æ€§ï¼Œå¦‚æœæ˜¯å¯¹ä¸€çš„å…³ç³»åˆ™æ˜¯éé›†åˆçš„å¯¹è±¡ç±»å‹å±æ€§ã€‚å†çœ‹.mæ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰å±æ€§éƒ½ç”¨@dynamicä¿®é¥°ï¼ŒCoreDataä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€ä¸ºæ‰€æœ‰Categoryä¸­çš„å±æ€§ç”Ÿæˆå®ç°ä»£ç ï¼Œæ‰€ä»¥è¿™é‡Œç”¨@dynamicä¿®é¥°ã€‚</p>

<p>å¯¹å¤šå±æ€§ç”Ÿæˆçš„CoreDataGeneratedAccessorsï¼Œæ˜¯ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆç®¡ç†å¯¹å¤šå±æ€§é›†åˆçš„æ–¹æ³•ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ªå±æ€§å¯¹åº”å››ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•çš„å®ç°ä¹Ÿæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€å®ç°çš„ï¼Œæ–¹æ³•éƒ½æ˜¯ç”¨æ¥æ“ä½œé›†åˆå¯¹è±¡çš„ã€‚</p>

<p>æ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶</p>

<p>ç‚¹å‡»ç³»ç»Ÿç”Ÿæˆçš„æ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶ï¼Œæ­¤ç±»æ˜¯ç»§æ‰¿è‡ªNSManagedObjectç±»çš„ã€‚å¯ä»¥çœ‹åˆ°é‡Œé¢éå¸¸å¹²å‡€ï¼Œæ²¡æœ‰å…¶ä»–é€»è¾‘ä»£ç ã€‚</p>

<p>æ ¹æ®è‹¹æœçš„æ³¨é‡Šä»£ç ï¼šInsert code here to declare functionality of your managed object subclassï¼Œæç¤ºåº”è¯¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç¼–å†™æ­¤ç±»ç›¸å…³çš„é€»è¾‘ä»£ç ã€‚è¿™é‡Œå°±æ˜¯ç¼–å†™æ­¤ç±»é€»è¾‘ä»£ç çš„åœ°æ–¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»€ä¹ˆéƒ½ä¸å†™ï¼Œçœ‹éœ€æ±‚å•¦ã€‚</p>

<p>ä»»æ„ç±»å‹å±æ€§</p>

<p>å®ä½“æ”¯æŒåˆ›å»ºä»»æ„ç»§æ‰¿è‡ªNSObjectç±»çš„å±æ€§ï¼Œä¾‹å¦‚é¡¹ç›®ä¸­æ‰‹åŠ¨åˆ›å»ºçš„ç±»ã€‚é¡¹ç›®ä¸­åˆ›å»ºçš„ç±»åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­å¹¶ä¸ä¼šä½“ç°ï¼Œå¯ä»¥åœ¨å±æ€§ç±»å‹é€‰æ‹©transformableç±»å‹ï¼Œç„¶åç”Ÿæˆæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå°†è¿™ä¸ªå±æ€§å£°æ˜ä¸ºidç±»å‹ï¼Œåœ¨åˆ›å»ºç±»æ–‡ä»¶åï¼Œå¯ä»¥ç›´æ¥æ‰‹åŠ¨æ›´æ”¹è¿™ä¸ªå±æ€§çš„ç±»å‹ä¸ºæˆ‘ä»¬æƒ³è¦çš„ç±»å‹ã€‚</p>

<p>å¯¹äºæ‰‹åŠ¨è®¾ç½®çš„å±æ€§æœ‰ä¸€ä¸ªè¦æ±‚ï¼Œå±æ€§æ‰€å±çš„ç±»å¿…é¡»æ˜¯éµå®ˆNSCodingåè®®ï¼Œå› ä¸ºè¿™ä¸ªå±æ€§è¦è¢«å½’æ¡£åˆ°æœ¬åœ°ã€‚</p>

<p>æ ‡é‡ç±»å‹</p>

<p>åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶æ—¶ï¼Œå®ä½“å±æ€§çš„ç±»å‹æ— è®ºæ˜¯é€‰æ‹©çš„integer32è¿˜æ˜¯floatï¼Œåªè¦æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œæœ€ååˆ›å»ºå‡ºæ¥çš„é»˜è®¤éƒ½æ˜¯NSNumberç±»å‹çš„ï¼Œè¿™æ˜¯Xcodeé»˜è®¤çš„ã€‚</p>

<p>å¦‚æœéœ€è¦ç”Ÿæˆçš„å±æ€§ç±»å‹æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œå¯ä»¥åœ¨åˆ›å»ºæ–‡ä»¶æ—¶å‹¾é€‰Use scalar properties for primitive data typesé€‰é¡¹ï¼Œè¿™æ ·å°±å‘Šè¯‰ç³»ç»Ÿéœ€è¦ç”Ÿæˆæ ‡é‡ç±»å‹å±æ€§ï¼Œåˆ›å»ºå‡ºæ¥çš„å±æ€§å°±æ˜¯int64_tã€floatè¿™æ ·çš„åŸºç¡€æ•°æ®ç±»å‹ã€‚</p>

<p><img src="/images/2014.png" title="Caption" ></p>

<p>æ ‡é‡ç±»å‹</p>

<p>æ›´æ–°æ–‡ä»¶</p>

<p>å½“å‰æ¨¡å‹å¯¹åº”çš„å®ä½“å‘ç”Ÿæ”¹å˜åï¼Œéœ€è¦é‡æ–°ç”Ÿæˆæ¨¡å‹Categoryæ–‡ä»¶ã€‚ç”Ÿæˆæ­¥éª¤å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸»è¦æ˜¯æ›¿æ¢Categoryæ–‡ä»¶ï¼Œæ‰˜ç®¡å¯¹è±¡æ–‡ä»¶ä¸ä¼šè¢«æ›¿æ¢ã€‚ç”Ÿæˆæ–‡ä»¶æ—¶ä¸éœ€è¦åˆ é™¤ï¼Œç›´æ¥æ›¿æ¢æ–‡ä»¶ã€‚</p>

<p>CoreDataå¢åˆ æ”¹æŸ¥</p>

<p>ä¸‹é¢å…³äºCoreDataçš„ç›¸å…³æ“ä½œï¼Œè¿˜æ˜¯åŸºäºä¸Šé¢Departmentå’ŒEmployeeçš„ä¾‹å­ã€‚å¹¶ä¸”å¼•å…¥äº†Companyå½“åš.xcdatamodeldæ¨¡å‹æ–‡ä»¶ï¼Œå‰é¢ä¸¤ä¸ªå®ä½“è¢«åŒ…å«åœ¨Companyä¸­ã€‚</p>

<p>å…ˆè®²è®²NSManagedObjectContext</p>

<p>åœ¨iOS5ä¹‹å‰åˆ›å»ºNSManagedObjectContextå¯¹è±¡æ—¶ï¼Œéƒ½æ˜¯ç›´æ¥é€šè¿‡initæ–¹æ³•æ¥åˆ›å»ºã€‚iOS5ä¹‹åè‹¹æœæ›´åŠ æ¨èä½¿ç”¨initWithConcurrencyType:æ–¹æ³•æ¥åˆ›å»ºï¼Œåœ¨åˆ›å»ºçš„æ—¶å€™æŒ‡å®šå½“å‰æ˜¯ä»€ä¹ˆç±»å‹çš„å¹¶å‘é˜Ÿåˆ—ï¼Œåˆå§‹åŒ–æ–¹æ³•å‚æ•°æ˜¯ä¸€ä¸ªæšä¸¾å€¼ã€‚è¿™é‡Œç®€å•è¯´è¯´MOCï¼Œåé¢å¤šçº¿ç¨‹éƒ¨åˆ†è¿˜ä¼šæ¶‰åŠMOCå¤šçº¿ç¨‹ç›¸å…³çš„ä¸œè¥¿ã€‚</p>

<p>NSManagedObjectContextåˆå§‹åŒ–æ–¹æ³•çš„æšä¸¾å€¼å‚æ•°ä¸»è¦æœ‰ä¸‰ä¸ªç±»å‹ï¼š</p>

<pre><code>NSConfinementConcurrencyType å¦‚æœä½¿ç”¨initæ–¹æ³•åˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªå¹¶å‘ç±»å‹ã€‚åœ¨iOS9ä¹‹åå·²ç»è¢«è‹¹æœåºŸå¼ƒï¼Œä¸å»ºè®®ç”¨è¿™ä¸ªAPIï¼Œè°ƒç”¨æŸäº›æ¯”è¾ƒæ–°çš„CoreDataçš„APIå¯èƒ½ä¼šå¯¼è‡´å´©æºƒã€‚

NSPrivateQueueConcurrencyType ç§æœ‰å¹¶å‘é˜Ÿåˆ—ç±»å‹ï¼Œæ“ä½œéƒ½æ˜¯åœ¨å­çº¿ç¨‹ä¸­å®Œæˆçš„ã€‚

NSMainQueueConcurrencyType ä¸»å¹¶å‘é˜Ÿåˆ—ç±»å‹ï¼Œå¦‚æœæ¶‰åŠåˆ°UIç›¸å…³çš„æ“ä½œï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨è¿™ä¸ªå‚æ•°åˆå§‹åŒ–ä¸Šä¸‹æ–‡ã€‚
</code></pre>

<p>å¦‚æœè¿˜ä½¿ç”¨initæ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¹åé¢æ¨å‡ºçš„ä¸€äº›APIä¸å…¼å®¹ï¼Œå¯¼è‡´å¤šçº¿ç¨‹ç›¸å…³çš„é”™è¯¯ã€‚ä¾‹å¦‚ä¸‹é¢çš„é”™è¯¯ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æ˜¾å¼çš„è®¾ç½®å¹¶å‘ç±»å‹ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªå·²ç»å¼ƒç”¨çš„NSConfinementConcurrencyTypeç±»å‹ï¼Œå°±ä¼šå¯¼è‡´æ–°æ¨å‡ºçš„APIå‘ç”Ÿä¸å…¼å®¹çš„å´©æºƒé”™è¯¯ã€‚</p>

<p>Terminating app due to uncaught exception &lsquo;NSInvalidArgumentException&rsquo;, reason: &lsquo;NSConfinementConcurrencyType context</p>

<p>åˆ›å»ºMOC</p>

<p>ä¸‹é¢æ˜¯æ ¹æ®Companyæ¨¡å‹æ–‡ä»¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªä¸»é˜Ÿåˆ—å¹¶å‘ç±»å‹çš„MOCã€‚</p>

<p>// åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶å‘é˜Ÿåˆ—è®¾ç½®ä¸ºä¸»é˜Ÿåˆ—
NSManagedObjectContext <em>context = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType];
// åˆ›å»ºæ‰˜ç®¡å¯¹è±¡æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨Company.momdè·¯å¾„å½“åšåˆå§‹åŒ–å‚æ•°
NSURL </em>modelPath = [[NSBundle mainBundle] URLForResource:@&ldquo;Company&rdquo; withExtension:@&ldquo;momd&rdquo;];
NSManagedObjectModel <em>model = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelPath];
// åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨è°ƒåº¦å™¨
NSPersistentStoreCoordinator </em>coordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:model];
// åˆ›å»ºå¹¶å…³è”SQLiteæ•°æ®åº“æ–‡ä»¶ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ä¸ä¼šé‡å¤åˆ›å»º
NSString *dataPath = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES).lastObject;
dataPath = [dataPath stringByAppendingFormat:@&ldquo;/%@.sqlite&rdquo;, @&ldquo;Company&rdquo;];
[coordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[NSURL fileURLWithPath:dataPath] options:nil error:nil];
// ä¸Šä¸‹æ–‡å¯¹è±¡è®¾ç½®å±æ€§ä¸ºæŒä¹…åŒ–å­˜å‚¨å™¨
context.persistentStoreCoordinator = coordinator;</p>

<p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªMOCï¼Œæˆ‘ä»¬ä»ä¸Šå¾€ä¸‹çœ‹è¿™æ®µä»£ç ã€‚</p>

<p>momdæ–‡ä»¶</p>

<p>å…³äºMOCçš„å¹¶å‘é˜Ÿåˆ—ç±»å‹ä¸Šé¢å·²ç»ç®€å•è¯´äº†ï¼ŒMOCä¸‹é¢å‡ºç°äº†momdçš„å­—æ ·ï¼Œè¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</p>

<p><img src="/images/2015.png" title="Caption" ></p>

<p>momdæ–‡ä»¶</p>

<p>åœ¨åˆ›å»ºåç¼€ä¸º.xcdatamodeldçš„æ¨¡å‹æ–‡ä»¶åï¼Œæ¨¡å‹æ–‡ä»¶åœ¨ç¼–è¯‘æœŸå°†ä¼šè¢«ç¼–è¯‘ä¸ºåç¼€ä¸º.momdçš„æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨.appä¸­ï¼Œä¹Ÿå°±æ˜¯Main Bundleä¸­ã€‚åœ¨å­˜åœ¨å¤šä¸ªæ¨¡å‹æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åŠ è½½ä¸åŒçš„.momdæ–‡ä»¶ï¼Œæ¥åˆ›å»ºä¸åŒçš„NSManagedObjectModelå¯¹è±¡ï¼Œæ¯ä¸ªNSManagedObjectModelå¯¹åº”ç€ä¸åŒçš„æ¨¡å‹æ–‡ä»¶ã€‚</p>

<p>NSManagedObjectModelç±»ä¸­åŒ…å«äº†æ¨¡å‹æ–‡ä»¶ä¸­çš„æ‰€æœ‰entitiesã€configurationsã€fetchRequestsçš„æè¿°ã€‚è™½ç„¶.momdæ–‡ä»¶æ˜¯æ”¯æŒå­˜æ”¾åœ¨.appä¸­çš„ï¼Œå…¶ä»–äººå¯ä»¥é€šè¿‡æ‰“å¼€.appåŒ…çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯è¿™ä¸ªæ–‡ä»¶æ˜¯ç»è¿‡ç¼–ç çš„ï¼Œå¹¶ä¸ä¼šçŸ¥é“è¿™ä¸ª.momdæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ä»¶æ˜¯éå¸¸å®‰å…¨çš„ã€‚é€šè¿‡NSManagedObjectModelè·å–æ¨¡å‹æ–‡ä»¶æè¿°åï¼Œæ¥åˆ›å»ºå’Œå…³è”æ•°æ®åº“ï¼Œå¹¶äº¤ç»™PSCç®¡ç†ã€‚</p>

<p>å¦‚æœä¸æŒ‡å®šNSManagedObjectModelå¯¹åº”å“ªä¸ªæ¨¡å‹æ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨initæ–¹æ³•åˆå§‹åŒ–NSManagedObjectModelç±»ï¼Œç³»ç»Ÿä¼šé»˜è®¤å°†æ‰€æœ‰æ¨¡å‹æ–‡ä»¶çš„è¡¨éƒ½æ”¾åœ¨ä¸€ä¸ªSQLiteæ•°æ®åº“ä¸­ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨mainBundleä¸­çš„ä¸åŒ.momdæ–‡ä»¶ï¼Œå¯¹ä¸åŒçš„NSManagedObjectModelè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·åœ¨åˆ›å»ºæ•°æ®åº“æ—¶å°±ä¼šåˆ›å»ºä¸åŒçš„æ•°æ®åº“æ–‡ä»¶ã€‚</p>

<p>æŒä¹…åŒ–å­˜å‚¨è°ƒåº¦å™¨(PSC)</p>

<p>åœ¨NSManagedObjectModelä¸‹é¢å°±æ˜¯NSPersistentStoreCoordinatorï¼Œè¿™ä¸ªç±»åœ¨CoreDataæ¡†æ¶ä½“ç³»ä¸­èµ·åˆ°äº†â€œä¸­æ¢â€çš„ä½œç”¨ã€‚å¯¹ä¸Šå±‚èµ·åˆ°äº†æä¾›ç®€å•çš„è°ƒç”¨æ¥å£ï¼Œå¹¶å‘ä¸Šå±‚éšè—æŒä¹…åŒ–å®ç°é€»è¾‘ã€‚å¯¹ä¸‹å±‚èµ·åˆ°äº†åè°ƒå¤šä¸ªæŒä¹…åŒ–å­˜å‚¨å¯¹è±¡(NSPersistentStore)ï¼Œä½¿ä¸‹å±‚åªéœ€è¦ä¸“æ³¨æŒä¹…åŒ–ç›¸å…³é€»è¾‘ã€‚</p>

<p><img src="/images/2016.png" title="Caption" ></p>

<p>æŒä¹…åŒ–å­˜å‚¨è°ƒåº¦å™¨</p>

<p>addPersistentStoreWithType: configuration: URL: options: error:æ–¹æ³•æ˜¯PSCåˆ›å»ºå¹¶å…³è”æ•°æ®åº“çš„éƒ¨åˆ†ï¼Œå…³è”æœ¬åœ°æ•°æ®åº“åä¼šè¿”å›ä¸€ä¸ªNSPersistentStoreç±»å‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è´Ÿè´£å…·ä½“æŒä¹…åŒ–å­˜å‚¨çš„å®ç°ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ·»åŠ å¤šä¸ªæŒä¹…åŒ–å­˜å‚¨å¯¹è±¡ï¼Œå¹¶ä¸”å¤šä¸ªæŒä¹…åŒ–å­˜å‚¨å¯¹è±¡éƒ½å…³è”ä¸€ä¸ªPSCï¼Œè¿™æ˜¯å…è®¸çš„ï¼Œåœ¨ä¸Šé¢çš„å›¾ä¸­ä¹Ÿçœ‹åˆ°äº†è¿™æ ·çš„ç»“æ„ã€‚ä½†æ˜¯è¿™æ ·çš„éœ€æ±‚å¹¶ä¸å¤šï¼Œè€Œä¸”ç®¡ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šè¿™æ ·åšã€‚</p>

<p>PSCæœ‰å››ç§å¯é€‰çš„æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆï¼Œç”¨å¾—æœ€å¤šçš„æ˜¯SQLiteçš„æ–¹å¼ã€‚å…¶ä¸­Binaryå’ŒXMLè¿™ä¸¤ç§æ–¹å¼ï¼Œåœ¨è¿›è¡Œæ•°æ®æ“ä½œæ—¶ï¼Œéœ€è¦å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å¯¹å†…å­˜çš„æ¶ˆè€—æ˜¯å¾ˆå¤§çš„ã€‚</p>

<pre><code>NSSQLiteStoreType : SQLiteæ•°æ®åº“

NSXMLStoreType : XMLæ–‡ä»¶

NSBinaryStoreType : äºŒè¿›åˆ¶æ–‡ä»¶

NSInMemoryStoreType : ç›´æ¥å­˜å‚¨åœ¨å†…å­˜ä¸­
</code></pre>

<p>æ’å…¥æ“ä½œ</p>

<p>// åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜åˆ›å»ºçš„æ‰˜ç®¡å¯¹è±¡æ‰€å±å®ä½“å
Employee <em>emp = [NSEntityDescription insertNewObjectForEntityForName:@&ldquo;Employee&rdquo; inManagedObjectContext:context];
emp.name = @&ldquo;lxz&rdquo;;
emp.height = @1.7;
emp.brithday = [NSDate date];
// é€šè¿‡ä¸Šä¸‹æ–‡ä¿å­˜å¯¹è±¡ï¼Œå¹¶åœ¨ä¿å­˜å‰åˆ¤æ–­æ˜¯å¦æœ‰æ›´æ”¹
NSError </em>error = nil;
if (context.hasChanges) {
    [context save:&amp;error];
}
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;CoreData Insert Data Error : %@&rdquo;, error);
}</p>

<p>é€šè¿‡NSEntityDescriptionçš„insertç±»æ–¹æ³•ï¼Œç”Ÿæˆå¹¶è¿”å›ä¸€ä¸ªEmployeeæ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡æ’å…¥åˆ°æŒ‡å®šçš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p>

<p>MOCå°†æ“ä½œçš„æ•°æ®å­˜æ”¾åœ¨ç¼“å­˜å±‚ï¼Œåªæœ‰è°ƒç”¨MOCçš„saveæ–¹æ³•åï¼Œæ‰ä¼šçœŸæ­£å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œå¦åˆ™è¿™ä¸ªå¯¹è±¡åªæ˜¯å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·åšé¿å…äº†é¢‘ç¹çš„æ•°æ®åº“è®¿é—®ã€‚</p>

<p>åˆ é™¤æ“ä½œ</p>

<p>// å»ºç«‹è·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡æ˜å¯¹Employeeå®ä½“è¿›è¡Œåˆ é™¤æ“ä½œ
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// åˆ›å»ºè°“è¯å¯¹è±¡ï¼Œè¿‡æ»¤å‡ºç¬¦åˆè¦æ±‚çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¦åˆ é™¤çš„å¯¹è±¡
NSPredicate </em>predicate = [NSPredicate predicateWithFormat:@&ldquo;name = %@&rdquo;, @&ldquo;lxz&rdquo;];
request.predicate = predicate;
// æ‰§è¡Œè·å–æ“ä½œï¼Œæ‰¾åˆ°è¦åˆ é™¤çš„å¯¹è±¡
NSError <em>error = nil;
NSArray </em>employees = [context executeFetchRequest:request error:&amp;error];
// éå†ç¬¦åˆåˆ é™¤è¦æ±‚çš„å¯¹è±¡æ•°ç»„ï¼Œæ‰§è¡Œåˆ é™¤æ“ä½œ
[employees enumerateObjectsUsingBlock:^(Employee * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    [context deleteObject:obj];
}];
// ä¿å­˜ä¸Šä¸‹æ–‡
if (context.hasChanges) {
    [context save:nil];
}
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;CoreData Delete Data Error : %@&rdquo;, error);
}</p>

<p>é¦–å…ˆè·å–éœ€è¦åˆ é™¤çš„æ‰˜ç®¡å¯¹è±¡ï¼Œéå†è·å–çš„å¯¹è±¡æ•°ç»„ï¼Œé€ä¸ªåˆ é™¤åè°ƒç”¨MOCçš„saveæ–¹æ³•ä¿å­˜ã€‚</p>

<p>ä¿®æ”¹æ“ä½œ</p>

<p>// å»ºç«‹è·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œçš„å®ä½“ä¸ºEmployee
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// åˆ›å»ºè°“è¯å¯¹è±¡ï¼Œè®¾ç½®è¿‡æ»¤æ¡ä»¶
NSPredicate </em>predicate = [NSPredicate predicateWithFormat:@&ldquo;name = %@&rdquo;, @&ldquo;lxz&rdquo;];
request.predicate = predicate;
// æ‰§è¡Œè·å–è¯·æ±‚ï¼Œè·å–åˆ°ç¬¦åˆè¦æ±‚çš„æ‰˜ç®¡å¯¹è±¡
NSError <em>error = nil;
NSArray </em>employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    obj.height = @3.f;
}];
// å°†ä¸Šé¢çš„ä¿®æ”¹è¿›è¡Œå­˜å‚¨
if (context.hasChanges) {
    [context save:nil];
}
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;CoreData Update Data Error : %@&rdquo;, error);
}</p>

<p>å’Œä¸Šé¢ä¸€æ ·ï¼Œé¦–å…ˆè·å–åˆ°éœ€è¦æ›´æ”¹çš„æ‰˜ç®¡å¯¹è±¡ï¼Œæ›´æ”¹å®Œæˆåè°ƒç”¨MOCçš„saveæ–¹æ³•æŒä¹…åŒ–åˆ°æœ¬åœ°ã€‚</p>

<p>æŸ¥æ‰¾æ“ä½œ</p>

<p>// å»ºç«‹è·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡æ˜æ“ä½œçš„å®ä½“ä¸ºEmployee
NSFetchRequest <em>request = [NSFetchRequest fetchRequestWithEntityName:@&ldquo;Employee&rdquo;];
// æ‰§è¡Œè·å–æ“ä½œï¼Œè·å–æ‰€æœ‰Employeeæ‰˜ç®¡å¯¹è±¡
NSError </em>error = nil;
NSArray *employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * <em>Nonnull obj, NSUInteger idx, BOOL * </em>Nonnull stop) {
    NSLog(@&ldquo;Employee Name : %@, Height : %@, Brithday : %@&rdquo;, obj.name, obj.height, obj.brithday);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@&ldquo;CoreData Ergodic Data Error : %@&rdquo;, error);
}</p>

<p>æŸ¥æ‰¾æ“ä½œæœ€ç®€å•ç²—æš´ï¼Œå› ä¸ºæ˜¯æ¼”ç¤ºä»£ç ï¼Œæ‰€ä»¥ç›´æ¥å°†æ‰€æœ‰Employeeè¡¨ä¸­çš„æ‰˜ç®¡å¯¹è±¡åŠ è½½å‡ºæ¥ã€‚åœ¨å®é™…å¼€å‘ä¸­è‚¯å®šä¸ä¼šè¿™æ ·åšï¼Œåªéœ€è¦åŠ è½½éœ€è¦çš„æ•°æ®ã€‚åé¢è¿˜ä¼šè®²åˆ°ä¸€äº›æ›´é«˜çº§çš„æ“ä½œï¼Œä¼šæ¶‰åŠåˆ°è·å–æ–¹é¢çš„ä¸œè¥¿ã€‚</p>

<p>æ€»ç»“</p>

<p>åœ¨CoreDataä¸­æ‰€æœ‰çš„æ‰˜ç®¡å¯¹è±¡è¢«åˆ›å»ºå‡ºæ¥åï¼Œéƒ½æ˜¯å…³è”ç€MOCå¯¹è±¡çš„ã€‚æ‰€ä»¥åœ¨å¯¹è±¡è¿›è¡Œä»»ä½•æ“ä½œåï¼Œéƒ½ä¼šè¢«è®°å½•åœ¨MOCä¸­ã€‚åœ¨æœ€åè°ƒç”¨MOCçš„saveæ–¹æ³•åï¼ŒMOCä¼šå°†æ“ä½œäº¤ç»™PSCå»å¤„ç†ï¼ŒPSCå°†ä¼šå°†è¿™ä¸ªå­˜å‚¨ä»»åŠ¡æŒ‡æ´¾ç»™NSPersistentStoreå¯¹è±¡ã€‚</p>

<p>ä¸Šé¢çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œçœ‹ä¸Šå»å¤§ä½“æµç¨‹éƒ½å·®ä¸å¤šï¼Œéƒ½æ˜¯ä¸€äº›æœ€åŸºç¡€çš„ç®€å•æ“ä½œï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å°†ä¼šå°†ä¸€äº›æ¯”è¾ƒå¤æ‚çš„æ“ä½œã€‚</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/04/coredateashishemme/">CoreDataæ˜¯ä»€ä¹ˆï¼Ÿ</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-04T02:59:42+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:59 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>è¿™æ®µæ—¶é—´å…¬å¸ä¸€ç›´æ¯”è¾ƒå¿™ï¼Œå’Œç»„é‡Œå°ä¼™ä¼´ä¸€èµ·æŠŠå…¬å¸é¡¹ç›®æŒ‰ç…§ä¹‹å‰é€»è¾‘é‡å†™äº†ä¸€ä¸‹ã€‚ç”±äºé¡¹ç›®æ¯”è¾ƒå¤§ï¼Œè¿˜è¦å…¼é¡¾ä¹‹å‰é¡¹ç›®çš„è¿­ä»£å’Œå…¶ä»–é¡¹ç›®ï¼Œç›®å‰ä¸ºæ­¢åªå†™å®Œç¬¬ä¸€é˜¶æ®µã€‚</p>

<p>ä¹‹å‰é¡¹ç›®æœ¬åœ°æŒä¹…åŒ–æ–¹æ¡ˆä¸»è¦ç”¨çš„æ˜¯SQLiteï¼Œè¿™æ¬¡é‡å†™é¡¹ç›®æ‰“ç®—æ¢ä¸€ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼Œäºæ˜¯æˆ‘ä»¬ç»è¿‡è®¨è®ºé€‰æ‹©äº†è‹¹æœçš„â€œäº²å„¿å­â€CoreDataã€‚</p>

<p>åœ¨ä½¿ç”¨CoreDataçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€è¾¹å­¦ä¹ ä¸€è¾¹å®è·µã€‚åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œä¸€äº›å†™çš„è´¨é‡æ¯”è¾ƒé«˜çš„åšå®¢å¯¹æˆ‘çš„å¸®åŠ©ä¹Ÿå¾ˆå¤§ï¼Œä¾‹å¦‚objc.ioç­‰åšå®¢ï¼Œåœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥äº†ï¼Œéå¸¸æ„Ÿè°¢è¿™äº›ä½œè€…ã€‚</p>

<p>å…ˆä¸è¯´é¡¹ç›®ä¸­ç”¨ä¸ç”¨å¾—åˆ°ï¼Œå…¶å®å¾ˆå¤šäººéƒ½æ˜¯ä¸äº†è§£CoreDataçš„ï¼Œä½†æ˜¯ç»è¿‡æˆ‘çš„å­¦ä¹ å‘ç°CoreDataè¿˜æ˜¯æŒºä¸é”™çš„ã€‚æ‰€ä»¥æ­£å¦‚è¿™ç³»åˆ—æ–‡ç« çš„åå­—ä¸€æ ·-è®¤è¯†CoreDataï¼Œæ‰“ç®—å†™è¿™ç³»åˆ—æ–‡ç« æ¥è®¤è¯†ä¸€ä¸‹CoreDataã€‚</p>

<p>è¿™ç³»åˆ—åšå®¢å°†ä»ç®€å•åˆ°å¤æ‚çš„æ¥è®²ä¸€ä¸‹CoreDataï¼Œå…¶ä¸­é™¤äº†åŸºç¡€ä½¿ç”¨è¿˜ä¼šåŒ…æ‹¬å¤šçº¿ç¨‹ã€æ‰¹é‡æ•°æ®å¤„ç†ç­‰å†…å®¹ï¼Œè¿™äº›å¾ˆå¤šéƒ½æ˜¯æˆ‘å…¬å¸é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­æ¥è§¦åˆ°çš„ï¼Œæˆ‘ä»¬ä¹Ÿè®¾æƒ³äº†ä¸€äº›æç«¯çš„æƒ…å†µï¼Œè§£å†³æ–¹æ¡ˆéƒ½ä¼šä½“ç°åœ¨è¿™ç³»åˆ—åšå®¢ä¸­ã€‚</p>

<p>æœ¬äººæ¥è§¦CoreDataæ—¶é—´å¹¶ä¸é•¿ï¼Œåªæ˜¯ä¸“é—¨èŠ±äº†ä¸€æ®µæ—¶é—´å­¦ä¹ CoreDataã€‚</p>

<p>æœ¬ç³»åˆ—æ–‡ç« åé‡äºé€šè¿‡å›¾å½¢åŒ–ç•Œé¢ä½¿ç”¨CoreDataï¼Œä¸ä¼šå…¨éƒ¨é‡‡å–çº¯ä»£ç è¿›è¡ŒCoreDataçš„æ‰€æœ‰æ“ä½œï¼Œè€Œä¸”é‚£æ ·æ“ä½œèµ·æ¥ä¹Ÿç¡®å®æ¯”è¾ƒéº»çƒ¦ï¼Œåè€Œå°±å¤±å»äº†CoreDataçš„ä¼˜åŠ¿å’Œæœ¬è´¨ã€‚</p>

<p>æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼</p>

<p>å†™åœ¨å‰é¢</p>

<p>åœ¨CoreDataä¸­æœ‰ä¸€äº›å¸¸ç”¨çš„ç±»ï¼Œç§°å‘¼å¯èƒ½å„ä¸ç›¸åŒã€‚æ‰€ä»¥è¿™é‡Œå…ˆçº¦å®šä¸€äº›å…³é”®å­—ï¼Œä»¥ä¾¿ç†è§£åé¢çš„ä¸€äº›å†…å®¹ï¼Œè¿™äº›çº¦å®šå¾ˆå¤šéƒ½æ˜¯å‡ºç°åœ¨è‹¹æœçš„å®˜æ–¹æ–‡æ¡£ä¸­çš„ã€‚</p>

<p>NSPersistentStoreCoordinator(Persistent Store Coordinator)ï¼Œç¼©å†™ä¸ºPSCã€‚</p>

<p>NSManagedObjectContext(Managed Object Context)ï¼Œç¼©å†™ä¸ºMOCã€‚</p>

<p>NSManagedObjectModel(Managed Object Model)ï¼Œç¼©å†™ä¸ºMOMã€‚</p>

<p>NSManagedObjectåŠå…¶å­ç±»ï¼Œæ ¹æ®è‹±æ–‡ç¿»è¯‘å’Œå…¶ä½œç”¨ï¼Œç§°ä¹‹ä¸ºæ‰˜ç®¡å¯¹è±¡ã€‚</p>

<p>åç¼€åä¸º.xcdatamodeldçš„æ–‡ä»¶ï¼Œå› ä¸ºå­˜å‚¨ç€æ‰€æœ‰å®ä½“çš„æ•°æ®ç»“æ„å’Œè¡¨ç¤ºï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºæ¨¡å‹æ–‡ä»¶ã€‚</p>

<p>ä»€ä¹ˆæ˜¯CoreDataï¼Ÿ</p>

<p>ç®€å•ä»‹ç»ä¸€ä¸‹</p>

<p>CoreDataå‡ºç°åœ¨iOS 3ä¸­ï¼Œæ˜¯è‹¹æœæ¨å‡ºçš„ä¸€ä¸ªæ•°æ®å­˜å‚¨æ¡†æ¶ã€‚CoreDataæä¾›äº†ä¸€ç§å¯¹è±¡å…³ç³»æ˜ å°„(ORM)çš„å­˜å‚¨å…³ç³»ï¼Œç±»ä¼¼äºJavaçš„hibernateæ¡†æ¶ã€‚CoreDataå¯ä»¥å°†OCå¯¹è±¡å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®åº“ä¸­çš„æ•°æ®è½¬åŒ–ä¸ºOCå¯¹è±¡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™ä»»ä½•SQLè¯­å¥ï¼Œè¿™æ˜¯ç³»ç»Ÿå¸®æˆ‘ä»¬å®Œæˆã€‚</p>

<p>CoreDataæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸éœ€è¦ç¼–å†™ä»»ä½•SQLè¯­å¥ï¼ŒCoreDataå°è£…äº†æ•°æ®åº“çš„æ“ä½œè¿‡ç¨‹ï¼Œä»¥åŠæ•°æ®åº“ä¸­æ•°æ®å’ŒOCå¯¹è±¡çš„è½¬æ¢è¿‡ç¨‹ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨CoreDataçš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šæ“ä½œå°±åƒæ˜¯å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œä¸€æ ·ï¼Œä¹Ÿæœ‰è¿‡æ»¤æ¡ä»¶ã€æ’åºç­‰æ“ä½œã€‚</p>

<p>è¿™å°±ç›¸å½“äºCoreDataå®Œæˆäº†Modelå±‚çš„å¤§é‡å·¥ä½œï¼Œä¾‹å¦‚Modelå±‚çš„è¡¨ç¤ºå’ŒæŒä¹…åŒ–ï¼Œæœ‰æ•ˆçš„å‡å°‘äº†å¼€å‘çš„å·¥ä½œé‡ï¼Œä½¿Modelå±‚çš„è®¾è®¡æ›´åŠ é¢å‘å¯¹è±¡ã€‚</p>

<p>CoreDataå¥½ç”¨å—ï¼Ÿ</p>

<p>ä¹‹å‰å¬äººè¯´è¿‡ï¼ŒCoreDataæ¯”è¾ƒå®¹æ˜“å…¥æ‰‹ï¼Œä½†æ˜¯å¾ˆéš¾å­¦ç²¾ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯´CoreDataä¸å¥½ç”¨çš„åŸå› ä¹‹ä¸€ï¼Œåªæ˜¯å› ä¸ºä½¿ç”¨æ–¹å¼æœ‰é—®é¢˜ï¼Œæˆ–è€…è¯´å¹¶æ²¡æœ‰çœŸæ­£æŒæ¡CoreDataã€‚</p>

<p>å¦‚æœä»æ€§èƒ½ä¸Šæ¥è¯´ï¼ŒCoreDataæ¯”SQLiteç¡®å®ç•¥å·®ä¸€äº›ã€‚ä½†æ˜¯å¯¹äºç§»åŠ¨ç«¯æ¥è¯´ï¼Œå¹¶ä¸éœ€è¦å¤§å‹ç½‘ç«™çš„é«˜å¹¶å‘ï¼Œæ‰€ä»¥è¿™ç‚¹æ€§èƒ½å·®åˆ«å‡ ä¹æ˜¯æ²¡æœ‰å½±å“çš„ï¼Œæ‰€ä»¥è¿™ç‚¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚åœ¨åé¢çš„æ–‡ç« ä¸­ï¼Œå°†ä¼šç»™å‡ºCoreDataçš„ä¼˜ç‚¹å’Œç¼ºç‚¹å¯¹æ¯”ï¼Œä»¥åŠè¯¦ç»†çš„æ€§èƒ½æµ‹è¯„ã€‚</p>

<p>CoreDataä¸»è¦çš„å‡ ä¸ªç±»</p>

<pre><code>NSManagedObjectContext
</code></pre>

<p>æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡ï¼Œè¿›è¡Œæ•°æ®æ“ä½œæ—¶å¤§å¤šéƒ½æ˜¯å’Œè¿™ä¸ªç±»æ‰“äº¤é“ã€‚</p>

<pre><code>NSManagedObjectModel
</code></pre>

<p>æ‰˜ç®¡å¯¹è±¡æ¨¡å‹ï¼Œä¸€ä¸ªæ‰˜ç®¡å¯¹è±¡æ¨¡å‹å…³è”ä¸€ä¸ªæ¨¡å‹æ–‡ä»¶(.xcdatamodeld)ï¼Œå­˜å‚¨ç€æ•°æ®åº“çš„æ•°æ®ç»“æ„ã€‚</p>

<pre><code>NSPersistentStoreCoordinator
</code></pre>

<p>æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨ï¼Œè´Ÿè´£åè°ƒå­˜å‚¨åŒºå’Œä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»ã€‚</p>

<pre><code>NSManagedObject
</code></pre>

<p>æ‰˜ç®¡å¯¹è±¡ç±»ï¼Œæ‰€æœ‰CoreDataä¸­çš„æ‰˜ç®¡å¯¹è±¡éƒ½å¿…é¡»ç»§æ‰¿è‡ªå½“å‰ç±»ï¼Œæ ¹æ®å®ä½“åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶ã€‚</p>

<p>CoreDataç®€å•åˆ›å»ºæµç¨‹</p>

<p>æ¨¡å‹æ–‡ä»¶æ“ä½œ</p>

<p>1.1 åˆ›å»ºæ¨¡å‹æ–‡ä»¶ï¼Œåç¼€åä¸º.xcdatamodeldã€‚åˆ›å»ºæ¨¡å‹æ–‡ä»¶ä¹‹åï¼Œå¯ä»¥åœ¨å…¶å†…éƒ¨è¿›è¡Œæ·»åŠ å®ä½“ç­‰æ“ä½œ(ç”¨äºè¡¨ç¤ºæ•°æ®åº“æ–‡ä»¶çš„æ•°æ®ç»“æ„)</p>

<p>1.2 æ·»åŠ å®ä½“(è¡¨ç¤ºæ•°æ®åº“æ–‡ä»¶ä¸­çš„è¡¨ç»“æ„)ï¼Œæ·»åŠ å®ä½“åéœ€è¦é€šè¿‡å®ä½“ï¼Œæ¥åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶ã€‚</p>

<p>1.3 æ·»åŠ å±æ€§å¹¶è®¾ç½®ç±»å‹ï¼Œå¯ä»¥åœ¨å±æ€§çš„å³ä¾§é¢æ¿ä¸­è®¾ç½®é»˜è®¤å€¼ç­‰é€‰é¡¹ã€‚(æ¯ç§æ•°æ®ç±»å‹è®¾ç½®é€‰é¡¹æ˜¯ä¸åŒçš„)</p>

<p>1.4 åˆ›å»ºè·å–è¯·æ±‚æ¨¡æ¿ã€è®¾ç½®é…ç½®æ¨¡æ¿ç­‰ã€‚</p>

<p>1.5 æ ¹æ®æŒ‡å®šå®ä½“ï¼Œåˆ›å»ºæ‰˜ç®¡å¯¹è±¡ç±»æ–‡ä»¶(åŸºäºNSManagedObjectçš„ç±»æ–‡ä»¶)</p>

<p>å®ä¾‹åŒ–ä¸Šä¸‹æ–‡å¯¹è±¡</p>

<p>2.1 åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡(NSManagedObjectContext)</p>

<p>2.2 åˆ›å»ºæ‰˜ç®¡å¯¹è±¡æ¨¡å‹(NSManagedObjectModel)</p>

<p>2.3 æ ¹æ®æ‰˜ç®¡å¯¹è±¡æ¨¡å‹ï¼Œåˆ›å»ºæŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨(NSPersistentStoreCoordinator)</p>

<p>2.4 å…³è”å¹¶åˆ›å»ºæœ¬åœ°æ•°æ®åº“æ–‡ä»¶ï¼Œå¹¶è¿”å›æŒä¹…åŒ–å­˜å‚¨å¯¹è±¡(NSPersistentStore)</p>

<p>2.5 å°†æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨èµ‹å€¼ç»™æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡ï¼Œå®ŒæˆåŸºæœ¬åˆ›å»ºã€‚</p>

<p>CoreDataç»“æ„</p>

<p>CoreDataçš„ç»“æ„æ„æˆ</p>

<p>ä¹‹å‰çœ‹åˆ°è¿‡å‡ å¼ ä»‹ç»CoreDataç»“æ„çš„å›¾ç‰‡ï¼Œæ„Ÿè§‰å…¶è¡¨ç¤ºçš„ç»“æ„æ¯”è¾ƒæ¸…æ™°ã€‚å¯ä»¥é€šè¿‡è¿™å‡ å¼ å›¾ç‰‡åˆæ­¥è®¤è¯†ä¸€ä¸‹CoreDataï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­è¿˜ä¼šå¯¹è¿™å‡ ä¸ªç±»è¿›è¡Œè¯¦ç»†è§£é‡Šã€‚</p>

<p><img src="/images/1001.png" title="Caption" ></p>

<p>æ•´ä½“ç»“æ„</p>

<p>ä¸Šå›¾ä¸­æ˜¯åˆå§‹åŒ–MOCæ‰€æ¶‰åŠåˆ°çš„ä¸€äº›ç±»ï¼Œç”±è¿™äº›ç±»å®ä¾‹åŒ–å¹¶æœ€ç»ˆæ„æˆå¯ä»¥ä½¿ç”¨çš„MOCã€‚å›¾ä¸­ç¼–å·æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªå…·å¤‡æ•°æ®å¤„ç†èƒ½åŠ›çš„MOCè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å’Œä¸Šé¢ä»‹ç»è¿‡çš„å®ä¾‹åŒ–ä¸Šä¸‹æ–‡å¯¹è±¡ç›¸åŒã€‚</p>

<p><img src="/images/1002.png" title="Caption" ></p>

<p>NSManagedObjectContext</p>

<p>åœ¨PSCåˆ›å»ºå¹¶å…³è”æœ¬åœ°æ•°æ®åº“ï¼Œå¹¶è®¾ç½®ä¸ºMOCçš„persistentStoreCoordinatorå±æ€§åï¼ŒMOCå°±å…·å¤‡å¯¹å½“å‰å­˜å‚¨åŒºæ‰€æœ‰æ‰˜ç®¡å¯¹è±¡æ“ä½œçš„èƒ½åŠ›ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMOCå¯¹æ‰˜ç®¡å¯¹è±¡æ˜¯æ‡’åŠ è½½çš„ï¼Œåœ¨ä½¿ç”¨æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°MOCçš„ç¼“å­˜ä¸­ã€‚</p>

<p><img src="/images/1003.png" title="Caption" ></p>

<p>NSManagedObjectModel</p>

<p>MOMå¯¹è±¡åŠ è½½æ¨¡å‹æ–‡ä»¶åï¼Œè·å–åˆ°æ¨¡å‹æ–‡ä»¶ä¸­æ‰€æœ‰å®ä½“çš„æ„æˆç»“æ„ã€‚ç”±äºMOMä¸­å­˜å‚¨ç€æ¨¡å‹æ–‡ä»¶çš„ç»“æ„ï¼ŒPSCéœ€è¦é€šè¿‡MOMå¯¹è±¡å®ä¾‹åŒ–æœ¬åœ°æ•°æ®åº“ã€‚</p>

<p><img src="/images/1004.png" title="Caption" ></p>

<p>Entity</p>

<p>æ‰€æœ‰å±æ€§éƒ½å­˜åœ¨Entityä¸­ï¼Œä»¥åŠæœ‰å…³è”å…³ç³»çš„å±æ€§å’Œè¯·æ±‚æ¨¡æ¿ï¼Œè¿™éƒ½ä¼šåœ¨åé¢çš„ç« èŠ‚ä¸­è®²åˆ°ã€‚</p>

<p><img src="/images/1005.png" title="Caption" ></p>

<p>NSManagedObject</p>

<p>å¯ä»¥é€šè¿‡Entityåˆ›å»ºç»§æ‰¿è‡ªNSManagedObjectç±»çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯å¼€å‘ä¸­ä½¿ç”¨çš„æ‰˜ç®¡å¯¹è±¡ï¼Œå…·å¤‡æ¨¡å‹å¯¹è±¡çš„è¡¨ç¤ºåŠŸèƒ½ï¼ŒCoreDataçš„æœ¬åœ°æŒä¹…åŒ–éƒ½æ˜¯é€šè¿‡è¿™ä¸ªç±»åŠå…¶å­ç±»å®Œæˆçš„ã€‚</p>

<p>æŒä¹…åŒ–å­˜å‚¨è°ƒåº¦å™¨</p>

<p>åœ¨CoreDataçš„æ•´ä½“ç»“æ„ä¸­ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ä¸€ä¸ªæ˜¯NSManagedObjectContextç®¡ç†çš„æ¨¡å‹éƒ¨åˆ†ï¼Œç®¡ç†ç€æ‰€æœ‰CoreDataçš„æ‰˜ç®¡å¯¹è±¡ã€‚ä¸€ä¸ªæ˜¯SQLiteå®ç°çš„æœ¬åœ°æŒä¹…åŒ–éƒ¨åˆ†ï¼Œè´Ÿè´£å’ŒSQLæ•°æ®åº“è¿›è¡Œæ•°æ®äº¤äº’ï¼Œä¸»è¦ç”±NSPersistentStoreç±»æ“ä½œã€‚è¿™å°±æ„æˆäº†CoreDataçš„å¤§ä½“ç»“æ„ã€‚</p>

<p><img src="/images/1006.png" title="Caption" ></p>

<p>ç»“æ„å›¾</p>

<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤éƒ¨åˆ†éƒ½æ˜¯æ¯”è¾ƒç‹¬ç«‹çš„ï¼Œä¸¤éƒ¨åˆ†çš„äº¤äº’ç”±ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨è°ƒåº¦å™¨(NSPersistentStoreCoordinator)æ¥æ§åˆ¶ã€‚ä¸Šå±‚NSManagedObjectContextå­˜å‚¨çš„æ•°æ®éƒ½æ˜¯äº¤ç»™æŒä¹…åŒ–è°ƒåº¦å™¨ï¼Œç”±è°ƒåº¦å™¨è°ƒç”¨å…·ä½“çš„æŒä¹…åŒ–å­˜å‚¨å¯¹è±¡(NSPersistentStore)æ¥æ“ä½œå¯¹åº”çš„æ•°æ®åº“æ–‡ä»¶ï¼ŒNSPersistentStoreè´Ÿè´£å­˜å‚¨çš„å®ç°ç»†èŠ‚ã€‚è¿™æ ·å°±å¾ˆå¥½çš„å°†ä¸¤éƒ¨åˆ†å®ç°äº†åˆ†ç¦»ã€‚</p>

<p>ä¸ªäººéšæƒ³</p>

<p>å¯¹äºCoreDataçš„æ•´ä½“ç»“æ„ï¼Œå› ä¸ºCoreDataåº•å±‚å­˜å‚¨æœ¬æ¥å°±æ˜¯ç”¨SQLiteå®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ç”¨CoreDataçš„ç»“æ„å’ŒSQLiteå¯¹æ¯”äº†ä¸€ä¸‹ï¼Œå‘ç°è¿˜æ˜¯å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„çš„ã€‚</p>

<p>.xcdatamodeldæ–‡ä»¶ä»£è¡¨ç€æ•°æ®åº“æ–‡ä»¶ç»“æ„ï¼Œé€šè¿‡.xcdatamodeldç¼–è¯‘åçš„.momdæ–‡ä»¶ç”Ÿæˆæ•°æ®åº“ã€‚æ¯ä¸ªå®ä½“ä»£è¡¨ä¸€å¼ æ•°æ®è¡¨ï¼Œå®ä½“ä¹‹é—´çš„å…³è”å…³ç³»å°±æ˜¯SQLiteçš„å¤–é”®ã€‚</p>

<p>ä¸‹å›¾å°±æ˜¯CoreDataåº•å±‚å­˜å‚¨çš„ç»“æ„ï¼Œç”¨çº¢åœˆåœˆä½çš„éƒ¨åˆ†æŒ‡å‘å…³è”è¡¨çš„ä¸»é”®ä¸‹æ ‡ã€‚ä¾‹å¦‚1å°±æŒ‡å‘å…³è”è¡¨çš„ä¸»é”®ä¸‹æ ‡ä¸º1çš„è¡Œã€‚</p>

<p><img src="/images/1007.png" title="Caption" ></p>

<p>å¤–é”®</p>

<p>CoreDataæ‚è°ˆ</p>

<p>CoreDataæ•°æ®å­˜å‚¨å®‰å…¨</p>

<p>CoreDataæœ¬è´¨è¿˜æ˜¯ä½¿ç”¨SQLiteè¿›è¡Œå­˜å‚¨ï¼Œå¹¶æ²¡æœ‰å¦å¤–æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå…·ä½“çš„æ•°æ®åŠ è§£å¯†è¿˜éœ€è¦è‡ªå·±å®Œæˆã€‚</p>

<p>CoreDataåœ¨ç¡¬ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ç»“æ„ï¼š</p>

<p><img src="/images/1008.png" title="Caption" ></p>

<p>æ•°æ®åº“å­˜å‚¨ç»“æ„</p>

<p>é€šè¿‡PSCæŒ‡å®šåˆ›å»ºSQLiteç›®å½•åï¼Œä¼šåœ¨æŒ‡å®šçš„ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜ä¼šç”Ÿæˆä¸¤ä¸ªåŒåä½†åç¼€ä¸åŒçš„æ–‡ä»¶ï¼Œå…¶ä¸­åªæœ‰åç¼€.sqliteçš„æ–‡ä»¶æ˜¯å­˜å‚¨æ•°æ®çš„æ–‡ä»¶ã€‚</p>

<p>è¿™ä¸ªæ•°æ®åº“æ–‡ä»¶ä¸­ä¼šé»˜è®¤ç”Ÿæˆä¸‰ä¸ªè¡¨ï¼ŒZ_METADATAã€Z_PRIMARYKEYã€Z_MODELCACHEï¼Œå…¶ä»–æˆ‘ä»¬è‡ªå·±çš„è¡¨ä¹Ÿéƒ½æ˜¯å¤§å†™Zå¼€å¤´çš„ã€‚</p>

<p>åœ¨æ¯ä¸ªè¡¨ä¸­ï¼Œç³»ç»Ÿè¿˜ä¼šé»˜è®¤ç”Ÿæˆä¸‰ä¸ªå­—æ®µï¼ŒZ_PKã€Z_ENTã€Z_OPTä¸‰ä¸ªå­—æ®µï¼Œä¹Ÿéƒ½æ˜¯å¤§å†™Zå¼€å¤´å¹¶ä¸”å¸¦ä¸‹åˆ’çº¿çš„ã€‚å…¶ä»–å­—æ®µå°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„å­—æ®µäº†ï¼Œå¤§å†™Zå¼€å¤´ä½†ä¸å¸¦ä¸‹åˆ’çº¿ã€‚</p>

<p>CoreDataæ‰§è¡Œæ•ˆç‡</p>

<p>ç°åœ¨å¸‚é¢ä¸Šçš„å¤§å¤šæ•°é¡¹ç›®ï¼Œéƒ½æ˜¯ä½¿ç”¨SQLiteä½œä¸ºæŒä¹…åŒ–çš„æ–¹æ¡ˆï¼Œè€ŒCoreDataçš„ä½¿ç”¨å¹¶ä¸æ˜¯å¾ˆæ™®éã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è®¤ä¸ºé¦–å…ˆæ˜¯å¾ˆå¤šé¡¹ç›®å¼€å§‹çš„æ¯”è¾ƒæ—©ï¼Œé‚£æ—¶å€™å¥½å¤šiOSç¨‹åºå‘˜éƒ½æ˜¯ä»å…¶ä»–è¯­è¨€è½¬è¿‡æ¥çš„ï¼Œæ›´åŠ ç†Ÿæ‚‰SQLiteï¼Œæ‰€ä»¥ç”¨SQLiteæ¯”è¾ƒå¤šä¸€äº›ã€‚åé¢å¦‚æœä¸è¿›è¡Œå¤§çš„é¡¹ç›®é‡æ„ï¼Œå°±å¾ˆéš¾æ¢å…¶ä»–çš„æŒä¹…åŒ–æ–¹æ¡ˆäº†ã€‚</p>

<p>è¿˜æœ‰å°±æ˜¯ä¸ç†Ÿæ‚‰CoreDataï¼Œä¹Ÿä¸æƒ³å»äº†è§£å’Œæ·±å…¥å­¦ä¹ CoreDataï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯å¾ˆå¤§çš„åŸå› ã€‚æ‰€ä»¥é¡¹ç›®ä¸­ç”¨CoreDataçš„äººå¹¶ä¸å¤šï¼Œè€ŒçœŸæ­£æŒæ¡CoreDataæŠ€æœ¯çš„äººæ›´å°‘ã€‚</p>

<p>ä¹‹å‰å¬å…¶ä»–äººè¯´CoreDataçš„æ‰§è¡Œæ•ˆç‡ä¸å¦‚SQLiteé«˜ï¼Œè¿™ä¸ªå¦‚æœæ·±ç©¶çš„è¯ï¼Œç¡®å®CoreDataè¦æ¯”SQLiteæ•ˆç‡å·®ä¸€äº›ï¼Œåªä¸è¿‡å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚CoreDataæœ¬è´¨ä¹Ÿæ˜¯åœ¨åº•å±‚æ‰§è¡ŒSQLè¯­å¥ï¼Œåªæ˜¯CoreDataçš„SQLè¯­å¥æ‰§è¡Œé€»è¾‘æ¯”è¾ƒè€—æ—¶ï¼Œæ²¡æœ‰æ‰‹åŠ¨ç¼–å†™SQLè¯­å¥æ›´åŠ ç›´æ¥ã€‚æˆ‘ä»¬å¯ä»¥å°†CoreDataçš„è°ƒè¯•åŠŸèƒ½æ‰“å¼€ï¼Œå…·ä½“çœ‹ä¸€ä¸‹SQLè¯­å¥çš„æ‰§è¡Œã€‚</p>

<p>è¿™é‡Œè¦è¯´ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯æ¯•ç«Ÿä¸æ˜¯æœåŠ¡ç«¯ï¼Œä¸éœ€è¦åƒæœåŠ¡å™¨é‚£æ ·å¤§é‡çš„æ•°æ®æŸ¥è¯¢ï¼Œæ‰€ä»¥CoreDataæ˜¯å®Œå…¨å¯ä»¥åº”å¯¹å®¢æˆ·ç«¯çš„æŸ¥è¯¢é‡çš„ã€‚å¦‚æœä»çµæ´»æ€§æ¥è¯´ï¼ŒCoreDataç¡®å®æ²¡æœ‰SQLiteçš„çµæ´»æ€§é«˜ï¼Œä¸€äº›SQLiteçš„å¤æ‚åŠŸèƒ½å¯èƒ½ä¹Ÿä¸èƒ½å®ç°ï¼Œä½†æ˜¯å°±ç›®å‰å¤§å¤šæ•°é¡¹ç›®æ¥è¯´ï¼ŒCoreDataå·²ç»èƒ½å¤Ÿæ»¡è¶³é¡¹ç›®æŒä¹…åŒ–éœ€æ±‚äº†ã€‚</p>

<p>å¯¼è‡´æ‰§è¡Œæ•ˆç‡å·®å¼‚çš„åŸå› è¿˜ä½“ç°åœ¨å¯¹è±¡è½¬æ¢ä¸Šï¼ŒCoreDataåœ¨æ‰§è¡ŒSQLè¯­å¥çš„åŸºç¡€ä¸Šï¼Œè¿˜å¤šäº†ä¸€å±‚å°†æ•°æ®æ˜ å°„ç»™æ‰˜ç®¡å¯¹è±¡çš„æ“ä½œï¼Œè¿™æ ·å¾—åˆ°çš„å°±æ˜¯OCçš„æ‰˜ç®¡å¯¹è±¡ï¼Œè€ŒSQLiteå¾—åˆ°çš„åˆ™ä¸æ˜¯ã€‚å¦‚æœç»™SQLiteæ‰§è¡Œå®Œæˆåï¼Œä¹ŸåŠ ä¸€å±‚åˆ›å»ºæ‰˜ç®¡å¯¹è±¡å¹¶èµ‹å€¼çš„æ“ä½œï¼Œè¿™æ—¶å€™å¯¹æ¯”æ€§èƒ½ä¸¤è€…çš„å·®è·å¯èƒ½å°±ä¼šæ›´å°äº†ã€‚</p>

<p>æ€§èƒ½è¯„æµ‹</p>

<p>ä¸‹é¢æ˜¯ä¸€ç¯‡å…³äºCoreDataã€FMDBã€Realmæ€§èƒ½æµ‹è¯•ç»“æœçš„åšå®¢ï¼Œæœ€åçš„ç»“æœæˆ‘ä¹Ÿæ²¡æœ‰å»éªŒè¯ï¼Œåªæ˜¯å¤§è‡´çœ‹äº†ä¸€ä¸‹ä»£ç è¿˜æ˜¯æ¯”ä»·é è°±çš„ã€‚ä½œè€…æµ‹è¯•Demoå’ŒåŸæ–‡åœ°å€ã€‚</p>

<p>æµ‹è¯•æ•°æ®çš„æ•°é‡æ˜¯ä»¥Kä¸ºå•ä½ï¼Œæœ€å°‘ä¸º1Kçš„æ•°æ®é‡ã€‚æ¶‰åŠåˆ°çš„æ“ä½œä¸»è¦æ˜¯ä¸‹é¢å››ç§ï¼š</p>

<pre><code>æ–°å»ºæ•°æ®åº“å¹¶æ’å…¥1Kæ¡æ•°æ®ã€‚

å·²æœ‰æ•°æ®åº“ï¼Œæ’å…¥1Kæ¡æ•°æ®ã€‚

æŸ¥è¯¢æ€»é‡ä¸º10Kæ¡æ•°æ®ï¼Œè¿ç»­æŸ¥è¯¢å•æ¬¡ä¸º1Kæ•°æ®ã€‚

10Kæ¡æ•°æ®æ€»é‡ï¼Œæ›´æ–°å…¶ä¸­1Kæ¡æ•°æ®çš„éƒ¨åˆ†å­—æ®µæ€§èƒ½ã€‚
</code></pre>

<p>æ€§èƒ½è¯„æµ‹ç»“æœï¼š</p>

<p>æ ¹æ®æµ‹è¯•ç»“æœå¯ä»¥å‘ç°ï¼Œåœ¨å‰é¢ä¸¤ç§æ’å…¥æ“ä½œï¼ŒCoreDataçš„æ€§èƒ½æ¯”FMDBå’ŒRealmè¦å¿«å¾ˆå¤šã€‚</p>

<p>è€Œå¯¹äºæŸ¥è¯¢æ“ä½œï¼ŒCoreDataæ¯”å…¶ä»–ä¸¤ç§æ“ä½œè€—æ—¶å¤šå¾ˆå¤šï¼Œå¤§æ¦‚å¤šå‡ºä¸‰å››å€ã€‚è¿™å¾ˆå¯èƒ½å’ŒCoreDataå°†æŸ¥è¯¢ç»“æœçš„æ•°æ®è½¬ä¸ºæ‰˜ç®¡å¯¹è±¡æœ‰å…³ç³»ï¼ŒæŠ›å»CoreDataè¿™éƒ¨åˆ†è½¬æ¢æ“ä½œæ€§èƒ½ä¼šæ¯”ç°åœ¨å¥½å¾ˆå¤šã€‚</p>

<p>è€Œæ›´æ–°æ“ä½œåˆ™ç›´æ¥åŸºäºSQLiteå°è£…çš„FMDBæœ‰ç»å¯¹çš„ä¼˜åŠ¿ï¼ŒFMDBå’Œå…¶ä»–ä¸¤ç§æ“ä½œå·®è·å¤§æ¦‚æ˜¯åå€å·¦å³ï¼Œè€Œå…¶ä»–ä¸¤ç§æ“ä½œæ€§èƒ½å·®ä¸å¤šã€‚å½“ç„¶CoreDataä¹Ÿå­˜åœ¨ç€ä¸Šé¢æåˆ°çš„å¯¹è±¡è½¬æ¢æ“ä½œï¼ŒCoreDataæŠ›å»è¿™æ­¥ç»“æœå¯èƒ½ä¼šæ¯”ç°åœ¨å¥½å¾ˆå¤šã€‚</p>

<p>æµ‹è¯•å›¾è¡¨</p>

<p>ä¸‹é¢çš„æµ‹è¯•æ•°æ®ä¸­ï¼Œå–å¾—æ˜¯ä¸‰æ¬¡æµ‹è¯•ç»“æœçš„å¹³å‡å€¼ã€‚</p>

<p><img src="/images/1009.png" title="Caption" ></p>

<p><img src="/images/1010.png" title="Caption" ></p>

<p>æ–°å»ºæ•°æ®åº“å¹¶æ’å…¥1Kæ¡æ•°æ®</p>

<p><img src="/images/1011.png" title="Caption" ></p>

<p>å·²æœ‰æ•°æ®åº“ï¼Œæ’å…¥1Kæ¡æ•°æ®</p>

<p><img src="/images/1012.png" title="Caption" ></p>

<p>æŸ¥è¯¢æ€»é‡ä¸º10Kæ¡æ•°æ®ï¼Œè¿ç»­æŸ¥è¯¢å•æ¬¡ä¸º1Kæ•°æ®</p>

<p><img src="/images/1013.png" title="Caption" ></p>

<p>10Kæ¡æ•°æ®æ€»é‡ï¼Œæ›´æ–°å…¶ä¸­1Kæ¡æ•°æ®çš„éƒ¨åˆ†å­—æ®µæ€§èƒ½</p>

<p>CoreDataè°ƒè¯•</p>

<p>Xcodeè°ƒè¯•å‘½ä»¤</p>

<p>CoreDataæœ¬è´¨ä¸Šæ˜¯å¯¹SQLiteçš„ä¸€ä¸ªå°è£…ï¼Œåœ¨å†…éƒ¨å°†å¯¹è±¡çš„æŒä¹…åŒ–è½¬åŒ–ä¸ºSQLè¯­å¥æ‰§è¡Œï¼Œå¯ä»¥åœ¨é¡¹ç›®ä¸­å°†CoreDataè°ƒè¯•æ‰“å¼€ï¼Œä»è€Œå¯ä»¥çœ‹åˆ°CoreDataçš„SQLè¯­å¥æ‰§è¡Œå’Œä¸€äº›å…¶ä»–logä¿¡æ¯ã€‚</p>

<p>æ‰“å¼€Productï¼Œé€‰æ‹©Edit Scheme.</p>

<p>é€‰æ‹©Argumentsï¼Œåœ¨ä¸‹é¢çš„ArgumentsPassed On Launchä¸­æ·»åŠ ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹ã€‚</p>

<p>(1)-com.apple.CoreData.SQLDebug</p>

<p>(2)1</p>

<p>ç»ˆç«¯è°ƒè¯•å‘½ä»¤</p>

<p>å¦‚æœæ˜¯åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè°ƒè¯•ç¨‹åºï¼Œå¯ä»¥é€šè¿‡ sqlite3 /æ•°æ®åº“è·¯å¾„/ å‘½ä»¤æ¥æŸ¥çœ‹å’Œæ“ä½œæ•°æ®åº“ã€‚</p>

<p>.tables æŸ¥çœ‹å½“å‰æ•°æ®åº“æ–‡ä»¶ä¸­æ‰€æœ‰çš„è¡¨å</p>

<p>select *from tableName æ‰§è¡ŒæŸ¥è¯¢çš„SQLè¯­å¥</p>

<p><img src="/images/1014.png" title="Caption" ></p>

<p>ç»ˆç«¯è°ƒè¯•å‘½ä»¤</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/apples/'>apples (2)</a></li>
<li class='category'><a href='/blog/categories/audio-video/'>audio-video (1)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (14)</a></li>
<li class='category'><a href='/blog/categories/foundation/'>foundation (32)</a></li>
<li class='category'><a href='/blog/categories/full/'>full (13)</a></li>
<li class='category'><a href='/blog/categories/low-level/'>low-level (4)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (4)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (1)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (12)</a></li>
<li class='category'><a href='/blog/categories/reverse/'>reverse (25)</a></li>
<li class='category'><a href='/blog/categories/senior/'>senior (38)</a></li>
<li class='category'><a href='/blog/categories/stack/'>stack (13)</a></li>
<li class='category'><a href='/blog/categories/summarize/'>summarize (5)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/09/01/weixinhongbao/">ç¦åˆ©ï¼šæŠ¢çº¢åŒ…ç¥å™¨å°±æ˜¯è¿™ä¹ˆæ¥çš„</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/26/chongzhengzhidao/">é‡æ•´ä¹‹é“ï¼ˆé¢è¯•+æŠ€æœ¯+åº•å±‚+é«˜çº§ï¼‰</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/10/duoxianc/">å¤šçº¿ç¨‹ä¹‹è‘µèŠ±å®å…¸</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/05/zsqlfmdbcoredata/">CoreData vs SQLite vs FMDB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/05/xsqlyucoredata/">CoreData vs SQLite</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<h1>æ‰«ä¸€æ‰«<abbr title="The word 'æ‰«ä¸€æ‰«' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'æ‰«ä¸€æ‰«', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/index.html"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/index.html" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - iCocos -
<span class="credit">welcome to <a href="http://al1020119.github.io">æ›¹#é»</a></span>
</p>

</footer>
  






<!--
-->



</body>
</html>
