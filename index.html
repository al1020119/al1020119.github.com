
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="1. ç½‘ç»œå›¾ç‰‡æ˜¾ç¤ºå¤§ä½“æ­¥éª¤: ä¸‹è½½å›¾ç‰‡
å›¾ç‰‡å¤„ç†ï¼ˆè£å‰ªï¼Œè¾¹æ¡†ç­‰)
å†™å…¥ç£ç›˜
ä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº
ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´(å†…å­˜çº§åˆ«æ‹·è´)
è§£å‹ç¼©ä¸ºä½å›¾ï¼ˆè€—cpuè¾ƒé«˜ï¼‰
å¦‚æœä½å›¾æ•°æ®ä¸æ˜¯å­—èŠ‚å¯¹é½çš„ï¼ŒCoreAnimationä¼šcopyä¸€ä»½ä½å›¾æ•°æ®å¹¶è¿›è¡Œå­—èŠ‚å¯¹é½ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script>
function addBlankTargetForLinks () {
    $('a[href^="http"]').each(function(){
                              $(this).attr('target', '_blank');
                              });
}
$(document).bind('DOMNodeInserted', function(event) {
             addBlankTargetForLinks();
             });
</script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">é¦–é¡µ</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/other">å…¶ä»–</a></li>
  <li><a href="/about">å…³äº</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/05/tu-pian-jia-zai-you-hua-shen-jiu/">å›¾ç‰‡åŠ è½½ä¼˜åŒ–æ·±ç©¶</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><h3>1. ç½‘ç»œå›¾ç‰‡æ˜¾ç¤ºå¤§ä½“æ­¥éª¤:</h3>

<ul>
<li>ä¸‹è½½å›¾ç‰‡</li>
<li>å›¾ç‰‡å¤„ç†ï¼ˆè£å‰ªï¼Œè¾¹æ¡†ç­‰)</li>
<li>å†™å…¥ç£ç›˜</li>
<li>ä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº</li>
<li>ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´(å†…å­˜çº§åˆ«æ‹·è´)</li>
<li>è§£å‹ç¼©ä¸ºä½å›¾ï¼ˆè€—cpuè¾ƒé«˜ï¼‰</li>
<li>å¦‚æœä½å›¾æ•°æ®ä¸æ˜¯å­—èŠ‚å¯¹é½çš„ï¼ŒCoreAnimationä¼šcopyä¸€ä»½ä½å›¾æ•°æ®å¹¶è¿›è¡Œå­—èŠ‚å¯¹é½</li>
<li>CoreAnimationæ¸²æŸ“è§£å‹ç¼©è¿‡çš„ä½å›¾</li>
<li>ä»¥ä¸Š4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8æ­¥æ˜¯åœ¨UIImageViewçš„setImageæ—¶è¿›è¡Œçš„ï¼Œæ‰€ä»¥é»˜è®¤åœ¨ä¸»çº¿ç¨‹è¿›è¡Œ(iOS * UIæ“ä½œå¿…é¡»åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ)ã€‚</li>
</ul>


<h3>2. ä¸€äº›ä¼˜åŒ–æ€è·¯ï¼š</h3>

<ul>
<li>å¼‚æ­¥ä¸‹è½½å›¾ç‰‡</li>
<li>imageè§£å‹ç¼©æ”¾åˆ°å­çº¿ç¨‹</li>
<li>ä½¿ç”¨ç¼“å­˜ (åŒ…æ‹¬å†…å­˜çº§åˆ«å’Œç£ç›˜çº§åˆ«)</li>
<li>å­˜å‚¨è§£å‹ç¼©åçš„å›¾ç‰‡ï¼Œé¿å…ä¸‹æ¬¡ä»ç£ç›˜åŠ è½½çš„æ—¶å€™å†æ¬¡è§£å‹ç¼©</li>
<li>å‡å°‘å†…å­˜çº§åˆ«çš„æ‹·è´ ï¼ˆé’ˆå¯¹ç¬¬5ç‚¹å’Œç¬¬7ç‚¹ï¼‰</li>
<li>è‰¯å¥½çš„æ¥å£ï¼ˆæ¯”å¦‚SDWebImageä½¿ç”¨categoryï¼‰</li>
<li>Core Data vs æ–‡ä»¶å­˜å‚¨</li>
<li>å›¾ç‰‡é¢„ä¸‹è½½</li>
</ul>


<h6>2.1 å…³äºå¼‚æ­¥å›¾ç‰‡ä¸‹è½½:</h6>

<p>fastImageCacheä¸»è¦é’ˆå¯¹äºä»ç£ç›˜æ–‡ä»¶è¯»å–å¹¶å±•ç¤ºå›¾ç‰‡çš„æç«¯ä¼˜åŒ–ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰é›†æˆå¼‚æ­¥å›¾ç‰‡ä¸‹è½½çš„åŠŸèƒ½ã€‚è¿™é‡Œä¸»è¦æ¥çœ‹çœ‹SDWebImage(AFNetWorkingçš„åŸºæœ¬ç±»ä¼¼)çš„å®ç°æ–¹æ¡ˆï¼š</p>

<p>tableViewä¸­ï¼Œå¼‚æ­¥å›¾ç‰‡ä¸‹è½½ä»»åŠ¡çš„ç®¡ç†:</p>

<p>æˆ‘ä»¬çŸ¥é“ï¼ŒtableViewCellæ˜¯æœ‰é‡ç”¨æœºåˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå†…å­˜ä¸­åªæœ‰å½“å‰å¯è§çš„cellæ•°ç›®çš„å®ä¾‹ï¼Œæ»‘åŠ¨çš„æ—¶å€™ï¼Œæ–°æ˜¾ç¤ºcellä¼šé‡ç”¨è¢«æ»‘å‡ºçš„cellå¯¹è±¡ã€‚è¿™æ ·å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š</p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹åœ¨æˆ‘ä»¬ä¼šåœ¨cellForRowæ–¹æ³•é‡Œé¢è®¾ç½®cellçš„å›¾ç‰‡æ•°æ®æºï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªcellçš„imageviewå¯¹è±¡å¼€å¯äº†ä¸€ä¸ªä¸‹è½½ä»»åŠ¡ï¼Œè¿™ä¸ªæ—¶å€™è¯¥cellå¯¹è±¡å‘ç”Ÿäº†é‡ç”¨ï¼Œæ–°çš„imageæ•°æ®æºä¼šå¼€å¯å¦å¤–çš„ä¸€ä¸ªä¸‹è½½ä»»åŠ¡ï¼Œç”±äºä»–ä»¬å…³è”çš„imageviewå¯¹è±¡å®é™…ä¸Šæ˜¯åŒä¸€ä¸ªcellå®ä¾‹çš„imageviewå¯¹è±¡ï¼Œå°±ä¼šå‘ç”Ÿ2ä¸ªä¸‹è½½ä»»åŠ¡å›è°ƒç»™åŒä¸€ä¸ªimageviewå¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™å°±æœ‰å¿…è¦åšä¸€äº›å¤„ç†ï¼Œé¿å…å›è°ƒå‘ç”Ÿæ—¶ï¼Œé”™è¯¯çš„imageæ•°æ®æºåˆ·æ–°äº†UIã€‚</p>

<blockquote><p>SDWebImageæä¾›çš„UIImageViewæ‰©å±•çš„è§£å†³æ–¹æ¡ˆï¼š</p></blockquote>

<p>imageViewå¯¹è±¡ä¼šå…³è”ä¸€ä¸ªä¸‹è½½åˆ—è¡¨ï¼ˆåˆ—è¡¨æ˜¯ç»™AnimationImagesç”¨çš„ï¼Œè¿™ä¸ªæ—¶å€™ä¼šä¸‹è½½å¤šå¼ å›¾ç‰‡ï¼‰ï¼Œå½“tableviewæ»‘åŠ¨ï¼ŒimageViewé‡è®¾æ•°æ®æºï¼ˆurlï¼‰æ—¶ï¼Œä¼šcancelæ‰ä¸‹è½½åˆ—è¡¨ä¸­æ‰€æœ‰çš„ä»»åŠ¡ï¼Œç„¶åå¼€å¯ä¸€ä¸ªæ–°çš„ä¸‹è½½ä»»åŠ¡ã€‚è¿™æ ·å­å°±ä¿è¯äº†åªæœ‰å½“å‰å¯è§çš„cellå¯¹è±¡çš„imageViewå¯¹è±¡å…³è”çš„ä¸‹è½½ä»»åŠ¡èƒ½å¤Ÿå›è°ƒï¼Œä¸ä¼šå‘ç”Ÿimageé”™ä¹±ã€‚</p>

<p>åŒæ—¶ï¼ŒSDWebImageç®¡ç†äº†ä¸€ä¸ªå…¨å±€ä¸‹è½½é˜Ÿåˆ—ï¼ˆåœ¨DownloadManagerä¸­ï¼‰,å¹¶å‘é‡è®¾ç½®ä¸º6.ä¹Ÿå°±æ˜¯è¯´å¦‚æœå¯è§cellçš„æ•°ç›®æ˜¯å¤§äº6çš„ï¼Œå°±ä¼šæœ‰éƒ¨åˆ†ä¸‹è½½é˜Ÿåˆ—å¤„äºç­‰å¾…çŠ¶æ€ã€‚è€Œä¸”ï¼Œåœ¨æ·»åŠ ä¸‹è½½ä»»åŠ¡åˆ°å…¨å±€çš„ä¸‹è½½é˜Ÿåˆ—ä¸­å»çš„æ—¶å€™ï¼ŒSDWebImageé»˜è®¤æ˜¯é‡‡å–LIFOç­–ç•¥çš„ï¼Œå…·ä½“æ˜¯åœ¨æ·»åŠ ä¸‹è½½ä»»åŠ¡çš„æ—¶å€™ï¼Œå°†ä¸Šæ¬¡æ·»åŠ çš„ä¸‹è½½ä»»åŠ¡æ·»åŠ ä¾èµ–ä¸ºæ–°æ·»åŠ çš„ä¸‹è½½ä»»åŠ¡ã€‚</p>

<pre><code>    [wself.downloadQueue addOperation:operation];
    if (wself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) {
        // Emulate LIFO execution order by systematically adding new operations as last operation's dependency
        [wself.lastAddedOperation addDependency:operation];
        wself.lastAddedOperation = operation;
    }
</code></pre>

<p>å¦å¤–ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p>

<p>imageViewå¯¹è±¡å’Œå›¾ç‰‡çš„urlç›¸å…³è”ï¼Œåœ¨æ»‘åŠ¨æ—¶ï¼Œä¸å–æ¶ˆæ—§çš„ä¸‹è½½ä»»åŠ¡ï¼Œè€Œæ˜¯åœ¨ä¸‹è½½ä»»åŠ¡å®Œæˆå›è°ƒæ—¶ï¼Œè¿›è¡ŒurlåŒ¹é…ï¼Œåªæœ‰åŒ¹é…æˆåŠŸçš„imageä¼šåˆ·æ–°imageViewå¯¹è±¡ï¼Œè€Œå…¶ä»–çš„imageåˆ™åªåšç¼“å­˜æ“ä½œï¼Œè€Œä¸åˆ·æ–°UIã€‚</p>

<p>åŒæ—¶ï¼Œä»ç„¶ç®¡ç†ä¸€ä¸ªæ‰§è¡Œé˜Ÿåˆ—ï¼Œä¸ºäº†é¿å…å ç”¨å¤ªå¤šçš„èµ„æºï¼Œé€šå¸¸ä¼šå¯¹æ‰§è¡Œé˜Ÿåˆ—è®¾ç½®ä¸€ä¸ªæœ€å¤§çš„å¹¶å‘é‡ã€‚æ­¤å¤–ï¼Œä¸ºäº†ä¿è¯LIFOçš„ä¸‹è½½ç­–ç•¥ï¼Œå¯ä»¥è‡ªå·±ç»´æŒä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œæ¯æ¬¡ä¸‹è½½ä»»åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œå°†åè¿›å…¥çš„ä¸‹è½½ä»»åŠ¡æ’å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—çš„å‰é¢ã€‚</p>

<h6>iOSå¼‚æ­¥ä»»åŠ¡ä¸€èˆ¬æœ‰3ç§å®ç°æ–¹å¼:</h6>

<ul>
<li>NSOperationQueue</li>
<li>GCD</li>
<li>NSThread</li>
</ul>


<p>è¿™å‡ ç§æ–¹å¼å°±ä¸ç»†è¯´äº†ï¼ŒSDWebImageæ˜¯é€šè¿‡è‡ªå®šä¹‰NSOperationæ¥æŠ½è±¡ä¸‹è½½ä»»åŠ¡çš„ï¼Œå¹¶ç»“åˆäº†GCDæ¥åšä¸€äº›ä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹çš„åˆ‡æ¢ã€‚å…·ä½“å¼‚æ­¥ä¸‹è½½çš„å®ç°ï¼ŒAFNetworkingä¸SDWebImageéƒ½æ˜¯ååˆ†ä¼˜ç§€çš„ä»£ç ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æ·±å…¥çœ‹çœ‹æºç ã€‚</p>

<h6>2.2 å…³äºå›¾ç‰‡è§£å‹ç¼©:</h6>

<blockquote><p>é€šç”¨çš„è§£å‹ç¼©æ–¹æ¡ˆ
ä¸»ä½“çš„æ€è·¯æ˜¯åœ¨å­çº¿ç¨‹ï¼Œå°†åŸå§‹çš„å›¾ç‰‡æ¸²æŸ“æˆä¸€å¼ çš„æ–°çš„å¯ä»¥å­—èŠ‚æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œæ¥è·å–ä¸€ä¸ªè§£å‹ç¼©è¿‡çš„å›¾ç‰‡ã€‚
åŸºæœ¬ä¸Šæ¯”è¾ƒæµè¡Œçš„ä¸€äº›å¼€æºåº“éƒ½å…ˆåæ”¯æŒäº†åœ¨å¼‚æ­¥çº¿ç¨‹å®Œæˆå›¾ç‰‡çš„è§£å‹ç¼©ï¼Œå¹¶å¯¹è§£å‹ç¼©è¿‡åçš„å›¾ç‰‡è¿›è¡Œç¼“å­˜ã€‚</p></blockquote>

<p>è¿™ä¹ˆåšçš„ä¼˜ç‚¹æ˜¯åœ¨setImageçš„æ—¶å€™ç³»ç»Ÿçœå»äº†ä¸Šé¢çš„ç¬¬6æ­¥ï¼Œç¼ºç‚¹å°±æ˜¯å›¾ç‰‡å ç”¨çš„ç©ºé—´å˜å¤§ã€‚
æ¯”å¦‚1å¼ 50<em>50åƒç´ çš„å›¾ç‰‡ï¼Œåœ¨retinaçš„å±å¹•ä¸‹æ‰€å ç”¨çš„ç©ºé—´ä¸º100</em>100*4 ~ 40KB</p>

<p>ä¸‹é¢çš„ä»£ç æ˜¯SDWebImageçš„è§£å†³æ–¹æ¡ˆ:</p>

<pre><code>+ (UIImage *)decodedImageWithImage:(UIImage *)image {
    if (image.images) {
        // Do not decode animated images
        return image;
    }

    CGImageRef imageRef = image.CGImage;
    CGSize imageSize = CGSizeMake(CGImageGetWidth(imageRef), CGImageGetHeight(imageRef));
    CGRect imageRect = (CGRect){.origin = CGPointZero, .size = imageSize};

    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
    CGBitmapInfo bitmapInfo = CGImageGetBitmapInfo(imageRef);

    int infoMask = (bitmapInfo &amp; kCGBitmapAlphaInfoMask);
    BOOL anyNonAlpha = (infoMask == kCGImageAlphaNone ||
            infoMask == kCGImageAlphaNoneSkipFirst ||
            infoMask == kCGImageAlphaNoneSkipLast);

    // CGBitmapContextCreate doesn't support kCGImageAlphaNone with RGB.
    // https://developer.apple.com/library/mac/#qa/qa1037/_index.html
    if (infoMask == kCGImageAlphaNone &amp;&amp; CGColorSpaceGetNumberOfComponents(colorSpace) &gt; 1) {
        // Unset the old alpha info.
        bitmapInfo &amp;= ~kCGBitmapAlphaInfoMask;

        // Set noneSkipFirst.
        bitmapInfo |= kCGImageAlphaNoneSkipFirst;
    }
            // Some PNGs tell us they have alpha but only 3 components. Odd.
    else if (!anyNonAlpha &amp;&amp; CGColorSpaceGetNumberOfComponents(colorSpace) == 3) {
        // Unset the old alpha info.
        bitmapInfo &amp;= ~kCGBitmapAlphaInfoMask;
        bitmapInfo |= kCGImageAlphaPremultipliedFirst;
    }

    // It calculates the bytes-per-row based on the bitsPerComponent and width arguments.
    CGContextRef context = CGBitmapContextCreate(NULL,
            imageSize.width,
            imageSize.height,
            CGImageGetBitsPerComponent(imageRef),
            0,
            colorSpace,
            bitmapInfo);
    CGColorSpaceRelease(colorSpace);

    // If failed, return undecompressed image
    if (!context) return image;

    CGContextDrawImage(context, imageRect, imageRef);
    CGImageRef decompressedImageRef = CGBitmapContextCreateImage(context);

    CGContextRelease(context);

    UIImage *decompressedImage = [UIImage imageWithCGImage:decompressedImageRef scale:image.scale orientation:image.imageOrientation];
    CGImageRelease(decompressedImageRef);
    return decompressedImage;
}
</code></pre>

<h6>2.3 å…³äºå­—èŠ‚å¯¹é½</h6>

<p>SDWebImageä¸AFNetworkingéƒ½æ²¡æœ‰å¯¹ç¬¬7ç‚¹åšä¼˜åŒ–ï¼ŒFastImageCacheç›¸å¯¹ä¸å…¶ä»–çš„å¼€æºåº“ï¼Œåˆ™å¯¹ç¬¬5ç‚¹ä¸ç¬¬7ç‚¹åšäº†ä¼˜åŒ–ã€‚è¿™é‡Œæˆ‘ä»¬è°ˆè°ˆç¬¬ä¸ƒç‚¹ï¼Œå…³äºå›¾ç‰‡æ•°æ®çš„å­—èŠ‚å¯¹é½ã€‚</p>

<blockquote><p>Core Animationåœ¨æŸäº›æƒ…å†µä¸‹æ¸²æŸ“å‰ä¼šå…ˆæ‹·è´ä¸€ä»½å›¾åƒæ•°æ®ï¼Œé€šå¸¸æ˜¯åœ¨å›¾åƒæ•°æ®éå­—èŠ‚å¯¹é½çš„æƒ…å†µä¸‹ä¼šè¿›è¡Œæ‹·è´å¤„ç†ï¼Œå®˜æ–¹æ–‡æ¡£æ²¡æœ‰å¯¹è¿™æ¬¡æ‹·è´è¡Œä¸ºä½œè¯´æ˜ï¼Œæ¨¡æ‹Ÿå™¨å’ŒInstrumenté‡Œæœ‰é«˜äº®æ˜¾ç¤ºâ€œcopied imagesâ€çš„åŠŸèƒ½ï¼Œä½†ä¼¼ä¹å®ƒæœ‰bugï¼Œå³ä½¿æŸå¼ å›¾ç‰‡æ²¡æœ‰è¢«é«˜äº®æ˜¾ç¤ºå‡ºæ¸²æŸ“æ—¶è¢«copyï¼Œä»è°ƒç”¨å †æ ˆä¸Šä¹Ÿè¿˜æ˜¯èƒ½çœ‹åˆ°è°ƒç”¨äº†CA::Render::copy_imageæ–¹æ³•ï¼š</p>

<p>é‚£ä»€ä¹ˆæ˜¯å­—èŠ‚å¯¹é½å‘¢ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œä¸ºäº†æ€§èƒ½ï¼Œåº•å±‚æ¸²æŸ“å›¾åƒæ—¶ä¸æ˜¯ä¸€ä¸ªåƒç´ ä¸€ä¸ªåƒç´ æ¸²æŸ“ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—æ¸²æŸ“ï¼Œæ•°æ®æ˜¯ä¸€å—å—åœ°å–ï¼Œå°±å¯èƒ½é‡åˆ°è¿™ä¸€å—è¿ç»­çš„å†…å­˜æ•°æ®é‡Œç»“å°¾çš„æ•°æ®ä¸æ˜¯å›¾åƒçš„å†…å®¹ï¼Œæ˜¯å†…å­˜é‡Œå…¶ä»–çš„æ•°æ®ï¼Œå¯èƒ½è¶Šç•Œè¯»å–å¯¼è‡´ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿æ··å…¥ï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“ä¹‹å‰CoreAnimationè¦æŠŠæ•°æ®æ‹·è´ä¸€ä»½è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿æ¯ä¸€å—éƒ½æ˜¯å›¾åƒæ•°æ®ï¼Œå¯¹äºä¸è¶³ä¸€å—çš„æ•°æ®ç½®ç©ºã€‚å¤§è‡´å›¾ç¤ºï¼š(pixelæ˜¯å›¾åƒåƒç´ æ•°æ®ï¼Œdataæ˜¯å†…å­˜é‡Œå…¶ä»–æ•°æ®)</p></blockquote>

<hr />

<blockquote><p>å—çš„å¤§å°åº”è¯¥æ˜¯è·ŸCPU cache lineæœ‰å…³ï¼ŒARMv7æ˜¯32byteï¼ŒA9æ˜¯64byteï¼Œåœ¨A9ä¸‹CoreAnimationåº”è¯¥æ˜¯æŒ‰64byteä½œä¸ºä¸€å—æ•°æ®å»è¯»å–å’Œæ¸²æŸ“ï¼Œè®©å›¾åƒæ•°æ®å¯¹é½64byteå°±å¯ä»¥é¿å…CoreAnimationå†æ‹·è´ä¸€ä»½æ•°æ®è¿›è¡Œä¿®è¡¥ã€‚FastImageCacheåšçš„å­—èŠ‚å¯¹é½å°±æ˜¯è¿™ä¸ªäº‹æƒ…ã€‚</p></blockquote>

<hr />

<p><img src="/images/tupianyouhua001.png" title="Caption" ></p>

<p>ä»ä»£ç ä¸Šæ¥çœ‹ï¼Œä¸»è¦æ˜¯åœ¨åˆ›å»ºä¸Šå›¾è§£ç çš„è¿‡ç¨‹ä¸­ï¼ŒCGBitmapContextCreateå‡½æ•°çš„bytesPerRowå‚æ•°å¿…é¡»ä¼ 64çš„å€æ•°ã€‚</p>

<p>æ¯”è¾ƒå„ä¸ªå¼€æºæ¡†æ¶çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°SDWebImageä¸AFNetworkingçš„è¯¥å‚æ•°éƒ½ä¼ çš„æ˜¯0ï¼Œå³è®©ç³»ç»Ÿè‡ªåŠ¨æ¥è®¡ç®—è¯¥å€¼ï¼ˆé‚£ä¸ºä½•ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—çš„æ—¶å€™ä¸è®©å›¾ç‰‡æ•°æ®å­—èŠ‚å°±å­—èŠ‚å¯¹é½å‘¢ï¼Ÿï¼‰ã€‚</p>

<h6>2.4 å…³äºç¬¬3ï¼Œ4ç‚¹ï¼Œå†…å­˜çº§åˆ«æ‹·è´</h6>

<p>ä»¥ä¸Š3ä¸ªå¼€æºåº“ä¸­ï¼ŒFastImageCacheå¯¹è¿™ä¸€ç‚¹åšäº†å¾ˆå¤§çš„ä¼˜åŒ–ï¼Œå…¶ä»–çš„2ä¸ªå¼€æºåº“åˆ™æœªå…³æ³¨è¿™ä¸€ç‚¹ã€‚è¿™ä¸€å—æœ¨æœ‰æ·±å…¥ç ”ç©¶ï¼Œå°±å¼•ç”¨ä¸€ä¸‹FastImageCacheå›¢é˜Ÿå¯¹è¯¥ç‚¹çš„ä¸€äº›è¯´æ˜ã€‚æœ‰èƒ½åŠ›çš„å¯ä»¥å»çœ‹çœ‹åŸæ–‡ç« (è‹±æ–‡):hereã€‚</p>

<blockquote><p>å†…å­˜æ˜ å°„
å¹³å¸¸æˆ‘ä»¬è¯»å–ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸Šå±‚APIè°ƒç”¨åˆ°æœ€åä¼šä½¿ç”¨ç³»ç»Ÿæ–¹æ³•read()è¯»å–æ•°æ®ï¼Œå†…æ ¸æŠŠç£ç›˜æ•°æ®è¯»å…¥å†…æ ¸ç¼“å†²åŒºï¼Œç”¨æˆ·å†ä»å†…æ ¸ç¼“å†²åŒºè¯»å–æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´ï¼Œè¿™é‡Œæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´çš„æ—¶é—´æ¶ˆè€—ï¼Œå¹¶ä¸”è¯»å–åæ•´ä¸ªæ–‡ä»¶æ•°æ®å°±å·²ç»å­˜åœ¨äºç”¨æˆ·å†…å­˜ä¸­ï¼Œå ç”¨äº†è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚
FastImageCacheé‡‡ç”¨äº†å¦ä¸€ç§è¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œå°±æ˜¯ç”¨mmapæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´é‡Œçš„è™šæ‹Ÿå†…å­˜ï¼Œæ–‡ä»¶ä¸­çš„ä½ç½®åœ¨è™šæ‹Ÿå†…å­˜ä¸­æœ‰äº†å¯¹åº”çš„åœ°å€ï¼Œå¯ä»¥åƒæ“ä½œå†…å­˜ä¸€æ ·æ“ä½œè¿™ä¸ªæ–‡ä»¶ï¼Œç›¸å½“äºå·²ç»æŠŠæ•´ä¸ªæ–‡ä»¶æ”¾å…¥å†…å­˜ï¼Œä½†åœ¨çœŸæ­£ä½¿ç”¨åˆ°è¿™äº›æ•°æ®å‰å´ä¸ä¼šæ¶ˆè€—ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸ä¼šæœ‰è¯»å†™ç£ç›˜çš„æ“ä½œï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨è¿™äº›æ•°æ®æ—¶ï¼Œä¹Ÿå°±æ˜¯å›¾åƒå‡†å¤‡æ¸²æŸ“åœ¨å±å¹•ä¸Šæ—¶ï¼Œè™šæ‹Ÿå†…å­˜ç®¡ç†ç³»ç»ŸVMSæ‰æ ¹æ®ç¼ºé¡µåŠ è½½çš„æœºåˆ¶ä»ç£ç›˜åŠ è½½å¯¹åº”çš„æ•°æ®å—åˆ°ç‰©ç†å†…å­˜ï¼Œå†è¿›è¡Œæ¸²æŸ“ã€‚è¿™æ ·çš„æ–‡ä»¶è¯»å†™æ–‡ä»¶æ–¹å¼å°‘äº†æ•°æ®ä»å†…æ ¸ç¼“å­˜åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚</p></blockquote>

<h6>2.5 å…³äºç¬¬äºŒæ­¥å›¾ç‰‡å¤„ç†ï¼ˆè£å‰ªï¼Œè¾¹æ¡†ç­‰ï¼‰</h6>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡æˆ‘ä»¬å¯èƒ½æƒ³è¦åšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚è¯´åšä¸€äº›ç¼©æ”¾ï¼Œè£å‰ªï¼Œæˆ–è€…æ·»åŠ åœ†è§’ç­‰ç­‰ã€‚</p>

<p>å¯¹äºæ¯”è¾ƒé€šç”¨çš„ç¼©æ”¾ï¼Œæˆ–è€…åœ†è§’ç­‰åŠŸèƒ½ï¼Œå¯ä»¥é›†æˆåˆ°æ§ä»¶æœ¬èº«ã€‚ä¸è¿‡ï¼Œæä¾›ä¸€ä¸ªæ¥å£å‡ºæ¥ï¼Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿæœ‰æœºä¼šå¯¹ä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡åšä¸€äº›å…¶ä»–çš„ç‰¹æ®Šå¤„ç†æ˜¯æœ‰å¿…è¦çš„ã€‚</p>

<pre><code>/** SDWebImage
 * Allows to transform the image immediately after it has been downloaded and just before to cache it on disk and memory.
 * NOTE: This method is called from a global queue in order to not to block the main thread.
 *
 * @param imageManager The current `SDWebImageManager`
 * @param image        The image to transform
 * @param imageURL     The url of the image to transform
 *
 * @return The transformed image object.
 */
- (UIImage *)imageManager:(SDWebImageManager *)imageManager transformDownloadedImage:(UIImage *)image withURL:(NSURL *)imageURL;
</code></pre>

<h6>2.6 å…¶ä»–ï¼ˆè¯¸å¦‚å›¾ç‰‡é¢„ä¸‹è½½ï¼Œgifæ”¯æŒç­‰ç­‰,ä¸‹è½½è¿›åº¦æ¡ï¼‰</h6>

<p>å¾…è¡¥å……</p>

<h3>3. å¸¸ç”¨çš„å¼€æºåº“å¯¹æ¯”</h3>

<table>
<thead>
<tr>
<th>tip    </th>
<th style="text-align:center;">SDWebImage </th>
<th style="text-align:right;">AFNetworking   </th>
<th>FastImageCache</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¼‚æ­¥ä¸‹è½½å›¾ç‰‡</td>
<td style="text-align:center;">    YES</td>
<td style="text-align:right;">    YES</td>
<td>    NO</td>
</tr>
<tr>
<td>å­çº¿ç¨‹è§£å‹ç¼©</td>
<td style="text-align:center;">    YES </td>
<td style="text-align:right;">YES    </td>
<td>YES</td>
</tr>
<tr>
<td>å­çº¿ç¨‹å›¾ç‰‡å¤„ç†(ç¼©æ”¾ï¼Œåœ†è§’ç­‰)  </td>
<td style="text-align:center;">YES</td>
<td style="text-align:right;">   YES</td>
<td>    YES</td>
</tr>
<tr>
<td>å­˜å‚¨è§£å‹ç¼©åçš„ä½å›¾    </td>
<td style="text-align:center;">YES</td>
<td style="text-align:right;">   YES</td>
<td>    YES</td>
</tr>
<tr>
<td>å†…å­˜çº§åˆ«ç¼“å­˜ </td>
<td style="text-align:center;">YES</td>
<td style="text-align:right;">   YES </td>
<td>YES</td>
</tr>
<tr>
<td>ç£ç›˜çº§åˆ«ç¼“å­˜ </td>
<td style="text-align:center;">YES    </td>
<td style="text-align:right;">YES</td>
<td>   YES</td>
</tr>
<tr>
<td>UIImageView category</td>
<td style="text-align:center;">  YES </td>
<td style="text-align:right;">NO </td>
<td>NO</td>
</tr>
<tr>
<td>å‡å°‘å†…å­˜çº§åˆ«çš„æ‹·è´    </td>
<td style="text-align:center;">NO </td>
<td style="text-align:right;">NO</td>
<td>    YES</td>
</tr>
<tr>
<td>æ¥å£æ˜“ç”¨æ€§    </td>
<td style="text-align:center;">***</td>
<td style="text-align:right;">   *** </td>
<td>*</td>
</tr>
</tbody>
</table>

</div>
  
  




| <a href="/blog/2015/12/05/tu-pian-jia-zai-you-hua-shen-jiu/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/05/zhan-zai-afnshang-kan-asi/">ç«™åœ¨AFNä¸Šçœ‹ASI</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><h6>ä¸€ã€åº•å±‚å®ç°</h6>

<ul>
<li><p>1> AFNçš„åº•å±‚åŸºäºOCçš„NSURLConnectionå’ŒNSURLSession</p></li>
<li><p>2> ASIçš„åº•å±‚åŸºäºçº¯Cè¯­è¨€çš„CFNetworkæ¡†æ¶</p></li>
<li><p>3> ASIçš„è¿è¡Œæ€§èƒ½ é«˜äº AFN</p></li>
</ul>


<h6>äºŒã€å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®å¤„ç†</h6>

<ul>
<li><p>1> ASIæ²¡æœ‰ç›´æ¥æä¾›å¯¹æœåŠ¡å™¨æ•°æ®å¤„ç†çš„æ–¹å¼ï¼Œç›´æ¥è¿”å›data\string</p></li>
<li><p>2> AFNæä¾›äº†å¤šç§å¯¹æœåŠ¡å™¨æ•°æ®å¤„ç†çš„æ–¹å¼</p>

<ul>
<li><p>JSONå¤„ç†</p></li>
<li><p>XMLå¤„ç†</p></li>
<li><p>å…¶ä»–å¤„ç†</p></li>
</ul>
</li>
</ul>


<h6>ä¸‰ã€ç›‘å¬è¯·æ±‚çš„è¿‡ç¨‹</h6>

<ul>
<li><p>1> AFNæä¾›äº†successå’Œfailureä¸¤ä¸ªblockæ¥ç›‘å¬è¯·æ±‚çš„è¿‡ç¨‹ï¼ˆåªèƒ½ç›‘å¬æˆåŠŸå’Œå¤±è´¥ï¼‰</p>

<ul>
<li><p>success : è¯·æ±‚æˆåŠŸåè°ƒç”¨</p></li>
<li><p>failure : è¯·æ±‚å¤±è´¥åè°ƒç”¨</p></li>
</ul>
</li>
<li><p>2> ASIæä¾›äº†3å¥—æ–¹æ¡ˆï¼Œæ¯ä¸€å¥—æ–¹æ¡ˆéƒ½èƒ½ç›‘å¬è¯·æ±‚çš„å®Œæ•´è¿‡ç¨‹</p></li>
</ul>


<p>ï¼ˆç›‘å¬è¯·æ±‚å¼€å§‹ã€æ¥æ”¶åˆ°å“åº”å¤´ä¿¡æ¯ã€æ¥å—åˆ°å…·ä½“æ•°æ®ã€æ¥å—å®Œæ¯•ã€è¯·æ±‚å¤±è´¥ï¼‰</p>

<pre><code>* æˆä¸ºä»£ç†ï¼Œéµå®ˆåè®®ï¼Œå®ç°åè®®ä¸­çš„ä»£ç†æ–¹æ³•

* æˆä¸ºä»£ç†ï¼Œä¸éµå®ˆåè®®ï¼Œè‡ªå®šä¹‰ä»£ç†æ–¹æ³•

* è®¾ç½®block
</code></pre>

<h6>å››ã€åœ¨æ–‡ä»¶ä¸‹è½½å’Œæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨éš¾æ˜“åº¦</h6>

<ul>
<li><p>1> AFN</p>

<ul>
<li><p>ä¸å®¹æ˜“ç›‘å¬ä¸‹è½½è¿›åº¦å’Œä¸Šä¼ è¿›åº¦</p></li>
<li><p>ä¸å®¹æ˜“å®ç°æ–­ç‚¹ç»­ä¼ </p></li>
<li><p>ä¸€èˆ¬åªç”¨æ¥ä¸‹è½½ä¸å¤§çš„æ–‡ä»¶</p></li>
</ul>
</li>
<li><p>2> ASI</p>

<ul>
<li><p>éå¸¸å®¹æ˜“å®ç°ä¸‹è½½å’Œä¸Šä¼ </p></li>
<li><p>éå¸¸å®¹æ˜“ç›‘å¬ä¸‹è½½è¿›åº¦å’Œä¸Šä¼ è¿›åº¦</p></li>
<li><p>éå¸¸å®¹æ˜“å®ç°æ–­ç‚¹ç»­ä¼ </p></li>
<li><p>ä¸‹è½½æˆ–å¤§æˆ–å°çš„æ–‡ä»¶éƒ½è¡Œ</p></li>
</ul>
</li>
</ul>


<h6>äº”ã€ASIæä¾›äº†æ›´å¤šçš„å®ç”¨åŠŸèƒ½</h6>

<ul>
<li><p>1> æ§åˆ¶åœˆåœˆè¦ä¸è¦åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­è½¬</p></li>
<li><p>2> å¯ä»¥è½»æ¾åœ°è®¾ç½®è¯·æ±‚ä¹‹é—´çš„ä¾èµ–ï¼šæ¯ä¸€ä¸ªè¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªNSOperationå¯¹è±¡</p></li>
<li><p>3> å¯ä»¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è¯·æ±‚ï¼ˆè¿˜ä¸“é—¨æä¾›äº†ä¸€ä¸ªå«åšASINetworkQueueæ¥ç®¡ç†æ‰€æœ‰çš„è¯·æ±‚å¯¹è±¡ï¼‰</p>

<ul>
<li><p>æš‚åœ\æ¢å¤\å–æ¶ˆæ‰€æœ‰çš„è¯·æ±‚</p></li>
<li><p>ç›‘å¬æ•´ä¸ªé˜Ÿåˆ—ä¸­æ‰€æœ‰è¯·æ±‚çš„ä¸‹è½½è¿›åº¦å’Œä¸Šä¼ è¿›åº¦</p></li>
</ul>
</li>
</ul>

</div>
  
  




| <a href="/blog/2015/12/05/zhan-zai-afnshang-kan-asi/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/04/appqia-dun-liao-zen-yao-ban-%3F/">Appå¡é¡¿äº†æ€ä¹ˆåŠï¼Ÿ</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/kadun001.jpg" title="Caption" ></p>

<p>åœ¨ VSync ä¿¡å·åˆ°æ¥åï¼Œç³»ç»Ÿå›¾å½¢æœåŠ¡ä¼šé€šè¿‡ CADisplayLink ç­‰æœºåˆ¶é€šçŸ¥ Appï¼ŒApp ä¸»çº¿ç¨‹å¼€å§‹åœ¨ CPU ä¸­è®¡ç®—æ˜¾ç¤ºå†…å®¹ï¼Œæ¯”å¦‚è§†å›¾çš„åˆ›å»ºã€å¸ƒå±€è®¡ç®—ã€å›¾ç‰‡è§£ç ã€æ–‡æœ¬ç»˜åˆ¶ç­‰ã€‚</p>

<p>éšå CPU ä¼šå°†è®¡ç®—å¥½çš„å†…å®¹æäº¤åˆ° GPU å»ï¼Œç”± GPU è¿›è¡Œå˜æ¢ã€åˆæˆã€æ¸²æŸ“ã€‚éšå GPU ä¼šæŠŠæ¸²æŸ“ç»“æœæäº¤åˆ°å¸§ç¼“å†²åŒºå»ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ VSync ä¿¡å·åˆ°æ¥æ—¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p>

<p>ç”±äºå‚ç›´åŒæ­¥çš„æœºåˆ¶ï¼Œå¦‚æœåœ¨ä¸€ä¸ª VSync æ—¶é—´å†…ï¼ŒCPU æˆ–è€… GPU æ²¡æœ‰å®Œæˆå†…å®¹æäº¤ï¼Œåˆ™é‚£ä¸€å¸§å°±ä¼šè¢«ä¸¢å¼ƒï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æœºä¼šå†æ˜¾ç¤ºï¼Œè€Œè¿™æ—¶æ˜¾ç¤ºå±ä¼šä¿ç•™ä¹‹å‰çš„å†…å®¹ä¸å˜ã€‚è¿™å°±æ˜¯ç•Œé¢å¡é¡¿çš„åŸå› ã€‚</p>

<p>ä»ä¸Šé¢çš„å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒCPU å’Œ GPU ä¸è®ºå“ªä¸ªé˜»ç¢äº†æ˜¾ç¤ºæµç¨‹ï¼Œéƒ½ä¼šé€ æˆæ‰å¸§ç°è±¡ã€‚æ‰€ä»¥å¼€å‘æ—¶ï¼Œä¹Ÿéœ€è¦åˆ†åˆ«å¯¹ CPU å’Œ GPU å‹åŠ›è¿›è¡Œè¯„ä¼°å’Œä¼˜åŒ–ã€‚</p>

<h2>CPU èµ„æºæ¶ˆè€—åŸå› å’Œè§£å†³æ–¹æ¡ˆ</h2>

<h4>å¯¹è±¡åˆ›å»º</h4>

<p>å¯¹è±¡çš„åˆ›å»ºä¼šåˆ†é…å†…å­˜ã€è°ƒæ•´å±æ€§ã€ç”šè‡³è¿˜æœ‰è¯»å–æ–‡ä»¶ç­‰æ“ä½œï¼Œæ¯”è¾ƒæ¶ˆè€— CPU èµ„æºã€‚</p>

<p>å°½é‡ç”¨è½»é‡çš„å¯¹è±¡ä»£æ›¿é‡é‡çš„å¯¹è±¡ï¼Œå¯ä»¥å¯¹æ€§èƒ½æœ‰æ‰€ä¼˜åŒ–ã€‚</p>

<p>æ¯”å¦‚ CALayer æ¯” UIView è¦è½»é‡è®¸å¤šï¼Œé‚£ä¹ˆä¸éœ€è¦å“åº”è§¦æ‘¸äº‹ä»¶çš„æ§ä»¶ï¼Œç”¨ CALayer æ˜¾ç¤ºä¼šæ›´åŠ åˆé€‚ã€‚å¦‚æœå¯¹è±¡ä¸æ¶‰åŠ UI æ“ä½œï¼Œåˆ™å°½é‡æ”¾åˆ°åå°çº¿ç¨‹å»åˆ›å»ºï¼Œä½†å¯æƒœçš„æ˜¯åŒ…å«æœ‰ CALayer çš„æ§ä»¶ï¼Œéƒ½åªèƒ½åœ¨ä¸»çº¿ç¨‹åˆ›å»ºå’Œæ“ä½œã€‚é€šè¿‡ Storyboard åˆ›å»ºè§†å›¾å¯¹è±¡æ—¶ï¼Œå…¶èµ„æºæ¶ˆè€—ä¼šæ¯”ç›´æ¥é€šè¿‡ä»£ç åˆ›å»ºå¯¹è±¡è¦å¤§éå¸¸å¤šï¼Œåœ¨æ€§èƒ½æ•æ„Ÿçš„ç•Œé¢é‡Œï¼ŒStoryboard å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æŠ€æœ¯é€‰æ‹©ã€‚</p>

<p>å°½é‡æ¨è¿Ÿå¯¹è±¡åˆ›å»ºçš„æ—¶é—´ï¼Œå¹¶æŠŠå¯¹è±¡çš„åˆ›å»ºåˆ†æ•£åˆ°å¤šä¸ªä»»åŠ¡ä¸­å»ã€‚å°½ç®¡è¿™å®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¹¶ä¸”å¸¦æ¥çš„ä¼˜åŠ¿å¹¶ä¸å¤šï¼Œä½†å¦‚æœæœ‰èƒ½åŠ›åšï¼Œè¿˜æ˜¯è¦å°½é‡å°è¯•ä¸€ä¸‹ã€‚å¦‚æœå¯¹è±¡å¯ä»¥å¤ç”¨ï¼Œå¹¶ä¸”å¤ç”¨çš„ä»£ä»·æ¯”é‡Šæ”¾ã€åˆ›å»ºæ–°å¯¹è±¡è¦å°ï¼Œé‚£ä¹ˆè¿™ç±»å¯¹è±¡åº”å½“å°½é‡æ”¾åˆ°ä¸€ä¸ªç¼“å­˜æ± é‡Œå¤ç”¨ã€‚</p>

<h4>å¯¹è±¡è°ƒæ•´</h4>

<p>å¯¹è±¡çš„è°ƒæ•´ä¹Ÿç»å¸¸æ˜¯æ¶ˆè€— CPU èµ„æºçš„åœ°æ–¹ã€‚</p>

<p>è¿™é‡Œç‰¹åˆ«è¯´ä¸€ä¸‹ CALayerï¼š</p>

<ul>
<li><p>CALayer å†…éƒ¨å¹¶æ²¡æœ‰å±æ€§ï¼Œå½“è°ƒç”¨å±æ€§æ–¹æ³•æ—¶ï¼Œå®ƒå†…éƒ¨æ˜¯é€šè¿‡è¿è¡Œæ—¶ resolveInstanceMethod ä¸ºå¯¹è±¡ä¸´æ—¶æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æŠŠå¯¹åº”å±æ€§å€¼ä¿å­˜åˆ°å†…éƒ¨çš„ä¸€ä¸ª Dictionary é‡Œï¼ŒåŒæ—¶è¿˜ä¼šé€šçŸ¥ delegateã€åˆ›å»ºåŠ¨ç”»ç­‰ç­‰ï¼Œéå¸¸æ¶ˆè€—èµ„æºã€‚</p></li>
<li><p>UIView çš„å…³äºæ˜¾ç¤ºç›¸å…³çš„å±æ€§ï¼ˆæ¯”å¦‚ frame/bounds/transformï¼‰ç­‰å®é™…ä¸Šéƒ½æ˜¯ CALayer å±æ€§æ˜ å°„æ¥çš„ï¼Œæ‰€ä»¥å¯¹ UIView çš„è¿™äº›å±æ€§è¿›è¡Œè°ƒæ•´æ—¶ï¼Œæ¶ˆè€—çš„èµ„æºè¦è¿œå¤§äºä¸€èˆ¬çš„å±æ€§ã€‚å¯¹æ­¤ä½ åœ¨åº”ç”¨ä¸­ï¼Œåº”è¯¥å°½é‡å‡å°‘ä¸å¿…è¦çš„å±æ€§ä¿®æ”¹ã€‚</p></li>
</ul>


<p>å½“è§†å›¾å±‚æ¬¡è°ƒæ•´æ—¶ï¼ŒUIViewã€CALayer ä¹‹é—´ä¼šå‡ºç°å¾ˆå¤šæ–¹æ³•è°ƒç”¨ä¸é€šçŸ¥ï¼Œæ‰€ä»¥åœ¨ä¼˜åŒ–æ€§èƒ½æ—¶ï¼Œåº”è¯¥å°½é‡é¿å…è°ƒæ•´è§†å›¾å±‚æ¬¡ã€æ·»åŠ å’Œç§»é™¤è§†å›¾ã€‚</p>

<h4>å¯¹è±¡é”€æ¯</h4>

<p>å¯¹è±¡çš„é”€æ¯è™½ç„¶æ¶ˆè€—èµ„æºä¸å¤šï¼Œä½†ç´¯ç§¯èµ·æ¥ä¹Ÿæ˜¯ä¸å®¹å¿½è§†çš„ã€‚é€šå¸¸å½“å®¹å™¨ç±»æŒæœ‰å¤§é‡å¯¹è±¡æ—¶ï¼Œå…¶é”€æ¯æ—¶çš„èµ„æºæ¶ˆè€—å°±éå¸¸æ˜æ˜¾ã€‚åŒæ ·çš„ï¼Œå¦‚æœå¯¹è±¡å¯ä»¥æ”¾åˆ°åå°çº¿ç¨‹å»é‡Šæ”¾ï¼Œé‚£å°±æŒªåˆ°åå°çº¿ç¨‹å»ã€‚è¿™é‡Œæœ‰ä¸ªå° Tipï¼šæŠŠå¯¹è±¡æ•è·åˆ° block ä¸­ï¼Œç„¶åæ‰”åˆ°åå°é˜Ÿåˆ—å»éšä¾¿å‘é€ä¸ªæ¶ˆæ¯ä»¥é¿å…ç¼–è¯‘å™¨è­¦å‘Šï¼Œå°±å¯ä»¥è®©å¯¹è±¡åœ¨åå°çº¿ç¨‹é”€æ¯äº†ã€‚</p>

<pre><code>NSArray *tmp = self.array;

self.array = nil;

dispatch_async(queue, ^{

    [tmp class];

});
</code></pre>

<h4>å¸ƒå±€è®¡ç®—</h4>

<p>è§†å›¾å¸ƒå±€çš„è®¡ç®—æ˜¯ App ä¸­æœ€ä¸ºå¸¸è§çš„æ¶ˆè€— CPU èµ„æºçš„åœ°æ–¹ã€‚å¦‚æœèƒ½åœ¨åå°çº¿ç¨‹æå‰è®¡ç®—å¥½è§†å›¾å¸ƒå±€ã€å¹¶ä¸”å¯¹è§†å›¾å¸ƒå±€è¿›è¡Œç¼“å­˜ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°æ–¹åŸºæœ¬å°±ä¸ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜äº†ã€‚</p>

<p>ä¸è®ºé€šè¿‡ä½•ç§æŠ€æœ¯å¯¹è§†å›¾è¿›è¡Œå¸ƒå±€ï¼Œå…¶æœ€ç»ˆéƒ½ä¼šè½åˆ°å¯¹ UIView.frame/bounds/center ç­‰å±æ€§çš„è°ƒæ•´ä¸Šã€‚ä¸Šé¢ä¹Ÿè¯´è¿‡ï¼Œå¯¹è¿™äº›å±æ€§çš„è°ƒæ•´éå¸¸æ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥å°½é‡æå‰è®¡ç®—å¥½å¸ƒå±€ï¼Œåœ¨éœ€è¦æ—¶ä¸€æ¬¡æ€§è°ƒæ•´å¥½å¯¹åº”å±æ€§ï¼Œè€Œä¸è¦å¤šæ¬¡ã€é¢‘ç¹çš„è®¡ç®—å’Œè°ƒæ•´è¿™äº›å±æ€§ã€‚</p>

<h4>Autolayout</h4>

<ul>
<li>Autolayout æ˜¯è‹¹æœæœ¬èº«æå€¡çš„æŠ€æœ¯ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿèƒ½å¾ˆå¥½çš„æå‡å¼€å‘æ•ˆç‡ï¼Œä½†æ˜¯ Autolayout å¯¹äºå¤æ‚è§†å›¾æ¥è¯´å¸¸å¸¸ä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚éšç€è§†å›¾æ•°é‡çš„å¢é•¿ï¼ŒAutolayout å¸¦æ¥çš„ CPU æ¶ˆè€—ä¼šå‘ˆæŒ‡æ•°çº§ä¸Šå‡ã€‚å…·ä½“æ•°æ®å¯ä»¥çœ‹è¿™ä¸ªæ–‡ç« ï¼š<a href="http://pilky.me/36/%E3%80%82">http://pilky.me/36/%E3%80%82</a> å¦‚æœä½ ä¸æƒ³æ‰‹åŠ¨è°ƒæ•´ frame ç­‰å±æ€§ï¼Œä½ å¯ä»¥ç”¨ä¸€äº›å·¥å…·æ–¹æ³•æ›¿ä»£ï¼ˆæ¯”å¦‚å¸¸è§çš„ left/right/top/bottom/width/height å¿«æ·å±æ€§ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨ ComponentKitã€AsyncDisplayKit ç­‰æ¡†æ¶ã€‚</li>
</ul>


<h4>æ–‡æœ¬è®¡ç®—</h4>

<p>å¦‚æœä¸€ä¸ªç•Œé¢ä¸­åŒ…å«å¤§é‡æ–‡æœ¬ï¼ˆæ¯”å¦‚å¾®åšå¾®ä¿¡æœ‹å‹åœˆç­‰ï¼‰ï¼Œæ–‡æœ¬çš„å®½é«˜è®¡ç®—ä¼šå ç”¨å¾ˆå¤§ä¸€éƒ¨åˆ†èµ„æºï¼Œå¹¶ä¸”ä¸å¯é¿å…ã€‚å¦‚æœä½ å¯¹æ–‡æœ¬æ˜¾ç¤ºæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå¯ä»¥å‚è€ƒä¸‹ UILabel å†…éƒ¨çš„å®ç°æ–¹å¼ï¼šç”¨ [NSAttributedString boundingRectWithSize:options:context:] æ¥è®¡ç®—æ–‡æœ¬å®½é«˜ï¼Œç”¨ -[NSAttributedString drawWithRect:options:context:] æ¥ç»˜åˆ¶æ–‡æœ¬ã€‚å°½ç®¡è¿™ä¸¤ä¸ªæ–¹æ³•æ€§èƒ½ä¸é”™ï¼Œä½†ä»æ—§éœ€è¦æ”¾åˆ°åå°çº¿ç¨‹è¿›è¡Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>

<blockquote><p>æ³¨æ„ï¼šå¦‚æœä½ ç”¨ CoreText ç»˜åˆ¶æ–‡æœ¬ï¼Œé‚£å°±å¯ä»¥å…ˆç”Ÿæˆ CoreText æ’ç‰ˆå¯¹è±¡ï¼Œç„¶åè‡ªå·±è®¡ç®—äº†ï¼Œå¹¶ä¸” CoreText å¯¹è±¡è¿˜èƒ½ä¿ç•™ä»¥ä¾›ç¨åç»˜åˆ¶ä½¿ç”¨ã€‚</p></blockquote>

<h4>æ–‡æœ¬æ¸²æŸ“</h4>

<p>å±å¹•ä¸Šèƒ½çœ‹åˆ°çš„æ‰€æœ‰æ–‡æœ¬å†…å®¹æ§ä»¶ï¼ŒåŒ…æ‹¬ UIWebViewï¼Œåœ¨åº•å±‚éƒ½æ˜¯é€šè¿‡ CoreText æ’ç‰ˆã€ç»˜åˆ¶ä¸º Bitmap æ˜¾ç¤ºçš„ã€‚å¸¸è§çš„æ–‡æœ¬æ§ä»¶ ï¼ˆUILabelã€UITextView ç­‰ï¼‰ï¼Œå…¶æ’ç‰ˆå’Œç»˜åˆ¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œçš„ï¼Œå½“æ˜¾ç¤ºå¤§é‡æ–‡æœ¬æ—¶ï¼ŒCPU çš„å‹åŠ›ä¼šéå¸¸å¤§ã€‚å¯¹æ­¤è§£å†³æ–¹æ¡ˆåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯è‡ªå®šä¹‰æ–‡æœ¬æ§ä»¶ï¼Œç”¨ TextKit æˆ–æœ€åº•å±‚çš„ CoreText å¯¹æ–‡æœ¬å¼‚æ­¥ç»˜åˆ¶ã€‚å°½ç®¡è¿™å®ç°èµ·æ¥éå¸¸éº»çƒ¦ï¼Œä½†å…¶å¸¦æ¥çš„ä¼˜åŠ¿ä¹Ÿéå¸¸å¤§ï¼ŒCoreText å¯¹è±¡åˆ›å»ºå¥½åï¼Œèƒ½ç›´æ¥è·å–æ–‡æœ¬çš„å®½é«˜ç­‰ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡è®¡ç®—ï¼ˆè°ƒæ•´ UILabel å¤§å°æ—¶ç®—ä¸€éã€UILabel ç»˜åˆ¶æ—¶å†…éƒ¨å†ç®—ä¸€éï¼‰ï¼›CoreText å¯¹è±¡å ç”¨å†…å­˜è¾ƒå°‘ï¼Œå¯ä»¥ç¼“å­˜ä¸‹æ¥ä»¥å¤‡ç¨åå¤šæ¬¡æ¸²æŸ“ã€‚</p>

<h4>å›¾ç‰‡çš„è§£ç </h4>

<p>å½“ä½ ç”¨ UIImage æˆ– CGImageSource çš„é‚£å‡ ä¸ªæ–¹æ³•åˆ›å»ºå›¾ç‰‡æ—¶ï¼Œå›¾ç‰‡æ•°æ®å¹¶ä¸ä¼šç«‹åˆ»è§£ç ã€‚å›¾ç‰‡è®¾ç½®åˆ° UIImageView æˆ–è€… CALayer.contents ä¸­å»ï¼Œå¹¶ä¸” CALayer è¢«æäº¤åˆ° GPU å‰ï¼ŒCGImage ä¸­çš„æ•°æ®æ‰ä¼šå¾—åˆ°è§£ç ã€‚è¿™ä¸€æ­¥æ˜¯å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹çš„ï¼Œå¹¶ä¸”ä¸å¯é¿å…ã€‚å¦‚æœæƒ³è¦ç»•å¼€è¿™ä¸ªæœºåˆ¶ï¼Œå¸¸è§çš„åšæ³•æ˜¯åœ¨åå°çº¿ç¨‹å…ˆæŠŠå›¾ç‰‡ç»˜åˆ¶åˆ° CGBitmapContext ä¸­ï¼Œç„¶åä» Bitmap ç›´æ¥åˆ›å»ºå›¾ç‰‡ã€‚ç›®å‰å¸¸è§çš„ç½‘ç»œå›¾ç‰‡åº“éƒ½è‡ªå¸¦è¿™ä¸ªåŠŸèƒ½ã€‚</p>

<h4>å›¾åƒçš„ç»˜åˆ¶</h4>

<p>å›¾åƒçš„ç»˜åˆ¶é€šå¸¸æ˜¯æŒ‡ç”¨é‚£äº›ä»¥ CG å¼€å¤´çš„æ–¹æ³•æŠŠå›¾åƒç»˜åˆ¶åˆ°ç”»å¸ƒä¸­ï¼Œç„¶åä»ç”»å¸ƒåˆ›å»ºå›¾ç‰‡å¹¶æ˜¾ç¤ºè¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸ªæœ€å¸¸è§çš„åœ°æ–¹å°±æ˜¯ [UIView drawRect:] é‡Œé¢äº†ã€‚ç”±äº CoreGraphic æ–¹æ³•é€šå¸¸éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å›¾åƒçš„ç»˜åˆ¶å¯ä»¥å¾ˆå®¹æ˜“çš„æ”¾åˆ°åå°çº¿ç¨‹è¿›è¡Œã€‚ä¸€ä¸ªç®€å•å¼‚æ­¥ç»˜åˆ¶çš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼ˆå®é™…æƒ…å†µä¼šæ¯”è¿™ä¸ªå¤æ‚å¾—å¤šï¼Œä½†åŸç†åŸºæœ¬ä¸€è‡´ï¼‰ï¼š</p>

<pre><code>- (void)display {

    dispatch_async(backgroundQueue, ^{

    CGContextRef ctx = CGBitmapContextCreate(...);

    // draw in context...

    CGImageRef img = CGBitmapContextCreateImage(ctx);

    CFRelease(ctx);

    dispatch_async(mainQueue, ^{

        layer.contents = img;

    });

    });
}
</code></pre>

<h2>GPU èµ„æºæ¶ˆè€—åŸå› å’Œè§£å†³æ–¹æ¡ˆ</h2>

<p>ç›¸å¯¹äº CPU æ¥è¯´ï¼ŒGPU èƒ½å¹²çš„äº‹æƒ…æ¯”è¾ƒå•ä¸€ï¼šæ¥æ”¶æäº¤çš„çº¹ç†ï¼ˆTextureï¼‰å’Œé¡¶ç‚¹æè¿°ï¼ˆä¸‰è§’å½¢ï¼‰ï¼Œåº”ç”¨å˜æ¢ï¼ˆtransformï¼‰ã€æ··åˆå¹¶æ¸²æŸ“ï¼Œç„¶åè¾“å‡ºåˆ°å±å¹•ä¸Šã€‚é€šå¸¸ä½ æ‰€èƒ½çœ‹åˆ°çš„å†…å®¹ï¼Œä¸»è¦ä¹Ÿå°±æ˜¯çº¹ç†ï¼ˆå›¾ç‰‡ï¼‰å’Œå½¢çŠ¶ï¼ˆä¸‰è§’æ¨¡æ‹Ÿçš„çŸ¢é‡å›¾å½¢ï¼‰ä¸¤ç±»ã€‚</p>

<h4>çº¹ç†çš„æ¸²æŸ“</h4>

<p>æ‰€æœ‰çš„ Bitmapï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€æ–‡æœ¬ã€æ …æ ¼åŒ–çš„å†…å®¹ï¼Œæœ€ç»ˆéƒ½è¦ç”±å†…å­˜æäº¤åˆ°æ˜¾å­˜ï¼Œç»‘å®šä¸º GPU Textureã€‚ä¸è®ºæ˜¯æäº¤åˆ°æ˜¾å­˜çš„è¿‡ç¨‹ï¼Œè¿˜æ˜¯ GPU è°ƒæ•´å’Œæ¸²æŸ“ Texture çš„è¿‡ç¨‹ï¼Œéƒ½è¦æ¶ˆè€—ä¸å°‘ GPU èµ„æºã€‚å½“åœ¨è¾ƒçŸ­æ—¶é—´æ˜¾ç¤ºå¤§é‡å›¾ç‰‡æ—¶ï¼ˆæ¯”å¦‚ TableView å­˜åœ¨éå¸¸å¤šçš„å›¾ç‰‡å¹¶ä¸”å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼‰ï¼ŒCPU å ç”¨ç‡å¾ˆä½ï¼ŒGPU å ç”¨éå¸¸é«˜ï¼Œç•Œé¢ä»ç„¶ä¼šæ‰å¸§ã€‚é¿å…è¿™ç§æƒ…å†µçš„æ–¹æ³•åªèƒ½æ˜¯å°½é‡å‡å°‘åœ¨çŸ­æ—¶é—´å†…å¤§é‡å›¾ç‰‡çš„æ˜¾ç¤ºï¼Œå°½å¯èƒ½å°†å¤šå¼ å›¾ç‰‡åˆæˆä¸ºä¸€å¼ è¿›è¡Œæ˜¾ç¤ºã€‚</p>

<blockquote><p>æ³¨æ„ï¼šå½“å›¾ç‰‡è¿‡å¤§ï¼Œè¶…è¿‡ GPU çš„æœ€å¤§çº¹ç†å°ºå¯¸æ—¶ï¼Œå›¾ç‰‡éœ€è¦å…ˆç”± CPU è¿›è¡Œé¢„å¤„ç†ï¼Œè¿™å¯¹ CPU å’Œ GPU éƒ½ä¼šå¸¦æ¥é¢å¤–çš„èµ„æºæ¶ˆè€—ã€‚ç›®å‰æ¥è¯´ï¼ŒiPhone 4S ä»¥ä¸Šæœºå‹ï¼Œçº¹ç†å°ºå¯¸ä¸Šé™éƒ½æ˜¯ 4096x4096ï¼Œæ›´è¯¦ç»†çš„èµ„æ–™å¯ä»¥çœ‹è¿™é‡Œï¼šiosres.comã€‚æ‰€ä»¥ï¼Œå°½é‡ä¸è¦è®©å›¾ç‰‡å’Œè§†å›¾çš„å¤§å°è¶…è¿‡è¿™ä¸ªå€¼ã€‚</p></blockquote>

<h4>è§†å›¾çš„æ··åˆ (Composing)</h4>

<p>å½“å¤šä¸ªè§†å›¾ï¼ˆæˆ–è€…è¯´ CALayerï¼‰é‡å åœ¨ä¸€èµ·æ˜¾ç¤ºæ—¶ï¼ŒGPU ä¼šé¦–å…ˆæŠŠä»–ä»¬æ··åˆåˆ°ä¸€èµ·ã€‚å¦‚æœè§†å›¾ç»“æ„è¿‡äºå¤æ‚ï¼Œæ··åˆçš„è¿‡ç¨‹ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤š GPU èµ„æºã€‚ä¸ºäº†å‡è½»è¿™ç§æƒ…å†µçš„ GPU æ¶ˆè€—ï¼Œåº”ç”¨åº”å½“å°½é‡å‡å°‘è§†å›¾æ•°é‡å’Œå±‚æ¬¡ï¼Œå¹¶åœ¨ä¸é€æ˜çš„è§†å›¾é‡Œæ ‡æ˜ opaque å±æ€§ä»¥é¿å…æ— ç”¨çš„ Alpha é€šé“åˆæˆã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¯ä»¥ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼ŒæŠŠå¤šä¸ªè§†å›¾é¢„å…ˆæ¸²æŸ“ä¸ºä¸€å¼ å›¾ç‰‡æ¥æ˜¾ç¤ºã€‚</p>

<h4>å›¾å½¢çš„ç”Ÿæˆ</h4>

<p>CALayer çš„ borderã€åœ†è§’ã€é˜´å½±ã€é®ç½©ï¼ˆmaskï¼‰ï¼ŒCASharpLayer çš„çŸ¢é‡å›¾å½¢æ˜¾ç¤ºï¼Œé€šå¸¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼ˆoffscreen renderingï¼‰ï¼Œè€Œç¦»å±æ¸²æŸ“é€šå¸¸å‘ç”Ÿåœ¨ GPU ä¸­ã€‚å½“ä¸€ä¸ªåˆ—è¡¨è§†å›¾ä¸­å‡ºç°å¤§é‡åœ†è§’çš„ CALayerï¼Œå¹¶ä¸”å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼Œå¯ä»¥è§‚å¯Ÿåˆ° GPU èµ„æºå·²ç»å æ»¡ï¼Œè€Œ CPU èµ„æºæ¶ˆè€—å¾ˆå°‘ã€‚è¿™æ—¶ç•Œé¢ä»ç„¶èƒ½æ­£å¸¸æ»‘åŠ¨ï¼Œä½†å¹³å‡å¸§æ•°ä¼šé™åˆ°å¾ˆä½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥å°è¯•å¼€å¯ CALayer.shouldRasterize å±æ€§ï¼Œä½†è¿™ä¼šæŠŠåŸæœ¬ç¦»å±æ¸²æŸ“çš„æ“ä½œè½¬å«åˆ° CPU ä¸Šå»ã€‚å¯¹äºåªéœ€è¦åœ†è§’çš„æŸäº›åœºåˆï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€å¼ å·²ç»ç»˜åˆ¶å¥½çš„åœ†è§’å›¾ç‰‡è¦†ç›–åˆ°åŸæœ¬è§†å›¾ä¸Šé¢æ¥æ¨¡æ‹Ÿç›¸åŒçš„è§†è§‰æ•ˆæœã€‚æœ€å½»åº•çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯æŠŠéœ€è¦æ˜¾ç¤ºçš„å›¾å½¢åœ¨åå°çº¿ç¨‹ç»˜åˆ¶ä¸ºå›¾ç‰‡ï¼Œé¿å…ä½¿ç”¨åœ†è§’ã€é˜´å½±ã€é®ç½©ç­‰å±æ€§ã€‚</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/04/appqia-dun-liao-zen-yao-ban-%3F/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/12/04/appqia-dun-liao-zen-yao-ban-%3F/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/04/wang-shang-qing-qiu-feng-(feng-)zhuang/">ç½‘ç»œè¯·æ±‚ç–¯ï¼ˆå°ï¼‰è£…</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>ä¸€ç›´æƒ³æ€»ç»“ä¸€ä¸‹å…³äºiOSçš„ç¦»çº¿æ•°æ®ç¼“å­˜çš„æ–¹é¢çš„é—®é¢˜ï¼Œç„¶åæœ€è¿‘ä¹Ÿç®€å•çš„å¯¹AFNè¿›è¡Œäº†å†æ¬¡å°è£…ï¼Œæ‰€æœ‰æƒ³æŠŠè¿™ä¸¤ä¸ªç»“åˆèµ·æ¥å†™ä¸€ä¸‹ã€‚æ•°æ®å±•ç¤ºå‹çš„é¡µé¢åšç¦»çº¿ç¼“å­˜å¯ä»¥æœ‰æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œç”¨æˆ·åœ¨ç¦»çº¿ç¯å¢ƒä¸‹ä»ç„¶å¯ä»¥è·å–ä¸€äº›æ•°æ®ï¼Œè¿™é‡Œçš„æ•°æ®ç¼“å­˜é¦–é€‰è‚¯å®šæ˜¯SQLiteï¼Œè½»é‡çº§ï¼Œå¯¹æ•°æ®çš„å­˜å‚¨è¯»å–ç›¸å¯¹äºå…¶ä»–å‡ ç§æ–¹å¼æœ‰ä¼˜åŠ¿ï¼Œè¿™é‡Œå¯¹AFNçš„å°è£…æ²¡æœ‰æ¶‰åŠå¤ªå¤šä¸šåŠ¡é€»è¾‘å±‚é¢çš„éœ€æ±‚ï¼Œä¸»è¦è¿˜æ˜¯å¯¹ä¸€äº›æ–¹æ³•å†æ¬¡å°è£…æ–¹ä¾¿ä½¿ç”¨ï¼Œè§£é™¤é¡¹ç›®å¯¹ç¬¬ä¸‰æ–¹çš„è€¦åˆæ€§ï¼Œèƒ½å¤Ÿç®€å•çš„å¿«é€Ÿçš„æ›´æ¢åº•å±‚ä½¿ç”¨çš„ç½‘ç»œè¯·æ±‚ä»£ç ã€‚è¿™ç¯‡ä¸»è¦å†™ç¦»çº¿ç¼“å­˜æ€è·¯ï¼Œå¯¹AFNçš„å°è£…åªåšç®€å•çš„ä»‹ç»ã€‚</p>

<p>å…³äºXLNetworkApi</p>

<p>XLNetworkApiçš„ä¸€äº›åŠŸèƒ½å’Œè¯´æ˜ï¼š</p>

<p>ä½¿ç”¨XLNetworkRequeståšä¸€äº›GETã€POSTã€PUTã€DELETEè¯·æ±‚ï¼Œä¸ä¸šåŠ¡é€»è¾‘å¯¹æ¥éƒ¨åˆ†ç›´æ¥ä»¥æ•°ç»„æˆ–è€…å­—å…¸çš„å½¢å¼è¿”å›ã€‚
ä»¥åŠç½‘ç»œä¸‹è½½ã€ä¸Šä¼ æ–‡ä»¶ï¼Œä»¥blockçš„å½¢å¼è¿”å›å®æ—¶çš„ä¸‹è½½ã€ä¸Šä¼ è¿›åº¦ï¼Œä¸Šä¼ æ–‡ä»¶å‚æ•°é€šè¿‡æ¨¡å‹XLFileConfigå»å­˜å–ã€‚
é€šè¿‡ç»§æ‰¿äºXLDataServiceæ¥å°†ä¸€äº›æ•°æ®å¤„ç†ï¼Œæ¨¡å‹è½¬åŒ–å°è£…èµ·æ¥ï¼Œäºä¸šåŠ¡é€»è¾‘å¯¹æ¥è¿”å›çš„æ˜¯å¯¹åº”çš„æ¨¡å‹ï¼Œå‡å°‘Controllorå¤„ç†æ•°æ®å¤„ç†é€»è¾‘çš„å‹åŠ›ã€‚
è‡ªå®šä¹‰ä¸€äº›å›è°ƒçš„block</p>

<pre><code>/**
è¯·æ±‚æˆåŠŸblock
*/
typedef void (^requestSuccessBlock)(id responseObj);
/**
è¯·æ±‚å¤±è´¥block
*/
typedef void (^requestFailureBlock) (NSError *error);
/**
è¯·æ±‚å“åº”block
*/
typedef void (^responseBlock)(id dataObj, NSError *error);
/**
ç›‘å¬è¿›åº¦å“åº”block
*/
typedef void (^progressBlock)(int64_t bytesWritten, int64_t totalBytesWritten, int64_t totalBytesExpectedToWrite);
XLNetworkRequest.méƒ¨åˆ†å®ç°
#import "XLNetworkRequest.h"
#import "AFNetworking.h"
@implementation XLNetworkRequest
+ (void)getRequest:(NSString *)url params:(NSDictionary *)params success:(requestSuccessBlock)successHandler failure:(requestFailureBlock)failureHandler {
//ç½‘ç»œä¸å¯ç”¨
  if (![self checkNetworkStatus]) {
      successHandler(nil);
      failureHandler(nil);
      return;
  }
  AFHTTPRequestOperationManager *manager = [self getRequstManager];
  [manager GET:url parameters:params success:^(AFHTTPRequestOperation * _Nonnull operation, id  _Nonnull responseObject) {
      successHandler(responseObject);
  } failure:^(AFHTTPRequestOperation * _Nullable operation, NSError * _Nonnull error) {
      XLLog(@"------è¯·æ±‚å¤±è´¥-------%@",error);
      failureHandler(error);
  }];
}
</code></pre>

<p>ä¸‹è½½éƒ¨åˆ†ä»£ç </p>

<pre><code>    //ä¸‹è½½æ–‡ä»¶ï¼Œç›‘å¬ä¸‹è½½è¿›åº¦
    + (void)downloadRequest:(NSString *)url successAndProgress:(progressBlock)progressHandler complete:(responseBlock)completionHandler {
      if (![self checkNetworkStatus]) {
          progressHandler(0, 0, 0);
          completionHandler(nil, nil);
          return;
      }
      NSURLSessionConfiguration *sessionConfiguration = [NSURLSessionConfiguration defaultSessionConfiguration];
      AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:sessionConfiguration];
      NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];
      NSProgress *kProgress = nil;
      NSURLSessionDownloadTask *downloadTask = [manager downloadTaskWithRequest:request progress:&amp;kProgress destination:^NSURL * _Nonnull(NSURL * _Nonnull targetPath, NSURLResponse * _Nonnull response) {
          NSURL *documentUrl = [[NSFileManager defaultManager] URLForDirectory :NSDocumentDirectory inDomain:NSUserDomainMask appropriateForURL:nil create:NO error:nil];
          return [documentUrl URLByAppendingPathComponent:[response suggestedFilename]];
      } completionHandler:^(NSURLResponse * _Nonnull response, NSURL * _Nonnull filePath, NSError * _Nonnull error){
          if (error) {
              XLLog(@"------ä¸‹è½½å¤±è´¥-------%@",error);
          }
          completionHandler(response, error);
      }];
      [manager setDownloadTaskDidWriteDataBlock:^(NSURLSession * _Nonnull session, NSURLSessionDownloadTask * _Nonnull downloadTask, int64_t bytesWritten, int64_t totalBytesWritten, int64_t totalBytesExpectedToWrite) {
          progressHandler(bytesWritten, totalBytesWritten, totalBytesExpectedToWrite);
      }];
      [downloadTask resume];
    }
</code></pre>

<p>ä¸Šä¼ éƒ¨åˆ†ä»£ç </p>

<pre><code>//ä¸Šä¼ æ–‡ä»¶ï¼Œç›‘å¬ä¸Šä¼ è¿›åº¦
+ (void)updateRequest:(NSString *)url params:(NSDictionary *)params fileConfig:(XLFileConfig *)fileConfig successAndProgress:(progressBlock)progressHandler complete:(responseBlock)completionHandler {
  if (![self checkNetworkStatus]) {
      progressHandler(0, 0, 0);
      completionHandler(nil, nil);
      return;
  }
  NSMutableURLRequest *request = [[AFHTTPRequestSerializer serializer] multipartFormRequestWithMethod:@"POST" URLString:url parameters:params constructingBodyWithBlock:^(id  _Nonnull formData) {
      [formData appendPartWithFileData:fileConfig.fileData name:fileConfig.name fileName:fileConfig.fileName mimeType:fileConfig.mimeType];
  } error:nil];
  //è·å–ä¸Šä¼ è¿›åº¦
  AFHTTPRequestOperation *operation = [[AFHTTPRequestOperation alloc] initWithRequest:request];
  [operation setUploadProgressBlock:^(NSUInteger bytesWritten, long long totalBytesWritten, long long totalBytesExpectedToWrite) {
      progressHandler(bytesWritten, totalBytesWritten, totalBytesExpectedToWrite);
  }];
  [operation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation * _Nonnull operation, id  _Nonnull responseObject) {
      completionHandler(responseObject, nil);
  } failure:^(AFHTTPRequestOperation * _Nonnull operation, NSError * _Nonnull error) {
      completionHandler(nil, error);
      if (error) {
          XLLog(@"------ä¸Šä¼ å¤±è´¥-------%@",error);
      }
  }];
  [operation start];
}
</code></pre>

<p>XLDataService.méƒ¨åˆ†å®ç°</p>

<pre><code>+ (void)getWithUrl:(NSString *)url param:(id)param modelClass:(Class)modelClass responseBlock:(responseBlock)responseDataBlock {
      [XLNetworkRequest getRequest:url params:param success:^(id responseObj) {
      //æ•°ç»„ã€å­—å…¸è½¬åŒ–ä¸ºæ¨¡å‹æ•°ç»„
      dataObj = [self modelTransformationWithResponseObj:responseObj modelClass:modelClass];
      responseDataBlock(dataObj, nil);
  } failure:^(NSError *error) {
      responseDataBlock(nil, error);
  }];
}
</code></pre>

<p>ï¼ˆå…³é”®ï¼‰ä¸‹é¢è¿™ä¸ªæ–¹æ³•æä¾›ç»™ç»§æ‰¿XLDataServiceçš„å­ç±»é‡å†™ï¼Œå°†è½¬åŒ–ä¸ºæ¨¡å‹çš„ä»£ç å†™åœ¨è¿™é‡Œï¼Œç›¸ä¼¼ä¸šåŠ¡çš„ç½‘ç»œæ•°æ®è¯·æ±‚éƒ½å¯ä»¥ç”¨è¿™ä¸ªå­ç±»å»è¯·æ±‚æ•°æ®ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„æ¨¡å‹æ•°ç»„ã€‚
    /<em>*
    æ•°ç»„ã€å­—å…¸è½¬åŒ–ä¸ºæ¨¡å‹
    </em>/
    + (id)modelTransformationWithResponseObj:(id)responseObj modelClass:(Class)modelClass {
         return nil;
    }
å…³äºç¦»çº¿æ•°æ®ç¼“å­˜</p>

<p>å½“ç”¨æˆ·è¿›å…¥ç¨‹åºçš„å±•ç¤ºé¡µé¢ï¼Œæœ‰ä¸‰ä¸ªæƒ…å†µä¸‹å¯èƒ½æ¶‰åŠåˆ°æ•°æ®åº“å­˜å–æ“ä½œï¼Œç®€å•ç”»äº†ä¸ªå›¾æ¥ç†è§£ï¼Œæ€è·¯æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ä¸€äº›å­˜å–çš„ç»†èŠ‚å¤„ç†ã€‚</p>

<p>è¿›å…¥å±•ç¤ºé¡µé¢</p>

<p><img src="/images/net001.png" title="Caption" ></p>

<p>ä¸‹æ‹‰åˆ·æ–°æœ€æ–°æ•°æ®</p>

<p><img src="/images/net002.png" title="Caption" ></p>

<p>ä¸Šæ‹‰åŠ è½½æ›´å¤šæ•°æ®</p>

<p><img src="/images/net003.png" title="Caption" ></p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ—¶å€™ï¼Œæ¯æ¬¡ä»æ•°æ®åº“è¿”å›ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨åŠ è½½ï¼Œå¦åˆ™ä¼šæœ‰å†…å­˜é—®é¢˜ï¼Œç›´åˆ°æ•°æ®åº“ä¸­æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶å†å‘ç”Ÿç½‘ç»œè¯·æ±‚ï¼Œå†æ¬¡å°†æ–°æ•°æ®å­˜å…¥æ•°æ®åº“ã€‚è¿™é‡Œå­˜å‚¨æ•°æ®çš„æ–¹å¼æ˜¯å°†æœåŠ¡å™¨è¿”å›æ¯ç»„æ•°æ®çš„å­—å…¸å½’æ¡£æˆäºŒè¿›åˆ¶ä½œä¸ºæ•°æ®åº“å­—æ®µç›´æ¥å­˜å‚¨ï¼Œè¿™æ ·å­˜å‚¨åœ¨æ¨¡å‹å±æ€§æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹æ›´æœ‰å¥½å¤„ï¼Œé¿å…æ¯ä¸€ä¸ªå±æ€§ä½œä¸ºä¸€ä¸ªå­—æ®µï¼Œå¦å¤–å¢åŠ äº†ä¸€ä¸ªidStrå­—æ®µç”¨æ¥åˆ¤æ–­æ•°æ®çš„å”¯ä¸€æ€§ï¼Œé¿å…é‡å¤å­˜å‚¨ã€‚
é¦–å…ˆå®šä¹‰ä¸€ä¸ªå·¥å…·ç±»XLDataBaseæ¥åšæ•°æ®åº“ç›¸å…³çš„æ“ä½œï¼Œè¿™é‡Œç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹çš„FMDBã€‚</p>

<pre><code>#import "XLDataBase.h"
#import "FMDatabase.h"
#import "Item.h"
#import "MJExtension.h"
@implementation XLDataBase
static FMDatabase *_db;
+ (void)initialize {
    NSString *path = [NSString stringWithFormat:@"%@/Library/Caches/Data.db",NSHomeDirectory()];
    _db = [FMDatabase databaseWithPath:path];
    [_db open];
    [_db executeUpdate:@"CREATE TABLE IF NOT EXISTS t_item (id integer PRIMARY KEY, itemDict blob NOT NULL, idStr text NOT NULL)"];
}
//å­˜å…¥æ•°æ®åº“
+ (void)saveItemDict:(NSDictionary *)itemDict {
    //æ­¤å¤„æŠŠå­—å…¸å½’æ¡£æˆäºŒè¿›åˆ¶æ•°æ®ç›´æ¥å­˜å…¥æ•°æ®åº“ï¼Œé¿å…æ·»åŠ è¿‡å¤šçš„æ•°æ®åº“å­—æ®µ
    NSData *dictData = [NSKeyedArchiver archivedDataWithRootObject:itemDict];
    [_db executeUpdateWithFormat:@"INSERT INTO t_item (itemDict, idStr) VALUES (%@, %@)",dictData, itemDict[@"id"]];
}
//è¿”å›å…¨éƒ¨æ•°æ®
+ (NSArray *)list {
    FMResultSet *set = [_db executeQuery:@"SELECT * FROM t_item"];
    NSMutableArray *list = [NSMutableArray array];
    while (set.next) {
        // è·å¾—å½“å‰æ‰€æŒ‡å‘çš„æ•°æ®
        NSData *dictData = [set objectForColumnName:@"itemDict"];
        NSDictionary *dict = [NSKeyedUnarchiver unarchiveObjectWithData:dictData];
        [list addObject:[Item mj_objectWithKeyValues:dict]];
    }
    return list;
}
//å–å‡ºæŸä¸ªèŒƒå›´å†…çš„æ•°æ®
+ (NSArray *)listWithRange:(NSRange)range {
    NSString *SQL = [NSString stringWithFormat:@"SELECT * FROM t_item LIMIT %lu, %lu",range.location, range.length];
    FMResultSet *set = [_db executeQuery:SQL];
    NSMutableArray *list = [NSMutableArray array];
    while (set.next) {
        NSData *dictData = [set objectForColumnName:@"itemDict"];
        NSDictionary *dict = [NSKeyedUnarchiver unarchiveObjectWithData:dictData];
        [list addObject:[Item mj_objectWithKeyValues:dict]];
    }
    return list;
}
//é€šè¿‡ä¸€ç»„æ•°æ®çš„å”¯ä¸€æ ‡è¯†åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨
+ (BOOL)isExistWithId:(NSString *)idStr
{
    BOOL isExist = NO;
    FMResultSet *resultSet= [_db executeQuery:@"SELECT * FROM t_item where idStr = ?",idStr];
    while ([resultSet next]) {
        if([resultSet stringForColumn:@"idStr"]) {
            isExist = YES;
        }else{
            isExist = NO;
        }
    }
    return isExist;
}
@end
</code></pre>

<p>ä¸€äº›ç»§æ‰¿äºXLDataServiceçš„å­ç±»çš„æ•°æ®åº“å­˜å‚¨å’Œæ¨¡å‹è½¬æ¢çš„é€»è¾‘ä»£ç </p>

<pre><code>#import "GetTableViewData.h"
#import "XLDataBase.h"
@implementation GetTableViewData
//é‡å†™çˆ¶ç±»æ–¹æ³•
+ (id)modelTransformationWithResponseObj:(id)responseObj modelClass:(Class)modelClass {
    NSArray *lists = responseObj[@"data"][@"list"];
    NSMutableArray *array = [NSMutableArray array];
    for (NSDictionary *dict in lists) {
        [modelClass mj_setupReplacedKeyFromPropertyName:^NSDictionary *{
            return @{ @"ID" : @"id" };
        }];
        [array addObject:[modelClass mj_objectWithKeyValues:dict]];
        //é€šè¿‡idStrå…ˆåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜å‚¨è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç½‘ç»œè¯·æ±‚æ–°æ•°æ®å­˜å…¥æ•°æ®åº“
        if (![XLDataBase isExistWithId:dict[@"id"]]) {
            //å­˜æ•°æ®åº“
            NSLog(@"å­˜å…¥æ•°æ®åº“");
            [XLDataBase saveItemDict:dict];
        }
    }
    return array;
}
</code></pre>

<p>ä¸‹é¢æ˜¯ä¸€äº›æ§åˆ¶å™¨çš„ä»£ç å®ç°ï¼š</p>

<pre><code>#import "ViewController.h"
#import "GetTableViewData.h"
#import "Item.h"
#import "XLDataBase.h"
#import "ItemCell.h"
#import "MJRefresh.h"
#define URL_TABLEVIEW @"https://api.108tian.com/mobile/v3/EventList?cityId=1&amp;step=10&amp;theme=0&amp;page=%lu"
@interface ViewController () {
    NSMutableArray *_dataArray;
    UITableView *_tableView;
    NSInteger _currentPage;//å½“å‰æ•°æ®å¯¹åº”çš„page
}
@end
@implementation ViewController
#pragma mark Life cycle
- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    [self createTableView];
    _dataArray = [NSMutableArray array];
}
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    NSRange range = NSMakeRange(0, 10);
    //å¦‚æœæ•°æ®åº“æœ‰æ•°æ®åˆ™è¯»å–ï¼Œä¸å‘é€ç½‘ç»œè¯·æ±‚
    if ([[XLDataBase listWithRange:range] count]) {
        [_dataArray addObjectsFromArray:[XLDataBase listWithRange:range]];
        NSLog(@"ä»æ•°æ®åº“åŠ è½½");
    }else{
        [self getTableViewDataWithPage:0];
    }
}
#pragma mark UI
- (void)createTableView {
    _tableView = [[UITableView alloc] initWithFrame:self.view.bounds];
    _tableView.delegate = self;
    _tableView.dataSource = self;
    _tableView.rowHeight = 100.0;
    [self.view addSubview:_tableView];
    _tableView.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{
        [self loadNewData];
    }];
    _tableView.mj_footer = [MJRefreshAutoNormalFooter footerWithRefreshingBlock:^{
        [self loadMoreData];
    }];
}
#pragma mark GetDataSoure
- (void)getTableViewDataWithPage:(NSInteger)page {
    NSLog(@"å‘é€ç½‘ç»œè¯·æ±‚ï¼");
    NSString *url = [NSString stringWithFormat:URL_TABLEVIEW, page];
    [GetTableViewData getWithUrl:url param:nil modelClass:[Item class] responseBlock:^(id dataObj, NSError *error) {
        [_dataArray addObjectsFromArray:dataObj];
        [_tableView reloadData];
        [_tableView.mj_header endRefreshing];
        [_tableView.mj_footer endRefreshing];
    }];
}
- (void)loadNewData {
    NSLog(@"ä¸‹æ‹‰åˆ·æ–°");
    _currentPage = 0;
    [_dataArray removeAllObjects];
    [self getTableViewDataWithPage:_currentPage];
}
- (void)loadMoreData {
    NSLog(@"ä¸Šæ‹‰åŠ è½½");
    _currentPage ++;
    NSRange range = NSMakeRange(_currentPage * 10, 10);
    if ([[XLDataBase listWithRange:range] count]) {
        [_dataArray addObjectsFromArray:[XLDataBase listWithRange:range]];
        [_tableView reloadData];
        [_tableView.mj_footer endRefreshing];
        NSLog(@"æ•°æ®åº“åŠ è½½%luæ¡æ›´å¤šæ•°æ®",[[XLDataBase listWithRange:range] count]);
    }else{
        //æ•°æ®åº“æ²¡æ›´å¤šæ•°æ®æ—¶å†ç½‘ç»œè¯·æ±‚
        [self getTableViewDataWithPage:_currentPage];
    }
}
#pragma mark UITableViewDataSource
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return _dataArray.count;
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    ItemCell *cell = [ItemCell itemCellWithTableView:tableView];
    cell.item = _dataArray[indexPath.row];
    return cell;
}
@end
</code></pre>

<p>æœ€åé™„ä¸Šä»£ç çš„ä¸‹è½½åœ°å€ï¼Œé‡è¦çš„éƒ¨åˆ†ä»£ç ä¸­éƒ½æœ‰ç›¸åº”çš„æ³¨é‡Šå’Œæ–‡å­—æ‰“å°ï¼Œè¿è¡Œç¨‹åºå¯ä»¥å¾ˆç›´è§‚çš„è¡¨ç°ã€‚</p>

<p><a href="https://github.com/ShelinShelin/OffLineCache.git">Demo</a></p>

<p>å¸Œæœ›å¤§å®¶èƒ½æå‡ºä¸€äº›æ„è§ï¼Œå¾ˆä¹æ„ä¸å¤§å®¶äº’ç›¸äº¤æµã€‚</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/04/wang-shang-qing-qiu-feng-(feng-)zhuang/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/12/04/wang-shang-qing-qiu-feng-(feng-)zhuang/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/04/xu-lie-hua-and-fan-xu-lie-hua-shen-jiu/">åºåˆ—åŒ–&amp;ååºåˆ—åŒ–æ·±ç©¶</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>æ‘˜è¦
åºåˆ—åŒ–å’Œååºåˆ—åŒ–å‡ ä¹æ˜¯å·¥ç¨‹å¸ˆä»¬æ¯å¤©éƒ½è¦é¢å¯¹çš„äº‹æƒ…ï¼Œä½†æ˜¯è¦ç²¾ç¡®æŒæ¡è¿™ä¸¤ä¸ªæ¦‚å¿µå¹¶ä¸å®¹æ˜“ï¼šä¸€æ–¹é¢ï¼Œå®ƒä»¬å¾€å¾€ä½œä¸ºæ¡†æ¶çš„ä¸€éƒ¨åˆ†å‡ºç°è€Œæ¹®æ²¡åœ¨æ¡†æ¶ä¹‹ä¸­ï¼›å¦ä¸€æ–¹é¢ï¼Œå®ƒä»¬ä¼šä»¥å…¶ä»–æ›´å®¹æ˜“ç†è§£çš„æ¦‚å¿µå‡ºç°ï¼Œä¾‹å¦‚åŠ å¯†ã€æŒä¹…åŒ–ã€‚ç„¶è€Œï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é€‰å‹å´æ˜¯ç³»ç»Ÿè®¾è®¡æˆ–é‡æ„ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ï¼Œåœ¨åˆ†å¸ƒå¼ã€å¤§æ•°æ®é‡ç³»ç»Ÿè®¾è®¡é‡Œé¢æ›´ä¸ºæ˜¾è‘—ã€‚æ°å½“çš„åºåˆ—åŒ–åè®®ä¸ä»…å¯ä»¥æé«˜ç³»ç»Ÿçš„é€šç”¨æ€§ã€å¼ºå¥æ€§ã€å®‰å…¨æ€§ã€ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Œè€Œä¸”ä¼šè®©ç³»ç»Ÿæ›´åŠ æ˜“äºè°ƒè¯•ã€ä¾¿äºæ‰©å±•ã€‚æœ¬æ–‡ä»å¤šä¸ªè§’åº¦å»åˆ†æå’Œè®²è§£â€œåºåˆ—åŒ–å’Œååºåˆ—åŒ–â€ï¼Œå¹¶å¯¹æ¯”äº†å½“å‰æµè¡Œçš„å‡ ç§åºåˆ—åŒ–åè®®ï¼ŒæœŸæœ›å¯¹è¯»è€…åšåºåˆ—åŒ–é€‰å‹æœ‰æ‰€å¸®åŠ©ã€‚</p></blockquote>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/04/xu-lie-hua-and-fan-xu-lie-hua-shen-jiu/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/12/04/xu-lie-hua-and-fan-xu-lie-hua-shen-jiu/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/03/huan-cun-ji-zhi-shen-jiu/">è‡ªå·±å†™å¥—ç¼“å­˜æœºåˆ¶</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>å‰è¨€</li>
</ul>


<p>å¤§å®¶éƒ½çŸ¥é“UITableViewï¼Œæœ€ç»å…¸åœ¨äºå¾ªç¯åˆ©ç”¨ï¼Œè¿™é‡Œæˆ‘è‡ªå·±æ¨¡ä»¿UITableViewå¾ªç¯åˆ©ç”¨,å†™äº†ä¸€å¥—è‡ªå·±çš„TableViewå®ç°æ–¹æ¡ˆï¼Œå¸Œæœ›å¤§å®¶çœ‹äº†æˆ‘çš„æ–‡ç« ï¼Œå¾ªç¯åˆ©ç”¨æ€æƒ³æœ‰æ˜¾è‘—æå‡ã€‚</p>

<h2>ä¸€ï¼š ç ”ç©¶UITableViewåº•å±‚å®ç°</h2>

<h5>1.ç³»ç»ŸUITabelViewçš„ç®€å•ä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘åˆ†ç»„äº†ï¼Œé»˜è®¤ä¸º1ç»„ã€‚</h5>

<pre><code> 1 // è¿”å›ç¬¬sectionç»„æœ‰å¤šå°‘è¡Œ
 2 - (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
 3 {
 4     NSLog(@"%s",__func__);
 5     return 10;
 6 }
 7  
 8 // è¿”å›æ¯ä¸€è¡Œcellçš„æ ·å­
 9 - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
10 {
11     NSLog(@"%s",__func__);
12     static NSString *ID = @"cell";
13     UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:ID];
14      
15     if (cell == nil) {
16          
17         cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:ID];
18     }
19      
20     cell.textLabel.text = [NSString stringWithFormat:@"%ld",indexPath.row];
21      
22     return cell;
23 }
24 // è¿”å›æ¯è¡Œcellçš„é«˜åº¦
25 - (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
26 {
27     NSLog(@"%s--%@",__func__,indexPath);
28     return 100;
29 } 
</code></pre>

<h5>2.éªŒè¯UITabelViewçš„å®ç°æœºåˆ¶ã€‚</h5>

<p>å¦‚å›¾æ‰“å°ç»“æœ:</p>

<p><img src="/images/huancun001.png" title="Caption" ></p>

<ul>
<li><p>åˆ†æï¼šåº•å±‚å…ˆè·å–æœ‰å¤šå°‘cellï¼ˆ10ä¸ªï¼‰ï¼Œåœ¨è·å–æ¯ä¸ªcellçš„é«˜åº¦ï¼Œè¿”å›é«˜åº¦çš„æ–¹æ³•ä¸€å¼€å§‹è°ƒç”¨10æ¬¡ã€‚</p>

<ul>
<li>ç›®çš„ï¼šç¡®å®štableViewçš„æ»šåŠ¨èŒƒå›´ï¼Œä¸€å¼€å§‹è®¡ç®—æ‰€æœ‰cellçš„frame,å°±èƒ½è®¡ç®—ä¸‹tableViewçš„æ»šåŠ¨èŒƒå›´ã€‚</li>
</ul>
</li>
<li><p>åˆ†æï¼štableView:cellForRowAtIndexPath:æ–¹æ³•ä»€ä¹ˆæ—¶å€™è°ƒç”¨ã€‚</p></li>
</ul>


<p>æ‰“å°éªŒè¯ï¼Œå¦‚å›¾ï¼š</p>

<p><img src="/images/huancun002.png" title="Caption" ></p>

<p>ä¸€å¼€å§‹è°ƒç”¨äº†7æ¬¡ï¼Œå› ä¸ºä¸€å¼€å§‹å±å¹•æœ€å¤šæ˜¾ç¤º7ä¸ªcell</p>

<pre><code>- ç›®çš„ï¼šä¸€å¼€å§‹åªåŠ è½½æ˜¾ç¤ºå‡ºæ¥çš„cellï¼Œç­‰æœ‰æ–°çš„cellå‡ºç°çš„æ—¶å€™ä¼šç»§ç»­è°ƒç”¨è¿™ä¸ªæ–¹æ³•åŠ è½½cellã€‚
</code></pre>

<h5>3.UITableViewå¾ªç¯åˆ©ç”¨æ€æƒ³</h5>

<p>å½“æ–°çš„cellå‡ºç°çš„æ—¶å€™ï¼Œé¦–å…ˆä»ç¼“å­˜æ± ä¸­è·å–ï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œå°±è‡ªå·±åˆ›å»ºcellã€‚</p>

<p>å½“æœ‰cellç§»é™¤å±å¹•çš„æ—¶å€™ï¼ŒæŠŠcellæ”¾åˆ°ç¼“å­˜æ± ä¸­å»ã€‚</p>

<h2>äºŒã€è‡ªå®šä¹‰UIScroolViewï¼Œæ¨¡ä»¿UITableViewå¾ªç¯åˆ©ç”¨</h2>

<h5>1.æä¾›æ•°æ®æºå’Œä»£ç†æ–¹æ³•ï¼Œå‘½åå’ŒUITableViewä¸€è‡´ã€‚</h5>

<pre><code> 1 @class YZTableView;
 2 @protocol YZTableViewDataSource
 3  
 4 @required
 5  
 6 // è¿”å›æœ‰å¤šå°‘è¡Œcell
 7 - (NSInteger)tableView:(YZTableView *)tableView numberOfRowsInSection:(NSInteger)section;
 8  
 9  
10 // è¿”å›æ¯è¡Œcellé•¿ä»€ä¹ˆæ ·å­
11 - (UITableViewCell *)tableView:(YZTableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath;
12  
13 @end
14  
15 @protocol YZTableViewDelegate
16  
17 // è¿”å›æ¯è¡Œcellæœ‰å¤šé«˜
18 - (CGFloat)tableView:(YZTableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath;
19  
20 @end 
</code></pre>

<h5>2.æä¾›ä»£ç†å’Œæ•°æ®æºå±æ€§</h5>

<pre><code>1 @interface YZTableView : UIScrollView
2  
3 @property (nonatomic, weak) id dataSource;
4  
5 @property (nonatomic, weak) id delegate;
6  
7 @end 
</code></pre>

<p>è­¦å‘Š:</p>

<p><img src="/images/huancun003.png" title="Caption" ></p>

<p>è§£å†³ï¼Œåœ¨YZTableView.mçš„å®ç°ä¸­å£°æ˜ã€‚</p>

<p><img src="/images/huancun004.png" title="Caption" ></p>

<ul>
<li><p>åŸå› ï¼šæœ‰äººä¼šé—®ä¸ºä»€ä¹ˆæˆ‘è¦å®šä¹‰åŒåçš„delegateå±æ€§ï¼Œæˆ‘ä¸»è¦æƒ³æ¨¡ä»¿ç³»ç»Ÿçš„tableViewï¼Œç³»ç»ŸtableViewä¹Ÿæœ‰åŒåçš„å±æ€§ã€‚</p>

<ul>
<li>æ€è·¯ï¼šè¿™æ ·åšï¼Œå¤–ç•Œåœ¨ä½¿ç”¨è®¾ç½®æˆ‘çš„tableViewçš„delegateï¼Œå°±å¿…é¡»éµå®ˆçš„æˆ‘çš„ä»£ç†åè®®ï¼Œè€Œä¸æ˜¯UIScrollViewçš„ä»£ç†åè®®ã€‚</li>
</ul>
</li>
</ul>


<h5>3.æä¾›åˆ·æ–°æ–¹æ³•reloadDataï¼Œå› ä¸ºtableViewé€šè¿‡è¿™ä¸ªåˆ·æ–°tableViewã€‚</h5>

<pre><code> 1 @interface YZTableView : UIScrollView
 2  
 3 @property (nonatomic, weak) id dataSource;
 4  
 5 @property (nonatomic, weak) id delegate;
 6  
 7 // åˆ·æ–°tableView
 8 - (void)reloadData;
 9  
10 @end 
</code></pre>

<h5>4.å®ç°reloadDataæ–¹æ³•ï¼Œåˆ·æ–°è¡¨æ ¼</h5>

<p>å›é¡¾ç³»ç»Ÿå¦‚ä½•åˆ·æ–°tableView</p>

<ul>
<li><p>1).å…ˆè·å–æœ‰å¤šå°‘cell,åœ¨è·å–æ¯ä¸ªcellçš„é«˜åº¦ã€‚å› æ­¤åº”è¯¥æ˜¯å…ˆè®¡ç®—å‡ºæ¯ä¸ªcellçš„frame.</p></li>
<li><p>2).ç„¶åå†åˆ¤æ–­å½“å‰æœ‰å¤šå°‘cellæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå°±åŠ è½½å¤šå°‘</p></li>
</ul>


<hr />

<pre><code> 1 // åˆ·æ–°tableView
 2 - (void)reloadData
 3 {
 4     // è¿™é‡Œä¸è€ƒè™‘å¤šç»„ï¼Œå‡è®¾tableViewé»˜è®¤åªæœ‰ä¸€ç»„ã€‚
 5      
 6     // å…ˆè·å–æ€»å…±æœ‰å¤šå°‘cell
 7     NSInteger rows = [self.dataSource tableView:self numberOfRowsInSection:0];
 8      
 9     // éå†æ‰€æœ‰cellçš„é«˜åº¦ï¼Œè®¡ç®—æ¯è¡Œcellçš„frame
10     CGRect cellF;
11     CGFloat cellX = 0;
12     CGFloat cellY = 0;
13     CGFloat cellW = self.bounds.size.width;
14     CGFloat cellH = 0;
15     CGFloat totalH = 0;
16      
17     for (int i = 0; i &lt; rows; i++) {
18         
19         NSIndexPath *indexPath = [NSIndexPath indexPathForRow:i inSection:0];
20         // æ³¨æ„ï¼šè¿™é‡Œè·å–çš„delegateï¼Œæ˜¯UIScrollViewä¸­å£°æ˜çš„å±æ€§
21         if ([self.delegate respondsToSelector:@selector(tableView:heightForRowAtIndexPath:)]) {
22             cellH = [self.delegate tableView:self heightForRowAtIndexPath:indexPath];
23         }else{
24             cellH = 44;
25         }
26         cellY = i * cellH;
27          
28         cellF = CGRectMake(cellX, cellY, cellW, cellH);
29          
30         // è®°å½•æ¯ä¸ªcellçš„yå€¼å¯¹åº”çš„indexPath
31         self.indexPathDict[@(cellY)] = indexPath;
32          
33         // åˆ¤æ–­æœ‰å¤šå°‘cellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š,åªåŠ è½½æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„cell
34         if ([self isInScreen:cellF]) { // å½“å‰cellçš„frameåœ¨å±å¹•ä¸Š
35             // é€šè¿‡æ•°æ®æºè·å–cell
36             UITableViewCell *cell = [self.dataSource tableView:self cellForRowAtIndexPath:indexPath];
37              
38             cell.frame = cellF;
39              
40             [self addSubview:cell];
41              
42         }
43          
44         // æ·»åŠ åˆ†å‰²çº¿
45         UIView *divideV = [[UIView alloc] initWithFrame:CGRectMake(0, cellY + cellH - 1, cellW, 1)];
46         divideV.backgroundColor = [UIColor lightGrayColor];
47         divideV.alpha = 0.3;
48         [self addSubview:divideV];
49          
50         // æ·»åŠ åˆ°cellå¯è§æ•°ç»„ä¸­
51             [self.visibleCells addObject:cell];
52          
53         // è®¡ç®—tableViewå†…å®¹æ€»é«˜åº¦
54         totalH += cellY + cellH;
55      
56     }
57      
58     // è®¾ç½®tableViewçš„æ»šåŠ¨èŒƒå›´
59     self.contentSize = CGSizeMake(self.bounds.size.width, totalH);
60      
61 } 
</code></pre>

<h5>5.å¦‚ä½•åˆ¤æ–­cellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š</h5>

<p>å½“tableViewå†…å®¹å¾€ä¸‹èµ°</p>

<p><img src="/images/huancun005.gif" title="Caption" ></p>

<p>å½“tableViewå†…å®¹å¾€ä¸Šèµ°</p>

<p><img src="/images/huancun006.gif" title="Caption" ></p>

<pre><code> 1 // æ ¹æ®cellå°ºå¯¸åˆ¤æ–­cellåœ¨ä¸åœ¨å±å¹•ä¸Š
 2 - (BOOL)isInScreen:(CGRect)cellF
 3 {
 4     // tableViewèƒ½æ»šåŠ¨ï¼Œå› æ­¤éœ€è¦åŠ ä¸Šåç§»é‡åˆ¤æ–­
 5      
 6     // å½“tableViewå†…å®¹å¾€ä¸‹èµ°ï¼ŒoffsetYä¼šä¸€ç›´å¢åŠ  ,cellçš„æœ€å¤§yå€¼ &lt; offsetYåç§»é‡   ,cellç§»é™¤å±å¹•
 7     // tableViewå†…å®¹å¾€ä¸Šèµ° , offsetYä¼šä¸€ç›´å‡å°‘ï¼Œå±å¹•çš„æœ€å¤§Yå€¼ &lt;  cellçš„yå€¼ ï¼ŒCellç§»é™¤å±å¹•
 8     // å±å¹•æœ€å¤§yå€¼ = å±å¹•çš„é«˜åº¦ + offsetY
 9      
10     // è¿™é‡Œæ‹¿å±å¹•æ¥æ¯”è¾ƒï¼Œå…¶å®æ˜¯å› ä¸ºtableViewçš„å°ºå¯¸æˆ‘é»˜è®¤ç­‰äºå±å¹•çš„é«˜åº¦ï¼Œæ­£å¸¸åº”è¯¥æ˜¯tableViewçš„é«˜åº¦ã€‚
11     // cellåœ¨å±å¹•ä¸Šï¼Œ cellçš„æœ€å¤§yå€¼ &gt; offsetY &amp;&amp; cellçš„yå€¼ &lt; å±å¹•çš„æœ€å¤§Yå€¼(å±å¹•çš„é«˜åº¦ + offsetY)
12      
13     CGFloat offsetY = self.contentOffset.y;
14      
15     return CGRectGetMaxY(cellF) &gt; offsetY &amp;&amp; cellF.origin.y &lt; self.bounds.size.height + offsetY;
16  
17     } 
</code></pre>

<h5>6.åœ¨æ»šåŠ¨çš„æ—¶å€™ï¼Œå¦‚æœæœ‰æ–°çš„cellå‡ºç°åœ¨å±å¹•ä¸Šï¼Œå…ˆä»ç¼“å­˜æ± ä¸­å–ï¼Œæ²¡æœ‰å–åˆ°ï¼Œåœ¨åˆ›å»ºæ–°çš„cell.</h5>

<ul>
<li>åˆ†æï¼š</li>
</ul>


<p>éœ€è¦åŠæ—¶ç›‘å¬tableViewçš„æ»šåŠ¨ï¼Œåˆ¤æ–­ä¸‹æœ‰æ²¡æœ‰æ–°çš„cellå‡ºç°ã€‚</p>

<p>å¤§å®¶éƒ½ä¼šæƒ³åˆ°scrollViewDidScrollæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªè¦ä¸€æ»šåŠ¨scrollViewå°±ä¼šè°ƒç”¨ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯tableViewå†…éƒ¨éœ€è¦ä½œä¸ºè‡ªèº«çš„ä»£ç†ï¼Œæ‰èƒ½ç›‘å¬ï¼Œè¿™æ ·ä¸å¥½ï¼Œæœ‰æ—¶å€™å¤–ç•Œä¹Ÿéœ€è¦ç›‘å¬æ»šåŠ¨ï¼Œå› æ­¤è‡ªèº«ç±»æœ€å¥½ä¸è¦æˆä¸ºè‡ªå·±çš„ä»£ç†ã€‚ï¼ˆè®¾è®¡æ€æƒ³ï¼‰</p>

<ul>
<li>è§£å†³ï¼š</li>
</ul>


<p>é‡å†™layoutSubviewsï¼Œåˆ¤æ–­å½“å‰å“ªäº›cellæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p>

<p>å› ä¸ºåªè¦ä¸€æ»šåŠ¨ï¼Œå°±ä¼šä¿®æ”¹contentOffset,å°±ä¼šè°ƒç”¨layoutSubviewsï¼Œå…¶å®ä¿®æ”¹contentOffsetï¼Œå†…éƒ¨å…¶å®æ˜¯ä¿®æ”¹tableViewçš„bounds,è€ŒlayoutSubviewsåˆšå¥½æ˜¯çˆ¶æ§ä»¶å°ºå¯¸ä¸€æ”¹å°±ä¼šè°ƒç”¨.å…·ä½“éœ€è¦äº†è§£scrollViewåº•å±‚å®ç°ã€‚</p>

<ul>
<li>æ€è·¯ï¼š</li>
</ul>


<p>åˆ¤æ–­ä¸‹ï¼Œå½“å‰tableViewå†…å®¹å¾€ä¸Šç§»åŠ¨ï¼Œè¿˜æ˜¯å¾€ä¸‹ç§»åŠ¨ï¼Œå¦‚ä½•åˆ¤æ–­ï¼Œå–å‡ºæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ç¬¬ä¸€æ¬¡cellï¼Œå½“å‰åç§»é‡ > ç¬¬ä¸€ä¸ªcellçš„yå€¼ï¼Œå¾€ä¸‹èµ°ã€‚</p>

<p>éœ€è¦æä¸ªæ•°ç»„è®°å½•ä¸‹ï¼Œå½“å‰æœ‰å¤šå°‘cellæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œåœ¨ä¸€å¼€å§‹çš„æ—¶å€™è®°å½•.</p>

<pre><code> 1 @interface YZTableView ()
 2  
 3 @property (nonatomic, strong) NSMutableArray *visibleCells;
 4  
 5 @end
 6  
 7 @implementation YZTableView
 8  
 9 @dynamic delegate;
10  
11 - (NSMutableArray *)visibleCells
12 {
13  
14     if (_visibleCells == nil) {
15         _visibleCells = [NSMutableArray array];
16     }
17     return _visibleCells;
18      
19 }
20 @end 
</code></pre>

<h3>å¾€ä¸‹ç§»åŠ¨</h3>

<ul>
<li><p>1.å¦‚æœå·²ç»æ»šåŠ¨åˆ°tableViewå†…å®¹æœ€åº•éƒ¨ï¼Œå°±ä¸éœ€è¦åˆ¤æ–­æ–°çš„cellï¼Œç›´æ¥è¿”å›.</p></li>
<li><p>2.éœ€è¦åˆ¤æ–­ä¹‹å‰æ˜¾ç¤ºåœ¨å±å¹•cellæœ‰æ²¡æœ‰ç§»é™¤å±å¹•</p></li>
<li><p>3.åªéœ€è¦åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªcellæœ‰æ²¡æœ‰ç¦»å¼€å±å¹•</p></li>
<li><p>4.åªéœ€è¦åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­æœ€åä¸€ä¸ªcellçš„ä¸‹ä¸€ä¸ªcellæ˜¾æ²¡æ˜¾ç¤ºåœ¨å±å¹•ä¸Šå³å¯ã€‚</p></li>
</ul>


<hr />

<pre><code> 1 // åˆ¤æ–­æœ‰æ²¡æœ‰æ»šåŠ¨åˆ°æœ€åº•éƒ¨
 2         if (offsetY + self.bounds.size.height &gt; self.contentSize.height) {
 3             return;
 4         }
 5          
 6         // åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªcellæœ‰æ²¡æœ‰ç¦»å¼€å±å¹•
 7         if ([self isInScreen:firstCell.frame] == NO) { // å¦‚æœä¸åœ¨å±å¹•
 8             // ä»å¯è§cellæ•°ç»„ç§»é™¤
 9             [self.visibleCells removeObject:firstCell];
10              
11             // åˆ é™¤ç¬¬0ä¸ªä»å¯è§çš„indexPath
12             [self.visibleIndexPaths removeObjectAtIndex:0];
13              
14             // æ·»åŠ åˆ°ç¼“å­˜æ± ä¸­
15             [self.reuserCells addObject:firstCell];
16              
17             // ç§»é™¤çˆ¶æ§ä»¶
18             [firstCell removeFromSuperview];
19              
20         }
21         // åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­æœ€åä¸€ä¸ªcellçš„ä¸‹ä¸€ä¸ªcellæ˜¾æ²¡æ˜¾ç¤ºåœ¨å±å¹•ä¸Š
22         // è¿™é‡Œéœ€è¦è®¡ç®—ä¸‹ä¸€ä¸ªcellçš„yå€¼ï¼Œéœ€è¦è·å–å¯¹åº”çš„cellçš„é«˜åº¦
23         // è€Œé«˜åº¦éœ€è¦æ ¹æ®indexPathï¼Œä»æ•°æ®æºè·å–
24         // å¯ä»¥æ•°ç»„è®°å½•æ¯ä¸ªå¯è§cellçš„indexPathçš„é¡ºåº,ç„¶åè·å–å¯¹åº”å¯è§çš„indexPathçš„è§’æ ‡ï¼Œå°±èƒ½è·å–ä¸‹ä¸€ä¸ªindexPath.
25          
26         // è·å–æœ€åä¸€ä¸ªcellçš„indexPath
27         NSIndexPath *indexPath = [self.visibleIndexPaths lastObject];
28          
29         // è·å–ä¸‹ä¸€ä¸ªcellçš„indexPath
30         NSIndexPath *nextIndexPath = [NSIndexPath indexPathForRow:indexPath.row + 1 inSection:0];
31          
32         // è·å–cellçš„é«˜åº¦
33         if ([self.delegate respondsToSelector:@selector(tableView:heightForRowAtIndexPath:)]) {
34             cellH = [self.delegate tableView:self heightForRowAtIndexPath:nextIndexPath];
35         }else{
36             cellH = 44;
37         }
38          
39         // è®¡ç®—ä¸‹ä¸€ä¸ªcellçš„yå€¼
40         cellY = lastCellY + cellH;
41          
42         // è®¡ç®—ä¸‹ä¸‹ä¸€ä¸ªcellçš„frame
43         CGRect nextCellFrame = CGRectMake(cellX, cellY, cellW, cellH);
44          
45         if ([self isInScreen:nextCellFrame]) { // å¦‚æœåœ¨å±å¹•ä¸Šï¼Œå°±åŠ è½½
46              
47             // é€šè¿‡æ•°æ®æºè·å–cell
48             UITableViewCell *cell = [self.dataSource tableView:self cellForRowAtIndexPath:nextIndexPath];
49              
50             cell.frame = nextCellFrame;
51              
52             [self insertSubview:cell atIndex:0];
53              
54             // æ·»åŠ åˆ°cellå¯è§æ•°ç»„ä¸­
55             [self.visibleCells addObject:cell];
56              
57             // æ·»åŠ åˆ°å¯è§çš„indexPathsæ•°ç»„
58             [self.visibleIndexPaths addObject:nextIndexPath];
59              
60              
61         } 
</code></pre>

<h3>å¾€ä¸Šç§»åŠ¨</h3>

<ul>
<li><p>1.å¦‚æœå·²ç»æ»šåŠ¨åˆ°tableViewæœ€é¡¶éƒ¨ï¼Œå°±ä¸éœ€è¦åˆ¤æ–­äº†æœ‰æ²¡æœ‰å¿ƒçš„cellï¼Œç›´æ¥è¿”å›.</p></li>
<li><p>2.éœ€è¦åˆ¤æ–­ä¹‹å‰æ˜¾ç¤ºåœ¨å±å¹•cellæœ‰æ²¡æœ‰ç§»é™¤å±å¹•</p></li>
<li><p>3.åªéœ€è¦åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­æœ€åä¸€ä¸ªcellæœ‰æ²¡æœ‰ç¦»å¼€å±å¹•</p></li>
<li><p>4.åªéœ€è¦åˆ¤æ–­ä¸‹å¯è§cellæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªcellçš„ä¸Šä¸€ä¸ªcellæ˜¾æ²¡æ˜¾ç¤ºåœ¨å±å¹•ä¸Šå³å¯</p></li>
</ul>


<p>æ³¨æ„ç‚¹ï¼šå¦‚æœå¯è§cellæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªcellçš„ä¸Šä¸€ä¸ªcellæ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œä¸€å®šè¦è®°å¾—æ˜¯æ’å…¥åˆ°å¯è§æ•°ç»„ç¬¬0ä¸ªçš„ä½ç½®ã€‚</p>

<pre><code> 1 // åˆ¤æ–­æœ‰æ²¡æœ‰æ»šåŠ¨åˆ°æœ€é¡¶éƒ¨
 2         if (offsetY &lt; 0) {
 3             return;
 4         }
 5          
 6          
 7          
 8         // åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­æœ€åä¸€ä¸ªcellæœ‰æ²¡æœ‰ç¦»å¼€å±å¹•
 9         if ([self isInScreen:lastCell.frame] == NO) { // å¦‚æœä¸åœ¨å±å¹•
10             // ä»å¯è§cellæ•°ç»„ç§»é™¤
11             [self.visibleCells removeObject:lastCell];
12              
13             // åˆ é™¤æœ€åä¸€ä¸ªå¯è§çš„indexPath
14             [self.visibleIndexPaths removeLastObject];
15              
16             // æ·»åŠ åˆ°ç¼“å­˜æ± ä¸­
17             [self.reuserCells addObject:lastCell];
18              
19             // ç§»é™¤çˆ¶æ§ä»¶
20             [lastCell removeFromSuperview];
21              
22         }
23          
24         // åˆ¤æ–­ä¸‹å¯è§cellæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªcellçš„ä¸Šä¸€ä¸ªcellæ˜¾æ²¡æ˜¾ç¤ºåœ¨å±å¹•ä¸Š
25         // è·å–ç¬¬ä¸€ä¸ªcellçš„indexPath
26         NSIndexPath *indexPath = self.visibleIndexPaths[0];
27          
28          
29         // è·å–ä¸‹ä¸€ä¸ªcellçš„indexPath
30         NSIndexPath *preIndexPath = [NSIndexPath indexPathForRow:indexPath.row - 1 inSection:0];
31          
32         // è·å–cellçš„é«˜åº¦
33         if ([self.delegate respondsToSelector:@selector(tableView:heightForRowAtIndexPath:)]) {
34             cellH = [self.delegate tableView:self heightForRowAtIndexPath:preIndexPath];
35         }else{
36             cellH = 44;
37         }
38          
39         // è®¡ç®—ä¸Šä¸€ä¸ªcellçš„yå€¼
40         cellY = firstCellY - cellH;
41          
42          
43         // è®¡ç®—ä¸Šä¸€ä¸ªcellçš„frame
44         CGRect preCellFrame = CGRectMake(cellX, cellY, cellW, cellH);
45          
46         if ([self isInScreen:preCellFrame]) { // å¦‚æœåœ¨å±å¹•ä¸Šï¼Œå°±åŠ è½½
47              
48             // é€šè¿‡æ•°æ®æºè·å–cell
49             UITableViewCell *cell = [self.dataSource tableView:self cellForRowAtIndexPath:preIndexPath];
50              
51             cell.frame = preCellFrame;
52              
53             [self insertSubview:cell atIndex:0];
54              
55             // æ·»åŠ åˆ°cellå¯è§æ•°ç»„ä¸­,è¿™é‡Œåº”è¯¥ç”¨æ’å…¥ï¼Œå› ä¸ºè¿™æ˜¯æœ€ä¸Šé¢ä¸€ä¸ªcell,åº”è¯¥æ’å…¥åˆ°æ•°ç»„ç¬¬0ä¸ª
56             [self.visibleCells insertObject:cell atIndex:0];
57              
58             // æ·»åŠ åˆ°å¯è§çš„indexPathsæ•°ç»„,è¿™é‡Œåº”è¯¥ç”¨æ’å…¥ï¼Œå› ä¸ºè¿™æ˜¯æœ€ä¸Šé¢ä¸€ä¸ªcell,åº”è¯¥æ’å…¥åˆ°æ•°ç»„ç¬¬0ä¸ª
59             [self.visibleIndexPaths insertObject:preIndexPath atIndex:0];
60              
61         }
62          
63     } 
</code></pre>

<ul>
<li>é—®é¢˜1ï¼š</li>
</ul>


<p>åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­æœ€åä¸€ä¸ªcellçš„ä¸‹ä¸€ä¸ªcellæ˜¾æ²¡æ˜¾ç¤ºåœ¨å±å¹•ä¸Š</p>

<p>è¿™é‡Œéœ€è¦è®¡ç®—ä¸‹ä¸€ä¸ªcellçš„frame,frameå°±éœ€è¦è®¡ç®—ä¸‹ä¸€ä¸ªcellçš„yå€¼ï¼Œéœ€è¦è·å–å¯¹åº”çš„cellçš„é«˜åº¦ cellY = lastCellY + cellH</p>

<p>è€Œé«˜åº¦éœ€è¦æ ¹æ®indexPathï¼Œä»æ•°æ®æºè·å–</p>

<ul>
<li>è§£å†³ï¼š</li>
</ul>


<p>å¯ä»¥æä¸ªå­—å…¸è®°å½•æ¯ä¸ªå¯è§cellçš„indexPath,ç„¶åè·å–å¯¹åº”å¯è§çš„indexPathï¼Œå°±èƒ½è·å–ä¸‹ä¸€ä¸ªindexPath.</p>

<pre><code> 1 @interface YZTableView ()
 2  
 3 // å±å¹•å¯è§æ•°ç»„
 4 @property (nonatomic, strong) NSMutableArray *visibleCells;
 5  
 6 // ç¼“å­˜æ± 
 7 @property (nonatomic, strong) NSMutableSet *reuserCells;
 8  
 9  
10 // è®°å½•æ¯ä¸ªå¯è§cellçš„indexPathsçš„é¡ºåº
11 @property (nonatomic, strong) NSMutableDictionary *visibleIndexPaths;
12  
13 @end
14  
15 - (NSMutableDictionary *)visibleIndexPaths
16 {
17     if (_visibleIndexPaths == nil) {
18         _visibleIndexPaths = [NSMutableDictionary dictionary];
19     }
20      
21     return _visibleIndexPaths;
22 } 
</code></pre>

<h5>æ³¨æ„ï¼š</h5>

<p>å½“cellä»ç¼“å­˜æ± ä¸­ç§»é™¤ï¼Œä¸€å®šè¦è®°å¾—ä»å¯è§æ•°ç»„cellä¸­ç§»é™¤ï¼Œè¿˜æœ‰å¯è§cellçš„indexPathä¹Ÿè¦ç§»é™¤.</p>

<pre><code> 1 // åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªcellæœ‰æ²¡æœ‰ç¦»å¼€å±å¹•
 2         if ([self isInScreen:firstCell.frame] == NO) { // å¦‚æœä¸åœ¨å±å¹•
 3             // ä»å¯è§cellæ•°ç»„ç§»é™¤
 4             [self.visibleCells removeObject:firstCell];
 5              
 6             // åˆ é™¤ç¬¬0ä¸ªä»å¯è§çš„indexPath
 7             [self.visibleIndexPaths removeObjectAtIndex:0];
 8              
 9             // æ·»åŠ åˆ°ç¼“å­˜æ± ä¸­
10             [self.reuserCells addObject:firstCell];
11              
12         }
13          
14  // åˆ¤æ–­ä¸‹å½“å‰å¯è§cellæ•°ç»„ä¸­æœ€åä¸€ä¸ªcellæœ‰æ²¡æœ‰ç¦»å¼€å±å¹•
15         if ([self isInScreen:lastCell.frame] == NO) { // å¦‚æœä¸åœ¨å±å¹•
16             // ä»å¯è§cellæ•°ç»„ç§»é™¤
17             [self.visibleCells removeObject:lastCell];
18              
19             // åˆ é™¤æœ€åä¸€ä¸ªå¯è§çš„indexPath
20             [self.visibleIndexPaths removeLastObject];
21              
22             // æ·»åŠ åˆ°ç¼“å­˜æ± ä¸­
23             [self.reuserCells addObject:lastCell];
24              
25         } 
</code></pre>

<h5>7.ç¼“å­˜æ± æ­å»ºï¼Œç¼“å­˜æ± å…¶å®å°±æ˜¯ä¸€ä¸ªNSSeté›†åˆã€‚</h5>

<p>æä¸€ä¸ªNSSeté›†åˆå……å½“ç¼“å­˜æ± .</p>

<p>cellç¦»å¼€å±å¹•ï¼Œæ”¾è¿›ç¼“å­˜æ± </p>

<p>æä¾›ä»ç¼“å­˜æ± è·å–æ–¹æ³•ï¼Œä»ç¼“å­˜æ± ä¸­è·å–cell,è®°ä½è¦ä»NSSeté›†åˆç§»é™¤cell.</p>

<pre><code> 1 @interface YZTableView ()
 2  
 3 // å±å¹•å¯è§æ•°ç»„
 4 @property (nonatomic, strong) NSMutableArray *visibleCells;
 5  
 6 // ç¼“å­˜æ± 
 7 @property (nonatomic, strong) NSMutableSet *reuserCells;
 8  
 9 // è®°å½•æ¯ä¸ªcellçš„yå€¼éƒ½å¯¹åº”ä¸€ä¸ªindexPath
10 @property (nonatomic, strong) NSMutableDictionary *indexPathDict;
11  
12 @end
13 @implementation YZTableView
14 - (NSMutableSet *)reuserCells
15 {
16     if (_reuserCells == nil) {
17         _reuserCells = [NSMutableSet set];
18     }
19     return _reuserCells;
20 }
21  
22 // ä»ç¼“å­˜æ± ä¸­è·å–cell
23 - (id)dequeueReusableCellWithIdentifier:(NSString *)identifier
24 {
25     UITableViewCell *cell = [self.reuserCells anyObject];
26      
27     // èƒ½å–å‡ºcell,å¹¶ä¸”cellçš„æ ‡ç¤ºç¬¦æ­£ç¡®
28     if (cell &amp;&amp; [cell.reuseIdentifier isEqualToString:identifier]) {     
29         // ä»ç¼“å­˜æ± ä¸­è·å–
30         [self.reuserCells removeObject:cell];
31          
32         return cell;
33     }
34     return nil;
35 }
36  
37 @end 
</code></pre>

<h5>8.tableViewç»†èŠ‚å¤„ç†</h5>

<p>åŸå› ï¼šåˆ·æ–°æ–¹æ³•ç»å¸¸è¦è°ƒç”¨</p>

<p>è§£å†³ï¼šæ¯æ¬¡åˆ·æ–°çš„æ—¶å€™ï¼Œå…ˆæŠŠä¹‹å‰è®°å½•çš„å…¨éƒ¨æ¸…ç©º</p>

<pre><code> 1 // åˆ·æ–°tableView
 2 - (void)reloadData
 3 {
 4      
 5     // åˆ·æ–°æ–¹æ³•ç»å¸¸è¦è°ƒç”¨
 6     // æ¯æ¬¡åˆ·æ–°çš„æ—¶å€™ï¼Œå…ˆæŠŠä¹‹å‰è®°å½•çš„å…¨éƒ¨æ¸…ç©º
 7     // æ¸…ç©ºindexPathå­—å…¸
 8     [self.indexPathDict removeAllObjects];
 9     // æ¸…ç©ºå±å¹•å¯è§æ•°ç»„
10     [self.visibleCells removeAllObjects];
11     ...
12 } 
</code></pre>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/03/huan-cun-ji-zhi-shen-jiu/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/12/03/huan-cun-ji-zhi-shen-jiu/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/03/you-xiu-cheng-xu-yuan-shi-zen-yao-xie-zhu-shi-de/">å¤Ÿé€¼æ ¼çš„æ³¨é‡Šä¹ æƒ¯</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>å¤Ÿé€¼æ ¼çš„æ³¨é‡Šä¹ æƒ¯æ€»ç»“</p>

<p>é¦–å…ˆå…³äºæ³¨æ„è¿™é‡Œå°±ä¸è¯´ä»€ä¹ˆVVDocumentäº†ï¼Œæ¥ç‚¹æ–°é²œçš„ï¼</p>

<h6>ä¹Ÿè®¸ä½ ä½¿ç”¨è¿‡#warning è­¦å‘Šæç¤º</h6>

<h6>ä¹Ÿè®¸ä½ ä¹Ÿä½¿ç”¨è¿‡#pragma marksã€‚</h6>

<p>ä½†æ˜¯ä½ è§è¿‡æˆ–è€…ä½¿ç”¨è¿‡ä¸‹é¢è¿™ä¸ªå—ï¼Ÿ</p>

<pre><code>Comments containing:
MARK:
TODO:
FIXME:
!!!:
???:
</code></pre>

<p>æ²¡æœ‰ï¼Œé‚£ä¹ˆä½ å°±å¿«é€Ÿçš„çœ‹çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œéå¸¸å¥½ç”¨ï¼Œä¹Ÿéå¸¸ç®€å•ï¼Œä¸è¿‡å…·ä½“ä½¿ç”¨çœ‹ä¸ªäºº</p>

<p> é¦–å…ˆè¯´ä¸€ä¸‹ä¸‰ä¸ªæœ€å¸¸ç”¨çš„ï¼š</p>

<ul>
<li>1ã€TODO</li>
</ul>


<p> ç­‰å¾…å®ç°çš„åŠŸèƒ½</p>

<ul>
<li>2ã€FIXME</li>
</ul>


<p> éœ€è¦ä¿®æ­£çš„åŠŸèƒ½</p>

<ul>
<li>3ã€ï¼ï¼ï¼</li>
</ul>


<p> éœ€è¦æ”¹è¿›çš„åŠŸèƒ½</p>

<p>å…·ä½“ä½¿ç”¨</p>

<pre><code>// FIXME:sss
/* FIXME: sss */


// MARK:sss
/* MARK:sss */


// !!!:sss
/* !!!: sss */


// ???:sss
/* ???: sss */


// TODO:sss
/* TODO: sss */


// Comments containing: sss
/* Comments containing: sss */
</code></pre>

<p>æ³¨æ„ç©ºæ ¼.</p>

<p> æœ€åä½ ä¼šå‘ç°ä¸‹é¢çš„æ•ˆæœï¼Œè™½ç„¶å’Œ#pragma marksæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯è¿™å°±æ˜¯è£…é€¼åŸå› </p>

<p>å…³äºæœ€åä¸€ä¸ª/<em> Comments containing: sss </em>/ï¼Œç¬”è€…è¿˜æ²¡ç…§å‘å¯¹åº”çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚æœä½ çŸ¥é“å¯ä»¥è”ç³»æˆ‘å“¦ï¼</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/03/you-xiu-cheng-xu-yuan-shi-zen-yao-xie-zhu-shi-de/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/12/03/you-xiu-cheng-xu-yuan-shi-zen-yao-xie-zhu-shi-de/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/03/nian-tie-shen-jiu/">ç²˜è´´æ·±ç©¶</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>åœ¨iOSä¸­ï¼Œå¯ä»¥ä½¿ç”¨å‰ªè´´æ¿å®ç°åº”ç”¨ç¨‹åºä¹‹ä¸­ä»¥åŠåº”ç”¨ç¨‹åºä¹‹é—´å®ç°æ•°æ®çš„å…±äº«ã€‚æ¯”å¦‚ä½ å¯ä»¥ä»iPhone QQå¤åˆ¶ä¸€ä¸ªurlï¼Œç„¶åç²˜è´´åˆ°safariæµè§ˆå™¨ä¸­æŸ¥çœ‹è¿™ä¸ªé“¾æ¥çš„å†…å®¹ã€‚</p>

<h3>ä¸€ã€åœ¨iOSä¸­ä¸‹é¢ä¸‰ä¸ªæ§ä»¶ï¼Œè‡ªèº«å°±æœ‰å¤åˆ¶-ç²˜è´´çš„åŠŸèƒ½ï¼š</h3>

<ul>
<li>1ã€UITextView</li>
<li>2ã€UITextField</li>
<li>3ã€UIWebView</li>
</ul>


<h3>äºŒã€UIKit frameworkæä¾›äº†å‡ ä¸ªç±»å’Œåè®®æ–¹ä¾¿æˆ‘ä»¬åœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­å®ç°å‰ªè´´æ¿çš„åŠŸèƒ½ã€‚</h3>

<ul>
<li>1ã€UIPasteboardï¼šæˆ‘ä»¬å¯ä»¥å‘å…¶ä¸­å†™å…¥æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¯»å–æ•°æ®</li>
<li>2ã€UIMenuControllerï¼šæ˜¾ç¤ºä¸€ä¸ªå¿«æ·èœå•ï¼Œç”¨æ¥å¤åˆ¶ã€å‰ªè´´ã€ç²˜è´´é€‰æ‹©çš„é¡¹ã€‚</li>
<li>3ã€UIResponderä¸­çš„ canPerformAction:withSender:ç”¨äºæ§åˆ¶å“ªäº›å‘½ä»¤æ˜¾ç¤ºåœ¨å¿«æ·èœå•ä¸­ã€‚</li>
<li>4ã€å½“å¿«æ·èœå•ä¸Šçš„å‘½ä»¤ç‚¹å‡»çš„æ—¶å€™ï¼ŒUIResponderStandardEditActionså°†ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>


<h3>ä¸‰ã€ä¸‹é¢è¿™äº›é¡¹èƒ½è¢«æ”¾ç½®åˆ°å‰ªè´´æ¿ä¸­</h3>

<ul>
<li>1ã€UIPasteboardTypeListString â€”  å­—ç¬¦ä¸²æ•°ç»„, åŒ…å«kUTTypeUTF8PlainText</li>
<li>2ã€UIPasteboardTypeListURL â€”   URLæ•°ç»„ï¼ŒåŒ…å«kUTTypeURL</li>
<li>3ã€UIPasteboardTypeListImage â€”   å›¾å½¢æ•°ç»„, åŒ…å«kUTTypePNG å’ŒkUTTypeJPEG</li>
<li>4ã€UIPasteboardTypeListColor â€”   é¢œè‰²æ•°ç»„</li>
</ul>


<h3>å››ã€å‰ªè´´æ¿çš„ç±»å‹åˆ†ä¸ºä¸¤ç§ï¼š</h3>

<p>ç³»ç»Ÿçº§ï¼šä½¿ç”¨UIPasteboardNameGeneralå’ŒUIPasteboardNameFindåˆ›å»ºï¼Œç³»ç»Ÿçº§çš„å‰ªè´´æ¿ï¼Œå½“åº”ç”¨ç¨‹åºå…³é—­ï¼Œæˆ–è€…å¸è½½æ—¶ï¼Œæ•°æ®éƒ½ä¸ä¼šä¸¢å¤±ã€‚
åº”ç”¨ç¨‹åºçº§ï¼šé€šè¿‡è®¾ç½®ï¼Œå¯ä»¥è®©æ•°æ®åœ¨åº”ç”¨ç¨‹åºå…³é—­ä¹‹åä»ç„¶ä¿å­˜åœ¨å‰ªè´´æ¿ä¸­ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºå¸è½½ä¹‹åæ•°æ®å°±ä¼šå¤±å»ã€‚æˆ‘ä»¬å¯ç”¨é€šè¿‡pasteboardWithName:createï¼šæ¥åˆ›å»ºã€‚</p>

<p>äº†è§£è¿™äº›ä¹‹åï¼Œä¸‹é¢é€šè¿‡ä¸€ç³»åˆ—çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å‰ªè´´æ¿ã€‚</p>

<p>ä¾‹å­ï¼š</p>

<h5>1ã€å¤åˆ¶å‰ªè´´æ–‡æœ¬ã€‚</h5>

<pre><code>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥åœ¨tableviewä¸Šæ˜¾ç¤ºä¸€ä¸ªå¿«æ·èœå•ï¼Œä¸Šé¢åªæœ‰å¤åˆ¶æŒ‰é’®ï¼Œå¤åˆ¶tableviewä¸Šçš„æ•°æ®ä¹‹åï¼Œç„¶åç²˜è´´åˆ°titleä¸Šã€‚
</code></pre>

<p>å®šä¹‰ä¸€ä¸ªå•å…ƒæ ¼ç±»CopyTableViewCellï¼Œåœ¨è¿™ä¸ªç±»çš„ä¸Šæ˜¾ç¤ºå¿«æ·èœå•ï¼Œå®ç°å¤åˆ¶åŠŸèƒ½ã€‚</p>

<pre><code>@interface CopyTableViewCell : UITableViewCell {
    id delegate;
}
@property (nonatomic, retain) id delegate;
@end
</code></pre>

<p>å®ç°CopyTableViewCell ï¼š</p>

<pre><code>#import "CopyTableViewCell.h"

@implementation CopyTableViewCell

@synthesize delegate;

- (id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier {
    if ((self = [super initWithStyle:style reuseIdentifier:reuseIdentifier])) {
    }
    return self;
}
- (void)setSelected:(BOOL)selected animated:(BOOL)animated {
    [super setSelected:selected animated:animated];
}
- (void)setHighlighted:(BOOL)highlighted animated:(BOOL)animated {
    [[self delegate] performSelector:@selector(showMenu:)
                          withObject:self afterDelay:0.9f];

    [super setHighlighted:highlighted animated:animated];

}
- (BOOL)canBecomeFirstResponder
{
    return YES;
}
- (BOOL)canPerformAction:(SEL)action withSender:(id)sender{
    if (action == @selector(cut:)){
        return NO;
    }
    else if(action == @selector(copy:)){
        return YES;
    }
    else if(action == @selector(paste:)){
        return NO;
    }
    else if(action == @selector(select:)){
        return NO;
    }
    else if(action == @selector(selectAll:)){
        return NO;
    }
    else
    {
        return [super canPerformAction:action withSender:sender];
    }
}
- (void)copy:(id)sender {
    UIPasteboard *pasteboard = [UIPasteboard generalPasteboard];
    [pasteboard setString:[[self textLabel]text]];
}
- (void)dealloc {
    [super dealloc];
}
@end
</code></pre>

<p>å¤åˆ¶ä»£ç 
å®šä¹‰CopyPasteTextControllerï¼Œå®ç°ç²˜è´´åŠŸèƒ½ã€‚
    @interface CopyPasteTextController : UIViewController<UITableViewDelegate> {
        //ç”¨æ¥æ ‡è¯†æ˜¯å¦æ˜¾ç¤ºå¿«æ·èœå•
        BOOL menuVisible;
        UITableView *tableView;
    }</p>

<pre><code>@property (nonatomic, getter=isMenuVisible) BOOL menuVisible;

@property (nonatomic, retain) IBOutlet UITableView *tableView;
@end
</code></pre>

<p>å®ç°CopyPasteTextController ï¼š</p>

<pre><code>#import "CopyPasteTextController.h"
#import "CopyTableViewCell.h"

@implementation CopyPasteTextController
@synthesize menuVisible,tableView;
- (void)viewDidLoad {
    [super viewDidLoad];
    [self setTitle:@"æ–‡å­—å¤åˆ¶ç²˜è´´"];
    //ç‚¹å‡»è¿™ä¸ªæŒ‰é’®å°†å‰ªè´´æ¿çš„å†…å®¹ç²˜è´´åˆ°titleä¸Š
    UIBarButtonItem *addButton = [[[UIBarButtonItem alloc]
                                      initWithBarButtonSystemItem:UIBarButtonSystemItemRefresh
                                      target:self
                                      action:@selector(readFromPasteboard:)]
                                     autorelease];
    [[self navigationItem] setRightBarButtonItem:addButton];
}


// Customize the number of sections in the table view.
- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    return 1;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return 9;
}

// Customize the appearance of table view cells.
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *CellIdentifier =@"Cell";
    CopyTableViewCell *cell = (CopyTableViewCell *)[tableView
                                                           dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil)
    {
        cell = [[[CopyTableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];
        [cell setDelegate:self];
    }

    // Configure the cell.
    NSString *text = [NSString stringWithFormat:@"Row %d", [indexPath row]];
    [[cell textLabel] setText:text];
    return cell;
}

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    if([self isMenuVisible])
    {
        return;
    }
    [[[self tableView] cellForRowAtIndexPath:indexPath] setSelected:YES
                                                           animated:YES];
}
//æ˜¾ç¤ºèœå•
- (void)showMenu:(id)cell {
    if ([cell isHighlighted]) {
        [cell becomeFirstResponder];

        UIMenuController * menu = [UIMenuController sharedMenuController];
        [menu setTargetRect: [cell frame] inView: [self view]];
        [menu setMenuVisible: YES animated: YES];
    }
}
- (void)readFromPasteboard:(id)sender {
    [self setTitle:[NSString stringWithFormat:@"Pasteboard = %@",
                      [[UIPasteboard generalPasteboard] string]]];
}

- (void)didReceiveMemoryWarning
{
    // Releases the view if it doesn't have a superview.
    [super didReceiveMemoryWarning];

    // Relinquish ownership any cached data, images, etc that aren't in use.
}

- (void)viewDidUnload
{
    [super viewDidUnload];
    [self.tableView release];

    // Relinquish ownership of anything that can be recreated in viewDidLoad or on demand.
    // For example: self.myOutlet = nil;
}
</code></pre>

<p>å¤åˆ¶ä¸€è¡Œæ•°æ®ï¼š
ç‚¹å‡»å³ä¸Šè§’çš„æŒ‰é’®ç²˜è´´ï¼Œå°†æ•°æ®æ˜¾ç¤ºåœ¨titleä¸Šï¼š</p>

<h6>2ã€å›¾ç‰‡å¤åˆ¶ç²˜è´´</h6>

<p>   ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œå°†å›¾ç‰‡å¤åˆ¶å’Œå‰ªè´´åˆ°å¦å¤–ä¸€ä¸ªUIImageViewä¸­é—´ã€‚</p>

<ul>
<li>1ã€åœ¨ç•Œé¢ä¸Šæ”¾ç½®ä¸¤ä¸ªuiimageviewï¼Œä¸€ä¸ªæ˜¯å›¾ç‰‡çš„æ•°æ®æºï¼Œä¸€ä¸ªæ˜¯å°†å›¾ç‰‡ç²˜è´´åˆ°çš„åœ°æ–¹ã€‚CopyPasteImageViewController ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>


<p>@interface CopyPasteImageViewController : UIViewController {
    UIImageView <em>imageView;
    UIImageView </em>pasteView;
    UIImageView <em>selectedView;
}
@property (nonatomic, retain) IBOutlet UIImageView </em>imageView;
@property (nonatomic, retain) IBOutlet UIImageView <em>pasteView;
@property (nonatomic, retain) UIImageView </em>selectedView;
- (void)placeImageOnPasteboard:(id)view;
@end
* 2ã€å½“è§¦æ‘¸å›¾ç‰‡çš„æ—¶å€™æˆ‘ä»¬æ˜¾ç¤ºå¿«æ·èœå•ï¼š</p>

<hr />

<pre><code>- (void)touchesBegan:(NSSet*)touches withEvent:(UIEvent*)event {
    NSSet *copyTouches = [event touchesForView:imageView];
    NSSet *pasteTouches = [event touchesForView:pasteView];

    [self becomeFirstResponder];
    if ([copyTouches count] &gt; 0) {
        [self performSelector:@selector(showMenu:)
                   withObject:imageView afterDelay:0.9f];
    }
    else  if([pasteTouches count] &gt; 0) {
        [self performSelector:@selector(showMenu:)
                   withObject:pasteView afterDelay:0.9f];
    }
    [super touchesBegan:touches withEvent:event];
}

- (void)showMenu:(id)view {
    [self setSelectedView:view];

    UIMenuController * menu = [UIMenuController sharedMenuController];
    [menu setTargetRect: CGRectMake(5, 10, 1, 1) inView: view];
    [menu setMenuVisible: YES animated: YES];
}
</code></pre>

<p>è¿™é‡Œçš„å¿«æ·èœå•ï¼Œæ˜¾ç¤ºä¸‰ä¸ªèœå•é¡¹ï¼šå‰ªè´´ã€ç²˜è´´ã€å¤åˆ¶ï¼š</p>

<hr />

<pre><code>- (BOOL)canPerformAction:(SEL)action withSender:(id)sender{
    if (action == @selector(cut:)) {
        return ([self selectedView] == imageView) ? YES : NO;
    } else if (action == @selector(copy:)) {
        return ([self selectedView] == imageView) ? YES : NO;
    } else if (action == @selector(paste:)) {
        return ([self selectedView] == pasteView) ? YES : NO;
    } else if (action == @selector(select:)) {
        return NO;
    } else if (action == @selector(selectAll:)) {
        return NO;
    } else {
        return [super canPerformAction:action withSender:sender];
    }
}
- (void)cut:(id)sender {
    [self copy:sender];
    [imageView setHidden:YES];
}
- (void)copy:(id)sender {
    [self placeImageOnPasteboard:[self imageView]];
}
- (void)paste:(id)sender {
    UIPasteboard *appPasteBoard =
    [UIPasteboard pasteboardWithName:@"CopyPasteImage" create:YES];
    NSData *data =[appPasteBoard dataForPasteboardType:@"com.marizack.CopyPasteImage.imageView"];
    pasteView.image = [UIImage imageWithData:data];
}
</code></pre>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/03/nian-tie-shen-jiu/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/12/03/nian-tie-shen-jiu/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/02/xiao-chu-jing-gao/">æ¶ˆé™¤è­¦å‘Š</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><h6>å‰è¨€ï¼š</h6>

<p>ç°åœ¨ä½ ç»´æŠ¤çš„é¡¹ç›®æœ‰å¤šå°‘è­¦å‘Šï¼Ÿçœ‹ç€å‡ ç™¾æ¡è­¦å‘Šè§‰å¾—å¿ƒé‡Œçƒ¦ä¹ˆï¼Ÿä½ çœŸçš„è§‰å¾—è­¦å‘Šåˆä¸æ˜¯é”™è¯¯å¯ä»¥å®Œå…¨ä¸ç®¡ä¹ˆï¼Ÿ å¦‚æœä½ ä¹Ÿè¢«è¿™äº›é—®é¢˜å›°æƒ‘ï¼Œå¯ä»¥å’Œæˆ‘ä¸€èµ·è¿›è¡Œä¸‹é¢çš„æ“ä½œã€‚å…¶å®å¤§éƒ¨åˆ†çš„è­¦å‘Šéƒ½æ˜¯å¾ˆå¥½æ”¹çš„ï¼ŒæŠŠè‡ªå·±æ•´ä¸ªé¡¹ç›®çš„è­¦å‘Šæ’¸ä¸€éåº”è¯¥ä¹Ÿå°±è€—è´¹åŠå°æ—¶çš„æ—¶é—´ï¼Œä¸€æ¬¡éº»çƒ¦å¸¦æ¥ä¹‹åçš„æ¸…å‡€è¿™æ ·ä¸å¥½ä¹ˆï¼Ÿ</p>

<p>æœ¬æ–‡åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>

<ul>
<li>1.ç®€å•ç²—æš´çš„æ¶ˆé™¤è­¦å‘Šã€‚</li>
<li>2.è¯¦ç»†ç§‘å­¦çš„æ¶ˆé™¤è­¦å‘Šã€‚ï¼ˆåŒ…æ‹¬è­¦å‘Šæ”¶å½•ï¼‰</li>
<li>3.æ·»åŠ è­¦å‘Šã€‚</li>
</ul>


<h4>ä¸€ã€ç®€å•ç²—æš´çš„æ¶ˆé™¤è­¦å‘Š</h4>

<p>è­¦å‘Šå¦‚æœæ˜¯è‡ªå·±é¡¹ç›®ä¸­çš„è¿˜å¥½ç›´æ¥æ”¹äº†ï¼Œå¦‚æœæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œä½ æ”¹äº†ä¹‹åï¼Œpodä¸‹ä½œè€…æ›´æ–°ä¸€ä¸‹åˆç™½æ”¹äº†ï¼Œæ‰€ä»¥å¯ä»¥ç”¨è¿™ç§ç®€å•ç²—æš´çš„æ–¹æ³•ï¼šç›´æ¥è®©ç¬¬ä¸‰æ–¹åº“çš„è­¦å‘Šä¸æ˜¾ç¤º</p>

<p> å°±æ˜¯åœ¨podfileæ–‡ä»¶é‡Œé¢åŠ ä¸Šä¸€è¡ŒæŒ‡ä»¤ ã€‚
inhibit_all_warnings!
å¦‚æœæŸè­¦å‘Šå®åœ¨æ— æ³•æ¶ˆé™¤ï¼Œä½†æ˜¯åˆä¸æƒ³è®©ä»–æ˜¾ç¤ºï¼Œå¯ä»¥åŠ å…¥é¢„ç¼–è¯‘æŒ‡ä»¤</p>

<p>æ¯”å¦‚æˆ‘å·²ç»çŸ¥é“æŸè¡Œä¼šæŠ¥ä¸Šé¢è­¦å‘Šäº†ï¼Œæˆ‘å°±ç”¨è¿™ä¸ªå®æŠŠè¿™å‡ è¡ŒåŒ…ä½ï¼Œå°±ä¸ä¼šæŠ¥å¼•å·ä¸­-Wunused-variableçš„è­¦å‘Šäº†</p>

<pre><code>#pragma clang diagnostic push
#pragma clang diagnostic ignored"-Wunused-variable" //è¿™é‡Œæ˜¯ä¼šæŠ¥è­¦å‘Šçš„ä»£ç 

#pragma clang diagnostic pop
</code></pre>

<p>è¿™ä¸ª-Wunused-variableä»£è¡¨çš„æ„æ€å°±æ˜¯ æœ‰çš„ä¸œè¥¿ ä½ å®ä¾‹åŒ–äº†ä½†æ˜¯æ²¡æœ‰ä½¿ç”¨ï¼ˆåŒä¸Šé¢ç¬¬å‡ æ¡ï¼‰ã€‚ ä½†æ˜¯å¦‚ä½•å¾—åˆ°ä¸€ä¸ªè­¦å‘Šçš„æ ‡ç¤ºç¬¦ï¼Ÿ</p>

<ol>
<li><p>å¦‚å›¾é€‰æ‹©ä¸€ä¸ªè­¦å‘Šï¼Œç‚¹å‡»å³é”®ï¼Œreveal in log  å°±èƒ½çœ‹åˆ°å³è¾¹æœ‰ä¸ªæ–¹æ‹¬å·[]é‡Œé¢çš„ä¸œè¥¿å°±æ˜¯ è¿™ä¸ªè­¦å‘Šå¯¹åº”çš„æ ‡ç¤ºç¬¦</p></li>
<li><p>å¦‚æœå¸Œæœ›æ•´ä¸ªé¡¹ç›®ä¸­éƒ½å¿½ç•¥ æŸç§å¾ˆæ— èŠçš„è­¦å‘Šï¼Œå°±åœ¨é¡¹ç›®ä¸­Build Settingé‡ŒåŠ ä¸Šè¿™ä¸ªæ ‡ç¤ºç¬¦ï¼Œå¯ä»¥è¿ç€åŠ çš„ã€‚</p></li>
<li><p>å¦‚æœä¸æƒ³æ•´ä¸ªé¡¹ç›®éƒ½å¿½ç•¥ï¼Œåªæƒ³ä¸ªåˆ«æ–‡ä»¶å¿½ç•¥ï¼Œé‚£å°±æ‰¾åˆ°ä¸ªåˆ«æ–‡ä»¶åŠ ä¸Šæ­¤æŒ‡ä»¤ï¼Œè¿™ä¸ªæ“ä½œåº”è¯¥ä½¿ç”¨ç‡ä¸é«˜ï¼ˆä¸€èˆ¬éƒ½æ˜¯å…¨é¡¹ç›®å¿½ç•¥ï¼‰ï¼Œå°±ä¸ä¸Šå›¾äº†ã€‚å»Build Phases é‡Œé¢çš„ Compile Sourcesé‡Œé¢æ”¹ã€‚</p></li>
</ol>


<h4>äºŒã€è¯¦ç»†ç§‘å­¦çš„æ¶ˆé™¤è­¦å‘Š</h4>

<p>å…¶å®ç¬”è€…æœ¬æ„æ˜¯æƒ³æŠŠä¸€äº›ç¬¬ä¸€çœ¼çœ‹ä¸æ‡‚æ¯”è¾ƒå‘çš„è­¦å‘Šæ”¶å½•è¿›æ¥ï¼Œä½†æ˜¯åæ¥å‘ç°é‚£åŸºæœ¬æ²¡å‡ ä¸ªéœ€è¦äº›å†™äº†ï¼Œæ‰€ä»¥å°±é‡‡ç”¨äº†å…¨æ”¶å½•çš„æ–¹æ³•ï¼Œé‡åˆ°çš„å°±è®°å½•ä¸‹ä»¥åä¹Ÿä¼šä¸æ–­æ›´æ–°ã€‚ å¯ä»¥ç›´æ¥æŒ‰command+F åœ¨æœ¬é¡µé¢æœç´¢è­¦å‘Š</p>

<pre><code>Unused variable 'replyURL'
</code></pre>

<h6>1.æ²¡æœ‰ä½¿ç”¨</h6>

<pre><code>Cannot find protocol definition for 'TencentSessionDelegate'
</code></pre>

<h6>2.è¿™ç§æ˜æ˜éƒ½èƒ½è¿è¡Œè¿˜è¯´æˆ‘æ²¡æœ‰å®šä¹‰çš„è­¦å‘Šï¼Œæ˜¯å› ä¸ºä½ è¿™ä¸ªåè®®è™½ç„¶å®šä¹‰äº†ï¼Œä½†æ˜¯ä½ è¿™ä¸ªåè®®å¯èƒ½è¿˜éµå®ˆäº†XXåè®®ï¼Œç„¶åè¿™ä¸ªXXåè®®æ²¡æœ‰å®šä¹‰å¯¼è‡´ä¼šæŠ¥è¿™ç§è­¦å‘Šï¼Œæ‰€ä»¥é‡åˆ°è¿™ç§è­¦å‘Šè¦å¾€â€œçˆ¶åè®®â€æ‰¾ã€‚ ä¸¾ä¸ªæ —å­ï¼Œä¸Šé¢è¿™è¡Œå°±æ˜¯è…¾è®¯æˆæƒçš„åº“é‡Œé¢æŠ¥çš„è­¦å‘Šï¼Œ</h6>

<pre><code>@protocol TencentSessionDelegate
æ­¤åè®®éµå®ˆäº†TencentApiInterfaceDelegateåè®®ï¼Œåœ¨TencentOAuth.hç±»ä¸­#import "TencentApiInterface.h" è­¦å‘Šå¯ç ´


Null passed to a callee that requires a non-null argument
</code></pre>

<h6>3.è¿™ä¸ªè­¦å‘Šæ¯”è¾ƒæ–°ï¼Œæ˜¯xcode6.3å¼€å§‹ ä¸ºäº†è®©OCä¹Ÿèƒ½æœ‰swiftçš„ï¼Ÿå’Œï¼çš„åŠŸèƒ½ï¼Œä½ åœ¨å£°æ˜ä¸€ä¸ªå±æ€§çš„æ—¶å€™åŠ ä¸Š <strong>nullableï¼ˆï¼Ÿå¯ä»¥ä¸ºç©ºï¼‰ä¸</strong>nonnullï¼ˆï¼ä¸èƒ½ä¸ºç©ºï¼‰ å¦‚æœæ”¾åœ¨@propertyé‡Œé¢çš„è¯ä¸ç”¨å†™ä¸‹åˆ’çº¿</h6>

<pre><code>@property (nonatomic, copy, nonnull) NSString * tickets;
@property (nonatomic, copy) NSString * __nonnull tickets;
</code></pre>

<p>æˆ–è€…ç”¨å®NS_ASSUME_NONNULL_BEGINå’ŒNS_ASSUME_NONNULL_END åŒ…ä½å¤šä¸ªå±æ€§å…¨éƒ¨å…·å¤‡nonnullï¼Œç„¶åä»…å¯¹éœ€è¦nullableçš„æ”¹ä¸‹å°±è¡Œï¼Œæœ‰ç‚¹ç±»ä¼¼äºf-no-objc-arcé‚£ç§å…ˆæ•´ä½“ç»™ä¸ªè·¯çº¿åœ¨å•ç‹¬æ”¹ä¸ªåˆ«æ–‡ä»¶çš„æ€æƒ³ã€‚ æ­¤è­¦å‘Šå°±æ˜¯æŸå±æ€§è¯´å¥½çš„ä¸èƒ½ä¸ºç©ºï¼Œä½ åˆåœ¨æŸåœ°æ–¹å†™äº†XX = nil æ‰€ä»¥å†²çªäº†ã€‚</p>

<pre><code>Auto property synthesis will not synthesize property 'privateCacheDirectory'; it will be implemented by its superclass, use @dynamic to acknowledge intention
</code></pre>

<h6>4.ä»–è¯´ä½ çš„çˆ¶ç±»å®ç°äº†setgetæ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä½ ä»€ä¹ˆéƒ½ä¸å†™ï¼Œå°±ä¼šç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå‡ºæœ€ä¸€èˆ¬çš„setgetæ–¹æ³•ï¼Œè¯·ç”¨@dynamic æ¥æ‰¿è®¤çˆ¶ç±»å®ç°çš„è¿™ä¸ªgetsetæ–¹æ³•ã€‚</h6>

<pre><code>Unsupported Configuration: Scene is unreachable due to lack of entry points and does not have an identifier for runtime access via -instantiateViewControllerWithIdentifier:.
</code></pre>

<h6>5.ä¸€èˆ¬æ˜¯storyboardæŠ¥çš„è­¦å‘Šï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ä½ æœ‰çš„é¡µé¢æ²¡æœ‰å’Œç®­å¤´æ‰€æŒ‡çš„æ§åˆ¶å™¨è¿èµ·æ¥ï¼Œå¯¼è‡´æœ€ç»ˆæ”¹é¡µé¢å¯èƒ½æ— æ³•æ˜¾ç¤ºã€‚</h6>

<pre><code>Deprecated: Push segues are deprecated in iOS 8.0 and later
</code></pre>

<h6>6.iOS8ä¹‹åå‘¢ï¼Œä¸è¦å†ç”¨pushæ‹–çº¿äº†ï¼Œç»Ÿä¸€ç”¨showï¼Œä»–ä¼šè‡ªå·±æ ¹æ®ä½ æ˜¯å¦æœ‰å¯¼èˆªæ æ¥åˆ¤æ–­èµ°pushè¿˜æ˜¯èµ°modal</h6>

<pre><code>Unsupported Configuration: Plain Style unsupported in a Navigation Item
</code></pre>

<h6>7.å¯¼èˆªæ çš„item ä¸æ”¯æŒç”¨plain ï¼Œé‚£å°±ç”¨Borderedå‘—ã€‚</h6>

<pre><code>The launch image set "LaunchImage" has 2 unassigned images.
The app icon set "AppIcon" has 2 unassigned images.
</code></pre>

<h6>8.å‡ å¼ å›¾æ ‡è¿˜æ˜¯å¯åŠ¨å›¾æ‰¾ä¸åˆ°è‡ªå·±çš„ä½ç½®ï¼Œå¯èƒ½æ˜¯ä¸€æ¬¡å¯¼å…¥äº†å…¨éƒ¨å°ºå¯¸å›¾ç‰‡ï¼Œä½†æ˜¯å³è¾¹çš„è®¾ç½®åªå‹¾äº†iOS8çš„ é‚£iOS7å°ºå¯¸çš„å›¾æ ‡å°±ä¼šæŠ¥æ­¤è­¦å‘Šã€‚åˆ æ‰ï¼Œæˆ–è€…å¯¹ç…§å³è¾¹åŒ¹é…ã€‚</h6>

<pre><code>'sizeWithFont:constrainedToSize:lineBreakMode:' is deprecated: first deprecated in iOS 7.0 - Use -boundingRectWithSize:options:attributes:context:
</code></pre>

<h6>9.æ–¹æ³•åºŸé™¤ï¼Œæ—§çš„æ–¹æ³•sizeWithFontToSizeåœ¨iOS7åå°±åºŸé™¤äº†å–è€Œä»£ä¹‹æ˜¯boundingRectWithSizeæ–¹æ³•</h6>

<pre><code>Undeclared selector 'historyAction'
</code></pre>

<h6>10.ä½¿ç”¨æœªå£°æ˜çš„æ–¹æ³•ï¼Œä¸€èˆ¬å‡ºç°åœ¨@selector() æ‹¬å·é‡Œå†™äº†ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æˆ–æ–¹æ³•åå†™é”™äº†ã€‚</h6>

<pre><code>PerformSelector may cause a leak because its selector is unknown
</code></pre>

<h6>11.è¿™ä¸ªå’Œä¸Šé¢ç±»ä¼¼å°±æ˜¯ç›´æ¥æŠŠä¸Šé¢é‚£ä¸ª@SELæ‹¿æ¥ç”¨ä¼šæŠ¥è¿™ä¸ªè­¦å‘Š</h6>

<pre><code>'strongify' macro redefined
</code></pre>

<h6>12.è¿™ä¸ªå®å£°æ˜é‡å¤,åˆ ä¸€ä¸ªå§</h6>

<pre><code>'UITextAttributeFont' is deprecated: first deprecated in iOS 7.0 - Use NSFontAttributeName
'UITextAttributeTextColor' is deprecated: first deprecated in iOS 7.0 - Use NSForegroundColorAttributeName
'UITextAttributeTextShadowColor' is deprecated: first deprecated in iOS 7.0 - Use NSShadowAttributeName with an NSShadow instance as the value
</code></pre>

<h6>13.æ–¹æ³•åºŸé™¤,ä¸€èˆ¬ä¸€èµ·å‡ºç°</h6>

<pre><code>Code will never be executed
</code></pre>

<h6>14.ä»–è¯´è¿™ä»£ç æ°¸è¿œä¹Ÿè½®ä¸åˆ°ä»–æ‰§è¡Œï¼Œä¼°è®¡æ˜¯æœ‰å‡ è¡Œä»£ç å†™åœ¨äº†returnä¹‹å</h6>

<pre><code>Assigning to 'id' from incompatible type 'SXTabViewController *const __strong'
</code></pre>

<h6>15.ä¸€èˆ¬å‡ºç°åœ¨xxx.delegate = self ï¼Œåº”è¯¥åœ¨ä¸Šé¢éµå®ˆåè®®</h6>

<pre><code>Format specifies type 'unsigned long' but the argument has type 'unsigned int'
</code></pre>

<h6>16.è¿™ä¸ªè­¦å‘Šä¸€èˆ¬ä¼šå‡ºç°åœ¨NSStringWithFormaté‡Œé¢ å‰é¢%d %lu ä»€ä¹ˆçš„å’Œåé¢å¡«è¿›å»çš„å‚æ•°ä¸åŒ¹é…å°±æŠ¥äº†è­¦å‘Š</h6>

<pre><code>Values of type 'NSInteger' should not be used as format arguments; add an explicit cast to 'long' instead
</code></pre>

<h6>17.ç±»ä¼¼äºä¸Šé¢ï¼Œä¹Ÿæ˜¯formaté‡Œé¢å‰åå†™çš„ä¸åŒ¹é…</h6>

<pre><code>Method 'dealWithURL:andTitle:andKeyword:' in protocol 'SXPostAdDelegate' not implemented
</code></pre>

<h6>18.ç»å…¸è­¦å‘Šï¼Œéµå®ˆäº†åè®®ï¼Œä½†æ˜¯æ²¡æœ‰å®ç°åè®®æ–¹æ³•ã€‚ ä¹Ÿå¯èƒ½ä½ å®ç°äº†åªæ˜¯åˆåŠ äº†ä¸ªå‚æ•°æˆ–æ˜¯ä½ å†™çš„æ–¹æ³•å’Œåè®®æ–¹æ³•åå­—æœ‰ç‚¹è½»å¾®ä¸åŒ</h6>

<pre><code>Using integer absolute value function 'abs' when argument is of floating point type
</code></pre>

<h6>19.è¿™ä¸ªå¯ä»¥è‡ªåŠ¨ä¿®æ­£ï¼Œå°±æ˜¯è¯´absé€‚ç”¨äºæ•´æ•°ç»å¯¹å€¼ï¼Œè¦æ˜¯floatå–ç»å¯¹å€¼è¦ç”¨fabsf</h6>

<pre><code>Attribute Unavailable: Automatic Preferred Max Layout Width is not available on iOS versions prior to 8.0
</code></pre>

<h6>20.æœ‰çš„æ–¹æ³•ä½ ç”¨çš„å¤ªè½åäº†ï¼Œä¹Ÿæœ‰çš„æ–¹æ³•ä½ ç”¨çš„å¤ªè¶…å‰äº†ã€‚ è¯´è¿™ä¸ªæœ€å¤§å®½åº¦åœ¨iOS8ä¹‹å‰çš„ç³»ç»Ÿæ˜¯è¦å‘çš„</h6>

<pre><code>Too many personality routines for compact unwind to encode
</code></pre>

<h6>21.ä½ å¯ä»¥åœ¨otherlink ä¸­åŠ å…¥ -Wl,-no_compact_unwind å»æ‰è¯¥è­¦å‘Šï¼Œæ ¹æ®è‹¹æœçš„è§£é‡Šï¼Œè¿™ä¸ªæ˜¯ç”±äºæŸäº›åœ°æ–¹ c/c++/oc/oc++æ··ç”¨ä¼šé€ æˆç¼–è¯‘è­¦å‘Šã€‚ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆä¼¤å®³ã€‚</h6>

<pre><code>Property 'ssid' requires method 'ssid' to be defined - use @synthesize, @dynamic or provide a method implementation in this class implementation
</code></pre>

<h6>22.è¯´è¿™ä¸ªssidå¿…é¡»è¦å®šä¹‰ä¸ªè¿™ä¸ªå±æ€§çš„getteræ–¹æ³•ï¼Œå¦‚æœè­¦å‘Šæ˜¯setSsidå°±æ˜¯setteræ–¹æ³•ï¼Œ ç”¨@synthesizeå’Œ@dynamic éƒ½è¡Œï¼Œä¸€ä¸ªæ˜¯è®©ç¼–è¯‘å™¨ç”Ÿæˆgetterå’Œsetterï¼Œä¸€ä¸ªæ˜¯è‡ªå·±ç”Ÿæˆï¼Œå¦‚æœä½ æœ‰æ¨¡å‹åˆ†å‘æˆ–kvcä¹‹ç±»çš„ï¼Œé€‰@dynamicå°±è¡Œ</h6>

<pre><code>Unknown escape sequence '\)'
</code></pre>

<h6>23.æœªçŸ¥çš„è½¬ä¹‰åºåˆ—ã€‚ ä¸€èˆ¬æœ‰ä¸ªæ–œæ å†åŠ ä¸ªä¸œè¥¿ä»–éƒ½ä¼šä»¥ä¸ºæ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œä¸€çœ‹\ï¼‰ä¸è®¤è¯†å°±æŠ¥è­¦å‘Šäº†ï¼Œä¸€èˆ¬æ­£åˆ™è¡¨è¾¾å¼å®¹æ˜“æŠ¥è¿™ç§è­¦å‘Š</h6>

<pre><code>Property 'LoginPort' not found on object of type 'LoginLvsTestTask *'; did you mean to access property loginPort?
</code></pre>

<h6>24.è¿™ç§å¯ä»¥ç‚¹å‡»è‡ªåŠ¨ä¿®å¤ï¼Œæ˜¯å…¸å‹çš„å¤§å°å†™å†™é”™äº†ï¼Œä»–æé†’äº†ä¸€ä¸‹ã€‚</h6>

<pre><code>Variable 'type' is used uninitialized whenever switch default is taken
</code></pre>

<h6>25.è¿™æ˜¯å‡ºç°åœ¨switchè¯­å¥ä¸­çš„è­¦å‘Šï¼Œ ä¸€èˆ¬å¯èƒ½æ˜¯switchå¤–é¢å®šä¹‰äº†ä¸ªtypeä½†æ˜¯å¹¶æ²¡æœ‰åˆå§‹åŒ–ï¼ˆåˆå§‹åŒ–æ“ä½œéƒ½å†™åœ¨switchçš„å„ä¸ªåˆ†æ”¯é‡Œï¼‰ï¼Œç„¶ååœ¨æœ€åreturn typeã€‚ ä½†æ˜¯switchçš„æœ‰ä¸ªåˆ†æ”¯æ²¡æœ‰å¯¹typeåˆå§‹åŒ–ï¼Œä»–è¯´å¦‚æœä½ æ¥åˆ°è¿™ä¸ªåˆ†æ”¯çš„è¯ï¼Œé‚£è¿˜æ²¡åˆå§‹åŒ–å°±è¦è¢«returnã€‚</h6>

<h5>ä¸‰ã€æ·»åŠ è­¦å‘Š</h5>

<h6>1.é¦–å…ˆæœ€å¸¸ç”¨çš„å°±æ˜¯ æ™®é€šè­¦å‘Šï¼Œè¿™ä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„äº†</h6>

<pre><code>#warning TODO
</code></pre>

<h6>2.å¦‚æœæ˜¯è‡ªå·±å†™çš„æ–‡ä»¶æˆ–ç¬¬ä¸‰æ–¹åº“ï¼Œæœ‰äº†æ–°çš„æ¥å£ï¼Œç„¶åæç¤ºæ—§çš„æ¥å£åºŸé™¤çš„è¯éœ€è¦åœ¨æ–¹æ³•ååŠ ä¸Šå®NS_DEPRECATED_IOSå’ŒèŒƒå›´</h6>

<pre><code>- (void)addTapAction:(SEL)tapAction target:(id)target NS_DEPRECATED_IOS(2_0, 4_0);
</code></pre>

<h6>3.å¦‚æœéœ€è¦åœ¨æ­¤æ–¹æ³•ååŠ ä¸Šå¸¦ä¿¡æ¯çš„è­¦å‘Šåˆ™éœ€è¦è¿™ä¹ˆå†™</h6>

<pre><code>- (void)addTapAction:(SEL)tapAction target:(id)target __attribute((deprecated("è¿™ä¸ªæ¥å£ä¼šçˆ†å†…å­˜ ä¸å»ºè®®ä½¿ç”¨")));
</code></pre>

<p>æ˜¾ç¤ºçš„æ•ˆæœåƒè¿™æ ·ï¼š</p>
</div>
  
  




| <a href="/blog/2015/12/02/xiao-chu-jing-gao/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/02/quan-ping-fan-hui-(runtime)/">å…¨å±è¿”å›ï¼ˆRuntimeï¼‰</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>å‰è¨€</p>

<p>æ­¤æ¬¡æ–‡ç« ï¼Œè®²è¿°çš„æ˜¯å¯¼èˆªæ§åˆ¶å™¨å…¨å±æ»‘åŠ¨è¿”å›æ•ˆæœï¼Œè€Œä¸”ä»£ç é‡éå¸¸å°‘ï¼Œ10è¡Œå†…æå®šã€‚</p></blockquote>

<p>å¦‚æœå–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œå¯ä»¥å…³æ³¨æˆ‘ï¼Œä¹Ÿå¯ä»¥æ¥å°ç å“¥ï¼Œäº†è§£ä¸‹æˆ‘ä»¬çš„iOSåŸ¹è®­è¯¾ç¨‹ã€‚é™†ç»­è¿˜ä¼šæœ‰æ›´æ–°ing&hellip;.</p>

<h5>ä¸€ã€è‡ªå®šä¹‰å¯¼èˆªæ§åˆ¶å™¨</h5>

<p>ç›®çš„ï¼šä»¥åéœ€è¦ä½¿ç”¨å…¨å±æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œå°±ä½¿ç”¨è‡ªå·±å®šä¹‰çš„å¯¼èˆªæ§åˆ¶å™¨ã€‚</p>

<h5>äºŒã€åˆ†æå¯¼èˆªæ§åˆ¶å™¨ä¾§æ»‘åŠŸèƒ½</h5>

<p>æ•ˆæœï¼šå¯¼èˆªæ§åˆ¶å™¨é»˜è®¤è‡ªå¸¦äº†ä¾§æ»‘åŠŸèƒ½ï¼Œå½“ç”¨æˆ·åœ¨ç•Œé¢çš„å·¦è¾¹æ»‘åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰ä¾§æ»‘åŠŸèƒ½ã€‚</p>

<p>ç³»ç»Ÿè‡ªå¸¦çš„ä¾§æ»‘æ•ˆæœï¼š</p>

<p>åˆ†æï¼š</p>

<ul>
<li><p>1.å¯¼èˆªæ§åˆ¶å™¨çš„viewè‡ªå¸¦äº†æ»‘åŠ¨æ‰‹åŠ¿ï¼Œåªä¸è¿‡æ‰‹åŠ¿çš„è§¦å‘èŒƒå›´åªèƒ½åœ¨å·¦è¾¹ã€‚</p></li>
<li><p>2.å½“ç”¨æˆ·åœ¨ç•Œé¢å·¦è¾¹æ‹–åŠ¨ï¼Œå°±ä¼šè§¦å‘æ»‘åŠ¨æ‰‹åŠ¿æ–¹æ³•ï¼Œå¹¶ä¸”æœ‰æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œè¯´æ˜ç³»ç»Ÿæ‰‹åŠ¿è§¦å‘çš„æ–¹æ³•å·²ç»å®ç°äº†æ»‘åŠ¨è¿”å›åŠŸèƒ½ã€‚</p></li>
<li><p>3.ä¸ºä»€ä¹ˆè¯´ç³»ç»Ÿæ‰‹åŠ¿è§¦å‘çš„æ–¹æ³•å·²ç»å®ç°äº†æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Ÿ</p></li>
</ul>


<h3>åŸå› ï¼š</h3>

<p>åˆ›å»ºæ»‘åŠ¨æ‰‹åŠ¿å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦ç»‘å®šç›‘å¬è€…ï¼Œå½“è§¦å‘æ‰‹åŠ¿çš„æ—¶å€™ä¼šè°ƒç”¨targetçš„actionã€‚</p>

<p>UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] initWithTarget:target action:action];
å½“ç”¨æˆ·åœ¨ç•Œé¢å·¦è¾¹æ»‘åŠ¨ï¼Œæœ‰æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œè¿™æ˜¯å› ä¸ºè§¦å‘æ‰‹åŠ¿äº†ï¼Œè°ƒç”¨targetçš„actionæ–¹æ³•ï¼Œè¯´æ˜actionæ–¹æ³•å†…éƒ¨å®ç°æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œå¦åˆ™å°±ä¸ä¼šæœ‰æ»‘åŠ¨è¿”å›æ•ˆæœã€‚</p>

<h5>ä¸‰ã€å®ç°å…¨å±æ»‘åŠ¨åŠŸèƒ½åˆ†æ</h5>

<p>æ‰“å°å¯¼èˆªæ§åˆ¶å™¨è‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿ï¼Œçœ‹ä¸‹å®ƒçš„çœŸå®é¢ç›®ã€‚</p>

<p>ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿interactivePopGestureRecognizer</p>

<pre><code>//  selfæŒ‡å‘çš„å¯¼èˆªæ§åˆ¶å™¨ï¼Œåœ¨å¯¼èˆªæ§åˆ¶å™¨çš„viewDidLoadæ–¹æ³•æ‰“å° 
- (void)viewDidLoad { 
    [super viewDidLoad]; 
    NSLog(@"%@",self.interactivePopGestureRecognizer); 
} 
</code></pre>

<p>ç”±å›¾ä¸­å¯çŸ¥ï¼š</p>

<ul>
<li><p>1.ç³»ç»Ÿè‡ªå¸¦çš„æ‰‹åŠ¿æ˜¯UIScreenEdgePanGestureRecognizerç±»å‹å¯¹è±¡,å±å¹•è¾¹ç¼˜æ»‘åŠ¨æ‰‹åŠ¿</p></li>
<li><p>2.ç³»ç»Ÿè‡ªå¸¦æ‰‹åŠ¿targetæ˜¯_UINavigationInteractiveTransitionç±»å‹çš„å¯¹è±¡</p></li>
<li><p>3.targetè°ƒç”¨çš„actionæ–¹æ³•åå«handleNavigationTransition:</p></li>
</ul>


<p>åˆ†æï¼š</p>

<p>UIScreenEdgePanGestureRecognizerï¼Œçœ‹åç§°å°±çŸ¥é“ï¼Œè¿™ä¸ªæ‰‹åŠ¿çš„èŒƒå›´åªèƒ½åœ¨å±å¹•çš„å‘¨è¾¹ï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªæ‰‹åŠ¿ï¼Œç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ•ˆæœï¼Œåªèƒ½å®ç°ä¾§è¾¹æ»‘åŠ¨ã€‚</p>

<h5>å››ã€å¦‚ä½•å®ç°å…¨å±æ»‘åŠ¨åŠŸèƒ½</h5>

<p>ç»™è‡ªå·±çš„å¯¼èˆªæ§åˆ¶å™¨ï¼Œæ·»åŠ ä¸€ä¸ªå…¨å±çš„æ»‘åŠ¨æ‰‹åŠ¿ï¼Œè°ƒç”¨ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetçš„actionæ–¹æ³•ï¼Œåˆ©ç”¨ç³»ç»Ÿå®ç°çš„æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼ŒåŠ ä¸Šè‡ªå·±å…¨å±æ»‘åŠ¨æ‰‹åŠ¿ï¼Œå°±æœ‰å…¨å±æ»‘åŠ¨åŠŸèƒ½äº†ã€‚</p>

<p>é—®é¢˜ï¼šå¦‚ä½•æ‹¿åˆ°ç³»ç»Ÿè‡ªå¸¦çš„targetå¯¹è±¡?ï¼Œactionæ–¹æ³•åå·²ç»çŸ¥é“ï¼Œè€Œä¸”ç³»ç»Ÿè‚¯å®šåœ¨targetå¯¹è±¡å®ç°äº†ï¼Œåªè¦æ‹¿åˆ°targetå¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•å°±è¡Œã€‚</p>

<p>é€šè¿‡æ‰“å°ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿çš„ä»£ç†ï¼Œå‘ç°æ­£å¥½æ˜¯_UINavigationInteractiveTransitionå¯¹è±¡ï¼Œå› æ­¤æˆ‘çŒœæµ‹è¿™ä¸ªä»£ç†å¯¹è±¡å°±æ˜¯targetå¯¹è±¡,åªè¦æ‹¿åˆ°å®ƒï¼Œå°±æ‹¿åˆ°ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetå¯¹è±¡ã€‚</p>

<pre><code>// æ‰“å°ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„ä»£ç†å¯¹è±¡ 
SLog(@"%@",self.interactivePopGestureRecognizer.delegate); 
</code></pre>

<p>å¯¼èˆªæ§åˆ¶å™¨å…¨å±æ»‘åŠ¨æ³¨æ„ç‚¹:</p>

<ul>
<li><p>1.ç¦æ­¢ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿ä½¿ç”¨ã€‚</p></li>
<li><p>2.åªæœ‰å¯¼èˆªæ§åˆ¶å™¨çš„éæ ¹æ§åˆ¶å™¨æ‰éœ€è¦è§¦å‘æ‰‹åŠ¿ï¼Œä½¿ç”¨æ‰‹åŠ¿ä»£ç†ï¼Œæ§åˆ¶æ‰‹åŠ¿è§¦å‘ã€‚</p></li>
</ul>


<p>å…¨å±æ»‘åŠ¨ä»£ç å®ç°</p>

<pre><code>- (void)viewDidLoad { 
    [super viewDidLoad]; 
    // è·å–ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetå¯¹è±¡ 
    id target = self.interactivePopGestureRecognizer.delegate; 
    // åˆ›å»ºå…¨å±æ»‘åŠ¨æ‰‹åŠ¿ï¼Œè°ƒç”¨ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetçš„actionæ–¹æ³• 
    UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] initWithTarget:target action:@selector(handleNavigationTransition:)]; 
    // è®¾ç½®æ‰‹åŠ¿ä»£ç†ï¼Œæ‹¦æˆªæ‰‹åŠ¿è§¦å‘ 
    pan.delegate = self; 
    // ç»™å¯¼èˆªæ§åˆ¶å™¨çš„viewæ·»åŠ å…¨å±æ»‘åŠ¨æ‰‹åŠ¿ 
    [self.view addGestureRecognizer:pan]; 
    // ç¦æ­¢ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿ 
    self.interactivePopGestureRecognizer.enabled = NO; 
} 
// ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼šæ¯æ¬¡è§¦å‘æ‰‹åŠ¿ä¹‹å‰éƒ½ä¼šè¯¢é—®ä¸‹ä»£ç†ï¼Œæ˜¯å¦è§¦å‘ã€‚ 
// ä½œç”¨ï¼šæ‹¦æˆªæ‰‹åŠ¿è§¦å‘ 
- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer 
{ 
    // æ³¨æ„ï¼šåªæœ‰éæ ¹æ§åˆ¶å™¨æ‰æœ‰æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œæ ¹æ§åˆ¶å™¨æ²¡æœ‰ã€‚ 
    // åˆ¤æ–­å¯¼èˆªæ§åˆ¶å™¨æ˜¯å¦åªæœ‰ä¸€ä¸ªå­æ§åˆ¶å™¨ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå­æ§åˆ¶å™¨ï¼Œè‚¯å®šæ˜¯æ ¹æ§åˆ¶å™¨ 
    if (self.childViewControllers.count == 1) { 
        // è¡¨ç¤ºç”¨æˆ·åœ¨æ ¹æ§åˆ¶å™¨ç•Œé¢ï¼Œå°±ä¸éœ€è¦è§¦å‘æ»‘åŠ¨æ‰‹åŠ¿ï¼Œ 
        return NO; 
    } 
    return YES; 
} 
</code></pre>
</div>
  
  




| <a href="/blog/2015/12/02/quan-ping-fan-hui-(runtime)/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/åº•å±‚å¼€å‘/'>åº•å±‚å¼€å‘ (2)</a></li>
<li class='category'><a href='/blog/categories/å¼€å‘å·¥å…·/'>å¼€å‘å·¥å…· (1)</a></li>
<li class='category'><a href='/blog/categories/æ€§èƒ½ç›¸å…³/'>æ€§èƒ½ç›¸å…³ (5)</a></li>
<li class='category'><a href='/blog/categories/æ¬¢è¿æ¥åˆ°iosæ¢¦å·¥å‚/'>æ¬¢è¿æ¥åˆ°iosæ¢¦å·¥å‚ (1)</a></li>
<li class='category'><a href='/blog/categories/ç¨‹åºå‘˜å¿…å¤‡/'>ç¨‹åºå‘˜å¿…å¤‡ (1)</a></li>
<li class='category'><a href='/blog/categories/é€‚é…é—®é¢˜/'>é€‚é…é—®é¢˜ (1)</a></li>
<li class='category'><a href='/blog/categories/é¢è¯•æ€»ç»“-æŠ€æœ¯/'>é¢è¯•æ€»ç»“ï¼‹æŠ€æœ¯ (1)</a></li>
<li class='category'><a href='/blog/categories/é¡¹ç›®å®æˆ˜/'>é¡¹ç›®å®æˆ˜ (6)</a></li>
<li class='category'><a href='/blog/categories/é«˜çº§å¼€å‘/'>é«˜çº§å¼€å‘ (6)</a></li>

    </ul>
</section><section>
  <h1>æœ€æ–°æ–‡ç« </h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/12/05/tu-pian-jia-zai-you-hua-shen-jiu/">å›¾ç‰‡åŠ è½½ä¼˜åŒ–æ·±ç©¶</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/05/zhan-zai-afnshang-kan-asi/">ç«™åœ¨AFNä¸Šçœ‹ASI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/04/appqia-dun-liao-zen-yao-ban-%3F/">Appå¡é¡¿äº†æ€ä¹ˆåŠï¼Ÿ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/04/wang-shang-qing-qiu-feng-(feng-)zhuang/">ç½‘ç»œè¯·æ±‚ç–¯ï¼ˆå°ï¼‰è£…</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/04/xu-lie-hua-and-fan-xu-lie-hua-shen-jiu/">åºåˆ—åŒ–&amp;ååºåˆ—åŒ–æ·±ç©¶</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<h1>æ‰«ä¸€æ‰«<abbr title="The word 'æ‰«ä¸€æ‰«' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'æ‰«ä¸€æ‰«', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/index.html"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/index.html" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - iCocos -
<span class="credit">Preview in <a href="http://al1020119.github.io">[æ›¹#é»]</a></span>
</p>

</footer>
  






<!--
--->



</body>
</html>
