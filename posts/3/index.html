
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="H5ç²¾å æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ä¸‹çš„ä¸€ä¸ªåº”ç”¨HTMLæ ‡å‡†è‡ª1999å¹´12æœˆå‘å¸ƒçš„HTML4.01åï¼Œåç»§çš„HTML5å’Œå…¶å®ƒæ ‡å‡†è¢«æŸä¹‹é«˜é˜ï¼Œä¸ºäº†æ¨åŠ¨Webæ ‡å‡†åŒ–è¿åŠ¨çš„å‘å±•ï¼Œä¸€äº›å…¬å¸è”åˆèµ·æ¥ï¼Œæˆç«‹äº†ä¸€ä¸ªå«åš Web Hypertext Application Technology Working Group &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/posts/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script>
function addBlankTargetForLinks () {
    $('a[href^="http"]').each(function(){
                              $(this).attr('target', '_blank');
                              });
}
$(document).bind('DOMNodeInserted', function(event) {
             addBlankTargetForLinks();
             });
</script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">é¦–é¡µ</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/other">å…¶ä»–</a></li>
  <li><a href="/about">å…³äº</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/29/h5chu-tan/">H5åˆæ¢</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><h2>H5ç²¾å</h2>

<blockquote><p>æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ä¸‹çš„ä¸€ä¸ªåº”ç”¨HTMLæ ‡å‡†è‡ª1999å¹´12æœˆå‘å¸ƒçš„HTML4.01åï¼Œåç»§çš„HTML5å’Œå…¶å®ƒæ ‡å‡†è¢«æŸä¹‹é«˜é˜ï¼Œä¸ºäº†æ¨åŠ¨Webæ ‡å‡†åŒ–è¿åŠ¨çš„å‘å±•ï¼Œä¸€äº›å…¬å¸è”åˆèµ·æ¥ï¼Œæˆç«‹äº†ä¸€ä¸ªå«åš Web Hypertext Application Technology Working Group ï¼ˆWebè¶…æ–‡æœ¬åº”ç”¨æŠ€æœ¯å·¥ä½œç»„ -WHATWGï¼‰ çš„ç»„ç»‡ã€‚WHATWG è‡´åŠ›äº Web è¡¨å•å’Œåº”ç”¨ç¨‹åºï¼Œè€ŒW3Cï¼ˆWorld Wide Web Consortiumï¼Œä¸‡ç»´ç½‘è”ç›Ÿï¼‰ ä¸“æ³¨äºXHTML2.0ã€‚åœ¨ 2006 å¹´ï¼ŒåŒæ–¹å†³å®šè¿›è¡Œåˆä½œï¼Œæ¥åˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ HTMLã€‚</p></blockquote>

<h6>1ï¼šé“¾æ¥</h6>

<p>å›¾åƒæ ‡ç­¾</p>

<pre><code>ç›¸å¯¹è·¯å¾„ ../../

ç»å¯¹è·¯å¾„  https:// http://  ftp://  file://
</code></pre>

<ul>
<li><p> href: å¼•ç”¨ ä¸æ˜¯å¿…é¡»çš„</p></li>
<li><p> src: å¼•å…¥  å¿…éœ€çš„</p></li>
</ul>


<hr />

<pre><code>&lt;!--è¶…é“¾æ¥æ ‡ç­¾  javascript:void(0) --&gt;
&lt;a href="#"&gt;æˆ‘æ˜¯è¶…é“¾æ¥&lt;/a&gt;
&lt;a href="http://baidu.com" target="_blank"&gt;ç™¾åº¦ä¸€ä¸‹,ä½ å°±çŸ¥é“&lt;/a&gt;


&lt;img src="https://www.baidu.com/img/bd_logo1.png" alt="ç™¾åº¦logo" width="200"&gt;
&lt;img src="images/img_01.jpg"&gt;
</code></pre>

<h6>2ï¼šåˆ—è¡¨&lt;&ndash;åˆ—è¡¨æ ‡ç­¾&ndash;></h6>

<p>æ— åºï¼š</p>

<pre><code>&lt;ul&gt;
  &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨1&lt;/li&gt;
  &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨2&lt;/li&gt;
  &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨3&lt;/li&gt;
  &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨4&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>æœ‰åºï¼š</p>

<pre><code>&lt;Ol&gt;
    &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨1&lt;/li&gt;
    &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨2&lt;/li&gt;
    &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨3&lt;/li&gt;
    &lt;li&gt;æˆ‘æ˜¯åˆ—è¡¨4&lt;/li&gt;
&lt;/Ol&gt;
</code></pre>

<h6>3:æ–‡ç« ï¼š</h6>

<pre><code>&lt;article&gt;

    &lt;header&gt;

    &lt;/header&gt;

    &lt;section&gt;&lt;/section&gt;

    &lt;section&gt;&lt;/section&gt;

    &lt;footer&gt;

    &lt;/footer&gt;

&lt;/article&gt;
</code></pre>

<h6>4ï¼šé«˜çº§:</h6>

<pre><code>   &lt;!--è¿›åº¦æ¡--&gt;
   &lt;progress max="100" value="50"&gt;&lt;/progress&gt;
   &lt;!--éŸ³é¢‘--&gt;
   &lt;audio src="sources/music.m4a" controls="controls"&gt;&lt;/audio&gt;
   &lt;!--è§†é¢‘--&gt;
   &lt;video src="sources/BigBuck.m4v" controls="controls"&gt;&lt;/video&gt;
</code></pre>

<blockquote><h6>å…¶ä»–è¯·å‚è€ƒç›¸å…³æ–‡æ¡£</h6></blockquote>

<hr />

<h2>CSS3</h2>

<h4>ä¸€:æ ·å¼</h4>

<blockquote><p>CSSå³å±‚å æ ·å¼è¡¨ï¼ˆCascading StyleSheetï¼‰ã€‚ åœ¨ç½‘é¡µåˆ¶ä½œæ—¶é‡‡ç”¨å±‚å æ ·å¼è¡¨æŠ€æœ¯ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å¯¹é¡µé¢çš„å¸ƒå±€ã€å­—ä½“ã€é¢œè‰²ã€èƒŒæ™¯å’Œå…¶å®ƒæ•ˆæœå®ç°æ›´åŠ ç²¾ç¡®çš„æ§åˆ¶ã€‚ åªè¦å¯¹ç›¸åº”çš„ä»£ç åšä¸€äº›ç®€å•çš„ä¿®æ”¹ï¼Œå°±å¯ä»¥æ”¹å˜åŒä¸€é¡µé¢çš„ä¸åŒéƒ¨åˆ†ï¼Œæˆ–è€…é¡µæ•°ä¸åŒçš„ç½‘é¡µçš„å¤–è§‚å’Œæ ¼å¼ã€‚CSS3æ˜¯CSSæŠ€æœ¯çš„å‡çº§ç‰ˆæœ¬ï¼ŒCSS3è¯­è¨€å¼€å‘æ˜¯æœç€æ¨¡å—åŒ–å‘å±•çš„ã€‚ä»¥å‰çš„è§„èŒƒä½œä¸ºä¸€ä¸ªæ¨¡å—å®åœ¨æ˜¯å¤ªåºå¤§è€Œä¸”æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥ï¼ŒæŠŠå®ƒåˆ†è§£ä¸ºä¸€äº›å°çš„æ¨¡å—ï¼Œæ›´å¤šæ–°çš„æ¨¡å—ä¹Ÿè¢«åŠ å…¥è¿›æ¥ã€‚è¿™äº›æ¨¡å—åŒ…æ‹¬ï¼š ç›’å­æ¨¡å‹ã€åˆ—è¡¨æ¨¡å—ã€è¶…é“¾æ¥æ–¹å¼ ã€è¯­è¨€æ¨¡å— ã€èƒŒæ™¯å’Œè¾¹æ¡† ã€æ–‡å­—ç‰¹æ•ˆ ã€å¤šæ å¸ƒå±€ç­‰ã€‚</p></blockquote>

<h6>1.è¡Œå†…ï¼š</h6>

<p>&lt;&ndash;style=&ldquo;background-color: red;&rdquo;&ndash;></p>

<p><--
   å•å€¼å±æ€§: åé¢åªæœ‰ä¸€ä¸ªå±æ€§å€¼
   å¤åˆå±æ€§: åé¢æœ‰å¤šä¸ªå±æ€§å€¼
--></p>

<pre><code>   &lt;div style="color: purple; font-size: 40px; background-color: yellowgreen;"&gt;æˆ‘æ˜¯å®¹å™¨div&lt;/div&gt;
   &lt;p style="color: blue; font-size: 100px; border:3px solid red;"&gt;æˆ‘æ˜¯æ®µè½&lt;/p&gt;
</code></pre>

<h6>2.é¡µå†…ï¼š</h6>

<pre><code>&lt;--
  ç½‘ç«™ = Nä¸ªç½‘é¡µ + æœåŠ¡å™¨ + æ•°æ®åº“ + ....

--&gt;

&lt;!--
  csséµå¾ªçš„è§„å¾‹:
  1&gt; å°±è¿‘åŸåˆ™
  2&gt; å åŠ åŸåˆ™
--&gt;
</code></pre>

<hr />

<pre><code>    &lt;style&gt;
        div{
            color: chartreuse;
            border: 3px dashed blueviolet;
            font-size: 90px;
        }
    &lt;/style&gt; 
&lt;/head&gt;
&lt;body&gt;
  &lt;div&gt;æˆ‘æ˜¯div&lt;/div&gt; 
</code></pre>

<h6>3.å¤–éƒ¨</h6>

<pre><code>    &lt;!--å¼•å…¥--&gt;
    &lt;link href="css/index.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;div&gt;å“ˆå“ˆå“ˆå“ˆå“ˆ&lt;/div&gt;
</code></pre>

<hr />

<pre><code>div{
    color: darkgoldenrod;
    background-color: mediumvioletred;
    font-size: 5px;
}
</code></pre>

<h4>äºŒï¼šé€‰æ‹©å™¨</h4>

<pre><code>    /** æ ‡ç­¾é€‰æ‹©å™¨*/
    div{
        color: red;
    }
    /*ç±»é€‰æ‹©å™¨*/
    .test1{
        color: green;
    }
    /*idé€‰æ‹©å™¨*/
    #main{
        font-size: 90px;
    }
    /*å¹¶åˆ—é€‰æ‹©å™¨*/
    #main,.test1{
        border: 5px double darkviolet;
    }
    /*å¤åˆé€‰æ‹©å™¨*/
    p.test2{
       background-color: red;
    }
    /*åä»£é€‰æ‹©å™¨*/
    #first p a{
        font-size: 90px;
    }
    /*ä¼ªç±»*/
    input:focus{
       width: 500px;
       height: 60px;
       font-size: 55px;
       /*å»é™¤å¤–è¾¹æ¡†*/
       outline: none;
    }

    div#main:hover{
       background-color: yellow;
       width: 500px;
       height: 250px;
    }
    /*ä¼ªå…ƒç´ */
    p:first-letter{
        color: goldenrod;
        font-size: 60px;
    }
</code></pre>

<hr />

<pre><code>   &lt;div id="main"&gt;bjbjwefbjb&lt;/div&gt;
   &lt;div&gt;bjbjwefbjb&lt;/div&gt; 
   &lt;p&gt;æˆ‘æ˜¯æ®µè½&lt;/p&gt; 
   &lt;div class="test1"&gt;bjbjwefbjb&lt;/div&gt;
   &lt;div id="first"&gt;
       &lt;p&gt;
           &lt;a href="#"&gt;æˆ‘æ˜¯è¶…é“¾æ¥&lt;/a&gt;
       &lt;/p&gt;
   &lt;/div&gt;
</code></pre>

<h4>ä¸‰ï¼šä¼˜å…ˆçº§ï¼š</h4>

<pre><code>    &lt;--
      CSSéµå¾ªçš„è§„å¾‹:
      1.ç›¸åŒçº§åˆ«çš„é€‰æ‹©å™¨: a.å°±è¿‘åŸåˆ™  b.å åŠ åŸåˆ™
      2.ä¸åŒé€‰æ‹©å™¨:
        important &gt; å†…è” &gt; id &gt; ç±» &gt; æ ‡ç­¾ | ä¼ªç±» | å±æ€§é€‰æ‹© &gt; ä¼ªå…ƒç´  &gt; é€šé…ç¬¦ &gt; ç»§æ‰¿
      3. é€‰æ‹©å™¨çš„é’ˆå¯¹æ€§è¶Šå¼ºï¼Œå®ƒçš„ä¼˜å…ˆçº§å°±è¶Šé«˜
    --&gt;
</code></pre>

<blockquote><h6>å…¶ä»–è¯·å‚è€ƒç›¸å…³æ–‡æ¡£</h6></blockquote>

<hr />

<h2>ç¼–å†™ JScript</h2>

<blockquote><p>ä¸å…¶ä»–è®¸å¤šç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œ Microsoft JScript æ˜¯ç”¨æ–‡æœ¬æ–¹å¼ç¼–å†™çš„ï¼Œå¹¶è¢«ç»„ç»‡æˆä¸ºè¯­å¥ã€ç”±ç›¸å…³çš„è¯­å¥é›†ç»„æˆçš„å—ã€ä»¥åŠæ³¨é‡Šã€‚åœ¨ä¸€æ¡è¯­å¥å†…å¯ä»¥ä½¿ç”¨å˜é‡ã€æ¯”å¦‚å­—ç¬¦ä¸²å’Œæ•°å­—ï¼ˆç§°ä¸ºâ€œæ–‡å­—â€ï¼‰çš„ç«‹å³æ•°ã€ä»¥åŠè¡¨è¾¾å¼ã€‚</p></blockquote>

<h5>ä¸€ï¼šè¯­å¥</h5>

<p>JScript ç¨‹åºæ˜¯è¯­å¥çš„é›†åˆã€‚ä¸€æ¡ Jscript è¯­å¥ç›¸å½“äºè‹±è¯­ä¸­çš„ä¸€ä¸ªå®Œæ•´å¥ã€‚Jscript è¯­å¥å°†è¡¨è¾¾å¼ç»„åˆèµ·æ¥ï¼Œå®Œæˆä¸€ä¸ªä»»åŠ¡ã€‚</p>

<p>ä¸€æ¡è¯­å¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼ã€å…³é”®å­—æˆ–è€…è¿ç®—ç¬¦ï¼ˆç¬¦å·ï¼‰ç»„æˆã€‚å…¸å‹åœ°ï¼Œä¸€æ¡è¯­å¥å†™ä¸€è¡Œï¼Œå°½ç®¡ä¸€æ¡è¯­å¥å¯ä»¥è¶…è¿‡ä¸¤è¡Œæˆ–æ›´å¤šè¡Œã€‚ä¸¤æ¡æˆ–æ›´å¤šæ¡è¯­å¥ä¹Ÿå¯ä»¥å†™åœ¨åŒä¸€è¡Œä¸Šï¼Œè¯­å¥ä¹‹é—´ç”¨åˆ†å·â€œ;â€éš”å¼€ã€‚é€šå¸¸ï¼Œæ¯ä¸€æ–°è¡Œå¼€å§‹ä¸€æ¡æ–°è¯­å¥ã€‚ä¸è¿‡æ˜¾å¼åœ°ç»ˆæ­¢è¯­å¥æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚è¿™æ˜¯ç”¨åˆ†å· (;)æ¥å®ç°çš„ï¼Œåˆ†å·æ˜¯ JScript è¯­å¥çš„ç»ˆæ­¢å­—ç¬¦ã€‚ä¸‹é¢ç»™å‡º Jscript è¯­å¥çš„ä¸¤éš”ç¤ºä¾‹ã€‚</p>

<pre><code>aBird = "Robin"; //å°†æ–‡æœ¬â€œRobinâ€èµ‹å€¼ç»™å˜é‡ aBird
var today = new Date(); // å°†ä»Šå¤©çš„æ—¥æœŸèµ‹å€¼ç»™å˜é‡ today
</code></pre>

<p>ç”¨å¤§æ‹¬å·ï¼ˆ{}ï¼‰æ‹¬èµ·æ¥çš„ä¸€ç»„ JScript è¯­å¥ç§°ä¸ºä¸€ä¸ªè¯­å¥å—ã€‚åˆ†ç»„åˆ°ä¸€ä¸ªè¯­å¥å—ä¸­çš„è¯­å¥é€šå¸¸å¯å½“ä½œå•æ¡è¯­å¥å¤„ç†ã€‚è¿™å°±æ˜¯è¯´åœ¨ JScript æœŸæœ›æœ‰ä¸€æ¡å•ä¸ªè¯­å¥çš„å¤§å¤šæ•°åœ°æ–¹å¯ä»¥ä½¿ç”¨è¯­å¥å—ã€‚åº”è¯¥æ³¨æ„ä»¥ for å’Œ while æ‰“å¤´çš„å¾ªç¯è¯­å¥æ˜¯ä¾‹å¤–æƒ…å†µã€‚æ³¨æ„ï¼Œè¯­å¥å—ä¸­çš„åŸå§‹è¯­å¥ä»¥åˆ†å·ç»“æŸï¼Œä½†è¯­å¥å—æœ¬èº«å¹¶ä¸ä»¥åˆ†å·ç»“æŸã€‚</p>

<p>é€šå¸¸ï¼Œåœ¨å‡½æ•°å’Œæ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨è¯­å¥å—ã€‚</p>

<blockquote><p>æ³¨æ„ï¼ŒJscript ä¸ C++ ä»¥åŠå…¶ä»–æŸäº›è¯­è¨€ä¸åŒï¼Œå®ƒä¸è®¤ä¸ºè¯­å¥å—æ˜¯ä¸€ä¸ªæ–°çš„èŒƒå›´ï¼›åªæœ‰å‡½æ•°åˆ›å»ºæ–°èŒƒå›´ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€æ¡è¯­å¥å¼€å§‹å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åŒ…å«ä¸€ä¸ªäº”æ¡è¯­å¥ç»„æˆçš„è¯­å¥å—ã€‚è¯­å¥å—åçš„ä¸‰æ¡è¯­å¥æ²¡æœ‰ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥ï¼›è¿™äº›è¯­å¥ä¸æ˜¯ä¸€ä¸ªè¯­å¥å—ï¼Œæ‰€ä»¥å°±ä¸æ˜¯å‡½æ•°å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote>

<pre><code>function convert(inches)  {
   feet = inches / 12;  //  è¿™äº”æ¡è¯­å¥å±äºä¸€ä¸ªè¯­å¥å—ã€‚
   miles = feet / 5280;
   nauticalMiles = feet / 6080;
   cm = inches * 2.54;
   meters = inches / 39.37;
}
km = meters / 1000;  //  è¿™ä¸‰æ¡è¯­å¥ä¸åœ¨è¯­å¥å—å†…ã€‚
kradius = km;
mradius = miles;
</code></pre>

<h5>äºŒï¼šæ³¨é‡Š</h5>

<p>å•è¡Œçš„ JScript æ³¨é‡Šä»¥ä¸€å¯¹æ­£æ–œæ (//)å¼€å§‹ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªå•è¡Œæ³¨é‡Šçš„ç¤ºä¾‹ã€‚</p>

<pre><code>aGoodIdea = "Comment your code thoroughly.";  //  è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Šã€‚
</code></pre>

<p>å¤šè¡Œæ³¨é‡Šä»¥ä¸€ä¸ªæ­£æ–œæ åŠ ä¸€ä¸ªæ˜Ÿå·çš„ç»„åˆ(/<em>)å¼€å§‹,å¹¶ä»¥å…¶é€†å‘é¡ºåº (</em>/)ç»“æŸã€‚</p>

<pre><code>/*
è¿™æ˜¯ä¸€ä¸ªç”¨æ¥è§£é‡Šå‰é¢çš„ä»£ç è¯­å¥çš„å¤šè¡Œæ³¨é‡Šã€‚

è¯¥è¯­å¥å°†ä¸€ä¸ªå€¼èµ‹ç»™ aGoodIdea å˜é‡ã€‚
ç”¨å¼•å·åŒ…å«çš„è¿™ç§å€¼ç§°ä¸ºä¸€ä¸ªæ–‡å­—ã€‚
æ–‡å­—æ˜¾å¼å¹¶ç›´æ¥åŒ…å«ä¿¡æ¯ï¼›
è€Œä¸æ˜¯ç®€æ¥åœ°å¼•ç”¨ä¿¡æ¯ã€‚
ï¼ˆå¼•å·ä¸å±äºè¯¥æ–‡å­—çš„å†…å®¹ã€‚ï¼‰
*/
</code></pre>

<blockquote><p>æ³¨æ„   å¦‚æœæ‚¨è¯•å›¾å°†ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šæ’å…¥åˆ°å¦ä¸€ä¸ªä¸­ï¼ŒJScript ä¸èƒ½æŒ‰æ­£å¸¸çš„æ–¹å¼è§£é‡Šç”Ÿæˆçš„å¤šè¡Œæ³¨é‡Šã€‚æ ‡æ˜åµŒå…¥çš„å¤šè¡Œæ³¨é‡Šç»“æŸçš„ */ è¢«è®¤ä¸ºæ˜¯æ•´ä¸ªå¤šè¡Œæ³¨é‡Šçš„ç»“å°¾ã€‚è¿™å°±æ„å‘³ç€åµŒå…¥å¤šè¡Œæ³¨é‡Šä¹‹åçš„æ–‡æœ¬ä¸å†è¢«è®¤ä¸ºæ˜¯æ³¨é‡Šï¼›ç›¸åº”åœ°ï¼Œå®ƒå°†è¢«è§£é‡Šä¸º JScript ä»£ç ï¼Œå¹¶ä¼šäº§ç”Ÿè¯­æ³•é”™è¯¯ã€‚</p></blockquote>

<p>å»ºè®®å°†æ‰€æœ‰çš„æ³¨é‡Šå†™ä¸ºå•è¡Œæ³¨é‡Šçš„è¯­å¥å—ã€‚è¿™æ ·æ‚¨ä»¥åå°±èƒ½å¤Ÿå°†å¤§æ®µçš„ä»£ç ä¸å¤šè¡Œæ³¨é‡ŠåŒºåˆ†å¼€ã€‚</p>

<pre><code>//è¿™æ˜¯å¦ä¸€ç§å¤šè¡Œæ³¨é‡Šï¼Œå†™æˆä¸€ç³»åˆ—å•è¡Œæ³¨é‡Šã€‚

//  åœ¨æ‰§è¡Œå®Œè¯¥è¯­å¥åï¼Œå¯ä»¥ä½¿ç”¨ aGoodIdea å˜é‡çš„åå­—æ¥å¼•ç”¨å…¶å†…å®¹ï¼Œ
//  å¦‚ä¸‹ä¸€æ¡è¯­å¥é‚£æ ·ï¼Œå³é‡‡ç”¨è¿æ¥æ“ä½œå°†å­—ç¬¦ä¸²æ–‡å­—æ·»åŠ åˆ°
//  aGoodIdea å˜é‡ï¼Œä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡ã€‚

var extendedIdea = aGoodIdea + " You never know when you'll have to figure out what it does.";
</code></pre>

<p>èµ‹å€¼å’Œç›¸ç­‰</p>

<p>JScript è¯­å¥ä¸­ä½¿ç”¨ç­‰å· (=)ç»™å˜é‡èµ‹å€¼ï¼šç­‰å·æ˜¯èµ‹å€¼è¿ç®—ç¬¦ã€‚= è¿ç®—ç¬¦å·¦è¾¹çš„æ“ä½œé¡¹æ€»æ˜¯ä¸€ä¸ª Lvalueã€‚Lvalue å¯ä»¥æ˜¯ï¼š</p>

<h5>ä¸‰ï¼šå˜é‡ï¼Œ</h5>

<p>æ•°ç»„å…ƒç´ ï¼Œ
å¯¹è±¡å±æ€§ã€‚
= è¿ç®—ç¬¦å³è¾¹çš„æ“ä½œé¡¹æ€»æ˜¯ä¸€ä¸ª Rvalueã€‚Rvalues å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ä¸€ä¸ªä»»æ„å€¼ï¼ŒåŒ…æ‹¬è¡¨è¾¾å¼çš„å€¼ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ª JScript èµ‹å€¼è¯­å¥çš„ç¤ºä¾‹ã€‚</p>

<pre><code>anInteger = 3;
</code></pre>

<p>Jscript ç¼–è¯‘å™¨è§£é‡Šæœ¬è¯­å¥çš„æ„ä¹‰ä¸ºï¼šâ€œå°† 3 èµ‹ç»™å˜é‡ anIntegerâ€æˆ–â€œanInteger çš„å€¼ä¸º 3â€ã€‚</p>

<p>ç¡®å®šæ‚¨ç†è§£äº† = è¿ç®—ç¬¦ï¼ˆèµ‹å€¼ï¼‰å’Œ == è¿ç®—ç¬¦ï¼ˆç›¸ç­‰ï¼‰çš„å·®å¼‚ã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œåº”ä½¿ç”¨ä¸¤ä¸ªç­‰äºå· (==)ã€‚è¿™äº›å†…å®¹å°†åœ¨ æ§åˆ¶ç¨‹åºçš„æµç¨‹ ä¸­è¯¦ç»†ä»‹ç»ã€‚</p>

<h5>å››ï¼šè¡¨è¾¾å¼</h5>

<p>JScript è¡¨è¾¾å¼æ˜¯æŒ‡ JScript è§£é‡Šå™¨èƒ½å¤Ÿè®¡ç®—ç”Ÿæˆå€¼çš„ JScript â€œçŸ­è¯­â€ã€‚è¿™ä¸ªå€¼å¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„ JScript ç±»å‹ â€” æ•°å­—ã€å­—ç¬¦ä¸²ã€å¯¹è±¡ï¼Œç­‰ç­‰ã€‚æœ€ç®€å•çš„è¡¨è¾¾å¼æ˜¯æ–‡å­—ã€‚ä¸‹é¢ç»™å‡º JScript æ–‡å­—è¡¨è¾¾å¼çš„ä¸€äº›ç¤ºä¾‹ã€‚</p>

<pre><code>3.9                       // æ•°å­—æ–‡å­—
"Hello!"                  // å­—ç¬¦ä¸²æ–‡å­—
false                     // å¸ƒå°”æ–‡å­—
null                      // æ–‡å­—ç©ºå€¼
{x:1, y:2}                // å¯¹è±¡æ–‡å­—
[1,2,3]                   // æ•°ç»„æ–‡å­—
function(x){return x*x;}  // å‡½æ•°æ–‡å­—
</code></pre>

<p>æ›´å¤šå¤æ‚çš„è¡¨è¾¾å¼ä¸­åŒ…å«å˜é‡ã€å‡½æ•°ã€å‡½æ•°è°ƒç”¨ä»¥åŠå…¶ä»–è¡¨è¾¾å¼ã€‚å¯ä»¥ç”¨è¿ç®—ç¬¦å°†è¡¨è¾¾å¼ç»„åˆï¼Œåˆ›å»ºå¤åˆè¡¨è¾¾å¼ã€‚è¿ç®—ç¬¦å¯ä»¥æ˜¯ï¼š</p>

<pre><code>+  // åŠ æ³•
-  // å‡æ³•
*  // ä¹˜æ³•
/  // é™¤æ³•
</code></pre>

<p>ä¸‹é¢ç»™å‡º JScript å¤åˆè¡¨è¾¾å¼çš„ä¸€äº›ç¤ºä¾‹ã€‚</p>

<pre><code>var anExpression = 3 * (4 / 5) + 6;
var aSecondExpression = Math.PI * radius * radius;
var aThirdExpression = aSecondExpression + "%" + anExpression;
var aFourthExpression = "(" + aSecondExpression + ") % (" + anExpression + ")";
</code></pre>

<blockquote><h6>å…¶ä»–è¯·å‚è€ƒç›¸å…³æ–‡æ¡£</h6></blockquote>
</div>
  
  




| <a href="/blog/2015/11/29/h5chu-tan/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/29/zi-ding-yi-xiang-ce-shan-chu-fu-huo-de-shi-xian/">è‡ªå®šä¹‰ç›¸å†Œåˆ é™¤å¤æ´»çš„å®ç°</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>åœ¨è¿™é‡Œï¼ˆ<a href="http://www.cnblogs.com/iCocos/p/4705585.html">http://www.cnblogs.com/iCocos/p/4705585.html</a>ï¼‰æˆ‘ä»¬æåˆ°äº†ã€‚</p>

<ul>
<li>ç®€å•çš„å®ç°äº†è·å–ç³»ç»Ÿç›¸å†Œå›¾ç‰‡å¹¶ä¸”ä¿å­˜å›¾ç‰‡åˆ°ç³»ç»Ÿç›¸å†Œ</li>
<li>å®šä¹‰è‡ªå®šä¹‰çš„ç›¸å†Œï¼Œå¹¶ä¸”ä¿å­˜åˆ°è‡ªå®šä¹‰ç›¸å†Œ</li>
</ul>


<p>è¿™é‡Œä¹…ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­å®ç°ä¸€ä¸ªä¸Šé¢çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ·»åŠ ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½å®ç°
Appä¸­è‡ªå®šä¹‰çš„ç›¸å†Œå‘—åˆ é™¤ä¹‹åå†æ¬¡ä¿å­˜ç›¸ç‰‡æ— æ³•æˆåŠŸ</p>

<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„åº“ï¼šALAssetsLibrary</p>

<p>å…ˆæ¥çœ‹çœ‹å’±ä»¬å–å¾—ç›¸å†Œä¸­çš„ç›¸ç‰‡</p>

<pre><code>- (void)getAllPhotos
{
    ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];
    // éå†æ‰€æœ‰çš„æ–‡ä»¶å¤¹, ä¸€ä¸ªALAssetsGroupå¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶å¤¹
    [library enumerateGroupsWithTypes:ALAssetsGroupAll usingBlock:^(ALAssetsGroup *group, BOOL *stop) {
        // éå†æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰å¤šåª’ä½“æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€è§†é¢‘ï¼‰, ä¸€ä¸ªALAssetå¯¹è±¡å°±ä»£è¡¨ä¸€å¼ å›¾ç‰‡
        [group enumerateAssetsUsingBlock:^(ALAsset *result, NSUInteger index, BOOL *stop) {
            // ç¼©ç•¥å›¾
            XMGLog(@"%@", [UIImage imageWithCGImage:result.thumbnail]);
            // è·å¾—åŸå§‹å›¾ç‰‡
            //            XMGLog(@"%@", [UIImage imageWithCGImage:result.defaultRepresentation.fullResolutionImage]);
        }];

   } failureBlock:nil];
}
</code></pre>

<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ä»£ç å…·ä½“çš„å®ç°</p>

<p>ä¸€ï¼šé¦–å…ˆå®šä¹‰ä¸€ä¸ªå±æ€§æ¶Œæ¥è®°å½•å¹¶ä¸”å®ç°å…¶ä»–ä¸€äº›åŠŸèƒ½</p>

<pre><code> /** ç›¸å†Œåº“ */
@property (nonatomic, strong) ALAssetsLibrary *library;
</code></pre>

<p>äºŒï¼šç„¶åå°±æ‡’åŠ è½½è¿™ä¸ªå±æ€§</p>

<pre><code>- (ALAssetsLibrary *)library
{
    if (!_library) {
        _library = [[ALAssetsLibrary alloc] init];
    }
    return _library;
}
</code></pre>

<p>ä¸‰ï¼šç‚¹å‡»ä¿å­˜æŒ‰é’®çš„å®ç°</p>

<pre><code>- (IBAction)save
{
// è·å¾—æ–‡ä»¶å¤¹çš„åå­—
__block NSString *groupName = [self groupName];

// selfçš„å¼±å¼•ç”¨
XMGWeakSelf;

// å›¾ç‰‡åº“
__weak ALAssetsLibrary *weakLibrary = self.library;

// åˆ›å»ºæ–‡ä»¶å¤¹
[weakLibrary addAssetsGroupAlbumWithName:groupName resultBlock:^(ALAssetsGroup *group) {
    if (group) { // æ–°åˆ›å»ºçš„æ–‡ä»¶å¤¹
        // æ·»åŠ å›¾ç‰‡åˆ°æ–‡ä»¶å¤¹ä¸­
        [weakSelf addImageToGroup:group];
    } else { // æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨
        [weakLibrary enumerateGroupsWithTypes:ALAssetsGroupAll usingBlock:^(ALAssetsGroup *group, BOOL *stop) {
            NSString *name = [group valueForProperty:ALAssetsGroupPropertyName];
            if ([name isEqualToString:groupName]) { // æ˜¯è‡ªå·±åˆ›å»ºçš„æ–‡ä»¶å¤¹
                // æ·»åŠ å›¾ç‰‡åˆ°æ–‡ä»¶å¤¹ä¸­

                [weakSelf addImageToGroup:group];

                *stop = YES; // åœæ­¢éå†
            } else if ([name isEqualToString:@"Camera Roll"]) {
                // æ–‡ä»¶å¤¹è¢«ç”¨æˆ·å¼ºåˆ¶åˆ é™¤äº†
                groupName = [groupName stringByAppendingString:@" "];
                // å­˜å‚¨æ–°çš„åå­—
                [[NSUserDefaults standardUserDefaults] setObject:groupName forKey:XMGGroupNameKey];
                [[NSUserDefaults standardUserDefaults] synchronize];
                // åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹
                [weakLibrary addAssetsGroupAlbumWithName:groupName resultBlock:^(ALAssetsGroup *group) {
                    // æ·»åŠ å›¾ç‰‡åˆ°æ–‡ä»¶å¤¹ä¸­
                    [weakSelf addImageToGroup:group];
                } failureBlock:nil];
            }
        } failureBlock:nil];
    }

    } failureBlock:nil];
    }
</code></pre>

<p>å››ï¼šæ·»åŠ å›¾ç‰‡</p>

<pre><code>/**
 * æ·»åŠ ä¸€å¼ å›¾ç‰‡åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸­
 */
- (void)addImageToGroup:(ALAssetsGroup *)group
{
__weak ALAssetsLibrary *weakLibrary = self.library;
// éœ€è¦ä¿å­˜çš„å›¾ç‰‡

CGImageRef image = self.imageView.image.CGImage;

// æ·»åŠ å›¾ç‰‡åˆ°ã€ç›¸æœºèƒ¶å·ã€‘
[weakLibrary writeImageToSavedPhotosAlbum:image metadata:nil completionBlock:^(NSURL *assetURL, NSError *error) {
    [weakLibrary assetForURL:assetURL resultBlock:^(ALAsset *asset) {
        // æ·»åŠ ä¸€å¼ å›¾ç‰‡åˆ°è‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹ä¸­
        [group addAsset:asset];
        [SVProgressHUD showSuccessWithStatus:@"ä¿å­˜æˆåŠŸ!"];
    } failureBlock:nil];
}];
}
</code></pre>

<p>äº”ï¼šå…³äºæ²™æ²³ä¸­çš„ç»„å</p>

<p>å…ˆå®šä¹‰ä¸€ä¸ªç”¨äºä¿å­˜åå­—ç”¨çš„keyå’Œä¸€ä¸ªéœ€è¦ä¿å­˜çš„åå­—</p>

<pre><code>static NSString * const iCocosGroupNameKey = @"iCocosGroupNameKey";
static NSString * const iCocosDefaultGroupName = @"iCocos";
</code></pre>

<p>å®ç°ç¥–åçš„å­˜å–</p>

<pre><code>- (NSString *)groupName
{
    // å…ˆä»æ²™ç›’ä¸­å–å¾—åå­—

    NSString *groupName = [[NSUserDefaults standardUserDefaults] stringForKey:XMGGroupNameKey];
    if (groupName == nil) { // æ²™ç›’ä¸­æ²¡æœ‰å­˜å‚¨ä»»ä½•æ–‡ä»¶å¤¹çš„åå­—
   groupName = XMGDefaultGroupName;

    // å­˜å‚¨åå­—åˆ°æ²™ç›’ä¸­
    [[NSUserDefaults standardUserDefaults] setObject:groupName forKey:XMGGroupNameKey];
 [[NSUserDefaults standardUserDefaults] synchronize];
}
return groupName;
}
</code></pre>
</div>
  
  




| <a href="/blog/2015/11/29/zi-ding-yi-xiang-ce-shan-chu-fu-huo-de-shi-xian/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/28/qu-xiao-tableviewde-headeryu-footerde-nian-xing-xiao-guo/">å–æ¶ˆTableViewçš„Headerä¸Footerçš„é»æ€§æ•ˆæœ</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>å¼•è¨€ï¼š</p>

<p>æœ€è¿‘åšä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªbugé—®é¢˜ï¼Œæˆ–è€…è¯´ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œæƒ³äº†å¾ˆä¹…æ²¡æœ‰æƒ³åˆ°æœ€å¥½çš„æ–¹æ³•å»ç°å®ã€‚</p>

<h6>é‚£ä¹ˆæ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</h6>

<p>é¦–å…ˆå½“æˆ‘åœ¨tabelViewä¸­ä¸ºæ²¡é¥¿è¿‡sectionè®¾ç½®ä¸€ä¸ªheaderå’Œfooterä¹‹åï¼Œæ»‘åŠ¨tableViewçš„æ—¶å€™ï¼Œå‘ç°headerå’Œfooterå¹¶ä¸éšç€tableViewä¸­çš„cellä¸€èµ·æ»šåŠ¨ï¼Œè€Œä¸”ä¼šåœ¨é¡¶éƒ¨æ´»ç€åº•éƒ¨åœç•™ä¸€æ®µæ—¶é—´ï¼Œè¿™æ ·çš„æ•ˆæœè™½ç„¶å¥½ï¼Œä½†æ˜¯ä¸Šé¢å°±æ˜¯ä¸éœ€è¦è€…ä¹Ÿçš„åŠŸèƒ½ï¼Œæ‰€ä»¥åªå¥½è‡ªå·±æƒ³åŠæ³•è§£å†³ã€‚</p>

<p>æˆ‘è®°å¾—æœ‰æ—¶å€™headeræ˜¯ä¸ä¼šåœé¡¿çš„ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæ—¶å€™headerå’Œfooteréƒ½éšè—å‘¢ï¼Ÿ</p>

<p>åæ¥å‘ç°åŸæ¥è®¾ç½®tableView.tableHeaderView = ?æˆ–è€…footerViewçš„æ—¶å€™å°±ä¸ä¼šåœé¡¿ï¼Œé‚£æ˜¯å½“ç„¶ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯tableViewçš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯sectionçš„ä¸€éƒ¨åˆ†ã€‚</p>

<p>ä¹Ÿåœ¨ç½‘ä¸Šæ‰¾äº†ä¸€æ®µè¿™æ ·çš„ä»£ç </p>

<h3>å»æ‰UItableview headerviewé»æ€§(sticky)</h3>

<pre><code>- (void)scrollViewDidScroll:(UIScrollView *)scrollView {

if (scrollView == self.tableView)

{

        CGFloat sectionHeaderHeight = 64; //sectionHeaderHeight

        if (scrollView.contentOffset.y &lt;= sectionHeaderHeight &amp;&amp; scrollView.contentOffset.y &gt;= 0) {

            scrollView.contentInset = UIEdgeInsetsMake(-scrollView.contentOffset.y, 0, 0, 0);

        } else if (scrollView.contentOffset.y &gt;= sectionHeaderHeight) {

            scrollView.contentInset = UIEdgeInsetsMake(-sectionHeaderHeight, 0, 0, 0);

        }

    }

}
</code></pre>

<p>ä½†æ˜¯ä»–èŒèƒ½è®¾ç½®headerViewä¸èƒ½è®¾ç½®footerViewï¼Œè‡ªå·±ä¹Ÿè¯•ç€å»è¡¥å……footerViewçš„å®ç°ï¼Œä½†æ˜¯å‘ç°æŠ€æœ¯æœ‰é™ï¼Œæ‰€ä»¥ï¼Œä½ æ‡‚çš„ï¼</p>

<h3>æœ€åçœ‹åˆ°å›½å¤–ä¸€ä½å¤§ç¥å†™çš„ä¸€ä¸€ç¯‡æ–‡ç« æ‰¾åˆ°äº†ä¸‹é¢çš„ä»£ç </h3>

<pre><code> -(void)scrollViewDidScroll:(UIScrollView *)scrollView {

    if (scrollView == self.tableView)

        {

        UITableView *tableview = (UITableView *)scrollView;

        CGFloat sectionHeaderHeight = 64;

        CGFloat sectionFooterHeight = 120;

        CGFloat offsetY = tableview.contentOffset.y;

        if (offsetY &gt;= 0 &amp;&amp; offsetY &lt;= sectionHeaderHeight)

        {

            tableview.contentInset = UIEdgeInsetsMake(-offsetY, 0, -sectionFooterHeight, 0);

        }else if (offsetY &gt;= sectionHeaderHeight &amp;&amp; offsetY &lt;= tableview.contentSize.height - tableview.frame.size.height - sectionFooterHeight)

        {

            tableview.contentInset = UIEdgeInsetsMake(-sectionHeaderHeight, 0, -sectionFooterHeight, 0);

        }else if (offsetY &gt;= tableview.contentSize.height - tableview.frame.size.height - sectionFooterHeight &amp;&amp; offsetY &lt;= tableview.contentSize.height - tableview.frame.size.height)         {

            tableview.contentInset = UIEdgeInsetsMake(-offsetY, 0, -(tableview.contentSize.height - tableview.frame.size.height - sectionFooterHeight), 0);

        }

    }

}
</code></pre>

<p>æ³¨ï¼šsectionHeaderHeightå’ŒsectionFooterHeightæ ¹æ®é¡¹ç›®è¿›è¡Œè®¾ç½®ã€‚</p>

<p>å‘ç°åŸºæœ¬ä¸Šæå®šï¼Œæœ€ååªéœ€è¦è®¾ç½®å¯¹åº”çš„å†…è¾¹è·å³å¯ï¼</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/11/28/qu-xiao-tableviewde-headeryu-footerde-nian-xing-xiao-guo/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/11/28/qu-xiao-tableviewde-headeryu-footerde-nian-xing-xiao-guo/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/25/wang-shang-qing-qiu-feng-(feng-)zhuang/">ç½‘ç»œè¯·æ±‚ç–¯ï¼ˆå°ï¼‰è£…</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>ä¸€ç›´æƒ³æ€»ç»“ä¸€ä¸‹å…³äºiOSçš„ç¦»çº¿æ•°æ®ç¼“å­˜çš„æ–¹é¢çš„é—®é¢˜ï¼Œç„¶åæœ€è¿‘ä¹Ÿç®€å•çš„å¯¹AFNè¿›è¡Œäº†å†æ¬¡å°è£…ï¼Œæ‰€æœ‰æƒ³æŠŠè¿™ä¸¤ä¸ªç»“åˆèµ·æ¥å†™ä¸€ä¸‹ã€‚æ•°æ®å±•ç¤ºå‹çš„é¡µé¢åšç¦»çº¿ç¼“å­˜å¯ä»¥æœ‰æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œç”¨æˆ·åœ¨ç¦»çº¿ç¯å¢ƒä¸‹ä»ç„¶å¯ä»¥è·å–ä¸€äº›æ•°æ®ï¼Œè¿™é‡Œçš„æ•°æ®ç¼“å­˜é¦–é€‰è‚¯å®šæ˜¯SQLiteï¼Œè½»é‡çº§ï¼Œå¯¹æ•°æ®çš„å­˜å‚¨è¯»å–ç›¸å¯¹äºå…¶ä»–å‡ ç§æ–¹å¼æœ‰ä¼˜åŠ¿ï¼Œè¿™é‡Œå¯¹AFNçš„å°è£…æ²¡æœ‰æ¶‰åŠå¤ªå¤šä¸šåŠ¡é€»è¾‘å±‚é¢çš„éœ€æ±‚ï¼Œä¸»è¦è¿˜æ˜¯å¯¹ä¸€äº›æ–¹æ³•å†æ¬¡å°è£…æ–¹ä¾¿ä½¿ç”¨ï¼Œè§£é™¤é¡¹ç›®å¯¹ç¬¬ä¸‰æ–¹çš„è€¦åˆæ€§ï¼Œèƒ½å¤Ÿç®€å•çš„å¿«é€Ÿçš„æ›´æ¢åº•å±‚ä½¿ç”¨çš„ç½‘ç»œè¯·æ±‚ä»£ç ã€‚è¿™ç¯‡ä¸»è¦å†™ç¦»çº¿ç¼“å­˜æ€è·¯ï¼Œå¯¹AFNçš„å°è£…åªåšç®€å•çš„ä»‹ç»ã€‚</p>

<p>å…³äºXLNetworkApi</p>

<p>XLNetworkApiçš„ä¸€äº›åŠŸèƒ½å’Œè¯´æ˜ï¼š</p>

<p>ä½¿ç”¨XLNetworkRequeståšä¸€äº›GETã€POSTã€PUTã€DELETEè¯·æ±‚ï¼Œä¸ä¸šåŠ¡é€»è¾‘å¯¹æ¥éƒ¨åˆ†ç›´æ¥ä»¥æ•°ç»„æˆ–è€…å­—å…¸çš„å½¢å¼è¿”å›ã€‚
ä»¥åŠç½‘ç»œä¸‹è½½ã€ä¸Šä¼ æ–‡ä»¶ï¼Œä»¥blockçš„å½¢å¼è¿”å›å®æ—¶çš„ä¸‹è½½ã€ä¸Šä¼ è¿›åº¦ï¼Œä¸Šä¼ æ–‡ä»¶å‚æ•°é€šè¿‡æ¨¡å‹XLFileConfigå»å­˜å–ã€‚
é€šè¿‡ç»§æ‰¿äºXLDataServiceæ¥å°†ä¸€äº›æ•°æ®å¤„ç†ï¼Œæ¨¡å‹è½¬åŒ–å°è£…èµ·æ¥ï¼Œäºä¸šåŠ¡é€»è¾‘å¯¹æ¥è¿”å›çš„æ˜¯å¯¹åº”çš„æ¨¡å‹ï¼Œå‡å°‘Controllorå¤„ç†æ•°æ®å¤„ç†é€»è¾‘çš„å‹åŠ›ã€‚
è‡ªå®šä¹‰ä¸€äº›å›è°ƒçš„block</p>

<pre><code>/**
è¯·æ±‚æˆåŠŸblock
*/
typedef void (^requestSuccessBlock)(id responseObj);
/**
è¯·æ±‚å¤±è´¥block
*/
typedef void (^requestFailureBlock) (NSError *error);
/**
è¯·æ±‚å“åº”block
*/
typedef void (^responseBlock)(id dataObj, NSError *error);
/**
ç›‘å¬è¿›åº¦å“åº”block
*/
typedef void (^progressBlock)(int64_t bytesWritten, int64_t totalBytesWritten, int64_t totalBytesExpectedToWrite);
XLNetworkRequest.méƒ¨åˆ†å®ç°
#import "XLNetworkRequest.h"
#import "AFNetworking.h"
@implementation XLNetworkRequest
+ (void)getRequest:(NSString *)url params:(NSDictionary *)params success:(requestSuccessBlock)successHandler failure:(requestFailureBlock)failureHandler {
//ç½‘ç»œä¸å¯ç”¨
  if (![self checkNetworkStatus]) {
      successHandler(nil);
      failureHandler(nil);
      return;
  }
  AFHTTPRequestOperationManager *manager = [self getRequstManager];
  [manager GET:url parameters:params success:^(AFHTTPRequestOperation * _Nonnull operation, id  _Nonnull responseObject) {
      successHandler(responseObject);
  } failure:^(AFHTTPRequestOperation * _Nullable operation, NSError * _Nonnull error) {
      XLLog(@"------è¯·æ±‚å¤±è´¥-------%@",error);
      failureHandler(error);
  }];
}
</code></pre>

<p>ä¸‹è½½éƒ¨åˆ†ä»£ç </p>

<pre><code>    //ä¸‹è½½æ–‡ä»¶ï¼Œç›‘å¬ä¸‹è½½è¿›åº¦
    + (void)downloadRequest:(NSString *)url successAndProgress:(progressBlock)progressHandler complete:(responseBlock)completionHandler {
      if (![self checkNetworkStatus]) {
          progressHandler(0, 0, 0);
          completionHandler(nil, nil);
          return;
      }
      NSURLSessionConfiguration *sessionConfiguration = [NSURLSessionConfiguration defaultSessionConfiguration];
      AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:sessionConfiguration];
      NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];
      NSProgress *kProgress = nil;
      NSURLSessionDownloadTask *downloadTask = [manager downloadTaskWithRequest:request progress:&amp;kProgress destination:^NSURL * _Nonnull(NSURL * _Nonnull targetPath, NSURLResponse * _Nonnull response) {
          NSURL *documentUrl = [[NSFileManager defaultManager] URLForDirectory :NSDocumentDirectory inDomain:NSUserDomainMask appropriateForURL:nil create:NO error:nil];
          return [documentUrl URLByAppendingPathComponent:[response suggestedFilename]];
      } completionHandler:^(NSURLResponse * _Nonnull response, NSURL * _Nonnull filePath, NSError * _Nonnull error){
          if (error) {
              XLLog(@"------ä¸‹è½½å¤±è´¥-------%@",error);
          }
          completionHandler(response, error);
      }];
      [manager setDownloadTaskDidWriteDataBlock:^(NSURLSession * _Nonnull session, NSURLSessionDownloadTask * _Nonnull downloadTask, int64_t bytesWritten, int64_t totalBytesWritten, int64_t totalBytesExpectedToWrite) {
          progressHandler(bytesWritten, totalBytesWritten, totalBytesExpectedToWrite);
      }];
      [downloadTask resume];
    }
</code></pre>

<p>ä¸Šä¼ éƒ¨åˆ†ä»£ç </p>

<pre><code>//ä¸Šä¼ æ–‡ä»¶ï¼Œç›‘å¬ä¸Šä¼ è¿›åº¦
+ (void)updateRequest:(NSString *)url params:(NSDictionary *)params fileConfig:(XLFileConfig *)fileConfig successAndProgress:(progressBlock)progressHandler complete:(responseBlock)completionHandler {
  if (![self checkNetworkStatus]) {
      progressHandler(0, 0, 0);
      completionHandler(nil, nil);
      return;
  }
  NSMutableURLRequest *request = [[AFHTTPRequestSerializer serializer] multipartFormRequestWithMethod:@"POST" URLString:url parameters:params constructingBodyWithBlock:^(id  _Nonnull formData) {
      [formData appendPartWithFileData:fileConfig.fileData name:fileConfig.name fileName:fileConfig.fileName mimeType:fileConfig.mimeType];
  } error:nil];
  //è·å–ä¸Šä¼ è¿›åº¦
  AFHTTPRequestOperation *operation = [[AFHTTPRequestOperation alloc] initWithRequest:request];
  [operation setUploadProgressBlock:^(NSUInteger bytesWritten, long long totalBytesWritten, long long totalBytesExpectedToWrite) {
      progressHandler(bytesWritten, totalBytesWritten, totalBytesExpectedToWrite);
  }];
  [operation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation * _Nonnull operation, id  _Nonnull responseObject) {
      completionHandler(responseObject, nil);
  } failure:^(AFHTTPRequestOperation * _Nonnull operation, NSError * _Nonnull error) {
      completionHandler(nil, error);
      if (error) {
          XLLog(@"------ä¸Šä¼ å¤±è´¥-------%@",error);
      }
  }];
  [operation start];
}
</code></pre>

<p>XLDataService.méƒ¨åˆ†å®ç°</p>

<pre><code>+ (void)getWithUrl:(NSString *)url param:(id)param modelClass:(Class)modelClass responseBlock:(responseBlock)responseDataBlock {
      [XLNetworkRequest getRequest:url params:param success:^(id responseObj) {
      //æ•°ç»„ã€å­—å…¸è½¬åŒ–ä¸ºæ¨¡å‹æ•°ç»„
      dataObj = [self modelTransformationWithResponseObj:responseObj modelClass:modelClass];
      responseDataBlock(dataObj, nil);
  } failure:^(NSError *error) {
      responseDataBlock(nil, error);
  }];
}
</code></pre>

<p>ï¼ˆå…³é”®ï¼‰ä¸‹é¢è¿™ä¸ªæ–¹æ³•æä¾›ç»™ç»§æ‰¿XLDataServiceçš„å­ç±»é‡å†™ï¼Œå°†è½¬åŒ–ä¸ºæ¨¡å‹çš„ä»£ç å†™åœ¨è¿™é‡Œï¼Œç›¸ä¼¼ä¸šåŠ¡çš„ç½‘ç»œæ•°æ®è¯·æ±‚éƒ½å¯ä»¥ç”¨è¿™ä¸ªå­ç±»å»è¯·æ±‚æ•°æ®ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„æ¨¡å‹æ•°ç»„ã€‚
    /<em>*
    æ•°ç»„ã€å­—å…¸è½¬åŒ–ä¸ºæ¨¡å‹
    </em>/
    + (id)modelTransformationWithResponseObj:(id)responseObj modelClass:(Class)modelClass {
         return nil;
    }
å…³äºç¦»çº¿æ•°æ®ç¼“å­˜</p>

<p>å½“ç”¨æˆ·è¿›å…¥ç¨‹åºçš„å±•ç¤ºé¡µé¢ï¼Œæœ‰ä¸‰ä¸ªæƒ…å†µä¸‹å¯èƒ½æ¶‰åŠåˆ°æ•°æ®åº“å­˜å–æ“ä½œï¼Œç®€å•ç”»äº†ä¸ªå›¾æ¥ç†è§£ï¼Œæ€è·¯æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ä¸€äº›å­˜å–çš„ç»†èŠ‚å¤„ç†ã€‚</p>

<p>è¿›å…¥å±•ç¤ºé¡µé¢</p>

<p><img src="/images/net001.png" title="Caption" ></p>

<p>ä¸‹æ‹‰åˆ·æ–°æœ€æ–°æ•°æ®</p>

<p><img src="/images/net002.png" title="Caption" ></p>

<p>ä¸Šæ‹‰åŠ è½½æ›´å¤šæ•°æ®</p>

<p><img src="/images/net003.png" title="Caption" ></p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ—¶å€™ï¼Œæ¯æ¬¡ä»æ•°æ®åº“è¿”å›ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨åŠ è½½ï¼Œå¦åˆ™ä¼šæœ‰å†…å­˜é—®é¢˜ï¼Œç›´åˆ°æ•°æ®åº“ä¸­æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶å†å‘ç”Ÿç½‘ç»œè¯·æ±‚ï¼Œå†æ¬¡å°†æ–°æ•°æ®å­˜å…¥æ•°æ®åº“ã€‚è¿™é‡Œå­˜å‚¨æ•°æ®çš„æ–¹å¼æ˜¯å°†æœåŠ¡å™¨è¿”å›æ¯ç»„æ•°æ®çš„å­—å…¸å½’æ¡£æˆäºŒè¿›åˆ¶ä½œä¸ºæ•°æ®åº“å­—æ®µç›´æ¥å­˜å‚¨ï¼Œè¿™æ ·å­˜å‚¨åœ¨æ¨¡å‹å±æ€§æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹æ›´æœ‰å¥½å¤„ï¼Œé¿å…æ¯ä¸€ä¸ªå±æ€§ä½œä¸ºä¸€ä¸ªå­—æ®µï¼Œå¦å¤–å¢åŠ äº†ä¸€ä¸ªidStrå­—æ®µç”¨æ¥åˆ¤æ–­æ•°æ®çš„å”¯ä¸€æ€§ï¼Œé¿å…é‡å¤å­˜å‚¨ã€‚
é¦–å…ˆå®šä¹‰ä¸€ä¸ªå·¥å…·ç±»XLDataBaseæ¥åšæ•°æ®åº“ç›¸å…³çš„æ“ä½œï¼Œè¿™é‡Œç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹çš„FMDBã€‚</p>

<pre><code>#import "XLDataBase.h"
#import "FMDatabase.h"
#import "Item.h"
#import "MJExtension.h"
@implementation XLDataBase
static FMDatabase *_db;
+ (void)initialize {
    NSString *path = [NSString stringWithFormat:@"%@/Library/Caches/Data.db",NSHomeDirectory()];
    _db = [FMDatabase databaseWithPath:path];
    [_db open];
    [_db executeUpdate:@"CREATE TABLE IF NOT EXISTS t_item (id integer PRIMARY KEY, itemDict blob NOT NULL, idStr text NOT NULL)"];
}
//å­˜å…¥æ•°æ®åº“
+ (void)saveItemDict:(NSDictionary *)itemDict {
    //æ­¤å¤„æŠŠå­—å…¸å½’æ¡£æˆäºŒè¿›åˆ¶æ•°æ®ç›´æ¥å­˜å…¥æ•°æ®åº“ï¼Œé¿å…æ·»åŠ è¿‡å¤šçš„æ•°æ®åº“å­—æ®µ
    NSData *dictData = [NSKeyedArchiver archivedDataWithRootObject:itemDict];
    [_db executeUpdateWithFormat:@"INSERT INTO t_item (itemDict, idStr) VALUES (%@, %@)",dictData, itemDict[@"id"]];
}
//è¿”å›å…¨éƒ¨æ•°æ®
+ (NSArray *)list {
    FMResultSet *set = [_db executeQuery:@"SELECT * FROM t_item"];
    NSMutableArray *list = [NSMutableArray array];
    while (set.next) {
        // è·å¾—å½“å‰æ‰€æŒ‡å‘çš„æ•°æ®
        NSData *dictData = [set objectForColumnName:@"itemDict"];
        NSDictionary *dict = [NSKeyedUnarchiver unarchiveObjectWithData:dictData];
        [list addObject:[Item mj_objectWithKeyValues:dict]];
    }
    return list;
}
//å–å‡ºæŸä¸ªèŒƒå›´å†…çš„æ•°æ®
+ (NSArray *)listWithRange:(NSRange)range {
    NSString *SQL = [NSString stringWithFormat:@"SELECT * FROM t_item LIMIT %lu, %lu",range.location, range.length];
    FMResultSet *set = [_db executeQuery:SQL];
    NSMutableArray *list = [NSMutableArray array];
    while (set.next) {
        NSData *dictData = [set objectForColumnName:@"itemDict"];
        NSDictionary *dict = [NSKeyedUnarchiver unarchiveObjectWithData:dictData];
        [list addObject:[Item mj_objectWithKeyValues:dict]];
    }
    return list;
}
//é€šè¿‡ä¸€ç»„æ•°æ®çš„å”¯ä¸€æ ‡è¯†åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨
+ (BOOL)isExistWithId:(NSString *)idStr
{
    BOOL isExist = NO;
    FMResultSet *resultSet= [_db executeQuery:@"SELECT * FROM t_item where idStr = ?",idStr];
    while ([resultSet next]) {
        if([resultSet stringForColumn:@"idStr"]) {
            isExist = YES;
        }else{
            isExist = NO;
        }
    }
    return isExist;
}
@end
</code></pre>

<p>ä¸€äº›ç»§æ‰¿äºXLDataServiceçš„å­ç±»çš„æ•°æ®åº“å­˜å‚¨å’Œæ¨¡å‹è½¬æ¢çš„é€»è¾‘ä»£ç </p>

<pre><code>#import "GetTableViewData.h"
#import "XLDataBase.h"
@implementation GetTableViewData
//é‡å†™çˆ¶ç±»æ–¹æ³•
+ (id)modelTransformationWithResponseObj:(id)responseObj modelClass:(Class)modelClass {
    NSArray *lists = responseObj[@"data"][@"list"];
    NSMutableArray *array = [NSMutableArray array];
    for (NSDictionary *dict in lists) {
        [modelClass mj_setupReplacedKeyFromPropertyName:^NSDictionary *{
            return @{ @"ID" : @"id" };
        }];
        [array addObject:[modelClass mj_objectWithKeyValues:dict]];
        //é€šè¿‡idStrå…ˆåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜å‚¨è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç½‘ç»œè¯·æ±‚æ–°æ•°æ®å­˜å…¥æ•°æ®åº“
        if (![XLDataBase isExistWithId:dict[@"id"]]) {
            //å­˜æ•°æ®åº“
            NSLog(@"å­˜å…¥æ•°æ®åº“");
            [XLDataBase saveItemDict:dict];
        }
    }
    return array;
}
</code></pre>

<p>ä¸‹é¢æ˜¯ä¸€äº›æ§åˆ¶å™¨çš„ä»£ç å®ç°ï¼š</p>

<pre><code>#import "ViewController.h"
#import "GetTableViewData.h"
#import "Item.h"
#import "XLDataBase.h"
#import "ItemCell.h"
#import "MJRefresh.h"
#define URL_TABLEVIEW @"https://api.108tian.com/mobile/v3/EventList?cityId=1&amp;step=10&amp;theme=0&amp;page=%lu"
@interface ViewController () {
    NSMutableArray *_dataArray;
    UITableView *_tableView;
    NSInteger _currentPage;//å½“å‰æ•°æ®å¯¹åº”çš„page
}
@end
@implementation ViewController
#pragma mark Life cycle
- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    [self createTableView];
    _dataArray = [NSMutableArray array];
}
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    NSRange range = NSMakeRange(0, 10);
    //å¦‚æœæ•°æ®åº“æœ‰æ•°æ®åˆ™è¯»å–ï¼Œä¸å‘é€ç½‘ç»œè¯·æ±‚
    if ([[XLDataBase listWithRange:range] count]) {
        [_dataArray addObjectsFromArray:[XLDataBase listWithRange:range]];
        NSLog(@"ä»æ•°æ®åº“åŠ è½½");
    }else{
        [self getTableViewDataWithPage:0];
    }
}
#pragma mark UI
- (void)createTableView {
    _tableView = [[UITableView alloc] initWithFrame:self.view.bounds];
    _tableView.delegate = self;
    _tableView.dataSource = self;
    _tableView.rowHeight = 100.0;
    [self.view addSubview:_tableView];
    _tableView.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{
        [self loadNewData];
    }];
    _tableView.mj_footer = [MJRefreshAutoNormalFooter footerWithRefreshingBlock:^{
        [self loadMoreData];
    }];
}
#pragma mark GetDataSoure
- (void)getTableViewDataWithPage:(NSInteger)page {
    NSLog(@"å‘é€ç½‘ç»œè¯·æ±‚ï¼");
    NSString *url = [NSString stringWithFormat:URL_TABLEVIEW, page];
    [GetTableViewData getWithUrl:url param:nil modelClass:[Item class] responseBlock:^(id dataObj, NSError *error) {
        [_dataArray addObjectsFromArray:dataObj];
        [_tableView reloadData];
        [_tableView.mj_header endRefreshing];
        [_tableView.mj_footer endRefreshing];
    }];
}
- (void)loadNewData {
    NSLog(@"ä¸‹æ‹‰åˆ·æ–°");
    _currentPage = 0;
    [_dataArray removeAllObjects];
    [self getTableViewDataWithPage:_currentPage];
}
- (void)loadMoreData {
    NSLog(@"ä¸Šæ‹‰åŠ è½½");
    _currentPage ++;
    NSRange range = NSMakeRange(_currentPage * 10, 10);
    if ([[XLDataBase listWithRange:range] count]) {
        [_dataArray addObjectsFromArray:[XLDataBase listWithRange:range]];
        [_tableView reloadData];
        [_tableView.mj_footer endRefreshing];
        NSLog(@"æ•°æ®åº“åŠ è½½%luæ¡æ›´å¤šæ•°æ®",[[XLDataBase listWithRange:range] count]);
    }else{
        //æ•°æ®åº“æ²¡æ›´å¤šæ•°æ®æ—¶å†ç½‘ç»œè¯·æ±‚
        [self getTableViewDataWithPage:_currentPage];
    }
}
#pragma mark UITableViewDataSource
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return _dataArray.count;
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    ItemCell *cell = [ItemCell itemCellWithTableView:tableView];
    cell.item = _dataArray[indexPath.row];
    return cell;
}
@end
</code></pre>

<p>æœ€åé™„ä¸Šä»£ç çš„ä¸‹è½½åœ°å€ï¼Œé‡è¦çš„éƒ¨åˆ†ä»£ç ä¸­éƒ½æœ‰ç›¸åº”çš„æ³¨é‡Šå’Œæ–‡å­—æ‰“å°ï¼Œè¿è¡Œç¨‹åºå¯ä»¥å¾ˆç›´è§‚çš„è¡¨ç°ã€‚</p>

<p><a href="https://github.com/ShelinShelin/OffLineCache.git">Demo</a></p>

<p>å¸Œæœ›å¤§å®¶èƒ½æå‡ºä¸€äº›æ„è§ï¼Œå¾ˆä¹æ„ä¸å¤§å®¶äº’ç›¸äº¤æµã€‚</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/11/25/wang-shang-qing-qiu-feng-(feng-)zhuang/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/11/25/wang-shang-qing-qiu-feng-(feng-)zhuang/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/16/appqia-dun-liao-zen-yao-ban-%3F/">Appå¡é¡¿äº†æ€ä¹ˆåŠï¼Ÿ</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/kadun001.jpg" title="Caption" ></p>

<p>åœ¨ VSync ä¿¡å·åˆ°æ¥åï¼Œç³»ç»Ÿå›¾å½¢æœåŠ¡ä¼šé€šè¿‡ CADisplayLink ç­‰æœºåˆ¶é€šçŸ¥ Appï¼ŒApp ä¸»çº¿ç¨‹å¼€å§‹åœ¨ CPU ä¸­è®¡ç®—æ˜¾ç¤ºå†…å®¹ï¼Œæ¯”å¦‚è§†å›¾çš„åˆ›å»ºã€å¸ƒå±€è®¡ç®—ã€å›¾ç‰‡è§£ç ã€æ–‡æœ¬ç»˜åˆ¶ç­‰ã€‚</p>

<p>éšå CPU ä¼šå°†è®¡ç®—å¥½çš„å†…å®¹æäº¤åˆ° GPU å»ï¼Œç”± GPU è¿›è¡Œå˜æ¢ã€åˆæˆã€æ¸²æŸ“ã€‚éšå GPU ä¼šæŠŠæ¸²æŸ“ç»“æœæäº¤åˆ°å¸§ç¼“å†²åŒºå»ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ VSync ä¿¡å·åˆ°æ¥æ—¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p>

<p>ç”±äºå‚ç›´åŒæ­¥çš„æœºåˆ¶ï¼Œå¦‚æœåœ¨ä¸€ä¸ª VSync æ—¶é—´å†…ï¼ŒCPU æˆ–è€… GPU æ²¡æœ‰å®Œæˆå†…å®¹æäº¤ï¼Œåˆ™é‚£ä¸€å¸§å°±ä¼šè¢«ä¸¢å¼ƒï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æœºä¼šå†æ˜¾ç¤ºï¼Œè€Œè¿™æ—¶æ˜¾ç¤ºå±ä¼šä¿ç•™ä¹‹å‰çš„å†…å®¹ä¸å˜ã€‚è¿™å°±æ˜¯ç•Œé¢å¡é¡¿çš„åŸå› ã€‚</p>

<p>ä»ä¸Šé¢çš„å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒCPU å’Œ GPU ä¸è®ºå“ªä¸ªé˜»ç¢äº†æ˜¾ç¤ºæµç¨‹ï¼Œéƒ½ä¼šé€ æˆæ‰å¸§ç°è±¡ã€‚æ‰€ä»¥å¼€å‘æ—¶ï¼Œä¹Ÿéœ€è¦åˆ†åˆ«å¯¹ CPU å’Œ GPU å‹åŠ›è¿›è¡Œè¯„ä¼°å’Œä¼˜åŒ–ã€‚</p>

<h2>CPU èµ„æºæ¶ˆè€—åŸå› å’Œè§£å†³æ–¹æ¡ˆ</h2>

<h4>å¯¹è±¡åˆ›å»º</h4>

<p>å¯¹è±¡çš„åˆ›å»ºä¼šåˆ†é…å†…å­˜ã€è°ƒæ•´å±æ€§ã€ç”šè‡³è¿˜æœ‰è¯»å–æ–‡ä»¶ç­‰æ“ä½œï¼Œæ¯”è¾ƒæ¶ˆè€— CPU èµ„æºã€‚</p>

<p>å°½é‡ç”¨è½»é‡çš„å¯¹è±¡ä»£æ›¿é‡é‡çš„å¯¹è±¡ï¼Œå¯ä»¥å¯¹æ€§èƒ½æœ‰æ‰€ä¼˜åŒ–ã€‚</p>

<p>æ¯”å¦‚ CALayer æ¯” UIView è¦è½»é‡è®¸å¤šï¼Œé‚£ä¹ˆä¸éœ€è¦å“åº”è§¦æ‘¸äº‹ä»¶çš„æ§ä»¶ï¼Œç”¨ CALayer æ˜¾ç¤ºä¼šæ›´åŠ åˆé€‚ã€‚å¦‚æœå¯¹è±¡ä¸æ¶‰åŠ UI æ“ä½œï¼Œåˆ™å°½é‡æ”¾åˆ°åå°çº¿ç¨‹å»åˆ›å»ºï¼Œä½†å¯æƒœçš„æ˜¯åŒ…å«æœ‰ CALayer çš„æ§ä»¶ï¼Œéƒ½åªèƒ½åœ¨ä¸»çº¿ç¨‹åˆ›å»ºå’Œæ“ä½œã€‚é€šè¿‡ Storyboard åˆ›å»ºè§†å›¾å¯¹è±¡æ—¶ï¼Œå…¶èµ„æºæ¶ˆè€—ä¼šæ¯”ç›´æ¥é€šè¿‡ä»£ç åˆ›å»ºå¯¹è±¡è¦å¤§éå¸¸å¤šï¼Œåœ¨æ€§èƒ½æ•æ„Ÿçš„ç•Œé¢é‡Œï¼ŒStoryboard å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æŠ€æœ¯é€‰æ‹©ã€‚</p>

<p>å°½é‡æ¨è¿Ÿå¯¹è±¡åˆ›å»ºçš„æ—¶é—´ï¼Œå¹¶æŠŠå¯¹è±¡çš„åˆ›å»ºåˆ†æ•£åˆ°å¤šä¸ªä»»åŠ¡ä¸­å»ã€‚å°½ç®¡è¿™å®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¹¶ä¸”å¸¦æ¥çš„ä¼˜åŠ¿å¹¶ä¸å¤šï¼Œä½†å¦‚æœæœ‰èƒ½åŠ›åšï¼Œè¿˜æ˜¯è¦å°½é‡å°è¯•ä¸€ä¸‹ã€‚å¦‚æœå¯¹è±¡å¯ä»¥å¤ç”¨ï¼Œå¹¶ä¸”å¤ç”¨çš„ä»£ä»·æ¯”é‡Šæ”¾ã€åˆ›å»ºæ–°å¯¹è±¡è¦å°ï¼Œé‚£ä¹ˆè¿™ç±»å¯¹è±¡åº”å½“å°½é‡æ”¾åˆ°ä¸€ä¸ªç¼“å­˜æ± é‡Œå¤ç”¨ã€‚</p>

<h4>å¯¹è±¡è°ƒæ•´</h4>

<p>å¯¹è±¡çš„è°ƒæ•´ä¹Ÿç»å¸¸æ˜¯æ¶ˆè€— CPU èµ„æºçš„åœ°æ–¹ã€‚</p>

<p>è¿™é‡Œç‰¹åˆ«è¯´ä¸€ä¸‹ CALayerï¼š</p>

<ul>
<li><p>CALayer å†…éƒ¨å¹¶æ²¡æœ‰å±æ€§ï¼Œå½“è°ƒç”¨å±æ€§æ–¹æ³•æ—¶ï¼Œå®ƒå†…éƒ¨æ˜¯é€šè¿‡è¿è¡Œæ—¶ resolveInstanceMethod ä¸ºå¯¹è±¡ä¸´æ—¶æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æŠŠå¯¹åº”å±æ€§å€¼ä¿å­˜åˆ°å†…éƒ¨çš„ä¸€ä¸ª Dictionary é‡Œï¼ŒåŒæ—¶è¿˜ä¼šé€šçŸ¥ delegateã€åˆ›å»ºåŠ¨ç”»ç­‰ç­‰ï¼Œéå¸¸æ¶ˆè€—èµ„æºã€‚</p></li>
<li><p>UIView çš„å…³äºæ˜¾ç¤ºç›¸å…³çš„å±æ€§ï¼ˆæ¯”å¦‚ frame/bounds/transformï¼‰ç­‰å®é™…ä¸Šéƒ½æ˜¯ CALayer å±æ€§æ˜ å°„æ¥çš„ï¼Œæ‰€ä»¥å¯¹ UIView çš„è¿™äº›å±æ€§è¿›è¡Œè°ƒæ•´æ—¶ï¼Œæ¶ˆè€—çš„èµ„æºè¦è¿œå¤§äºä¸€èˆ¬çš„å±æ€§ã€‚å¯¹æ­¤ä½ åœ¨åº”ç”¨ä¸­ï¼Œåº”è¯¥å°½é‡å‡å°‘ä¸å¿…è¦çš„å±æ€§ä¿®æ”¹ã€‚</p></li>
</ul>


<p>å½“è§†å›¾å±‚æ¬¡è°ƒæ•´æ—¶ï¼ŒUIViewã€CALayer ä¹‹é—´ä¼šå‡ºç°å¾ˆå¤šæ–¹æ³•è°ƒç”¨ä¸é€šçŸ¥ï¼Œæ‰€ä»¥åœ¨ä¼˜åŒ–æ€§èƒ½æ—¶ï¼Œåº”è¯¥å°½é‡é¿å…è°ƒæ•´è§†å›¾å±‚æ¬¡ã€æ·»åŠ å’Œç§»é™¤è§†å›¾ã€‚</p>

<h4>å¯¹è±¡é”€æ¯</h4>

<p>å¯¹è±¡çš„é”€æ¯è™½ç„¶æ¶ˆè€—èµ„æºä¸å¤šï¼Œä½†ç´¯ç§¯èµ·æ¥ä¹Ÿæ˜¯ä¸å®¹å¿½è§†çš„ã€‚é€šå¸¸å½“å®¹å™¨ç±»æŒæœ‰å¤§é‡å¯¹è±¡æ—¶ï¼Œå…¶é”€æ¯æ—¶çš„èµ„æºæ¶ˆè€—å°±éå¸¸æ˜æ˜¾ã€‚åŒæ ·çš„ï¼Œå¦‚æœå¯¹è±¡å¯ä»¥æ”¾åˆ°åå°çº¿ç¨‹å»é‡Šæ”¾ï¼Œé‚£å°±æŒªåˆ°åå°çº¿ç¨‹å»ã€‚è¿™é‡Œæœ‰ä¸ªå° Tipï¼šæŠŠå¯¹è±¡æ•è·åˆ° block ä¸­ï¼Œç„¶åæ‰”åˆ°åå°é˜Ÿåˆ—å»éšä¾¿å‘é€ä¸ªæ¶ˆæ¯ä»¥é¿å…ç¼–è¯‘å™¨è­¦å‘Šï¼Œå°±å¯ä»¥è®©å¯¹è±¡åœ¨åå°çº¿ç¨‹é”€æ¯äº†ã€‚</p>

<pre><code>NSArray *tmp = self.array;

self.array = nil;

dispatch_async(queue, ^{

    [tmp class];

});
</code></pre>

<h4>å¸ƒå±€è®¡ç®—</h4>

<p>è§†å›¾å¸ƒå±€çš„è®¡ç®—æ˜¯ App ä¸­æœ€ä¸ºå¸¸è§çš„æ¶ˆè€— CPU èµ„æºçš„åœ°æ–¹ã€‚å¦‚æœèƒ½åœ¨åå°çº¿ç¨‹æå‰è®¡ç®—å¥½è§†å›¾å¸ƒå±€ã€å¹¶ä¸”å¯¹è§†å›¾å¸ƒå±€è¿›è¡Œç¼“å­˜ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°æ–¹åŸºæœ¬å°±ä¸ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜äº†ã€‚</p>

<p>ä¸è®ºé€šè¿‡ä½•ç§æŠ€æœ¯å¯¹è§†å›¾è¿›è¡Œå¸ƒå±€ï¼Œå…¶æœ€ç»ˆéƒ½ä¼šè½åˆ°å¯¹ UIView.frame/bounds/center ç­‰å±æ€§çš„è°ƒæ•´ä¸Šã€‚ä¸Šé¢ä¹Ÿè¯´è¿‡ï¼Œå¯¹è¿™äº›å±æ€§çš„è°ƒæ•´éå¸¸æ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥å°½é‡æå‰è®¡ç®—å¥½å¸ƒå±€ï¼Œåœ¨éœ€è¦æ—¶ä¸€æ¬¡æ€§è°ƒæ•´å¥½å¯¹åº”å±æ€§ï¼Œè€Œä¸è¦å¤šæ¬¡ã€é¢‘ç¹çš„è®¡ç®—å’Œè°ƒæ•´è¿™äº›å±æ€§ã€‚</p>

<h4>Autolayout</h4>

<ul>
<li>Autolayout æ˜¯è‹¹æœæœ¬èº«æå€¡çš„æŠ€æœ¯ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿèƒ½å¾ˆå¥½çš„æå‡å¼€å‘æ•ˆç‡ï¼Œä½†æ˜¯ Autolayout å¯¹äºå¤æ‚è§†å›¾æ¥è¯´å¸¸å¸¸ä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚éšç€è§†å›¾æ•°é‡çš„å¢é•¿ï¼ŒAutolayout å¸¦æ¥çš„ CPU æ¶ˆè€—ä¼šå‘ˆæŒ‡æ•°çº§ä¸Šå‡ã€‚å…·ä½“æ•°æ®å¯ä»¥çœ‹è¿™ä¸ªæ–‡ç« ï¼š<a href="http://pilky.me/36/%E3%80%82">http://pilky.me/36/%E3%80%82</a> å¦‚æœä½ ä¸æƒ³æ‰‹åŠ¨è°ƒæ•´ frame ç­‰å±æ€§ï¼Œä½ å¯ä»¥ç”¨ä¸€äº›å·¥å…·æ–¹æ³•æ›¿ä»£ï¼ˆæ¯”å¦‚å¸¸è§çš„ left/right/top/bottom/width/height å¿«æ·å±æ€§ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨ ComponentKitã€AsyncDisplayKit ç­‰æ¡†æ¶ã€‚</li>
</ul>


<h4>æ–‡æœ¬è®¡ç®—</h4>

<p>å¦‚æœä¸€ä¸ªç•Œé¢ä¸­åŒ…å«å¤§é‡æ–‡æœ¬ï¼ˆæ¯”å¦‚å¾®åšå¾®ä¿¡æœ‹å‹åœˆç­‰ï¼‰ï¼Œæ–‡æœ¬çš„å®½é«˜è®¡ç®—ä¼šå ç”¨å¾ˆå¤§ä¸€éƒ¨åˆ†èµ„æºï¼Œå¹¶ä¸”ä¸å¯é¿å…ã€‚å¦‚æœä½ å¯¹æ–‡æœ¬æ˜¾ç¤ºæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå¯ä»¥å‚è€ƒä¸‹ UILabel å†…éƒ¨çš„å®ç°æ–¹å¼ï¼šç”¨ [NSAttributedString boundingRectWithSize:options:context:] æ¥è®¡ç®—æ–‡æœ¬å®½é«˜ï¼Œç”¨ -[NSAttributedString drawWithRect:options:context:] æ¥ç»˜åˆ¶æ–‡æœ¬ã€‚å°½ç®¡è¿™ä¸¤ä¸ªæ–¹æ³•æ€§èƒ½ä¸é”™ï¼Œä½†ä»æ—§éœ€è¦æ”¾åˆ°åå°çº¿ç¨‹è¿›è¡Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>

<blockquote><p>æ³¨æ„ï¼šå¦‚æœä½ ç”¨ CoreText ç»˜åˆ¶æ–‡æœ¬ï¼Œé‚£å°±å¯ä»¥å…ˆç”Ÿæˆ CoreText æ’ç‰ˆå¯¹è±¡ï¼Œç„¶åè‡ªå·±è®¡ç®—äº†ï¼Œå¹¶ä¸” CoreText å¯¹è±¡è¿˜èƒ½ä¿ç•™ä»¥ä¾›ç¨åç»˜åˆ¶ä½¿ç”¨ã€‚</p></blockquote>

<h4>æ–‡æœ¬æ¸²æŸ“</h4>

<p>å±å¹•ä¸Šèƒ½çœ‹åˆ°çš„æ‰€æœ‰æ–‡æœ¬å†…å®¹æ§ä»¶ï¼ŒåŒ…æ‹¬ UIWebViewï¼Œåœ¨åº•å±‚éƒ½æ˜¯é€šè¿‡ CoreText æ’ç‰ˆã€ç»˜åˆ¶ä¸º Bitmap æ˜¾ç¤ºçš„ã€‚å¸¸è§çš„æ–‡æœ¬æ§ä»¶ ï¼ˆUILabelã€UITextView ç­‰ï¼‰ï¼Œå…¶æ’ç‰ˆå’Œç»˜åˆ¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œçš„ï¼Œå½“æ˜¾ç¤ºå¤§é‡æ–‡æœ¬æ—¶ï¼ŒCPU çš„å‹åŠ›ä¼šéå¸¸å¤§ã€‚å¯¹æ­¤è§£å†³æ–¹æ¡ˆåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯è‡ªå®šä¹‰æ–‡æœ¬æ§ä»¶ï¼Œç”¨ TextKit æˆ–æœ€åº•å±‚çš„ CoreText å¯¹æ–‡æœ¬å¼‚æ­¥ç»˜åˆ¶ã€‚å°½ç®¡è¿™å®ç°èµ·æ¥éå¸¸éº»çƒ¦ï¼Œä½†å…¶å¸¦æ¥çš„ä¼˜åŠ¿ä¹Ÿéå¸¸å¤§ï¼ŒCoreText å¯¹è±¡åˆ›å»ºå¥½åï¼Œèƒ½ç›´æ¥è·å–æ–‡æœ¬çš„å®½é«˜ç­‰ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡è®¡ç®—ï¼ˆè°ƒæ•´ UILabel å¤§å°æ—¶ç®—ä¸€éã€UILabel ç»˜åˆ¶æ—¶å†…éƒ¨å†ç®—ä¸€éï¼‰ï¼›CoreText å¯¹è±¡å ç”¨å†…å­˜è¾ƒå°‘ï¼Œå¯ä»¥ç¼“å­˜ä¸‹æ¥ä»¥å¤‡ç¨åå¤šæ¬¡æ¸²æŸ“ã€‚</p>

<h4>å›¾ç‰‡çš„è§£ç </h4>

<p>å½“ä½ ç”¨ UIImage æˆ– CGImageSource çš„é‚£å‡ ä¸ªæ–¹æ³•åˆ›å»ºå›¾ç‰‡æ—¶ï¼Œå›¾ç‰‡æ•°æ®å¹¶ä¸ä¼šç«‹åˆ»è§£ç ã€‚å›¾ç‰‡è®¾ç½®åˆ° UIImageView æˆ–è€… CALayer.contents ä¸­å»ï¼Œå¹¶ä¸” CALayer è¢«æäº¤åˆ° GPU å‰ï¼ŒCGImage ä¸­çš„æ•°æ®æ‰ä¼šå¾—åˆ°è§£ç ã€‚è¿™ä¸€æ­¥æ˜¯å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹çš„ï¼Œå¹¶ä¸”ä¸å¯é¿å…ã€‚å¦‚æœæƒ³è¦ç»•å¼€è¿™ä¸ªæœºåˆ¶ï¼Œå¸¸è§çš„åšæ³•æ˜¯åœ¨åå°çº¿ç¨‹å…ˆæŠŠå›¾ç‰‡ç»˜åˆ¶åˆ° CGBitmapContext ä¸­ï¼Œç„¶åä» Bitmap ç›´æ¥åˆ›å»ºå›¾ç‰‡ã€‚ç›®å‰å¸¸è§çš„ç½‘ç»œå›¾ç‰‡åº“éƒ½è‡ªå¸¦è¿™ä¸ªåŠŸèƒ½ã€‚</p>

<h4>å›¾åƒçš„ç»˜åˆ¶</h4>

<p>å›¾åƒçš„ç»˜åˆ¶é€šå¸¸æ˜¯æŒ‡ç”¨é‚£äº›ä»¥ CG å¼€å¤´çš„æ–¹æ³•æŠŠå›¾åƒç»˜åˆ¶åˆ°ç”»å¸ƒä¸­ï¼Œç„¶åä»ç”»å¸ƒåˆ›å»ºå›¾ç‰‡å¹¶æ˜¾ç¤ºè¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸ªæœ€å¸¸è§çš„åœ°æ–¹å°±æ˜¯ [UIView drawRect:] é‡Œé¢äº†ã€‚ç”±äº CoreGraphic æ–¹æ³•é€šå¸¸éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å›¾åƒçš„ç»˜åˆ¶å¯ä»¥å¾ˆå®¹æ˜“çš„æ”¾åˆ°åå°çº¿ç¨‹è¿›è¡Œã€‚ä¸€ä¸ªç®€å•å¼‚æ­¥ç»˜åˆ¶çš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼ˆå®é™…æƒ…å†µä¼šæ¯”è¿™ä¸ªå¤æ‚å¾—å¤šï¼Œä½†åŸç†åŸºæœ¬ä¸€è‡´ï¼‰ï¼š</p>

<pre><code>- (void)display {

    dispatch_async(backgroundQueue, ^{

    CGContextRef ctx = CGBitmapContextCreate(...);

    // draw in context...

    CGImageRef img = CGBitmapContextCreateImage(ctx);

    CFRelease(ctx);

    dispatch_async(mainQueue, ^{

        layer.contents = img;

    });

    });
}
</code></pre>

<h2>GPU èµ„æºæ¶ˆè€—åŸå› å’Œè§£å†³æ–¹æ¡ˆ</h2>

<p>ç›¸å¯¹äº CPU æ¥è¯´ï¼ŒGPU èƒ½å¹²çš„äº‹æƒ…æ¯”è¾ƒå•ä¸€ï¼šæ¥æ”¶æäº¤çš„çº¹ç†ï¼ˆTextureï¼‰å’Œé¡¶ç‚¹æè¿°ï¼ˆä¸‰è§’å½¢ï¼‰ï¼Œåº”ç”¨å˜æ¢ï¼ˆtransformï¼‰ã€æ··åˆå¹¶æ¸²æŸ“ï¼Œç„¶åè¾“å‡ºåˆ°å±å¹•ä¸Šã€‚é€šå¸¸ä½ æ‰€èƒ½çœ‹åˆ°çš„å†…å®¹ï¼Œä¸»è¦ä¹Ÿå°±æ˜¯çº¹ç†ï¼ˆå›¾ç‰‡ï¼‰å’Œå½¢çŠ¶ï¼ˆä¸‰è§’æ¨¡æ‹Ÿçš„çŸ¢é‡å›¾å½¢ï¼‰ä¸¤ç±»ã€‚</p>

<h4>çº¹ç†çš„æ¸²æŸ“</h4>

<p>æ‰€æœ‰çš„ Bitmapï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€æ–‡æœ¬ã€æ …æ ¼åŒ–çš„å†…å®¹ï¼Œæœ€ç»ˆéƒ½è¦ç”±å†…å­˜æäº¤åˆ°æ˜¾å­˜ï¼Œç»‘å®šä¸º GPU Textureã€‚ä¸è®ºæ˜¯æäº¤åˆ°æ˜¾å­˜çš„è¿‡ç¨‹ï¼Œè¿˜æ˜¯ GPU è°ƒæ•´å’Œæ¸²æŸ“ Texture çš„è¿‡ç¨‹ï¼Œéƒ½è¦æ¶ˆè€—ä¸å°‘ GPU èµ„æºã€‚å½“åœ¨è¾ƒçŸ­æ—¶é—´æ˜¾ç¤ºå¤§é‡å›¾ç‰‡æ—¶ï¼ˆæ¯”å¦‚ TableView å­˜åœ¨éå¸¸å¤šçš„å›¾ç‰‡å¹¶ä¸”å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼‰ï¼ŒCPU å ç”¨ç‡å¾ˆä½ï¼ŒGPU å ç”¨éå¸¸é«˜ï¼Œç•Œé¢ä»ç„¶ä¼šæ‰å¸§ã€‚é¿å…è¿™ç§æƒ…å†µçš„æ–¹æ³•åªèƒ½æ˜¯å°½é‡å‡å°‘åœ¨çŸ­æ—¶é—´å†…å¤§é‡å›¾ç‰‡çš„æ˜¾ç¤ºï¼Œå°½å¯èƒ½å°†å¤šå¼ å›¾ç‰‡åˆæˆä¸ºä¸€å¼ è¿›è¡Œæ˜¾ç¤ºã€‚</p>

<blockquote><p>æ³¨æ„ï¼šå½“å›¾ç‰‡è¿‡å¤§ï¼Œè¶…è¿‡ GPU çš„æœ€å¤§çº¹ç†å°ºå¯¸æ—¶ï¼Œå›¾ç‰‡éœ€è¦å…ˆç”± CPU è¿›è¡Œé¢„å¤„ç†ï¼Œè¿™å¯¹ CPU å’Œ GPU éƒ½ä¼šå¸¦æ¥é¢å¤–çš„èµ„æºæ¶ˆè€—ã€‚ç›®å‰æ¥è¯´ï¼ŒiPhone 4S ä»¥ä¸Šæœºå‹ï¼Œçº¹ç†å°ºå¯¸ä¸Šé™éƒ½æ˜¯ 4096x4096ï¼Œæ›´è¯¦ç»†çš„èµ„æ–™å¯ä»¥çœ‹è¿™é‡Œï¼šiosres.comã€‚æ‰€ä»¥ï¼Œå°½é‡ä¸è¦è®©å›¾ç‰‡å’Œè§†å›¾çš„å¤§å°è¶…è¿‡è¿™ä¸ªå€¼ã€‚</p></blockquote>

<h4>è§†å›¾çš„æ··åˆ (Composing)</h4>

<p>å½“å¤šä¸ªè§†å›¾ï¼ˆæˆ–è€…è¯´ CALayerï¼‰é‡å åœ¨ä¸€èµ·æ˜¾ç¤ºæ—¶ï¼ŒGPU ä¼šé¦–å…ˆæŠŠä»–ä»¬æ··åˆåˆ°ä¸€èµ·ã€‚å¦‚æœè§†å›¾ç»“æ„è¿‡äºå¤æ‚ï¼Œæ··åˆçš„è¿‡ç¨‹ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤š GPU èµ„æºã€‚ä¸ºäº†å‡è½»è¿™ç§æƒ…å†µçš„ GPU æ¶ˆè€—ï¼Œåº”ç”¨åº”å½“å°½é‡å‡å°‘è§†å›¾æ•°é‡å’Œå±‚æ¬¡ï¼Œå¹¶åœ¨ä¸é€æ˜çš„è§†å›¾é‡Œæ ‡æ˜ opaque å±æ€§ä»¥é¿å…æ— ç”¨çš„ Alpha é€šé“åˆæˆã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¯ä»¥ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼ŒæŠŠå¤šä¸ªè§†å›¾é¢„å…ˆæ¸²æŸ“ä¸ºä¸€å¼ å›¾ç‰‡æ¥æ˜¾ç¤ºã€‚</p>

<h4>å›¾å½¢çš„ç”Ÿæˆ</h4>

<p>CALayer çš„ borderã€åœ†è§’ã€é˜´å½±ã€é®ç½©ï¼ˆmaskï¼‰ï¼ŒCASharpLayer çš„çŸ¢é‡å›¾å½¢æ˜¾ç¤ºï¼Œé€šå¸¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼ˆoffscreen renderingï¼‰ï¼Œè€Œç¦»å±æ¸²æŸ“é€šå¸¸å‘ç”Ÿåœ¨ GPU ä¸­ã€‚å½“ä¸€ä¸ªåˆ—è¡¨è§†å›¾ä¸­å‡ºç°å¤§é‡åœ†è§’çš„ CALayerï¼Œå¹¶ä¸”å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼Œå¯ä»¥è§‚å¯Ÿåˆ° GPU èµ„æºå·²ç»å æ»¡ï¼Œè€Œ CPU èµ„æºæ¶ˆè€—å¾ˆå°‘ã€‚è¿™æ—¶ç•Œé¢ä»ç„¶èƒ½æ­£å¸¸æ»‘åŠ¨ï¼Œä½†å¹³å‡å¸§æ•°ä¼šé™åˆ°å¾ˆä½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥å°è¯•å¼€å¯ CALayer.shouldRasterize å±æ€§ï¼Œä½†è¿™ä¼šæŠŠåŸæœ¬ç¦»å±æ¸²æŸ“çš„æ“ä½œè½¬å«åˆ° CPU ä¸Šå»ã€‚å¯¹äºåªéœ€è¦åœ†è§’çš„æŸäº›åœºåˆï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€å¼ å·²ç»ç»˜åˆ¶å¥½çš„åœ†è§’å›¾ç‰‡è¦†ç›–åˆ°åŸæœ¬è§†å›¾ä¸Šé¢æ¥æ¨¡æ‹Ÿç›¸åŒçš„è§†è§‰æ•ˆæœã€‚æœ€å½»åº•çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯æŠŠéœ€è¦æ˜¾ç¤ºçš„å›¾å½¢åœ¨åå°çº¿ç¨‹ç»˜åˆ¶ä¸ºå›¾ç‰‡ï¼Œé¿å…ä½¿ç”¨åœ†è§’ã€é˜´å½±ã€é®ç½©ç­‰å±æ€§ã€‚</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/11/16/appqia-dun-liao-zen-yao-ban-%3F/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/11/16/appqia-dun-liao-zen-yao-ban-%3F/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/08/nian-tie-shen-jiu/">ç²˜è´´æ·±ç©¶</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>åœ¨iOSä¸­ï¼Œå¯ä»¥ä½¿ç”¨å‰ªè´´æ¿å®ç°åº”ç”¨ç¨‹åºä¹‹ä¸­ä»¥åŠåº”ç”¨ç¨‹åºä¹‹é—´å®ç°æ•°æ®çš„å…±äº«ã€‚æ¯”å¦‚ä½ å¯ä»¥ä»iPhone QQå¤åˆ¶ä¸€ä¸ªurlï¼Œç„¶åç²˜è´´åˆ°safariæµè§ˆå™¨ä¸­æŸ¥çœ‹è¿™ä¸ªé“¾æ¥çš„å†…å®¹ã€‚</p>

<h3>ä¸€ã€åœ¨iOSä¸­ä¸‹é¢ä¸‰ä¸ªæ§ä»¶ï¼Œè‡ªèº«å°±æœ‰å¤åˆ¶-ç²˜è´´çš„åŠŸèƒ½ï¼š</h3>

<ul>
<li>1ã€UITextView</li>
<li>2ã€UITextField</li>
<li>3ã€UIWebView</li>
</ul>


<h3>äºŒã€UIKit frameworkæä¾›äº†å‡ ä¸ªç±»å’Œåè®®æ–¹ä¾¿æˆ‘ä»¬åœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­å®ç°å‰ªè´´æ¿çš„åŠŸèƒ½ã€‚</h3>

<ul>
<li>1ã€UIPasteboardï¼šæˆ‘ä»¬å¯ä»¥å‘å…¶ä¸­å†™å…¥æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¯»å–æ•°æ®</li>
<li>2ã€UIMenuControllerï¼šæ˜¾ç¤ºä¸€ä¸ªå¿«æ·èœå•ï¼Œç”¨æ¥å¤åˆ¶ã€å‰ªè´´ã€ç²˜è´´é€‰æ‹©çš„é¡¹ã€‚</li>
<li>3ã€UIResponderä¸­çš„ canPerformAction:withSender:ç”¨äºæ§åˆ¶å“ªäº›å‘½ä»¤æ˜¾ç¤ºåœ¨å¿«æ·èœå•ä¸­ã€‚</li>
<li>4ã€å½“å¿«æ·èœå•ä¸Šçš„å‘½ä»¤ç‚¹å‡»çš„æ—¶å€™ï¼ŒUIResponderStandardEditActionså°†ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>


<h3>ä¸‰ã€ä¸‹é¢è¿™äº›é¡¹èƒ½è¢«æ”¾ç½®åˆ°å‰ªè´´æ¿ä¸­</h3>

<ul>
<li>1ã€UIPasteboardTypeListString â€”  å­—ç¬¦ä¸²æ•°ç»„, åŒ…å«kUTTypeUTF8PlainText</li>
<li>2ã€UIPasteboardTypeListURL â€”   URLæ•°ç»„ï¼ŒåŒ…å«kUTTypeURL</li>
<li>3ã€UIPasteboardTypeListImage â€”   å›¾å½¢æ•°ç»„, åŒ…å«kUTTypePNG å’ŒkUTTypeJPEG</li>
<li>4ã€UIPasteboardTypeListColor â€”   é¢œè‰²æ•°ç»„</li>
</ul>


<h3>å››ã€å‰ªè´´æ¿çš„ç±»å‹åˆ†ä¸ºä¸¤ç§ï¼š</h3>

<p>ç³»ç»Ÿçº§ï¼šä½¿ç”¨UIPasteboardNameGeneralå’ŒUIPasteboardNameFindåˆ›å»ºï¼Œç³»ç»Ÿçº§çš„å‰ªè´´æ¿ï¼Œå½“åº”ç”¨ç¨‹åºå…³é—­ï¼Œæˆ–è€…å¸è½½æ—¶ï¼Œæ•°æ®éƒ½ä¸ä¼šä¸¢å¤±ã€‚
åº”ç”¨ç¨‹åºçº§ï¼šé€šè¿‡è®¾ç½®ï¼Œå¯ä»¥è®©æ•°æ®åœ¨åº”ç”¨ç¨‹åºå…³é—­ä¹‹åä»ç„¶ä¿å­˜åœ¨å‰ªè´´æ¿ä¸­ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºå¸è½½ä¹‹åæ•°æ®å°±ä¼šå¤±å»ã€‚æˆ‘ä»¬å¯ç”¨é€šè¿‡pasteboardWithName:createï¼šæ¥åˆ›å»ºã€‚</p>

<p>äº†è§£è¿™äº›ä¹‹åï¼Œä¸‹é¢é€šè¿‡ä¸€ç³»åˆ—çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å‰ªè´´æ¿ã€‚</p>

<p>ä¾‹å­ï¼š</p>

<h5>1ã€å¤åˆ¶å‰ªè´´æ–‡æœ¬ã€‚</h5>

<pre><code>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥åœ¨tableviewä¸Šæ˜¾ç¤ºä¸€ä¸ªå¿«æ·èœå•ï¼Œä¸Šé¢åªæœ‰å¤åˆ¶æŒ‰é’®ï¼Œå¤åˆ¶tableviewä¸Šçš„æ•°æ®ä¹‹åï¼Œç„¶åç²˜è´´åˆ°titleä¸Šã€‚
</code></pre>

<p>å®šä¹‰ä¸€ä¸ªå•å…ƒæ ¼ç±»CopyTableViewCellï¼Œåœ¨è¿™ä¸ªç±»çš„ä¸Šæ˜¾ç¤ºå¿«æ·èœå•ï¼Œå®ç°å¤åˆ¶åŠŸèƒ½ã€‚</p>

<pre><code>@interface CopyTableViewCell : UITableViewCell {
    id delegate;
}
@property (nonatomic, retain) id delegate;
@end
</code></pre>

<p>å®ç°CopyTableViewCell ï¼š</p>

<pre><code>#import "CopyTableViewCell.h"

@implementation CopyTableViewCell

@synthesize delegate;

- (id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier {
    if ((self = [super initWithStyle:style reuseIdentifier:reuseIdentifier])) {
    }
    return self;
}
- (void)setSelected:(BOOL)selected animated:(BOOL)animated {
    [super setSelected:selected animated:animated];
}
- (void)setHighlighted:(BOOL)highlighted animated:(BOOL)animated {
    [[self delegate] performSelector:@selector(showMenu:)
                          withObject:self afterDelay:0.9f];

    [super setHighlighted:highlighted animated:animated];

}
- (BOOL)canBecomeFirstResponder
{
    return YES;
}
- (BOOL)canPerformAction:(SEL)action withSender:(id)sender{
    if (action == @selector(cut:)){
        return NO;
    }
    else if(action == @selector(copy:)){
        return YES;
    }
    else if(action == @selector(paste:)){
        return NO;
    }
    else if(action == @selector(select:)){
        return NO;
    }
    else if(action == @selector(selectAll:)){
        return NO;
    }
    else
    {
        return [super canPerformAction:action withSender:sender];
    }
}
- (void)copy:(id)sender {
    UIPasteboard *pasteboard = [UIPasteboard generalPasteboard];
    [pasteboard setString:[[self textLabel]text]];
}
- (void)dealloc {
    [super dealloc];
}
@end
</code></pre>

<p>å¤åˆ¶ä»£ç 
å®šä¹‰CopyPasteTextControllerï¼Œå®ç°ç²˜è´´åŠŸèƒ½ã€‚
    @interface CopyPasteTextController : UIViewController<UITableViewDelegate> {
        //ç”¨æ¥æ ‡è¯†æ˜¯å¦æ˜¾ç¤ºå¿«æ·èœå•
        BOOL menuVisible;
        UITableView *tableView;
    }</p>

<pre><code>@property (nonatomic, getter=isMenuVisible) BOOL menuVisible;

@property (nonatomic, retain) IBOutlet UITableView *tableView;
@end
</code></pre>

<p>å®ç°CopyPasteTextController ï¼š</p>

<pre><code>#import "CopyPasteTextController.h"
#import "CopyTableViewCell.h"

@implementation CopyPasteTextController
@synthesize menuVisible,tableView;
- (void)viewDidLoad {
    [super viewDidLoad];
    [self setTitle:@"æ–‡å­—å¤åˆ¶ç²˜è´´"];
    //ç‚¹å‡»è¿™ä¸ªæŒ‰é’®å°†å‰ªè´´æ¿çš„å†…å®¹ç²˜è´´åˆ°titleä¸Š
    UIBarButtonItem *addButton = [[[UIBarButtonItem alloc]
                                      initWithBarButtonSystemItem:UIBarButtonSystemItemRefresh
                                      target:self
                                      action:@selector(readFromPasteboard:)]
                                     autorelease];
    [[self navigationItem] setRightBarButtonItem:addButton];
}


// Customize the number of sections in the table view.
- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    return 1;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return 9;
}

// Customize the appearance of table view cells.
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *CellIdentifier =@"Cell";
    CopyTableViewCell *cell = (CopyTableViewCell *)[tableView
                                                           dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil)
    {
        cell = [[[CopyTableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];
        [cell setDelegate:self];
    }

    // Configure the cell.
    NSString *text = [NSString stringWithFormat:@"Row %d", [indexPath row]];
    [[cell textLabel] setText:text];
    return cell;
}

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    if([self isMenuVisible])
    {
        return;
    }
    [[[self tableView] cellForRowAtIndexPath:indexPath] setSelected:YES
                                                           animated:YES];
}
//æ˜¾ç¤ºèœå•
- (void)showMenu:(id)cell {
    if ([cell isHighlighted]) {
        [cell becomeFirstResponder];

        UIMenuController * menu = [UIMenuController sharedMenuController];
        [menu setTargetRect: [cell frame] inView: [self view]];
        [menu setMenuVisible: YES animated: YES];
    }
}
- (void)readFromPasteboard:(id)sender {
    [self setTitle:[NSString stringWithFormat:@"Pasteboard = %@",
                      [[UIPasteboard generalPasteboard] string]]];
}

- (void)didReceiveMemoryWarning
{
    // Releases the view if it doesn't have a superview.
    [super didReceiveMemoryWarning];

    // Relinquish ownership any cached data, images, etc that aren't in use.
}

- (void)viewDidUnload
{
    [super viewDidUnload];
    [self.tableView release];

    // Relinquish ownership of anything that can be recreated in viewDidLoad or on demand.
    // For example: self.myOutlet = nil;
}
</code></pre>

<p>å¤åˆ¶ä¸€è¡Œæ•°æ®ï¼š
ç‚¹å‡»å³ä¸Šè§’çš„æŒ‰é’®ç²˜è´´ï¼Œå°†æ•°æ®æ˜¾ç¤ºåœ¨titleä¸Šï¼š</p>

<h6>2ã€å›¾ç‰‡å¤åˆ¶ç²˜è´´</h6>

<p>   ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œå°†å›¾ç‰‡å¤åˆ¶å’Œå‰ªè´´åˆ°å¦å¤–ä¸€ä¸ªUIImageViewä¸­é—´ã€‚</p>

<ul>
<li>1ã€åœ¨ç•Œé¢ä¸Šæ”¾ç½®ä¸¤ä¸ªuiimageviewï¼Œä¸€ä¸ªæ˜¯å›¾ç‰‡çš„æ•°æ®æºï¼Œä¸€ä¸ªæ˜¯å°†å›¾ç‰‡ç²˜è´´åˆ°çš„åœ°æ–¹ã€‚CopyPasteImageViewController ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>


<p>@interface CopyPasteImageViewController : UIViewController {
    UIImageView <em>imageView;
    UIImageView </em>pasteView;
    UIImageView <em>selectedView;
}
@property (nonatomic, retain) IBOutlet UIImageView </em>imageView;
@property (nonatomic, retain) IBOutlet UIImageView <em>pasteView;
@property (nonatomic, retain) UIImageView </em>selectedView;
- (void)placeImageOnPasteboard:(id)view;
@end
* 2ã€å½“è§¦æ‘¸å›¾ç‰‡çš„æ—¶å€™æˆ‘ä»¬æ˜¾ç¤ºå¿«æ·èœå•ï¼š</p>

<hr />

<pre><code>- (void)touchesBegan:(NSSet*)touches withEvent:(UIEvent*)event {
    NSSet *copyTouches = [event touchesForView:imageView];
    NSSet *pasteTouches = [event touchesForView:pasteView];

    [self becomeFirstResponder];
    if ([copyTouches count] &gt; 0) {
        [self performSelector:@selector(showMenu:)
                   withObject:imageView afterDelay:0.9f];
    }
    else  if([pasteTouches count] &gt; 0) {
        [self performSelector:@selector(showMenu:)
                   withObject:pasteView afterDelay:0.9f];
    }
    [super touchesBegan:touches withEvent:event];
}

- (void)showMenu:(id)view {
    [self setSelectedView:view];

    UIMenuController * menu = [UIMenuController sharedMenuController];
    [menu setTargetRect: CGRectMake(5, 10, 1, 1) inView: view];
    [menu setMenuVisible: YES animated: YES];
}
</code></pre>

<p>è¿™é‡Œçš„å¿«æ·èœå•ï¼Œæ˜¾ç¤ºä¸‰ä¸ªèœå•é¡¹ï¼šå‰ªè´´ã€ç²˜è´´ã€å¤åˆ¶ï¼š</p>

<hr />

<pre><code>- (BOOL)canPerformAction:(SEL)action withSender:(id)sender{
    if (action == @selector(cut:)) {
        return ([self selectedView] == imageView) ? YES : NO;
    } else if (action == @selector(copy:)) {
        return ([self selectedView] == imageView) ? YES : NO;
    } else if (action == @selector(paste:)) {
        return ([self selectedView] == pasteView) ? YES : NO;
    } else if (action == @selector(select:)) {
        return NO;
    } else if (action == @selector(selectAll:)) {
        return NO;
    } else {
        return [super canPerformAction:action withSender:sender];
    }
}
- (void)cut:(id)sender {
    [self copy:sender];
    [imageView setHidden:YES];
}
- (void)copy:(id)sender {
    [self placeImageOnPasteboard:[self imageView]];
}
- (void)paste:(id)sender {
    UIPasteboard *appPasteBoard =
    [UIPasteboard pasteboardWithName:@"CopyPasteImage" create:YES];
    NSData *data =[appPasteBoard dataForPasteboardType:@"com.marizack.CopyPasteImage.imageView"];
    pasteView.image = [UIImage imageWithData:data];
}
</code></pre>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/11/08/nian-tie-shen-jiu/">é˜…è¯»å…¨æ–‡ğŸ˜˜</a>
    </footer>
  




| <a href="/blog/2015/11/08/nian-tie-shen-jiu/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/03/chang-yong-guan-jian-zi-zong-jie/">å¸¸ç”¨å…³é”®å­—æ€»ç»“</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><table>
<thead>
<tr>
<th> Name  </th>
<th style="text-align:center;"> Typedef</th>
<th style="text-align:right;">  Header</th>
<th>     True Value  </th>
<th> False Value</th>
</tr>
</thead>
<tbody>
<tr>
<td> BOOL</td>
<td style="text-align:center;">     signed char objc.h</td>
<td style="text-align:right;">     YES</td>
<td>    NO</td>
<td></td>
</tr>
<tr>
<td> bool  </td>
<td style="text-align:center;"> _Bool (int)   </td>
<td style="text-align:right;"> stdbool.h true    </td>
<td> false</td>
<td></td>
</tr>
<tr>
<td> Boolean</td>
<td style="text-align:center;">  unsigned char</td>
<td style="text-align:right;">  MacTypes.h  TRUE    </td>
<td> FALSE</td>
<td></td>
</tr>
<tr>
<td> NSNumber</td>
<td style="text-align:center;">     __NSCFBoolean</td>
<td style="text-align:right;">  Foundation.h    </td>
<td> @(YES)</td>
<td>   @(NO)</td>
</tr>
<tr>
<td> CFBooleanRef</td>
<td style="text-align:center;">     struct</td>
<td style="text-align:right;">     CoreFoundation.h    </td>
<td> kCFBooleanTrue</td>
<td>   kCFBooleanFalse</td>
</tr>
</tbody>
</table>


<table>
<thead>
<tr>
<th> æ ‡å¿—    </th>
<th style="text-align:center;"> å€¼</th>
<th style="text-align:right;">  å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td> NULL</td>
<td style="text-align:center;">     (void *)0   </td>
<td style="text-align:right;"> CæŒ‡é’ˆçš„å­—é¢é›¶å€¼</td>
</tr>
<tr>
<td> nil   </td>
<td style="text-align:center;"> (id)0 </td>
<td style="text-align:right;"> Objective-Cå¯¹è±¡çš„å­—é¢é›¶å€¼</td>
</tr>
<tr>
<td> Nil   </td>
<td style="text-align:center;"> (Class)0  </td>
<td style="text-align:right;"> Objective-Cç±»çš„å­—é¢é›¶å€¼</td>
</tr>
<tr>
<td> NSNull    </td>
<td style="text-align:center;"> [NSNull null] </td>
<td style="text-align:right;"> ç”¨æ¥è¡¨ç¤ºé›¶å€¼çš„å•ç‹¬çš„å¯¹è±¡</td>
</tr>
</tbody>
</table>

</div>
  
  




| <a href="/blog/2015/11/03/chang-yong-guan-jian-zi-zong-jie/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/10/metal/">Metalæ·±ç©¶</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>å­¦ä¹ ä½¿ç”¨è‹¹æœGPUåŠ é€Ÿ3Dç»˜å›¾çš„æ–°API:Metalï¼</p>

<p>åœ¨iOS 8é‡Œï¼Œè‹¹æœå‘å¸ƒäº†ä¸€ä¸ªæ–°çš„æ¥å£å«åšMetalï¼Œå®ƒæ˜¯ä¸€ä¸ªæ”¯æŒGPUåŠ é€Ÿ3Dç»˜å›¾çš„APIã€‚</p>

<p>Metalå’ŒOpenGL ESç›¸ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåº•å±‚APIï¼Œè´Ÿè´£å’Œ3Dç»˜å›¾ç¡¬ä»¶äº¤äº’ã€‚å®ƒä»¬ä¹‹é—´çš„ä¸åŒåœ¨äºï¼ŒMetalä¸æ˜¯è·¨å¹³å°çš„ã€‚ä¸ä¹‹ç›¸åçš„ï¼Œå®ƒè®¾è®¡çš„åœ¨è‹¹æœç¡¬ä»¶ä¸Šè¿è¡Œå¾—æå…¶é«˜æ•ˆï¼Œä¸OpenGL ESç›¸æ¯”ï¼Œå®ƒæä¾›äº†æ›´å¿«çš„é€Ÿåº¦å’Œæ›´ä½çš„å¼€é”€ã€‚</p>

<p>åœ¨è¿™ç¯‡æ•™ç¨‹é‡Œï¼Œä½ å°†ä¼šè·å¾—äº²èº«çš„ç»å†ï¼Œä½¿ç”¨Metalå’ŒSwiftæ¥åˆ›å»ºä¸€ä¸ªæœ‰åŸºæœ¬è„‰ç»œçš„åº”ç”¨ï¼šç”»ä¸€ä¸ªç®€å•çš„ä¸‰è§’å½¢ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ å°†ä¼šå­¦ä¹ ä¸€äº›Metalé‡Œæœ€é‡è¦çš„ç±»ï¼Œæ¯”å¦‚devicesã€command queuesï¼Œç­‰ç­‰ã€‚</p>

<p>è¿™ç¯‡æ•™ç¨‹æ˜¯è®¾è®¡ä¸ºä»»ä½•äººå¯ä»¥é˜…è¯»æ˜ç™½ï¼Œæ— è®ºä½ æ˜¯å¦å­¦ä¹ è¿‡3Dç»˜å›¾ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¼šè¿‡å¾—å¾ˆå¿«ã€‚å¦‚æœä½ ä¹‹å‰æœ‰è¿‡3Dç¼–ç¨‹æˆ–è€…æ˜¯OpenGLç¼–ç¨‹çš„ç»å†ï¼Œä½ ä¼šå‘ç°å®ƒéå¸¸ç®€å•ï¼Œå› ä¸ºé‡Œé¢çš„å¾ˆå¤šæ¦‚å¿µä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚</p>

<p>è¿™ç¯‡æ•™ç¨‹å‡è®¾ä½ å·²ç»ç†Ÿæ‚‰Swiftäº†ã€‚å¦‚æœä½ è¿˜æ˜¯ä¸ªSwiftæ–°æ‰‹ï¼Œå…ˆå­¦ä¹ è¿™äº›æ•™ç¨‹å§ï¼Œè‹¹æœSwiftç«™ç‚¹ã€ä¸€äº›Swiftæ•™ç¨‹ã€‚</p>

<p>æ³¨æ„ï¼šMetalåº”ç”¨ä¸èƒ½è·‘åœ¨iOSæ¨¡æ‹Ÿå™¨ä¸Šï¼Œå®ƒä»¬éœ€è¦ä¸€ä¸ªè®¾å¤‡ï¼Œè®¾å¤‡ä¸Šè£…è½½ç€è‹¹æœA7èŠ¯ç‰‡æˆ–è€…æ›´æ–°çš„èŠ¯ç‰‡ã€‚æ‰€ä»¥è¦å­¦ä¹ è¿™ç¯‡æ•™ç¨‹ï¼Œä½ éœ€è¦ä¸€å°è¿™æ ·çš„è®¾å¤‡(iPhone 5S,iPad Air,iPad mini2)æ¥å®Œæˆä»£ç çš„æµ‹è¯•ã€‚</p>

<pre><code>Metal vs. Sprite Kit, Scene Kit, or Unity
</code></pre>

<p>åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œæˆ‘æƒ³è¦è®¨è®ºæ€æ ·æ¯”è¾ƒMetalå’Œä¸€äº›æ²¡é‚£ä¹ˆåº•å±‚çš„æ¡†æ¶ï¼Œæ¯”å¦‚ï¼šSprite Kitï¼ŒScene Kitæˆ–è€…Unityã€‚</p>

<p>Metalæ˜¯ä¸€ä¸ªåº•å±‚3Dç»˜å›¾APIï¼Œå’ŒOpenGLç±»ä¼¼ï¼Œä½†æ˜¯å®ƒçš„å¼€é”€æ›´ä½ã€‚å®ƒæ˜¯ä¸€ä¸ªGPUä¸Šä¸€ä¸ªç®€å•çš„å°è£…ï¼Œæ‰€ä»¥èƒ½å¤Ÿå®Œæˆå‡ ä¹æ‰€æœ‰äº‹æƒ…ï¼Œåƒ åœ¨å±å¹•ä¸Šæ¸²æŸ“ä¸€ä¸ªç²¾çµï¼ˆspriteï¼‰æˆ–è€…æ˜¯ä¸€ä¸ª3Dæ¨¡å‹ã€‚ä½†ä½ è¦ç¼–å†™å®Œæˆè¿™äº›äº‹æƒ…çš„æ‰€æœ‰ä»£ç ã€‚è¿™æ ·éº»çƒ¦çš„ä»£ä»·æ˜¯ï¼Œä½ æ‹¥æœ‰äº†GPUçš„åŠ›é‡å’Œæ§åˆ¶ã€‚</p>

<p>æ²¡é‚£ä¹ˆåº•å±‚çš„æ¸¸æˆæ¡†æ¶ï¼ŒåƒSprite Kitã€Scene Kitæˆ–è€…Unityéƒ½æ˜¯åœ¨åº•å±‚3Dç»˜å›¾APIï¼ˆåƒæ˜¯Metalæˆ–æ˜¯OpenGL ESï¼‰çš„åŸºç¡€ä¸Šæ„å»ºçš„ã€‚å®ƒä»¬æä¾›å¤§éƒ¨åˆ†ä½ éœ€è¦åœ¨æ¸¸æˆä¸­ç¼–å†™çš„åº•å±‚å°è£…ä»£ç ï¼Œæ¯”å¦‚åœ¨å±å¹•ä¸Šæ¸²æŸ“ä¸€ä¸ªç²¾çµ(sprite)æˆ–è€…ä¸€ä¸ª3Dæ¨¡å‹ã€‚</p>

<p>å¦‚æœä½ æ‰€æƒ³è¦åšçš„å°±æ˜¯åˆ¶ä½œä¸€ä¸ªæ¸¸æˆï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä¼šæ¨èä½ ä½¿ç”¨ä¸€ä¸ªæ²¡é‚£ä¹ˆåº•å±‚çš„åº“ï¼ŒåƒSprite Kitã€Scene Kitæˆ–è€…Unityï¼Œå› ä¸ºå®ƒä¼šè®©ä½ çš„å·¥ä½œæ›´è½»æ¾ã€‚å¦‚æœä½ å–œæ¬¢è¿™æ ·ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šæ•™ç¨‹æ¥å¸®åŠ©ä½ å­¦ä¹ è¿™äº›æ¡†æ¶ã€‚</p>

<p>ä½†æ˜¯ï¼Œè¿˜æ˜¯æœ‰ä¸¤ä¸ªå¾ˆå¥½çš„åŸå› æ¥å­¦ä¹ Metalï¼š</p>

<ul>
<li>1.ä½¿ç¡¬ä»¶è¾¾åˆ°è¿è¡Œæ•ˆç‡çš„å³°å€¼ï¼šå› ä¸ºMetaléå¸¸åº•å±‚ï¼Œå®ƒå…è®¸ä½ ä½¿ç¡¬ä»¶è¾¾åˆ°è¿è¡Œæ•ˆç‡çš„å³°å€¼ï¼Œå¯¹ä½ çš„æ¸¸æˆå¦‚ä½•è¿è¡Œæœ‰ç€å®Œå…¨çš„æ§åˆ¶ã€‚</li>
<li>2.è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ ç»å†ï¼šå­¦ä¹ Metalæ•™å¯¼ä½ å¾ˆå¤šå…³äº3Dç»˜å›¾ç¼–ç¨‹çš„æ¦‚å¿µï¼Œç¼–å†™ä½ è‡ªå·±çš„æ¸¸æˆå¼•æ“ï¼Œä»¥åŠé«˜å±‚(higher level)æ¸¸æˆæ¡†æ¶å¦‚ä½•è¿ä½œã€‚</li>
</ul>


<p>å¦‚æœä»¥ä¸Šä»»ä½•ä¸€ç‚¹å¯¹ä½ æ¥è¯´æ˜¯ä¸ªå¥½çš„ç†ç”±ï¼Œç»§ç»­è¯»ä¸‹å»ï¼</p>

<h4>Metal vs OpenGL ES</h4>

<p>ä¸‹é¢è®©æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹Metalå’ŒOpenGL ESçš„ä¸åŒä¹‹å¤„ã€‚</p>

<p>OpenGL ESè¢«è®¾è®¡æˆè·¨å¹³å°çš„ã€‚é‚£æ„å‘³ç€ä½ å¯ä»¥ç”¨C++OpenGL ESçš„ä»£ç ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹åªè¦ä½œå°‘è®¸æ”¹åŠ¨å°±èƒ½è®©å®ƒåœ¨å¦ä¸€ä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œæ¯”å¦‚Androidã€‚</p>

<p>è‹¹æœæ„è¯†åˆ°å°½ç®¡OpenGL ESå¯¹è·¨å¹³å°çš„æ”¯æŒå¾ˆèµï¼Œä½†æ˜¯å®ƒç¼ºå°‘äº†ä¸€äº›è‹¹æœè®¾è®¡äº§å“çš„åŸºæœ¬ç†å¿µï¼šè‹¹æœæŠŠæ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ã€è½¯ä»¶æ•´åˆåœ¨äº†ä¸€èµ·ã€‚</p>

<p>æ‰€ä»¥è‹¹æœè®¤çœŸè€ƒè™‘äº†å¦‚æœä»–ä»¬è®¾è®¡ä¸€å¥—ç‰¹å®šåŸºäºä»–ä»¬ç¡¬ä»¶çš„ç»˜å›¾APIï¼Œä¼šæ˜¯æ€æ ·å‘¢ï¼Ÿå®ƒçš„ç›®æ ‡æ˜¯æé€Ÿè¿è¡Œã€ä½å¼€é”€ä»¥åŠæ”¯æŒæœ€æ–°æœ€å¥½çš„ç‰¹æ€§ã€‚</p>

<p>äºæ˜¯Metalè¯ç”Ÿäº†ã€‚å®ƒå¯¹æ¯”OpenGL ESï¼Œèƒ½ä¸ºä½ çš„åº”ç”¨å•ä½æ—¶é—´å†…æé«˜æœ€é«˜10å€çš„ç»˜å›¾è°ƒç”¨æ¬¡æ•°ã€‚è¿™èƒ½å¤Ÿäº§ç”Ÿè¶…èµçš„ç‰¹æ•ˆï¼Œå°±åƒWWDC 2014 keynoteä¸ŠzenèŠ±å›­æ ·ä¾‹ã€‚</p>

<p>è®©æˆ‘ä»¬å¼€å§‹çœ‹çœ‹ä¸€äº›Metalä»£ç å§ï¼</p>

<p>å¼€å¤´
Xcodeçš„iOSæ¸¸æˆæ¨¡æ¿æœ‰ä¸€ä¸ªMetalé€‰é¡¹ï¼Œä½†æ˜¯ä½ ä¸è¦åœ¨è¿™é‡Œé€‰æ‹©ã€‚è¿™æ˜¯å› ä¸ºæˆ‘æƒ³è¦å‘ä½ ä¸€æ­¥æ­¥å±•ç¤ºå¦‚ä½•ç¼–å†™ä¸€ä¸ªMetalåº”ç”¨ï¼Œæ‰€ä»¥ä½ èƒ½å¤Ÿç†è§£è¿™è¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥éª¤ã€‚</p>

<p>æ‰“å¼€Xcode 6é€šè¿‡iOS\Application\Single View Application templateåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ã€‚ä½¿ç”¨HelloMetalä½œä¸ºé¡¹ç›®åç§°ï¼Œè®¾ç½®å¼€å‘è¯­è¨€ä¸ºSwiftï¼Œè®¾ç½®è®¾å¤‡ä¸ºé€šç”¨è®¾å¤‡(Universal)ã€‚ç‚¹å‡» Nextï¼Œé€‰æ‹©ä¸€ä¸ªç›®å½•ï¼Œç‚¹å‡»Createã€‚</p>

<p>æœ‰ä¸ƒä¸ªæ­¥éª¤æ¥è®¾ç½®metalï¼š</p>

<ul>
<li>1.åˆ›å»ºä¸€ä¸ªMTLDevice</li>
<li>2.åˆ›å»ºä¸€ä¸ªCAMetalLayer</li>
<li>3.åˆ›å»ºä¸€ä¸ªVertex Buffer</li>
<li>4.åˆ›å»ºä¸€ä¸ªVertex Shader</li>
<li>5.åˆ›å»ºä¸€ä¸ªFragment Shader</li>
<li>6.åˆ›å»ºä¸€ä¸ªRender Pipeline</li>
<li>7.åˆ›å»ºä¸€ä¸ªCommand Queue</li>
</ul>


<p>è®©æˆ‘ä»¬ä¸€ä¸ªä¸ªçœ‹å®ƒä»¬ã€‚</p>

<h5>1)åˆ›å»ºä¸€ä¸ªMTLDevice</h5>

<p>ä½¿ç”¨Metalä½ è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è·å–ä¸€ä¸ªMTLDeviceçš„å¼•ç”¨ã€‚</p>

<p>ä½ å¯ä»¥æŠŠä¸€ä¸ªMTLDeviceæƒ³è±¡æˆæ˜¯ä½ å’ŒCPUçš„ç›´æ¥è¿æ¥ã€‚ä½ å°†é€šè¿‡ä½¿ç”¨MTLDeviceåˆ›å»ºæ‰€æœ‰å…¶ä»–ä½ éœ€è¦çš„Metalå¯¹è±¡ï¼ˆåƒæ˜¯command queuesï¼Œbuffersï¼Œtexturesï¼‰ã€‚</p>

<p>ä¸ºäº†å®Œæˆè¿™ç‚¹ï¼Œæ‰“å¼€ViewController.swift å¹¶æ·»åŠ ä¸‹é¢çš„importè¯­å¥åˆ°æ–‡ä»¶æœ€ä¸Šæ–¹ï¼š</p>

<pre><code>import Metal 
</code></pre>

<p>è¿™å¯¼å…¥äº†Metalæ¡†æ¶ï¼Œæ‰€ä»¥ä½ èƒ½å¤Ÿä½¿ç”¨Metalçš„ç±»ï¼ˆåƒè¿™æ–‡ä»¶ä¸­çš„MTLDeviceï¼‰ã€‚æ¥ç€ï¼Œåœ¨ViewControllerç±»ä¸­æ·»åŠ ä»¥ä¸‹å±æ€§ï¼š</p>

<pre><code>var device: MTLDevice! = nil 
</code></pre>

<p>ä½ å°†è¦åœ¨viewDidLoadå‡½æ•°å†…åˆå§‹åŒ–è¿™ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªinitå‡½æ•°é‡Œï¼Œæ‰€ä»¥å®ƒä¸å¾—ä¸æ˜¯ä¸€ä¸ªoptionalã€‚æ—¢ç„¶ä½ çŸ¥é“ä½ ä¸€å®šä¼š åœ¨ä½¿ç”¨å®ƒå‰åˆå§‹åŒ–å®ƒï¼Œä½ ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºä¸€ä¸ªéšå¼ä¸åŒ…è£¹çš„optionalã€‚æœ€åï¼Œæ·»åŠ è¿™ä¸€è¡Œåˆ°viewDidLoadå‡½æ•°çš„æœ€åã€‚</p>

<pre><code>device = MTLCreateSystemDefaultDevice() 
</code></pre>

<p>è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªé»˜è®¤MTLDeviceå¼•ç”¨ï¼Œä½ çš„ä»£ç å°†ä¼šç”¨åˆ°å®ƒã€‚</p>

<h5>2ï¼‰åˆ›å»ºä¸€ä¸ªCAMetalLayer</h5>

<p>åœ¨iOSé‡Œï¼Œä½ åœ¨å±å¹•ä¸Šçœ‹è§çš„æ‰€æœ‰ä¸œè¥¿ï¼Œè¢«ä¸€ä¸ªCALayeræ‰€æ‰¿è½½ã€‚å­˜åœ¨ä¸åŒç‰¹æ•ˆçš„CALayerçš„å­ç±»ï¼Œæ¯”å¦‚ï¼šæ¸å˜å±‚(gradient layers)ã€å½¢çŠ¶å±‚ï¼ˆshape layersï¼‰ã€é‡å¤å±‚(replicator layers) ç­‰ç­‰ã€‚</p>

<p>å¥½çš„ï¼Œå¦‚æœä½ æƒ³è¦ç”¨Metalåœ¨å±å¹•ä¸Šç”»ä¸€äº›ä¸œè¥¿ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªç‰¹åˆ«çš„CALayerå­ç±»ï¼ŒCAMetalLayerã€‚æ‰€ä»¥åœ¨ä½ çš„viewcontrollerä¸­æ·»åŠ ä¸€ä¸ªã€‚</p>

<p>é¦–å…ˆåœ¨è¿™ä¸ªæ–‡ä»¶çš„ä¸Šæ–¹æ·»åŠ importè¯­å¥ã€‚</p>

<pre><code>import QuartzCore 
</code></pre>

<p>ä½ éœ€è¦å®ƒå› ä¸ºCAMetalLayeræ˜¯QuartzCoreæ¡†æ¶çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯Metalæ¡†æ¶é‡Œçš„ã€‚</p>

<p>ç„¶åæŠŠæ–°å±æ€§æ·»åŠ åˆ°ç±»ä¸­ï¼š</p>

<pre><code>var metalLayer: CAMetalLayer! = nil 
</code></pre>

<p>è¿™å°†ä¼šå­˜å‚¨ä½ æ–°layerçš„å¼•ç”¨ã€‚</p>

<p>æœ€åï¼ŒæŠŠè¿™è¡Œä»£ç æ·»åŠ åˆ°viewDidLoadæ–¹æ³•æœ€åã€‚</p>

<pre><code> 1 metalLayer = CAMetalLayer()          // 1 
 2 
 3 metalLayer.device = device           // 2 
 4 
 5 metalLayer.pixelFormat = .BGRA8Unorm // 3 
 6 
 7 metalLayer.framebufferOnly = true    // 4 
 8 
 9 metalLayer.frame = view.layer.frame  // 5 
10 
11 view.layer.addSublayer(metalLayer)   // 6 
</code></pre>

<p>è®©æˆ‘ä»¬ä¸€è¡Œè¡Œæ¥çœ‹ï¼š</p>

<ul>
<li>a.ä½ åˆ›å»ºäº†ä¸€ä¸ªCAMetalLayer</li>
<li>b.ä½ å¿…é¡»æ˜ç¡®layerä½¿ç”¨çš„MTLDeviceï¼Œä½ ç®€å•åœ°è®¾ç½®ä½ æ—©å‰è·å–çš„deviceã€‚</li>
<li>c.ä½ æŠŠåƒç´ æ ¼å¼ï¼ˆpixel formatï¼‰è®¾ç½®ä¸ºBGRA8Unormï¼Œå®ƒä»£è¡¨â€8å­—èŠ‚ä»£è¡¨è“è‰²ã€ç»¿è‰²ã€çº¢è‰²å’Œé€æ˜åº¦ï¼Œé€šè¿‡åœ¨0åˆ°1ä¹‹é—´å•ä½åŒ–çš„å€¼æ¥è¡¨ç¤ºâ€ã€‚è¿™æ¬¡ä¸¤ç§ç”¨åœ¨CAMetalLayerçš„åƒç´ æ ¼å¼ä¹‹ä¸€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½ è¿™æ ·å†™å°±å¯ä»¥äº†ã€‚</li>
<li>d.è‹¹æœé¼“åŠ±ä½ è®¾ç½®framebufferOnlyä¸ºtrueï¼Œæ¥å¢å¼ºè¡¨ç°æ•ˆç‡ã€‚é™¤éä½ éœ€è¦å¯¹ä»layerç”Ÿæˆçš„çº¹ç†ï¼ˆtexturesï¼‰å– æ ·ï¼Œæˆ–è€…ä½ éœ€è¦åœ¨layerç»˜å›¾çº¹ç†(drawable textures)æ¿€æ´»ä¸€äº›è®¡ç®—å†…æ ¸ï¼Œå¦åˆ™ä½ ä¸éœ€è¦è®¾ç½®ã€‚ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ ä¸ç”¨è®¾ç½®ï¼‰</li>
<li>e.ä½ æŠŠlayerçš„frameè®¾ç½®ä¸ºviewçš„frameã€‚</li>
<li>f.ä½ æŠŠlayerä½œä¸ºview.layerä¸‹çš„å­layeræ·»åŠ ã€‚</li>
</ul>


<h5>3ï¼‰åˆ›å»ºä¸€ä¸ªVertex Buffer</h5>

<p>åœ¨Metalé‡Œæ¯ä¸€ä¸ªä¸œè¥¿éƒ½æ˜¯ä¸‰è§’å½¢ã€‚åœ¨è¿™ä¸ªåº”ç”¨é‡Œï¼Œä½ åªéœ€è¦ç”»ä¸€ä¸ªä¸‰è§’å½¢ï¼Œä¸è¿‡å³ä½¿æ˜¯æå…¶å¤æ‚çš„3Då½¢çŠ¶ä¹Ÿèƒ½è¢«è§£æ„ä¸ºä¸€ç³»åˆ—çš„ä¸‰è§’å½¢ã€‚</p>

<p>åœ¨Metalé‡Œï¼Œé»˜è®¤çš„åæ ‡ç³»æ˜¯å‘é‡åæ ‡ç³»ï¼Œè¿™æ„å‘³ç€é»˜è®¤çš„æ—¶å€™ï¼Œä¸€ä¸ª2x2x1çš„ç«‹æ–¹ä½“ï¼Œä¸­å¿ƒç‚¹æ˜¯(0,0,0.5)ã€‚</p>

<p>å¦‚æœä½ è®¤ä¸ºz=0æ˜¯å¹³é¢ï¼Œé‚£ä¹ˆ(-1,-1,0)å°±æ˜¯å·¦ä¸‹è§’ï¼Œ(0,0,0)å°±æ˜¯ä¸­å¿ƒï¼Œ(1,1,0)æ˜¯å³ä¸Šè§’ã€‚åœ¨è¿™ç¯‡æ•™ç¨‹ä¸­ï¼Œä½ æƒ³è¦åœ¨è¿™äº›ç‚¹ä¸Šç”»ä¸‰è§’å½¢ï¼š</p>

<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºã€‚åœ¨ä½ çš„ç±»ä¸­æ·»åŠ ä¸‹åˆ—çš„å¸¸é‡å±æ€§ï¼š</p>

<pre><code>let vertexData:[Float] = [ 
  0.0, 1.0, 0.0, 
  -1.0, -1.0, 0.0, 
  1.0, -1.0, 0.0] 
</code></pre>

<p>è¿™åœ¨CPUåˆ›å»ºä¸€ä¸ªæµ®ç‚¹æ•°æ•°ç»„â€”â€”ä½ éœ€è¦é€šè¿‡æŠŠå®ƒç§»åŠ¨åˆ°ä¸€ä¸ªå«MTLBufferçš„ä¸œè¥¿ï¼Œæ¥å‘é€è¿™äº›æ•°æ®åˆ°GPUã€‚</p>

<p>æ·»åŠ å¦ä¸€ä¸ªæ–°çš„å±æ€§ï¼š</p>

<pre><code>var vertexBuffer: MTLBuffer! = nil 
ç„¶ååœ¨ viewDidLoad æ–¹æ³•çš„æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
let dataSize = vertexData.count * sizeofValue(vertexData[0]) // 1 
vertexBuffer = device.newBufferWithBytes(vertexData, length: dataSize, options: nil) // 2 
</code></pre>

<p>è®©æˆ‘ä»¬ä¸€è¡Œè¡Œæ¥çœ‹ï¼š</p>

<ul>
<li>a.ä½ éœ€è¦è·å–vertex dataçš„å­—èŠ‚å¤§å°ã€‚ä½ é€šè¿‡æŠŠç¬¬ä¸€ä¸ªå…ƒç´ çš„å¤§å°å’Œæ•°ç»„å…ƒç´ ä¸ªæ•°ç›¸ä¹˜æ¥å¾—åˆ°ã€‚</li>
<li>b.ä½ åœ¨MTLDeviceä¸Šè°ƒç”¨newBufferWithBytes(length:options:) ï¼Œåœ¨GPUåˆ›å»ºä¸€ä¸ªæ–°çš„bufferï¼Œä»CPUé‡Œè¾“é€dataã€‚ä½ ä¼ é€’nilæ¥æ¥å—é»˜è®¤çš„é€‰é¡¹ã€‚</li>
</ul>


<h5>4ï¼‰åˆ›å»ºä¸€ä¸ªVertex Shader</h5>

<p>ä½ ä¹‹å‰åˆ›å»ºçš„é¡¶ç‚¹å°†æˆä¸ºä½ æ¥ä¸‹æ¥å†™çš„ä¸€ä¸ªå«vertext shaderçš„å°ç¨‹åºçš„è¾“å…¥ã€‚</p>

<p>ä¸€ä¸ªvertex shader æ˜¯ä¸€ä¸ªåœ¨GPUä¸Šè¿è¡Œçš„å°ç¨‹åºï¼Œå®ƒç”±åƒc++çš„ä¸€é—¨è¯­è¨€ç¼–å†™ï¼Œé‚£é—¨è¯­è¨€å«åšMetal Shading Languageã€‚</p>

<p>ä¸€ä¸ªvertex shaderè¢«æ¯ä¸ªé¡¶ç‚¹è°ƒç”¨ï¼Œå®ƒçš„å·¥ä½œæ˜¯æ¥å—é¡¶ç‚¹çš„ä¿¡æ¯ï¼ˆå¦‚ï¼šä½ç½®å’Œé¢œè‰²ã€çº¹ç†åæ ‡ï¼‰ï¼Œè¿”å›ä¸€ä¸ªæ½œåœ¨çš„ä¿®æ­£ä½ç½®ï¼ˆå¯èƒ½è¿˜æœ‰åˆ«çš„ç›¸å…³ä¿¡æ¯ï¼‰ã€‚</p>

<p>ä¸ºäº†æŠŠäº‹æƒ…ä¿æŒç®€å•ï¼Œä½ çš„vertex shaderå°†ä¼šè¿”å›ä¸€ä¸ªå’Œä¼ é€’ä½ç½®ç›¸åŒçš„ä½ç½®ã€‚</p>

<p>æœ€ç®€å•çš„äº†è§£ vertex shader çš„æ–¹æ³•æ˜¯ï¼Œè‡ªå·±ä½“éªŒã€‚ç‚¹å‡»File\New\Fileï¼Œé€‰æ‹©iOS\Source\Metal Fileï¼Œç„¶åç‚¹å‡»Nextã€‚è¾“å…¥Shader.metalä½œä¸ºæ–‡ä»¶åä¸ŠæŒ‰å›è½¦ï¼Œç„¶åç‚¹å‡»Createã€‚</p>

<p>æ³¨æ„ï¼šåœ¨Metalé‡Œï¼Œä½ èƒ½å¤Ÿåœ¨ä¸€ä¸ªMetalæ–‡ä»¶é‡ŒåŒ…å«å¤šä¸ªshadersã€‚ä½ ä¹Ÿèƒ½æŠŠä½ çš„shader åˆ†æ•£åœ¨å¤šä¸ªMetalæ–‡ä»¶ä¸­ã€‚Metalä¼šä»ä»»æ„Metalæ–‡ä»¶ä¸­åŠ è½½ä½ é¡¹ç›®åŒ…å«çš„shadersã€‚
åœ¨Shaders.metalåº•éƒ¨æ·»åŠ ä¸‹åˆ—ä»£ç ï¼š</p>

<pre><code>metalLayer = CAMetalLayer()          // 1 

metalLayer.device = device           // 2 

metalLayer.pixelFormat = .BGRA8Unorm // 3 

metalLayer.framebufferOnly = true    // 4 

metalLayer.frame = view.layer.frame  // 5 

view.layer.addSublayer(metalLayer)   // 6
</code></pre>

<p>è®©æˆ‘ä»¬ä¸€è¡Œè¡Œæ¥çœ‹ï¼š</p>

<ul>
<li>a.æ‰€æœ‰çš„vertex shaderså¿…é¡»ä»¥å…³é”®å­—vertexå¼€å¤´ã€‚å‡½æ•°å¿…é¡»è‡³å°‘è¿”å›é¡¶ç‚¹çš„æœ€ç»ˆä½ç½®â€”â€”ä½ é€šè¿‡æŒ‡å®šfloat4ï¼ˆä¸€ä¸ªå…ƒç´ ä¸º4ä¸ªæµ®ç‚¹æ•°çš„å‘é‡ï¼‰ã€‚ç„¶åä½ ç»™ä¸€ä¸ªåå­—ç»™vetex shaderï¼Œä»¥åä½ å°†ç”¨è¿™ä¸ªåå­—æ¥è®¿é—®è¿™ä¸ªvertex shaderã€‚</li>
<li>b.ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªå…ƒç´ ä¸ºpacked_float3(ä¸€ä¸ªå‘é‡åŒ…å«3ä¸ªæµ®ç‚¹æ•°)çš„æ•°ç»„çš„æŒ‡é’ˆï¼Œå¦‚ï¼šæ¯ä¸ªé¡¶ç‚¹çš„ä½ç½®ã€‚è¿™ä¸ª [[ &hellip; ]] è¯­æ³•è¢«ç”¨åœ¨å£°æ˜é‚£äº›èƒ½è¢«ç”¨ä½œç‰¹å®šé¢å¤–ä¿¡æ¯çš„å±æ€§ï¼Œåƒæ˜¯èµ„æºä½ç½®ï¼Œshaderè¾“å…¥ï¼Œå†…å»ºå˜é‡ã€‚è¿™é‡Œä½ æŠŠè¿™ä¸ªå‚æ•°ç”¨ [[ buffer(0) ]] æ ‡è®°ï¼Œæ¥æŒ‡æ˜è¿™ä¸ªå‚æ•°å°†ä¼šè¢«åœ¨ä½ ä»£ç ä¸­ä½ å‘é€åˆ°ä½ çš„vertex shaderçš„ç¬¬ä¸€å—buffer dataæ‰€éå†ã€‚</li>
<li>c.vertex shaderä¼šæ¥å—ä¸€ä¸ªåå«vertex_idçš„å±æ€§çš„ç‰¹å®šå‚æ•°ï¼Œå®ƒæ„å‘³ç€å®ƒä¼šè¢«vertexæ•°ç»„é‡Œç‰¹å®šçš„é¡¶ç‚¹æ‰€è£…å…¥ã€‚</li>
<li>d.ç°åœ¨ä½ åŸºäºvertex idæ¥æ£€ç´¢vertexæ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„vertexå¹¶æŠŠå®ƒè¿”å›ã€‚åŒæ—¶ä½ æŠŠè¿™ä¸ªå‘é‡è½¬æ¢ä¸ºä¸€ä¸ªfloat4ç±»å‹ï¼Œæœ€åçš„valueè®¾ç½®ä¸º1.0ï¼ˆç®€å•çš„æ¥è¯´ï¼Œè¿™æ˜¯3Dæ•°å­¦è¦æ±‚çš„ï¼‰ã€‚</li>
</ul>


<h5>5ï¼‰åˆ›å»ºä¸€ä¸ªFragment Shader</h5>

<p>å®Œæˆæˆ‘ä»¬çš„vertex shaderåï¼Œå¦ä¸€ä¸ªshaderï¼Œå®ƒè¢«æ¯ä¸ªåœ¨å±å¹•ä¸Šçš„fragment(think pixel)è°ƒç”¨ï¼Œå®ƒå°±æ˜¯fragment shaderã€‚</p>

<p>fragment shaderé€šè¿‡å†…æ’(interpolating)vertex shaderçš„è¾“å‡ºè¿˜è·å¾—è‡ªå·±çš„è¾“å…¥ã€‚æ¯”å¦‚ï¼šæ€è€ƒåœ¨ä¸‰è§’å½¢ä¸¤ä¸ªåº•é¡¶ç‚¹ä¹‹é—´çš„fragmentï¼š</p>

<p>fragmentçš„è¾“å…¥å€¼å°†ä¼šç”±50%çš„å·¦ä¸‹è§’é¡¶ç‚¹å’Œ50%çš„å³ä¸‹è§’é¡¶ç‚¹ç»„æˆã€‚</p>

<p>fragment shaderçš„å·¥ä½œæ˜¯ç»™æ¯ä¸ªfragmentè¿”å›æœ€åçš„é¢œè‰²ã€‚ä¸ºäº†ç®€ä¾¿ï¼Œä½ å°†ä¼šæŠŠæ¯ä¸ªfragmentè¿”å›ç™½è‰²ã€‚</p>

<p>åœ¨Shader.metalçš„åº•éƒ¨æ·»åŠ ä¸‹åˆ—ä»£ç ï¼š</p>

<pre><code>1 fragment half4 basic_fragment() { // 1 
2 
3 return half4(1.0);              // 2 
4 
5 } 
</code></pre>

<p>è®©æˆ‘ä»¬ä¸€è¡Œè¡Œæ¥çœ‹ï¼š</p>

<ul>
<li><ol type="a">
<li>æ‰€æœ‰fragment shaderså¿…é¡»ä»¥fragmentå…³é”®å­—å¼€å§‹ã€‚è¿™ä¸ªå‡½æ•°å¿…é¡»è‡³å°‘è¿”å›fragmentçš„æœ€ç»ˆé¢œè‰²â€”â€”ä½ é€šè¿‡æŒ‡å®šhalf4ï¼ˆä¸€ä¸ªé¢œè‰²çš„RGBAå€¼ï¼‰æ¥ å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚æ³¨æ„ï¼Œhalf4æ¯”float4åœ¨å†…å­˜ä¸Šæ›´æœ‰æ•ˆç‡ï¼Œå› ä¸ºï¼Œä½ å†™å…¥äº†æ›´å°‘çš„GPUå†…å­˜ã€‚</li>
</ol>
</li>
<li><ol type="a">
<li>è¿™é‡Œä½ è¿”å›(1,1,1,1)çš„é¢œè‰²ï¼Œä¹Ÿå°±æ˜¯ç™½è‰²ã€‚</li>
</ol>
</li>
</ul>


<h5>6ï¼‰åˆ›å»ºä¸€ä¸ªRender Pipeline</h5>

<p>ç°åœ¨ä½ å·²ç»åˆ›å»ºäº†ä¸€ä¸ªvertex shaderå’Œä¸€ä¸ªfragment shaderï¼Œä½ éœ€è¦ç»„åˆå®ƒä»¬ï¼ˆåŠ ä¸Šä¸€äº›é…ç½®æ•°æ®ï¼‰åˆ°ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒåå«render pipelineã€‚Metalä¸€ä¸ªå¾ˆé…·çš„åœ°æ–¹æ˜¯ï¼Œæ¸²æŸ“å™¨ï¼ˆshadersï¼‰æ˜¯é¢„ç¼–è¯‘çš„ï¼Œrender pipeline é…ç½®ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è®¾ç½®å®ƒçš„æ—¶å€™è¢«ç¼–è¯‘ï¼Œæ‰€ä»¥æ‰€æœ‰äº‹æƒ…éƒ½æå…¶é«˜æ•ˆã€‚</p>

<ol>
<li><p>é¦–å…ˆåœ¨ViewController.swifté‡Œæ·»åŠ ä¸€ä¸ªå±æ€§ï¼š
var pipelineState: MTLRenderPipelineState! = nil
è¿™ä¼šå¯¹ä½ å³å°†è¦åˆ›å»ºçš„render pipeline ï¼Œåœ¨å®ƒè¢«ç¼–è¯‘åè¿›è¡Œè·Ÿè¸ªã€‚</p></li>
<li><p>æ¥ç€ï¼Œåœ¨ viewDidLoad æ–¹æ³•æœ€åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p></li>
</ol>


<p>// 1</p>

<pre><code>1 let defaultLibrary = device.newDefaultLibrary() 
2 
3 let fragmentProgram = defaultLibrary.newFunctionWithName("basic_fragment") 
4 
5 let vertexProgram = defaultLibrary.newFunctionWithName("basic_vertex") 
</code></pre>

<p>// 2</p>

<pre><code>let pipelineStateDescriptor = MTLRenderPipelineDescriptor() 

pipelineStateDescriptor.vertexFunction = vertexProgram 

pipelineStateDescriptor.fragmentFunction = fragmentProgram 

pipelineStateDescriptor.colorAttachments[0].pixelFormat = .BGRA8Unorm
</code></pre>

<p>//3</p>

<pre><code>pipelineState = device.newRenderPipelineStateWithDescriptor(pipelineStateDescriptor, error: &amp;pipelineError) 

if !pipelineState { 

  println("Failed to create pipeline state, error \(pipelineError)") 

}
</code></pre>

<p>è®©æˆ‘ä»¬åˆ†éƒ¨åˆ†çœ‹è¿™äº›ä»£ç ï¼š</p>

<ul>
<li>a.ä½ å¯ä»¥é€šè¿‡è°ƒç”¨device.newDefaultLibraryæ–¹æ³•è·å¾—çš„MTLibraryå¯¹è±¡è®¿é—®åˆ°ä½ é¡¹ç›®ä¸­çš„é¢„ç¼–è¯‘shadersã€‚ç„¶åä½ èƒ½å¤Ÿé€šè¿‡åå­—æ£€ç´¢æ¯ä¸ªshaderã€‚</li>
<li>b.ä½ åœ¨è¿™é‡Œè®¾ç½®ä½ çš„render pipelineã€‚å®ƒåŒ…å«ä½ æƒ³è¦ä½¿ç”¨çš„shadersã€é¢œè‰²é™„ä»¶ï¼ˆcolor attachmentï¼‰çš„åƒç´ æ ¼å¼(pixel format)ã€‚ï¼ˆä¾‹å¦‚ï¼šä½ æ¸²æŸ“åˆ°çš„è¾“å…¥ç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯CAMetalLayerï¼‰ã€‚</li>
<li>c.æœ€åï¼Œä½ æŠŠè¿™ä¸ªpipeline é…ç½®ç¼–è¯‘åˆ°ä¸€ä¸ªpipeline çŠ¶æ€(state)ä¸­ï¼Œè®©å®ƒä½¿ç”¨èµ·æ¥æœ‰æ•ˆç‡ã€‚</li>
</ul>


<h5>7ï¼‰åˆ›å»ºä¸€ä¸ªCommand Queue</h5>

<p>ä½ éœ€è¦åšçš„æœ€ç»ˆçš„ä¸€æ¬¡æ€§è®¾ç½®æ­¥éª¤ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªMTLCommandQueueã€‚</p>

<p>æŠŠè¿™ä¸ªæƒ³è±¡æˆæ˜¯ä¸€ä¸ªåˆ—è¡¨è£…è½½ç€ä½ å‘Šè¯‰GPUä¸€æ¬¡è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>

<p>è¦åˆ›å»ºä¸€ä¸ªcommand queueï¼Œç®€å•åœ°æ·»åŠ ä¸€ä¸ªå±æ€§ï¼š</p>

<pre><code>var commandQueue: MTLCommandQueue! = nil 
</code></pre>

<p>æŠŠä¸‹é¢è¿™è¡Œæ·»åŠ åˆ° viewDidLoad çš„æœ€åï¼š</p>

<pre><code>commandQueue = device.newCommandQueue() 
</code></pre>

<p>æ­å–œï¼Œä½ çš„é¢„è®¾ç½®çš„ä»£ç å®Œæˆäº†ã€‚</p>

<p>æ¸²æŸ“ä¸‰è§’å½¢
ç°åœ¨ï¼Œæ˜¯æ—¶å€™å­¦ä¹ æ¯å¸§æ‰§è¡Œçš„ä»£ç ï¼Œæ¥æ¸²æŸ“è¿™ä¸ªä¸‰è§’å½¢ï¼</p>

<p>å®ƒå°†åœ¨äº”ä¸ªæ­¥éª¤ä¸­è¢«å®Œæˆï¼š</p>

<ul>
<li>1.åˆ›å»ºä¸€ä¸ªDisplay linkã€‚</li>
<li>2.åˆ›å»ºä¸€ä¸ªRender Pass Descriptor</li>
<li>3.åˆ›å»ºä¸€ä¸ªCommand Buffer</li>
<li>4.åˆ›å»ºä¸€ä¸ªRender Command Encoder</li>
<li>5.æäº¤ä½ Command Bufferçš„å†…å®¹ã€‚</li>
</ul>


<p>è®©æˆ‘ä»¬æ·±å…¥æ¥çœ‹ï¼</p>

<blockquote><p>æ³¨æ„ï¼šç†è®ºä¸Šè¿™ä¸ªåº”ç”¨å®é™…ä¸Šä¸éœ€è¦æ¯å¸§æ¸²æŸ“ï¼Œå› ä¸ºä¸‰è§’å½¢è¢«ç»˜åˆ¶ä¹‹åä¸ä¼šåŠ¨ã€‚ä½†æ˜¯ï¼Œå¤§éƒ¨åˆ†åº”ç”¨ä¼šæœ‰ç‰©ä½“çš„ç§»åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šé‚£æ ·åšã€‚åŒæ—¶ä¹Ÿä¸ºå°†æ¥çš„æ•™ç¨‹æ‰“ä¸‹åŸºç¡€ã€‚</p></blockquote>

<h6>1ï¼‰åˆ›å»ºä¸€ä¸ªDisplay Link</h6>

<p>ä½ æƒ³è¦ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ¯æ¬¡è®¾å¤‡å±å¹•åˆ·æ–°çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œè¿™æ ·ä½ å°±å¯ä»¥é‡ç»˜å±å¹•ã€‚</p>

<p>åœ¨iOSå¹³å°ä¸Šï¼Œä½ é€šè¿‡CADisplayLink ç±»æ¥å®ç°ã€‚</p>

<p>ä¸ºäº†ä½¿ç”¨å®ƒï¼Œåœ¨ç±»é‡Œæ·»åŠ ä¸€ä¸ªæ–°çš„å±æ€§ï¼š</p>

<pre><code> 1 var timer: CADisplayLink! = nil  
</code></pre>

<p>ç„¶ååœ¨ viewDidLoad æ–¹æ³•çš„æœ«å°¾åƒè¿™æ ·åˆå§‹åŒ–å®ƒï¼š</p>

<pre><code>timer = CADisplayLink(target: self, selector: Selector("gameloop")) 

timer.addToRunLoop(NSRunLoop.mainRunLoop(), forMode: NSDefaultRunLoopMode) 
</code></pre>

<p>è¿™ä¼šè®¾ç½®ä½ çš„ä»£ç ï¼Œè®©å®ƒæ¯æ¬¡åˆ·æ–°å±å¹•çš„æ—¶å€™è°ƒç”¨ä¸€ä¸ªåå«gameloopçš„æ–¹æ³•ã€‚</p>

<pre><code>func render() { 

// TODO 

} 

func gameloop() { 
  autoreleasepool { 

    self.render() 

  } 

} 
</code></pre>

<p>è¿™é‡Œ gameloop å‡½æ•°ç®€å•åœ°è°ƒç”¨ render å‡½æ•°ï¼Œè¿™æ—¶ render å‡½æ•°åªæœ‰ä¸€ä¸ªç©ºå®ç°ã€‚è®©æˆ‘ä»¬æ¥å®ç°å®ƒï¼</p>

<h6>2ï¼‰åˆ›å»ºä¸€ä¸ªRender Pass Descriptor</h6>

<p>ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªMTLRenderPassDescriptorï¼Œå®ƒèƒ½é…ç½®ä»€ä¹ˆçº¹ç†ä¼šè¢«æ¸²æŸ“åˆ°ã€ä»€ä¹ˆæ˜¯clear colorï¼Œä»¥åŠå…¶ä»–çš„é…ç½®ã€‚</p>

<p>ç®€å•åœ°åœ¨ render å‡½æ•°é‡Œæ·»åŠ ä»¥ä¸‹è¡Œï¼š</p>

<pre><code>var drawable = metalLayer.nextDrawable() 

let renderPassDescriptor = MTLRenderPassDescriptor() 
renderPassDescriptor.colorAttachments[0].texture = drawable.texture 

renderPassDescriptor.colorAttachments[0].loadAction = .Clear 

renderPassDescriptor.colorAttachments[0].clearColor = MTLClearColor(red: 0.0, green: 104.0/255.0, blue: 5.0/255.0, alpha: 1.0)
</code></pre>

<p>é¦–å…ˆä½ åœ¨ä¹‹å‰çš„metal layerä¸Šè°ƒç”¨nextDrawable() ï¼Œå®ƒä¼šè¿”å›ä½ éœ€è¦ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„çº¹ç†(texture)ã€‚æ¥ä¸‹æ¥ï¼Œä½ é…ç½®ä½ çš„render pass descriptor æ¥ä½¿ç”¨å®ƒã€‚ä½ è®¾ç½®load actionä¸ºclearï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç»˜åˆ¶ä¹‹å‰ï¼ŒæŠŠçº¹ç†æ¸…ç©ºã€‚ç„¶åä½ æŠŠç»˜åˆ¶çš„èƒŒæ™¯é¢œè‰²è®¾ç½®ä¸ºç»¿è‰²ã€‚</p>

<h6>3ï¼‰åˆ›å»ºä¸€ä¸ªCommand Buffer</h6>

<p>ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªcommand bufferã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡ä¸ºä¸€ç³»åˆ—è¿™ä¸€å¸§æƒ³è¦æ‰§è¡Œçš„æ¸²æŸ“å‘½ä»¤ã€‚é…·çš„æ˜¯åœ¨ä½ æäº¤command bufferä¹‹å‰ï¼Œæ²¡æœ‰äº‹æƒ…ä¼šçœŸæ­£å‘ç”Ÿï¼Œè¿™æ ·ç»™ä½ å¯¹äº‹ç‰©åœ¨ä½•æ—¶å‘ç”Ÿæœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ§åˆ¶ã€‚åˆ›å»ºä¸€ä¸ªcommand bufferå¾ˆç®€å•ï¼Œåªè¦åœ¨renderå‡½æ•°æœ«å°¾åŠ ä¸Šè¿™è¡Œä»£ç ï¼š</p>

<pre><code> 1 let commandBuffer = commandQueue.commandBuffer()  
</code></pre>

<p>ä¸€ä¸ªcommand bufferåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ¸²æŸ“æŒ‡ä»¤ï¼ˆrender commandsï¼‰ã€‚è®©æˆ‘ä»¬ä¸‹é¢åˆ›å»ºä¸€ä¸ªã€‚</p>

<h6>4ï¼‰åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å‘½ä»¤ç¼–ç å™¨(Render Command Encoder)</h6>

<p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å‘½ä»¤ï¼ˆrender commandï¼‰ï¼Œä½ ä½¿ç”¨ä¸€ä¸ªåå«render command encoderçš„å¯¹è±¡ã€‚åœ¨renderå‡½æ•°çš„æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>

<pre><code>let renderEncoder = commandBuffer.renderCommandEncoderWithDescriptor(renderPassDescriptor) 
renderEncoder.setRenderPipelineState(pipelineState) 

renderEncoder.setVertexBuffer(vertexBuffer, offset: 0, atIndex: 0) 

renderEncoder.drawPrimitives(.Triangle, vertexStart: 0, vertexCount: 3, instanceCount: 1) 

renderEncoder.endEncoding()
</code></pre>

<p>è¿™é‡Œä½ åˆ›å»ºä¸€ä¸ªcommand encoderï¼Œå¹¶æŒ‡å®šä½ ä¹‹å‰åˆ›å»ºçš„pipelineå’Œé¡¶ç‚¹ã€‚æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯ï¼Œè°ƒç”¨drawPrimitives(vertexStart:vertexCount:instanceCount:)ã€‚</p>

<p>è¿™é‡Œä½ ä½ å‘Šè¯‰GPUï¼Œè®©å®ƒåŸºäºvertex bufferç”»ä¸€ç³»åˆ—çš„ä¸‰è§’å½¢ã€‚æ¯ä¸ªä¸‰è§’å½¢ç”±ä¸‰ä¸ªé¡¶ç‚¹ç»„æˆï¼Œä»vertex buffer ä¸‹æ ‡ä¸º0çš„é¡¶ç‚¹å¼€å§‹ï¼Œæ€»å…±æœ‰ä¸€ä¸ªä¸‰è§’å½¢ã€‚</p>

<p>å½“ä½ å®Œæˆåï¼Œä½ åªè¦è°ƒç”¨ endEncoding()ã€‚</p>

<h6>5ï¼‰æäº¤ä½ çš„Command Buffer</h6>

<p>æœ€åä¸€æ­¥æ˜¯æäº¤command bufferã€‚åœ¨renderå‡½æ•°æœ€åæ·»åŠ è¿™äº›ä»£ç ï¼š</p>

<pre><code>commandBuffer.presentDrawable(drawable)
commandBuffer.commit()
</code></pre>

<p>ç¬¬ä¸€è¡Œéœ€è¦ä¿è¯æ–°çº¹ç†ä¼šåœ¨ç»˜åˆ¶å®Œæˆåç«‹å³å‡ºç°ã€‚ç„¶åä½ æŠŠäº‹åŠ¡(transaction)æäº¤ï¼ŒæŠŠä»»åŠ¡äº¤ç»™GPUã€‚è¿‡å»æˆ‘ä»¬æ•²äº†ä¸å°‘ä»£ç ï¼Œä¸è¿‡ç°åœ¨ç»ˆäºç»“æŸäº†ã€‚ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸ªåº”ç”¨ï¼š</p>

<p>æˆ‘è§è¿‡æœ€èµçš„ä¸‰è§’å½¢ï¼</p>

<blockquote><p>æ³¨æ„ï¼šå¦‚æœä½ çš„åº”ç”¨å´©æºƒäº†ï¼Œè¯·ç¡®å®šä½ åœ¨ä¸€å°æ‹¥æœ‰A7èŠ¯ç‰‡çœŸæœºï¼ˆiPhone 5S,iPad Air,iPad mini2 ,éæ¨¡æ‹Ÿå™¨ï¼‰è¿è¡Œã€‚</p>

<p>æœ€å:è¿™æ˜¯æˆ‘ä»¬æ•™ç¨‹æœ€ç»ˆçš„é¡¹ç›®ã€‚</p></blockquote>

<pre><code>æ­å–œä½ ï¼Œä½ å­¦åˆ°äº†å¾ˆå¤šå…³äºMetal APIçš„çŸ¥è¯†ï¼ä½ ç°åœ¨å¯¹Metalçš„ä¸€äº›é‡è¦çš„æ¦‚å¿µæœ‰äº†äº†è§£ï¼Œæ¯”å¦‚ï¼šshadersã€devicesã€command buffersï¼Œpipelineç­‰ç­‰ã€‚
</code></pre>

<p>æˆ‘å¯èƒ½ä¼šå†™æ›´å¤šè¿™ç³»åˆ—çš„æ•™ç¨‹ï¼Œè¦†ç›–uniformsï¼Œ3Dï¼Œçº¹ç†ï¼Œå…‰ç…§ï¼Œä»¥åŠå¯¼å…¥æ¨¡å‹ã€‚å¦‚æœä½ æ„Ÿåˆ°æœ‰å…´è¶£ã€å¹¶æƒ³çœ‹åˆ°æ›´å¤šæ•™ç¨‹çš„è¯ï¼Œè¯·ç•™ä¸‹ä½ çš„è¯„è®ºã€‚åŒæ—¶ï¼Œç¡®å®šæŸ¥çœ‹è‹¹æœä¸€äº›å¾ˆå¥½çš„èµ„æºï¼š</p>
</div>
  
  




| <a href="/blog/2015/10/10/metal/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/06/quan-ping-fan-hui-(runtime)/">å…¨å±è¿”å›ï¼ˆRuntimeï¼‰</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>å‰è¨€</p>

<p>æ­¤æ¬¡æ–‡ç« ï¼Œè®²è¿°çš„æ˜¯å¯¼èˆªæ§åˆ¶å™¨å…¨å±æ»‘åŠ¨è¿”å›æ•ˆæœï¼Œè€Œä¸”ä»£ç é‡éå¸¸å°‘ï¼Œ10è¡Œå†…æå®šã€‚</p></blockquote>

<p>å¦‚æœå–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œå¯ä»¥å…³æ³¨æˆ‘ï¼Œä¹Ÿå¯ä»¥æ¥å°ç å“¥ï¼Œäº†è§£ä¸‹æˆ‘ä»¬çš„iOSåŸ¹è®­è¯¾ç¨‹ã€‚é™†ç»­è¿˜ä¼šæœ‰æ›´æ–°ing&hellip;.</p>

<h5>ä¸€ã€è‡ªå®šä¹‰å¯¼èˆªæ§åˆ¶å™¨</h5>

<p>ç›®çš„ï¼šä»¥åéœ€è¦ä½¿ç”¨å…¨å±æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œå°±ä½¿ç”¨è‡ªå·±å®šä¹‰çš„å¯¼èˆªæ§åˆ¶å™¨ã€‚</p>

<h5>äºŒã€åˆ†æå¯¼èˆªæ§åˆ¶å™¨ä¾§æ»‘åŠŸèƒ½</h5>

<p>æ•ˆæœï¼šå¯¼èˆªæ§åˆ¶å™¨é»˜è®¤è‡ªå¸¦äº†ä¾§æ»‘åŠŸèƒ½ï¼Œå½“ç”¨æˆ·åœ¨ç•Œé¢çš„å·¦è¾¹æ»‘åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰ä¾§æ»‘åŠŸèƒ½ã€‚</p>

<p>ç³»ç»Ÿè‡ªå¸¦çš„ä¾§æ»‘æ•ˆæœï¼š</p>

<p>åˆ†æï¼š</p>

<ul>
<li><p>1.å¯¼èˆªæ§åˆ¶å™¨çš„viewè‡ªå¸¦äº†æ»‘åŠ¨æ‰‹åŠ¿ï¼Œåªä¸è¿‡æ‰‹åŠ¿çš„è§¦å‘èŒƒå›´åªèƒ½åœ¨å·¦è¾¹ã€‚</p></li>
<li><p>2.å½“ç”¨æˆ·åœ¨ç•Œé¢å·¦è¾¹æ‹–åŠ¨ï¼Œå°±ä¼šè§¦å‘æ»‘åŠ¨æ‰‹åŠ¿æ–¹æ³•ï¼Œå¹¶ä¸”æœ‰æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œè¯´æ˜ç³»ç»Ÿæ‰‹åŠ¿è§¦å‘çš„æ–¹æ³•å·²ç»å®ç°äº†æ»‘åŠ¨è¿”å›åŠŸèƒ½ã€‚</p></li>
<li><p>3.ä¸ºä»€ä¹ˆè¯´ç³»ç»Ÿæ‰‹åŠ¿è§¦å‘çš„æ–¹æ³•å·²ç»å®ç°äº†æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Ÿ</p></li>
</ul>


<h3>åŸå› ï¼š</h3>

<p>åˆ›å»ºæ»‘åŠ¨æ‰‹åŠ¿å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦ç»‘å®šç›‘å¬è€…ï¼Œå½“è§¦å‘æ‰‹åŠ¿çš„æ—¶å€™ä¼šè°ƒç”¨targetçš„actionã€‚</p>

<p>UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] initWithTarget:target action:action];
å½“ç”¨æˆ·åœ¨ç•Œé¢å·¦è¾¹æ»‘åŠ¨ï¼Œæœ‰æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œè¿™æ˜¯å› ä¸ºè§¦å‘æ‰‹åŠ¿äº†ï¼Œè°ƒç”¨targetçš„actionæ–¹æ³•ï¼Œè¯´æ˜actionæ–¹æ³•å†…éƒ¨å®ç°æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œå¦åˆ™å°±ä¸ä¼šæœ‰æ»‘åŠ¨è¿”å›æ•ˆæœã€‚</p>

<h5>ä¸‰ã€å®ç°å…¨å±æ»‘åŠ¨åŠŸèƒ½åˆ†æ</h5>

<p>æ‰“å°å¯¼èˆªæ§åˆ¶å™¨è‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿ï¼Œçœ‹ä¸‹å®ƒçš„çœŸå®é¢ç›®ã€‚</p>

<p>ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿interactivePopGestureRecognizer</p>

<pre><code>//  selfæŒ‡å‘çš„å¯¼èˆªæ§åˆ¶å™¨ï¼Œåœ¨å¯¼èˆªæ§åˆ¶å™¨çš„viewDidLoadæ–¹æ³•æ‰“å° 
- (void)viewDidLoad { 
    [super viewDidLoad]; 
    NSLog(@"%@",self.interactivePopGestureRecognizer); 
} 
</code></pre>

<p>ç”±å›¾ä¸­å¯çŸ¥ï¼š</p>

<ul>
<li><p>1.ç³»ç»Ÿè‡ªå¸¦çš„æ‰‹åŠ¿æ˜¯UIScreenEdgePanGestureRecognizerç±»å‹å¯¹è±¡,å±å¹•è¾¹ç¼˜æ»‘åŠ¨æ‰‹åŠ¿</p></li>
<li><p>2.ç³»ç»Ÿè‡ªå¸¦æ‰‹åŠ¿targetæ˜¯_UINavigationInteractiveTransitionç±»å‹çš„å¯¹è±¡</p></li>
<li><p>3.targetè°ƒç”¨çš„actionæ–¹æ³•åå«handleNavigationTransition:</p></li>
</ul>


<p>åˆ†æï¼š</p>

<p>UIScreenEdgePanGestureRecognizerï¼Œçœ‹åç§°å°±çŸ¥é“ï¼Œè¿™ä¸ªæ‰‹åŠ¿çš„èŒƒå›´åªèƒ½åœ¨å±å¹•çš„å‘¨è¾¹ï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªæ‰‹åŠ¿ï¼Œç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ•ˆæœï¼Œåªèƒ½å®ç°ä¾§è¾¹æ»‘åŠ¨ã€‚</p>

<h5>å››ã€å¦‚ä½•å®ç°å…¨å±æ»‘åŠ¨åŠŸèƒ½</h5>

<p>ç»™è‡ªå·±çš„å¯¼èˆªæ§åˆ¶å™¨ï¼Œæ·»åŠ ä¸€ä¸ªå…¨å±çš„æ»‘åŠ¨æ‰‹åŠ¿ï¼Œè°ƒç”¨ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetçš„actionæ–¹æ³•ï¼Œåˆ©ç”¨ç³»ç»Ÿå®ç°çš„æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼ŒåŠ ä¸Šè‡ªå·±å…¨å±æ»‘åŠ¨æ‰‹åŠ¿ï¼Œå°±æœ‰å…¨å±æ»‘åŠ¨åŠŸèƒ½äº†ã€‚</p>

<p>é—®é¢˜ï¼šå¦‚ä½•æ‹¿åˆ°ç³»ç»Ÿè‡ªå¸¦çš„targetå¯¹è±¡?ï¼Œactionæ–¹æ³•åå·²ç»çŸ¥é“ï¼Œè€Œä¸”ç³»ç»Ÿè‚¯å®šåœ¨targetå¯¹è±¡å®ç°äº†ï¼Œåªè¦æ‹¿åˆ°targetå¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•å°±è¡Œã€‚</p>

<p>é€šè¿‡æ‰“å°ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿çš„ä»£ç†ï¼Œå‘ç°æ­£å¥½æ˜¯_UINavigationInteractiveTransitionå¯¹è±¡ï¼Œå› æ­¤æˆ‘çŒœæµ‹è¿™ä¸ªä»£ç†å¯¹è±¡å°±æ˜¯targetå¯¹è±¡,åªè¦æ‹¿åˆ°å®ƒï¼Œå°±æ‹¿åˆ°ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetå¯¹è±¡ã€‚</p>

<pre><code>// æ‰“å°ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„ä»£ç†å¯¹è±¡ 
SLog(@"%@",self.interactivePopGestureRecognizer.delegate); 
</code></pre>

<p>å¯¼èˆªæ§åˆ¶å™¨å…¨å±æ»‘åŠ¨æ³¨æ„ç‚¹:</p>

<ul>
<li><p>1.ç¦æ­¢ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿ä½¿ç”¨ã€‚</p></li>
<li><p>2.åªæœ‰å¯¼èˆªæ§åˆ¶å™¨çš„éæ ¹æ§åˆ¶å™¨æ‰éœ€è¦è§¦å‘æ‰‹åŠ¿ï¼Œä½¿ç”¨æ‰‹åŠ¿ä»£ç†ï¼Œæ§åˆ¶æ‰‹åŠ¿è§¦å‘ã€‚</p></li>
</ul>


<p>å…¨å±æ»‘åŠ¨ä»£ç å®ç°</p>

<pre><code>- (void)viewDidLoad { 
    [super viewDidLoad]; 
    // è·å–ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetå¯¹è±¡ 
    id target = self.interactivePopGestureRecognizer.delegate; 
    // åˆ›å»ºå…¨å±æ»‘åŠ¨æ‰‹åŠ¿ï¼Œè°ƒç”¨ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetçš„actionæ–¹æ³• 
    UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] initWithTarget:target action:@selector(handleNavigationTransition:)]; 
    // è®¾ç½®æ‰‹åŠ¿ä»£ç†ï¼Œæ‹¦æˆªæ‰‹åŠ¿è§¦å‘ 
    pan.delegate = self; 
    // ç»™å¯¼èˆªæ§åˆ¶å™¨çš„viewæ·»åŠ å…¨å±æ»‘åŠ¨æ‰‹åŠ¿ 
    [self.view addGestureRecognizer:pan]; 
    // ç¦æ­¢ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿ 
    self.interactivePopGestureRecognizer.enabled = NO; 
} 
// ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼šæ¯æ¬¡è§¦å‘æ‰‹åŠ¿ä¹‹å‰éƒ½ä¼šè¯¢é—®ä¸‹ä»£ç†ï¼Œæ˜¯å¦è§¦å‘ã€‚ 
// ä½œç”¨ï¼šæ‹¦æˆªæ‰‹åŠ¿è§¦å‘ 
- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer 
{ 
    // æ³¨æ„ï¼šåªæœ‰éæ ¹æ§åˆ¶å™¨æ‰æœ‰æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œæ ¹æ§åˆ¶å™¨æ²¡æœ‰ã€‚ 
    // åˆ¤æ–­å¯¼èˆªæ§åˆ¶å™¨æ˜¯å¦åªæœ‰ä¸€ä¸ªå­æ§åˆ¶å™¨ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå­æ§åˆ¶å™¨ï¼Œè‚¯å®šæ˜¯æ ¹æ§åˆ¶å™¨ 
    if (self.childViewControllers.count == 1) { 
        // è¡¨ç¤ºç”¨æˆ·åœ¨æ ¹æ§åˆ¶å™¨ç•Œé¢ï¼Œå°±ä¸éœ€è¦è§¦å‘æ»‘åŠ¨æ‰‹åŠ¿ï¼Œ 
        return NO; 
    } 
    return YES; 
} 
</code></pre>
</div>
  
  




| <a href="/blog/2015/10/06/quan-ping-fan-hui-(runtime)/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/22/qie-huan-kong-zhi-qi/">åˆ‡æ¢æ§åˆ¶å™¨</a></h1>
    
    
      <p class="meta">
        








 <time if="if" updated="updated" data-updated="true" endif="endif" itemprop="datePublished dateCreated"> ordinal </time> 
        
      </p>
    
  </header>


  <div class="entry-content"><p>ä»ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨çš„å‡ ç§æ–¹å¼</p>

<h4>1,æ¨¡æ€(modal)ç”»é¢çš„æ˜¾ç¤ºæ–¹æ³•ï¼š</h4>

<p>ä¾‹å¦‚iphoneé€šè®¯å½•ç®¡ç†ç¨‹åºä¸­ï¼Œè¿½åŠ æ–°çš„é€šè®¯çºªå½•æ—¶ï¼Œå°±æ˜¯ä½¿ç”¨è¿™ç§æ¨¡æ€ç”»é¢
ä¾‹ï¼šç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œè¿›å…¥å¦ä¸€ä¸ªç•Œé¢
    - (IBAction)pressAbout:(id)sender {</p>

<pre><code>iCocosViewController *iCocos=[[[iCocosViewController alloc] initWithNibName:@"iCocosViewController" bundle:nil] autorelease];

[self presentModalViewController:aboutanimated:YES];//æ˜¾ç¤ºæ¨¡æ€ç”»é¢

å…³é—­æ¨¡æ€ç”»é¢çš„æ–¹æ³•ï¼š

[self dissmissModalViewControllerAnimationed:YES];
</code></pre>

<h4>2,SwitchViewControllerä¸­æœ‰2ä¸ªæ§åˆ¶å™¨çš„å±æ€§ï¼šBviewController,CViewController</h4>

<ul>
<li>ä½¿ç”¨æ–¹æ³•ï¼šinsertSubview: atIndex:
è¿™ç§ç”»é¢è·³è½¬æ–¹æ³•å¹¶éæœ€ä½³çš„è·³è½¬æ–¹æ³•ï¼š</li>
<li>å®é™…ä¸Šå¹¶éçœŸçš„å®ç°äº†ä¸¤ä¸ªç”»é¢é—´çš„è·³è½¬ï¼Œè€Œæ˜¯åŒæ—¶å¯åŠ¨äº†2ä¸ªç”»é¢ï¼Œæ§åˆ¶å…¶ä¸­å“ªä¸€ä¸ªç”»é¢æ˜¾ç¤ºåœ¨å‰å°ï¼Œå“ªä¸€ä¸ªç”»é¢æ˜¾ç¤ºåœ¨åå°è€Œå·²ã€‚</li>
<li>è¿™ç§ç”»é¢è·³è½¬æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ï¼Œå³å½“ç”»é¢æ•°é‡å¢åŠ æ—¶ï¼Œç”»é¢è·³è½¬çš„å®ç°ä»£ç å°†æœˆæ¥è¶Šå¤æ‚ï¼Œè€Œä¸”å„ä¸ªç”»é¢é—´ä¸å¯é¿å…çš„æœ‰ç›¸äº’ä¾èµ–å…³ç³»ã€‚</li>
</ul>


<h4>3,UITabBarControllerå®ç°å¹¶åˆ—ç”»é¢è·³è½¬ï¼ˆè¿™é‡Œå…¶å®å°±æ˜¯windowçš„åˆ‡èŠ±ï¼‰</h4>

<pre><code>//å°†5ä¸ªviewControllerå®ä¾‹æ”¾å…¥TabBarçš„viewcontrollerså±æ€§ä¸­    

self.tabBarController.viewControllers = @[navFrist, navSecond,navThird,navFourth,navFifth];   

self.window.rootViewController = self.tabBarController;

[self.window addSubview:self.tabBarController.view];//å°†æ ¹æ§åˆ¶å™¨çš„è§†å›¾åŠ åˆ°åº”ç”¨ç¨‹åºä¸»çª—å£
</code></pre>

<h4>4,UINavigationControllerå®ç°å¤šå±‚ç”»é¢è·³è½¬ï¼Œåœ¨å¯¼èˆªæ§åˆ¶å™¨ä¸­ï¼Œè½½å…¥æœ‰å±‚çº§å…³ç³»çš„ç•Œé¢</h4>

<pre><code>- (IBAction)addRightAction:(id)sender
{
    iCocosViewController *iCocos=[[[iCocosViewController alloc]initWithNibName:@"iCocosViewController" bundle:nil] autorelease];

[self.navigationController pushViewController:aiCocos animated:YES];
}
</code></pre>
</div>
  
  




| <a href="/blog/2015/09/22/qie-huan-kong-zhi-qi/#comments">æ›´å¤šè¯„è®º</a>

    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/å…¨æ ˆå·¥ç¨‹å¸ˆå¿…å¤‡/'>å…¨æ ˆå·¥ç¨‹å¸ˆå¿…å¤‡ (2)</a></li>
<li class='category'><a href='/blog/categories/åº•å±‚å¼€å‘/'>åº•å±‚å¼€å‘ (4)</a></li>
<li class='category'><a href='/blog/categories/å¼€å‘å·¥å…·/'>å¼€å‘å·¥å…· (1)</a></li>
<li class='category'><a href='/blog/categories/æ€§èƒ½ç›¸å…³/'>æ€§èƒ½ç›¸å…³ (6)</a></li>
<li class='category'><a href='/blog/categories/æ€§èƒ½é—®é¢˜/'>æ€§èƒ½é—®é¢˜ (4)</a></li>
<li class='category'><a href='/blog/categories/æ–°æŠ€æœ¯/'>æ–°æŠ€æœ¯ (1)</a></li>
<li class='category'><a href='/blog/categories/æ¬¢è¿æ¥åˆ°iosæ¢¦å·¥å‚/'>æ¬¢è¿æ¥åˆ°iosæ¢¦å·¥å‚ (1)</a></li>
<li class='category'><a href='/blog/categories/ç¨‹åºå‘˜å¿…å¤‡/'>ç¨‹åºå‘˜å¿…å¤‡ (3)</a></li>
<li class='category'><a href='/blog/categories/é€‚é…é—®é¢˜/'>é€‚é…é—®é¢˜ (1)</a></li>
<li class='category'><a href='/blog/categories/é¢è¯•æ€»ç»“-æŠ€æœ¯/'>é¢è¯•æ€»ç»“ï¼‹æŠ€æœ¯ (1)</a></li>
<li class='category'><a href='/blog/categories/é¢è¯•æ±‡æ€»/'>é¢è¯•æ±‡æ€» (1)</a></li>
<li class='category'><a href='/blog/categories/é¡¹ç›®å®æˆ˜/'>é¡¹ç›®å®æˆ˜ (17)</a></li>
<li class='category'><a href='/blog/categories/é«˜çº§å¼€å‘/'>é«˜çº§å¼€å‘ (24)</a></li>

    </ul>
</section><section>
  <h1>æœ€æ–°æ–‡ç« </h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/12/10/h5ying-yong-shi-zhan/">H5åº”ç”¨å®æˆ˜</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/10/core-image-chu-tan/">Core Image åˆæ¢</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/09/wan-zheng-ding-shi-qi/">ç©è½¬å®šæ—¶å™¨</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/09/shi-jian-chu-li-yu-tu-xiang-xuan-ran-shen-jiu/">äº‹ä»¶å¤„ç†ä¸å›¾åƒæ¸²æŸ“æ·±ç©¶</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/08/watch-os2-chu-tan/">Watch OS2 åˆæ¢</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<h1>æ‰«ä¸€æ‰«<abbr title="The word 'æ‰«ä¸€æ‰«' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'æ‰«ä¸€æ‰«', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/posts/3/index.html"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/posts/3/index.html" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - iCocos -
<span class="credit">Preview in <a href="http://al1020119.github.io">[æ›¹#é»]</a></span>
</p>

</footer>
  






<!--
--->



</body>
</html>
