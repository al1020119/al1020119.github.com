
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOS梦工厂</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="iOS逆向 - 使用Tweak工程 创建第一个Tweak工程
1、创建工程 在目录下面启动NIC /opt/theos/bin/nic.pl ,可以看到有好多个模板可以选择。 1、4、6、8、9 是Theos自带的模板,其他的是 https://github.com/DHowett/theos- &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/posts/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOS梦工厂" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOS梦工厂</a></h1>
  
    <h2>不战胜自己，何以改变未来！</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/19/shiyongtweakgongcheng/">使用Tweak工程</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-19T13:32:08+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>iOS逆向 - 使用Tweak工程</p>

<p>创建第一个Tweak工程
1、创建工程</p>

<p>在目录下面启动NIC /opt/theos/bin/nic.pl ,可以看到有好多个模板可以选择。 1、4、6、8、9 是Theos自带的模板,其他的是 <a href="https://github.com/DHowett/theos-nic-templates">https://github.com/DHowett/theos-nic-templates</a> 下载的。 这里主要学习tweak的用法，选择9</p>

<pre><code>  NIC 2.0 - New Instance Creator
------------------------------
  [1.] iphone/application
  [2.] iphone/cydget
  [3.] iphone/framework
  [4.] iphone/library
  [5.] iphone/notification_center_widget
  [6.] iphone/preference_bundle
  [7.] iphone/sbsettingstoggle
  [8.] iphone/tool
  [9.] iphone/tweak
  [10.] iphone/xpc_service
Choose a Template (required):
</code></pre>

<p>输入工程的名字</p>

<pre><code>Project Name (required): reverseDemo
</code></pre>

<p>输入deb包的名字，相当于App的bundle id</p>

<pre><code>Package Name [com.yourcompany.reversedemo]: com.liuchendi.iOSReverse
</code></pre>

<p>输入tweak作者的名字</p>

<pre><code>Author/Maintainer Name [lovelydd]: liuchendi
</code></pre>

<p>输入MobileSubstrate Bundle filter，就是设置tweak作用对象的bundle identifier。就像上一节用Reveal查看别人的App一样，需要知道作用的对象是谁</p>

<pre><code>[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: com.apple.springboard
</code></pre>

<p>安装完成后需要重启的应用，已进程名表示</p>

<pre><code>[iphone/tweak] List of applications to terminate upon installation (space-separated, '-' for none) [SpringBoard]: SpringBoard
</code></pre>

<p>一个Tweak工程就创建完成了
2、定制工程文件</p>

<p>查看工程里面的文件目录</p>

<pre><code>liuchendi@lovelyddtekiMBP reversedemo$ ls -l
total 40
-rw-r--r--  1 liuchendi  staff   182 12 17 17:30 Makefile
-rw-r--r--  1 liuchendi  staff  1045 12 17 17:30 Tweak.xm
-rw-r--r--  1 liuchendi  staff   222 12 17 17:30 control
-rw-r--r--  1 liuchendi  staff    57 12 17 17:30 reverseDemo.plist
lrwxr-xr-x  1 liuchendi  staff    10 12 17 17:30 theos -&gt; /opt/theos
</code></pre>

<p>Makefile：指定工程用到的文件、框架、库等信息，整个过程自动化。</p>

<p>// 固定写法
    include theos/makefiles/common.mk</p>

<pre><code>// tweak名字,就是工程的名字
TWEAK_NAME = reverseDemo

//tweak包含的源文件(不包括头文件),多个文件以空格分隔
reverseDemo_FILES = Tweak.xm

// 根据Theos工程的不同类型，指定不同的.mk文件。
// 逆向初级阶段一般是Application、 Tweak 、Tool三种类型的程序
// 分别对应的.mk文件是 application.mk 、tweak.mk 、tool.mk
include $(THEOS_MAKE_PATH)/tweak.mk

// 安装完成后,杀掉SpringBoard进程,好让CydiaSubstrate在进程启动时加载对应的dylib
after-install::
  install.exec "killall -9 SpringBoard"
</code></pre>

<p>其他功能：</p>

<pre><code>// 指定处理器架构，arm64架构不兼容armv7/armv7s架构,必须适配arm64的dylib
ARCHS = armv7 arm64

//指定SDK版本
TARGET = iphone:8.1:8.0     // 8.1是指定采用的SDK版本，8.0是可以部署安装的版本
TARGET = iphone:latest:8.0 // Xcode附带的最新版本SDK

//导入framework
reverseDemo_FRAMEWORKS = UIKit CoreTelephony

//导入私有framework
reverseDemo_PRIVATE_FRAMEWORK = AppSupport ChatKit

//链接Mach-O对象(Mach-O object)
// -lx 代表链接libx.a 或者libx.dylib
reverseDemo_LDFLAGS = -lx
</code></pre>

<p>Tweak.xm</p>

<p>默认生成的源文件，x表示支持Logos语法。</p>

<pre><code>/* How to Hook with Logos
Hooks are written with syntax similar to that of an Objective-C @implementation.
You don't need to #include &lt;substrate.h&gt;, it will be done automatically, as will
the generation of a class list and an automatic constructor.

%hook ClassName

// Hooking a class method
+ (id)sharedInstance {
  return %orig;
}

// Hooking an instance method with an argument.
- (void)messageName:(int)argument {
  %log; // Write a message about this call, including its class, name and arguments, to the system log.

  %orig; // Call through to the original function with its original arguments.
  %orig(nil); // Call through to the original function with a custom argument.

  // If you use %orig(), you MUST supply all arguments (except for self and _cmd, the automatically generated ones.)
}

// Hooking an instance method with no arguments.
- (id)noArguments {
  %log;
  id awesome = %orig;
  [awesome doSomethingElse];

  return awesome;
}

// Always make sure you clean up after yourself; Not doing so could have grave consequences!
%end
*/
</code></pre>

<p>主要包括几个命令:</p>

<pre><code>%hook : 指定需要hook的class，必须以%end结尾

%log : 在 %hook 函数内部使用，将函数的类名、参数等信息输出，还能够在结尾输出自定义格式信息

%orig : 执行被hook住的源代码，更改原始函数的参数

%group :将 %hook 分组，以%end结尾。便于代码管理及按条件初始化，不属于自定义的group都会隐式归类到%group_ungrouped中。 必须配合下面的 %init 命令才能生效

%init : 初始化某个group，必须在 hook 或 %ctor 内调用。如果带参数，则初始化指定的group。不带参数则初始化_ungrouped。 只有调用了 %init ，group才能生效

%ctor : 一个构造器，完成初始化工作。如果不显示定义，Theos自动生成一个 %ctor 。并在其中调用%init(_ungrouped), %ctor 不需要%end结尾

%new : 给一个现有的class添加新函数,功能与class_addMethod相同

%c : 等同于 objc_getClass 或者 NSClassFromString , 动态获取一个类的定义,在 %hook 或 %ctor 内使用

control
</code></pre>

<p>control记录了deb包管理系统所需的基本信息, 会被打包进deb里。其内容如下:</p>

<pre><code>Package: com.liuchendi.iOSReverse
Name: reverseDemo
Depends: mobilesubstrate    //依赖条件
Version: 0.0.1
Architecture: iphoneos-arm
Description: An awesome MobileSubstrate tweak!
Maintainer: liuchendi   //deb包的维护人
Author: liuchendi       //tweak作者
Section: Tweaks         //所属程序类别
</code></pre>

<p>更全面的介绍在 这里</p>

<pre><code>reverseDemo.plist
</code></pre>

<p>记录一些配置信息，描述tweak的作用范围。其实就是一个字典， Filter 为外键，里面包含有 :</p>

<pre><code>Bundles : tweak作用对象, 也是app的bundle id
Class : tweak作用的若干类
Executables : 指定若干可执行文件
</code></pre>

<p>注意: 当Filter下有不同的类array时候，需要添加Mode: Any键值对
3、编译 + 打包 + 安装
编译:make</p>

<p>执行make,可能出现的错误</p>

<pre><code>Please run `/Users/liuchendi/Desktop/逆向/Demo/reversedemo/theos/bin/bootstrap.sh substrate` manually, with privileges.
make: *** [before-all] Error 1
</code></pre>

<p>将iOS上的 /Library/Frameworks/CydiaSubstrate.framework/ CydiaSubstrate 拷贝到OSX中，将其重命名为libsubstrate.dylib后放到“/opt/theos/lib/libsubstrate. dylib”中</p>

<pre><code>/bin/sh: ldid: command not found
</code></pre>

<p>重新去 <a href="http://joedj.net/ldid">http://joedj.net/ldid</a> 下载ldid，放在/opt/theos/bin/下面,然后赋予可执行权限 sudo chmod 777</p>

<p>成功后的显示,完成了预处理，编译，签名等一系列工作</p>

<pre><code>Making all for tweak reverseDemo...
Preprocessing Tweak.xm...
Compiling Tweak.xm...
Linking tweak reverseDemo...
Stripping reverseDemo...
Signing reverseDemo...
</code></pre>

<p>发现多了一个obj文件夹</p>

<pre><code>liuchendi@lovelyddtekiMBP reversedemo$ ls -al
total 40
drwxr-xr-x  9 liuchendi  staff   306 12 17 23:20 .
drwxr-xr-x  4 liuchendi  staff   136 12 17 17:31 ..
drwxr-xr-x  4 liuchendi  staff   136 12 17 23:15 .theos
-rw-r--r--  1 liuchendi  staff   182 12 17 17:30 Makefile
-rw-r--r--  1 liuchendi  staff  1045 12 17 17:30 Tweak.xm
-rw-r--r--  1 liuchendi  staff   222 12 17 17:30 control
drwxr-xr-x  5 liuchendi  staff   170 12 17 23:20 obj
-rw-r--r--  1 liuchendi  staff    57 12 17 17:30 reverseDemo.plist
lrwxr-xr-x  1 liuchendi  staff    10 12 17 17:30 theos -&gt; /opt/theos
</code></pre>

<p>打包 make package</p>

<p>出现的错误</p>

<pre><code>make[2]: Nothing to be done for `internal-library-compile'.
Making stage for tweak reverseDemo...
make: *** [internal-package] Error 255
</code></pre>

<p>下载dm.pl文件 <a href="https://raw.githubusercontent.com/DHowett/dm.pl/master/dm.pl">https://raw.githubusercontent.com/DHowett/dm.pl/master/dm.pl</a> ,然后重命名为dpkg-deb.pl,放到/opt/theos/bin/目录下面。 我把pl后缀名字隐藏了</p>

<p>成功执行后的显示,生成一个*.deb的包</p>

<pre><code>liuchendi@lovelyddtekiMBP reversedemo$ make package
Making all for tweak reverseDemo...
Preprocessing Tweak.xm...
Compiling Tweak.xm...
Linking tweak reverseDemo...
Stripping reverseDemo...
Signing reverseDemo...
Making stage for tweak reverseDemo...
dpkg-deb：正在新建软件包“com.liuchendi.iosreverse”，包文件为“./com.liuchendi.iOSReverse_0.0.1-5_iphoneos-arm.deb”。
</code></pre>

<p>多了一个， _ 目录,里面有 DEBIAN 和 Library 文件夹</p>

<pre><code>liuchendi@lovelyddtekiMBP reversedemo$ ls
Makefile
Tweak.xm
_
com.liuchendi.iOSReverse_0.0.1-5_iphoneos-arm.deb
control
obj
reverseDemo.plist
theos
liuchendi@lovelyddtekiMBP reversedemo$ ls _
DEBIAN  Library
</code></pre>

<p><img src="/images/nixiangtweak001.png" title="Caption" ></p>

<p>用 dpkg -c 查看生成的内容</p>

<pre><code>liuchendi@lovelyddtekiMBP reversedemo$ dpkg -c com.liuchendi.iOSReverse_0.0.1-5_iphoneos-arm.deb
drwxr-xr-x liuchendi/staff   0 2015-12-17 23:48 ./
drwxr-xr-x liuchendi/staff   0 2015-12-17 23:48 ./Library/
drwxr-xr-x liuchendi/staff   0 2015-12-17 23:48 ./Library/MobileSubstrate/
drwxr-xr-x liuchendi/staff   0 2015-12-17 23:48 ./Library/MobileSubstrate/DynamicLibraries/
-rwxr-xr-x liuchendi/staff 49952 2015-12-17 23:48 ./Library/MobileSubstrate/DynamicLibraries/reverseDemo.dylib
-rw-r--r-- liuchendi/staff    57 2015-12-17 23:48 ./Library/MobileSubstrate/DynamicLibraries/reverseDemo.plist
</code></pre>

<p>可以看到内容都是一样的
安装</p>

<pre><code>make package install
</code></pre>

<p>首先在Makefile添加下面的内容,主要是指定安装的手机ip</p>

<pre><code>ARCHS = armv7 arm64
TARGET = iphone:latest:7.0
THEOS_DEVICE_IP = 192.168.1.100
</code></pre>

<p>安装成功后的显示,期间要输入两次密码</p>

<pre><code>liuchendi@lovelyddtekiMBP reversedemo$ make package install
Making all for tweak reverseDemo...
make[2]: Nothing to be done for `internal-library-compile'.
Making stage for tweak reverseDemo...
dpkg-deb：正在新建软件包“com.liuchendi.iosreverse”，包文件为“./com.liuchendi.iOSReverse_0.0.1-7_iphoneos-arm.deb”。
install.exec "cat &gt; /tmp/_theos_install.deb; dpkg -i /tmp/_theos_install.deb &amp;&amp; rm /tmp/_theos_install.deb" &lt; "./com.liuchendi.iOSReverse_0.0.1-7_iphoneos-arm.deb"
root@192.168.1.100's password: 
Selecting previously deselected package com.liuchendi.iosreverse.
(Reading database ... 2389 files and directories currently installed.)
Unpacking com.liuchendi.iosreverse (from /tmp/_theos_install.deb) ...
Setting up com.liuchendi.iosreverse (0.0.1-7) ...
install.exec "killall -9 SpringBoard"
root@192.168.1.100's password:
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/18/xiugaitubiaozhishishuzi/">修改图标数字</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-18T13:32:08+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>修改程序图标标示数字</p>

<p>1.修改自身应用图标标示数字：
   [UIApplication sharedApplication].applicationIconBadgeNumber = 10;
2. 修改其他应用图标标示数字：
   ios7.0下的sdk
   Use class-dump to dump the headers for /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS3.0.sdk/System/Library/PrivateFrameworks/iTunesStore.framework/iTunesStore</p>

<p>涉及的头文件</p>

<pre><code>ISOperation-ISAuthentication.h
ISOperation-ISLoadSoftwareMapAdditions.h
ISOperation-ISLoadURLBagAdditions.h
ISOperation.h
ISOperationDelegate-Protocol.h
ISOperationQueue.h
ISSetApplicationBadgeOperation.h

You may have to edit ISOperation.h:
</code></pre>

<ol>
<li>Change the #import &ldquo;NSOperation.h&rdquo; to #import</li>
<li>Remove the &ldquo;&rdquo; in the first part of the interface.</li>
<li>So you&rsquo;re just left with &ldquo;id _delegate;&rdquo;</li>
</ol>


<p>Then copy these 3 files into a &ldquo;Headers&rdquo; dir inside of the /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS3.0.sdk/System/Library/PrivateFrameworks/iTunesStore.framework dir.</p>

<p>You can now add the iTunesStore framework to your xcode project. Just point to the dir above.</p>

<p>Now add &ldquo;#import &rdquo; to your code and, for your convenience, here&rsquo;s an example-function ready for use:</p>

<p>CODE：</p>

<pre><code>ISSetApplicationBadgeOperation *sbadge = [[ISSetApplicationBadgeOperation alloc] init];


[sbadge setBundleIdentifier:bundleIdentifier];
[sbadge setBadgeValue:[NSString stringWithFormat:@"%d",number]];
[sbadge run];
[sbadge release];
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/14/jiandanappshizhan/">Jiandanappshizhan</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-14T00:00:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><hr />

<p>layout: post
title: &ldquo;简单App实战&rdquo;
date: 2016-03-14 13:32:08 +0800
comments: true</p>

<h2>categories: Summary</h2>

<p>底层开发之越狱开发第一篇</p>

<p>做越狱开发也有一些时间了，有很多东西想总结一下，希望给他人一些借鉴，也是自己对过去开发经历的一些总结。个人不推荐使用盗版，这里主要以技术介绍为主。</p>

<p>这个系列里面主要介绍怎样进行越狱开发，涉及到以下几个方面:</p>

<ul>
<li>(1)主要涉及到越狱市场的建立，在App内部实现ipa的安装和卸载以及更新。参照的对象就是91助手，25pp，同步推那样的应用。建立一个盗版的App Store.当然了，如果通过299刀的企业证书的话，是不需要通过Cydia的，直接通过网页链接就可以实现app的推广，有一定的风险。这里面涉及到一些协议，后面会进行介绍。</li>
<li>(2)在App内部实现壁纸和铃声的替换。这个过程涉及到的东西很多，特别是铃声的替换，iPhone里面非常麻烦；</li>
<li>(3)一些越狱插件的开发，通过里面有些插件非常好用，合理，而且非常美观漂亮。
这里先从App内部安装ipa包开始讲，后面逐步把上面提到的3点全部讲完。</li>
</ul>


<p>一般情况下安装91助手，同步推这样的应用需要手机越狱，同时安装AppSync，这样才能使用，所以进行开发的必备条件也是如此。</p>

<p>上传的demo工程的地址，我的github链接：<a href="https://github.com/easonoutlook/IPAInstaller">https://github.com/easonoutlook/IPAInstaller</a></p>

<p>之前一直在fork别人的东西，也没做什么贡献，从现在开始，为开发为开源，做一点自己的贡献。</p>

<p>进入正题：</p>

<p>需要的工具和环境：</p>

<ul>
<li><ol type="a">
<li>iPhone or iPad越狱，安装AppSync</li>
</ol>
</li>
<li><ol type="a">
<li>Xcode安装 Command Line Tools</li>
</ol>
</li>
<li><ol type="a">
<li>下载最新版本的ldid <a href="https://github.com/downloads/rpetrich/ldid/ldid.zip">https://github.com/downloads/rpetrich/ldid/ldid.zip</a></li>
</ol>
</li>
</ul>


<h4>1、修改SDKSettings.plist文件</h4>

<p>我用的是Xcode4.6.3版本，iPhone的版本是6.1.2, 路径为：/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS6.1.sdk/</p>

<p>将这个目录下的 SDKSettings.plist里面的CODE_SIGNING_REQUIRED置为NO</p>

<p>执行命令为：</p>

<p>转到目录下</p>

<pre><code>cd /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS6.1.sdk
</code></pre>

<p>将原有文件备份</p>

<pre><code>sudo cp SDKSettings.plist SDKSettings.plist.orig
</code></pre>

<p>对SDKSettings.plist文件进行编辑</p>

<pre><code>sudo vim SDKSettings.plist
</code></pre>

<p>将下面对应的字段改为NO</p>

<pre><code>&lt;key&gt;CODE_SIGNING_REQUIRED&lt;/key&gt;
&lt;string&gt;YES&lt;/string&gt;  // 默认为YES, 需要改为NO
</code></pre>

<p>此操作参考的路径如下：<a href="http://kqwd.blog.163.com/blog/static/4122344820117191351263/">http://kqwd.blog.163.com/blog/static/4122344820117191351263/</a></p>

<h4>2、给工程添加相应的权限，iOS6里面需要赋予权限才可以，iOS5之前不需要此操作</h4>

<p>新建一个plist文件，命名为entitlements.</p>

<p><img src="/images/nixiang005.png" title="Caption" ></p>

<p>创建一个plist</p>

<p><img src="/images/nixiang006.png" title="Caption" ></p>

<p>将plist文件改为：</p>

<p>复制代码
复制代码</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
    &lt;dict&gt;
        &lt;key&gt;com.apple.private.mobileinstall.allowedSPI&lt;/key&gt;
        &lt;array&gt;
            &lt;string&gt;Install&lt;/string&gt;
            &lt;string&gt;Browse&lt;/string&gt;
            &lt;string&gt;Uninstall&lt;/string&gt;
            &lt;string&gt;Archive&lt;/string&gt;
            &lt;string&gt;RemoveArchive&lt;/string&gt;
        &lt;/array&gt;
    &lt;/dict&gt;
&lt;/plist&gt;
</code></pre>

<p>复制代码
复制代码
将Code Signing 的Code Signing Entilements设置为刚刚创建的entitlements.plist文件</p>

<p><img src="/images/nixiang007.png" title="Caption" ></p>

<p>后面还需要一个手续，将生产的app文件用ldid签名。后面再介绍。</p>

<p>3、实现越狱安装的代码：</p>

<p>复制代码
复制代码</p>

<pre><code>typedef NSDictionary *(*    PMobileInstallationLookup)(NSDictionary *params, id callback_unknown_usage);
NSDictionary *IPAInstalledApps()
{
    void *lib = dlopen("/System/Library/PrivateFrameworks/MobileInstallation.framework/MobileInstallation", RTLD_LAZY);
    if (lib)
    {
        PMobileInstallationLookup pMobileInstallationLookup = (PMobileInstallationLookup)dlsym(lib, "MobileInstallationLookup");
        if (pMobileInstallationLookup)
        {
            NSArray *wanted = nil;//[NSArray arrayWithObjects:@"com.celeware.IPADeploy",@"com.celeware.celedial",nil]; Lookup specified only
            NSDictionary *params = [NSDictionary dictionaryWithObjectsAndKeys:@"User", @"ApplicationType", wanted, @"BundleIDs",nil];
            NSDictionary *dict = pMobileInstallationLookup(params, NULL);
#ifdef DEBUG
            NSLog(@"%@", dict);
#endif
            return dict;
        }
    }
    return nil;
}
</code></pre>

<p>复制代码
复制代码
所有代码均在之前的github目录中，可以自行查看。</p>

<p>4、编译生成App文件</p>

<p>因为需要给APP签名加权限，所以不要生成IPA文件，而是生成APP文件。等把签名与权限加好后，再手动用APP制作IPA文件。</p>

<p> 在Xcode中选择设备（IOS Device）（图3），编译（Build）（图4）。编译完成后，在工程的Products文件夹中可以看到刚刚编译好的APP文件，右键Show in Finder（图5），就可以在文件夹中显示。将APP复制到一个别的文件夹中，什么地方都可以，后面需要用到。</p>

<p><img src="/images/nixiang008.png" title="Caption" ></p>

<p>5、制作ipa文件</p>

<p>将之前提到的ldid下载好后，将ldid文件放到/usr/bin中。</p>

<p>比如在 Download 目录下， sudo -i</p>

<p>然后 cp ldid /usr/bin/即可将文件拷贝到/usr/bin中。</p>

<p>然后对之前生成的文件，进行ldid签名</p>

<p><img src="/images/nixiang009.png" title="Caption" ></p>

<p>这个命令中“ldid -S” ，“ldid”与“-S”之间有一个空格。“-S”与“entitlements.xml”之间没有空格。“entitlements.xml”就是上面说到的XML文件，如果你的XML不是这个名，请将命令修改为你的XML文件名即可。</p>

<p>“-Sentitlements.xm”与“ipainstall.app”之间有一个空格。“ipainstall”是刚刚生成的APP文件，如果你的名字不一样，请修改为你的名字。“/“后面和APP的名字是一样的。  如果没有输出错误信息或是卡住（就是敲回车后没反应）就是添加权限成功了。</p>

<p>6、生成ipa文件，安装</p>

<p>新建一个文件夹，命名为“Payload”。将刚刚添加好权限的APP文件放到这个文件夹中。右键“压缩Payload”，得到一个“.zip”文件，将这个ZIP文件的后缀名改为“.ipa”。好了，IPA文件就制作完成了。</p>

<p>然后通过itools安装，测试刚刚生成的文件</p>

<p><img src="/images/nixiang010.png" title="Caption" ></p>

<p>整合了很多资源，有些地方弄的比较凌乱，后面加以完善</p>

<p>参考资源链接：</p>

<p><a href="http://since2006.com/blog/240/ios6-mobileinstallationinstall">http://since2006.com/blog/240/ios6-mobileinstallationinstall</a>
<a href="http://blog.sina.com.cn/s/blog_9cd1705d0101l4bo.html">http://blog.sina.com.cn/s/blog_9cd1705d0101l4bo.html</a>
<a href="http://kqwd.blog.163.com/blog/static/4122344820117191351263/">http://kqwd.blog.163.com/blog/static/4122344820117191351263/</a>
<a href="http://blog.csdn.net/linkai5696/article/details/5924356">http://blog.csdn.net/linkai5696/article/details/5924356</a>
<a href="http://www.yonsm.net/post/553">http://www.yonsm.net/post/553</a>
<a href="http://stackoverflow.com/questions/14871748/how-do-i-change-my-applications-entitlements-to-com-apple-backboard-client">http://stackoverflow.com/questions/14871748/how-do-i-change-my-applications-entitlements-to-com-apple-backboard-client</a>
<a href="http://stackoverflow.com/questions/13817569/how-to-programatically-install-a-ipa-file-in-ios-6/15062538#15062538">http://stackoverflow.com/questions/13817569/how-to-programatically-install-a-ipa-file-in-ios-6/15062538#15062538</a>
<a href="http://since2006.com/blog/240/ios6-mobileinstallationinstall">http://since2006.com/blog/240/ios6-mobileinstallationinstall</a>
<a href="http://hi.baidu.com/prognostic/item/831b622202b2dd0f72863e9c">http://hi.baidu.com/prognostic/item/831b622202b2dd0f72863e9c</a>
<a href="http://www.vsyo.com/a/t/89895554d4043c5a">http://www.vsyo.com/a/t/89895554d4043c5a</a>
<a href="http://mobile.dotblogs.com.tw/cmd4shell/archive/2013/03/26/98967.aspx">http://mobile.dotblogs.com.tw/cmd4shell/archive/2013/03/26/98967.aspx</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/12/ziyuanwenjianhuoqu/">资源文件夹获取</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-12T13:32:08+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>用pngcrush反编译ios app 资源文件</p>

<p>时间：2012-12-27 11:56:45 类别：ios开发 访问: 3705 次</p>

<p>要提高app制作水平，最好的方法就是学习领先者，用pngcrush反编译ios app 资源文件，步骤很简单</p>

<ol>
<li><p>在电脑的itunes中下载你选中的app，下载完成之后，然后在finder里面找到对应的ipa包，也可以在91等市场中直接下载ipa文件</p></li>
<li><p>ipa文件其实是zip包，重命名为zip后缀文件之后，双击打开
找到 xxx.app 文件，这其实是个目录，点击右键，在菜单中选中“查看包内容”，就可以进入目录，然后看到大量的资源文件，这些png文件都直接放在app的根目录，你可以在finder中直接浏览</p></li>
<li><p>但是这些png文件都是打包过程中被压缩过的，photoshop无法正确识别 （ 注：打包app的时候，你可以在xcode project选项中选择对png文件不压缩）</p></li>
<li><p>要把这些png文件还原，可以通过一个名叫 pngcrush 的开源软件，你可以到 sourceforge 下载，实际上ios的sdk也提供了这个程序（xcode就是利用它压缩png的）xcrun -sdk iphoneos -find pngcrush 可以获得 pngcrush的安装目录，然后直接使用，或者在你的$PATH目录里面做一个符号链接，这样可以在console窗口直接敲pngcrush</p></li>
</ol>


<p>进入资源文件存放目录，打开对应的命令行窗口，执行下面的命令即可</p>

<pre><code>pngcrush -d xxx reverted -revert-iphone-optimizations -q *.png
pngcrush -e xxx reverted -revert-iphone-optimizations -q *.png
</code></pre>

<p>上面提到的方法都是在mac操作系统下面，如果是windows/linux也可以用，pngcrush也提供了对应的版本</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/10/jingtaifenxiyushiyong/">Jingtaifenxiyushiyong</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-10T00:00:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><hr />

<p>layout: post
title: &ldquo;静态分析与使用&rdquo;
date: 2016-03-10 13:32:08 +0800
comments: true</p>

<h2>categories: Summary</h2>

<p>逆向工程－静态分析及使用</p>

<p>看到一篇装逼技术，有机会好好研究一下。。。。。</p>

<p>最近在学习IOS逆向工程，查看网络上的资料也不是太多，边学边总结一下。</p>

<p>首先学习资料：</p>

<p>念茜（大神）的博客： <a href="http://nianxi.net">http://nianxi.net</a></p>

<p>《ios应用逆向工程 分析与实战》</p>

<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-凌乱的分割线&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p>

<p>其次讲讲要用到的工具（ios安装工具使用Cydia中搜索安装，有些需要数据源可以自行查找）：</p>

<ul>
<li><p>已经越狱的IOS设备：这是必须的</p></li>
<li><p>OpenSSH（数据源：<a href="http://apt.saurik.com%EF%BC%89%EF%BC%9A%E7%94%A8%E4%BA%8E%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95ssh%E5%92%8C%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93scp">http://apt.saurik.com%EF%BC%89%EF%BC%9A%E7%94%A8%E4%BA%8E%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95ssh%E5%92%8C%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93scp</a></p></li>
<li><p>class-dump-z: 用于简单分析出工程中的类名和函数名</p></li>
<li><p>IDA：强大的反编译工具</p></li>
<li><p>Hopper Disassembler：类似IDA 我比较喜欢，能简单转换成OC的功能</p></li>
<li><p>Reveal:UI层解析工具</p></li>
<li><p>iFunBox 、 iTools ：两个都是强大的ios设备管理工具，越狱后能轻松读取应用文件等功能</p></li>
</ul>


<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-凌乱的分割线&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p>

<p>恩，差不多就这么多了！上面的工具大部分都是收费的，不过都是有试用版的，接下来我们一个个分析：</p>

<p>ios设备越狱，这个我就不讲了吧，不过我要赞@盘古团队一个，目前所有ios系统都可以越狱（包括ios8.x）</p>

<p>在ios设备上下载OpenSSH （数据源：<a href="http://apt.saurik.com%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E7%94%A8%E7%94%B5%E8%84%91%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95ios%EF%BC%9A">http://apt.saurik.com%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E7%94%A8%E7%94%B5%E8%84%91%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95ios%EF%BC%9A</a></p>

<p>然后输入密码，@后面是手机的IP号，越狱后默认密码好像是123456.</p>

<p>传输文件的命令是</p>

<pre><code>scp gdbinit root@172.168.1.100:/var/root
scp root@172.168.1.100:/var/root/123.txt ~/
</code></pre>

<ol>
<li>class-dump-z 是一个强大的函数提取工具，非常好用，也是基础工具</li>
</ol>


<p>下载地址：<a href="http://stevenygard.com/projects/class-dump">http://stevenygard.com/projects/class-dump</a></p>

<pre><code>              https://code.google.com/p/networkpx/wiki/class_dump_z
</code></pre>

<p>可以发到手机里调用，也可以在电脑上调用，要解析的文件是在应用目录下x.app（里面还有用到的所有文件资源）下面的x（x是你要分析的应用名）以唱吧为例，用ifunbox找到应用进入应用目录就可以看到ktv.app了打开包文件就能找到ktv。</p>

<pre><code>$ class-dump-z ktv &gt; ktv.txt       //导出所有内容到文件
$ class-dump-z -H ktv -o ktvdir/   //导出所有内容目录到文件夹（首先要创建ktvdir文件夹）
</code></pre>

<p>*这里会有一个问题，就是从app store下载的应用解析出来会是乱码，因为应用被加密了。解决办法</p>

<p><img src="/images/nixiang001.png" title="Caption" ></p>

<p>去渠道上下应用如同步推、91</p>

<p>解密工具 如AppCrackr(源<a href="http://cydia.xsellize.com">http://cydia.xsellize.com</a>)、Crackulous、Clutch</p>

<pre><code>  class-dump 只能解析出类名和函数名，不能看到具体的实现逻辑。但是很直观
</code></pre>

<p> 4.IDA和Hopper Disassembler差不多，能看到每个函数的具体逻辑（但是-都是汇编）IDA很强大，能在后面标记的oc的函数名，但是我更喜欢Hopper Disassembler，因为他能简单的模拟出oc源码，但是也是非常简单的。两者按空格键都能显示出分支逻辑来。</p>

<pre><code>汇编非常难看懂，我们需要的是耐心+耐心。后面可以加上动态工具联合分析能更有效
</code></pre>

<p><img src="/images/nixiang002.png" title="Caption" ></p>

<p> 5.Reveal的功能就更强大了，能表明出UI的具体结构来，告诉你每个View的类型是什么，这通常也是我们常用的分析一个app的切入点。</p>

<p>下载地址：<a href="http://revealapp.com">http://revealapp.com</a></p>

<p>下载完后打开reveal在菜单目录中help-show reveal library in finder打开库文件，将两个文件发到手机里</p>

<p><img src="/images/nixiang003.png" title="Caption" ></p>

<p>接下来编辑libReveal.plist文件</p>

<p>在/Library/MobileSubstrate/DynamicLibraries/下创建文件libReveal.plist，指定app的Bundle，可以指定多个</p>

<p>同学们会问了，app 的bundleID怎么查看呢，我们还是用ifunbox工具找到应用目录，在x.app文件夹中会有info.plist文件，打开就能找到。</p>

<p>最后重启设备-打开想分析的应用-电脑打开reveal接口，就可以点击分析了</p>

<p><img src="/images/nixiang004.png" title="Caption" ></p>

<p>总结一下吧，分析一个应用的逻辑是这样的：</p>

<ul>
<li><p>拿个越狱机-下好工具</p></li>
<li><p>去越狱平台下个想分析的应用（或者去app store下，用解密工具解密一下）</p></li>
<li><p>导入reveal分析页面，得到想要的知道的具体视图类或者大致范围</p></li>
<li><p>分析class-dump中，找到想要的类和函数</p></li>
<li><p>在IDA中找到具体函数，查看逻辑</p></li>
</ul>


<blockquote><p>单纯的静态分析只能知道个大概，想知道框架和具体内容还需要动态分析（下面分析）的帮助。不过想知道一个应用用到了什么库，界面是什么结构，有什么图片资源，上面的绝对够用了。总之逆向工程是比较枯燥无味的东西，资料又少，需要的是。。。。。加油</p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/08/fanbianyihefangfanbianyi/">反编译和防反编译</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-08T13:32:08+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>关于反编译和防止反编译</p>

<h3>反编译</h3>

<ul>
<li><p>内购破解</p>

<ul>
<li>iOS应用需防反编译风险之一：插件法（仅越狱）、iTools工具替换文件法（常见为存档破解）、八门神器修改</li>
</ul>
</li>
<li><p>网络安全风险</p>

<ul>
<li>iOS应用需防反编译风险之二：截获网络请求，破解通信协议并模拟客户端登录，伪造用户行为，对用户数据造成危害</li>
</ul>
</li>
<li><p>应用程序函数PATCH破解</p>

<ul>
<li>iOS应用需防反编译风险之三：利用FLEX 补丁软件通过派遣返回值来对应用进行patch破解</li>
</ul>
</li>
<li><p>源代码安全风险</p>

<ul>
<li>iOS应用需防反编译风险之四：通过使用ida等反汇编工具对ipa进行逆向汇编代码，导致核心代码逻辑泄漏与被修改，影响应用安全</li>
</ul>
</li>
<li><p>面对这些iOS应用存在的风险，iOS应用如何防止被反编译，下面看下iOS应用加密技术</p></li>
</ul>


<h3>iOS应用加密防反编译技术</h3>

<ul>
<li><p>本地数据加密</p>

<ul>
<li>iOS应用防反编译加密技术之一：对NSUserDefaults，sqlite存储文件数据加密，保护帐号和关键信息</li>
</ul>
</li>
<li><p>URL编码加密</p>

<ul>
<li>iOS应用防反编译加密技术之二：对程序中出现的URL进行编码加密，防止URL被静态分析</li>
</ul>
</li>
<li><p>网络传输数据加密</p>

<ul>
<li>iOS应用防反编译加密技术之三：对客户端传输数据提供加密方案，有效防止通过网络接口的拦截获取数据</li>
</ul>
</li>
<li><p>方法体，方法名高级混淆</p>

<ul>
<li>iOS应用防反编译加密技术之四：对应用程序的方法名和方法体进行混淆，保证源码被逆向后无法解析代码</li>
</ul>
</li>
<li><p>程序结构混排加密</p>

<ul>
<li>iOS应用防反编译加密技术之五：对应用程序逻辑结构进行打乱混排，保证源码可读性降到最低</li>
</ul>
</li>
</ul>


<h3>下面是iOS应用加密防反编译前后对比</h3>

<p>iOS应用防反编译总结</p>

<ul>
<li><p>通过以上研究，iOS应用开发者必须要注意iOS应用反编译技术研究了，不要让iOS应用重蹈Android应用的覆辙，iOS应用防反编译！</p></li>
<li><p>反编译的流程，就是虚拟一个执行环境，看程序执行了那些指令，翻译成相应的语句一般的流程是先把程序调入到数据段， 虚拟运行环境，一般这分配文件头部，从纪录指令程序数据段，载入到虚拟环境中，纪录指令，遇到跳转指令，压入栈，形成树结构（看数据结构），遍历每个节点 的指令。形成完整程序</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/05/jiandanhuanjinjieshao/">简单环境介</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-05T13:32:08+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>知识点准备</h3>

<h6>越狱的三点</h6>

<ul>
<li><p>第一点——越狱开放了iOS的文件系统，使得用户一下子获得了root权限，获得了整个iOS系统的掌控大权。越狱之后用iFunBox等工具可以可简单地看到iOS的整个文件系统，因此也可以修改系统UI、铃声，或者当U盘用。同样的，越狱之后安装的一些程序，也同样突破了沙盒的限制，甚至获得root权限，程序的行为可以不受用户和系统的限制。权利和责任的对等的，获得了root权限的用户就必须对这个系统对安全和完整性负责。可惜的是很多人越狱了，但又抱怨iPhone出现的耗电、卡机、白苹果等等现象。目测很多Android和越狱用户，确实没这个能力去负起这个责任。</p></li>
<li><p>第二点——cydia。基本所有人都把它当作越狱的显性标志。cydia表面上看来就是一个AppStore，实际上利用了另外一套软件管理系统——“Debian Package ”，也就是常说的dpkg，使用的安装包是deb，在Ubuntn上很是常见。deb的安装和卸载依靠的是一套完整的脚本，用control作为软件的标识信息，数据用tar压缩。另外，cydia还有软件源这个机制，由于我没搭过源服务器，完全不懂其中原理。</p></li>
<li><p>第三点——MobileSubstrate。这是越狱必装插件，也是tweak开发的前提。那些让iPhone能拦截黑名单电话的，或者让时间能显示年月日的，或者在状态栏添加个天气图标的程序，基本都依赖与此。</p></li>
</ul>


<p>事实上，MobileSubstrate包含了三大组件。</p>

<pre><code>MobileHooker
</code></pre>

<p>俗称钩子。这把存在于内存里的钩子能钩住任何想钩住的系统方法，并替换成自己的实现方法。举例而言，黑名单的电话能被挂断，是因为在接通的那个系统方法里，并替换掉且不执行原有的方法，所以接通电话的事件也就被中断了。当然，那些奇怪问题诸如白苹果等事件基本都是由这个引起的。</p>

<pre><code>MobileLoader
</code></pre>

<p>钩子能够加载进内存并动态替换内存，靠的就是这个。其中编写.plist文件来限制加载范围必不可少。</p>

<pre><code>Safe mode
</code></pre>

<p>越狱后的机子基本都经历过安全模式，当SpringBoard崩溃时会自动进入安全模式，靠的就时这个的功劳，不然，这世界上不知又要多了多少部白苹果。</p>

<p>若想了解更多MobileSubstrate，可以点这里</p>

<p>何为越狱已经结束，为何越狱也就明朗起来了。</p>

<pre><code>想掌握iOS的整个文件系统，把iPhone当U盘使。
为了获得更好等功能，如电话增强功能、flash等
搞一些修改系统的行为，如更换UI、铃声、图标，等等
工作需要（比如说我）
安装免费软件（我故意放到最后的）
</code></pre>

<p>最后提醒一句，在非越狱机上，AppStore上的那些来电归属地，透视镜，指纹锁，基本都是假的，看完这篇文章，原因读者大概也能略知一二了。而那些省电、清内存之类的，反正我是不用，这些东西交给系统就行了，反正我上没见过iPhone4或4s会卡到游戏玩不了需要硬启动的。用户程序要操心这些东西，说真的，有心无力。有钱的话，买买几个正版的单机游戏，购买一次还提供永久的免费升级，也挺值了。</p>

<h3>环境准备</h3>

<p>曾经在cocoachina看过有人评论，越狱开发，只要找个稍微懂UNIX和Objective-C的开发人员就行了。看见这话真是无比痛心。AppStore开发者即使再痛恨越狱，但也没必要用如此言语贬低越狱开发人员。越狱开发可能想象中很是简单，但绝不是简单到用几个Private API或者在搞个重启关机等等事情（说实话重启手机还真不是一句代码能实现的）。越狱开发混了几个月，发现自己知识面完全不行。从我不成熟的眼光看来，越狱开发需要以下的几个素质：</p>

<pre><code>Objective-C以及iOS开发
</code></pre>

<p>这一点算是囊括了AppStore开发的东西。没有公司会愿意开发一个没有用户界面的东西。相比于AppStore开发，越狱开发的好处是可以使用Private API，但同时需要忍受无文档，以及一堆数据类型为id的变量带来的痛苦。</p>

<pre><code>UNIX
</code></pre>

<p>权限、脚本、进程管理，等等，哪一个不会都可能成为开发中的软肋。对于操作系统没好好学过的我，可怜了我的肋骨哟。</p>

<pre><code>iOS的特性
</code></pre>

<p>这一点抽象到连我自己也说不清。iOS作为一个类UNIX系统，肯定有一套属于自己的特性。掌握它的特性的人，需要是一个拥有理性头脑的果粉（可惜我不是）。对iOS特性的掌握可以快速找到各种奇奇怪怪的需求的解决方案，以及解决各种无log无法调试无稳定重现路径的bug甚至崩溃甚至白苹果。说个最近遇到的，某天发现了我的未接来电无法显示在通知栏了，于是我在某个文件夹里翻到了某张plist打开阅读之后果断删了，重启SpringBoard后一切正常，这能说成是一种敏感么？ 扯远了。</p>

<p>说说越狱的开发环境。其实作为一个不太入流的领域，不能指望哪个大公司某天推出一套越狱开发工具。不过，多亏了国外几位越狱大神，越狱开发才逐渐模板化。刚接触越狱开发时，最有名的莫过于theos了，模板多且编译简单。不过，今年二月发布的iOSOpenDev则集合了theos的所有优势，同时集合到Xcode之中，还能实现简单的deb打包，算是贴心尽意了。 安装iOSOpenDev之前，可先确认：</p>

<pre><code>Xcode4.0及以上
dpkg已安装。利用的是dpkg相关的东西，打包这些东西避免不了。推荐使用macports安装
git已安装。利用的是git相关的东西，很多开源项目都托管在git上
thoes已安装。很多旧的开源项目都是可不是由iOSOpenDev创建的，使用theos可以快速编译他们，同时iOSOpenDev的Logos模板是依托于theos的，而Logos模板，在我看来是tweak开发最优秀的模板，没有之一
</code></pre>

<p>接下来就可以安装iOSOpenDev。一直确定下去，假如不需要打包功能，则不需要填写IP等东西。事实上除了学习之外，基本可以忽略打包功能，脚本打包才是王道。 更详细的东西，可以看这里。 安装完毕，打开Xcode，新建工程，发现有iOSOpenDev一项，还有大量模板可选时，说明环境搭建已成功。Enjoy it！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/05/jianceshifouyueyu/">Jianceshifouyueyu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-05T00:00:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><hr />

<p>layout: post
title: &ldquo;检测是否越狱&rdquo;
date: 2016-03-05 13:32:08 +0800
comments: true</p>

<h2>categories: Summary</h2>

<p>底层开发之越狱开发第二篇</p>

<p>今天项目中要用到检查iPhone是否越狱的方法。</p>

<p>Umeng统计的Mobclick.h里面已经包含了越狱检测的代码，可以直接使用</p>

<p>复制代码
复制代码</p>

<pre><code>/*方法名:
 *        isJailbroken
 *介绍:
 *        类方法，判断设备是否越狱，判断方法根据 apt和Cydia.app的path来判断
 *参数说明:
 *        无
 *        
 *
 */

#pragma mark utils api
// 类方法，判断当前设备是否已经越狱
+ (BOOL)isJailbroken;
// 类方法，判断你的App是否被破解
+ (BOOL)isPirated;
</code></pre>

<p>复制代码
复制代码
apt和Cydia的方式来进行判断的，没看见源码</p>

<p>然后再介绍两种方法来查看是否已经越狱，知其然知其所以然、、、</p>

<ol>
<li><p>apt</p>

<p> 1 - (BOOL) hasAPT
 2 {
 3 return [[NSFileManager defaultManager] fileExistsAtPath:@&ldquo;/private/var/lib/apt/&rdquo;];
 4 }</p></li>
<li><p>system</p>

<p> 1 - (BOOL) successCallSystem
 2 {
 3 return (system(&ldquo;ls&rdquo;) == 0) ? YES : NO;
 4 }</p></li>
</ol>


<p>3.示例代码</p>

<p>复制代码</p>

<pre><code> 1 static const char* jailbreak_apps[] =
 2 
 3     {
 4         "/Applications/Cydia.app",
 5         "/Applications/limera1n.app",
 6         "/Applications/greenpois0n.app",
 7         "/Applications/blackra1n.app",
 8         "/Applications/blacksn0w.app",
 9         "/Applications/redsn0w.app",
10         "/Applications/Absinthe.app",
11         NULL,
12     };
13      
14     - (BOOL) isJailBroken
15     {
16         // Now check for known jailbreak apps. If we encounter one, the device is jailbroken.
17         for (int i = 0; jailbreak_apps[i] != NULL; ++i)
18         {
19             if ([[NSFileManager defaultManager] fileExistsAtPath:[NSString stringWithUTF8String:jailbreak_apps[i]]])
20             {
21                 //NSLog(@"isjailbroken: %s", jailbreak_apps[i]);
22                 return YES;
23             }
24         }
25          
26         // TODO: Add more checks? This is an arms-race we're bound to lose.
27          
28         return NO;
29     }
30  
31 
32 @interface UIDevice (Helper)  
33 - (BOOL)isJailbroken;  
34 @end
35 
36 @implementation UIDevice (Helper)  
37 - (BOOL)isJailbroken {  
38   BOOL jailbroken = NO;  
39   NSString *cydiaPath = @"/Applications/Cydia.app";  
40   NSString *aptPath = @"/private/var/lib/apt/";  
41   if ([[NSFileManager defaultManager] fileExistsAtPath:cydiaPath]) {  
42     jailbroken = YES;  
43   }  
44   if ([[NSFileManager defaultManager] fileExistsAtPath:aptPath]) {  
45     jailbroken = YES;  
46   }  
47   return jailbroken;  
48 }  
49 @end
</code></pre>

<p>复制代码</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/04/changjianyueyufangfa/">常见越狱方法</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-04T15:32:08+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>3:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>iOS设备的越狱方法</p>

<p>最近公司的事情很忙，在开发一个类似于微信的App，经常加班，所以也没有时间去更新微信公众账号的内容了。iOSJailbreak, 申请这个账号大概有一个多月了吧，发布的内容不多，更多是针对开发者的内容，针对普通iPhone &amp; iPad用户的内容几乎没有，有收听的朋友经常发问，怎样去越狱，怎样去开发越狱的插件或者app。后面都会细细道来。</p>

<h3>一、先说iPhone 5S 和 iPhone5C吧</h3>

<p>最新的iPhone又要出来了，大概是9月21号左右美国和香港应该是可以购买的。新的iOS7应该是在9月16号发布。5C有5个颜色，配截图。</p>

<blockquote><p>其实我是大概在今年3月底4月初的时候听 富士康那边的朋友说的，有一款中端版本的iPhone5C, 价格大概在3000左右，估计香港，美国那边的更便宜，应该是2000+的样子。等待新机的到来，其实iPhone5的感觉就是轻，拿着很舒服。估计5C应该也差不多。</p></blockquote>

<h3>二、怎么越狱</h3>

<p>越狱有很多种方法和工具，红雪的 (redsn0w)  ， 绿毒的(greenp0ison)，Absinthe， evasi0n等等， 还有一些其他的，不怎么知名，当然也比不上上面的了，就不过多介绍了。
我在网上找了相关的越狱教程，因为涉及到的系统版本，设备型号太多了，无法逐一验证。找了一个靠谱的链接，绝不是广告哦，我亲测过。
这个网站上几乎针对每种系统，每种机型都可以越狱。</p>

<ul>
<li><p>链接一、在这个链接里面选择对应的设备类型，比如iPhone5， iPad mini等等。
<a href="http://jb.appvv.com/shebei/">http://jb.appvv.com/shebei/</a></p></li>
<li><p>链接二、选择对应的设备之后，进入到选择设备对应的系统版本页面，不同的机型有差别，比如这个是4s的
<a href="http://jb.appvv.com/shebei/iphone4s/">http://jb.appvv.com/shebei/iphone4s/</a></p></li>
</ul>


<p>链接三、在选择对应的设备和系统版本之后，就可以自己开始越狱了，严格按照教程操作，比如4s的, iOS6.1.2的版本就可以按照如下链接操作
<a href="http://jb.appvv.com/news/19806.shtml">http://jb.appvv.com/news/19806.shtml</a></p>

<p>有时间可以多看下网站上的内容。</p>

<h3>三、关于越狱的安全性等问题</h3>

<p>很多人说，越狱的iPhone存在着安全性问题，从一个方面来讲，确实存在这样的问题。但是这并不是iOS系统的问题，包括Windows, Android系统都存在问题。同样的前提下，iOS的安全性绝对要高的多。听说过Windows系统下，Android系统下用户的账号被盗用，卡被盗刷的情况，但是iOS系统下的我没听说过类似的情况，包括越狱的iOS系统，安全性依然很高。</p>

<p>手机本来就是用来玩儿，越狱之后有很多好用的插件，还可以免费装各种应用，还有输入法，黑名单等等，一系列的“好处”吧。但是越狱之后，手机的安全性还是值得警惕，涉及到银行转账和交易的时候最好双方确认好，避免被骗。
总之越狱之后可玩儿性更高一些。对于越狱我保持中立吧，有些人拿着手机就打打电话，发发微信，不想折腾。喜欢玩儿的人，可以去试试。</p>

<blockquote><p>PS：之前我越狱了自己的iPad，把微信的打飞机刷了200多万分，天天爱消除刷了180W分，越狱之后用插件弄的。我推测了一下，手工打的话，打飞机不会超过160W分，后面太难了，大飞机太多了。爱消除我只用了40S刷了180W分，后面都没管了。大家可以自己试试。</p></blockquote>

<h4>实例方案</h4>

<p>办法1.</p>

<p>int xx=fork() //这个函数从这里起，程序被分为两个进程，父和子，子进程，返回0，父进程返回子进程ID，如果执行fork成功，说明沙盒被破坏，说明越狱了
if(!xx)。//子进程，关闭他
{
     exit(0);
}
if(xx>=0)父进程，说明越狱
{
return 1;
}
return 0 ;//，没有越狱，返回-1，</p>

<p>办法2
检测cydia.app是否存在
    struct stat s;
    int is_jailbroken=stat(&ldquo;/Applications/Cydia.app&rdquo;, &amp;s);
    NSLog(@&ldquo;&mdash;&ndash;is_jailbroken=%d&mdash;-&rdquo;,is_jailbroken);//返回为0说明有Cydia.app，否则-1
或者
   struct stat s;
    int is_jailbroken=stat(&ldquo;/Library/MobileSubstrate/DynamicLibraries/MobileSubstrate.dylib&rdquo;, &amp;s);
    NSLog(@&ldquo;&mdash;&ndash;is_jailbroken=%d&mdash;-&rdquo;,is_jailbroken);</p>

<p>办法3.判断文件大小</p>

<p>struct stat s
stat(“/etc/fstab”,&amp;s);
return s.st_size</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/03/nixiangjishufenxi/">逆向技术分析</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-03T13:32:08+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2016</span></span> <span class='time'>1:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>iOS App 的逆向工程: Hacking on Lyft
您的评价:</p>

<p> 收藏该经验</p>

<p>阅读目录</p>

<ol>
<li>介绍(0:00)</li>
<li>逆向 Lyft(1:44)</li>
<li>窥视 Lyft(2:48)</li>
<li>探测网络流量 - Charles 演示(4:08)</li>
<li>向 Lyft 里注入代码 - Cycript 演示(7:44)</li>
<li>解密可执行文件 - dumpdecrypted 演示(11:28)</li>
<li>分析可执行文件 - IDA 演示(13:47)</li>
<li>寻找 Lyft 的 URL Scheme(18:23)</li>
<li>Q&amp;A(22:50)</li>
</ol>


<p>原文  <a href="https://realm.io/cn/news/conrad-kramer-reverse-engineering-ios-apps-lyft/">https://realm.io/cn/news/conrad-kramer-reverse-engineering-ios-apps-lyft/</a></p>

<p>如果你曾经想要知道某一部分代码如何工作，或者很同情某些人程序里的 Bug，你要是有代码，通常可以看看那部分代码。但是，如果没有代码可怎么办？ 在这个演讲里，Conrad 讲到了很多可以逆向 App 的概念和工具，这些方法和工具可以用来 debug 别人的库和你自己的代码。他还展示了逆向 iOS 版本的 Lyft （译者注：Lyft 是美国 Uber 之外的另一款打车软件），并且成功注入代码，探测网络流量，给我们活灵活现地展示逆向的艺术。通过 Conrad 的逆向技术，你也能成功地把 App Store 里所有的 App 的代码都暴露在你面前。</p>

<pre><code>Sign up to be notified of new videos — we won’t email you for any other reason, ever.
</code></pre>

<h4>介绍(0:00)</h4>

<p>我是 Conrad Kramer ，工作在 Workflow 的一枚 iOS 工程师，今天要跟大家聊聊 iOS Apps 逆向工程那些事儿。通常来说，逆向工程就是试图只通过最终产物来了解它背后工作原理的过程。在 iOS app 的世界里，这意味着你在没有源代码的前提下，只通过从 App Store 下载的 .app 来发现你想要的信息。</p>

<p>在做逆向工程的时候，会遇到两个痛点：</p>

<pre><code>使用的工具 通常很难用，因为这些工具本身就缺乏文档，而且很不出名。他们总是崩溃出错，而且没人去修复这些错误。另外，花时间找到他们以及用好他们都很难。
一旦你开始用这些工具了，清楚自己的目标也很重要，因为有太多事情可以干了。此外，你还能用工具去逆向苹果自己的框架，尽管他是闭源的。我们可以用这些技术来探索 UIKit 的某个 bug，或者某个 app 里的 bug。
</code></pre>

<p>所以逆向的第一步是像自己发问：“为什么这个 bug 会发生？他们在 UI 里用了哪些组件？” 比如，如果你很好奇一个 app 里是否用了 collection view 或者 table view”，你其实很容易回答这个问题，看一眼就好了。但是如果你问：“他们的 REST API 是什么结构的？”，这个时候逆向工程就能帮你一探究竟。
逆向 Lyft(1:44)</p>

<p>我决定通过一个项目来开始这个主题，目标是： Lyft’s iOS app ，它整个都是用 Swift 完成的。首先要做的事是我们了解我们感兴趣的点。假设我对 REST API 很感兴趣，比如我想要在另一个平台或者在 web 上写一个 Lyft 客户端，我可以看看他们的 API 然后产生好奇：“他们的 URL scheme 是什么样子的？”，当你想对 Lyft 做深度链接的时候，你就不得不解决这个问题。对 Workflow 来说，相关性就更高了，因为 Workflow 就是一个自动工具，我们集成了很多不同的 app。我总是需要做些类似的事情，来发现一些不公开的私有 URL scheme。</p>

<h4>窥视 Lyft(2:48)</h4>

<p>从 iTunes 下载下来的 Lyft 是一个 .IPA 文件（其实就是 zip 格式的）。它有很多的元数据，像 Info.plist 文件，资源文件，图片，本地化的字符串以及很多类似的文件。这里面也包含一些可执行文件，那些被编译了的代码就在里面。另外，因为 Lyft 是用 swift 写的，所以还包含很多附加的框架。</p>

<p>Lyft 现在看来是一个完完全全的黑盒子。我们不能直接的看透它，但我们依然有能力从特定的一些角度窥视到。一种方法就是通过监测网络流量来观察他的 API, 同时还能看到有哪些信息被它发送到了 Lyft 的服务器，这些通常对 App 而言是没有什么伤害的。</p>

<p>然后，我们还能 注入代码 ，真的非常爽。当 app 运行的时候，你可以打探打探这些 app 里被实例化而且存活的对象。当停止运行的时候，我们可以尝试去研究下 .app 是如何被组织的，同时通过特定的视角来看这些代码。</p>

<h4>探测网络流量 - Charles 演示(4:08)</h4>

<p>Charles 是一个 HTTPS 代理工具，它可以让流量在发往服务器前拦截网络流量。我们可以用这个工具来观察所有从 Lyft app 流向服务器的请求。</p>

<p>Lyft 事实上通过 SSL 加密了它的所有流量。但这些都很好破，通过 中间人攻击 的方法来解决这个问题。其实就是替换了加密证书。</p>

<p>当你在用 Lyft 的时候，Lyft 不断的把你的地理位置发给 Lyft 的服务器。 对车辆的请求和取消等操作会以格式化后的 JSON 在 Charles 中呈现出来。用 Charles，你会看到 app 里和网络交互的所有内容。</p>

<h4>向 Lyft 里注入代码 - Cycript 演示(7:44)</h4>

<p>下一个工具真的很赞，叫 Cycript 。使用这个工具的时候需要一个越狱设备，注入代码到 app 里。Cycript 可以让你看到别人的代码，当然你自己写的 app 也逃不过。这个工具是 Objective-C 和 Javascript 的混合 app，只用输入 Objective-C 的代码到控制台里，就能在 app 运行这些代码。它的交互编程环境（REPL）比 LLDB 的要好很多。尽管它不能中断，设置断点等等，但他对运行时代码非常友好。你可以直接输入下面的代码，基本上都是 Objective-C ：</p>

<pre><code>var application = [UIApplication sharedApplication];
[application openURL:[NSURL URLWithString:@"https://google.com"]];
</code></pre>

<p>我 SSH 进入我的破解过的 iPhone 6 以后，打开 Lyft，运行 Cycript，我可以通过选择功能来获取一个运行时的类实例，比如 view controller 的，或者统计类的实例。作为开发者，要确定设置 ACL 来防止特定 api key 的权限问题。如果 app 能拿到这些 key，那 Cycript 也一定能拿到。</p>

<p>你也可以修改 app 里的 views。比如，用 UIApp.keyWindow.recursiveDescription 通过内存寻址，把 “呼叫车辆” 的按钮变成绿色。</p>

<pre><code>var b = new Instance (ADDRESS)
b.backgroundColor = [UIColor greenColor]
</code></pre>

<p>Cycript 甚至还支持 tab 智能提示。这个功能不但对于逆向很有用，你还可以来测试你自己的 app，比如快速换个颜色测试测试效果什么的。
Q: 用 Crcript 测试自己的 app 的时候，设备一定需要越狱么？</p>

<p>Conrad: 对你自己的 app 的话，并不需要。在 cycript.org 官网上，提供了一些如何把这个工具嵌入到你自己的 app 的文档。</p>

<h4>解密可执行文件 - dumpdecrypted 演示(11:28)</h4>

<p>接下来，我们就要来感受下 app 运行时真正的代码了。这个稍微有些复杂，而且需要设备越狱，我们的演示会比较简单。因为有能力重签名我们的设备，所以苹果会加密商店里所有的 app，防止 app 被大家共享。然而，对于一个越狱设备来说，所有的这些加密的 app 都是可以被解密的。我从其他人那里 fork 了一个 repo，叫 dumpdecrypted ，原作者写这个是为了导出一个 app 的资源，我 fork 了一份，是为了让它能够支持所有的框架，毕竟现在很多 app 都含有 frameworks。</p>

<p>用它的时候，你只要简单的 clone 到本地，然后执行make，再在你越狱后的设备上对 app 执行一下。我对 Lyft 的 app 执行了这个，很快就解密了所有的文件。你看这些文件的时候，会发现所有的 framework 都以.decrypted后缀结尾。比较有意思的一些模块是 Lyft，LyftKit 和 LyftSDK，但是我们还发现了它还用了 SocketRocket，Stripe，Pusher，Mixpanel 等等的库。</p>

<h4>分析可执行文件 - IDA 演示(13:47)</h4>

<p>要分析我们导出的文件，查看源代码，我们要到 IDA ，和 Hopper 及 class-dump 类似的一个工具。当在编译一个 app 的时候，XCode 会创建一个由汇编组成的可执行文件。IDA 能很漂亮的输出这些可执行文件里的汇编代码，并且相互连接起来，你因此会看到一个由汇编代码组成的图。尽管 IDA 很贵，但是它的 免费版本 已经够用了。除了 64 位以外，基本都有。</p>

<p>要找到 Lyft 的 URL scheme，我们可以在 IDA 里执行一个简单的搜索，关键字是openURL，在类似的反编译工具中，Objective-C 是相对友好和容易的，因为它对于工作原理是相对透明的，Swift 就相对较差，很多工具还没有很好的支持 Swift，Swift 的汇编代码也更混乱，它的类信息很难被提取出来，不过，多练习练习，看看这些汇编，你会发现一些技巧来捕获你所想找的信息。</p>

<p>使用 IDA 的图表视野，我们发现了<em>TZFV4Lyft15DeepLinkManager13handleOpenURLfMS0_FCSo5NSURLSb，看起来是个很乱的字符串，然而我们依然可以发现LyftDeepLinkManager,handleOpenURL, 和NSURL这几个关键词。这些看似随机的字符串其实是有解释的，虽然没有文档来说明。如果想要了解这些字符串的含义，可以看看 Mike Ash 的博客里一篇叫做 Friday Q&amp;A 的文章，这些模糊的东西都有解释。比如</em>T意思是这是一个 Swift 的符号，F意思是这是一个函数，4Lyft是一个模块名称，等等。</p>

<h4>寻找 Lyft 的 URL Scheme(18:23)</h4>

<p>想要从我们所见之中发现 URL scheme，我们就要用开发者的思维来思考。</p>

<p>一个 URL scheme 结构大概是这样的：</p>

<pre><code>lyft://action?parameter=value 
</code></pre>

<p>我们现在要去找到action是什么，parameter可能会是哪些。我首先找到了DeepLinkAbleSwift 协议，了解了深度链接的工作原理。通过搜索DeepLinkAble关键字，我在一个类里发现了诸如ride，help，invite，profile的请求对象。</p>

<p>我们对如何开始一次打车很好奇，我们可以看一下 Lyft 的DeepLinkToRide类，看看他是如何工作的。想要看这些，你甚至不需要了解汇编，你只需知道如何搜索和扫描汇编中你需要的信息即可。就好比你即使不会法语，却经常看见到法语，看的足够多次后，你总是能悟出些东西来。很多时候 IDA 展示给我们的完全就是一种外语，其实我第一次尝试逆向 Swift 的时候，就是这样一种感受。</p>

<p>通过大致浏览DeepLinkToRide的图。我发现了一些不同的字符串，比如 “pickup”，“［latitude］”，“［longtitude］”，“destination” 等等。IDA 还展显示了 ”ridetype“，后面经过测试发现这是个 action，通过查看 “ridetype”，我们发现了 “lyft”, “lyft_line”, “lyft_plus”, 和 “access”，这些都是出行方式。</p>

<p>构造这些不同的 URL 部分，然后测试请求。我发现请求一个出行的 scheme 方式如下：</p>

<pre><code>lyft://ridetype
  ?id=lyft_line
  &amp;pickup[latitude]=0
  &amp;pickup[longitude]=0
  &amp;destination[latitude]=0
  &amp;destination[longitude]=0
</code></pre>

<p>现在，我明白了 Lyft 是如何工作的了，我可以集成到 Workflow 里了。这个过程其实就是二进制分析。尽管这些看起来很复杂，但事实上，只要像个开发者一样思考，其实也那么的难。
Q&amp;A(22:50)
Q: 证书绑定（pinning certificates）能否防止中间人攻击？</p>

<p>Conrad：证书绑定是一个用来防止中间人攻击的方法，在实践中确实很有用，前提是你的手机未越狱。比如 Twitter 就在用证书绑定技术。然而，用逆向工具 Cycript 能够轻松破解。 AFNetworking 支持证书绑定，只要设置一下SSLPinningMode这个属性。然而… 我们可以用 Cycript，再把它修改成none，如果你的 iPhone 越狱了，或者被人控制了。所以，并没有一种方案能够彻底防止你的流量被检测，如果没有越狱，倒是一种很好的保护方法。
Q: 是否推荐类似 cocoapods-keys 这样的工具来混淆字符串？</p>

<p>Conrad: 字符串混淆有以下的好处：</p>

<p>－ 如果你用苹果框架里的私有 API，能很容易的躲避过苹果审查的自动扫描工具。－ 如果那个人并没有一部越狱的 iPhone，或者它不知道如何解析混淆，他可能很难找到 app 里的字符串。</p>

<p>然而，你无法永远的把字符串藏起来。比如，在 Cycript 中，你可以轻易地解开混淆。所以字符串混淆也不是没法破的保护方案。</p>

<p>Q: class-dump 和 dumpdecryped 的区别是啥？</p>

<p>Conrad: 他们事实上是不同的工具。 dumpecrypted 能将一个 App Store 加密的工具解密。而 class-dump 能将一个解密后得二进制文件去除他的 Objective-C 接口文件，跟 IDA 有点像，不过很遗憾的是：它不支持 Swift。
Q: 导出 Apple framework 的库，比如： this one ，是不是也是用的 class-dump？</p>

<p>Conrad: 是的，苹果的框架没有加密，可以被轻易地导出所有的class。这意味着那些把苹果的私有interface 放到GitHub上的，你可以轻易地搞定他们。
Q: 逆向工程是否存在法律问题？Lyft 会不会不同意调用他们的私有代码和 api？</p>

<p>Conrad: 从法律上讲，我觉得没有太多问题。我们通常会跟所有的合作伙伴去聊到我们在做的事情。比如：我刚刚发现的这些东西我都会和 Lyft 讨论一下，在他们允许后集成到 Workflow 里。这些技术其实也有很多道德上的考虑。不过话说回来，这些技术也能阻止开发者们胡乱搞，就比如之前逆向 Twitter 发现他们上传用户手机里装的 App 列表到他们的服务器上。所以凡事总有两面，逆向工程只是个工具，善用就好了。
Q: 如何查看苹果框架的反汇编代码？</p>

<p>Conrad: 这个的过程跟我之前展示的一个很像，只不过你不再需要一个越狱后的设备。当你把线插到设备上的时候，iTunes 实际上获取到了设备的符号，你可以在 Xcode 里找到一个大概叫 “device symbol” 文件夹，在 IDA 或者 class-dump 里打开 Apple 的 frameworks，然后展开分析。这些都是没加密的，而且可以直接拿来用。在修复一些 beta 版本的 UIKit 的 bug 的时候很好使。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
    <h1>文章分类</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/advanced/'>advanced (22)</a></li>
<li class='category'><a href='/blog/categories/algorithm/'>algorithm (1)</a></li>
<li class='category'><a href='/blog/categories/background/'>background (1)</a></li>
<li class='category'><a href='/blog/categories/bottom/'>bottom (5)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (7)</a></li>
<li class='category'><a href='/blog/categories/fore-end/'>fore-end (2)</a></li>
<li class='category'><a href='/blog/categories/interview/'>interview (1)</a></li>
<li class='category'><a href='/blog/categories/necessary/'>necessary (5)</a></li>
<li class='category'><a href='/blog/categories/newfeatures/'>newfeatures (5)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (8)</a></li>
<li class='category'><a href='/blog/categories/projects/'>projects (27)</a></li>
<li class='category'><a href='/blog/categories/summary/'>summary (40)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>
<li class='category'><a href='/blog/categories/watchos2/'>watchos2 (1)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/25/nixiangzongjie/">Nixiangzongjie</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/20/weixinjiqiren/">微信机器人</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/15/qudongkaifa/">驱动开发</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/10/nixiangzhifubao/">逆向支付宝</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/05/fei6sshixian3dtouch/">非6S-实现3D Touch</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<h1>扫一扫<abbr title="The word '扫一扫' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word '扫一扫', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/posts/2/index.html"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/posts/2/index.html" alt="post-qrcode"></a></section>
<section>
    <h1>访客统计</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>新浪微博</h1>
    <ul id="weibo">
        <li>
            
            <!-- 在此插入获得的微博秀代码 -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - iCocos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
