
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>KeyChainåˆæ¢ - iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="iCocosåšå®¢">
  <meta name="keywords" content="iCocos, iOSå¼€å‘, åšå®¢, æŠ€æœ¯åˆ†æ, æ–‡ç« , å­¦ä¹ , æ›¹é», æ›¹ç†é¹">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/blog/2015/07/20/keychainchu-tan/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>iCocosâ€”â€”ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">åšæ–‡</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/about">æ–‡ç« </a></li>
  <li><a href="/other">å…¶ä»–</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">KeyChainåˆæ¢</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-20T22:46:16+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:46 pm</span></time>
        
        
        |   <a href="#comments">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>iOSçš„keychainæœåŠ¡æä¾›äº†ä¸€ç§å®‰å…¨çš„ä¿å­˜ç§å¯†ä¿¡æ¯ï¼ˆå¯†ç ï¼Œåºåˆ—å·ï¼Œè¯ä¹¦ç­‰ï¼‰çš„æ–¹å¼ï¼Œæ¯ä¸ªiosç¨‹åºéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„keychainå­˜å‚¨ã€‚ç›¸å¯¹äºNSUserDefaultsã€æ–‡ä»¶ä¿å­˜ç­‰ä¸€èˆ¬æ–¹å¼ï¼Œkeychainä¿å­˜æ›´ä¸ºå®‰å…¨ï¼Œè€Œä¸”keychainé‡Œä¿å­˜çš„ä¿¡æ¯ä¸ä¼šå› Appè¢«åˆ é™¤è€Œä¸¢å¤±ï¼Œæ‰€ä»¥åœ¨é‡è£…Appåï¼Œkeychainé‡Œçš„æ•°æ®è¿˜èƒ½ä½¿ç”¨ã€‚</p>

<blockquote><p>â€œyourAppID.com.yourCompany.whateverâ€å°±æ˜¯ä½ è¦èµ·çš„å…¬å…±åŒºåç§°ï¼Œé™¤äº†whateverå­—æ®µå¯ä»¥éšä¾¿å®šä¹‹å¤–ï¼Œå…¶ä»–çš„éƒ½å¿…é¡»å¦‚å®å¡«å†™ã€‚è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„è¦é…ç½®åœ¨ Project->build setting->Code Signing Entitlementsé‡Œï¼Œå¦åˆ™å…¬å…±åŒºæ— æ•ˆï¼Œé…ç½®å¥½åï¼Œé¡»ç”¨ä½ æ­£å¼çš„è¯ä¹¦ç­¾åç¼–è¯‘æ‰å¯é€šè¿‡ï¼Œå¦åˆ™xcodeä¼šå¼¹æ¡†å‘Šè¯‰ä½ code signingæœ‰é—®é¢˜ã€‚æ‰€ä»¥ï¼Œè‹¹æœé™åˆ¶äº†ä½ åªèƒ½åŒå…¬å¸çš„äº§å“å…±äº«KeyChainæ•°æ®ï¼Œåˆ«çš„å…¬å¸è®¿é—®ä¸äº†ä½ å…¬å¸äº§å“çš„KeyChainã€‚</p></blockquote>

<!--more-->


<h3>ä¸€.åŸºæœ¬çŸ¥è¯†</h3>

<h6>1.æ–¹æ³•</h6>

<ul>
<li>SecItemAdd å¢</li>
<li>SecItemUpdate æ”¹</li>
<li>SecItemDelete åˆ </li>
<li>SecItemCopyMatching æŸ¥</li>
</ul>


<h6>2.æƒé™</h6>

<p>æ–‡æ¡£ä¸Šè¯´iOSçš„keyChainæ˜¯ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ç©ºé—´ï¼Œå½“ç¨‹åºæ›¿æ¢ï¼Œåˆ é™¤æ—¶å¹¶ä¸ä¼šåˆ é™¤keyChainçš„å†…å®¹ï¼Œè¿™ä¸ªè¦æ¯”Library/Cacheå¥½ã€‚åˆ·æœºï¼Œæ¢å¤å‡ºå‚åº”è¯¥å°±æ²¡æœ‰äº†ã€‚å…³äºå¤‡ä»½ï¼Œåªä¼šå¤‡ä»½æ•°æ®ï¼Œåˆ°é‚£æ—¶ä¸ä¼šå¤‡ä»½è®¾å¤‡çš„å¯†é’¥ï¼Œæ¢å¥è¯è¯´ï¼Œå³ä½¿æ‹¿åˆ°æ•°æ®ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•è§£å¯†é‡Œé¢çš„å†…å®¹ã€‚æœ‰äººè¯´ä¼¼ä¹ç ´è§£çš„æ‰‹æœºå°±èƒ½ç ´è§£keyChain,æœ¬äººå¹¶ä¸æ¸…æ¥šï¼Œå¸Œæœ›æœ‰å¤§ç¥èƒ½æŒ‡æ•™ã€‚ä½†ä¸ªäººè®¤ä¸ºï¼ŒkeyChainåªæ˜¯æ²™ç›’çš„å‡çº§ç‰ˆï¼Œå¯ä»¥å­˜æ”¾ä¸€äº›éç§å¯†çš„ä¿¡æ¯ï¼Œå³ä½¿ç ´è§£ä¹Ÿä¸å½±å“å…¶å®ƒç”¨æˆ·ï¼Œåªå½±å“é‚£ä¸ªç ´è§£äº†çš„è®¾å¤‡ã€‚ï¼ˆæ¯”å¦‚é’ˆå¯¹è¯¥è®¾å¤‡çš„ä¸€ä¸ªå¯†é’¥ï¼‰ã€‚</p>

<p>å¯è®¿é—®æ€§ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå·±çš„ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„keychain,ç›¸åŒbundleçš„ç¨‹åºé€šè¿‡è®¾ç½®groupå¯ä»¥äº’ç›¸å…±äº«åŒç»„çš„keychainï¼Œä»è€Œå®ç°ç¨‹åºé—´å¯ä»¥å…±åŒè®¿é—®ä¸€äº›æ•°æ®ã€‚è¯¦ç»†åé¢ä»‹ç»ä¸€äº›æˆ‘æµ‹è¯•ä¸‹æ¥çš„ç»éªŒã€‚</p>

<h6>3.å¦‚ä½•æŸ¥è¯¢keyChain</h6>

<pre><code>[objc] view plaincopyprint?åœ¨CODEä¸ŠæŸ¥çœ‹ä»£ç ç‰‡æ´¾ç”Ÿåˆ°æˆ‘çš„ä»£ç ç‰‡
genericPasswordQuery = [[NSMutableDictionary alloc] init];   
[genericPasswordQuery setObject:(id)kSecClassGenericPassword forKey:(id)kSecClass];//1  
[genericPasswordQuery setObject:identifier forKey:(id)kSecAttrGeneric];//2  
if (accessGroup != nil){  
    [genericPasswordQuery setObject:accessGroup forKey:(id)kSecAttrAccessGroup];//3  
}  
[genericPasswordQuery setObject:(id)kSecMatchLimitOne forKey:(id)kSecMatchLimit];//4  
[genericPasswordQuery setObject:(id)kCFBooleanTrue forKey:(id)kSecReturnAttributes];//5  
NSDictionary *tempQuery = [NSDictionary dictionaryWithDictionary:genericPasswordQuery];  
NSMutableDictionary *outDictionary = nil;      
if (SecItemCopyMatching((CFDictionaryRef)tempQuery, (CFTypeRef *)&amp;outDictionary) == noErr){//6  
//found and outDicitionary is not nil  
}else{  
//not found  
}  
</code></pre>

<ul>
<li>1.è®¾ç½®Classå€¼ï¼Œæ¯ä¸ªClasså¯¹åº”çš„éƒ½æœ‰ä¸åŒçš„å‚æ•°ç±»å‹</li>
<li>2.ç”¨æˆ·ç¡®å®šçš„å‚æ•°ï¼Œä¸€èˆ¬æ˜¯ç¨‹åºä¸­ä½¿ç”¨çš„ç±»åˆ«ï¼Œæ¯”å¦‚è¯´æ˜¯"Password"æˆ–"Account Info"ï¼Œä½œä¸ºsearchçš„ä¸»åŠ›æ¡ä»¶</li>
<li>3.è®¾ç½®Group,å¦‚æœä¸åŒç¨‹åºéƒ½æ‹¥æœ‰è¿™ä¸ªç»„ï¼Œé‚£ä¹ˆä¸åŒç¨‹åºé—´å¯ä»¥å…±äº«è¿™ä¸ªç»„çš„æ•°æ®</li>
<li>4.åªè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…æ•°æ®ï¼ŒæŸ¥è¯¢æ–¹æ³•ä½¿ç”¨ï¼Œè¿˜æœ‰å€¼kSecMatchLimitAll</li>
<li>5.è¿”å›æ•°æ®ä¸ºCFDicitionaryRefï¼ŒæŸ¥è¯¢æ–¹æ³•ä½¿ç”¨</li>
<li>6.æ‰§è¡ŒæŸ¥è¯¢æ–¹æ³•ï¼Œåˆ¤æ–­è¿”å›å€¼</li>
</ul>


<blockquote><p>eg:è¿™ä¸ªæ˜¯none-ARCçš„ä»£ç å“¦ï¼ARCæƒ…å†µä¸‹ä¼šæœ‰bridgeæç¤ºã€‚</p></blockquote>

<h6>4.ç±»å‹è½¬æ¢</h6>

<p>ä»‹ç»å¢åˆ æ”¹æ–¹æ³•è°ƒç”¨å‰ï¼Œå…ˆä»‹ç»è½¬æ¢æ–¹æ³•ï¼Œå¦‚ä½•å°†NSDictionaryè½¬æ¢æˆKeyChainæ–¹æ³•å¯ä»¥è®¾ç½®çš„Dicitionaryï¼Œä¸€èˆ¬åœ¨å†™ç¨‹åºè¿‡ç¨‹ä¸­ï¼Œåº”è¯¥å°½é‡é¿å…ç›´æ¥è®¿é—®KeyChainï¼Œä¸€èˆ¬ä¼šåˆ›å»ºä¸€ä¸ªNSDictionaryæ¥åŒæ­¥å¯¹åº”çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸¤è€…éœ€è¦åšè½¬æ¢ã€‚</p>

<pre><code>//data to secItem  
- (NSMutableDictionary *)dictionaryToSecItemFormat:(NSDictionary *)dictionaryToConvert  
{  
    // Create a dictionary to return populated with the attributes and data.  
    NSMutableDictionary *returnDictionary = [NSMutableDictionary dictionaryWithDictionary:dictionaryToConvert];  

    //è®¾ç½®kSecClass  
    [returnDictionary setObject:(id)kSecClassGenericPassword forKey:(id)kSecClass];  
    //å°†Dictionaryé‡Œçš„kSecValueData(ä¸€èˆ¬å°±æ˜¯è¿™ä¸ªkeyChainé‡Œä¸»è¦å†…å®¹ï¼Œæ¯”å¦‚è¯´æ˜¯password),NSStringè½¬æ¢æˆNSData  
    NSString *passwordString = [dictionaryToConvert objectForKey:(id)kSecValueData];  
    [returnDictionary setObject:[passwordString dataUsingEncoding:NSUTF8StringEncoding] forKey:(id)kSecValueData];  
    return returnDictionary;  
}  
//secItem to data  
- (NSMutableDictionary *)secItemFormatToDictionary:(NSDictionary *)dictionaryToConvert  
{  
    NSMutableDictionary *returnDictionary = [NSMutableDictionary dictionaryWithDictionary:dictionaryToConvert];  

    // Add the proper search key and class attribute.  
    [returnDictionary setObject:(id)kCFBooleanTrue forKey:(id)kSecReturnData];  
    [returnDictionary setObject:(id)kSecClassGenericPassword forKey:(id)kSecClass];  

    // Acquire the password data from the attributes.  
    NSData *passwordData = NULL;  
    if (SecItemCopyMatching((CFDictionaryRef)returnDictionary, (CFTypeRef *)&amp;passwordData) == noErr)  
    {  
        // åˆ é™¤å¤šä½™çš„kSecReturnDataæ•°æ®  
        [returnDictionary removeObjectForKey:(id)kSecReturnData];  

        // å¯¹åº”å‰é¢çš„æ­¥éª¤ï¼Œå°†æ•°æ®ä»NSDataè½¬æˆNSString  
        NSString *password = [[[NSString alloc] initWithBytes:[passwordData bytes] length:[passwordData length]  
                                                     encoding:NSUTF8StringEncoding] autorelease];  
        [returnDictionary setObject:password forKey:(id)kSecValueData];  
    }  
    else  
    {  
        NSAssert(NO, @"Serious error, no matching item found in the keychain.\n");  
    }  
    [passwordData release];   
    return returnDictionary;  
}  
</code></pre>

<h6>5.å¢åˆ æ”¹</h6>

<p>ç”¨ä»£ç æ¥è¯´æ˜</p>

<pre><code>- (void)writeToKeychain  
{  
    NSDictionary *attributes = NULL;  
    NSMutableDictionary *updateItem = NULL;  
    OSStatus result;  
    //åˆ¤æ–­æ˜¯å¢è¿˜æ˜¯æ”¹  
    if (SecItemCopyMatching((CFDictionaryRef)genericPasswordQuery, (CFTypeRef *)&amp;attributes) == noErr)  
    {  
            // First we need the attributes from the Keychain.  
            updateItem = [NSMutableDictionary dictionaryWithDictionary:attributes];  
        // Second we need to add the appropriate search key/values.  
            [updateItem setObject:[genericPasswordQuery objectForKey:(id)kSecClass] forKey:(id)kSecClass];  
            // Lastly, we need to set up the updated attribute list being careful to remove the class.  
            NSMutableDictionary *tempCheck = [self dictionaryToSecItemFormat:keychainItemData];  
            //åˆ é™¤kSecClass updateä¸èƒ½updateè¯¥å­—æ®µï¼Œå¦åˆ™ä¼šæŠ¥é”™  
            [tempCheck removeObjectForKey:(id)kSecClass];  
        //å‚æ•°1è¡¨ç¤ºsearchçš„ï¼Œå‚æ•°2è¡¨ç¤ºéœ€è¦æ›´æ–°åçš„å€¼  
            result = SecItemUpdate((CFDictionaryRef)updateItem, (CFDictionaryRef)tempCheck);  
    }else{  
            //å¢åŠ   
            result = SecItemAdd((CFDictionaryRef)[self dictionaryToSecItemFormat:keychainItemData], NULL);  
    }  
}  
</code></pre>

<p>åˆ é™¤å¾ˆç®€å•ï¼Œå°±ä¸å†™æ³¨é‡Šäº†</p>

<pre><code>- (void)resetKeychainItem  
{  
    OSStatus junk = noErr;  
    if (!keychainItemData)  
    {  
        self.keychainItemData = [[NSMutableDictionary alloc] init];  
    }  
    else if (keychainItemData)  
    {  
        NSMutableDictionary *tempDictionary = [self dictionaryToSecItemFormat:keychainItemData];  
        junk = SecItemDelete((CFDictionaryRef)tempDictionary);  
        NSAssert( junk == noErr || junk == errSecItemNotFound, @"Problem deleting current dictionary." );  
    }  

    // Default attributes for keychain item.  
    [keychainItemData setObject:@"" forKey:(id)kSecAttrAccount];  
    [keychainItemData setObject:@"" forKey:(id)kSecAttrLabel];  
    [keychainItemData setObject:@"" forKey:(id)kSecAttrDescription];  

    // Default data for keychain item.  
    [keychainItemData setObject:@"" forKey:(id)kSecValueData];  
}  
</code></pre>

<p>äºŒ.Groupçš„é…ç½®
é…ç½®Targetçš„Code Signing Entitlements.</p>

<p><img src="/images/keyChain001.png" title="Caption" ></p>

<p>é…ç½®è¯¥æ–‡ä»¶</p>

<p><img src="/images/keyChain002.png" title="Caption" ></p>

<p><img src="/images/keyChain003.png" title="Caption" ></p>

<p>å¯ä»¥é…ç½®ä¸€ä¸ªArrayåˆ—è¡¨ï¼Œè¡¨ç¤ºè¯¥ç¨‹åºå¯ä»¥æ”¯æŒå¤šä¸ªgroup
è¿™æ ·å°±å¯ä»¥åœ¨åˆ›å»ºsecItemæ—¶å€™æ·»åŠ kSecAttrAccessGroupäº†ã€‚
ç»è¿‡æµ‹è¯•æœ‰ä»¥ä¸‹ç»éªŒåŒå¤§å®¶åˆ†äº«ï¼š</p>

<ul>
<li><p>1.ç›¸åŒbundleä¸‹ç”Ÿæˆçš„ç¨‹åºéƒ½å¯ä»¥å…±äº«ç›¸åŒgroupçš„keyChain.
ç›¸åŒbundleè§£é‡Šä¸‹å°±æ˜¯ï¼šæ¯”å¦‚:2ä¸ªç¨‹åºåˆ†åˆ«ä½¿ç”¨çš„provisionå¯¹åº”bundleæ˜¯com.jv.key1å’Œcom.jv.key2ï¼Œé‚£ä½ é…ç½®æ–‡ä»¶è‚¯å®šæ˜¯{Identifer}.com.jv.{name},å…¶ä¸­identiferæ˜¯è‹¹æœç”Ÿæˆçš„éšæœºä¸²å·ï¼Œå¯ä»¥åœ¨ç”³è¯·è¯ä¹¦æ—¶çœ‹åˆ°ï¼Œå¤åˆ¶è¿‡æ¥å³å¯ï¼Œnameå¯ä»¥è‡ªå·±å–ï¼Œç¨‹åºä¸­æŒ‡å®šå±äºå“ªä¸ªGroupå³å¯ã€‚</p></li>
<li><p>2.å¦‚æœä½ åœ¨ addkeyæ—¶ï¼Œæ²¡æœ‰æŒ‡å®šgroup,åˆ™ä¼šé»˜è®¤æ·»åŠ ä½ keychain-access-groupsé‡Œç¬¬ä¸€ä¸ªgroupï¼Œå¦‚æœä½ æ²¡æœ‰è®¾ç½®Entitlements,åˆ™é»˜è®¤ä½¿ç”¨å¯¹åº”çš„ç¨‹åºçš„bundle name,æ¯”å¦‚com.jv.key1,è¡¨ç¤ºåªèƒ½ç»™è‡ªå·±ç¨‹åºä½¿ç”¨ã€‚</p></li>
<li><p>3.å¦‚æœä½ ç¨‹åºæ·»åŠ çš„groupå¹¶ä¸å­˜åœ¨ä½ çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç¨‹åºä¼šå¥”æºƒï¼Œè¡¨ç¤ºæ— æ³•æ·»åŠ ã€‚å› æ­¤ä½ åªèƒ½æ·»åŠ ä½ é…ç½®æ–‡ä»¶ä¸­æ”¯æŒçš„keychainã€‚</p></li>
</ul>


<p>ä¸‰ã€ä¿å­˜ç§å¯†ä¿¡æ¯ï¼ˆå·¥å…·ï¼‰
åœ¨åº”ç”¨é‡Œä½¿ç”¨ä½¿ç”¨keyChainï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥Security.framework ï¼Œkeychainçš„æ“ä½œæ¥å£å£°æ˜åœ¨å¤´æ–‡ä»¶SecItem.hé‡Œã€‚ç›´æ¥ä½¿ç”¨SecItem.hé‡Œæ–¹æ³•æ“ä½œkeychainï¼Œéœ€è¦å†™çš„ä»£ç è¾ƒä¸ºå¤æ‚ï¼Œä¸ºå‡è½»å’±ä»¬ç¨‹åºå‘˜çš„å¼€å‘ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›å·²ç»å°è£…å¥½äº†çš„å·¥å…·ç±»ï¼Œä¸‹é¢æˆ‘ä¼šç®€å•ä»‹ç»ä¸‹æˆ‘ç”¨è¿‡çš„ä¸¤ä¸ªå·¥å…·ç±»ï¼šKeychainItemWrapperå’ŒSFHFKeychainUtilsã€‚</p>

<p>ï¼ˆä¸€ï¼‰KeychainItemWrapperæ˜¯appleå®˜æ–¹ä¾‹å­â€œGenericKeychainâ€é‡Œä¸€ä¸ªè®¿é—®keychainå¸¸ç”¨æ“ä½œçš„å°è£…ç±»ï¼Œåœ¨å®˜ç½‘ä¸Šä¸‹è½½äº†GenericKeychainé¡¹ç›®åï¼Œåªéœ€è¦
æŠŠâ€œKeychainItemWrapper.hâ€å’Œâ€œKeychainItemWrapper.mâ€æ‹·è´åˆ°æˆ‘ä»¬é¡¹ç›®ï¼Œå¹¶å¯¼å…¥Security.framework ã€‚KeychainItemWrapperçš„ç”¨æ³•ï¼š</p>

<pre><code>/** åˆå§‹åŒ–ä¸€ä¸ªä¿å­˜ç”¨æˆ·å¸å·çš„KeychainItemWrapper */
KeychainItemWrapper *wrapper = [[KeychainItemWrapper alloc] initWithIdentifier:@"Account Number"
                                                                   accessGroup:@"YOUR_APP_ID_HERE.com.yourcompany.AppIdentifier"];  

//ä¿å­˜å¸å·
[
wrapper setObject:@"&lt;å¸å·&gt;" forKey:(id)kSecAttrAccount];    

//ä¿å­˜å¯†ç 
[
wrapper setObject:@"&lt;å¸å·å¯†ç &gt;" forKey:(id)kSecValueData];    

//ä»keychainé‡Œå–å‡ºå¸å·å¯†ç 
NSString *password = [wrapper objectForKey:(id)kSecValueData];      

//æ¸…ç©ºè®¾ç½®
[
wrapper resetKeychainItem];
</code></pre>

<p>å…¶ä¸­æ–¹æ³•â€œ- (void)setObject:(id)inObject forKey:(id)key;â€é‡Œå‚æ•°â€œforKeyâ€çš„å€¼åº”è¯¥æ˜¯Security.framework é‡Œå¤´æ–‡ä»¶â€œSecItem.hâ€é‡Œå®šä¹‰å¥½çš„keyï¼Œç”¨å…¶ä»–å­—ç¬¦ä¸²åškeyç¨‹åºä¼šå´©æºƒï¼</p>

<p>ï¼ˆäºŒï¼‰SFHFKeychainUtils æä¾›äº†åœ¨ iOS keychainä¸­å®‰å…¨çš„å­˜å‚¨å¯†ç çš„å·¥å…·</p>

<p>ä¸‹è½½åœ°å€<a href="https://github.com/ldandersen/scifihifi-iphone/tree/master/security">https://github.com/ldandersen/scifihifi-iphone/tree/master/security</a></p>

<ul>
<li><p>1ã€å¼•å…¥Security.frameWorkæ¡†æ¶ã€‚</p></li>
<li><p>2ã€å¼•å…¥å¤´æ–‡ä»¶ï¼šSFHKeychainUtils.h.</p></li>
<li><p>3ã€å­˜å¯†ç ï¼š</p></li>
</ul>


<hr />

<pre><code>[SFHFKeychainUtils storeUsername:@"dd" andPassword:@"aa"forServiceName:SERVICE_NAME updateExisting:1 error:nil];

[SFHFKeychainUtils deleteItemForUsername:@"dd" andServiceName:SERVICE_NAME error:nil];
</code></pre>

<ul>
<li>4ã€å–å¯†ç ï¼š</li>
</ul>


<hr />

<pre><code>NSString *passWord =  [SFHFKeychainUtils getPasswordForUsername:@"dd"andServiceName:SERVICE_NAME error:nil];
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">iCocos</span></span>

      




<time class='entry-date' datetime='2015-07-20T22:46:16+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:46 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/senior/'>senior</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/07/16/appqia-dun-liao-zen-yao-ban-%3F/" title="Previous Post: Appå¡é¡¿äº†æ€ä¹ˆåŠï¼Ÿ">&laquo; Appå¡é¡¿äº†æ€ä¹ˆåŠï¼Ÿ</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/08/21/scrollviewhui-dao-ding-bu-fu-yuan/" title="Next Post: ScrollViewå›åˆ°é¡¶éƒ¨å¤åŸ">ScrollViewå›åˆ°é¡¶éƒ¨å¤åŸ &raquo;</a>
      
    </p>
  </footer>
</article>



  <section>
    <h1>Comments</h1>
    <div id="comments" aria-live="polite"><!-- Duoshuo Comment BEGIN -->
<div class="ds-thread" data-title="KeyChainåˆæ¢"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"icocoscao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END --></div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/apples/'>apples (2)</a></li>
<li class='category'><a href='/blog/categories/audio-video/'>audio-video (1)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (16)</a></li>
<li class='category'><a href='/blog/categories/foundation/'>foundation (32)</a></li>
<li class='category'><a href='/blog/categories/full/'>full (13)</a></li>
<li class='category'><a href='/blog/categories/low-level/'>low-level (4)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (4)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (1)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (12)</a></li>
<li class='category'><a href='/blog/categories/reverse/'>reverse (25)</a></li>
<li class='category'><a href='/blog/categories/senior/'>senior (40)</a></li>
<li class='category'><a href='/blog/categories/stack/'>stack (13)</a></li>
<li class='category'><a href='/blog/categories/summarize/'>summarize (5)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/08/oneday/">ä¿®è¡Œç¯‡-æ¢ç¨‹åºä¹‹ç²¾å</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/01/gezhongdicenshixian/">iOSå¼€å‘å„ç§åº•å±‚å®ç°--åŒ…ä½ æ»¡æ„ğŸ˜˜ï¼</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/01/weixinhongbao/">ç¦åˆ©ï¼šæŠ¢çº¢åŒ…ç¥å™¨å°±æ˜¯è¿™ä¹ˆæ¥çš„</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/26/chongzhengzhidao/">é‡æ•´ä¹‹é“ï¼ˆé¢è¯•+æŠ€æœ¯+åº•å±‚+é«˜çº§ï¼‰</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/10/duoxianc/">å¤šçº¿ç¨‹ä¹‹è‘µèŠ±å®å…¸</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<h1>æ‰«ä¸€æ‰«<abbr title="The word 'æ‰«ä¸€æ‰«' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'æ‰«ä¸€æ‰«', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/blog/2015/07/20/keychainchu-tan/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/blog/2015/07/20/keychainchu-tan/" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - iCocos -
<span class="credit">welcome to <a href="http://al1020119.github.io">æ›¹#é»</a></span>
</p>

</footer>
  






<!--
-->



</body>
</html>
