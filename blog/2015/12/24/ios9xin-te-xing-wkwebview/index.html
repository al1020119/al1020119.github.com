
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOS9-WKWebView+SFSafariViewController - iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="iCocosåšå®¢">
  <meta name="keywords" content="iCocos, iOSå¼€å‘, åšå®¢, æŠ€æœ¯åˆ†æ, æ–‡ç« , å­¦ä¹ , æ›¹é», æ›¹ç†é¹">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/blog/2015/12/24/ios9xin-te-xing-wkwebview/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>iCocosâ€”â€”ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">åšæ–‡</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/about">æ–‡ç« </a></li>
  <li><a href="/other">å…¶ä»–</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">iOS9-WKWebView+SFSafariViewController</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-24T19:35:40+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:35 pm</span></time>
        
        
        |   <a href="#comments">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>ä¸€ï¼šWKWebViewç®€å•ä»‹ç»</h2>

<p>webkitä½¿ç”¨WKWebViewæ¥ä»£æ›¿IOSçš„UIWebViewå’ŒOSXçš„WebViewï¼Œå¹¶ä¸”ä½¿ç”¨Nitro JavaScriptå¼•æ“ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ç¬¬ä¸‰æ–¹æµè§ˆå™¨è¿è¡ŒJavaScriptå°†ä¼šè·Ÿsafariä¸€æ ·å¿«ã€‚</p>

<p>å…ˆæ¥çœ‹çœ‹WKWebViewå’ŒUIWebViewæœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p>

<h6>UIWebViewï¼š</h6>

<ul>
<li>å§‹ç¥–çº§åˆ«ï¼Œæ”¯æŒçš„iOSç‰ˆæœ¬æ¯”è¾ƒå¤š</li>
<li>å¯æ”¯æŒæ‰“å¼€URLï¼ŒåŒ…æ‹¬å„ç§URLæ¨¡å¼ï¼Œä¾‹å¦‚ Httpsï¼ŒFTPç­‰</li>
<li>å¯æ”¯æŒæ‰“å¼€å„ç§ä¸åŒæ–‡ä»¶æ ¼å¼ï¼Œä¾‹å¦‚ txtï¼Œdocxï¼Œppt,ï¼ŒéŸ³è§†é¢‘æ–‡ä»¶ç­‰ï¼Œå¾ˆå¤šæ–‡æ¡£é˜…è¯»å™¨ä¼šç»å¸¸ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥ä¸€ä¸‹Appleçš„æ–‡æ¡£ï¼Œæ”¯æŒçš„æ ¼å¼è¿˜æ˜¯æŒºå¤šï¼Œåªæ˜¯ä¸åŒiOS ç‰ˆæœ¬çš„æ”¯æŒç¨‹åº¦ä¸å¤ªä¸€æ ·ï¼Œä½¿ç”¨æ—¶è¯·å¤šç•™æ„æµ‹è¯•ç¡®è®¤~</li>
<li>å ç”¨å†…å­˜æ¯”è¾ƒå¤šï¼Œå°¤å…¶æ˜¯ç½‘é¡µä¸­åŒ…å«æ¯”è¾ƒå¤šCSS+DIVä¹‹ç±»å†…å®¹æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°å†…å­˜è­¦å‘Šï¼ˆMemory Warningï¼‰</li>
<li>æ•ˆç‡ä½ï¼Œä¸çµæ´»ï¼Œå°¤å…¶æ˜¯å’Œ JavaScriptäº¤äº’æ—¶</li>
<li>æ— æ³•æ¸…é™¤æœ¬åœ°å­˜å‚¨æ•°æ®ï¼ˆLocal Storageï¼‰</li>
<li>ä»£ç†ï¼ˆdelegateï¼‰ä¹‹é—´çš„å›è°ƒæ¯”è¾ƒéº»çƒ¦ï¼Œæä¾›çš„å†…å®¹æ¯”è¾ƒä½çº§ï¼Œå°¤å…¶æ˜¯UIéƒ¨åˆ†ã€‚å¦‚æœæƒ³è‡ªå·±å®šåˆ¶ä¸€ä¸ªç±»ä¼¼ Safari çš„å†…åµŒæµè§ˆå™¨ï¼ˆBrowserï¼‰ï¼Œé‚£å°±å‘çˆ¹æ— æé™äº†ï¼Œä¾‹å¦‚æˆ‘ä»¬PDF Readerç³»åˆ—ä¸­çš„å†…åµŒBrowserï¼Œè‡ªå·±* æ‰‹åŠ¨æ¨¡æ‹Ÿå®ç°Tabåˆ‡æ¢ï¼Œåº•éƒ¨ToolåŠå„ç§Menuç­‰ï¼Œè¯´å¤šäº†éƒ½æ˜¯æ³ª~~</li>
</ul>


<h6>WKWebViewï¼š</h6>

<ul>
<li>iOS 8å¼•å…¥çš„ï¼Œæ¯”è¾ƒå¹´è½»</li>
<li>åœ¨å†…å­˜å’Œæ‰§è¡Œæ•ˆç‡ä¸Šè¦æ¯”UIWebViewé«˜å¾ˆå¤š</li>
<li>å¼€æ”¾åº¦è¾ƒé«˜ä½†æ®è¯´Bugæˆå¨</li>
<li>ç±»ä¼¼UIWebViewï¼ŒUIå®šåˆ¶æ¯”è¾ƒéº»çƒ¦Â·Â·Â·</li>
<li>æ²¡å…·ä½“æµ‹è¯•ä½¿ç”¨è¿‡ï¼Œå°±ä¸ç»§ç»­åˆ—ä¸¾äº† L~</li>
</ul>


<!--more-->


<h5>ç¬¬ä¸€ã€WKWebViewå¢åŠ çš„å±æ€§å’Œæ–¹æ³•</h5>

<p>ç±»æ¯”UIWebViewï¼Œè·ŸUIWebViewçš„APIå¯¹æ¯”ï¼Œ
å¢åŠ çš„å±æ€§ï¼š</p>

<pre><code>* 1ã€estimatedProgress åŠ è½½è¿›åº¦æ¡ï¼Œåœ¨IOS8ä¹‹å‰æˆ‘ä»¬æ˜¯é€šè¿‡ä¸€ä¸ªå‡çš„è¿›åº¦æ¡æ¥å®ç°
* 2ã€backForwardList è¡¨ç¤ºhistoryList
* 3ã€WKWebViewConfiguration *configuration; åˆå§‹åŒ–webviewçš„é…ç½®
</code></pre>

<p>å¢åŠ çš„æ–¹æ³•ï¼š</p>

<pre><code>- (instancetype)initWithFrame:(CGRect)frame configuration:(WKWebViewConfiguration *)configuration 
</code></pre>

<p>åˆå§‹åŒ–</p>

<pre><code>    - (WKNavigation *)goToBackForwardListItem:(WKBackForwardListItem *)item; 
</code></pre>

<p>è·³åˆ°å†å²çš„æŸä¸ªé¡µé¢</p>

<!--more-->


<h5>ç¬¬äºŒã€ç›¸åŒçš„å±æ€§å’Œæ–¹æ³•</h5>

<ul>
<li>goBackã€</li>
<li>goForwardã€</li>
<li>canGoBackã€</li>
<li>canGoForwardã€</li>
<li>stopLoadingã€</li>
<li>loadRequestã€</li>
<li>scrollView</li>
</ul>


<h5>ç¬¬ä¸‰ã€è¢«åˆ å»çš„å±æ€§å’Œæ–¹æ³•ï¼š</h5>

<pre><code>- (NSString *)stringByEvaluatingJavaScriptFromString:(NSString *)script;
</code></pre>

<p>åœ¨è·Ÿjsäº¤äº’æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªAPIï¼Œç›®å‰WKWebViewå®Œæ¡£æ²¡æœ‰ç»™å‡ºå®ç°ç±»ä¼¼åŠŸèƒ½çš„API</p>

<ul>
<li>æ— æ³•è®¾ç½®ç¼“å­˜
åœ¨UIWebViewï¼Œä½¿ç”¨NSURLCacheç¼“å­˜ï¼Œé€šè¿‡setSharedURLCacheå¯ä»¥è®¾ç½®æˆæˆ‘ä»¬è‡ªå·±çš„ç¼“å­˜ï¼Œä½†WKWebViewä¸æ”¯æŒNSURLCache

<h5>ç¬¬å››ã€delegateæ–¹æ³•çš„ä¸åŒ</h5>

<p>UIWebViewæ”¯æŒçš„ä»£ç†æ˜¯UIWebViewDelegateï¼ŒWKWebViewæ”¯æŒçš„ä»£ç†æ˜¯WKNavigationDelegateå’Œ
WKUIDelegate
WKNavigationDelegateä¸»è¦å®ç°äº†æ¶‰åŠåˆ°å¯¼èˆªè·³è½¬æ–¹é¢çš„å›è°ƒæ–¹æ³•
WKUIDelegateä¸»è¦å®ç°äº†æ¶‰åŠåˆ°ç•Œé¢æ˜¾ç¤ºçš„å›è°ƒæ–¹æ³•ï¼šå¦‚WKWebViewçš„æ”¹å˜å’Œjsç›¸å…³å†…å®¹
å…·ä½“æ¥è¯´WKNavigationDelegateé™¤äº†æœ‰å¼€å§‹åŠ è½½ã€åŠ è½½æˆåŠŸã€åŠ è½½å¤±è´¥çš„APIå¤–ï¼Œè¿˜å…·æœ‰é¢å¤–çš„ä¸‰ä¸ªä»£ç†æ–¹æ³•ï¼š</p>

<pre><code>  -(void)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(WKNavigation *)navigation
</code></pre>

<p>è¿™ä¸ªä»£ç†æ˜¯æœåŠ¡å™¨redirectæ—¶è°ƒç”¨</p>

<pre><code>  -(void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler
</code></pre>

<p>è¿™ä¸ªä»£ç†æ–¹æ³•è¡¨ç¤ºå½“å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”å¤´ï¼Œæ ¹æ®responseç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥å†³å®šè¿™æ¬¡è·³è½¬æ˜¯å¦å¯ä»¥ç»§ç»­è¿›è¡Œã€‚</p>

<pre><code>  -(void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler
</code></pre>

<p>æ ¹æ®webViewã€navigationActionç›¸å…³ä¿¡æ¯å†³å®šè¿™æ¬¡è·³è½¬æ˜¯å¦å¯ä»¥ç»§ç»­è¿›è¡Œ,è¿™äº›ä¿¡æ¯åŒ…å«HTTPå‘é€è¯·æ±‚ï¼Œå¦‚å¤´éƒ¨åŒ…å«User-Agent,Accept</p></li>
</ul>


<hr />

<h2>äºŒã€WKWebViewæ–°ç‰¹æ€§</h2>

<ul>
<li>åœ¨æ€§èƒ½ã€ç¨³å®šæ€§ã€åŠŸèƒ½æ–¹é¢æœ‰å¾ˆå¤§æå‡ï¼ˆæœ€ç›´è§‚çš„ä½“ç°å°±æ˜¯åŠ è½½ç½‘é¡µæ˜¯å ç”¨çš„å†…å­˜ï¼Œæ¨¡æ‹Ÿå™¨åŠ è½½ç™¾åº¦ä¸å¼€æºä¸­å›½* ç½‘ç«™æ—¶ï¼ŒWKWebViewå ç”¨23Mï¼Œè€ŒUIWebViewå ç”¨85Mï¼‰ï¼›</li>
<li>å…è®¸JavaScriptçš„Nitroåº“åŠ è½½å¹¶ä½¿ç”¨ï¼ˆUIWebViewä¸­é™åˆ¶ï¼‰ï¼›</li>
<li>æ”¯æŒäº†æ›´å¤šçš„HTML5ç‰¹æ€§ï¼›</li>
<li>é«˜è¾¾60fpsçš„æ»šåŠ¨åˆ·æ–°ç‡ä»¥åŠå†…ç½®æ‰‹åŠ¿ï¼›</li>
<li>å°†UIWebViewDelegateä¸UIWebViewé‡æ„æˆäº†14ç±»ä¸3ä¸ªåè®®ï¼ˆæŸ¥çœ‹è‹¹æœå®˜æ–¹æ–‡æ¡£ï¼‰ï¼›</li>
</ul>


<hr />

<h2>ä¸‰ï¼šåŸºæœ¬ä½¿ç”¨</h2>

<p>WKWebViewç›¸å¯¹äºUIWebViewå¼ºå¤§äº†å¾ˆå¤šï¼Œå†…å­˜çš„æ¶ˆè€—ç›¸å¯¹å°‘äº†ï¼Œæ‰€æä¾›çš„æ¥å£ä¹Ÿä¸°å¯Œäº†ã€‚
ç°åœ¨è°ˆä¸€è°ˆWKWebViewçš„åŸºæœ¬ä½¿ç”¨</p>

<h4>1. navigationDelegate</h4>

<pre><code>- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(WKNavigation *)navigation { // ç±»ä¼¼UIWebViewçš„ -webViewDidStartLoad:  
    NSLog(@"didStartProvisionalNavigation");  
    [UIApplication sharedApplication].networkActivityIndicatorVisible = YES;  
}  

- (void)webView:(WKWebView *)webView didCommitNavigation:(WKNavigation *)navigation {  
    NSLog(@"didCommitNavigation");  
}  

- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation { // ç±»ä¼¼ UIWebView çš„ ï¼webViewDidFinishLoad:  
    NSLog(@"didFinishNavigation");  
    [self resetControl];  
    if (webView.title.length &gt; 0) {  
        self.title = webView.title;  
    }  

}  
- (void)webView:(WKWebView *)webView didFailProvisionalNavigation:(WKNavigation *)navigation withError:(NSError *)error {  
    // ç±»ä¼¼ UIWebView çš„- webView:didFailLoadWithError:  

    NSLog(@"didFailProvisionalNavigation");  

}  
- (void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler {  

    decisionHandler(WKNavigationResponsePolicyAllow);  
}  


- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {  
    // ç±»ä¼¼ UIWebView çš„ -webView: shouldStartLoadWithRequest: navigationType:  

    NSLog(@"4.%@",navigationAction.request);  


    NSString *url = [navigationAction.request.URL.absoluteString stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];  



    decisionHandler(WKNavigationActionPolicyAllow);  

}  
- (void)webView:(WKWebView *)webView didReceiveAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition, NSURLCredential *))completionHandler {  

}  
</code></pre>

<h4>2 UIDelegate</h4>

<pre><code>- (WKWebView *)webView:(WKWebView *)webView createWebViewWithConfiguration:(WKWebViewConfiguration *)configuration forNavigationAction:(WKNavigationAction *)navigationAction windowFeatures:(WKWindowFeatures *)windowFeatures {  
    // æ¥å£çš„ä½œç”¨æ˜¯æ‰“å¼€æ–°çª—å£å§”æ‰˜  
    [self createNewWebViewWithURL:webView.URL.absoluteString config:configuration];  

    return currentSubView.webView;  
}  

- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)())completionHandler  
{    // js é‡Œé¢çš„alertå®ç°ï¼Œå¦‚æœä¸å®ç°ï¼Œç½‘é¡µçš„alertå‡½æ•°æ— æ•ˆ  
    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:message  
                                                                             message:nil  
                                                                      preferredStyle:UIAlertControllerStyleAlert];  
    [alertController addAction:[UIAlertAction actionWithTitle:@"ç¡®å®š"  
                                                        style:UIAlertActionStyleCancel  
                                                      handler:^(UIAlertAction *action) {  
                                                          completionHandler();  
                                                      }]];  

    [self presentViewController:alertController animated:YES completion:^{}];  

}  


- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL))completionHandler {  
    //  js é‡Œé¢çš„alertå®ç°ï¼Œå¦‚æœä¸å®ç°ï¼Œç½‘é¡µçš„alertå‡½æ•°æ— æ•ˆ  ,   

    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:message  
                                                                             message:nil  
                                                                      preferredStyle:UIAlertControllerStyleAlert];  
    [alertController addAction:[UIAlertAction actionWithTitle:@"ç¡®å®š"  
                                                        style:UIAlertActionStyleDefault  
                                                      handler:^(UIAlertAction *action) {  
                                                          completionHandler(YES);  
                                                      }]];  
    [alertController addAction:[UIAlertAction actionWithTitle:@"å–æ¶ˆ"  
                                                        style:UIAlertActionStyleCancel  
                                                      handler:^(UIAlertAction *action){  
                                                          completionHandler(NO);  
                                                      }]];  

    [self presentViewController:alertController animated:YES completion:^{}];  

}  

- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString *))completionHandler {  

    completionHandler(@"Client Not handler");  

}  
</code></pre>

<h4>3. WKWebView æ‰§è¡Œè„šæœ¬æ–¹æ³•</h4>

<pre><code>- (void)evaluateJavaScript:(NSString *)javaScriptString completionHandler:(void (^)(id, NSError *))completionHandler;  

completionHandler æ‹¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è¿”å›é”™è¯¯ï¼Œä¸€ä¸ªå¯ä»¥è¿”å›æ‰§è¡Œè„šæœ¬åçš„è¿”å›å€¼  
</code></pre>

<h4>4. WKWebView çš„Cookieé—®é¢˜</h4>

<p>UIWebView ä¸­ä¼šè‡ªåŠ¨ä¿å­˜Cookieï¼Œå¦‚æœç™»å½•äº†ä¸€æ¬¡ï¼Œä¸‹æ¬¡å†æ¬¡è¿›å…¥çš„æ—¶å€™ï¼Œä¼šè®°ä½ç™»å½•çŠ¶æ€
è€Œåœ¨WKWebViewä¸­ï¼Œå¹¶ä¸ä¼šè¿™æ ·ï¼ŒWKWebViewåœ¨åˆå§‹åŒ–çš„æ—¶å€™æœ‰ä¸€ä¸ªæ–¹æ³•</p>

<pre><code>- (instancetype)initWithFrame:(CGRect)frame configuration:(WKWebViewConfiguration *)configuration  
</code></pre>

<p>é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œè®¾ç½® configuration è®©WKWebViewçŸ¥é“ç™»å½•çŠ¶æ€ï¼Œconfiguration å¯ä»¥é€šè¿‡å·²æœ‰çš„Cookieè¿›è¡Œè®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿å­˜ä¸Šä¸€æ¬¡çš„configurationè¿›è¡Œè®¾ç½®</p>

<p>å‚è€ƒ stackoverflowä¸Šå›ç­”ï¼š</p>

<p><a href="http://stackoverflow.com/questions/26573137/can-i-set-the-cookies-to-be-used-by-a-wkwebview/26577303#26577303">http://stackoverflow.com/questions/26573137/can-i-set-the-cookies-to-be-used-by-a-wkwebview/26577303#26577303</a></p>

<pre><code>WKWebView * webView = /*set up your webView*/  
NSMutableURLRequest * request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http://example.com/index.html"]];  
[request addValue:@"TeskCookieKey1=TeskCookieValue1;TeskCookieKey2=TeskCookieValue2;" forHTTPHeaderField:@"Cookie"];  
// use stringWithFormat: in the above line to inject your values programmatically  
[webView loadRequest:request];  

[objc] view plaincopyprint?åœ¨CODEä¸ŠæŸ¥çœ‹ä»£ç ç‰‡æ´¾ç”Ÿåˆ°æˆ‘çš„ä»£ç ç‰‡
WKUserContentController* userContentController = WKUserContentController.new;  
WKUserScript * cookieScript = [[WKUserScript alloc]   
    initWithSource: @"document.cookie = 'TeskCookieKey1=TeskCookieValue1';document.cookie = 'TeskCookieKey2=TeskCookieValue2';"  
    injectionTime:WKUserScriptInjectionTimeAtDocumentStart forMainFrameOnly:NO];  
// again, use stringWithFormat: in the above line to inject your values programmatically  
[userContentController addUserScript:cookieScript];  
WKWebViewConfiguration* webViewConfig = WKWebViewConfiguration.new;  
webViewConfig.userContentController = userContentController;  
WKWebView * webView = [[WKWebView alloc] initWithFrame:CGRectMake(/*set your values*/) configuration:webViewConfig];  
</code></pre>

<hr />

<h2>å››ï¼šWKWebViewä¸jsé€šä¿¡</h2>

<p>iOS 8 å¼•å…¥WKWebView, WKWebView ä¸æ”¯æŒJavaScriptCoreçš„æ–¹å¼ä½†æä¾›message handlerçš„æ–¹å¼ä¸ºJavaScript ä¸Objective-C é€šä¿¡.
åœ¨Objective-C ä¸­ä½¿ç”¨WKWebViewçš„ä»¥ä¸‹æ–¹æ³•è°ƒç”¨JavaScript:</p>

<pre><code>- (void)evaluateJavaScript:(NSString *)javaScriptString
         completionHandler:(void (^)(id, NSError *))completionHandler
å¦‚æœJavaScript ä»£ç å‡ºé”™, å¯ä»¥åœ¨completionHandler è¿›è¡Œå¤„ç†.
åœ¨Objective-C ä¸­æ³¨å†Œ message handler:
// WKScriptMessageHandler protocol?

- (void)userContentController:(WKUserContentController *)userContentController
    didReceiveScriptMessage:(WKScriptMessage *)message
{
    NSLog(@"Message: %@", message.body);
}

[userContentController addScriptMessageHandler:handler name:@"myName"];
åœ¨JavaScript å°†ä¿¡æ¯å‘ç»™Objective-C:
// window.webkit.messageHandlers.&lt;name&gt;.postMessage();?

function postMyMessage()? {?
    var message = { 'message' : 'Hello, World!', 'numbers' : [ 1, 2, 3 ] };?
    window.webkit.messageHandlers.myName.postMessage(message);?
}
</code></pre>

<hr />

<h2>äº”ï¼šå¸¸è§é—®é¢˜ï¼š</h2>

<p>32 ä½çš„appåœ¨ä½¿ç”¨WKWebViewçš„æ—¶å€™ï¼Œå¦‚æœè¿è¡Œåœ¨64ä½çš„è®¾å¤‡ä¸Šï¼Œä¼šå‡ºç°ä¸€ä¸‹é—®é¢˜ï¼š</p>

<ul>
<li>ï¼ˆ1ï¼‰iOS8.1 ç³»ç»Ÿï¼Œéƒ¨åˆ†ç½‘é¡µåŠ è½½ç™½å±ï¼Œä¾‹å¦‚ ç™¾åº¦ï¼ŒiOS8.3 ä¼¼ä¹æ²¡é—®é¢˜</li>
<li>ï¼ˆ2ï¼‰webè¾“å…¥æ¡†è¾“å…¥æ±‰å­—ä¹Ÿä¼šå‡ºç°ç™½å±</li>
</ul>


<p>é€šè¿‡æœç´¢å¾—åˆ°é—®é¢˜æ ¹æºï¼š</p>

<blockquote><p>WKWebView&rsquo;s WebProcess runs out-of-process as a 64-bit process on hardware supporting 64bit. There is a 32bit/64bit marshalling IPC bug for 32 bit apps using the WKWebView client on such hardware. The bug causes the WebProcess to exit, leaving a blank screen.</p></blockquote>

<ul>
<li>ä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹é—´é€šè®¯çš„bugå¼•èµ·çš„ã€‚</li>
</ul>


<h6>è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿appæ”¯æŒarm64ï¼Œä¾¿ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</h6>

<hr />

<h2>å…­ï¼šSFSafariViewControllerï¼š</h2>

<ul>
<li>iOS 9å¼•å…¥ï¼Œæ›´åŠ å¹´è½»ï¼Œæ„å‘³ç€æ˜¯Appleçš„æ–°èœï¼Œæ€»æ˜¯æœ‰ä»€ä¹ˆä¼˜åŠ¿çš„</li>
<li>ä¹Ÿæ˜¯ç”¨æ¥æ˜¾ç¤ºç½‘é¡µå†…å®¹çš„</li>
<li>è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„View Controllerï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ Viewï¼Œå’Œå‰é¢ä¸¤ä¸ªçš„åŒºåˆ«</li>
<li>åœ¨å½“å‰Appä¸­ä½¿ç”¨Safariçš„UIæ¡†æ¶å±•ç°Webå†…å®¹ï¼ŒåŒ…æ‹¬ç›¸åŒçš„åœ°å€æ ï¼Œå·¥å…·æ ç­‰ï¼Œç±»ä¼¼ä¸€ä¸ªå†…ç½®äºAppçš„å°å‹Safari</li>
<li>å…±äº«Safariçš„ä¸€äº›ä¾¿åˆ©ç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼šç›¸ä¼¼çš„ç”¨æˆ·ä½“éªŒï¼Œå’ŒSafariå…±äº«Cookieï¼ŒiCloud Webè¡¨å•æ•°æ®ï¼Œå¯†ç ã€è¯ä¹¦è‡ªåŠ¨å¡«å……ï¼ŒSafarié˜…è¯»å™¨ï¼ˆSafari Readerï¼‰</li>
<li>å¯å®šåˆ¶æ€§æ¯”è¾ƒå·®ï¼Œç”šè‡³è¿åœ°å€æ éƒ½æ˜¯ä¸å¯ç¼–è¾‘çš„ï¼Œåªèƒ½åœ¨initçš„æ—¶å€™ï¼Œä¼ å…¥ä¸€ä¸ªURLæ¥æŒ‡å®šç½‘é¡µçš„åœ°å€</li>
<li>åªèƒ½ç”¨æ¥å±•ç¤ºå•ä¸ªé¡µé¢ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå®ŒæˆæŒ‰é’®ç”¨æ¥é€€å‡º</li>
</ul>


<p><img src="/images/safari001.png" title="Caption" ></p>

<p>å¦‚æœä½ çš„Appéœ€è¦æ˜¾ç¤ºç½‘é¡µï¼Œä½†æ˜¯åˆä¸æƒ³è‡ªå·±å»å®šåˆ¶æµè§ˆå™¨ç•Œé¢çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ç”¨SFSafariViewControlleræ¥è¯•è¯•ã€‚ä»å¥½çš„æ–¹é¢çœ‹ï¼ŒSFSafariViewControllerä¹Ÿå»æ‰äº†ä»Appä¸­è·³è½¬åˆ°Safariçš„æ’•è£‚æ„Ÿï¼Œä¸åŒAppä¹‹é—´åˆ‡æ¢æ€»æ˜¯è®©äººæ„Ÿè§‰éº»çƒ¦å’Œä¸èˆ’æœã€‚</p>

<p>ä»£ç ä¾‹å­:</p>

<pre><code>- (IBAction)onButtonClick:(id)sender

{

    NSString *urlString = @"http://www.kdanmobile.com";

    SFSafariViewController *sfViewControllr = [[SFSafariViewController alloc] initWithURL:[NSURL URLWithString:urlString]];

    sfViewControllr.delegate = self;

    [self presentViewController:sfViewControllr animated:YES completion:^{

       //...

    }];

}



// Done æŒ‰é’®

- (void)safariViewControllerDidFinish:(nonnull SFSafariViewController *)controller

{

    [controller dismissViewControllerAnimated:YES completion:nil];

}
</code></pre>

<p>SFSafariViewController çš„æ¥å£æ¯”è¾ƒå°‘ï¼Œå°±ä¸å†ç»§ç»­ä¸€ä¸€åˆ—ä¸¾äº†ã€‚å¦å¤–ä¸€ä¸ªå®šåˆ¶åŠŸèƒ½åœ¨äºSFSafariViewControllerDelegateé‡Œé¢çš„ä¸€ä¸ªæ–¹æ³•ï¼š</p>

<pre><code>-(NSArray&lt;UIActivity *&gt; *)safariViewController:(SFSafariViewController *)controller activityItemsForURL:(NSURL *)URL title:(nullable NSString *)title;
</code></pre>

<p>è¿™ä¸ªä»£ç†ä¼šåœ¨ç”¨æˆ·ç‚¹å‡»åŠ¨ä½œï¼ˆActionï¼‰æŒ‰é’®ï¼ˆåº•éƒ¨å·¥å…·æ ä¸­é—´çš„æŒ‰é’®ï¼‰çš„æ—¶å€™è°ƒç”¨ï¼Œå¯ä»¥ä¼ å…¥UIActivityçš„æ•°ç»„ï¼Œåˆ›å»ºæ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„å„ç±»æ’ä»¶å¼çš„æœåŠ¡ï¼Œæ¯”å¦‚åˆ†äº«åˆ°å¾®ä¿¡ï¼Œå¾®åšä»€ä¹ˆçš„ã€‚</p>

<p><img src="/images/safari001.png" title="Caption" ></p>

<blockquote><p>å°ç»†èŠ‚ï¼š
SFSafariViewControlleræœ‰ä¿å­˜Cookiesçš„åŠŸèƒ½ï¼Œä½†æ˜¯è²Œä¼¼ä¸èƒ½å’ŒSafariæµè§ˆå™¨å…±äº«ï¼Œä¹Ÿå¯èƒ½æ˜¯Betaç‰ˆçš„bug</p></blockquote>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">iCocos</span></span>

      




<time class='entry-date' datetime='2015-12-24T19:35:40+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:35 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/news/'>news</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/12/22/ios9-unit-test/" title="Previous Post: iOS9-Unit Test">&laquo; iOS9-Unit Test</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/12/25/ios9-corespotlight/" title="Next Post: iOS9-CoreSpotlight">iOS9-CoreSpotlight &raquo;</a>
      
    </p>
  </footer>
</article>



  <section>
    <h1>Comments</h1>
    <div id="comments" aria-live="polite"><!-- Duoshuo Comment BEGIN -->
<div class="ds-thread" data-title="iOS9-WKWebView+SFSafariViewController"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"icocoscao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END --></div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/algorithms/'>algorithms (6)</a></li>
<li class='category'><a href='/blog/categories/and/'>and (11)</a></li>
<li class='category'><a href='/blog/categories/apples/'>apples (2)</a></li>
<li class='category'><a href='/blog/categories/application/'>application (1)</a></li>
<li class='category'><a href='/blog/categories/architecture/'>architecture (2)</a></li>
<li class='category'><a href='/blog/categories/audio/'>audio (5)</a></li>
<li class='category'><a href='/blog/categories/audio-video/'>audio-video (1)</a></li>
<li class='category'><a href='/blog/categories/data/'>data (6)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (16)</a></li>
<li class='category'><a href='/blog/categories/foundation/'>foundation (31)</a></li>
<li class='category'><a href='/blog/categories/full/'>full (13)</a></li>
<li class='category'><a href='/blog/categories/low-level/'>low-level (4)</a></li>
<li class='category'><a href='/blog/categories/lve/'>lve (5)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (4)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (1)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (12)</a></li>
<li class='category'><a href='/blog/categories/php-lover/'>php-lover (2)</a></li>
<li class='category'><a href='/blog/categories/practical/'>practical (1)</a></li>
<li class='category'><a href='/blog/categories/radio/'>radio (5)</a></li>
<li class='category'><a href='/blog/categories/reverse/'>reverse (7)</a></li>
<li class='category'><a href='/blog/categories/senior/'>senior (31)</a></li>
<li class='category'><a href='/blog/categories/stack/'>stack (13)</a></li>
<li class='category'><a href='/blog/categories/structures/'>structures (6)</a></li>
<li class='category'><a href='/blog/categories/summarize/'>summarize (5)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>
<li class='category'><a href='/blog/categories/video/'>video (5)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/12/08/bao-chi-chu-cin-ji-xu-qian-jin/">ä¿æŒåˆå¿ƒç»§ç»­å‰è¿›-å¹´ç»ˆç¯‡</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/06/ios-daobao/">è‡ªåŠ¨æ‰“åŒ…ä¸Šä¼ ä»£ç </a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/03/phpwan-mei-da-pei-mysql/">PHPå®Œç¾æ­é…ä¹‹Mysqlåˆæ¢</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/02/zhong-zheng-linux/">é‡æ•´Linuxä¸€æ¬¡å°±å¤Ÿäº†</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/01/wan-zhuan-thinkphp-5-dot-star/">å®Œè™ThinkPHP 5.* è¿œä¸æ­¢è¿™äº›ğŸ˜±ğŸ˜‚</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





<section>
<h1>åšå®¢<abbr title="The word 'åšå®¢' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'åšå®¢', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/blog/2015/12/24/ios9xin-te-xing-wkwebview/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/blog/2015/12/24/ios9xin-te-xing-wkwebview/" alt="post-qrcode"></a></section>


<section>
<h1>github<abbr title="The word 'github' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'github', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosgithub.png" alt="post-qrcode"></a></section>


<section>
<h1>å¾®ä¿¡<abbr title="The word 'å¾®ä¿¡' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å¾®ä¿¡', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosWX.png" alt="post-qrcode"></a></section>


<section>
<h1>å…¬ä¼—å·<abbr title="The word 'å…¬ä¼—å·' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å…¬ä¼—å·', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosMGC.png" alt="post-qrcode"></a><section>
  
  
</section>
<h1>å…¬ä¼—å·<abbr title="The word 'å…¬ä¼—å·' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å…¬ä¼—å·', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocos520.png" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - iCocos -
<span class="credit">welcome to <a href="http://al1020119.github.io">æ›¹#é»</a></span>
</p>

</footer>
  






<!--
-->



</body>
</html>
