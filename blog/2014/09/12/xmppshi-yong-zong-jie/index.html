
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>XMPPä½¿ç”¨æ€»ç»“ - iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="iCocosåšå®¢">
  <meta name="keywords" content="iCocos, iOSå¼€å‘, åšå®¢, æŠ€æœ¯åˆ†æ, æ–‡ç« , å­¦ä¹ , æ›¹é», æ›¹ç†é¹">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/blog/2014/09/12/xmppshi-yong-zong-jie/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>iCocosâ€”â€”ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">åšæ–‡</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/about">æ–‡ç« </a></li>
  <li><a href="/other">å…¶ä»–</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">XMPPä½¿ç”¨æ€»ç»“</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-12T00:21:39+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:21 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>å¼•è¨€ï¼š
æœ€è¿‘é¢è¯•è¢«é—®åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œç¬”è€…å½“æ—¶å°±æ‡µäº†ï¼šä»€ä¹ˆXMPPï¼Œå¹³æ—¶æ€ä¹ˆä½¿ç”¨ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿã€‚</p>

<p>ä½†æ˜¯è¿˜æ˜¯é€šè¿‡è®°å¿†ï¼Œç®€å•çš„è¯´äº†ä¸€ä¸‹è‡ªå·±æ‰€çŸ¥é“äº†ï¼Œä¸è¿‡é‚£å¹¶æ²¡æœ‰æ’’åµç”¨ï¼Œæ‰€ä»¥ä½ æ‡‚çš„</p>

<!--more-->


<h6>##XMPPFrameworkæ˜¯ä¸€ä¸ªOS X/iOSå¹³å°çš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨Objective-Cå®ç°äº†XMPPåè®®ï¼ˆRFC-3920ï¼‰ï¼ŒåŒæ—¶è¿˜æä¾›äº†ç”¨äºè¯»å†™XMLçš„å·¥å…·ï¼Œå¤§å¤§ç®€åŒ–äº†åŸºäºXMPPçš„é€šä¿¡åº”ç”¨çš„å¼€å‘ã€‚</h6>

<h3>å…³äºè¿æ¥çš„</h3>

<pre><code>//æ­¤æ–¹æ³•åœ¨streamå¼€å§‹è¿æ¥æœåŠ¡å™¨çš„æ—¶å€™è°ƒç”¨
 - (void)xmppStreamDidConnect:(XMPPStream *)sender
 //æ­¤æ–¹æ³•åœ¨streamè¿æ¥æ–­å¼€çš„æ—¶å€™è°ƒç”¨
 - (void)xmppStreamDidDisconnect:(XMPPStream *)sender withError:(NSError *)error;
</code></pre>

<h3>å…³äºéªŒè¯çš„</h3>

<pre><code>//éªŒè¯å¤±è´¥åè°ƒç”¨
 - (void)xmppStream:(XMPPStream *)sender didNotAuthenticate:(NSXMLElement *)error
//éªŒè¯æˆåŠŸåè°ƒç”¨
 - (void)xmppStreamDidAuthenticate:(XMPPStream *)sender
</code></pre>

<h3>å…³äºé€šä¿¡çš„</h3>

<pre><code>//æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨
- (void)xmppStream:(XMPPStream *)sender didReceiveMessage:(XMPPMessage *)message
//æ¥å—åˆ°å¥½å‹çŠ¶æ€æ›´æ–°
- (void)xmppStream:(XMPPStream *)sender didReceivePresence:(XMPPPresence *)presence
</code></pre>

<h4>ç®€å•å®æˆ˜</h4>

<h6>ç™»å½•å’Œå¥½å‹ä¸Šä¸‹çº¿</h6>

<h5>XMPPä¸­å¸¸ç”¨å¯¹è±¡ä»¬</h5>

<pre><code>XMPPStreamï¼šxmppåŸºç¡€æœåŠ¡ç±»
XMPPRosterï¼šå¥½å‹åˆ—è¡¨ç±»
XMPPRosterCoreDataStorageï¼šå¥½å‹åˆ—è¡¨ï¼ˆç”¨æˆ·è´¦å·ï¼‰åœ¨core dataä¸­çš„æ“ä½œç±»
XMPPvCardCoreDataStorageï¼šå¥½å‹åç‰‡ï¼ˆæ˜µç§°ï¼Œç­¾åï¼Œæ€§åˆ«ï¼Œå¹´é¾„ç­‰ä¿¡æ¯ï¼‰åœ¨core dataä¸­çš„æ“ä½œç±»
XMPPvCardTempï¼šå¥½å‹åç‰‡å®ä½“ç±»ï¼Œä»æ•°æ®åº“é‡Œå–å‡ºæ¥çš„éƒ½æ˜¯å®ƒ
xmppvCardAvatarModuleï¼šå¥½å‹å¤´åƒ
XMPPReconnectï¼šå¦‚æœå¤±å»è¿æ¥,è‡ªåŠ¨é‡è¿
XMPPRoomï¼šæä¾›å¤šç”¨æˆ·èŠå¤©æ”¯æŒ
</code></pre>

<p>XMPPPubSubï¼šå‘å¸ƒè®¢é˜…</p>

<h5>ç™»å½•æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¿æ¥xmppæœåŠ¡å™¨</h5>

<pre><code>- (void)connect {
    if (self.xmppStream == nil) {
        self.xmppStream = [[XMPPStream alloc] init];
        [self.xmppStream addDelegate:self delegateQueue:dispatch_get_main_queue()];
    }
    if (![self.xmppStream isConnected]) {
        NSString *username = [[NSUserDefaults standardUserDefaults] objectForKey:@"username"];
        XMPPJID *jid = [XMPPJID jidWithUser:username domain:@"lizhen" resource:@"Ework"];
        [self.xmppStream setMyJID:jid];
        [self.xmppStream setHostName:@"10.4.125.113"];
        NSError *error = nil;
        if (![self.xmppStream connect:&amp;error]) {
            NSLog(@"Connect Error: %@", [[error userInfo] description]);
        }
    }
}
</code></pre>

<p>connectæˆåŠŸä¹‹åä¼šä¾æ¬¡è°ƒç”¨XMPPStreamDelegateçš„æ–¹æ³•ï¼Œé¦–å…ˆè°ƒç”¨</p>

<pre><code>- (void)xmppStream:(XMPPStream *)sender socketDidConnect:(GCDAsyncSocket *)socket
</code></pre>

<p>&hellip;
ç„¶å</p>

<ul>
<li><p>(void)xmppStreamDidConnect:(XMPPStream *)sender
åœ¨è¯¥æ–¹æ³•ä¸‹é¢éœ€è¦ä½¿ç”¨xmppStream çš„authenticateWithPasswordæ–¹æ³•è¿›è¡Œå¯†ç éªŒè¯ï¼ŒæˆåŠŸçš„è¯ä¼šå“åº”delegateçš„æ–¹æ³•ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ª</p></li>
<li><p>(void)xmppStreamDidAuthenticate:(XMPPStream *)sender</p></li>
</ul>


<h5>ä¸Šçº¿</h5>

<p>å®ç° - (void)xmppStreamDidAuthenticate:(XMPPStream *)sender å§”æ‰˜æ–¹æ³•</p>

<pre><code>- (void)xmppStreamDidAuthenticate:(XMPPStream *)sender {
     XMPPPresence *presence = [XMPPPresence presenceWithType:@"available"];
    [self.xmppStream sendElement:presence];
 }
</code></pre>

<h5>é€€å‡ºå¹¶æ–­å¼€è¿æ¥</h5>

<pre><code> - (void)disconnect {
     XMPPPresence *presence = [XMPPPresence presenceWithType:@"unavailable"];
    [self.xmppStream sendElement:presence];

      [self.xmppStream disconnect];
  }
</code></pre>

<h5>å¥½å‹çŠ¶æ€</h5>

<p>è·å–å¥½å‹çŠ¶æ€ï¼Œé€šè¿‡å®ç°</p>

<pre><code>- (void)xmppStream:(XMPPStream *)sender didReceivePresence:(XMPPPresence *)presence
</code></pre>

<p>&hellip;
æ–¹æ³•ï¼Œå½“æ¥æ”¶åˆ° presence æ ‡ç­¾çš„å†…å®¹æ—¶ï¼ŒXMPPFramework æ¡†æ¶å›è°ƒè¯¥æ–¹æ³•</p>

<pre><code>presence çš„çŠ¶æ€ï¼š
available ä¸Šçº¿
away ç¦»å¼€
do not disturb å¿™ç¢Œ
unavailable ä¸‹çº¿

- (void)xmppStream:(XMPPStream *)sender didReceivePresence:(XMPPPresence *)presence {
    NSString *presenceType = [presence type];
    NSString *presenceFromUser = [[presence from] user];
    if (![presenceFromUser isEqualToString:[[sender myJID] user]]) {
        if ([presenceType isEqualToString:@"available"]) {
            //
        } else if ([presenceType isEqualToString:@"unavailable"]) {
            //
        }
    }
}
</code></pre>

<h3>æ¥æ”¶æ¶ˆæ¯å’Œå‘é€æ¶ˆæ¯</h3>

<h5>æ¥æ”¶æ¶ˆæ¯</h5>

<p>é€šè¿‡å®ç°</p>

<ul>
<li><p>(void)xmppStream:(XMPPStream <em>)sender didReceiveMessage:(XMPPMessage </em>)message;
å½“æ¥æ”¶åˆ° message æ ‡ç­¾çš„å†…å®¹æ—¶ï¼ŒXMPPFramework æ¡†æ¶å›è°ƒè¯¥æ–¹æ³•
æ ¹æ® XMPP åè®®ï¼Œæ¶ˆæ¯ä½“çš„å†…å®¹å­˜å‚¨åœ¨æ ‡ç­¾ body å†…</p></li>
<li><p>(void)xmppStream:(XMPPStream <em>)sender didReceiveMessage:(XMPPMessage </em>)message {
  NSString *messageBody = [[message elementForName:@&ldquo;body&rdquo;] stringValue];
}</p></li>
</ul>


<h5>å‘é€æ¶ˆæ¯</h5>

<p>å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ® XMPP åè®®ï¼Œå°†æ•°æ®æ”¾åˆ°æ ‡ç­¾å†…</p>

<pre><code>- (void)sendMessage:(NSString *) message toUser:(NSString *) user {
    NSXMLElement *body = [NSXMLElement elementWithName:@"body"];
    [body setStringValue:message];
    NSXMLElement *message = [NSXMLElement elementWithName:@"message"];
    [message addAttributeWithName:@"type" stringValue:@"chat"];
    NSString *to = [NSString stringWithFormat:@"%@@example.com", user];
    [message addAttributeWithName:@"to" stringValue:to];
    [message addChild:body];
    [self.xmppStream sendElement:message];
}
</code></pre>

<h3>è·å–å¥½å‹ä¿¡æ¯å’Œåˆ é™¤å¥½å‹</h3>

<h5>å¥½å‹åˆ—è¡¨å’Œå¥½å‹åç‰‡</h5>

<pre><code>[_xmppRoster fetchRoster];//è·å–å¥½å‹åˆ—è¡¨
//è·å–åˆ°ä¸€ä¸ªå¥½å‹èŠ‚ç‚¹
- (void)xmppRoster:(XMPPRoster *)sender didRecieveRosterItem:(NSXMLElement *)item
//è·å–å®Œå¥½å‹åˆ—è¡¨
- (void)xmppRosterDidEndPopulating:(XMPPRoster *)sender
//åˆ°æœåŠ¡å™¨ä¸Šè¯·æ±‚è”ç³»äººåç‰‡ä¿¡æ¯
- (void)fetchvCardTempForJID:(XMPPJID *)jid;
//è¯·æ±‚è”ç³»äººçš„åç‰‡ï¼Œå¦‚æœæ•°æ®åº“æœ‰å°±ä¸è¯·æ±‚ï¼Œæ²¡æœ‰å°±å‘é€åç‰‡è¯·æ±‚
- (void)fetchvCardTempForJID:(XMPPJID *)jid ignoreStorage:(BOOL)ignoreStorage;
//è·å–è”ç³»äººçš„åç‰‡ï¼Œå¦‚æœæ•°æ®åº“æœ‰å°±è¿”å›ï¼Œæ²¡æœ‰è¿”å›ç©ºï¼Œå¹¶åˆ°æœåŠ¡å™¨ä¸ŠæŠ“å–
- (XMPPvCardTemp *)vCardTempForJID:(XMPPJID *)jid shouldFetch:(BOOL)shouldFetch;
//æ›´æ–°è‡ªå·±çš„åç‰‡ä¿¡æ¯
- (void)updateMyvCardTemp:(XMPPvCardTemp *)vCardTemp;
//è·å–åˆ°ä¸€ç›’è”ç³»äººçš„åç‰‡ä¿¡æ¯çš„å›è°ƒ
- (void)xmppvCardTempModule:(XMPPvCardTempModule *)vCardTempModule
        didReceivevCardTemp:(XMPPvCardTemp *)vCardTemp
                     forJID:(XMPPJID *)jid
</code></pre>

<h5>æ·»åŠ å¥½å‹</h5>

<pre><code>//nameä¸ºç”¨æˆ·è´¦å·
    - (void)XMPPAddFriendSubscribe:(NSString *)name
    {
        //XMPPHOST å°±æ˜¯æœåŠ¡å™¨åï¼Œ  ä¸»æœºå
        XMPPJID *jid = [XMPPJID jidWithString:[NSString stringWithFormat:@"%@@%@",name,XMPPHOST]];
        //[presence addAttributeWithName:@"subscription" stringValue:@"å¥½å‹"];
        [xmppRoster subscribePresenceToUser:jid];

    }
</code></pre>

<h5>æ”¶åˆ°æ·»åŠ å¥½å‹çš„è¯·æ±‚</h5>

<pre><code>- (void)xmppRoster:(XMPPRoster *)sender didReceivePresenceSubscriptionRequest:(XMPPPresence *)presence
    {
        //å–å¾—å¥½å‹çŠ¶æ€
        NSString *presenceType = [NSString stringWithFormat:@"%@", [presence type]]; //online/offline
        //è¯·æ±‚çš„ç”¨æˆ·
        NSString *presenceFromUser =[NSString stringWithFormat:@"%@", [[presence from] user]];
        NSLog(@"presenceType:%@",presenceType);

        NSLog(@"presence2:%@  sender2:%@",presence,sender);

        XMPPJID *jid = [XMPPJID jidWithString:presenceFromUser];
        //æ¥æ”¶æ·»åŠ å¥½å‹è¯·æ±‚
        [xmppRoster acceptPresenceSubscriptionRequestFrom:jid andAddToRoster:YES];

    }
</code></pre>

<h5>åˆ é™¤å¥½å‹</h5>

<pre><code>//åˆ é™¤å¥½å‹ï¼Œnameä¸ºå¥½å‹è´¦å·
- (void)removeBuddy:(NSString *)name  
{  
    XMPPJID *jid = [XMPPJID jidWithString:[NSString stringWithFormat:@"%@@%@",name,XMPPHOST]];  

    [self xmppRoster] removeUser:jid];  
}
</code></pre>

<h5>èŠå¤©å®¤</h5>

<p>åˆå§‹åŒ–èŠå¤©å®¤</p>

<pre><code>     XMPPJID *roomJID = [XMPPJID jidWithString:ROOM_JID];

    xmppRoom = [[XMPPRoom alloc] initWithRoomStorage:self jid:roomJID];

    [xmppRoom activate:xmppStream];
     [xmppRoom addDelegate:self delegateQueue:dispatch_get_main_queue()];
</code></pre>

<p>åˆ›å»ºèŠå¤©å®¤æˆåŠŸ</p>

<pre><code>`- (void)xmppRoomDidCreate:(XMPPRoom *)sender
{
    DDLogInfo(@"%@: %@", THIS_FILE, THIS_METHOD);
}`
</code></pre>

<p>åŠ å…¥èŠå¤©å®¤ï¼Œä½¿ç”¨æ˜µç§°</p>

<pre><code>[xmppRoom joinRoomUsingNickname:@"quack" history:nil];
</code></pre>

<p>è·å–èŠå¤©å®¤ä¿¡æ¯</p>

<pre><code>- (void)xmppRoomDidJoin:(XMPPRoom *)sender
    {
        [xmppRoom fetchConfigurationForm];
        [xmppRoom fetchBanList];
        [xmppRoom fetchMembersList];
        [xmppRoom fetchModeratorsList];
    }
</code></pre>

<p>å¦‚æœæˆ¿é—´å­˜åœ¨ï¼Œä¼šè°ƒç”¨å§”æ‰˜</p>

<pre><code>    // æ”¶åˆ°ç¦æ­¢åå•åˆ—è¡¨

    - (void)xmppRoom:(XMPPRoom *)sender didFetchBanList:(NSArray *)items;
    // æ”¶åˆ°å¥½å‹åå•åˆ—è¡¨

    - (void)xmppRoom:(XMPPRoom *)sender didFetchMembersList:(NSArray *)items;
    // æ”¶åˆ°ä¸»æŒäººåå•åˆ—è¡¨

    - (void)xmppRoom:(XMPPRoom *)sender didFetchModeratorsList:(NSArray *)items;
æˆ¿é—´ä¸å­˜åœ¨ï¼Œè°ƒç”¨å§”æ‰˜

    - (void)xmppRoom:(XMPPRoom *)sender didNotFetchBanList:(XMPPIQ *)iqError;
    - (void)xmppRoom:(XMPPRoom *)sender didNotFetchMembersList:(XMPPIQ *)iqError;
    - (void)xmppRoom:(XMPPRoom *)sender didNotFetchModeratorsList:(XMPPIQ *)iqError;
</code></pre>

<p>ç¦»å¼€æˆ¿é—´</p>

<pre><code>[xmppRoom deactivate:xmppStream];
</code></pre>

<p>XMPPRoomDelegateçš„å…¶ä»–ä»£ç†æ–¹æ³•:</p>

<p>ç¦»å¼€èŠå¤©å®¤</p>

<pre><code>    - (void)xmppRoomDidLeave:(XMPPRoom *)sender
    {
        DDLogVerbose(@"%@: %@", THIS_FILE, THIS_METHOD);
    }
</code></pre>

<p>æ–°äººåŠ å…¥ç¾¤èŠ</p>

<pre><code>    - (void)xmppRoom:(XMPPRoom *)sender occupantDidJoin:(XMPPJID *)occupantJID
     {
         DDLogVerbose(@"%@: %@", THIS_FILE, THIS_METHOD);
    }
</code></pre>

<p>æœ‰äººé€€å‡ºç¾¤èŠ</p>

<pre><code>    - (void)xmppRoom:(XMPPRoom *)sender occupantDidLeave:(XMPPJID *)occupantJID
    {
        DDLogVerbose(@"%@: %@", THIS_FILE, THIS_METHOD);
    }
</code></pre>

<p>æœ‰äººåœ¨ç¾¤é‡Œå‘è¨€</p>

<pre><code>    - (void)xmppRoom:(XMPPRoom *)sender didReceiveMessage:(XMPPMessage *)message fromOccupant:(XMPPJID *)occupantJID
     {
         DDLogVerbose(@"%@: %@", THIS_FILE, THIS_METHOD);
    }
</code></pre>

<h5>æ¶ˆæ¯å›æ‰§</h5>

<p>è¿™ä¸ªæ˜¯XEPï¼0184åè®®çš„å†…å®¹
å‘é€æ¶ˆæ¯æ—¶é™„åŠ å›æ‰§è¯·æ±‚
ä»£ç å®ç°</p>

<pre><code>NSString *siID = [XMPPStream generateUUID];
    //å‘é€æ¶ˆæ¯
    XMPPMessage *message = [XMPPMessage messageWithType:@"chat" to:jid elementID:siID];
    NSXMLElement *receipt = [NSXMLElement elementWithName:@"request" xmlns:@"urn:xmpp:receipts"];
    [message addChild:receipt];
    [message addBody:@"æµ‹è¯•"];
    [self.xmppStream sendElement:message];
</code></pre>

<p>æ”¶åˆ°å›æ‰§è¯·æ±‚çš„æ¶ˆæ¯ï¼Œå‘é€å›æ‰§</p>

<pre><code>- (void)xmppStream:(XMPPStream *)sender didReceiveMessage:(XMPPMessage *)message
    {
        //å›æ‰§åˆ¤æ–­
        NSXMLElement *request = [message elementForName:@"request"];
        if (request)
        {
            if ([request.xmlns isEqualToString:@"urn:xmpp:receipts"])//æ¶ˆæ¯å›æ‰§
            {
                //ç»„è£…æ¶ˆæ¯å›æ‰§
                XMPPMessage *msg = [XMPPMessage messageWithType:[message attributeStringValueForName:@"type"] to:message.from elementID:[message attributeStringValueForName:@"id"]];
                NSXMLElement *recieved = [NSXMLElement elementWithName:@"received" xmlns:@"urn:xmpp:receipts"];
                [msg addChild:recieved];

                //å‘é€å›æ‰§
                [self.xmppStream sendElement:msg];
            }
        }else
        {
            NSXMLElement *received = [message elementForName:@"received"];
            if (received)
            {
                if ([received.xmlns isEqualToString:@"urn:xmpp:receipts"])//æ¶ˆæ¯å›æ‰§
                {
                    //å‘é€æˆåŠŸ
                    NSLog(@"message send success!");
                }  
            }  
        }  

        //æ¶ˆæ¯å¤„ç†  
        //...  
    }
</code></pre>

<h5>æ·»åŠ AutoPing</h5>

<p>ä¸º äº†ç›‘å¬æœåŠ¡å™¨æ˜¯å¦æœ‰æ•ˆï¼Œå¢åŠ å¿ƒè·³ç›‘å¬ã€‚ç”¨XEP-0199åè®®ï¼Œåœ¨XMPPFrameWorkæ¡†æ¶ä¸‹ï¼Œå°è£…äº† XMPPAutoPing å’Œ XMPPPingä¸¤ä¸ªç±»éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºXMPPAutoPingå·²ç»ç»„åˆè¿›äº†XMPPPingç±»ï¼Œæ‰€ä»¥XMPPAutoPingä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚</p>

<pre><code>//åˆå§‹åŒ–å¹¶å¯åŠ¨ping
-(void)autoPingProxyServer:(NSString*)strProxyServer
{
    _xmppAutoPing = [[XMPPAutoPingalloc] init];
    [_xmppAutoPingactivate:_xmppStream];
    [_xmppAutoPingaddDelegate:selfdelegateQueue:  dispatch_get_main_queue()];
    _xmppAutoPing.respondsToQueries = YES;
    _xmppAutoPing.pingInterval=2;//ping é—´éš”æ—¶é—´
    if (nil != strProxyServer)
    {
       _xmppAutoPing.targetJID = [XMPPJID jidWithString: strProxyServer ];//è®¾ç½®pingç›®æ ‡æœåŠ¡å™¨ï¼Œå¦‚æœä¸ºnil,åˆ™ç›‘å¬socketstreamå½“å‰è¿æ¥ä¸Šçš„é‚£ä¸ªæœåŠ¡å™¨
    }
}
//å¸è½½ç›‘å¬
 [_xmppAutoPing   deactivate];
  [_xmppAutoPing   removeDelegate:self];
   _xmppAutoPing = nil;
//ping XMPPAutoPingDelegateçš„å§”æ‰˜æ–¹æ³•:
- (void)xmppAutoPingDidSendPing:(XMPPAutoPing *)sender
{
    NSLog(@"- (void)xmppAutoPingDidSendPing:(XMPPAutoPing *)sender");
}
- (void)xmppAutoPingDidReceivePong:(XMPPAutoPing *)sender
{
    NSLog(@"- (void)xmppAutoPingDidReceivePong:(XMPPAutoPing *)sender");
}

- (void)xmppAutoPingDidTimeout:(XMPPAutoPing *)sender
{
    NSLog(@"- (void)xmppAutoPingDidTimeout:(XMPPAutoPing *)sender");
}
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">iCocos</span></span>

      




<time class='entry-date' datetime='2014-09-12T00:21:39+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:21 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/summarize/'>summarize</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/09/02/an-quan-ji-zhi/" title="Previous Post: å®‰å…¨æœºåˆ¶">&laquo; å®‰å…¨æœºåˆ¶</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/09/25/yi-dong-duan-xing-neng-you-hua/" title="Next Post: ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–">ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ– &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/apples/'>apples (2)</a></li>
<li class='category'><a href='/blog/categories/audio-video/'>audio-video (1)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (16)</a></li>
<li class='category'><a href='/blog/categories/foundation/'>foundation (32)</a></li>
<li class='category'><a href='/blog/categories/full/'>full (13)</a></li>
<li class='category'><a href='/blog/categories/low-level/'>low-level (4)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (4)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (1)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (12)</a></li>
<li class='category'><a href='/blog/categories/reverse/'>reverse (25)</a></li>
<li class='category'><a href='/blog/categories/senior/'>senior (38)</a></li>
<li class='category'><a href='/blog/categories/stack/'>stack (13)</a></li>
<li class='category'><a href='/blog/categories/summarize/'>summarize (5)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/08/oneday/">ä¿®è¡Œç¯‡-æ¢ç¨‹åºä¹‹ç²¾å</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/01/gezhongdicenshixian/">iOSå¼€å‘å„ç§åº•å±‚å®ç°--åŒ…ä½ æ»¡æ„ğŸ˜˜ï¼</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/01/weixinhongbao/">ç¦åˆ©ï¼šæŠ¢çº¢åŒ…ç¥å™¨å°±æ˜¯è¿™ä¹ˆæ¥çš„</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/26/chongzhengzhidao/">é‡æ•´ä¹‹é“ï¼ˆé¢è¯•+æŠ€æœ¯+åº•å±‚+é«˜çº§ï¼‰</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/10/duoxianc/">å¤šçº¿ç¨‹ä¹‹è‘µèŠ±å®å…¸</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<h1>æ‰«ä¸€æ‰«<abbr title="The word 'æ‰«ä¸€æ‰«' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'æ‰«ä¸€æ‰«', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/blog/2014/09/12/xmppshi-yong-zong-jie/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/blog/2014/09/12/xmppshi-yong-zong-jie/" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - iCocos -
<span class="credit">welcome to <a href="http://al1020119.github.io">æ›¹#é»</a></span>
</p>

</footer>
  






<!--
-->



</body>
</html>
