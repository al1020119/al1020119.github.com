
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ç©è½¬è¿è¡Œæ—¶ - iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="iCocosåšå®¢">
  <meta name="keywords" content="iCocos, iOSå¼€å‘, åšå®¢, æŠ€æœ¯åˆ†æ, æ–‡ç« , å­¦ä¹ , æ›¹é», æ›¹ç†é¹">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/blog/2014/06/16/runtime/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>iCocosâ€”â€”ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">åšæ–‡</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/about">æ–‡ç« </a></li>
  <li><a href="/other">å…¶ä»–</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ç©è½¬è¿è¡Œæ—¶</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-16T13:53:19+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:53 pm</span></time>
        
        
        |   <a href="#comments">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰æœºåˆ¶</h2>

<p>æœ¬æ–‡å°†ä¼šä»¥ç¬”è€…ä¸ªäººçš„å°å°ç ”ç©¶ä¸ºä¾‹æ€»ç»“ä¸€ä¸‹å…³äºiOSå¼€å‘ä¸­è¿è¡Œæ—¶çš„ä½¿ç”¨å’Œå¸¸ç”¨æ–¹æ³•çš„ä»‹ç»ï¼Œå…³äºè·Ÿå¤šè¿è¡Œæ—¶ç›¸å…³æŠ€æœ¯è¯·æŸ¥çœ‹ç¬”è€…ä¹‹å‰å†™çš„è¿è¡Œæ—¶é«˜çº§ç”¨æ³•åŠç›¸å…³è¯­æ³•æˆ–è€…æŸ¥çœ‹å“åº”å®˜æ–¹æ–‡æ¡£ã€‚</p>

<p>ä¸‹é¢å°±æ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåœ¨iOSå¼€å‘ä¸­å»ä½¿ç”¨å®ƒã€‚</p>

<p>å®˜æ–¹ä»‹ç»ï¼š</p>

<!--more-->


<p><img src="/images/runtime001.png" title="Caption" ></p>

<p><img src="/images/runtime002.png" title="Caption" ></p>

<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯æœ€åä¸€ç§ï¼</p>

<p>ä¸‹é¢æ¥çœ‹çœ‹Runtimeçš„ç›¸å…³æ€»ç»“</p>

<p><img src="/images/runtime003.png" title="Caption" ></p>

<h2>æœ¯è¯­è§£é‡Š</h2>

<h3>Messages</h3>

<p>å¦‚æœä½ æ˜¯ä»åŠ¨æ€è¯­è¨€å¦‚Rubyæˆ–Pythonè½¬è¿‡æ¥çš„ï¼Œå¯èƒ½çŸ¥é“ä»€ä¹ˆæ˜¯æ¶ˆæ¯ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡è¿›å…¥ä¸‹ä¸€èŠ‚ã€‚é‚£äº›ä»å…¶ä»–è¯­è¨€è½¬è¿‡æ¥çš„ï¼Œç»§ç»­çœ‹ã€‚</p>

<p>æ‰§è¡Œä¸€ä¸ªæ–¹æ³•ï¼Œæœ‰äº›è¯­è¨€ï¼Œç¼–è¯‘å™¨ä¼šæ‰§è¡Œä¸€äº›é¢å¤–çš„ä¼˜åŒ–å’Œé”™è¯¯æ£€æŸ¥ï¼Œå› ä¸ºè°ƒç”¨å…³ç³»å¾ˆç›´æ¥ä¹Ÿå¾ˆæ˜æ˜¾ã€‚ä½†å¯¹äºæ¶ˆæ¯åˆ†å‘æ¥è¯´ï¼Œå°±ä¸é‚£ä¹ˆæ˜æ˜¾äº†ã€‚åœ¨å‘æ¶ˆæ¯å‰ä¸å¿…çŸ¥é“æŸä¸ªå¯¹è±¡æ˜¯å¦èƒ½å¤Ÿå¤„ç†æ¶ˆæ¯ã€‚ä½ æŠŠæ¶ˆæ¯å‘ç»™å®ƒï¼Œå®ƒå¯èƒ½ä¼šå¤„ç†ï¼Œä¹Ÿå¯èƒ½è½¬ç»™å…¶ä»–çš„Objectæ¥å¤„ç†ã€‚ä¸€ä¸ªæ¶ˆæ¯ä¸å¿…å¯¹åº”ä¸€ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå¯¹è±¡å¯èƒ½å®ç°ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†å¤šæ¡æ¶ˆæ¯ã€‚</p>

<p>åœ¨Objective-Cä¸­ï¼Œæ¶ˆæ¯æ˜¯é€šè¿‡objc_msgSend()è¿™ä¸ªruntimeæ–¹æ³•åŠç›¸è¿‘çš„æ–¹æ³•æ¥å®ç°çš„ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ªtargetï¼Œselectorï¼Œè¿˜æœ‰ä¸€äº›å‚æ•°ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œç¼–è¯‘å™¨åªæ˜¯æŠŠæ¶ˆæ¯åˆ†å‘å˜æˆobjc_msgSendæ¥æ‰§è¡Œã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸¤è¡Œä»£ç æ˜¯ç­‰ä»·çš„ã€‚</p>

<pre><code>[array insertObject:foo atIndex:5];
objc_msgSend(array, @selector(insertObject:atIndex:), foo, 5);
</code></pre>

<hr />

<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†objects,classes,selectors,IMPsä»¥åŠæ¶ˆæ¯åˆ†å‘ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶åˆ°åº•èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>

<ul>
<li>åˆ›å»ºã€ä¿®æ”¹ã€è‡ªçœclasseså’Œobjects</li>
<li>æ¶ˆæ¯åˆ†å‘</li>
</ul>


<p>ä¹‹å‰å·²ç»æè¿‡æ¶ˆæ¯åˆ†å‘ï¼Œä¸è¿‡è¿™åªæ˜¯ä¸€å°éƒ¨åˆ†åŠŸèƒ½ã€‚æ‰€æœ‰çš„è¿è¡Œæ—¶æ–¹æ³•éƒ½æœ‰ç‰¹å®šçš„å‰ç¼€ã€‚ä¸‹é¢æ˜¯ä¸€äº›æœ‰æ„æ€çš„æ–¹æ³•ï¼š</p>

<h3>class</h3>

<p>classå¼€å¤´çš„æ–¹æ³•æ˜¯ç”¨æ¥ä¿®æ”¹å’Œè‡ªçœclassesã€‚</p>

<ul>
<li>class_addIvar, class_addMethod, *class_addPropertyå’Œclass_addProtocolå…è®¸é‡å»ºclassesã€‚</li>
<li>class_copyIvarList, class_copyMethodList, class_copyProtocolListå’Œclass_copyPropertyListèƒ½æ‹¿åˆ°ä¸€ä¸ªclassçš„æ‰€æœ‰å†…å®¹ã€‚</li>
<li>class_getClassMethod, class_getClassVariable, class_getInstanceMethod, class_getInstanceVariable, class_getMethodImplementationå’Œclass_getPropertyè¿”å›å•ä¸ªå†…å®¹ã€‚</li>
</ul>


<p>ä¹Ÿæœ‰ä¸€äº›é€šç”¨çš„è‡ªçœæ–¹æ³•ï¼Œå¦‚class_conformsToProtocol, class_respondsToSelector, class_getSuperclassã€‚æœ€åï¼Œä½ å¯ä»¥ä½¿ç”¨class_createInstanceæ¥åˆ›å»ºä¸€ä¸ªobjectã€‚</p>

<h3>ivar</h3>

<p>è¿™äº›æ–¹æ³•èƒ½è®©ä½ å¾—åˆ°åå­—ï¼Œå†…å­˜åœ°å€å’ŒObjective-C type encodingã€‚</p>

<h3>method</h3>

<p>è¿™äº›æ–¹æ³•ä¸»è¦ç”¨æ¥è‡ªçœï¼Œæ¯”å¦‚method_getName, method_getImplementation,  method_getReturnTypeç­‰ç­‰ã€‚ä¹Ÿæœ‰ä¸€äº›ä¿®æ”¹çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬method_setImplementationå’Œmethod_exchangeImplementationsï¼Œè¿™äº›æˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚</p>

<h3>objc</h3>

<p>ä¸€æ—¦æ‹¿åˆ°äº†objectï¼Œä½ å°±å¯ä»¥å¯¹å®ƒåšä¸€äº›è‡ªçœå’Œä¿®æ”¹ã€‚ä½ å¯ä»¥get/set ivar, ä½¿ç”¨object_copyå’Œobject_disposeæ¥copyå’Œfree objectçš„å†…å­˜ã€‚æœ€NBçš„ä¸ä»…æ˜¯æ‹¿åˆ°ä¸€ä¸ªclassï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨object_setClassæ¥æ”¹å˜ä¸€ä¸ªobjectçš„classã€‚å¾…ä¼šå°±èƒ½çœ‹åˆ°ä½¿ç”¨åœºæ™¯ã€‚</p>

<h3>property</h3>

<p>å±æ€§ä¿å­˜äº†å¾ˆå¤§ä¸€éƒ¨åˆ†ä¿¡æ¯ã€‚é™¤äº†æ‹¿åˆ°åå­—ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨property_getAttributesæ¥å‘ç°propertyçš„æ›´å¤šä¿¡æ¯ï¼Œå¦‚è¿”å›å€¼ã€æ˜¯å¦ä¸ºatomicã€getter/setteråå­—ã€æ˜¯å¦ä¸ºdynamicã€èƒŒåä½¿ç”¨çš„ivaråå­—ã€æ˜¯å¦ä¸ºå¼±å¼•ç”¨ã€‚</p>

<h3>protocol</h3>

<p>Protocolsæœ‰ç‚¹åƒclassesï¼Œä½†æ˜¯ç²¾ç®€ç‰ˆçš„ï¼Œè¿è¡Œæ—¶çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚ä½ å¯ä»¥è·å–method, property, protocolåˆ—è¡¨, æ£€æŸ¥æ˜¯å¦å®ç°äº†å…¶ä»–çš„protocolã€‚</p>

<h3>Cache</h3>

<p>åœ¨runtime.hä¸­Cacheçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>

<pre><code>   typedef struct objc_cache *Cache 
</code></pre>

<p> Cacheä¸ºæ–¹æ³•è°ƒç”¨çš„æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œé€šä¿—åœ°è®²ï¼Œæ¯å½“å®ä¾‹å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå®ƒä¸ä¼šç›´æ¥åœ¨isaæŒ‡å‘çš„ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­éå†æŸ¥æ‰¾èƒ½å¤Ÿå“åº”æ¶ˆæ¯çš„æ–¹æ³•ï¼Œå› ä¸ºè¿™æ ·æ•ˆç‡å¤ªä½äº†ï¼Œè€Œæ˜¯ä¼˜å…ˆåœ¨Cacheä¸­æŸ¥æ‰¾ã€‚Runtime ç³»ç»Ÿä¼šæŠŠè¢«è°ƒç”¨çš„æ–¹æ³•å­˜åˆ°Cacheä¸­ï¼ˆç†è®ºä¸Šè®²ä¸€ä¸ªæ–¹æ³•å¦‚æœè¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå®ƒæœ‰å¯èƒ½ä»Šåè¿˜ä¼šè¢«è°ƒç”¨ï¼‰ï¼Œä¸‹æ¬¡æŸ¥æ‰¾çš„æ—¶å€™æ•ˆç‡æ›´é«˜ã€‚è¿™æ ¹è®¡ç®—æœºç»„æˆåŸç†ä¸­å­¦è¿‡çš„ CPU ç»•è¿‡ä¸»å­˜å…ˆè®¿é—®Cacheçš„é“ç†æŒºåƒï¼Œè€Œæˆ‘çŒœè‹¹æœä¸ºæé«˜Cacheå‘½ä¸­ç‡åº”è¯¥ä¹Ÿåšäº†åŠªåŠ›å§ã€‚</p>

<h2>sel</h2>

<p>æœ€åæˆ‘ä»¬æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å¤„ç† selectorsï¼Œæ¯”å¦‚è·å–åå­—ï¼Œæ³¨å†Œä¸€ä¸ªselectorç­‰ç­‰ã€‚</p>

<h3>Methods, Selectors and IMPs</h3>

<p>æˆ‘ä»¬çŸ¥é“äº†è¿è¡Œæ—¶ä¼šå‘æ¶ˆæ¯ç»™å¯¹è±¡ã€‚æˆ‘ä»¬ä¹ŸçŸ¥é“ä¸€ä¸ªå¯¹è±¡çš„classä¿å­˜äº†æ–¹æ³•åˆ—è¡¨ã€‚é‚£ä¹ˆè¿™äº›æ¶ˆæ¯æ˜¯å¦‚ä½•æ˜ å°„åˆ°æ–¹æ³•çš„ï¼Œè¿™äº›æ–¹æ³•åˆæ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„å‘¢ï¼Ÿ</p>

<p>ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¾ˆç®€å•ã€‚classçš„æ–¹æ³•åˆ—è¡¨å…¶å®æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œkeyä¸ºselectorsï¼ŒIMPsä¸ºvalueã€‚ä¸€ä¸ªIMPæ˜¯æŒ‡å‘æ–¹æ³•åœ¨å†…å­˜ä¸­çš„å®ç°ã€‚å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œselectorå’ŒIMPä¹‹é—´çš„å…³ç³»æ˜¯åœ¨è¿è¡Œæ—¶æ‰å†³å®šçš„ï¼Œè€Œä¸æ˜¯ç¼–è¯‘æ—¶ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½ç©å‡ºäº›èŠ±æ ·ã€‚</p>

<p>IMPé€šå¸¸æ˜¯æŒ‡å‘æ–¹æ³•çš„æŒ‡é’ˆï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selfï¼Œç±»å‹ä¸ºidï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<em>cmdï¼Œç±»å‹ä¸ºSELï¼Œä½™ä¸‹çš„æ˜¯æ–¹æ³•çš„å‚æ•°ã€‚è¿™ä¹Ÿæ˜¯selfå’Œ</em>cmdè¢«å®šä¹‰çš„åœ°æ–¹ã€‚ä¸‹é¢æ¼”ç¤ºäº†Methodå’ŒIMP</p>

<blockquote><p>Objective-Cæ˜¯ä¸€é—¨ç®€å•çš„è¯­è¨€ï¼Œ95%æ˜¯Cã€‚åªæ˜¯åœ¨è¯­è¨€å±‚é¢ä¸ŠåŠ äº†äº›å…³é”®å­—å’Œè¯­æ³•ã€‚çœŸæ­£è®©Objective-Cå¦‚æ­¤å¼ºå¤§çš„æ˜¯å®ƒçš„è¿è¡Œæ—¶ã€‚å®ƒå¾ˆå°ä½†å´å¾ˆå¼ºå¤§ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯æ¶ˆæ¯åˆ†å‘ã€‚</p></blockquote>

<h3>Objects, Classes, MetaClasses</h3>

<p>å¤§å¤šæ•°é¢å‘å¯¹è±¡çš„è¯­è¨€é‡Œæœ‰ classes å’Œ objects çš„æ¦‚å¿µã€‚Objectsé€šè¿‡Classesç”Ÿæˆã€‚ä½†æ˜¯åœ¨Objective-Cä¸­ï¼Œclassesæœ¬èº«ä¹Ÿæ˜¯objects(è¯‘è€…æ³¨ï¼šè¿™ç‚¹è·Ÿpythonå¾ˆåƒ)ï¼Œä¹Ÿå¯ä»¥å¤„ç†æ¶ˆæ¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼ŒObjective-Cä¸­çš„Objectæ˜¯ä¸€ä¸ªç»“æ„ä½“(struct)ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯isaï¼ŒæŒ‡å‘è‡ªå·±çš„classã€‚è¿™æ˜¯åœ¨objc/objc.hä¸­å®šä¹‰çš„ã€‚</p>

<pre><code>typedef s   truct objc_object {
    Class isa;
} *id;
</code></pre>

<p>objectçš„classä¿å­˜äº†æ–¹æ³•åˆ—è¡¨ï¼Œè¿˜æœ‰æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆã€‚ä½†classesä¹Ÿæ˜¯objectsï¼Œä¹Ÿä¼šæœ‰isaå˜é‡ï¼Œé‚£ä¹ˆå®ƒåˆæŒ‡å‘å“ªå„¿å‘¢ï¼Ÿè¿™é‡Œå°±å¼•å‡ºäº†ç¬¬ä¸‰ä¸ªç±»å‹: metaclassesã€‚ä¸€ä¸ª metaclassè¢«æŒ‡å‘classï¼Œclassè¢«æŒ‡å‘objectã€‚å®ƒä¿å­˜äº†æ‰€æœ‰å®ç°çš„æ–¹æ³•åˆ—è¡¨ï¼Œä»¥åŠçˆ¶ç±»çš„metaclassã€‚å¦‚æœæƒ³æ›´æ¸…æ¥šåœ°äº†è§£objects,classesä»¥åŠmetaclassesæ˜¯å¦‚ä½•ä¸€èµ·å·¥ä½œåœ°ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚</p>

<h2>ä½¿ç”¨æ–¹å¼ï¼š</h2>

<h3>pragma mark è·å–å±æ€§æˆå‘˜</h3>

<pre><code>/******************************************************************************

 *                                                                            *

 *                              Inquiry macros                                *

 *                                                                            *

 *                            iCocos--Description                             *

 *                                                                            *

 ******************************************************************************/

unsigned int count = 0;

Ivar *ivars = class_copyIvarList([iCocosObject class], &amp;count);

//    Ivar *ivars = class_copyMethodList(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#unsigned int *outCount#&gt;)

//    Ivar *ivars = class_copyPropertyList(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#unsigned int *outCount#&gt;);

//    Ivar *ivars = class_copyProtocolList(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#unsigned int *outCount#&gt;)



for (int i = 0; i &lt; count; i++) {

    Ivar ivar = ivars[i];



    NSString *name = @(ivar_getName(ivar));

    NSLog(@"%@", name);



    NSLog(@"*****************");

    const char *iv = ivar_getName(ivar);





    NSLog(@"%s", iv);



    NSLog(@"*****************");

    const char *ivs =  ivar_getTypeEncoding(ivar);



    NSLog(@"%s", ivs);

}
</code></pre>

<h3>pragma mark è·å–æ–¹æ³•</h3>

<pre><code>/******************************************************************************

 *                                                                            *

 *                              Inquiry macros                                *

 *                                                                            *

 *                            iCocos--Description                             *

 *                                                                            *

 ******************************************************************************/

 unsigned int meth = 0;

Method *met = class_copyMethodList([iCocosObject class], &amp;meth);

for (int i = 0; i &lt; meth; i++) {

    Method m = met[i];



    SEL sel = method_getName(m);

    NSString *str = NSStringFromSelector(sel);



    NSLog(@"%@",str);

}
</code></pre>

<h3>pragma mark è·å–åè®®</h3>

<pre><code>/******************************************************************************

 *                                                                            *

 *                              Inquiry macros                                *

 *                                                                            *

 *                            iCocos--Description                             *

 *                                                                            *

 ******************************************************************************/

 unsigned int pro = 0;

Protocol * __unsafe_unretained *proto =  class_copyProtocolList([iCocosObject class], &amp;pro);

for (int i = 0; i &lt; pro; i++) {

    Method p = (__bridge Method)(proto[i]);



    const char *pr = protocol_getName((__bridge Protocol *)(p));

//        NSString *str = NSStringFromSelector(pr);



    NSLog(@"%s",pr);

}
</code></pre>

<h3>pragma mark è·å–å±æ€§</h3>

<pre><code>/******************************************************************************

 *                                                                            *

 *                              Inquiry macros                                *

 *                                                                            *

 *                            iCocos--Description                             *

 *                                                                            *

 ******************************************************************************/

 unsigned int xs = 0;

objc_property_t *xsL = class_copyPropertyList([iCocosObject class], &amp;xs);

for (int i = 0; i &lt; xs; i++) {

    objc_property_t xslist = xsL[i];



    const char *x = property_getName(xslist);

//        NSString *str = NSStringFromSelector(x);



    NSLog(@"%s",x);

}





//    objc_msgSend()

//    objc_getClass(&lt;#const char *name#&gt;);

//    sel_registerName(&lt;#const char *str#&gt;);



//     iCocosView *view = objc_msgSend(objc_msgSend(objc_getClass("iCocosView"), sel_registerName("alloc")), sel_registerName("init"));

Method one =  class_getClassMethod([iCocosObject class], @selector(iCocosMethos));

Method two =  class_getClassMethod([iCocosObject class], @selector(iCocosMetho));

method_exchangeImplementations(one, two);



Method o =  class_getInstanceMethod([iCocosObject class], @selector(iCocosMethos));

Method t =  class_getInstanceMethod([iCocosObject class], @selector(iCocosMetho));

method_exchangeImplementations(o, t);



//    class_getInstanceSize(&lt;#__unsafe_unretained Class cls#&gt;);

//    class_getInstanceVariable(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#const char *name#&gt;);

//    class_getMethodImplementation_stret(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#SEL name#&gt;);



//    class_getClassVariable(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#const char *name#&gt;);

//    class_getSuperclass(&lt;#__unsafe_unretained Class cls#&gt;);



//    class_getProperty(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#const char *name#&gt;);

//    class_getName(&lt;#__unsafe_unretained Class cls#&gt;);







//    class_replaceMethod(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#SEL name#&gt;, &lt;#IMP imp#&gt;, &lt;#const char *types#&gt;);
</code></pre>

<h3>pragma mark å¢åŠ </h3>

<pre><code>/******************************************************************************

 *                                                                            *

 *                              Inquiry macros                                *

 *                                                                            *

 *                            iCocos--Description                             *

 *                                                                            *

 ******************************************************************************/
 //    class_addIvar(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#const char *name#&gt;, &lt;#size_t size#&gt;, &lt;#uint8_t alignment#&gt;, &lt;#const char *types#&gt;);

//    class_addMethod(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#SEL name#&gt;, &lt;#IMP imp#&gt;, &lt;#const char *types#&gt;);

//    class_addProperty(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#const char *name#&gt;, &lt;#const objc_property_attribute_t *attributes#&gt;, &lt;#unsigned int attributeCount#&gt;);

//    class_addProtocol(&lt;#__unsafe_unretained Class cls#&gt;, &lt;#Protocol *protocol#&gt;);
</code></pre>

<h3>pragma mark æ›¿æ¢ç³»ç»Ÿçš„addObjectï¼šï¼ˆç»™æ•°ç»„æˆ–è€…å…¶ä»–ç±»å‹åšåˆ†ç±»ï¼‰</h3>

<pre><code>/******************************************************************************

 *                                                                            *

 *                              Inquiry macros                                *

 *                                                                            *

 *                            iCocos--Description                             *

 *                                                                            *

 ******************************************************************************/
 //åœ¨loadä¸­å®ç°ä¸‹é¢çš„ä»£ç 

Method ic =  class_getInstanceMethod(NSClassFromString(@"_NSArrayM"), @selector(iCocosobject:));

Method add =  class_getInstanceMethod(NSClassFromString(@"_NSArrayM"), @selector(addObject:));

method_exchangeImplementations(ic, add);





//å®ç°iCocosobjectæ–¹æ³•:(å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œè¿™é‡Œåªæ˜¯å»æ‰éç©º)

//    if (object != nil) {

//        [self iCocosobject:object];

//    }
</code></pre>

<h2>å®æˆ˜</h2>

<h3>ä¸€ï¼šå…³è”å¯¹è±¡ï¼šç»™æŸä¸€ä¸ªç±»åœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€çš„å¢åŠ ä¸€ä¸ªæˆå‘˜å˜é‡</h3>

<pre><code>@interface NSObject(iCocos)



//å¤´æ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªå±æ€§

@property (nonatomic, assign) double height;



@end





@implementation NSObject(iCocos)



static double heightKey;//ç”¨æ¥å‚è€ƒ



-(void)setHeight:(double)height

{

    objc_setAssociatedObject(self, &amp;heightKey, @(height), OBJC_ASSOCIATION_ASSIGN);

}



-(double)height

{

    return [objc_getAssociatedObject(self, &amp;heightKey) doubleValue];

}
</code></pre>

<p>@end</p>

<h3>äºŒï¼šå½’æ¡£</h3>

<p><img src="/images/runtimedemo001.png" title="Caption" ></p>

<h3>ä¸‰ï¼šå­—å…¸è½¬æ¨¡å‹ï¼š</h3>

<p>ä¹‹å‰ä½¿ç”¨çš„æ–¹æ³•ï¼›</p>

<p><img src="/images/runtimedemo002.png" title="Caption" ></p>

<p>ä½¿ç”¨è¿è¡Œæ—¶</p>

<p>æ³¨æ„å¿…é¡»ä¿è¯å­—å…¸ä¸­çš„å±æ€§åå’Œæ¨¡å‹ä¸­çš„å±æ€§åä¸€æ¨¡ä¸€æ ·</p>

<p><img src="/images/runtimedemo003.png" title="Caption" ></p>

<p>å®Œå–„ä»£ç ï¼š</p>

<pre><code> @implementation NSObject (Model)



+ (instancetype)objcWithDict:(NSDictionary *)dict mapDict:(NSDictionary *)mapDict

{





    id objc = [[self alloc] init];



    unsigned int count = 0;

    Ivar *ivars = class_copyIvarList(self, &amp;count);



    for (int i = 0; i &lt; count; i++) {

        Ivar ivar = ivars[i];



        NSString *name = @(ivar_getName(ivar));



        name = [name substringFromIndex:1];



        id value = dict[name];



        if (value == nil) {



            if (mapDict) {

                NSString *mapName = mapDict[name];



                value = dict[mapName];

            }



        }



        [objc setValue:value forKeyPath:name];

    }





    return objc;

}



@end
</code></pre>

<h3>å…¨å±è¿”å›</h3>

<pre><code>- (void)viewDidLoad {

    [super viewDidLoad];
    // è·å–ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetå¯¹è±¡
    id target = self.interactivePopGestureRecognizer.delegate;
    // åˆ›å»ºå…¨å±æ»‘åŠ¨æ‰‹åŠ¿ï¼Œè°ƒç”¨ç³»ç»Ÿè‡ªå¸¦æ»‘åŠ¨æ‰‹åŠ¿çš„targetçš„actionæ–¹æ³•
    UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] initWithTarget:target action:@selector(handleNavigationTransition:)];
    // è®¾ç½®æ‰‹åŠ¿ä»£ç†ï¼Œæ‹¦æˆªæ‰‹åŠ¿è§¦å‘
    pan.delegate = self;
    // ç»™å¯¼èˆªæ§åˆ¶å™¨çš„viewæ·»åŠ å…¨å±æ»‘åŠ¨æ‰‹åŠ¿
    [self.view addGestureRecognizer:pan];
    // ç¦æ­¢ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿
    self.interactivePopGestureRecognizer.enabled = NO;
    }
    // ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼šæ¯æ¬¡è§¦å‘æ‰‹åŠ¿ä¹‹å‰éƒ½ä¼šè¯¢é—®ä¸‹ä»£ç†ï¼Œæ˜¯å¦è§¦å‘ã€‚
    // ä½œç”¨ï¼šæ‹¦æˆªæ‰‹åŠ¿è§¦å‘
    - (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer
    {
        // æ³¨æ„ï¼šåªæœ‰éæ ¹æ§åˆ¶å™¨æ‰æœ‰æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œæ ¹æ§åˆ¶å™¨æ²¡æœ‰ã€‚
        // åˆ¤æ–­å¯¼èˆªæ§åˆ¶å™¨æ˜¯å¦åªæœ‰ä¸€ä¸ªå­æ§åˆ¶å™¨ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå­æ§åˆ¶å™¨ï¼Œè‚¯å®šæ˜¯æ ¹æ§åˆ¶å™¨
        if (self.childViewControllers.count == 1) {
        // è¡¨ç¤ºç”¨æˆ·åœ¨æ ¹æ§åˆ¶å™¨ç•Œé¢ï¼Œå°±ä¸éœ€è¦è§¦å‘æ»‘åŠ¨æ‰‹åŠ¿ï¼Œ
        return NO;
    }
    return YES;
}
</code></pre>

<hr />

<p>å‚è€ƒæ–‡ç« ï¼š</p>

<p><a href="http://www.cnblogs.com/iCocos/p/4782532.html">http://www.cnblogs.com/iCocos/p/4782532.html</a></p>

<p><a href="http://www.cnblogs.com/iCocos/p/4676679.html">http://www.cnblogs.com/iCocos/p/4676679.html</a></p>

<p><a href="http://www.cnblogs.com/iCocos/p/4734687.html">http://www.cnblogs.com/iCocos/p/4734687.html</a></p>

<p><a href="http://www.cnblogs.com/iCocos/p/4761600.html">http://www.cnblogs.com/iCocos/p/4761600.html</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">iCocos</span></span>

      




<time class='entry-date' datetime='2014-06-16T13:53:19+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:53 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/low-level/'>low-level</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/06/03/data%20cache/" title="Previous Post: ç©è½¬æ•°æ®æŒä¹…åŒ–">&laquo; ç©è½¬æ•°æ®æŒä¹…åŒ–</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/06/25/data%20model/" title="Next Post: æ•°æ®ä¸æ¨¡å‹">æ•°æ®ä¸æ¨¡å‹ &raquo;</a>
      
    </p>
  </footer>
</article>



  <section>
    <h1>Comments</h1>
    <div id="comments" aria-live="polite"><!-- Duoshuo Comment BEGIN -->
<div class="ds-thread" data-title="ç©è½¬è¿è¡Œæ—¶"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"icocoscao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END --></div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/algorithms/'>algorithms (6)</a></li>
<li class='category'><a href='/blog/categories/and/'>and (14)</a></li>
<li class='category'><a href='/blog/categories/apples/'>apples (2)</a></li>
<li class='category'><a href='/blog/categories/application/'>application (1)</a></li>
<li class='category'><a href='/blog/categories/architecture/'>architecture (2)</a></li>
<li class='category'><a href='/blog/categories/audio/'>audio (8)</a></li>
<li class='category'><a href='/blog/categories/audio-video/'>audio-video (1)</a></li>
<li class='category'><a href='/blog/categories/data/'>data (6)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (16)</a></li>
<li class='category'><a href='/blog/categories/foundation/'>foundation (31)</a></li>
<li class='category'><a href='/blog/categories/full/'>full (13)</a></li>
<li class='category'><a href='/blog/categories/low-level/'>low-level (4)</a></li>
<li class='category'><a href='/blog/categories/lve/'>lve (8)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (4)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (1)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (12)</a></li>
<li class='category'><a href='/blog/categories/practical/'>practical (1)</a></li>
<li class='category'><a href='/blog/categories/radio/'>radio (8)</a></li>
<li class='category'><a href='/blog/categories/reverse/'>reverse (25)</a></li>
<li class='category'><a href='/blog/categories/senior/'>senior (40)</a></li>
<li class='category'><a href='/blog/categories/stack/'>stack (13)</a></li>
<li class='category'><a href='/blog/categories/structures/'>structures (6)</a></li>
<li class='category'><a href='/blog/categories/summarize/'>summarize (5)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>
<li class='category'><a href='/blog/categories/video/'>video (8)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/09/25/zhi-bo-cai-ji-pian/">ç›´æ’­-é‡‡é›†ç¯‡</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/20/zhi-bo-shi-zhan-pian/">ç›´æ’­-å®æˆ˜ç¯‡</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/15/zhi-bo-yuan-li-pian/">ç›´æ’­-åŸç†ç¯‡</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/10/zhi-bo-ijkplayer/">ç›´æ’­-iJKPlayer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/08/yuan-li-zong-jie-h264-acc-flv/">åŸç†-H264-ACC-FLVğŸ˜‚æ€»ç»“</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<h1>æ‰«ä¸€æ‰«<abbr title="The word 'æ‰«ä¸€æ‰«' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'æ‰«ä¸€æ‰«', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/blog/2014/06/16/runtime/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/blog/2014/06/16/runtime/" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - iCocos -
<span class="credit">welcome to <a href="http://al1020119.github.io">æ›¹#é»</a></span>
</p>

</footer>
  






<!--
-->



</body>
</html>
