
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>æ€ä¹ˆå°è£…ä¸€ä¸ªæ§ä»¶ - iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="iCocosåšå®¢">
  <meta name="keywords" content="iCocos, iOSå¼€å‘, åšå®¢, æŠ€æœ¯åˆ†æ, æ–‡ç« , å­¦ä¹ , æ›¹é», æ›¹ç†é¹">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/blog/2014/11/05/zen-yao-feng-zhuang-%5B%3F%5D-ge-kong-jian/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>iCocosâ€”â€”ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">åšæ–‡</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/about">æ–‡ç« </a></li>
  <li><a href="/other">å…¶ä»–</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">æ€ä¹ˆå°è£…ä¸€ä¸ªæ§ä»¶</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-05T17:44:16+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:44 pm</span></time>
        
        
        |   <a href="#comments">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>ä¸€ä¸ªæ§ä»¶ä»å¤–åœ¨ç‰¹å¾æ¥è¯´ï¼Œä¸»è¦æ˜¯å°è£…è¿™å‡ ç‚¹ï¼š</p>

<ul>
<li>äº¤äº’æ–¹å¼</li>
<li>æ˜¾ç¤ºæ ·å¼</li>
<li>æ•°æ®ä½¿ç”¨</li>
</ul>


<p>å¯¹å¤–åœ¨ç‰¹å¾çš„å°è£…ï¼Œèƒ½è®©æˆ‘ä»¬åœ¨å¤šç§ç¯å¢ƒä¸‹è¾¾åˆ° PM å¯¹äº§å“çš„è¦æ±‚ï¼Œå¹¶ä¸”æåˆ°ä»£ç å¤ç”¨ç‡ï¼Œä½¿ç»´æŠ¤å·¥ä½œä¿æŒåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„èŒƒå›´å†…ï¼›è€Œä¸€ä¸ªå¥½çš„æ§ä»¶é™¤äº†æœ‰å¯¹å¤–ä¸€è‡´çš„ä½“éªŒä¹‹å¤–ï¼Œè¿˜æœ‰å…¶å†…åœ¨ç‰¹å¾ï¼š</p>

<ul>
<li>çµæ´»æ€§</li>
<li>ä½è€¦åˆ</li>
<li>æ˜“æ‹“å±•</li>
<li>æ˜“ç»´æŠ¤</li>
</ul>


<!--more-->


<p>é€šå¸¸ç‰¹å¾ä¹‹é—´éœ€è¦åšä¸€äº›å–èˆï¼Œæ¯”å¦‚çµæ´»æ€§ä¸è€¦åˆåº¦ï¼Œæœ‰æ—¶å€™æ¥å£è¶Šå¤šè¶Šèƒ½é€‚åº”å„ç§ç¯å¢ƒï¼Œä½†æ˜¯æ¥å£è¶Šå°‘å¯¹å¤–äº§ç”Ÿçš„ä¾èµ–å°±è¶Šå°‘ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿæ›´å®¹æ˜“ã€‚é€šå¸¸ä¸€äº›å‰æœŸçœ‹èµ·æ¥è¿˜ä¸é”™çš„ä»£ç ï¼Œå¾€å¾€ä¹Ÿä¼šéšç€æ—¶é—´åŠ æ·±æ…¢æ…¢â€œæˆé•¿â€ï¼ŒåŠŸèƒ½çš„å¢åŠ ä¹Ÿä¼šå¸¦æ¥æ–°çš„æ¥å£ï¼Œå¾ˆä¸è‡ªè§‰åœ°å°±åŠ æ·±äº†è€¦åˆåº¦ï¼Œåœ¨å¼€å‘ä¸­æ—¶ä¸æ—¶åœ°è¿›è¡Œä¸€äº›é‡æ„å·¥ä½œå¾ˆæœ‰å¿…è¦ã€‚æ€»ä¹‹ï¼Œå°½é‡å‡å°‘æ¥å£çš„æ•°é‡ï¼Œä½†æœ‰è¶³å¤Ÿçš„å®šåˆ¶ç©ºé—´ï¼Œå¯ä»¥åœ¨ä¸€å¼€å§‹æŠŠæ¥å£å…¨éƒ¨éšè—èµ·æ¥ï¼Œå†æ ¹æ®å®é™…éœ€è¦æ…¢æ…¢æ”¾å¼€ã€‚</p>

<p>è‡ªå®šä¹‰æ§ä»¶åœ¨ iOS é¡¹ç›®é‡Œå¾ˆå¸¸è§ï¼Œé€šå¸¸é¡µé¢ä¹‹é—´å…¥å£å¾ˆå¤šï¼Œè€Œä¸”ä½¿ç”¨åœºæ™¯ææœ‰å¯èƒ½å¤§ä¸ç›¸åŒï¼Œæ¯”å¦‚ä¸€ä¸ª UIView æ—¢å¯ä»¥ä»¥ä»£ç åˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥ä»¥ xib çš„å½¢å¼åˆå§‹åŒ–ï¼Œè€Œæˆ‘ä»¬æ˜¯éœ€è¦ä¿è¯è¿™ä¸¤ç§æ“ä½œéƒ½èƒ½äº§ç”ŸåŒæ ·çš„è¡Œä¸ºã€‚æœ¬æ–‡å°†ä¼šè®¨è®ºåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š</p>

<ul>
<li>é€‰æ‹©æ­£ç¡®çš„åˆå§‹åŒ–æ–¹å¼</li>
<li>è°ƒæ•´å¸ƒå±€çš„æ—¶æœº</li>
<li>æ­£ç¡®çš„å¤„ç† touches æ–¹æ³•</li>
<li>drawRectCALayer ä¸åŠ¨ç”»</li>
<li>UIControl ä¸ UIButton</li>
<li>æ›´å‹å¥½çš„æ”¯æŒ xib</li>
<li>ä¸è§„åˆ™å›¾å½¢å’Œäº‹ä»¶è§¦å‘èŒƒå›´ï¼ˆäº‹ä»¶é“¾çš„ç®€å•ä»‹ç»ä»¥åŠå¤„ç†ï¼‰</li>
<li>åˆç†ä½¿ç”¨ KVO</li>
</ul>


<p>å¦‚æœè¿™äº›é—®é¢˜ä½ ä¸€çœ‹å°±æ‡‚çš„è¯å°±ä¸ç”¨ç»§ç»­å¾€ä¸‹çœ‹äº†ã€‚</p>

<p>è®¾è®¡æ–¹é’ˆ</p>

<p>é€‰æ‹©æ­£ç¡®çš„åˆå§‹åŒ–æ–¹å¼</p>

<p>UIView çš„é¦–è¦é—®é¢˜å°±æ˜¯æ—¢èƒ½ä»ä»£ç ä¸­åˆå§‹åŒ–ï¼Œä¹Ÿèƒ½ä» xib ä¸­åˆå§‹åŒ–ï¼Œä¸¤è€…æœ‰ä½•ä¸åŒ? UIView æ˜¯æ”¯æŒ NSCoding åè®®çš„ï¼Œå½“åœ¨ xib æˆ– storyboard é‡Œå­˜åœ¨ä¸€ä¸ª UIView çš„æ—¶å€™ï¼Œå…¶å®æ˜¯å°† UIView åºåˆ—åŒ–åˆ°æ–‡ä»¶é‡Œï¼ˆxib å’Œ storyboard éƒ½æ˜¯ä»¥ XML æ ¼å¼æ¥ä¿å­˜çš„ï¼‰ï¼ŒåŠ è½½çš„æ—¶å€™ååºåˆ—åŒ–å‡ºæ¥ï¼Œæ‰€ä»¥ï¼š</p>

<ul>
<li>å½“ä»ä»£ç å®ä¾‹åŒ– UIView çš„æ—¶å€™ï¼ŒinitWithFrame ä¼šæ‰§è¡Œï¼›</li>
<li>å½“ä»æ–‡ä»¶åŠ è½½ UIView çš„æ—¶å€™ï¼ŒinitWithCoder ä¼šæ‰§è¡Œã€‚</li>
</ul>


<p>ä»ä»£ç ä¸­åŠ è½½</p>

<p>è™½ç„¶ initWithFrame æ˜¯ UIView çš„Designated Initializerï¼Œç†è®ºä¸Šæ¥è®²ä½ ç»§æ‰¿è‡ª UIView çš„ä»»ä½•å­ç±»ï¼Œè¯¥æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç±»åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ²¡æœ‰éµå®ˆè¿™ä¸ªçº¦å®šï¼Œå¦‚ UIImageView çš„ initWithImage å’Œ UITableViewCell çš„ initWithStyle:reuseIdentifier: çš„æ„é€ å™¨ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™è‡ªå®šä¹‰æ§ä»¶çš„æ—¶å€™ï¼Œæœ€å¥½åªå‡è®¾çˆ¶è§†å›¾çš„ Designated Initializer è¢«è°ƒç”¨ã€‚</p>

<p>å¦‚æœæ§ä»¶åœ¨åˆå§‹åŒ–æˆ–è€…åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»æœ‰ä¸€äº›å‚æ•°è¦è®¾ç½®ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å†™è‡ªå·±çš„ Designated Initializer æ„é€ å™¨ï¼Œå¦‚ï¼š</p>

<pre><code>- (instancetype)initWithName:(NSString *)name;
</code></pre>

<p>åœ¨å®ç°ä¸­ä¸€å®šè¦è°ƒç”¨çˆ¶ç±»çš„ Designated Initializerï¼Œè€Œä¸”å¦‚æœä½ æœ‰å¤šä¸ªè‡ªå®šä¹‰çš„ Designated Initializerï¼Œæœ€ç»ˆéƒ½åº”è¯¥æŒ‡å‘ä¸€ä¸ªå…¨èƒ½çš„åˆå§‹åŒ–æ„é€ å™¨ï¼š</p>

<pre><code>- (instancetype)initWithName:(NSString *)name {
    self = [self initWithName:name frame:CGRectZero];
    return self;
}
- (instancetype)initWithName:(NSString *)name frame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        self.name = name;
    }
    return self;
}
</code></pre>

<p>å¹¶ä¸”ä½ è¦è€ƒè™‘åˆ°ï¼Œå› ä¸ºä½ çš„æ§ä»¶æ˜¯ç»§æ‰¿è‡ª UIView æˆ– UIControl çš„ï¼Œé‚£ä¹ˆç”¨æˆ·å®Œå…¨å¯ä»¥ä¸ä½¿ç”¨ä½ æä¾›çš„æ„é€ å™¨ï¼Œè€Œç›´æ¥è°ƒç”¨åŸºç±»çš„æ„é€ å™¨ï¼Œæ‰€ä»¥æœ€å¥½é‡å†™çˆ¶ç±»çš„ Designated Initializerï¼Œä½¿å®ƒè°ƒç”¨ä½ æä¾›çš„ Designated Initializer ï¼Œæ¯”å¦‚çˆ¶ç±»æ˜¯ä¸ª UIViewï¼š</p>

<pre><code>- (instancetype)initWithFrame:(CGRect)frame {
    self = [self initWithName:nil frame:frame];
    return self;
}
</code></pre>

<p>è¿™æ ·å½“ç”¨æˆ·ä»ä»£ç é‡Œåˆå§‹åŒ–ä½ çš„æ§ä»¶çš„æ—¶å€™ï¼Œå°±æ€»æ˜¯é€ƒè„±ä¸äº†ä½ éœ€è¦æ‰§è¡Œçš„åˆå§‹åŒ–ä»£ç äº†ï¼Œå“ªæ€•ç”¨æˆ·ç›´æ¥è°ƒç”¨ init æ–¹æ³•ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šå›åˆ°çˆ¶ç±»çš„ Designated Initializer ä¸Šã€‚</p>

<p>ä» xib æˆ– storyboard ä¸­åŠ è½½</p>

<p>å½“æ§ä»¶ä» xib æˆ– storyboard ä¸­åŠ è½½çš„æ—¶å€™ï¼Œæƒ…å†µå°±å˜å¾—å¤æ‚äº†ï¼Œé¦–å…ˆæˆ‘ä»¬çŸ¥é“æœ‰ initWithCoder æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨ï¼Œæ¯”å¦‚ä»æ–‡ä»¶åŠ è½½ä¸€ä¸ª UIView çš„æ—¶å€™ï¼š</p>

<pre><code>UIView *view = [[UIView alloc] init];
NSData *data = [NSKeyedArchiver archivedDataWithRootObject:view];
[[NSUserDefaults standardUserDefaults] setObject:data forKey:@"KeyView"];
[[NSUserDefaults standardUserDefaults] synchronize];
data = [[NSUserDefaults standardUserDefaults] objectForKey:@"KeyView"];
view = [NSKeyedUnarchiver unarchiveObjectWithData:data];
NSLog(@"%@", view);
</code></pre>

<p>æ‰§è¡Œ unarchiveObjectWithData çš„æ—¶å€™ï¼Œ initWithCoder ä¼šè¢«è°ƒç”¨ï¼Œé‚£ä¹ˆä½ æœ‰å¯èƒ½ä¼šåœ¨è¿™ä¸ªæ–¹æ³•é‡Œåšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚æ¢å¤åˆ°ä¿å­˜ä¹‹å‰çš„çŠ¶æ€ï¼Œå½“ç„¶å‰ææ˜¯éœ€è¦åœ¨ encodeWithCoder ä¸­é¢„å…ˆä¿å­˜ä¸‹æ¥ã€‚</p>

<p>ä¸è¿‡æˆ‘ä»¬å¾ˆå°‘ä¼šè‡ªå·±ç›´æ¥æŠŠä¸€ä¸ª View ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬æ˜¯åœ¨ xib æˆ– storyboard ä¸­å†™ä¸€ä¸ª Viewï¼Œç„¶åè®©ç³»ç»Ÿæ¥å®Œæˆååºåˆ—åŒ–çš„å·¥ä½œï¼Œæ­¤æ—¶åœ¨ initWithCoder è°ƒç”¨ä¹‹åï¼ŒawakeFromNib æ–¹æ³•ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œæ—¢ç„¶åœ¨ awakeFromNib æ–¹æ³•é‡Œä¹Ÿèƒ½åšåˆå§‹åŒ–æ“ä½œï¼Œé‚£æˆ‘ä»¬å¦‚ä½•æŠ‰æ‹©?</p>

<p>ä¸€èˆ¬æ¥è¯´è¦å°½é‡åœ¨ initWithCoder ä¸­åšåˆå§‹åŒ–æ“ä½œï¼Œæ¯•ç«Ÿè¿™æ˜¯æœ€åˆç†çš„åœ°æ–¹ï¼Œåªè¦ä½ çš„æ§ä»¶æ”¯æŒåºåˆ—åŒ–ï¼Œé‚£ä¹ˆå®ƒå°±èƒ½åœ¨ä»»ä½•è¢«ååºåˆ—åŒ–çš„æ—¶å€™æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè¿™é‡Œé€‚åˆåšå…¨å±€æ•°æ®ã€çŠ¶æ€çš„åˆå§‹åŒ–å·¥ä½œï¼Œä¹Ÿé€‚åˆæ‰‹åŠ¨æ·»åŠ å­è§†å›¾ã€‚</p>

<p>awakeFromNib ç›¸è¾ƒäº initWithCoder çš„ä¼˜åŠ¿æ˜¯ï¼šå½“ awakeFromNib æ‰§è¡Œçš„æ—¶å€™ï¼Œå„ç§ IBOutlet ä¹Ÿéƒ½è¿æ¥å¥½äº†ï¼›è€Œ initWithCoder è°ƒç”¨çš„æ—¶å€™ï¼Œè™½ç„¶å­è§†å›¾å·²ç»è¢«æ·»åŠ åˆ°è§†å›¾å±‚çº§ä¸­ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¼•ç”¨ã€‚å¦‚æœä½ æ˜¯åŸºäº xib æˆ– storyboard åˆ›å»ºçš„æ§ä»¶ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å¯¹ IBOutlet è¿æ¥çš„å­æ§ä»¶è¿›è¡Œåˆå§‹åŒ–å·¥ä½œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä½ åªèƒ½åœ¨ awakeFromNib é‡Œè¿›è¡Œå¤„ç†ã€‚åŒæ—¶ xib æˆ– storyboard å¯¹çµæ´»æ€§æ˜¯æœ‰æ‰“æŠ˜çš„ï¼Œå› ä¸ºå®ƒä»¬åˆ›å»ºçš„ä»£ç æ— æ³•è¢«ç»§æ‰¿ï¼Œæ‰€ä»¥å½“ä½ é€‰æ‹©ç”¨ xib æˆ– storyboard æ¥å®ç°ä¸€ä¸ªæ§ä»¶çš„æ—¶å€™ï¼Œä½ å·²ç»ä¸éœ€è¦å¯¹çµæ´»æ€§æœ‰å¾ˆé«˜çš„è¦æ±‚äº†ï¼Œå”¯ä¸€è¦åšçš„æ˜¯è¦ä¿è¯ç”¨æˆ·ä¸€å®šæ˜¯é€šè¿‡ xib åˆ›å»ºçš„æ­¤æ§ä»¶ï¼Œå¦åˆ™å¯èƒ½æ˜¯ä¸€ä¸ªç©ºçš„è§†å›¾ï¼Œå¯ä»¥åœ¨ initWithFrame é‡Œæ”¾ç½®ä¸€ä¸ª æ–­è¨€ æˆ–è€…å¼‚å¸¸æ¥é€šçŸ¥æ§ä»¶çš„ç”¨æˆ·ã€‚</p>

<p>æœ€åè¿˜è¦æ³¨æ„è§†å›¾å±‚çº§çš„é—®é¢˜ï¼Œæ¯”å¦‚ä½ è¦ç»™ View æ”¾ç½®ä¸€ä¸ªèƒŒæ™¯ï¼Œä½ å¯èƒ½ä¼šåœ¨ initWithCoder æˆ– awakeFromNib ä¸­è¿™æ ·å†™ï¼š</p>

<pre><code>[self addSubview:self.backgroundView]; // é€šè¿‡æ‡’åŠ è½½ä¸€ä¸ªèƒŒæ™¯ Viewï¼Œç„¶åæ·»åŠ åˆ°è§†å›¾å±‚çº§ä¸Š
</code></pre>

<p>ä½ çš„æœ¬æ„æ˜¯åœ¨æ§ä»¶çš„æœ€ä¸‹é¢æ”¾ç½®ä¸€ä¸ªèƒŒæ™¯ï¼Œå´æœ‰å¯èƒ½å°†è¿™ä¸ªèƒŒæ™¯è¦†ç›–åˆ°æ§ä»¶çš„æœ€ä¸Šæ–¹ï¼ŒåŸå› æ˜¯ç”¨æˆ·å¯èƒ½ä¼šåœ¨ xib é‡Œå†™å…¥è¿™ä¸ªæ§ä»¶ï¼Œç„¶åå¾€å®ƒä¸Šé¢æ·»åŠ ä¸€äº›å­è§†å›¾ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·æ·»åŠ çš„è¿™äº›å­è§†å›¾ä¼šåœ¨ä½ æ·»åŠ èƒŒæ™¯ä¹‹å‰å…ˆè¿›å…¥è§†å›¾å±‚çº§ï¼Œä½ çš„èƒŒæ™¯è¢«æ·»åŠ åå°±æŒ¡ä½äº†ç”¨æˆ·çš„å­è§†å›¾ã€‚å¦‚æœä½ æƒ³æ”¯æŒç”¨æˆ·çš„è¿™ç§æ“ä½œï¼Œå¯ä»¥æŠŠ addSubview æ›¿æ¢æˆ insertSubview:atIndex:ã€‚</p>

<p>åŒæ—¶æ”¯æŒä»ä»£ç å’Œæ–‡ä»¶ä¸­åŠ è½½</p>

<p>å¦‚æœä½ è¦åŒæ—¶æ”¯æŒ initWithFrame å’Œ initWithCoder ï¼Œé‚£ä¹ˆä½ å¯ä»¥æä¾›ä¸€ä¸ª commonInit æ–¹æ³•æ¥åšç»Ÿä¸€çš„åˆå§‹åŒ–ï¼š</p>

<pre><code>- (id)initWithCoder:(NSCoder *)aDecoder {
    self = [super initWithCoder:aDecoder];
    if (self) {
        [self commonInit];
    }
    return self;
}
- (id)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        [self commonInit];
    }
    return self;
}
- (void)commonInit {
    // do something ...
}
</code></pre>

<p>awakeFromNib æ–¹æ³•é‡Œå°±ä¸è¦å†å»è°ƒç”¨ commonInit äº†ã€‚</p>

<p>è°ƒæ•´å¸ƒå±€çš„æ—¶æœº</p>

<p>å½“ä¸€ä¸ªæ§ä»¶è¢«åˆå§‹åŒ–ä»¥åŠå¼€å§‹ä½¿ç”¨ä¹‹åï¼Œå®ƒçš„ frame ä»ç„¶å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ¥å—è¿™äº›å˜åŒ–ï¼Œå› ä¸ºä½ æä¾›çš„æ˜¯ UIView çš„æ¥å£ï¼ŒUIView æœ‰å¾ˆå¤šç§åˆå§‹åŒ–æ–¹å¼ï¼šinitWithFrameã€initWithCoderã€init å’Œç±»æ–¹æ³• newï¼Œç”¨æˆ·å®Œå…¨å¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹åå†è®¾ç½® frame å±æ€§ï¼Œè€Œä¸”ç”¨æˆ·å°±ç®—ä½¿ç”¨ initWithFrame æ¥åˆå§‹åŒ–ä¹Ÿé¿å…ä¸äº† frame çš„æ”¹å˜ï¼Œæ¯”å¦‚åœ¨æ¨ªç«–å±åˆ‡æ¢çš„æ—¶å€™ã€‚ä¸ºäº†ç¡®ä¿å½“å®ƒçš„ Size å‘ç”Ÿå˜åŒ–åå…¶å­è§†å›¾ä¹Ÿèƒ½åŒæ­¥æ›´æ–°ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸€å¼€å§‹å°±æŠŠå¸ƒå±€å†™æ­»ï¼ˆä½¿ç”¨çº¦æŸé™¤å¤–ï¼‰ã€‚</p>

<p>åŸºäº frame</p>

<p>å¦‚æœä½ æ˜¯ç›´æ¥åŸºäº frame æ¥å¸ƒå±€çš„ï¼Œä½ åº”è¯¥ç¡®ä¿åœ¨åˆå§‹åŒ–çš„æ—¶å€™åªæ·»åŠ è§†å›¾ï¼Œè€Œä¸å»è®¾ç½®å®ƒä»¬çš„frameï¼ŒæŠŠè®¾ç½®å­è§†å›¾ frame çš„è¿‡ç¨‹å…¨éƒ¨æ”¾åˆ° layoutSubviews æ–¹æ³•é‡Œï¼š</p>

<pre><code>- (instancetype)initWithCoder:(NSCoder *)aDecoder {
    self = [super initWithCoder:aDecoder];
    if (self) {
        [self commonInit];
    }
    return self;
}
- (instancetype)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        [self commonInit];
    }
    return self;
}
- (void)layoutSubviews {
    [super layoutSubviews];
    self.label.frame = CGRectInset(self.bounds, 20, 0);
}
- (void)commonInit {
    [self addSubview:self.label];
}
- (UILabel *)label {
    if (_label == nil) {
        _label = [UILabel new];
        _label.textColor = [UIColor grayColor];
    }
    return _label;
}
</code></pre>

<p>è¿™ä¹ˆåšå°±èƒ½ä¿è¯ label æ€»æ˜¯å‡ºç°åœ¨æ­£ç¡®çš„ä½ç½®ä¸Šã€‚</p>

<p>ä½¿ç”¨ layoutSubviews æ–¹æ³•æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>

<p>ä¸è¦ä¾èµ–å‰ä¸€æ¬¡çš„è®¡ç®—ç»“æœï¼Œåº”è¯¥æ€»æ˜¯æ ¹æ®å½“å‰æœ€æ–°å€¼æ¥è®¡ç®—
ç”±äº layoutSubviews æ–¹æ³•æ˜¯åœ¨è‡ªèº«çš„ bounds å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ï¼Œ å› æ­¤ UIScrollView ä¼šåœ¨æ»šåŠ¨æ—¶ä¸åœåœ°è°ƒç”¨ï¼Œå½“ä½ åªå…³å¿ƒ Size æœ‰æ²¡æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠå‰ä¸€æ¬¡çš„ Size ä¿å­˜èµ·æ¥ï¼Œé€šè¿‡ä¸æœ€æ–°çš„ Size æ¯”è¾ƒæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½èƒ½æ”¹å–„æ€§èƒ½
åŸºäº Auto Layout çº¦æŸ</p>

<p>å¦‚æœä½ æ˜¯åŸºäº Auto Layout çº¦æŸæ¥è¿›è¡Œå¸ƒå±€ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ commonInit è°ƒç”¨çš„æ—¶å€™å°±æŠŠçº¦æŸæ·»åŠ ä¸Šå»ï¼Œä¸è¦é‡å†™ layoutSubviews æ–¹æ³•ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹å®ƒçš„é»˜è®¤å®ç°å°±æ˜¯æ ¹æ®çº¦æŸæ¥è®¡ç®— frameã€‚æœ€é‡è¦çš„ä¸€ç‚¹ï¼ŒæŠŠ translatesAutoresizingMaskIntoConstraints å±æ€§è®¾ä¸º NOï¼Œä»¥å…äº§ç”Ÿ NSAutoresizingMaskLayoutConstraint çº¦æŸï¼Œå¦‚æœä½ ä½¿ç”¨ Masonry æ¡†æ¶çš„è¯ï¼Œåˆ™ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ï¼Œmas_makeConstraints æ–¹æ³•ä¼šé¦–å…ˆè®¾ç½®è¿™ä¸ªå±æ€§ä¸º NO:</p>

<pre><code>- (void)commonInit {
    ...
    [self setupConstraintsForSubviews];
}
- (void)setupConstraintsForSubviews {
    [self.label mas_makeConstraints:^(MASConstraintMaker *make) {
        ...
    }];
}
</code></pre>

<p>æ”¯æŒ sizeToFit</p>

<p>å¦‚æœä½ çš„æ§ä»¶å¯¹å°ºå¯¸æœ‰ä¸¥æ ¼çš„é™å®šï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å®½é«˜æ¯”æˆ–è€…æ˜¯å›ºå®šå°ºå¯¸ï¼Œé‚£ä¹ˆæœ€å¥½èƒ½å®ç°ç³»ç»Ÿç»™å‡ºçš„çº¦å®šæˆä¿—çš„æ¥å£ã€‚</p>

<p>sizeToFit ç”¨åœ¨åŸºäº frame å¸ƒå±€çš„æƒ…å†µä¸‹ï¼Œç”±ä½ çš„æ§ä»¶å»å®ç° sizeThatFits: æ–¹æ³•ï¼š</p>

<pre><code>- (CGSize)sizeThatFits:(CGSize)size {
    CGSize fitSize = [super sizeThatFits:size];
    fitSize.height += self.label.frame.size.height;
    // å¦‚æœæ˜¯å›ºå®šå°ºå¯¸ï¼Œå°±åƒ UISwtich é‚£æ ·è¿”å›ä¸€ä¸ªå›ºå®š Size å°± OK äº†
    return fitSize;
}
</code></pre>

<p>ç„¶ååœ¨å¤–éƒ¨è°ƒç”¨è¯¥æ§ä»¶çš„ sizeToFit æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨ sizeThatFits å¹¶æ›´æ–°è‡ªèº«çš„ Sizeï¼š</p>

<p>[self.customView sizeToFit];
åœ¨ ViewController é‡Œè°ƒæ•´è§†å›¾å¸ƒå±€</p>

<p>å½“æ‰§è¡Œ viewDidLoad æ–¹æ³•æ—¶ï¼Œä¸è¦ä¾èµ– self.view çš„ Sizeã€‚å¾ˆå¤šäººä¼šè¿™æ ·å†™ï¼š</p>

<pre><code>- (void)viewDidLoad {
    ...
    self.label.width = self.view.width;
}
</code></pre>

<p>è¿™æ ·æ˜¯ä¸å¯¹çš„ï¼Œå“ªæ€•çœ‹ä¸Šå»æ²¡é—®é¢˜ä¹Ÿåªæ˜¯ç¢°å·§æ²¡é—®é¢˜è€Œå·²ã€‚å½“ viewDidLoad æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œself.view æ‰åˆšåˆšè¢«åˆå§‹åŒ–ï¼Œæ­¤æ—¶å®ƒçš„å®¹å™¨è¿˜æ²¡æœ‰å¯¹å®ƒçš„ frame è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœ view æ˜¯ä» xib åŠ è½½çš„ï¼Œé‚£ä¹ˆå®ƒçš„ Size å°±æ˜¯ xib ä¸­è®¾ç½®çš„å€¼ï¼›å¦‚æœå®ƒæ˜¯ä»ä»£ç åŠ è½½çš„ï¼Œé‚£ä¹ˆå®ƒçš„ Size å’Œå±å¹•å¤§å°æœ‰å…³ç³»ï¼Œé™¤äº† Size ä»¥å¤–ï¼ŒOrigin ä¹Ÿä¸ä¼šå‡†ç¡®ã€‚æ•´ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>

<p>å½“è®¿é—® ViewController çš„ view çš„æ—¶å€™ï¼ŒViewController ä¼šå…ˆæ‰§è¡Œ loadViewIfRequired æ–¹æ³•ï¼Œå¦‚æœ view è¿˜æ²¡æœ‰åŠ è½½ï¼Œåˆ™è°ƒç”¨ loadViewï¼Œç„¶åæ˜¯ viewDidLoad è¿™ä¸ªé’©å­æ–¹æ³•ï¼Œæœ€åæ˜¯è¿”å› viewï¼Œå®¹å™¨æ‹¿åˆ° view åï¼Œæ ¹æ®è‡ªèº«çš„å±æ€§ï¼ˆå¦‚ edgesForExtendedLayoutã€åˆ¤æ–­æ˜¯å¦å­˜åœ¨ tabBarã€åˆ¤æ–­ navigationBar æ˜¯å¦é€æ˜ç­‰ï¼‰æ·»åŠ çº¦æŸæˆ–è€…è®¾ç½® frameã€‚</p>

<p>ä½ è‡³å°‘åº”è¯¥è®¾ç½® autoresizingMask å±æ€§ï¼š</p>

<pre><code>- (void)viewDidLoad {
    ...
    self.label.width = self.view.width;
    self.label.autoresizingMask = UIViewAutoresizingFlexibleWidth;
}
</code></pre>

<p>æˆ–è€…åœ¨ viewDidLayoutSubviews é‡Œå¤„ç†ï¼š</p>

<pre><code>- (void)viewDidLayoutSubviews {
    [super viewDidLayoutSubviews];
    self.label.width = self.view.width;
}
</code></pre>

<p>å¦‚æœæ˜¯åŸºäº Auto Layout æ¥å¸ƒå±€ï¼Œåˆ™åœ¨ viewDidLoad é‡Œæ·»åŠ çº¦æŸå³å¯ã€‚</p>

<p>æ­£ç¡®çš„å¤„ç† touches æ–¹æ³•</p>

<p>å¦‚æœä½ éœ€è¦é‡å†™ touches æ–¹æ³•ï¼Œé‚£ä¹ˆåº”è¯¥å®Œæ•´çš„é‡å†™è¿™å››ä¸ªæ–¹æ³•ï¼š</p>

<pre><code>- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event;
- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event;
- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event;
- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event;
</code></pre>

<p>å½“ä½ çš„è§†å›¾åœ¨è¿™å››ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœå·²ç»å¯¹äº‹ä»¶è¿›è¡Œäº†å¤„ç†ï¼Œå°±ä¸è¦å†è°ƒç”¨ super çš„ touches æ–¹æ³•ï¼Œsuper çš„ touches æ–¹æ³•é»˜è®¤å®ç°æ˜¯åœ¨å“åº”é“¾é‡Œç»§ç»­è½¬å‘äº‹ä»¶ï¼ˆUIView çš„é»˜è®¤å®ç°ï¼‰ã€‚å¦‚æœä½ çš„åŸºç±»æ˜¯ UIScrollView æˆ–è€… UIButton è¿™äº›å·²ç»é‡å†™äº†äº‹ä»¶å¤„ç†çš„ç±»ï¼Œé‚£ä¹ˆå½“ä½ ä¸æƒ³å¤„ç†äº‹ä»¶çš„æ—¶å€™å¯ä»¥è°ƒç”¨ self.nextResponder çš„ touches æ–¹æ³•æ¥è½¬å‘äº‹ä»¶ï¼Œå…¶ä»–çš„æƒ…å†µå°±è°ƒç”¨ super çš„ touches æ–¹æ³•æ¥è½¬å‘ï¼Œæ¯”å¦‚ UIScrollView å¯ä»¥è¿™æ ·æ¥è½¬å‘ è§¦æ‘¸ äº‹ä»¶ï¼š</p>

<pre><code>- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    if (!self.dragging) {
        [self.nextResponder touchesBegan: touches withEvent:event]; 
    }       
    [super touchesBegan: touches withEvent: event];
}
- (void)touchesMoved...
- (void)touchesEnded...
- (void)touchesCancelled...
</code></pre>

<p>è¿™ä¹ˆå®ç°ä»¥åï¼Œå½“ä½ ä»…ä»…åªæ˜¯â€œç¢°â€ä¸€ä¸ª UIScrollView çš„æ—¶å€™ï¼Œè¯¥äº‹ä»¶å°±æœ‰å¯èƒ½è¢« nextResponder å¤„ç†ã€‚</p>

<p>å¦‚æœä½ æ²¡æœ‰å®ç°è‡ªå·±çš„äº‹ä»¶å¤„ç†ï¼Œä¹Ÿæ²¡æœ‰è°ƒç”¨ nextResponder å’Œ superï¼Œé‚£ä¹ˆå“åº”é“¾å°±ä¼šæ–­æ‰ã€‚å¦å¤–ï¼Œå°½é‡ç”¨æ‰‹åŠ¿è¯†åˆ«å™¨å»å¤„ç†è‡ªå®šä¹‰äº‹ä»¶ï¼Œå®ƒçš„å¥½å¤„æ˜¯ä½ ä¸éœ€è¦å…³å¿ƒå“åº”é“¾ï¼Œé€»è¾‘å¤„ç†èµ·æ¥ä¹Ÿæ›´åŠ æ¸…æ™°ï¼Œäº‹å®ä¸Šï¼ŒUIScrollView ä¹Ÿæ˜¯é€šè¿‡æ‰‹åŠ¿è¯†åˆ«å™¨å®ç°çš„ï¼š</p>

<pre><code>@property(nonatomic, readonly) UIPanGestureRecognizer *panGestureRecognizer NS_AVAILABLE_IOS(5_0); 
@property(nonatomic, readonly) UIPinchGestureRecognizer *pinchGestureRecognizer NS_AVAILABLE_IOS(5_0);
</code></pre>

<p>drawRectã€CALayer ä¸åŠ¨ç”»</p>

<p>drawRect æ–¹æ³•å¾ˆé€‚åˆåšè‡ªå®šä¹‰çš„æ§ä»¶ï¼Œå½“ä½ éœ€è¦æ›´æ–° UI çš„æ—¶å€™ï¼Œåªè¦ç”¨ setNeedsDisplay æ ‡è®°ä¸€ä¸‹å°±è¡Œäº†ï¼Œè¿™ä¹ˆåšåˆç®€å•åˆæ–¹ä¾¿ï¼›æ§ä»¶ä¹Ÿå¸¸å¸¸ç”¨äºå°è£…åŠ¨ç”»ï¼Œä½†æ˜¯åŠ¨ç”»å´æœ‰å¯èƒ½è¢«ç§»é™¤æ‰ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p>

<ol>
<li>åœ¨ drawRect é‡Œå°½é‡ç”¨ CGContext ç»˜åˆ¶ UIã€‚å¦‚æœä½ ç”¨ addSubview æ’å…¥äº†å…¶ä»–çš„è§†å›¾ï¼Œé‚£ä¹ˆå½“ç³»ç»Ÿåœ¨æ¯æ¬¡è¿›å…¥ç»˜åˆ¶çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠå½“å‰çš„ä¸Šä¸‹æ–‡æ¸…é™¤æ‰ï¼ˆæ­¤å¤„ä¸è€ƒè™‘ clearsContextBeforeDrawing çš„å½±å“ï¼‰ï¼Œç„¶åä½ ä¹Ÿè¦æ¸…é™¤æ‰å·²æœ‰çš„ subviewsï¼Œä»¥å…é‡å¤æ·»åŠ è§†å›¾ï¼›ç”¨æˆ·å¯èƒ½ä¼šå¾€ä½ çš„æ§ä»¶ä¸Šæ·»åŠ ä»–è‡ªå·±çš„å­è§†å›¾ï¼Œç„¶ååœ¨æŸä¸ªæƒ…å†µä¸‹æ¸…é™¤æ‰€æœ‰çš„å­è§†å›¾ï¼ˆæˆ‘å°±å–œæ¬¢è¿™ä¹ˆåšï¼‰ï¼š</li>
</ol>


<p>[subviews makeObjectsPerformSelector:@selector(removeFromSuperview)];
2. ç”¨ CALayer ä»£æ›¿ UIViewã€‚CALayer èŠ‚çœå†…å­˜ï¼Œè€Œä¸”æ›´é€‚åˆå»åšä¸€ä¸ªâ€œå›¾å±‚â€ï¼Œå› ä¸ºå®ƒä¸ä¼šæ¥æ”¶äº‹ä»¶ã€ä¹Ÿä¸ä¼šæˆä¸ºå“åº”é“¾ä¸­çš„ä¸€å‘˜ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿå“åº”çˆ¶è§†å›¾ï¼ˆæˆ– layerï¼‰çš„å°ºå¯¸å˜åŒ–ï¼Œè¿™ç§ç‰¹æ€§å¾ˆé€‚åˆåšå•çº¯çš„æ•°æ®å±•ç¤ºï¼š</p>

<pre><code>CALayer *imageLayer = [CALayer layer];
imageLayer.frame = rect;
imageLayer.contents = (id)image;
[self.view.layer addSublayer:imageLayer];
</code></pre>

<ol>
<li><p>å¦‚æœæœ‰å¯èƒ½çš„è¯ä½¿ç”¨ setNeedsDisplayInRect ä»£æ›¿ setNeedsDisplay ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œä½†æ˜¯é‡åˆ°æ€§èƒ½é—®é¢˜çš„æ—¶å€™åº”è¯¥å…ˆæ£€æŸ¥è‡ªå·±çš„ç»˜å›¾ç®—æ³•å’Œç»˜å›¾æ—¶æœºï¼Œæˆ‘ä¸ªäººå…¶å®ä»æ¥æ²¡æœ‰ä½¿ç”¨è¿‡ setNeedsDisplayInRectã€‚</p></li>
<li><p>å½“ä½ æƒ³åšä¸€ä¸ªæ— é™å¾ªç¯æ’­æ”¾çš„åŠ¨ç”»çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šåˆ›å»ºå‡ ä¸ªå°è£…äº†åŠ¨ç”»çš„ CALayerï¼Œç„¶åæŠŠå®ƒä»¬æ·»åŠ åˆ°è§†å›¾å±‚çº§ä¸Šï¼Œå°±åƒæˆ‘åœ¨ iOS å®ç°è„‰å†²é›·è¾¾ä»¥åŠåŠ¨æ€å¢å‡å…ƒç´  By Swift ä¸­è¿™ä¹ˆåšçš„ï¼š</p></li>
</ol>


<p><img src="/images/kongjianfengzhuang001.gif" title="Caption" ></p>

<p>æ•ˆæœè¿˜ä¸é”™ï¼Œå®ç°åˆç®€å•ï¼Œä½†æ˜¯å½“ä½ æŒ‰ä¸‹ Home é”®å¹¶å†æ¬¡è¿”å›åˆ° app çš„æ—¶å€™ï¼ŒåŸæœ¬å¥½çœ‹çš„åŠ¨ç”»å°±å˜æˆäº†ä¸€æ»©æ­»æ°´ï¼š</p>

<p>è¿™æ˜¯å› ä¸ºåœ¨æŒ‰ä¸‹ Home é”®çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„åŠ¨ç”»è¢«ç§»é™¤äº†ï¼Œå…·ä½“çš„ï¼Œæ¯ä¸ª layer éƒ½è°ƒç”¨äº† removeAllAnimations æ–¹æ³•ã€‚</p>

<p>å¦‚æœä½ æƒ³é‡æ–°æ’­æ”¾åŠ¨ç”»ï¼Œå¯ä»¥ç›‘å¬ UIApplicationDidBecomeActiveNotification é€šçŸ¥ï¼Œå°±åƒæˆ‘åœ¨ ä¸Šè¿°åšå®¢ ä¸­åšçš„é‚£æ ·ã€‚</p>

<ol>
<li><p>UIImageView çš„ drawRect æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ï¼š</p>

<pre><code> Special Considerations
 The UIImageView class is optimized to draw its images to the display. UIImageView will not call drawRect: in a subclass. If your subclass needs custom drawing code, it is recommended you use UIView as the base class.
</code></pre></li>
<li>UIView çš„ drawRect ä¹Ÿä¸ä¸€å®šä¼šè°ƒç”¨ï¼Œæˆ‘åœ¨ 12 å¹´çš„åšå®¢ï¼šå®šåˆ¶UINavigationBar ä¸­æ›¾ç»æåˆ°è¿‡ UIKit æ¡†æ¶çš„å®ç°æœºåˆ¶ï¼š</li>
</ol>


<p>ä¼—æ‰€å‘¨çŸ¥ä¸€ä¸ªè§†å›¾å¦‚ä½•æ˜¾ç¤ºæ˜¯å–å†³äºå®ƒçš„ drawRect æ–¹æ³•ï¼Œå› ä¸ºè°ƒè¿™ä¸ªæ–¹æ³•ä¹‹å‰ UIKit ä¹Ÿä¸çŸ¥é“å¦‚ä½•æ˜¾ç¤ºå®ƒï¼Œä½†å…¶å® drawRect æ–¹æ³•çš„ç›®çš„ä¹Ÿæ˜¯ç”»å›¾ï¼ˆæ˜¾ç¤ºå†…å®¹ï¼‰ï¼Œè€Œä¸”æˆ‘ä»¬å¦‚æœä»¥å…¶ä»–çš„æ–¹å¼ç»™å‡ºäº†å†…å®¹ï¼ˆå›¾ï¼‰çš„è¯ï¼Œ drawRect æ–¹æ³•å°±ä¸ä¼šè¢«è°ƒç”¨äº†ã€‚</p>

<p>æ³¨ï¼šå®é™…ä¸Š UIView æ˜¯ CALayer çš„delegateï¼Œå¦‚æœ CALayer æ²¡æœ‰å†…å®¹çš„è¯ï¼Œä¼šå›è°ƒç»™ UIView çš„ displayLayer: æˆ–è€… drawLayer:inContext: æ–¹æ³•ï¼ŒUIView åœ¨å…¶ä¸­è°ƒç”¨ drawRect ï¼Œdraw å®Œåçš„å›¾ä¼šç¼“å­˜èµ·æ¥ï¼Œé™¤éä½¿ç”¨ setNeedsDisplay æˆ–æ˜¯ä¸€äº›å¿…è¦æƒ…å†µï¼Œå¦åˆ™éƒ½æ˜¯ä½¿ç”¨ç¼“å­˜çš„å›¾ã€‚</p>

<p>UIView å’Œ CALayer éƒ½æ˜¯æ¨¡å‹å¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬ä»¥è¿™ç§æ–¹å¼ç»™å‡ºå†…å®¹çš„è¯ï¼ŒdrawRect ä¹Ÿå°±ä¸ä¼šè¢«è°ƒç”¨äº†ï¼š</p>

<pre><code>self.customView.layer.contents = (id)[UIImage imageNamed:@"AppIcon"];
// å“ªæ€•æ˜¯ç»™å®ƒä¸€ä¸ª nilï¼Œè¿™ä¸¤å¥ç­‰ä»·
self.customView.layer.contents = nil;
</code></pre>

<p>æˆ‘çŒœæµ‹æ˜¯åœ¨ CALayer çš„ setContents æ–¹æ³•é‡Œæœ‰ä¸ªæ ‡è®°ï¼Œæ— è®ºä¼ å…¥çš„å¯¹è±¡æ˜¯ä»€ä¹ˆéƒ½ä¼šå°†è¯¥æ ‡è®°æ‰“å¼€ï¼Œä½†æ˜¯è°ƒç”¨ setNeedsDisplay çš„æ—¶å€™ä¼šå°†è¯¥æ ‡è®°å»é™¤ã€‚</p>

<p>UIControl ä¸ UIButton</p>

<p>å¦‚æœè¦åšä¸€ä¸ªå¯äº¤äº’çš„æ§ä»¶ï¼Œé‚£ä¹ˆæŠŠ UIControl ä½œä¸ºåŸºç±»å°±æ˜¯é¦–é€‰ï¼Œè¿™ä¸ªå®Œç¾çš„åŸºç±»æ”¯æŒå„ç§çŠ¶æ€ï¼š</p>

<ul>
<li>enabled</li>
<li>selected</li>
<li>highlighted</li>
<li>tracking</li>
<li><p>â€¦â€¦
è¿˜æ”¯æŒå¤šçŠ¶æ€ä¸‹çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š</p>

<pre><code>  @property(nonatomic,readonly) UIControlState state;
  - (void)addTarget:(id)target action:(SEL)action forControlEvents:(UIControlEvents)controlEvents;
  - (void)removeTarget:(id)target action:(SEL)action forControlEvents:(UIControlEvents)controlEvents;
</code></pre>

<p>è¿™ä¸ªåŸºç±»å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ºè§†å›¾æ·»åŠ å„ç§ç‚¹å‡»çŠ¶æ€ï¼Œæœ€å¸¸è§çš„ç”¨æ³•å°±æ˜¯å°† UIViewController çš„ view æ”¹æˆ UIControlï¼Œç„¶åå°±èƒ½å¿«é€Ÿå®ç° resignFirstResponderã€‚</p></li>
</ul>


<p>UIButton è‡ªå¸¦å›¾æ–‡æ¥å£ï¼Œæ”¯æŒæ›´å¼ºå¤§çš„çŠ¶æ€åˆ‡æ¢ï¼ŒtitleEdgeInsets å’Œ imageEdgeInsets ä¹Ÿæ¯”è¾ƒå¥½ç”¨ï¼Œé…åˆä¸¤ä¸ªåŸºç±»çš„å±æ€§æ›´å¥½ï¼Œå…ˆè®¾ç½®å¯¹é½è§„åˆ™ï¼Œå†è®¾ç½® insetsï¼š</p>

<pre><code>@property(nonatomic) UIControlContentVerticalAlignment contentVerticalAlignment;    
@property(nonatomic) UIControlContentHorizontalAlignment contentHorizontalAlignment;
</code></pre>

<p>UIControl å’Œ UIButton éƒ½èƒ½å¾ˆå¥½çš„æ”¯æŒ xibï¼Œå¯ä»¥è®¾ç½®å„ç§çŠ¶æ€ä¸‹çš„æ˜¾ç¤ºå’Œ Selectorï¼Œä½†æ˜¯å¯¹ UIButton æ¥è¯´è¿™äº›å¹¶ä¸å¤Ÿï¼Œå› ä¸º Normal ã€Highlighted å’Œ Normal | Highlighted æ˜¯ä¸‰ç§ä¸åŒçš„çŠ¶æ€ï¼Œå¦‚æœä½ éœ€è¦å®ç°æ ¹æ®å½“å‰çŠ¶æ€æ˜¾ç¤ºä¸åŒé«˜äº®çš„å›¾ç‰‡ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢çš„ä»£ç ï¼š</p>

<p><img src="/images/kongjianfengzhuang002.png" title="Caption" ></p>

<pre><code>- (void)updateStates {
    [super setTitle:[self titleForState:UIControlStateNormal] forState:UIControlStateNormal | UIControlStateHighlighted];
    [super setImage:[self imageForState:UIControlStateNormal] forState:UIControlStateNormal | UIControlStateHighlighted];
    [super setTitle:[self titleForState:UIControlStateSelected] forState:UIControlStateSelected | UIControlStateHighlighted];
    [super setImage:[self imageForState:UIControlStateSelected] forState:UIControlStateSelected | UIControlStateHighlighted];
}
</code></pre>

<p>æˆ–è€…ä½¿ç”¨åˆå§‹åŒ–è®¾ç½®ï¼š</p>

<pre><code>- (void)commonInit {
    [self setImage:[UIImage imageNamed:@"Normal"] forState:UIControlStateNormal];
    [self setImage:[UIImage imageNamed:@"Selected"] forState:UIControlStateSelected];
    [self setImage:[UIImage imageNamed:@"Highlighted"] forState:UIControlStateHighlighted];
    [self setImage:[UIImage imageNamed:@"Selected_Highlighted"] forState:UIControlStateSelected | UIControlStateHighlighted];
}
</code></pre>

<p>æ€»ä¹‹å°½é‡ä½¿ç”¨åŸç”Ÿç±»çš„æ¥å£ï¼Œæˆ–è€…æ¨¡ä»¿åŸç”Ÿç±»çš„æ¥å£ã€‚</p>

<p>å¤§å¤šæ•°æƒ…å†µä¸‹æ ¹æ®ä½ æ‰€éœ€è¦çš„ç‰¹æ€§æ¥é€‰æ‹©ç°æœ‰çš„åŸºç±»å°±å¤Ÿäº†ï¼Œæˆ–è€…ç”¨ UIView + æ‰‹åŠ¿è¯†åˆ«å™¨ çš„ç»„åˆä¹Ÿæ˜¯ä¸€ä¸ªå¥½æ–¹æ¡ˆï¼Œå°½é‡ä¸è¦ç”¨ touches æ–¹æ³•ï¼ˆuserInteractionEnabled å±æ€§å¯¹ touches å’Œæ‰‹åŠ¿è¯†åˆ«å™¨çš„ä½œç”¨ä¸€æ ·ï¼‰ï¼Œè¿™æ˜¯æˆ‘åœ¨ DKCarouselView ä¸­å†…ç½®çš„ä¸€ä¸ªå¯ç‚¹å‡»çš„ ImageViewï¼Œä¹Ÿå¯ä»¥ç»§æ‰¿ UIButtonï¼Œä¸è¿‡ UIButton æ›´ä¾§é‡äºçŠ¶æ€ï¼ŒImageView ä¾§é‡äºå›¾ç‰‡æœ¬èº«ï¼š</p>

<pre><code>typedef void(^DKCarouselViewTapBlock)();
@interface DKClickableImageView : UIImageView
@property (nonatomic, assign) BOOL enable;
@property (nonatomic, copy) DKCarouselViewTapBlock tapBlock;
@end
@implementation DKClickableImageView
- (instancetype)initWithFrame:(CGRect)frame {
    if ((self = [super initWithFrame:frame])) {
        [self commonInit];
    }
    return self;
}
- (instancetype)initWithCoder:(NSCoder *)aDecoder {
    if ((self = [super initWithCoder:aDecoder])) {
        [self commonInit];
    }
    return self;
}
- (void)commonInit {
    self.userInteractionEnabled = YES;
    self.enable = YES;
    UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(onTap:)];
    [self addGestureRecognizer:tapGesture];
}
- (IBAction)onTap:(id)sender {
    if (!self.enable) return;
    if (self.tapBlock) {
        self.tapBlock();
    }
}
@end
</code></pre>

<p>æ›´å‹å¥½çš„æ”¯æŒ xib</p>

<p>ä½ çš„æ§ä»¶ç°åœ¨åº”è¯¥å¯ä»¥æ­£ç¡®çš„ä»æ–‡ä»¶ã€ä»£ç ä¸­åˆå§‹åŒ–äº†ï¼Œä½†æ˜¯ä» xib ä¸­åˆå§‹åŒ–ä»¥åå¯èƒ½è¿˜éœ€è¦é€šè¿‡ä»£ç æ¥è¿›è¡Œä¸€äº›è®¾ç½®ï¼Œä½ æˆ–è®¸è§‰å¾—åƒä¸Šé¢é‚£æ ·è®¾ç½® Button çš„çŠ¶æ€å¾ˆæ¶å¿ƒè€Œä¸”ä¸å¤Ÿç›´è§‚ï¼Œä½†æ˜¯ä¹Ÿæ²¡åŠæ³•ï¼Œè¿™æ˜¯ç”±äº xib è™½ç„¶å¯¹åŸç”Ÿæ§ä»¶ï¼Œå¦‚ UIViewã€UIImageViewã€UIScrollView ç­‰æ”¯æŒè¾ƒå¥½ï¼ˆæƒ³è®¾ç½®åœ†è§’ã€è¾¹æ¡†ç­‰å±æ€§ä¹Ÿæ²¡åŠæ³•ï¼Œåªèƒ½é€šè¿‡ layer æ¥è®¾ç½®ï¼‰ï¼Œä½†æ˜¯å¯¹è‡ªå®šä¹‰æ§ä»¶å´æ²¡æœ‰ä»€ä¹ˆåŠæ³•ï¼Œå½“ä½ æ‹–ä¸€ä¸ª UIView åˆ° xib ä¸­ï¼Œç„¶åæŠŠå®ƒçš„ Class æ”¹æˆä½ è‡ªå·±çš„å­ç±»åï¼Œxib å¦‚åŒä¸€ä¸ªçå­ä¸€æ ·ï¼Œä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ã€‚â€”â€”â€”â€”å¥½åœ¨è¿™äº›éƒ½æˆäº†è¿‡å»ã€‚</p>

<p>Xcode 6 å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„å®ï¼šIBInspectable å’Œ IBDesignableã€‚</p>

<p>IBInspectable</p>

<p>è¯¥å®ä¼šè®© xib è¯†åˆ«å±æ€§ï¼Œå®ƒæ”¯æŒè¿™äº›æ•°æ®ç±»å‹ï¼šå¸ƒå°”ã€å­—ç¬¦ä¸²ã€æ•°å­—ï¼ˆNSNumberï¼‰ã€ CGPointã€CGSizeã€CGRectã€UIColor ã€ NSRange å’Œ UIImageã€‚</p>

<p>æ¯”å¦‚æˆ‘ä»¬è¦è®©è‡ªå®šä¹‰çš„ Button èƒ½åœ¨ xib ä¸­è®¾ç½® UIControlStateSelected | UIControlStateHighlighted çŠ¶æ€çš„å›¾ç‰‡ï¼Œå°±å¯ä»¥è¿™ä¹ˆåšï¼š</p>

<pre><code>// CustomButton
@property (nonatomic, strong) IBInspectable UIImage *highlightSelectedImage;
- (void)setHighlightSelectedImage:(UIImage *)highlightSelectedImage {
    _highlightSelectedImage = highlightSelectedImage;
    [self setImage:highlightSelectedImage forState:UIControlStateHighlighted | UIControlStateSelected];
}
</code></pre>

<p>åªéœ€è¦åœ¨å±æ€§ä¸ŠåŠ ä¸ª IBInspectable å®å³å¯ï¼Œç„¶å xib ä¸­å°±èƒ½æ˜¾ç¤ºè¿™ä¸ªè‡ªå®šä¹‰çš„å±æ€§ï¼š</p>

<p><img src="/images/kongjianfengzhuang003.png" title="Caption" ></p>

<p>xib ä¼šæŠŠå±æ€§åä»¥å¤§é©¼å³°æ ·å¼æ˜¾ç¤ºï¼Œå¦‚æœæœ‰å¤šä¸ªå±æ€§ï¼Œxib ä¹Ÿä¼šè‡ªåŠ¨æŒ‰å±æ€§åçš„ç¬¬ä¸€ä¸ªå•è¯åˆ†ç»„æ˜¾ç¤ºï¼Œå¦‚ï¼š</p>

<p><img src="/images/kongjianfengzhuang004.png" title="Caption" ></p>

<p>é€šè¿‡ä½¿ç”¨ IBInspectable å®ï¼Œä½ å¯ä»¥æŠŠåŸæœ¬åªèƒ½é€šè¿‡ä»£ç æ¥è®¾ç½®çš„å±æ€§ï¼Œä¹Ÿæ”¾åˆ° xib é‡Œæ¥ï¼Œä»£ç å°±æ˜¾å¾—æ›´åŠ ç®€æ´äº†ã€‚</p>

<p>IBDesignable</p>

<p>xib é…åˆ IBInspectable å®è™½ç„¶å¯ä»¥è®©å±æ€§è®¾ç½®å˜å¾—ç®€å•åŒ–ï¼Œä½†æ˜¯åªæœ‰åœ¨è¿è¡ŒæœŸé—´ä½ æ‰èƒ½çœ‹åˆ°æ§ä»¶çš„çœŸæ­£æ•ˆæœï¼Œè€Œä½¿ç”¨ IBDesignable å¯ä»¥è®© Interface Builder å®æ—¶æ¸²æŸ“æ§ä»¶ï¼Œè¿™ä¸€åˆ‡åªéœ€è¦åœ¨ç±»ååŠ ä¸Š IBDesignable å®å³å¯ï¼š</p>

<pre><code>IB_DESIGNABLE
@interface CustomButton : UIButton
@property (nonatomic, strong) IBInspectable UIImage *highlightSelectedImage;
@end
</code></pre>

<p>è¿™æ ·ä¸€æ¥ï¼Œå½“ä½ åœ¨ xib ä¸­è°ƒæ•´å±æ€§çš„æ—¶å€™ï¼Œç”»å¸ƒä¹Ÿä¼šå®æ—¶æ›´æ–°ã€‚</p>

<p>å…³äºå¯¹ IBInspectable / IBDesignable çš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="http://nshipster.cn/ibinspectable-ibdesignable/">http://nshipster.cn/ibinspectable-ibdesignable/</a></p>

<p>è¿™æ˜¯ Twitter ä¸Šå…¶ä»–å¼€å‘è€…åšå‡ºçš„æ•ˆæœï¼š</p>

<p><img src="/images/kongjianfengzhuang005.png" title="Caption" ></p>

<p><img src="/images/kongjianfengzhuang006.png" title="Caption" ></p>

<p>ç›¸ä¿¡é€šè¿‡ä½¿ç”¨ IBInspectable / IBDesignable ï¼Œä¼šè®©æ§ä»¶ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€ä¹Ÿæ›´åŠ æœ‰è¶£ã€‚</p>

<p>ä¸è§„åˆ™å›¾å½¢å’Œäº‹ä»¶è§¦å‘èŒƒå›´</p>

<p>ä¸è§„åˆ™å›¾å½¢åœ¨ iOS ä¸Šå¹¶ä¸å¤šè§ï¼Œæƒ³æ¥è®¾è®¡å¸ˆä¹Ÿæ€•éº»çƒ¦ã€‚ä¸è¿‡ iOS ä¸Šçš„æ§ä»¶è¯´åˆ°åº•éƒ½æ˜¯å„å¼å„æ ·çš„çŸ©å½¢ï¼Œå°±ç®—ä½ ä¿®æ”¹ cornerRadiusï¼Œè®©å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>

<p><img src="/images/kongjianfengzhuang007.png" title="Caption" ></p>

<p>ä¹Ÿåªæ˜¯çœ‹èµ·æ¥åƒè¿™æ ·ç½¢äº†ï¼Œå®ƒçš„å®é™…äº‹ä»¶è§¦å‘èŒƒå›´è¿˜æ˜¯ä¸€ä¸ªçŸ©å½¢ã€‚</p>

<p>é—®é¢˜æè¿°</p>

<p>æƒ³è±¡ä¸€ä¸ªå¤æ‚çš„å¯äº¤äº’çš„æ§ä»¶ï¼Œå®ƒå¹¶ä¸æ˜¯å•ç‹¬å·¥ä½œçš„ï¼Œå¯èƒ½éœ€è¦å’Œå¦ä¸€ä¸ªæ§ä»¶äº¤äº’ï¼Œè€Œä¸”å®ƒä»¬çš„äº‹ä»¶è§¦å‘èŒƒå›´å¯èƒ½ä¼šé‡å ï¼Œåƒè¿™ä¸ªé€‰æ‹©è”ç³»äººçš„åˆ—è¡¨ï¼š</p>

<p><img src="/images/kongjianfengzhuang008.gif" title="Caption" ></p>

<p>åœ¨è®¾è®¡çš„æ—¶å€™è®©ä¸Šé¢äºŒçº§èœå•åœ¨æœ€å¤§çš„èŒƒå›´å†…å¯ä»¥è¢«ç‚¹å‡»ï¼Œä¸‹é¢çš„ä¸€çº§èœå•ä¹Ÿèƒ½åœ¨è‡ªå·±çš„èŒƒå›´å†…å¾ˆå¥½çš„å·¥ä½œï¼Œæ­£å¸¸æƒ…å†µä¸‹å®ƒä»¬çš„è§¦å‘èŒƒå›´æ˜¯è¿™æ ·çš„ï¼š</p>

<p><img src="/images/kongjianfengzhuang009.png" title="Caption" ></p>

<p>æˆ‘ä»¬æƒ³è¦çš„æ˜¯è¿™æ ·çš„ï¼š</p>

<p><img src="/images/kongjianfengzhuang010.png" title="Caption" ></p>

<p>æƒ³è¦å®ç°è¿™æ ·çš„æ•ˆæœéœ€è¦å¯¹äº‹ä»¶åˆ†å‘æœ‰ä¸€å®šçš„äº†è§£ã€‚é¦–å…ˆæˆ‘ä»¬æ¥æƒ³æƒ³ï¼Œå½“è§¦æ‘¸å±å¹•çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆ?</p>

<p>å½“è§¦æ‘¸å±å¹•çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆ?</p>

<p>å½“å±å¹•æ¥æ”¶åˆ°ä¸€ä¸ª touch çš„æ—¶å€™ï¼ŒiOS éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„å¯¹è±¡æ¥å¤„ç†äº‹ä»¶ï¼ˆ touch æˆ–è€…æ‰‹åŠ¿ï¼‰ï¼Œè¦å¯»æ‰¾è¿™ä¸ªå¯¹è±¡ï¼Œéœ€è¦ç”¨åˆ°è¿™ä¸ªæ–¹æ³•ï¼š</p>

<ul>
<li>(UIView <em>)hitTest:(CGPoint)point withEvent:(UIEvent </em>)event;
è¯¥æ–¹æ³•ä¼šé¦–å…ˆåœ¨ application çš„ keyWindow ä¸Šè°ƒç”¨ï¼ˆUIWindow ä¹Ÿæ˜¯ UIView çš„å­ç±»ï¼‰ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•çš„è¿”å›å€¼å°†è¢«ç”¨æ¥å¤„ç†äº‹ä»¶ã€‚å¦‚æœè¿™ä¸ª viewï¼ˆæ— è®ºæ˜¯ window è¿˜æ˜¯æ™®é€šçš„ UIViewï¼‰ çš„ userInteractionEnabled å±æ€§è¢«è®¾ç½®ä¸º NOï¼Œåˆ™å®ƒçš„ hitTest: æ°¸è¿œè¿”å› nilï¼Œè¿™æ„å‘³ç€å®ƒå’Œå®ƒçš„å­è§†å›¾æ²¡æœ‰æœºä¼šå»æ¥æ”¶å’Œå¤„ç†äº‹ä»¶ã€‚å¦‚æœ userInteractionEnabled å±æ€§ä¸º YESï¼Œåˆ™ä¼šå…ˆåˆ¤æ–­äº§ç”Ÿè§¦æ‘¸çš„ point æ˜¯å¦å‘ç”Ÿåœ¨è‡ªå·±çš„ bounds å†…ï¼Œå¦‚æœæ²¡æœ‰ä¹Ÿå°†è¿”å› nilï¼›å¦‚æœ point åœ¨è‡ªå·±çš„èŒƒå›´å†…ï¼Œåˆ™ä¼šä¸ºè‡ªå·±çš„æ¯ä¸ªå­è§†å›¾è°ƒç”¨ hitTest: æ–¹æ³•ï¼Œåªè¦æœ‰ä¸€ä¸ªå­è§†å›¾é€šè¿‡è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª UIView å¯¹è±¡ï¼Œé‚£ä¹ˆæ•´ä¸ªæ–¹æ³•å°±ä¸€å±‚ä¸€å±‚åœ°å¾€ä¸Šè¿”å›ï¼›å¦‚æœæ²¡æœ‰å­è§†å›¾è¿”å› UIView å¯¹è±¡ï¼Œåˆ™çˆ¶è§†å›¾å°†ä¼šæŠŠè‡ªå·±è¿”å›ã€‚</li>
</ul>


<p>æ‰€ä»¥ï¼Œåœ¨äº‹ä»¶åˆ†å‘ä¸­ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªå…³é”®ç‚¹ï¼š</p>

<p>å¦‚æœçˆ¶è§†å›¾ä¸èƒ½å“åº”äº‹ä»¶ï¼ˆuserInteractionEnabled ä¸º NOï¼‰ï¼Œåˆ™å…¶å­è§†å›¾ä¹Ÿå°†æ— æ³•å“åº”äº‹ä»¶ã€‚</p>

<p>å¦‚æœå­è§†å›¾çš„ frame æœ‰ä¸€åŠåœ¨å¤–é¢ï¼Œå°±åƒè¿™æ ·ï¼š</p>

<p><img src="/images/kongjianfengzhuang011.png" title="Caption" ></p>

<p>åˆ™åœ¨å¤–é¢çš„éƒ¨åˆ†æ˜¯æ— æ³•å“åº”äº‹ä»¶çš„ï¼Œå› ä¸ºå®ƒè¶…å‡ºäº†çˆ¶è§†å›¾çš„èŒƒå›´ã€‚</p>

<p>æ•´ä¸ªäº‹ä»¶é“¾åªä¼šè¿”å›ä¸€ä¸ª Hit-Test View æ¥å¤„ç†äº‹ä»¶ã€‚</p>

<p>å­è§†å›¾çš„é¡ºåºä¼šå½±å“åˆ° Hit-Test View çš„é€‰æ‹©ï¼šæœ€å…ˆé€šè¿‡ hitTest: æ–¹æ³•è¿”å›çš„ UIView æ‰ä¼šè¢«è¿”å›ï¼Œå‡å¦‚æœ‰ä¸¤ä¸ªå­è§†å›¾å¹³çº§ï¼Œå¹¶ä¸”å®ƒä»¬çš„ frame ä¸€æ ·ï¼Œä½†æ˜¯è°æ˜¯åæ·»åŠ çš„è°å°±ä¼˜å…ˆè¿”å›ã€‚</p>

<p>äº†è§£äº†äº‹ä»¶åˆ†å‘çš„è¿™äº›ç‰¹ç‚¹åï¼Œè¿˜éœ€è¦çŸ¥é“æœ€åä¸€ä»¶äº‹ï¼šUIView å¦‚ä½•åˆ¤æ–­äº§ç”Ÿäº‹ä»¶çš„ point æ˜¯å¦åœ¨è‡ªå·±çš„èŒƒå›´å†…? ç­”æ¡ˆæ˜¯é€šè¿‡ pointInside æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°ç±»ä¼¼äºè¿™æ ·ï¼š</p>

<pre><code>// point è¢«è½¬åŒ–ä¸ºå¯¹åº”è§†å›¾çš„åæ ‡ç³»ç»Ÿ
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    return CGRectContainsPoint(self.bounds, point);
}
</code></pre>

<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æƒ³æ”¹å˜ä¸€ä¸ª View çš„äº‹ä»¶è§¦å‘èŒƒå›´çš„æ—¶å€™ï¼Œé‡å†™ pointInside æ–¹æ³•å°±å¯ä»¥äº†ã€‚</p>

<p>å›åˆ°é—®é¢˜</p>

<p>é’ˆå¯¹è¿™ç§è§†å›¾ä¸€å®šè¦å¤„ç†å®ƒä»¬çš„äº‹ä»¶è§¦å‘èŒƒå›´ï¼Œä¹Ÿå°±æ˜¯ pointInside æ–¹æ³•ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å…ˆåˆ¤æ–­ point æ˜¯ä¸æ˜¯åœ¨è‡ªå·±çš„èŒƒå›´å†…ï¼ˆé€šè¿‡è°ƒç”¨ super æ¥åˆ¤æ–­ï¼‰ï¼Œç„¶åå†åˆ¤æ–­è¯¥ point ç¬¦ä¸ç¬¦åˆæˆ‘ä»¬çš„å¤„ç†è¦æ±‚ï¼š</p>

<p>è¿™ä¸ªä¾‹å­æˆ‘ç”¨ Swift æ¥å†™</p>

<pre><code>override func pointInside(point: CGPoint, withEvent event: UIEvent?) -&gt; Bool {
    let inside = super.pointInside(point, withEvent: event)
    if inside {
        let radius = self.layer.cornerRadius
        let dx = point.x - self.bounds.size.width / 2
        let dy = point.y - radius
        let distace = sqrt(dx * dx + dy * dy)
        return distace &lt; radius
    }
    return inside
}
</code></pre>

<p>å¦‚æœä½ è¦å®ç°éçŸ©å½¢çš„æ§ä»¶ï¼Œé‚£ä¹ˆè¯·åœ¨å¼€å‘æ—¶å¤„ç†å¥½è¿™ç±»é—®é¢˜ã€‚</p>

<p>è¿™é‡Œé™„ä¸Šä¸€ä¸ªå¾ˆå®¹æ˜“æµ‹è¯•çš„å° Demoï¼š</p>

<pre><code>class CustomView: UIControl {
    override init(frame: CGRect) {
        super.init(frame: frame)
        self.backgroundColor = UIColor.redColor()
    }
    required init(coder aDecoder: NSCoder) {
        super.init(coder: aDecoder)
        self.backgroundColor = UIColor.redColor()
    }
    override func layoutSubviews() {
        super.layoutSubviews()
        self.layer.cornerRadius = self.bounds.size.width / 2
    }
    override func beginTrackingWithTouch(touch: UITouch, withEvent event: UIEvent) -&gt; Bool {
        self.backgroundColor = UIColor.grayColor()
        return super.beginTrackingWithTouch(touch, withEvent: event)
    }
    override func endTrackingWithTouch(touch: UITouch, withEvent event: UIEvent) {
        super.endTrackingWithTouch(touch, withEvent: event)
        self.backgroundColor = UIColor.redColor()
    }
    override func pointInside(point: CGPoint, withEvent event: UIEvent?) -&gt; Bool {
        let inside = super.pointInside(point, withEvent: event)
        if inside {
            let radius = self.layer.cornerRadius
            let dx = point.x - self.bounds.size.width / 2
            let dy = point.y - radius
            let distace = sqrt(dx * dx + dy * dy)
            return distace &lt; radius
        }
        return inside
    }
}
</code></pre>

<h4>åˆç†ä½¿ç”¨ KVO</h4>

<p>æŸäº›è§†å›¾çš„æ¥å£æ¯”è¾ƒå®è´µï¼Œè¢«ä½ ç”¨æ‰åå¤–éƒ¨çš„ä½¿ç”¨è€…å°±æ— æ³•ä½¿ç”¨äº†ï¼Œæ¯”å¦‚ UITextField çš„ delegateï¼Œå¥½åœ¨ UITextField è¿˜æä¾›äº†é€šçŸ¥å’Œ UITextInput æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼›åƒ UIScrollView æˆ–è€…åŸºäº UIScrollView çš„æ§ä»¶ï¼Œä½ æ—¢ä¸èƒ½è®¾ç½®å®ƒçš„ delegateï¼Œåˆæ²¡æœ‰å…¶ä»–çš„æ›¿ä»£æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œå¯¹äºåƒä»¥ä¸‹è¿™ç§éœ€è¦æ ¹æ®æŸäº›å±æ€§å®æ—¶æ›´æ–°çš„æ§ä»¶æ¥è¯´ï¼ŒKVO çœŸæ˜¯æå¥½çš„ï¼š</p>

<p>è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€é«˜åº¦ Header çš„ä¾‹å­ï¼ˆDKStickyHeaderViewï¼‰ï¼š</p>

<p>ä¸¤è€…éƒ½æ˜¯åŸºäº UIScrollViewã€åŸºäº KVO ï¼Œä¸ä¾èµ–å¤–éƒ¨å‚æ•°ï¼š</p>

<pre><code>override func observeValueForKeyPath(keyPath: String, ofObject object: AnyObject, change: [NSObject : AnyObject], context: UnsafeMutablePointer) {
    if keyPath == KEY_PATH_CONTENTOFFSET {
        let scrollView = self.superview as! UIScrollView
        var delta: CGFloat = 0.0
        if scrollView.contentOffset.y &lt; 0.0 {
            delta = fabs(min(0.0, scrollView.contentOffset.y))
        }
        var newFrame = self.frame
        newFrame.origin.y = -delta
        newFrame.size.height = self.minHeight + delta
        self.frame = newFrame
    } else {
        super.observeValueForKeyPath(keyPath, ofObject: object, change: change, context: context)
    }
}
</code></pre>

<p>å¯¹å®¹å™¨ç±»çš„ ViewController æ¥è¯´ä¹Ÿä¸€æ ·æœ‰ç”¨ã€‚åœ¨ iOS8 ä¹‹å‰æ²¡æœ‰ UIContentContainer è¿™ä¸ªæ­£å¼åè®®ï¼Œå¦‚æœä½ è¦å®ç°ä¸€ä¸ªå¾ˆé•¿çš„ã€éåˆ—è¡¨ã€å¯æ»šåŠ¨çš„ ViewControllerï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå°†å…¶ä¸­çš„åŠŸèƒ½åˆ†æ•£åˆ°å‡ ä¸ª ChildViewController é‡Œï¼Œç„¶åæŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè¿™äº› ChildViewController æ—¢èƒ½è¢«å•ç‹¬ä½œä¸ºä¸€ä¸ª ViewController å±•ç¤ºï¼Œä¹Ÿå¯ä»¥è¢«ç»„åˆåˆ°ä¸€èµ·ã€‚ä½œä¸ºç»„åˆåˆ°ä¸€èµ·çš„å‰æï¼Œå°±æ˜¯éœ€è¦ä¸€ä¸ªè‡³å°‘æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•çš„åè®®ï¼š</p>

<p>æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è¾“å…¥æºï¼Œå¤§å¤šæ˜¯ä¸€ä¸ª Model æˆ–è€…åƒ userId è¿™æ ·çš„
èƒ½å¤Ÿè¿”å›ä½ æ‰€éœ€è¦çš„é«˜åº¦ï¼Œæ¯”å¦‚è®¾ç½® preferredContentSize å±æ€§
ChildViewController åŠ¨æ€åœ°è®¾ç½® contentSizeï¼Œå®¹å™¨ç›‘å¬ contentSize çš„å˜åŒ–åŠ¨æ€åœ°è®¾ç½®çº¦æŸæˆ–è€… frameã€‚</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">iCocos</span></span>

      




<time class='entry-date' datetime='2014-11-05T17:44:16+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:44 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/foundation/'>foundation</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/10/28/openel-gschu-tan/" title="Previous Post: OpenEL GSåˆæ¢">&laquo; OpenEL GSåˆæ¢</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/11/14/fang-fa-huan-cun/" title="Next Post: æ–¹æ³•ç¼“å­˜">æ–¹æ³•ç¼“å­˜ &raquo;</a>
      
    </p>
  </footer>
</article>



  <section>
    <h1>Comments</h1>
    <div id="comments" aria-live="polite"><!-- Duoshuo Comment BEGIN -->
<div class="ds-thread" data-title="æ€ä¹ˆå°è£…ä¸€ä¸ªæ§ä»¶"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"icocoscao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END --></div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/algorithms/'>algorithms (6)</a></li>
<li class='category'><a href='/blog/categories/and/'>and (14)</a></li>
<li class='category'><a href='/blog/categories/apples/'>apples (2)</a></li>
<li class='category'><a href='/blog/categories/application/'>application (1)</a></li>
<li class='category'><a href='/blog/categories/architecture/'>architecture (2)</a></li>
<li class='category'><a href='/blog/categories/audio/'>audio (8)</a></li>
<li class='category'><a href='/blog/categories/audio-video/'>audio-video (1)</a></li>
<li class='category'><a href='/blog/categories/data/'>data (6)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (16)</a></li>
<li class='category'><a href='/blog/categories/foundation/'>foundation (31)</a></li>
<li class='category'><a href='/blog/categories/full/'>full (13)</a></li>
<li class='category'><a href='/blog/categories/low-level/'>low-level (4)</a></li>
<li class='category'><a href='/blog/categories/lve/'>lve (8)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (4)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (1)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (12)</a></li>
<li class='category'><a href='/blog/categories/php-lover/'>php-lover (2)</a></li>
<li class='category'><a href='/blog/categories/practical/'>practical (1)</a></li>
<li class='category'><a href='/blog/categories/radio/'>radio (8)</a></li>
<li class='category'><a href='/blog/categories/reverse/'>reverse (7)</a></li>
<li class='category'><a href='/blog/categories/senior/'>senior (31)</a></li>
<li class='category'><a href='/blog/categories/stack/'>stack (13)</a></li>
<li class='category'><a href='/blog/categories/structures/'>structures (6)</a></li>
<li class='category'><a href='/blog/categories/summarize/'>summarize (5)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>
<li class='category'><a href='/blog/categories/video/'>video (8)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/12/03/phpwan-mei-da-pei-mysql/">PHPå®Œç¾æ­é…ä¹‹Mysqlåˆæ¢</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/02/zhong-zheng-linux/">é‡æ•´Linuxä¸€æ¬¡å°±å¤Ÿäº†</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/01/wan-zhuan-thinkphp-5-dot-star/">å®Œè™ThinkPHP 5.* è¿œä¸æ­¢è¿™äº›ğŸ˜±ğŸ˜‚</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/13/wan-nue-yiicong-zhe-li-kai-shi/">å®Œè™Yiiä»è¿™é‡Œå¼€å§‹ğŸ˜±ğŸ˜‚</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/20/apptai-pang-liao-jian-fei/">Appå¤ªèƒ–äº†â€”â€”å‡è‚¥ğŸ˜‚</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





<section>
<h1>åšå®¢<abbr title="The word 'åšå®¢' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'åšå®¢', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/blog/2014/11/05/zen-yao-feng-zhuang-%5B%3F%5D-ge-kong-jian/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/blog/2014/11/05/zen-yao-feng-zhuang-%5B%3F%5D-ge-kong-jian/" alt="post-qrcode"></a></section>


<section>
<h1>github<abbr title="The word 'github' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'github', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosgithub.png" alt="post-qrcode"></a></section>


<section>
<h1>å¾®ä¿¡<abbr title="The word 'å¾®ä¿¡' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å¾®ä¿¡', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosWX.png" alt="post-qrcode"></a></section>


<section>
<h1>å…¬ä¼—å·<abbr title="The word 'å…¬ä¼—å·' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å…¬ä¼—å·', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosMGC.png" alt="post-qrcode"></a><section>
  
  
</section>
<h1>å…¬ä¼—å·<abbr title="The word 'å…¬ä¼—å·' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å…¬ä¼—å·', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocos520.png" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - iCocos -
<span class="credit">welcome to <a href="http://al1020119.github.io">æ›¹#é»</a></span>
</p>

</footer>
  






<!--
-->



</body>
</html>
