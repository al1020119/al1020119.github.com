
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>å›¾ç‰‡å¤„ç†-å¸¸ç”¨æŠ€å·§ - iOSæ¢¦å·¥å‚</title>
  <meta name="author" content="iCocos">

  
  <meta name="description" content="iCocosåšå®¢">
  <meta name="keywords" content="iCocos, iOSå¼€å‘, åšå®¢, æŠ€æœ¯åˆ†æ, æ–‡ç« , å­¦ä¹ , æ›¹é», æ›¹ç†é¹">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://al1020119.github.io/blog/2016/01/14/tupianchulichangyongjiqiao/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="iOSæ¢¦å·¥å‚" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">iOSæ¢¦å·¥å‚</a></h1>
  
    <h2>iCocosâ€”â€”ä¸æˆ˜èƒœè‡ªå·±ï¼Œä½•ä»¥æ”¹å˜æœªæ¥ï¼</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="al1020119.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">åšæ–‡</a></li>
  <li><a href="/blog/archives">å½’æ¡£</a></li>
  <li><a href="/icocos">iCocos</a></li>
  <li><a href="/about">æ–‡ç« </a></li>
  <li><a href="/other">å…¶ä»–</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">å›¾ç‰‡å¤„ç†-å¸¸ç”¨æŠ€å·§</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-14T09:21:08+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:21 am</span></time>
        
        
        |   <a href="#comments">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>iOSå¼€å‘ä¸­å…³äºå›¾ç‰‡çš„å¤„ç†æ˜¯æœ€å¸¸è§çš„ï¼Œå°±å’Œä½ ä½¿ç”¨TableViewçš„é¢‘ç‡ä¸€æ ·ï¼Œæœ¬ç¯‡æ–‡ç« æ€»ç»“äº†ä¸€ä¸‹iOSå¼€å‘ä¸­å¸¸è§çš„å›¾ç‰‡å¤„ç†åŠç›¸å…³æºç ã€‚</p>

<p>è¿™é‡Œå°±ç»“åˆå¼€å‘ä¸å­¦ä¹ ä¸­é‡åˆ°çš„ä¸€ä¸€äº›å›¾ç‰‡å¤„ç†é—®é¢˜ï¼Œå†ç»“åˆå…¶ä»–å¤§ç‰›çš„ä¸€äº›å¹²è´§ï¼Œåšäº†ä¸€ç³»åˆ—çš„æ€»ç»“ï¼Œå¸Œæœ›èƒ½æœ€ä½ æœ‰å®é™…å¼€å‘æ„ä¹‰ï¼</p>

<p>ç›®å½•</p>

<ul>
<li>è·å–å›¾ç‰‡</li>
<li>æ¯”ä¾‹ç¼©æ”¾</li>
<li>åœ†è§’ åŒ–</li>
<li>æ·»åŠ é˜´å½±</li>
<li>å‹ç¼©å¤§å°</li>
<li>æ ¼å¼çš„è½¬æ¢</li>
<li>å›¾ç‰‡ä¸Šä¼ </li>
</ul>


<!--more-->


<h2>è·å–å›¾ç‰‡</h2>

<p>æåˆ°ä»æ‘„åƒå¤´/ç›¸å†Œè·å–å›¾ç‰‡æ˜¯é¢å‘ç»ˆç«¯ç”¨æˆ·çš„ï¼Œç”±ç”¨æˆ·å»æµè§ˆå¹¶é€‰æ‹©å›¾ç‰‡ä¸ºç¨‹åºä½¿ç”¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦è¿‡UIImagePickerControllerç±»æ¥å’Œç”¨æˆ·äº¤äº’ã€‚</p>

<p>ä½¿ç”¨UIImagePickerControllerå’Œç”¨æˆ·äº¤äº’ï¼Œæˆ‘ä»¬éœ€è¦å®ç°2ä¸ªåè®®</p>

<pre><code>&lt;UIImagePickerControllerDelegate,UINavigationControllerDelegate&gt;ã€‚

#pragma mark ä»ç”¨æˆ·ç›¸å†Œè·å–æ´»åŠ¨å›¾ç‰‡

- (void)pickImageFromAlbum

{

    imagePicker = [[UIImagePickerController alloc] init];

    imagePicker.delegate =self;

    imagePicker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;

    imagePicker.modalTransitionStyle = UIModalTransitionStyleCoverVertical;

    imagePicker.allowsEditing =YES;



    [self presentModalViewController:imagePicker animated:YES];

}
</code></pre>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢çš„ä»ç›¸å†Œè·å–å›¾ç‰‡ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®ä¾‹åŒ–UIImagePickerControllerå¯¹è±¡ï¼Œç„¶åè®¾ç½®imagePickerå¯¹è±¡ä¸ºå½“å‰å¯¹è±¡ï¼Œè®¾ç½®imagePickerçš„å›¾ç‰‡æ¥æºä¸ºUIImagePickerControllerSourceTypePhotoLibraryï¼Œè¡¨æ˜å½“å‰å›¾ç‰‡çš„æ¥æºä¸ºç›¸å†Œï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥è®¾ç½®ç”¨æˆ·å¯¹å›¾ç‰‡æ˜¯å¦å¯ç¼–è¾‘ã€‚</p>

<pre><code>#pragma mark ä»æ‘„åƒå¤´è·å–æ´»åŠ¨å›¾ç‰‡

- (void)pickImageFromCamera

{

    imagePicker = [[UIImagePickerController alloc] init];

    imagePicker.delegate =self;

    imagePicker.sourceType = UIImagePickerControllerSourceTypeCamera;

    imagePicker.modalTransitionStyle = UIModalTransitionStyleCoverVertical;

    imagePicker.allowsEditing =YES;



    [self presentModalViewController:imagePicker animated:YES];

}

//æ‰“å¼€ç›¸æœº

- (IBAction)touch_photo:(id)sender {

    // for iphone

    UIImagePickerController *pickerImage = [[UIImagePickerController alloc] init];

   if([UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera]) {

        pickerImage.sourceType = UIImagePickerControllerSourceTypeCamera;

        pickerImage.mediaTypes = [UIImagePickerController availableMediaTypesForSourceType:pickerImage.sourceType];



    }

    pickerImage.delegate =self;

    pickerImage.allowsEditing =YES;//è‡ªå®šä¹‰ç…§ç‰‡æ ·å¼

    [self presentViewController:pickerImage animated:YES completion:nil];

}
</code></pre>

<p>ä»¥ä¸Šæ˜¯ä»æ‘„åƒå¤´è·å–å›¾ç‰‡ï¼Œå’Œä»ç›¸å†Œè·å–å›¾ç‰‡åªæ˜¯å›¾ç‰‡æ¥æºçš„è®¾ç½®ä¸ä¸€æ ·ï¼Œæ‘„åƒå¤´å›¾ç‰‡çš„æ¥æºä¸ºUIImagePickerControllerSourceTypeCameraã€‚</p>

<p>åœ¨å’Œç”¨æˆ·äº¤äº’ä¹‹åï¼Œç”¨æˆ·é€‰æ‹©å¥½å›¾ç‰‡åï¼Œä¼šå›è°ƒé€‰æ‹©ç»“æŸçš„æ–¹æ³•ã€‚</p>

<h2>UIImage å›¾åƒ ç­‰æ¯”ä¾‹ç¼©æ”¾</h2>

<pre><code>PicAfterZoomWidth:ç¼©æ”¾åå›¾ç‰‡å®½  PicAfterZoomHeight:ç¼©æ”¾åå›¾ç‰‡é«˜ (é¢„å®šä¹‰)
+ (UIImage *)getPicZoomImage:(UIImage *)image {

    UIImage *img = image;

    int h = img.size.height;
    int w = img.size.width;
    if(h &lt;= PicAfterZoomWidth &amp;&amp; w &lt;= PicAfterZoomHeight)
    {
        image = img;
    }
    else 
    {
        float b = (float)PicAfterZoomWidth/w &lt; (float)PicAfterZoomHeight/h ? (float)PicAfterZoomWidth/w : (float)PicAfterZoomHeight/h;
        CGSize itemSize = CGSizeMake(b*w, b*h);
        UIGraphicsBeginImageContext(itemSize);
        CGRect imageRect = CGRectMake(0, 0, b*w, b*h);
        [img drawInRect:imageRect];
        img = UIGraphicsGetImageFromCurrentImageContext();
        UIGraphicsEndImageContext();
    }
    return img;
}
</code></pre>

<p>æˆ–è€…ï¼š</p>

<p>ç»˜å›¾æŠ€æœ¯æ”¹å˜å›¾ç‰‡å¤§å°ç¼©æ”¾æ–¹æ³•ï¼š</p>

<pre><code>-(UIImage*) OriginImage:(UIImage *)image scaleToSize:(CGSize)size
{
    UIGraphicsBeginImageContext(size); //size ä¸ºCGSizeç±»å‹ï¼Œå³ä½ æ‰€éœ€è¦çš„å›¾ç‰‡å°ºå¯¸

    [image drawInRect:CGRectMake(0, 0, size.width, size.height)];

    UIImage* scaledImage = UIGraphicsGetImageFromCurrentImageContext();

    UIGraphicsEndImageContext();

    return scaledImage; //è¿”å›çš„å°±æ˜¯å·²ç»æ”¹å˜çš„å›¾ç‰‡
}
</code></pre>

<h2>æŠŠå›¾ç‰‡ åœ†è§’ åŒ–</h2>

<p>è®¾ç½®åœ†è§’çš„æ–¹æ³•</p>

<pre><code>ç›´æ¥ä½¿ç”¨setCornerRadius

    è¿™ç§å°±æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¹Ÿæ˜¯æœ€è€—æ€§èƒ½çš„ã€‚

setCornerRadiusè®¾ç½®åœ†è§’ä¹‹åï¼ŒshouldRasterize=YESå…‰æ …åŒ–

    avatarImageView.clipsToBounds = YES; [avatarImageView.layer setCornerRadius:50]; avatarImageView.layer.shouldRasterize = YES;

    shouldRasterize=YESè®¾ç½®å…‰æ …åŒ–ï¼Œå¯ä»¥ä½¿ç¦»å±æ¸²æŸ“çš„ç»“æœç¼“å­˜åˆ°å†…å­˜ä¸­å­˜ä¸ºä½å›¾ï¼Œ ä½¿ç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼ŒèŠ‚çœäº†ä¸€ç›´ç¦»å±æ¸²æŸ“æŸè€—çš„æ€§èƒ½ã€‚

    ä½†æ˜¯å¦‚æœlayeråŠsublayerså¸¸å¸¸æ”¹å˜çš„è¯ï¼Œå®ƒå°±ä¼šä¸€ç›´ä¸åœçš„æ¸²æŸ“åŠåˆ é™¤ç¼“å­˜é‡æ–° åˆ›å»ºç¼“å­˜ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹å»ºè®®ä¸è¦ä½¿ç”¨å…‰æ …åŒ–ï¼Œè¿™æ ·ä¹Ÿæ˜¯æ¯”è¾ƒæŸè€—æ€§èƒ½çš„ã€‚

    é—®é¢˜ï¼šæˆ‘å‘ç°UIImageViewä¸ŠåŠ è½½ç½‘ç»œå›¾ç‰‡ä½¿ç”¨å…‰æ …åŒ–ä¼šæœ‰ä¸€ç‚¹æ¨¡ç³Šï¼Œè€ŒUIButton ä¸Šä½¿ç”¨å…‰æ …åŒ–æ²¡æœ‰æ¨¡ç³Šï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Ÿæ±‚å¤§ç¥è§£ç­”ï¼

ç›´æ¥è¦†ç›–ä¸€å¼ ä¸­é—´ä¸ºåœ†å½¢é€æ˜çš„å›¾ç‰‡

    è¿™ç§æ–¹æ³•å°±æ˜¯å¤šåŠ äº†ä¸€å¼ é€æ˜çš„å›¾ç‰‡ï¼ŒGPUè®¡ç®—å¤šå±‚çš„æ··åˆæ¸²æŸ“blendingä¹Ÿæ˜¯ä¼šæ¶ˆè€— ä¸€ç‚¹æ€§èƒ½çš„ï¼Œä½†æ¯”ç¬¬ä¸€ç§æ–¹æ³•è¿˜æ˜¯å¥½ä¸Šå¾ˆå¤šçš„ã€‚

Core Graphicsç»˜åˆ¶åœ†è§’

    è¿™ç§æ–¹å¼æ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯UIButtonä¸Šä¸çŸ¥é“æ€ä¹ˆç»˜åˆ¶ï¼Œå¯ä»¥ç”¨UIimageViewæ·»åŠ ä¸ª ç‚¹å‡»æ‰‹åŠ¿å½“åšUIButtonä½¿ç”¨ã€‚

      UIGraphicsBeginImageContextWithOptions(avatarImageView.bounds.size, NO, [UIScreen mainScreen].scale);
      [[UIBezierPath bezierPathWithRoundedRect:avatarImageView.bounds cornerRadius:50] addClip];
      [image drawInRect:avatarImageView.bounds];
      avatarImageView.image = UIGraphicsGetImageFromCurrentImageContext();
      UIGraphicsEndImageContext();

    è¿™æ®µæ–¹æ³•å¯ä»¥å†™åœ¨SDWebImageçš„completedå›è°ƒé‡Œï¼Œä¹Ÿå¯ä»¥åœ¨UIImageView+WebCache.h é‡Œæ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼ŒisClipRoundåˆ¤æ–­æ˜¯å¦åˆ‡åœ†è§’ï¼ŒæŠŠä¸Šé¢ç»˜åˆ¶åœ†è§’çš„æ–¹æ³•å°è£…åˆ°é‡Œé¢ã€‚

      - (void)sd_setImageWithURL:(NSURL *)url placeholderImage:(UIImage *)placeholder options:(SDWebImageOptions)options isClipRound:(BOOL)isRound progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageCompletionBlock)completedBlock;
</code></pre>

<p>ä½¿ç”¨Instrumentsçš„Core AnimationæŸ¥çœ‹æ€§èƒ½</p>

<pre><code>Color Offscreen-Rendered Yellow

    å¼€å¯åä¼šæŠŠé‚£äº›éœ€è¦ç¦»å±æ¸²æŸ“çš„å›¾å±‚é«˜äº®æˆé»„è‰²ï¼Œè¿™å°±æ„å‘³ç€é»„è‰²å›¾å±‚å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚

Color Hits Green and Misses Red

    å¦‚æœshouldRasterizeè¢«è®¾ç½®æˆYESï¼Œå¯¹åº”çš„æ¸²æŸ“ç»“æœä¼šè¢«ç¼“å­˜ï¼Œå¦‚æœå›¾å±‚æ˜¯ç»¿è‰²ï¼Œå°±è¡¨ç¤ºè¿™äº›ç¼“å­˜è¢«å¤ç”¨ï¼›å¦‚æœæ˜¯çº¢è‰²å°±è¡¨ç¤ºç¼“å­˜ä¼šè¢«é‡å¤åˆ›å»ºï¼Œè¿™å°±è¡¨ç¤ºè¯¥å¤„å­˜åœ¨æ€§èƒ½é—®é¢˜äº†ã€‚
</code></pre>

<p>ç”¨Instrumentsæµ‹è¯•å¾—</p>

<pre><code>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œios9.0ä¹‹å‰UIImageViewå’ŒUIButtonéƒ½é«˜äº®ä¸ºé»„è‰²ã€‚ios9.0ä¹‹ååªæœ‰UIButtoné«˜äº®ä¸ºé»„è‰²ã€‚

ç¬¬äºŒç§æ–¹æ³•UIImageViewå’ŒUIButtonéƒ½é«˜äº®ä¸ºç»¿è‰²ï¼Œä½†UIImageViewåŠ è½½ç½‘ç»œå›¾ç‰‡åä¼šæœ‰ä¸€ç‚¹æ¨¡ç³Š

ç¬¬ä¸‰ç§æ–¹æ³•æ— ä»»ä½•é«˜äº®ï¼Œè¯´æ˜æ²¡ç¦»å±æ¸²æŸ“

ç¬¬å››ç§æ–¹æ³•æ— ä»»ä½•é«˜äº®ï¼Œè¯´æ˜æ²¡ç¦»å±æ¸²æŸ“
</code></pre>

<p>è¿™é‡Œä»¥ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹å¼å®ç°åœ†è§’çš„å¤„ç†</p>

<pre><code>static void addRoundedRectToPath(CGContextRef context, CGRect rect, float ovalWidth,
                                 float ovalHeight)
{
    float fw, fh;
    if (ovalWidth == 0 || ovalHeight == 0) {
        CGContextAddRect(context, rect);
        return;
    }
    CGContextSaveGState(context);
    CGContextTranslateCTM(context, CGRectGetMinX(rect), CGRectGetMinY(rect));
    CGContextScaleCTM(context, ovalWidth, ovalHeight);
    fw = CGRectGetWidth(rect) / ovalWidth;
    fh = CGRectGetHeight(rect) / ovalHeight;
    CGContextMoveToPoint(context, fw, fh/2);  // Start at lower right corner
    CGContextAddArcToPoint(context, fw, fh, fw/2, fh, 1);  // Top right corner
    CGContextAddArcToPoint(context, 0, fh, 0, fh/2, 1); // Top left corner
    CGContextAddArcToPoint(context, 0, 0, fw/2, 0, 1); // Lower left corner
    CGContextAddArcToPoint(context, fw, 0, fw, fh/2, 1); // Back to lower right
    CGContextClosePath(context);
    CGContextRestoreGState(context);
}
+ (id) createRoundedRectImage:(UIImage*)image size:(CGSize)size
{
    // the size of CGContextRef
    int w = size.width;
    int h = size.height;

    UIImage *img = image;
    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
    CGContextRef context = CGBitmapContextCreate(NULL, w, h, 8, 4 * w, colorSpace, kCGImageAlphaPremultipliedFirst);
    CGRect rect = CGRectMake(0, 0, w, h);
    CGContextBeginPath(context);
    addRoundedRectToPath(context, rect, 10, 10);
    CGContextClosePath(context);
    CGContextClip(context);
    CGContextDrawImage(context, CGRectMake(0, 0, w, h), img.CGImage);
    CGImageRef imageMasked = CGBitmapContextCreateImage(context);
    CGContextRelease(context);
    CGColorSpaceRelease(colorSpace);
    return [UIImage imageWithCGImage:imageMasked];
}
</code></pre>

<h2>ç»™å›¾ç‰‡ æ·»åŠ é˜´å½±</h2>

<p>ä¸€ç›´ä»¥æ¥ï¼Œä¸ºIOSæ·»åŠ å›¾ç‰‡çš„ç‰¹æ®Šæ•ˆæœéƒ½æ˜¯é€šè¿‡è·Ÿç¾å·¥çš„é…åˆï¼Œæ¯”å¦‚ï¼Œè¦åŠ é˜´å½±ï¼Œå°±ä»ç¾å·¥é‚£è¾¹è·å¾—ä¸€å¼ é˜´å½±æ•ˆæœå›¾ï¼Œåœ¨ç•Œé¢ä¸Šç”»ä¸¤ä¸ªUIImageViewï¼Œå°†é˜´å½±æ”¾åœ¨ä¸‹é¢ï¼Œå›¾åƒæ”¾ä¸Šä¸Šé¢ï¼Œé”™å¼€ä¸€å®šè§’åº¦ã€‚æœ‰æ¯”å¦‚æƒ³åšåœ†è§’æ•ˆæœï¼Œå°±ç”»ä¸€å¼ è·ŸèƒŒæ™¯ä¸€ä¸ªé¢œè‰²çš„å›¾ç‰‡ï¼Œä¸­é—´é€æ˜ï¼Œç›–åœ¨åŸå›¾ä¸Šæ–¹ã€‚çœ‹èµ·æ¥å¾ˆæ‹™åŠ£ï¼Œæ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï¼Œç›´åˆ°æ„šé’çš„æˆ‘å‘ç°IOSå·²ç»å¸®æˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€åˆ‡ã€‚å…¶å®å°±æ˜¯å‡ è¡Œä»£ç çš„äº‹æƒ…ï¼š</p>

<p>è«‹å…ˆæ·»åŠ åº“ import QuartzCore.framework
ç„¶åè¦å¯¼å…¥å¤´æ–‡ä»¶ #import &lt;QuartzCore/QuartzCore.h></p>

<pre><code>[[myView layer] setShadowOffset:CGSizeMake(5, 5)]; //è®¾ç½®é˜´å½±èµ·ç‚¹ä½ç½®
[[myView layer] setShadowRadius:6];                       //è®¾ç½®é˜´å½±æ‰©æ•£ç¨‹åº¦
[[myView layer] setShadowOpacity:1];                      //è®¾ç½®é˜´å½±é€æ˜åº¦
[[myView layer] setShadowColor:[UIColor blueColor].CGColor]; //è®¾ç½®é˜´å½±é¢œè‰²
 ========== (Four) UIImage å›¾åƒ æ—‹è½¬==================================
- (UIImage *)imageRotatedByRadians:(CGFloat)radians
{
    return [self imageRotatedByDegrees:radians * 180/M_PI];
}
- (UIImage *)imageRotatedByDegrees:(CGFloat)degrees 
{   
    // calculate the size of the rotated view's containing box for our drawing space
    UIView *rotatedViewBox = [[UIView alloc] initWithFrame:CGRectMake(0,0,self.size.width, self.size.height)];
    CGAffineTransform t = CGAffineTransformMakeRotation(degrees * M_PI / 180);
    rotatedViewBox.transform = t;
    CGSize rotatedSize = rotatedViewBox.frame.size;
    [rotatedViewBox release];
    // Create the bitmap context
    UIGraphicsBeginImageContext(rotatedSize);
    CGContextRef bitmap = UIGraphicsGetCurrentContext();
    // Move the origin to the middle of the image so we will rotate and scale around the center.
    CGContextTranslateCTM(bitmap, rotatedSize.width/2, rotatedSize.height/2);

    //   // Rotate the image context
    CGContextRotateCTM(bitmap, degrees * M_PI / 180);
    // Now, draw the rotated/scaled image into the context
    CGContextScaleCTM(bitmap, 1.0, -1.0);
    CGContextDrawImage(bitmap, CGRectMake(-self.size.width / 2, -self.size.height / 2, self.size.width, self.size.height), [self CGImage]);
    UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    return newImage;
}
</code></pre>

<h2>å›¾ç‰‡å‹ç¼©å¤§å°</h2>

<p>å¯¹äºç§»åŠ¨ç«¯çš„Jpgæ–‡ä»¶ï¼Œæœ‰è¿™æ ·çš„ç»“è®ºï¼š</p>

<ul>
<li><p>a.ä½¿ç”¨å¤§å°ºå¯¸å¤§æœ‰æŸå‹ç¼©æ¯”çš„jpg</p></li>
<li><p>b.ä½¿ç”¨jpegtranè¿›è¡Œæ— æŸå‹ç¼©</p></li>
</ul>


<p>è€Œå¯¹äºpngæœ‰ä»¥ä¸‹ç»“è®ºï¼š</p>

<ul>
<li><p>a.å¤šå½©å›¾ç‰‡ä½¿ç”¨png24</p></li>
<li><p>b.ä½å½©å›¾ç‰‡ä½¿ç”¨png8</p></li>
<li><p>c.æ¨èä½¿ç”¨pngquant</p></li>
</ul>


<p>åœ¨Iphoneä¸Šæœ‰ä¸¤ç§è¯»å–å›¾ç‰‡æ•°æ®çš„ç®€å•æ–¹æ³•: UIImageJPEGRepresentationå’ŒUIImagePNGRepresentation.</p>

<ul>
<li><p>UIImageJPEGRepresentationå‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°:å›¾ç‰‡çš„å¼•ç”¨å’Œå‹ç¼©ç³»æ•°.è€ŒUIImagePNGRepresentationåªéœ€è¦å›¾ç‰‡å¼•ç”¨ä½œä¸ºå‚æ•°.é€šè¿‡åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­,æ¯”è¾ƒå‘ç°: UIImagePNGRepresentation(UIImage* image) è¦æ¯”</p></li>
<li><p>UIImageJPEGRepresentation(UIImage<em> image, 1.0) è¿”å›çš„å›¾ç‰‡æ•°æ®é‡å¤§å¾ˆå¤š.è­¬å¦‚,åŒæ ·æ˜¯è¯»å–æ‘„åƒå¤´æ‹æ‘„çš„åŒæ ·æ™¯è‰²çš„ç…§ç‰‡, UIImagePNGRepresentation()è¿”å›çš„æ•°æ®é‡å¤§å°ä¸º199K ,è€Œ UIImageJPEGRepresentation(UIImage</em> image, 1.0)è¿”å›çš„æ•°æ®é‡å¤§å°åªä¸º140KB,æ¯”å‰è€…å°‘äº†50å¤šKB.å¦‚æœå¯¹å›¾ç‰‡çš„æ¸…æ™°åº¦è¦æ±‚ä¸é«˜,è¿˜å¯ä»¥é€šè¿‡è®¾ç½® UIImageJPEGRepresentationå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°,å¤§å¹…åº¦é™ä½å›¾ç‰‡æ•°æ®é‡.è­¬å¦‚,åˆšæ‰æ‹æ‘„çš„å›¾ç‰‡, é€šè¿‡è°ƒç”¨UIImageJPEGRepresentation(UIImage* image, 1.0)è¯»å–æ•°æ®æ—¶,è¿”å›çš„æ•°æ®å¤§å°ä¸º140KB,ä½†æ›´æ”¹å‹ç¼©ç³»æ•°å,é€šè¿‡è°ƒç”¨</p></li>
<li><p>UIImageJPEGRepresentation(UIImage* image, 0.5)è¯»å–æ•°æ®æ—¶,è¿”å›çš„æ•°æ®å¤§å°åªæœ‰11KBå¤š,å¤§å¤§å‹ç¼©äº†å›¾ç‰‡çš„æ•°æ®é‡ ,è€Œä¸”ä»è§†è§’è§’åº¦çœ‹,å›¾ç‰‡çš„è´¨é‡å¹¶æ²¡æœ‰æ˜æ˜¾çš„é™ä½.å› æ­¤,åœ¨è¯»å–å›¾ç‰‡æ•°æ®å†…å®¹æ—¶,å»ºè®®ä¼˜å…ˆä½¿ç”¨UIImageJPEGRepresentation,å¹¶å¯æ ¹æ®è‡ªå·±çš„å®é™…ä½¿ç”¨åœºæ™¯,è®¾ç½®å‹ç¼©ç³»æ•°,è¿›ä¸€æ­¥é™ä½å›¾ç‰‡æ•°æ®é‡å¤§å°.</p></li>
</ul>


<h4>è¿™é‡Œæˆ‘ä»¬ä»¥ä¸€ä¸ªå¸¸ç”¨çš„æ¡†æ¶æ¼”ç¤º</h4>

<p>æåˆ°ä»æ‘„åƒå¤´/ç›¸å†Œè·å–å›¾ç‰‡æ˜¯é¢å‘ç»ˆç«¯ç”¨æˆ·çš„ï¼Œç”±ç”¨æˆ·å»æµè§ˆå¹¶é€‰æ‹©å›¾ç‰‡ä¸ºç¨‹åºä½¿ç”¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦è¿‡UIImagePickerControllerç±»æ¥å’Œç”¨æˆ·äº¤äº’ã€‚
ä½¿ç”¨UIImagePickerControllerå’Œç”¨æˆ·äº¤äº’ï¼Œæˆ‘ä»¬éœ€è¦å®ç°2ä¸ªåè®®&lt;UIImagePickerControllerDelegate,UINavigationControllerDelegate>ã€‚
ä»£ç å¦‚ä¸‹ å¤åˆ¶ä»£ç </p>

<pre><code>#pragma mark ä»ç”¨æˆ·ç›¸å†Œè·å–æ´»åŠ¨å›¾ç‰‡
- (void)pickImageFromAlbum
{
    imagePicker = [[UIImagePickerController alloc] init];
    imagePicker.delegate =self;
    imagePicker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;
    imagePicker.modalTransitionStyle = UIModalTransitionStyleCoverVertical;
    imagePicker.allowsEditing =YES;

    [self presentModalViewController:imagePicker animated:YES];
}
</code></pre>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢çš„ä»ç›¸å†Œè·å–å›¾ç‰‡ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®ä¾‹åŒ–UIImagePickerControllerå¯¹è±¡ï¼Œç„¶åè®¾ç½®imagePickerå¯¹è±¡ä¸ºå½“å‰å¯¹è±¡ï¼Œè®¾ç½®imagePickerçš„å›¾ç‰‡æ¥æºä¸ºUIImagePickerControllerSourceTypePhotoLibraryï¼Œè¡¨æ˜å½“å‰å›¾ç‰‡çš„æ¥æºä¸ºç›¸å†Œï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥è®¾ç½®ç”¨æˆ·å¯¹å›¾ç‰‡æ˜¯å¦å¯ç¼–è¾‘ã€‚
ä»£ç å¦‚ä¸‹ å¤åˆ¶ä»£ç </p>

<pre><code>    #pragma mark ä»æ‘„åƒå¤´è·å–æ´»åŠ¨å›¾ç‰‡
    - (void)pickImageFromCamera
    {
        imagePicker = [[UIImagePickerController alloc] init];
        imagePicker.delegate =self;
        imagePicker.sourceType = UIImagePickerControllerSourceTypeCamera;
        imagePicker.modalTransitionStyle = UIModalTransitionStyleCoverVertical;
        imagePicker.allowsEditing =YES;

        [self presentModalViewController:imagePicker animated:YES];
    }
    //æ‰“å¼€ç›¸æœº
    - (IBAction)touch_photo:(id)sender {
        // for iphone
        UIImagePickerController *pickerImage = [[UIImagePickerController alloc] init];
       if([UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera]) {
            pickerImage.sourceType = UIImagePickerControllerSourceTypeCamera;
            pickerImage.mediaTypes = [UIImagePickerController availableMediaTypesForSourceType:pickerImage.sourceType];

        }
        pickerImage.delegate =self;
        pickerImage.allowsEditing =YES;//è‡ªå®šä¹‰ç…§ç‰‡æ ·å¼
        [self presentViewController:pickerImage animated:YES completion:nil];
    }
</code></pre>

<p>ä»¥ä¸Šæ˜¯ä»æ‘„åƒå¤´è·å–å›¾ç‰‡ï¼Œå’Œä»ç›¸å†Œè·å–å›¾ç‰‡åªæ˜¯å›¾ç‰‡æ¥æºçš„è®¾ç½®ä¸ä¸€æ ·ï¼Œæ‘„åƒå¤´å›¾ç‰‡çš„æ¥æºä¸ºUIImagePickerControllerSourceTypeCameraã€‚
åœ¨å’Œç”¨æˆ·äº¤äº’ä¹‹åï¼Œç”¨æˆ·é€‰æ‹©å¥½å›¾ç‰‡åï¼Œä¼šå›è°ƒé€‰æ‹©ç»“æŸçš„æ–¹æ³•ã€‚</p>

<pre><code>        -(void)imagePickerController:(UIImagePickerController*)picker didFinishPickingMediaWithInfo:(NSDictionary*)info
        {
            //åˆå§‹åŒ–imageNewä¸ºä»ç›¸æœºä¸­è·å¾—çš„--
            UIImage *imageNew = [info objectForKey:@"UIImagePickerControllerOriginalImage"];
            //è®¾ç½®imageçš„å°ºå¯¸
            CGSize imagesize = imageNew.size;
            imagesize.height =626;
            imagesize.width =413;
            //å¯¹å›¾ç‰‡å¤§å°è¿›è¡Œå‹ç¼©--
            imageNew = [self imageWithImage:imageNew scaledToSize:imagesize];
            NSData *imageData = UIImageJPEGRepresentation(imageNew,0.00001);
           if(m_selectImage==nil)
            {
                m_selectImage = [UIImage imageWithData:imageData];
                NSLog(@"m_selectImage:%@",m_selectImage);
                [self.TakePhotoBtn setImage:m_selectImage forState:UIControlStateNormal];
                [picker dismissModalViewControllerAnimated:YES];
               return ;
            }
            [picker release];
        }
        //å¯¹å›¾ç‰‡å°ºå¯¸è¿›è¡Œå‹ç¼©--
        -(UIImage*)imageWithImage:(UIImage*)image scaledToSize:(CGSize)newSize
        {
            // Create a graphics image context
            UIGraphicsBeginImageContext(newSize);

            // Tell the old image to draw in this new context, with the desired
            // new size
            [image drawInRect:CGRectMake(0,0,newSize.width,newSize.height)];

            // Get the new image from the context
            UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();

            // End the context
            UIGraphicsEndImageContext();

            // Return the new image.
           return newImage;
        }
</code></pre>

<h4>ä½ è¿˜å¯ä»¥ä½¿ç”¨ä¸“é—¨çš„å‹ç¼©æ¡†æ¶ï¼ˆZipArchiveï¼‰å®ç°å›¾ç‰‡çš„å‹ç¼©</h4>

<p>å°†ç¬¬ä¸‰æ–¹å€’å…¥åˆ°å·¥ç¨‹ä¸­å°±å¯ä»¥</p>

<p>è°ƒç”¨å¤´æ–‡ä»¶</p>

<pre><code>#import "ZipArchive.h"  
</code></pre>

<p>é¦–å…ˆæ˜¯å‹ç¼©æ–‡ä»¶</p>

<pre><code>- (void)zipFunction  
{  
    zip = [[ZipArchive alloc] init];  
    NSString *documentPath = [self documentsPath];  
    NSString * zipFile = [documentPath stringByAppendingString:@"/images.zip"] ;  

    NSString * image1 = [[NSBundle mainBundle] pathForResource:@"a" ofType:@"jpg" inDirectory:nil];  
    NSString * image2 = [[NSBundle mainBundle] pathForResource:@"b" ofType:@"jpg" inDirectory:nil];  
    BOOL result = [zip CreateZipFile2:zipFile];  
    result = [zip addFileToZip:image1 newname:@"a.jpg"];  
    result = [zip addFileToZip:image2 newname:@"b.jpg"];  
    if( ![zip CloseZipFile2] ){  
        zipFile = @"";  
    }  
    [zip release];  
    NSLog(@"%@",NSHomeDirectory());  
}  
</code></pre>

<p>ç„¶åè§£å‹å‡½æ•°</p>

<pre><code>- (void)unzip  
{  
    zip = [[ZipArchive alloc] init];  
    NSString *documentPath = [self documentsPath];  
    NSString* zipFile = [documentPath stringByAppendingString:@"/images.zip"] ;  
    NSString* unZipTo = [documentPath stringByAppendingString:@"/images"] ;  
    if( [zip UnzipOpenFile:zipFile] ){  
        BOOL result = [zip UnzipFileTo:unZipTo overWrite:YES];  
        if( NO==result ){  
            //æ·»åŠ ä»£ç   
        }  
        [zip UnzipCloseFile];  

        NSString * imageField = [unZipTo stringByAppendingPathComponent:@"a.jpg"];  
        NSData * imagedata = [NSData dataWithContentsOfFile:imageField];  
        UIImage * image = [UIImage imageWithData:imagedata];  

        UIImageView * iamgePic = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 200, 200)];  

        [iamgePic setImage:image];  

        [self.view addSubview:iamgePic];  

    }  
    [zip release];  
}  
</code></pre>

<p>è¿™æ ·å°±æŠŠaå›¾ç‰‡è§£å‹å‡ºæ¥äº†
å¾ˆç®€å•å§ã€‚ã€‚ã€‚ã€‚ã€‚
å‰©ä¸‹çš„å°±æ˜¯è‡ªå·±è°ƒç”¨äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>

<h3>æŠŠä¸€å¼ å›¾ç‰‡å‹ç¼©å¹¶æˆªå–ä¸­é—´éƒ¨åˆ†</h3>

<pre><code>//è¿™ä¸ªæ–¹æ³•æ˜¯æŠŠä¸€å¼ UIImageå‹ç¼©æˆnewSizeçš„å°ºå¯¸

-(UIImage*)imageWithImageSimple:(UIImage*)image scaledToSize:(CGSize)newSize

{

    UIGraphicsBeginImageContext(newSize);

    [image drawInRect:CGRectMake(0,0,newSize.width,newSize.height)];

    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();

    UIGraphicsEndImageContext();

    return newImage;

}
</code></pre>

<ul>
<li><p>æˆªå–ä¸­é—´éƒ¨åˆ†</p>

<pre><code>  - (UIImage *)scaleImage:(UIImage *)image toScale:(CGSize)reSize

  {

  //å…ˆæŒ‰è¦æ˜¾ç¤ºçš„å¤§å°å»æ¯”ä¾‹ç¼©æ”¾ä¸‹å›¾ç‰‡ï¼Œè¿™é‡Œå‹ç¼©æˆ245*245çš„å¤§å°

  UIImage *scaledImage = [self imageWithImageSimple:image scaledToSize:CGSizeMake(245, 245)];

  //è®¡ç®—æˆªå–ä½ç½®ã€‚è¿™é‡Œæˆ‘ä»¬è€ƒè™‘ä¸€èˆ¬æ‹ç…§è¾¹ç•Œä½ç½®å¯èƒ½å­˜åœ¨å…¨ç™½æˆ–å…¨é»‘çš„æƒ…å†µï¼Œå¤šæ•°é‡è¦çš„ä¼šåœ¨ä¸­é—´ä½ç½®ã€‚æ‰€ä»¥è®¡ç®—ä¸‹æˆªå–æ˜¯é‡ç»˜å›¾ç‰‡çš„ä¸­é—´ä½ç½®

  float drawW = 0.0;

  float drawH = 0.0;

  CGSize size_new = scaledImage.size;

  if (size_new.width &gt; reSize.width) {

      drawW = (size_new.width - reSize.width)/2.0;

  }

  if (size_new.height &gt; reSize.height) {

      drawH = (size_new.height - reSize.height)/2.0;

  }

  NSLog(@"drawW=====w==%f\n--------drawH==%f\n\n",drawW,drawH);    

  //æˆªå–æˆªå–å¤§å°ä¸ºéœ€è¦æ˜¾ç¤ºçš„å¤§å°ã€‚å–å›¾ç‰‡ä¸­é—´ä½ç½®æˆªå–

  CGRect myImageRect = CGRectMake(drawW, drawH, reSize.width, reSize.height);

  UIImage* bigImage= scaledImage;

  scaledImage = nil;

  CGImageRef imageRef = bigImage.CGImage;

  CGImageRef subImageRef = CGImageCreateWithImageInRect(imageRef, myImageRect);



  UIGraphicsBeginImageContext(reSize);

  CGContextRef context = UIGraphicsGetCurrentContext();

  CGContextDrawImage(context, myImageRect, subImageRef);

  UIImage* smallImage = [UIImage imageWithCGImage:subImageRef];

  UIGraphicsEndImageContext();

  CGImageRelease(subImageRef);

  return smallImage;
</code></pre>

<p>  }</p></li>
</ul>


<h4>æˆ‘è¿˜çœ‹åˆ°æœ‰äººè¿™ä¹ˆåšè¿‡</h4>

<ul>
<li>æ–¹æ³•ä¸€ï¼šå°†å›¾ç‰‡æŒ‰ç…§åŸæ¥çš„å®½é«˜æ¯”ä¾‹å‹ç¼©åˆ°ä¸çª—å£åˆé€‚çš„å¤§å°ï¼Œç„¶ååœ¨è®¾ç½®äº†_imageView.contentMode = UIViewContentModeCenter;</li>
</ul>


<p>è¿™ä¸ªå±æ€§çš„UIImageViewä¸­å±•ç¤ºå‹ç¼©åçš„å›¾ç‰‡ã€‚</p>

<pre><code>//å‹ç¼©å›¾ç‰‡  
- (UIImage *)image:(UIImage*)image scaledToSize:(CGSize)newSize  
{  
    // Create a graphics image context  
    UIGraphicsBeginImageContext(newSize);  
    // Tell the old image to draw in this new context, with the desired  
    // new size  
    [image drawInRect:CGRectMake(0,0,newSize.width,newSize.height)];  
    // Get the new image from the context  
    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();  
    // End the context  
    UIGraphicsEndImageContext();  
    // Return the new image.  
    return newImage;  
}  
</code></pre>

<p>ä¸Šé¢æ–¹æ³•çš„å‚æ•°newSizeæ˜¯å’Œå›¾ç‰‡æ˜¾ç¤ºçª—å£å·®ä¸å¤šå¤§çš„ï¼Œç»“æœå‡ºç°äº†åŸå›¾æ¸…æ™°ï¼Œä½†å‹ç¼©åå›¾ç‰‡ä¸æ¸…æ™°çš„æƒ…å†µã€‚</p>

<ul>
<li><p>æ–¹æ³•äºŒï¼šæŒ‰ç…§çª—å£å®½é«˜æ¯”ä¾‹ï¼Œå°†åŸå›¾æ¨ªå‘æˆ–è€…çºµå‘è£å‰ªæ‰å¤šä½™çš„éƒ¨åˆ†ï¼Œç„¶åä¸è®¾ç½®UIImageViewçš„contentModeå±æ€§ï¼Œå°†è£å‰ªåçš„å›¾ç‰‡é€è¿›å»ï¼Œä½¿å…¶è‡ªåŠ¨é€‚åº”çª—å£ã€‚
ç¼©æ”¾æ•ˆæœçš„ä»£ç å¦‚ä¸‹</p>

<pre><code>  //è£å‰ªå›¾ç‰‡  
  - (UIImage *)cutImage:(UIImage*)image  
  {  
      //å‹ç¼©å›¾ç‰‡  
      CGSize newSize;  
      CGImageRef imageRef = nil;  

      if ((image.size.width / image.size.height) &lt; (_headerView.bgImgView.size.width / _headerView.bgImgView.size.height)) {  
          newSize.width = image.size.width;  
          newSize.height = image.size.width * _headerView.bgImgView.size.height / _headerView.bgImgView.size.width;  

          imageRef = CGImageCreateWithImageInRect([image CGImage], CGRectMake(0, fabs(image.size.height - newSize.height) / 2, newSize.width, newSize.height));  

      } else {  
          newSize.height = image.size.height;  
          newSize.width = image.size.height * _headerView.bgImgView.size.width / _headerView.bgImgView.size.height;  

          imageRef = CGImageCreateWithImageInRect([image CGImage], CGRectMake(fabs(image.size.width - newSize.width) / 2, 0, newSize.width, newSize.height));  

      }  

      return [UIImage imageWithCGImage:imageRef];  
  }  
</code></pre></li>
</ul>


<h2>å›¾ç‰‡æ ¼å¼çš„è½¬æ¢</h2>

<p>å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°documenté‡Œé¢&ndash;ä»¥åŠå›¾ç‰‡æ ¼å¼çš„è½¬æ¢
IOSå¼€å‘ä¹‹ä¿å­˜å›¾ç‰‡åˆ°Documentsç›®å½•åŠPNGï¼ŒJPEGæ ¼å¼ç›¸äº’è½¬æ¢</p>

<pre><code>    - (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary*)info {
        NSString *mediaType = [info objectForKey:UIImagePickerControllerMediaType];
        if ([mediaType isEqualToString:@"public.image"]){
            image = [info objectForKey:@"UIImagePickerControllerOriginalImage"];
            NSData *data;
            if (UIImagePNGRepresentation(image) == nil) {
                data = UIImageJPEGRepresentation(image, 1);
            } else {
                data = UIImagePNGRepresentation(image);
            }

        NSFileManager *fileManager = [NSFileManager defaultManager];
        NSString *filePath = [NSString stringWithString:[self getPath:@"image1"]];         //å°†å›¾ç‰‡å­˜å‚¨åˆ°æœ¬åœ°documents
         [fileManager createDirectoryAtPath:filePath withIntermediateDirectories:YES attributes:nil error:nil];
         [fileManager createFileAtPath:[filePath stringByAppendingString:@"/image.png"] contents:dataattributes:nil];

        UIImage *editedImage = [[UIImage alloc] init];
        editedImage = image;
        CGRect rect = CGRectMake(0, 0, 64, 96);
        UIGraphicsBeginImageContext(rect.size);
        [editedImage drawInRect:rect];
        editedImage = UIGraphicsGetImageFromCurrentImageContext();

        UIButton *imageButton = [UIButton buttonWithType:UIButtonTypeCustom];
        imageButton.frame = CGRectMake(10, 10, 64, 96);
        [imageButton setImage:editedImage forState:UIControlStateNormal];
        [self.view addSubview:imageButton];
        [imageButton addTarget:self action:@selector(imageAction:)forControlEvents:UIControlEventTouchUpInside];
        [ipc dismissModalViewControllerAnimated:YES];
    } else {
        NSLog(@"MEdia");
    }
</code></pre>

<p>ä¸Šé¢çš„ä»£ç æ˜¯å½“ä»ç›¸å†Œé‡Œé¢é€‰å–å›¾ç‰‡ä¹‹åä¿å­˜åˆ°æœ¬åœ°ç¨‹åºæ²™ç›’ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬å¾—åˆ°çš„å›¾ç‰‡ä¸­ä¸èƒ½å¤Ÿå¾—åˆ°å›¾ç‰‡åå­—ï¼Œ
ä»¥åŠä¸æ¸…æ¥šå›¾ç‰‡æ ¼å¼ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢æˆNSdataäºŒè¿›åˆ¶å­˜å‚¨ï¼Œ</p>

<pre><code> image = [info objectForKey:@"UIImagePickerControllerOriginalImage"];
NSData *data;
        if (UIImagePNGRepresentation(image) == nil) {
            data = UIImageJPEGRepresentation(image, 1);
        } else {
            data = UIImagePNGRepresentation(image);
        }
UIImagePNGRepresentationè½¬æ¢PNGæ ¼å¼çš„å›¾ç‰‡ä¸ºäºŒè¿›åˆ¶ï¼Œå¦‚æœå›¾ç‰‡çš„æ ¼å¼ä¸ºJPEGåˆ™è¿”å›nilï¼›
 [fileManager createFileAtPath:[filePath stringByAppendingString:@"/image.png"] contents:data attributes:nil];    å°†å›¾ç‰‡ä¿å­˜ä¸ºPNGæ ¼å¼
 [fileManager createFileAtPath:[filePath stringByAppendingString:@"/image.jpg"] contents:data attributes:nil];   å°†å›¾ç‰‡ä¿å­˜ä¸ºJPEGæ ¼å¼
æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™æˆä¸‹é¢çš„æ ¼å¼å­˜å‚¨å›¾ç‰‡
NSString *pngImage = [filePath stringByAppendingPathComponent:@"Documents/image.png"];
NSString *jpgImage = [filePath stringByAppendingPathComponent:@"Documents/image.jpg"];
[data writeToFile:pngImage atomically:YES];
[data writeToFile:jpgImage atomically:YES];
</code></pre>

<h2>å›¾ç‰‡ä¿å­˜&amp;ä¸Šä¼ </h2>

<p>ä¿å­˜ï¼š</p>

<pre><code>- (void)saveImage:(UIImage *)tempImage WithName:(NSString *)imageName

ã€€ã€€{

ã€€ã€€NSData* imageData = UIImagePNGRepresentation(tempImage);

ã€€ã€€NSArray* paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);

ã€€ã€€NSString* documentsDirectory = [paths objectAtIndex:0];

ã€€ã€€// Now we get the full path to the file

ã€€ã€€NSString* fullPathToFile = [documentsDirectory stringByAppendingPathComponent:imageName];

ã€€ã€€// and then we write it out

ã€€ã€€[imageData writeToFile:fullPathToFile atomically:NO];

ã€€ã€€}
</code></pre>

<p>ä¸Šä¼ ï¼š</p>

<pre><code>- (void) imageUpload:(UIImage *) image{

//æŠŠå›¾ç‰‡è½¬æ¢æˆimageDateæ ¼å¼

NSData *imageData = UIImageJPEGRepresentation(image, 1.0);

//ä¼ é€è·¯å¾„

NSString *urlString = @"http://ï¼Šï¼Šï¼Šï¼Šï¼Š/test/upload.php";

//å»ºç«‹è¯·æ±‚å¯¹è±¡

NSMutableURLRequest * request = [[NSMutableURLRequest alloc] init];

//è®¾ç½®è¯·æ±‚è·¯å¾„

[request setURL:[NSURL URLWithString:urlString]];

//è¯·æ±‚æ–¹å¼

[request setHTTPMethod:@"POST"];

//ä¸€è¿ä¸²ä¸Šä¼ å¤´æ ‡ç­¾

NSString *boundary = [NSString stringWithString:@"---------------------------14737809831466499882746641449"];

NSString *contentType = [NSString stringWithFormat:@"multipart/form-data; boundary=%@",boundary];

[request addValue:contentType forHTTPHeaderField: @"Content-Type"];

NSMutableData *body = [NSMutableData data];

[body appendData:[[NSString stringWithFormat:@"\r\n--%@\r\n",boundary]dataUsingEncoding:NSUTF8StringEncoding]];

[body appendData:[[NSString stringWithString:@"Content-Disposition: form-data; name="userfile"; filename="vim_go.jpg"\r\n"] dataUsingEncoding:NSUTF8StringEncoding]];

[body appendData:[[NSString stringWithString:@"Content-Type: application/octet-stream\r\n\r\n"]dataUsingEncoding:NSUTF8StringEncoding]];

[body appendData:[NSData dataWithData:imageData]];

[body appendData:[[NSString stringWithFormat:@"\r\n--%@--\r\n",boundary]dataUsingEncoding:NSUTF8StringEncoding]];

[request setHTTPBody:body];

//ä¸Šä¼ æ–‡ä»¶å¼€å§‹

NSData *returnData = [NSURLConnection sendSynchronousRequest:request returningResponse:nil error:nil];

//è·å¾—è¿”å›å€¼

NSString *returnString = [[NSString alloc] initWithData:returnData encoding:NSUTF8StringEncoding];

NSLog(@"%@",returnString);

}
</code></pre>

<hr />

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="/images/iCocosPublic.jpg" title="Caption" ></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">iCocos</span></span>

      




<time class='entry-date' datetime='2016-01-14T09:21:08+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:21 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/performance/'>performance</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/01/11/ffmpeg-kxmovies/" title="Previous Post: ffmpeg+kxmovie">&laquo; ffmpeg+kxmovie</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/01/14/tupianchuligaojijiqiao/" title="Next Post: å›¾ç‰‡å¤„ç†-é«˜çº§ç¯‡">å›¾ç‰‡å¤„ç†-é«˜çº§ç¯‡ &raquo;</a>
      
    </p>
  </footer>
</article>



  <section>
    <h1>Comments</h1>
    <div id="comments" aria-live="polite"><!-- Duoshuo Comment BEGIN -->
<div class="ds-thread" data-title="å›¾ç‰‡å¤„ç†-å¸¸ç”¨æŠ€å·§"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"icocoscao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END --></div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
    <h1>æ–‡ç« åˆ†ç±»</h1>
    <ul id="categories">
        <li class='category'><a href='/blog/categories/algorithms/'>algorithms (6)</a></li>
<li class='category'><a href='/blog/categories/and/'>and (14)</a></li>
<li class='category'><a href='/blog/categories/apples/'>apples (2)</a></li>
<li class='category'><a href='/blog/categories/application/'>application (1)</a></li>
<li class='category'><a href='/blog/categories/architecture/'>architecture (2)</a></li>
<li class='category'><a href='/blog/categories/audio/'>audio (8)</a></li>
<li class='category'><a href='/blog/categories/audio-video/'>audio-video (1)</a></li>
<li class='category'><a href='/blog/categories/data/'>data (6)</a></li>
<li class='category'><a href='/blog/categories/developer/'>developer (16)</a></li>
<li class='category'><a href='/blog/categories/foundation/'>foundation (31)</a></li>
<li class='category'><a href='/blog/categories/full/'>full (13)</a></li>
<li class='category'><a href='/blog/categories/low-level/'>low-level (4)</a></li>
<li class='category'><a href='/blog/categories/lve/'>lve (8)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (4)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (1)</a></li>
<li class='category'><a href='/blog/categories/performance/'>performance (12)</a></li>
<li class='category'><a href='/blog/categories/php-lover/'>php-lover (2)</a></li>
<li class='category'><a href='/blog/categories/practical/'>practical (1)</a></li>
<li class='category'><a href='/blog/categories/radio/'>radio (8)</a></li>
<li class='category'><a href='/blog/categories/reverse/'>reverse (7)</a></li>
<li class='category'><a href='/blog/categories/senior/'>senior (31)</a></li>
<li class='category'><a href='/blog/categories/stack/'>stack (13)</a></li>
<li class='category'><a href='/blog/categories/structures/'>structures (6)</a></li>
<li class='category'><a href='/blog/categories/summarize/'>summarize (5)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (5)</a></li>
<li class='category'><a href='/blog/categories/video/'>video (8)</a></li>

    </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/12/03/phpwan-mei-da-pei-mysql/">PHPå®Œç¾æ­é…ä¹‹Mysqlåˆæ¢</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/02/zhong-zheng-linux/">é‡æ•´Linuxä¸€æ¬¡å°±å¤Ÿäº†</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/01/wan-zhuan-thinkphp-5-dot-star/">å®Œè™ThinkPHP 5.* è¿œä¸æ­¢è¿™äº›ğŸ˜±ğŸ˜‚</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/13/wan-nue-yiicong-zhe-li-kai-shi/">å®Œè™Yiiä»è¿™é‡Œå¼€å§‹ğŸ˜±ğŸ˜‚</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/20/apptai-pang-liao-jian-fei/">Appå¤ªèƒ–äº†â€”â€”å‡è‚¥ğŸ˜‚</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/al1020119">@al1020119</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'al1020119',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





<section>
<h1>åšå®¢<abbr title="The word 'åšå®¢' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'åšå®¢', not for image.">&trade;</abbr></h1>
<a href="http://al1020119.github.io/blog/2016/01/14/tupianchulichangyongjiqiao/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://al1020119.github.io/blog/2016/01/14/tupianchulichangyongjiqiao/" alt="post-qrcode"></a></section>


<section>
<h1>github<abbr title="The word 'github' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'github', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosgithub.png" alt="post-qrcode"></a></section>


<section>
<h1>å¾®ä¿¡<abbr title="The word 'å¾®ä¿¡' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å¾®ä¿¡', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosWX.png" alt="post-qrcode"></a></section>


<section>
<h1>å…¬ä¼—å·<abbr title="The word 'å…¬ä¼—å·' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å…¬ä¼—å·', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocosMGC.png" alt="post-qrcode"></a><section>
  
  
</section>
<h1>å…¬ä¼—å·<abbr title="The word 'å…¬ä¼—å·' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'å…¬ä¼—å·', not for image.">&trade;</abbr></h1>
<a><img src="/images/iCocos520.png" alt="post-qrcode"></a></section>
<section>
    <h1>è®¿å®¢ç»Ÿè®¡</h1>
    <br/>
    <a href="http://s07.flagcounter.com/more/2SH"><img src="http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
</section><section>
    <h1>æ–°æµªå¾®åš</h1>
    <ul id="weibo">
        <li>
            
            <!-- åœ¨æ­¤æ’å…¥è·å¾—çš„å¾®åšç§€ä»£ç  -->
            <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3288975567&verifier=20ffcedd&dpc=1"></iframe>
            
        </li>
    </ul>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - iCocos -
<span class="credit">welcome to <a href="http://al1020119.github.io">æ›¹#é»</a></span>
</p>

</footer>
  






<!--
-->



</body>
</html>
