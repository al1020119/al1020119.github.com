<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[iOSæ¢¦å·¥å‚]]></title>
  <link href="http://al1020119.github.io/atom.xml" rel="self"/>
  <link href="http://al1020119.github.io/"/>
  <updated>2016-08-31T12:42:00+08:00</updated>
  <id>http://al1020119.github.io/</id>
  <author>
    <name><![CDATA[iCocos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[å¤šçº¿ç¨‹å®‰å…¨ï¼Ÿåº”è¯¥ä¸æ­¢è¿™äº›ğŸ˜‚ï¼]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/31/duo-xian-cheng-an-quan-%3Fying-gai-bu-zhi-zhe-xie-%3F!/"/>
    <updated>2016-08-31T12:33:27+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/31/duo-xian-cheng-an-quan-?ying-gai-bu-zhi-zhe-xie-?!</id>
    <content type="html"><![CDATA[<ul>
<li>å‰è¨€</li>
<li>ä»‹ç»ä¸ä½¿ç”¨</li>
<li>æ€»ç»“</li>
<li>å…¶ä»–å®æˆ˜ä½¿ç”¨</li>
</ul>


<h2>ä¸€ã€å‰è¨€</h2>

<p>å‰æ®µæ—¶é—´çœ‹äº†å‡ ä¸ªå¼€æºé¡¹ç›®ï¼Œå‘ç°ä»–ä»¬ä¿æŒçº¿ç¨‹åŒæ­¥çš„æ–¹å¼å„ä¸ç›¸åŒï¼Œæœ‰@synchronizedã€NSLockã€dispatch_semaphoreã€NSConditionã€pthread_mutexã€OSSpinLockã€‚åæ¥ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°ä»–ä»¬çš„å®ç°æœºåˆ¶å„ä¸ç›¸åŒï¼Œæ€§èƒ½ä¹Ÿå„ä¸ä¸€æ ·ã€‚ä¸å¥½æ„æ€ï¼Œæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨æœ€å¤šçš„@synchronizedæ˜¯æ€§èƒ½æœ€å·®çš„ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆåˆ†åˆ«ä»‹ç»æ¯ä¸ªåŠ é”æ–¹å¼çš„ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥å¯¹ä»–ä»¬è¿›è¡Œæ€§èƒ½å¯¹æ¯”ã€‚</p>

<h2>äºŒã€ä»‹ç»ä¸ä½¿ç”¨</h2>

<!--more-->


<h4>2.1ã€@synchronized</h4>

<pre><code>    NSObject *obj = [[NSObject alloc] init];



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        @synchronized(obj) {

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");

            sleep(3);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");

        }

    });



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        sleep(1);

        @synchronized(obj) {

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2");

        }

    });
</code></pre>

<p>@synchronized(obj)æŒ‡ä»¤ä½¿ç”¨çš„objä¸ºè¯¥é”çš„å”¯ä¸€æ ‡è¯†ï¼Œåªæœ‰å½“æ ‡è¯†ç›¸åŒæ—¶ï¼Œæ‰ä¸ºæ»¡è¶³äº’æ–¥ï¼Œå¦‚æœçº¿ç¨‹2ä¸­çš„@synchronized(obj)æ”¹ä¸º@synchronized(self),åˆšçº¿ç¨‹2å°±ä¸ä¼šè¢«é˜»å¡ï¼Œ@synchronizedæŒ‡ä»¤å®ç°é”çš„ä¼˜ç‚¹å°±æ˜¯æˆ‘ä»¬ä¸éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼çš„åˆ›å»ºé”å¯¹è±¡ï¼Œä¾¿å¯ä»¥å®ç°é”çš„æœºåˆ¶ï¼Œä½†ä½œä¸ºä¸€ç§é¢„é˜²æªæ–½ï¼Œ@synchronizedå—ä¼šéšå¼çš„æ·»åŠ ä¸€ä¸ªå¼‚å¸¸å¤„ç†ä¾‹ç¨‹æ¥ä¿æŠ¤ä»£ç ï¼Œè¯¥å¤„ç†ä¾‹ç¨‹ä¼šåœ¨å¼‚å¸¸æŠ›å‡ºçš„æ—¶å€™è‡ªåŠ¨çš„é‡Šæ”¾äº’æ–¥é”ã€‚æ‰€ä»¥å¦‚æœä¸æƒ³è®©éšå¼çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹å¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨é”å¯¹è±¡ã€‚</p>

<p>ä¸Šé¢ç»“æœçš„æ‰§è¡Œç»“æœä¸ºï¼š</p>

<pre><code>2016-06-29 20:48:35.747 SafeMultiThread[35945:580107] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹

2016-06-29 20:48:38.748 SafeMultiThread[35945:580107] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ

2016-06-29 20:48:38.749 SafeMultiThread[35945:580118] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2
</code></pre>

<h4>2.2ã€dispatch_semaphore</h4>

<pre><code>dispatch_semaphore_t signal = dispatch_semaphore_create(1);

    dispatch_time_t overTime = dispatch_time(DISPATCH_TIME_NOW, 3 * NSEC_PER_SEC);



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        dispatch_semaphore_wait(signal, overTime);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");

            sleep(2);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");

        dispatch_semaphore_signal(signal);

    });



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        sleep(1);

        dispatch_semaphore_wait(signal, overTime);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2");

        dispatch_semaphore_signal(signal);

    });
</code></pre>

<p>dispatch_semaphoreæ˜¯GCDç”¨æ¥åŒæ­¥çš„ä¸€ç§æ–¹å¼ï¼Œä¸ä»–ç›¸å…³çš„å…±æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯dispatch_semaphore_createï¼Œdispatch_semaphore_signalï¼Œdispatch_semaphore_waitã€‚</p>

<h6>ï¼ˆ1ï¼‰dispatch_semaphore_createçš„å£°æ˜ä¸ºï¼š</h6>

<pre><code>dispatch_semaphore_t dispatch_semaphore_create(long value);
</code></pre>

<p>ä¼ å…¥çš„å‚æ•°ä¸ºlongï¼Œè¾“å‡ºä¸€ä¸ªdispatch_semaphore_tç±»å‹ä¸”å€¼ä¸ºvalueçš„ä¿¡å·é‡ã€‚</p>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ä¼ å…¥çš„å‚æ•°valueå¿…é¡»å¤§äºæˆ–ç­‰äº0ï¼Œå¦åˆ™dispatch_semaphore_createä¼šè¿”å›NULLã€‚</p>

<h6>ï¼ˆ2ï¼‰dispatch_semaphore_signalçš„å£°æ˜ä¸ºï¼š</h6>

<pre><code>long dispatch_semaphore_signal(dispatch_semaphore_t dsema)
</code></pre>

<p>è¿™ä¸ªå‡½æ•°ä¼šä½¿ä¼ å…¥çš„ä¿¡å·é‡dsemaçš„å€¼åŠ 1ï¼›</p>

<h6>(3) dispatch_semaphore_waitçš„å£°æ˜ä¸ºï¼š</h6>

<pre><code>long dispatch_semaphore_wait(dispatch_semaphore_t dsema, dispatch_time_t timeout)ï¼›
</code></pre>

<p>è¿™ä¸ªå‡½æ•°ä¼šä½¿ä¼ å…¥çš„ä¿¡å·é‡dsemaçš„å€¼å‡1ï¼›è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœdsemaä¿¡å·é‡çš„å€¼å¤§äº0ï¼Œè¯¥å‡½æ•°æ‰€å¤„çº¿ç¨‹å°±ç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œå¹¶ä¸”å°†ä¿¡å·é‡çš„å€¼å‡1ï¼›å¦‚æœdesemaçš„å€¼ä¸º0ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±é˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…timeoutï¼ˆæ³¨æ„timeoutçš„ç±»å‹ä¸ºdispatch_time_tï¼Œä¸èƒ½ç›´æ¥ä¼ å…¥æ•´å½¢æˆ–floatå‹æ•°ï¼‰ï¼Œå¦‚æœç­‰å¾…çš„æœŸé—´desemaçš„å€¼è¢«dispatch_semaphore_signalå‡½æ•°åŠ 1äº†ï¼Œä¸”è¯¥å‡½æ•°ï¼ˆå³dispatch_semaphore_waitï¼‰æ‰€å¤„çº¿ç¨‹è·å¾—äº†ä¿¡å·é‡ï¼Œé‚£ä¹ˆå°±ç»§ç»­å‘ä¸‹æ‰§è¡Œå¹¶å°†ä¿¡å·é‡å‡1ã€‚å¦‚æœç­‰å¾…æœŸé—´æ²¡æœ‰è·å–åˆ°ä¿¡å·é‡æˆ–è€…ä¿¡å·é‡çš„å€¼ä¸€ç›´ä¸º0ï¼Œé‚£ä¹ˆç­‰åˆ°timeoutæ—¶ï¼Œå…¶æ‰€å¤„çº¿ç¨‹è‡ªåŠ¨æ‰§è¡Œå…¶åè¯­å¥ã€‚</p>

<p>dispatch_semaphore æ˜¯ä¿¡å·é‡ï¼Œä½†å½“ä¿¡å·æ€»é‡è®¾ä¸º 1 æ—¶ä¹Ÿå¯ä»¥å½“ä½œé”æ¥ã€‚åœ¨æ²¡æœ‰ç­‰å¾…æƒ…å†µå‡ºç°æ—¶ï¼Œå®ƒçš„æ€§èƒ½æ¯” pthread_mutex è¿˜è¦é«˜ï¼Œä½†ä¸€æ—¦æœ‰ç­‰å¾…æƒ…å†µå‡ºç°æ—¶ï¼Œæ€§èƒ½å°±ä¼šä¸‹é™è®¸å¤šã€‚ç›¸å¯¹äº OSSpinLock æ¥è¯´ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äºç­‰å¾…æ—¶ä¸ä¼šæ¶ˆè€— CPU èµ„æºã€‚</p>

<p>å¦‚ä¸Šçš„ä»£ç ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´overTimeè®¾ç½®æˆ>2ï¼Œå¯å®ŒæˆåŒæ­¥æ“ä½œã€‚å¦‚æœoverTime</p>

<p>ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœä¸ºï¼š</p>

<pre><code>2016-06-29 20:47:52.324 SafeMultiThread[35945:579032] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹

2016-06-29 20:47:55.325 SafeMultiThread[35945:579032] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ

2016-06-29 20:47:55.326 SafeMultiThread[35945:579033] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2
</code></pre>

<p>å¦‚æœæŠŠè¶…æ—¶æ—¶é—´è®¾ç½®ä¸º</p>

<pre><code>2016-06-30 18:53:24.049 SafeMultiThread[30834:434334] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹

2016-06-30 18:53:25.554 SafeMultiThread[30834:434332] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2

2016-06-30 18:53:26.054 SafeMultiThread[30834:434334] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ
</code></pre>

<h4>2.3ã€NSLock</h4>

<pre><code>   NSLock *lock = [[NSLock alloc] init];

    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        //[lock lock];

        [lock lockBeforeDate:[NSDate date]];

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");

            sleep(2);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");

        [lock unlock];



    });



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        sleep(1);

        if ([lock tryLock]) {//å°è¯•è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°è¿”å›NOï¼Œä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹

            NSLog(@"é”å¯ç”¨çš„æ“ä½œ");

            [lock unlock];

        }else{

            NSLog(@"é”ä¸å¯ç”¨çš„æ“ä½œ");

        }



        NSDate *date = [[NSDate alloc] initWithTimeIntervalSinceNow:3];

        if ([lock lockBeforeDate:date]) {//å°è¯•åœ¨æœªæ¥çš„3så†…è·å–é”ï¼Œå¹¶é˜»å¡è¯¥çº¿ç¨‹ï¼Œå¦‚æœ3så†…è·å–ä¸åˆ°æ¢å¤çº¿ç¨‹, è¿”å›NO,ä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹

            NSLog(@"æ²¡æœ‰è¶…æ—¶ï¼Œè·å¾—é”");

            [lock unlock];

        }else{

            NSLog(@"è¶…æ—¶ï¼Œæ²¡æœ‰è·å¾—é”");

        }



    });
</code></pre>

<p>NSLockæ˜¯Cocoaæä¾›ç»™æˆ‘ä»¬æœ€åŸºæœ¬çš„é”å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸æ‰€ä½¿ç”¨çš„ï¼Œé™¤lockå’Œunlockæ–¹æ³•å¤–ï¼ŒNSLockè¿˜æä¾›äº†tryLockå’ŒlockBeforeDate:ä¸¤ä¸ªæ–¹æ³•ï¼Œå‰ä¸€ä¸ªæ–¹æ³•ä¼šå°è¯•åŠ é”ï¼Œå¦‚æœé”ä¸å¯ç”¨(å·²ç»è¢«é”ä½)ï¼Œåˆšå¹¶ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¹¶è¿”å›NOã€‚lockBeforeDate:æ–¹æ³•ä¼šåœ¨æ‰€æŒ‡å®šDateä¹‹å‰å°è¯•åŠ é”ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰éƒ½ä¸èƒ½åŠ é”ï¼Œåˆ™è¿”å›NOã€‚</p>

<p>ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœä¸ºï¼š</p>

<pre><code>2016-06-29 20:45:08.864 SafeMultiThread[35911:575795] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹

2016-06-29 20:45:09.869 SafeMultiThread[35911:575781] é”ä¸å¯ç”¨çš„æ“ä½œ

2016-06-29 20:45:10.869 SafeMultiThread[35911:575795] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ

2016-06-29 20:45:10.870 SafeMultiThread[35911:575781] æ²¡æœ‰è¶…æ—¶ï¼Œè·å¾—é”
</code></pre>

<p>æºç å®šä¹‰å¦‚ä¸‹ï¼š</p>

<pre><code>@protocol NSLocking



- (void)lock;

- (void)unlock;



@end



@interface NSLock : NSObject  {

&lt;a href="http://www.jobbole.com/members/kaishu6296"&gt;@private&lt;/a&gt;

    void *_priv;

}



- (BOOL)tryLock;

- (BOOL)lockBeforeDate:(NSDate *)limit;



@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);



@end
</code></pre>

<h4>2.4ã€NSRecursiveLocké€’å½’é”</h4>

<pre><code>    //NSLock *lock = [[NSLock alloc] init];

    NSRecursiveLock *lock = [[NSRecursiveLock alloc] init];



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{



        static void (^RecursiveMethod)(int);



        RecursiveMethod = ^(int value) {



            [lock lock];

            if (value &gt; 0) {



                NSLog(@"value = %d", value);

                sleep(1);

                RecursiveMethod(value - 1);

            }

            [lock unlock];

        };



        RecursiveMethod(5);

    });
</code></pre>

<p>NSRecursiveLockå®é™…ä¸Šå®šä¹‰çš„æ˜¯ä¸€ä¸ªé€’å½’é”ï¼Œè¿™ä¸ªé”å¯ä»¥è¢«åŒä¸€çº¿ç¨‹å¤šæ¬¡è¯·æ±‚ï¼Œè€Œä¸ä¼šå¼•èµ·æ­»é”ã€‚è¿™ä¸»è¦æ˜¯ç”¨åœ¨å¾ªç¯æˆ–é€’å½’æ“ä½œä¸­ã€‚</p>

<p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªå…¸å‹çš„æ­»é”æƒ…å†µã€‚åœ¨æˆ‘ä»¬çš„çº¿ç¨‹ä¸­ï¼ŒRecursiveMethodæ˜¯é€’å½’è°ƒç”¨çš„ã€‚æ‰€ä»¥æ¯æ¬¡è¿›å…¥è¿™ä¸ªblockæ—¶ï¼Œéƒ½ä¼šå»åŠ ä¸€æ¬¡é”ï¼Œè€Œä»ç¬¬äºŒæ¬¡å¼€å§‹ï¼Œç”±äºé”å·²ç»è¢«ä½¿ç”¨äº†ä¸”æ²¡æœ‰è§£é”ï¼Œæ‰€ä»¥å®ƒéœ€è¦ç­‰å¾…é”è¢«è§£é™¤ï¼Œè¿™æ ·å°±å¯¼è‡´äº†æ­»é”ï¼Œçº¿ç¨‹è¢«é˜»å¡ä½äº†ã€‚è°ƒè¯•å™¨ä¸­ä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p>

<pre><code>2016-06-30 19:08:06.393 SafeMultiThread[30928:449008] value = 5

2016-06-30 19:08:07.399 SafeMultiThread[30928:449008] -[NSLock lock]: deadlock ( â€˜(null)â€™)

2016-06-30 19:08:07.399 SafeMultiThread[30928:449008] Break on _NSLockError() to debug.
</code></pre>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨NSRecursiveLockã€‚å®ƒå¯ä»¥å…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡åŠ é”ï¼Œè€Œä¸ä¼šé€ æˆæ­»é”ã€‚é€’å½’é”ä¼šè·Ÿè¸ªå®ƒè¢«lockçš„æ¬¡æ•°ã€‚æ¯æ¬¡æˆåŠŸçš„lockéƒ½å¿…é¡»å¹³è¡¡è°ƒç”¨unlockæ“ä½œã€‚åªæœ‰æ‰€æœ‰è¾¾åˆ°è¿™ç§å¹³è¡¡ï¼Œé”æœ€åæ‰èƒ½è¢«é‡Šæ”¾ï¼Œä»¥ä¾›å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬å°†NSLockä»£æ›¿ä¸ºNSRecursiveLockï¼Œä¸Šé¢ä»£ç åˆ™ä¼šæ­£ç¡®æ‰§è¡Œã€‚</p>

<pre><code>2016-06-30 19:09:41.414 SafeMultiThread[30949:450684] value = 5

2016-06-30 19:09:42.418 SafeMultiThread[30949:450684] value = 4

2016-06-30 19:09:43.419 SafeMultiThread[30949:450684] value = 3

2016-06-30 19:09:44.424 SafeMultiThread[30949:450684] value = 2

2016-06-30 19:09:45.426 SafeMultiThread[30949:450684] value = 1
</code></pre>

<p>å¦‚æœéœ€è¦å…¶ä»–åŠŸèƒ½ï¼Œæºç å®šä¹‰å¦‚ä¸‹ï¼š</p>

<pre><code>@interface NSRecursiveLock : NSObject  {

&lt;a href="http://www.jobbole.com/members/kaishu6296"&gt;@private&lt;/a&gt;

    void *_priv;

}



- (BOOL)tryLock;

- (BOOL)lockBeforeDate:(NSDate *)limit;



@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);



@end
</code></pre>

<h2>2.5ã€NSConditionLockæ¡ä»¶é”</h2>

<pre><code>    NSMutableArray *products = [NSMutableArray array];



    NSInteger HAS_DATA = 1;

    NSInteger NO_DATA = 0;



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        while (1) {

            [lock lockWhenCondition:NO_DATA];

            [products addObject:[[NSObject alloc] init]];

            NSLog(@"produce a product,æ€»é‡:%zi",products.count);

            [lock unlockWithCondition:HAS_DATA];

            sleep(1);

        }



    });



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        while (1) {

            NSLog(@"wait for product");

            [lock lockWhenCondition:HAS_DATA];

            [products removeObjectAtIndex:0];

            NSLog(@"custome a product");

            [lock unlockWithCondition:NO_DATA];

        }



    });
</code></pre>

<p>å½“æˆ‘ä»¬åœ¨ä½¿ç”¨å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œæœ‰æ—¶ä¸€æŠŠåªä¼šlockå’Œunlockçš„é”æœªå¿…å°±èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„ä½¿ç”¨ã€‚å› ä¸ºæ™®é€šçš„é”åªèƒ½å…³å¿ƒé”ä¸ä¸é”ï¼Œè€Œä¸åœ¨ä¹ç”¨ä»€ä¹ˆé’¥åŒ™æ‰èƒ½å¼€é”ï¼Œè€Œæˆ‘ä»¬åœ¨å¤„ç†èµ„æºå…±äº«çš„æ—¶å€™ï¼Œå¤šæ•°æƒ…å†µæ˜¯åªæœ‰æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æƒ…å†µä¸‹æ‰èƒ½æ‰“å¼€è¿™æŠŠé”ï¼š</p>

<p>åœ¨çº¿ç¨‹1ä¸­çš„åŠ é”ä½¿ç”¨äº†lockï¼Œæ‰€ä»¥æ˜¯ä¸éœ€è¦æ¡ä»¶çš„ï¼Œæ‰€ä»¥é¡ºåˆ©çš„å°±é”ä½äº†ï¼Œä½†åœ¨unlockçš„ä½¿ç”¨äº†ä¸€ä¸ªæ•´å‹çš„æ¡ä»¶ï¼Œå®ƒå¯ä»¥å¼€å¯å…¶å®ƒçº¿ç¨‹ä¸­æ­£åœ¨ç­‰å¾…è¿™æŠŠé’¥åŒ™çš„ä¸´ç•Œåœ°ï¼Œè€Œçº¿ç¨‹2åˆ™éœ€è¦ä¸€æŠŠè¢«æ ‡è¯†ä¸º2çš„é’¥åŒ™ï¼Œæ‰€ä»¥å½“çº¿ç¨‹1å¾ªç¯åˆ°æœ€åä¸€æ¬¡çš„æ—¶å€™ï¼Œæ‰æœ€ç»ˆæ‰“å¼€äº†çº¿ç¨‹2ä¸­çš„é˜»å¡ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼ŒNSConditionLockä¹Ÿè·Ÿå…¶å®ƒçš„é”ä¸€æ ·ï¼Œæ˜¯éœ€è¦lockä¸unlockå¯¹åº”çš„ï¼Œåªæ˜¯lock,lockWhenCondition:ä¸unlockï¼ŒunlockWithCondition:æ˜¯å¯ä»¥éšæ„ç»„åˆçš„ï¼Œå½“ç„¶è¿™æ˜¯ä¸ä½ çš„éœ€æ±‚ç›¸å…³çš„ã€‚</p>

<p>ä¸Šé¢ä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code>2016-06-30 20:31:58.699 SafeMultiThread[31282:521698] wait for product

2016-06-30 20:31:58.699 SafeMultiThread[31282:521708] produce a product,æ€»é‡:1

2016-06-30 20:31:58.700 SafeMultiThread[31282:521698] custome a product

2016-06-30 20:31:58.700 SafeMultiThread[31282:521698] wait for product

2016-06-30 20:31:59.705 SafeMultiThread[31282:521708] produce a product,æ€»é‡:1

2016-06-30 20:31:59.706 SafeMultiThread[31282:521698] custome a product

2016-06-30 20:31:59.706 SafeMultiThread[31282:521698] wait for product

2016-06-30 20:32:00.707 SafeMultiThread[31282:521708] produce a product,æ€»é‡:1

2016-06-30 20:32:00.708 SafeMultiThread[31282:521698] custome a product
</code></pre>

<p>å¦‚æœä½ éœ€è¦å…¶ä»–åŠŸèƒ½ï¼Œæºç å®šä¹‰å¦‚ä¸‹ï¼š</p>

<pre><code>@interface NSConditionLock : NSObject  {

&lt;a href="http://www.jobbole.com/members/kaishu6296"&gt;@private&lt;/a&gt;

    void *_priv;

}



- (instancetype)initWithCondition:(NSInteger)condition NS_DESIGNATED_INITIALIZER;



@property (readonly) NSInteger condition;

- (void)lockWhenCondition:(NSInteger)condition;

- (BOOL)tryLock;

- (BOOL)tryLockWhenCondition:(NSInteger)condition;

- (void)unlockWithCondition:(NSInteger)condition;

- (BOOL)lockBeforeDate:(NSDate *)limit;

- (BOOL)lockWhenCondition:(NSInteger)condition beforeDate:(NSDate *)limit;



@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);



@end
</code></pre>

<h4>2.6ã€NSCondition</h4>

<pre><code>   NSCondition *condition = [[NSCondition alloc] init];



    NSMutableArray *products = [NSMutableArray array];



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        while (1) {

            [condition lock];

            if ([products count] == 0) {

                NSLog(@"wait for product");

                [condition wait];

            }

            [products removeObjectAtIndex:0];

            NSLog(@"custome a product");

            [condition unlock];

        }



    });



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

        while (1) {

            [condition lock];

            [products addObject:[[NSObject alloc] init]];

            NSLog(@"produce a product,æ€»é‡:%zi",products.count);

            [condition signal];

            [condition unlock];

            sleep(1);

        }



    });
</code></pre>

<h6>ä¸€ç§æœ€åŸºæœ¬çš„æ¡ä»¶é”ã€‚æ‰‹åŠ¨æ§åˆ¶çº¿ç¨‹waitå’Œsignalã€‚</h6>

<p>[condition lock];ä¸€èˆ¬ç”¨äºå¤šçº¿ç¨‹åŒæ—¶è®¿é—®ã€ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®æºï¼Œä¿è¯åœ¨åŒä¸€æ—¶é—´å†…æ•°æ®æºåªè¢«è®¿é—®ã€ä¿®æ”¹ä¸€æ¬¡ï¼Œå…¶ä»–çº¿ç¨‹çš„å‘½ä»¤éœ€è¦åœ¨lock å¤–ç­‰å¾…ï¼Œåªåˆ°unlock ï¼Œæ‰å¯è®¿é—®</p>

<pre><code>[condition unlock];ä¸lock åŒæ—¶ä½¿ç”¨



[condition wait];è®©å½“å‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€



[condition signal];CPUå‘ä¿¡å·å‘Šè¯‰çº¿ç¨‹ä¸ç”¨åœ¨ç­‰å¾…ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ
</code></pre>

<p>ä¸Šé¢ä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code>2016-06-30 20:21:25.295 SafeMultiThread[31256:513991] wait for product

2016-06-30 20:21:25.296 SafeMultiThread[31256:513994] produce a product,æ€»é‡:1

2016-06-30 20:21:25.296 SafeMultiThread[31256:513991] custome a product

2016-06-30 20:21:25.297 SafeMultiThread[31256:513991] wait for product

2016-06-30 20:21:26.302 SafeMultiThread[31256:513994] produce a product,æ€»é‡:1

2016-06-30 20:21:26.302 SafeMultiThread[31256:513991] custome a product

2016-06-30 20:21:26.302 SafeMultiThread[31256:513991] wait for product

2016-06-30 20:21:27.307 SafeMultiThread[31256:513994] produce a product,æ€»é‡:1

2016-06-30 20:21:27.308 SafeMultiThread[31256:513991] custome a product
</code></pre>

<h4>2.7ã€pthread_mutex</h4>

<pre><code>    __block pthread_mutex_t theLock;

    pthread_mutex_init(&amp;theLock, NULL);



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

            pthread_mutex_lock(&amp;theLock);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");

            sleep(3);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");

            pthread_mutex_unlock(&amp;theLock);



    });



    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{

            sleep(1);

            pthread_mutex_lock(&amp;theLock);

            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2");

            pthread_mutex_unlock(&amp;theLock);



    });
</code></pre>

<p>cè¯­è¨€å®šä¹‰ä¸‹å¤šçº¿ç¨‹åŠ é”æ–¹å¼ã€‚</p>

<pre><code>1ï¼špthread_mutex_init(pthread_mutex_t mutex,const pthread_mutexattr_t attr);

åˆå§‹åŒ–é”å˜é‡mutexã€‚atträ¸ºé”å±æ€§ï¼ŒNULLå€¼ä¸ºé»˜è®¤å±æ€§ã€‚

2ï¼špthread_mutex_lock(pthread_mutex_t mutex);åŠ é”

3ï¼špthread_mutex_tylock(*pthread_mutex_t *mutex);åŠ é”ï¼Œä½†æ˜¯ä¸2ä¸ä¸€æ ·çš„æ˜¯å½“é”å·²ç»åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿”å›ä¸ºEBUSYï¼Œè€Œä¸æ˜¯æŒ‚èµ·ç­‰å¾…ã€‚

4ï¼špthread_mutex_unlock(pthread_mutex_t *mutex);é‡Šæ”¾é”

5ï¼špthread_mutex_destroy(pthread_mutex_t* mutex);ä½¿ç”¨å®Œåé‡Šæ”¾
</code></pre>

<p>ä»£ç æ‰§è¡Œæ“ä½œç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code>2016-06-30 21:13:32.440 SafeMultiThread[31429:548869] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹

2016-06-30 21:13:35.445 SafeMultiThread[31429:548869] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ

2016-06-30 21:13:35.446 SafeMultiThread[31429:548866] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2
</code></pre>

<h4>2.8ã€pthread_mutex(recursive)</h4>

<p>è¿™æ˜¯pthread_mutexä¸ºäº†é˜²æ­¢åœ¨é€’å½’çš„æƒ…å†µä¸‹å‡ºç°æ­»é”è€Œå‡ºç°çš„é€’å½’é”ã€‚ä½œç”¨å’ŒNSRecursiveLocké€’å½’é”ç±»ä¼¼ã€‚</p>

<p>å¦‚æœä½¿ç”¨pthread_mutex_init(&amp;theLock, NULL);åˆå§‹åŒ–é”çš„è¯ï¼Œä¸Šé¢çš„ä»£ç ä¼šå‡ºç°æ­»é”ç°è±¡ã€‚å¦‚æœä½¿ç”¨é€’å½’é”çš„å½¢å¼ï¼Œåˆ™æ²¡æœ‰é—®é¢˜ã€‚</p>

<h4>2.9ã€OSSpinLock</h4>

<p>OSSpinLock è‡ªæ—‹é”ï¼Œæ€§èƒ½æœ€é«˜çš„é”ã€‚åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ç›´ do while å¿™ç­‰ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯å½“ç­‰å¾…æ—¶ä¼šæ¶ˆè€—å¤§é‡ CPU èµ„æºï¼Œæ‰€ä»¥å®ƒä¸é€‚ç”¨äºè¾ƒé•¿æ—¶é—´çš„ä»»åŠ¡ã€‚ ä¸è¿‡æœ€è¿‘YYå¤§ç¥åœ¨è‡ªå·±çš„åšå®¢ä¸å†å®‰å…¨çš„ OSSpinLockä¸­è¯´æ˜äº†OSSpinLockå·²ç»ä¸å†å®‰å…¨ï¼Œè¯·å¤§å®¶è°¨æ…ä½¿ç”¨ã€‚</p>

<p>ä¸‰ã€æ€§èƒ½å¯¹æ¯”</p>

<p>å¯¹ä»¥ä¸Šå„ä¸ªé”è¿›è¡Œ1000000æ­¤çš„åŠ é”è§£é”çš„ç©ºæ“ä½œæ—¶é—´å¦‚ä¸‹ï¼š</p>

<pre><code>OSSpinLock: 46.15 ms

dispatch_semaphore: 56.50 ms

pthread_mutex: 178.28 ms

NSCondition: 193.38 ms

NSLock: 175.02 ms

pthread_mutex(recursive): 172.56 ms

NSRecursiveLock: 157.44 ms

NSConditionLock: 490.04 ms

@synchronized: 371.17 ms
</code></pre>

<h2>ä¸‰.æ€»çš„æ¥è¯´ï¼š</h2>

<ul>
<li><p>OSSpinLockå’Œdispatch_semaphoreçš„æ•ˆç‡è¿œè¿œé«˜äºå…¶ä»–ã€‚</p></li>
<li><p>@synchronizedå’ŒNSConditionLockæ•ˆç‡è¾ƒå·®ã€‚</p></li>
<li><p>é‰´äºOSSpinLockçš„ä¸å®‰å…¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¼€å‘ä¸­å¦‚æœè€ƒè™‘æ€§èƒ½çš„è¯ï¼Œå»ºè®®ä½¿ç”¨dispatch_semaphoreã€‚</p></li>
<li><p>å¦‚æœä¸è€ƒè™‘æ€§èƒ½ï¼Œåªæ˜¯å›¾ä¸ªæ–¹ä¾¿çš„è¯ï¼Œé‚£å°±ä½¿ç”¨@synchronizedã€‚</p>

<blockquote><p> æ€»æ„Ÿè§‰è¿™ä¸ªæ ‡é¢˜æ€ªæ€ªçš„,ä½†æ˜¯æˆ‘è‡ªèº«è¯æ±‡æœ‰é™,ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæè¿°å¥½äº†.ç”¨ä¸€ä¸ªç®€å•çš„éœ€æ±‚æ¥è§£é‡Šä¸€ä¸‹å§.æˆ‘ä¹‹å‰å¼€å‘çš„ä¸€ä¸ªé¡¹ç›®,éœ€è¦å‘æœåŠ¡å™¨ä¸Šä¼ å›¾ç‰‡,å¤šå›¾ç‰‡ä¸Šä¼ ,ç„¶åæ¯æ¬¡ä¸Šä¼ ä¹‹åä¼šè¿”å›ä¸€ä¸ªå›¾ç‰‡çš„AID, ç„¶åéœ€è¦æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å®Œæˆä¹‹å, æ‹¿ç€ä¸€ä¸ªå…¨æ˜¯AIDçš„æ•°ç»„ä½œä¸ºå‚æ•°è¿›è¡Œå¦ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚&hellip;å¥½å§,æˆ‘æ„Ÿè§‰åˆç»•äº†&hellip;</p></blockquote>

<p>  å‰å‡ å¤©,æˆ‘åœ¨ä¸€ä¸ªæŠ€æœ¯äº¤æµåœˆ,çœ‹åˆ°ä¸€ä¸ªæœ‹å‹å»JINGDONGçš„é¢è¯•é¢˜, å…¶ä¸­ä¸€ä¸ªé¢˜ç›®çš„æè¿°æ˜¯:æœ‰aã€bã€cã€d 4ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå¦‚ä½•åˆ¤æ–­aã€bã€cã€déƒ½å®Œæˆæ‰§è¡Œï¼Ÿ, è·Ÿæˆ‘ä¸Šé¢çš„éœ€æ±‚å¤§åŒå°å¼‚.</p>

<p>  æ‰€ä»¥åœ¨è¿™å„¿,æˆ‘æŠŠæˆ‘å·¥ä½œä¸­æ›¾ç»ç”¨åˆ°è¿‡çš„ä¸€äº›æ–¹æ³•åšä¸€ä¸ªå°çš„æ€»ç»“,æœ‰é—æ¼çš„æˆ–è€…é”™è¯¯çš„åœ°æ–¹,è¯·å¤§å®¶ç•™æ„æŒ‡æ­£,éå¸¸æ„Ÿè°¢å“ˆ!!!</p>

<p>  ç‰¹åˆ«æ³¨æ„:æ‰€æœ‰çš„ä»£ç éƒ½åŸºäºJINGDONGè¿™é“é¢è¯•é¢˜, ä¸è¿‡æˆ‘åªæ‰“å°äº†Aå’ŒBè€Œå·²..</p></li>
</ul>


<h2>å››.å®æˆ˜åº”ç”¨</h2>

<p>æˆ‘ä»¬å…¬å¸Appå‰æ®µæ—¶é—´åˆšå¥½æœ‰ä¸€ä¸ªåŠŸèƒ½éœ€æ±‚ï¼Œå°±æ˜¯å…³äºå‘åŠ¨æ€çš„æ—¶å€™å›¾ç‰‡ä¸Šä¼ çš„éœ€æ±‚ã€‚ä»¥å‰ä¸€èˆ¬æ¥è¯´çš„è¯ï¼Œæˆ‘ä»¬æ˜¯è®²æ‰€æœ‰å›¾ç‰‡æ‰“åŒ…ä¸€èµ·å‘ç»™æœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¾ç¨€ä¸ä¸€æ ·çš„æ˜¯ï¼Œå¿…é¡»æ¯ä¸€å¼ æ¯ä¸€å¼ çš„ä¼ ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè€å¤§è¯´äº†ä¸€å„ä½è‡ªå·±ä½“ä¼šã€‚</p>

<p>éœ€æ±‚æ˜¯ï¼š</p>

<ul>
<li>1ï¼šæ¯æ¬¡ä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™å¿…é¡»ä¸€å¼ ä¸€å¼ çš„ä¼ ã€‚</li>
<li>2ï¼šä¸Šä¼ å®Œä¸€å¼ ä¹‹åæœåŠ¡å™¨è¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ªurlï¼ŒæŠŠä»–å­˜èµ·æ¥</li>
<li>3ï¼šå…¨éƒ¨ä¼ å®Œä¹‹åå†æŠŠæ‰€æœ‰å­˜èµ·æ¥çš„urlä¸€èµ·é€šè¿‡jsonæ ¼å¼å‘é€ç»™æœåŠ¡å™¨</li>
</ul>


<p>è¿™é‡Œè¯•äº†å„ç§æ–¹æ³•ï¼Œé—®äº†å„ç§å¤§ç‰›éƒ½æ²¡æ‰¾åˆ°å¥½çš„æ–¹æ³•ï¼Œåªèƒ½è¯´æœ‰äº›èƒ½è§£å†³ï¼Œä½†æ˜¯è¾¾ä¸åˆ°éå¸¸æ»¡æ„çš„æ•ˆæœã€‚è¿™é‡Œæ€»ç»“ä¸€ä¸‹å¸¸è§çš„ä½¿ç”¨ã€‚</p>

<ol>
<li><p>RunLoop</p>

<p> éœ€è¦æ³¨æ„ä¸€ç‚¹: è¿™å„¿ç”¨çš„æ˜¯NSURLSession, ä¸æ˜¯AFN, æ‰€ä»¥blocké‡Œé¢çš„çº¿ç¨‹æ˜¯å­çº¿ç¨‹,ä¸æ˜¯ä¸»çº¿ç¨‹, ä¸èƒ½ç›´æ¥ä½¿ç”¨CFRunLoopGetCurrent</p>

<pre><code> CFRunLoopGetCurrent : Returns the CFRunLoop object for the current thread.
 CFRunLoopGetMain: Returns the main CFRunLoop object.
</code></pre>

<p> NSURLSessionDataTask *task = [[NSURLSession sharedSession] dataTaskWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@&ldquo;<a href="http://www.baidu.com">http://www.baidu.com</a>&rdquo;]] completionHandler:^(NSData * <em>Nullable data, NSURLResponse * </em>Nullable response, NSError * _Nullable error) {
         NSLog(@&ldquo;A&rdquo;);
         CFRunLoopStop(CFRunLoopGetMain());
     }] ;
     [task resume];
  CFRunLoopRun();
  NSLog(@&ldquo;B&rdquo;);</p></li>
<li><p>GCDçš„group</p>

<p> dispatch_group_notifyå°±æ˜¯éœ€è¦ç­‰queueé‡Œé¢çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰ä¼šæ‰§è¡Œ
 è¿™ç§æ–¹æ³•æ¯”è¾ƒå¸¸è§, ä¸å¤šè¯´</p>

<p> dispatch_group_t group = dispatch_group_create();
     dispatch_queue_t queue = dispatch_get_global_queue(0, 0);
     dispatch_group_async(group, queue, ^{
         NSLog(@&ldquo;A&rdquo;);
     });
     dispatch_group_notify(group, dispatch_get_main_queue(), ^{
         NSLog(@&ldquo;B&rdquo;);
     });</p></li>
<li><p>dispatch_barrier_async</p>

<p> barrierçš„ä¸­æ–‡æ„æ€å°±æ˜¯éšœç¢, å±éšœ
 ä¸€èˆ¬ä½¿ç”¨dispatch_barrier_async, ä¼šè®©barrierä¹‹å‰çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œbarrieråé¢çš„æ“ä½œ</p>

<p>  dispatch_queue_t queue =  dispatch_queue_create(0, DISPATCH_QUEUE_CONCURRENT);
     dispatch_async(queue, ^{
         NSLog(@&ldquo;A&rdquo;);
     });
     dispatch_async(queue, ^{
         NSLog(@&ldquo;C&rdquo;);
     });
     dispatch_barrier_async(queue, ^{
         NSLog(@&ldquo;æ‹¿åˆ°äº†Açš„å€¼&rdquo;);
     });</p>

<pre><code> dispatch_async(queue, ^{
     NSLog(@"D");
 });
 dispatch_async(queue, ^{
     NSLog(@"E");
 });dispatch_async(queue, ^{
     NSLog(@"F");
 });
</code></pre></li>
</ol>


<p>4.NSOperationQueue</p>

<p>   ä¸»è¦å°±æ˜¯ç”¨åˆ°NSOperationQueueçš„ä¸€ä¸ªå¯¹è±¡æ–¹æ³•-addDependency
   éœ€è¦æ³¨æ„ä¸€ç‚¹: waitUntilFinishedå¦‚æœæ˜¯YES,å¿…é¡»ç­‰åˆ°queueä¸­æ‰€æœ‰Operationæ‰§è¡Œå®Œæ¯•ä¹‹å, æ‰ä¼šæ‰“å°HAHA, åä¹‹çš„è¯, HAHAçš„æ‰“å°é¡ºåºæ˜¯éšæœºçš„äº†,å°±çœ‹å“ªä¸ªçº¿ç¨‹è·‘å¾—å¿«äº†&hellip;</p>

<pre><code>NSOperationQueue *queue = [[NSOperationQueue alloc] init];
    NSBlockOperation *p1 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@"A");
    }];
    NSBlockOperation *p2 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@"B");
    }];
    NSBlockOperation *p3 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@"C");
    }];
    [p3 addDependency:p1];
    [p3 addDependency:p2];
    // waitUntilFinishedæ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹
    [queue addOperations:@[p1,p2,p3] waitUntilFinished:NO];

    // å¦‚æœæ˜¯NO,é‚£ä¹ˆè¿™è¡Œæ‰“å°å°±æ˜¯éšæœºçš„, åä¹‹å°±æ˜¯ç­‰A,B,Céƒ½æ‰“å°å®Œä¹‹åæ‰æ‰§è¡Œ
    NSLog(@"HAHA");
</code></pre>

<ol>
<li><p>ä½¿ç”¨AFNä¸­çš„batchOfRequestOperations</p>

<p> è¿™ä¸ªå’ŒGCDä¸€æ ·, æˆ‘å·¥ä½œä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹æ³•
 batchOfRequestOperationsæ–¹æ³•å…¶å®æ˜¯AFHTTPRequestOperationçš„çˆ¶ç±»AFURLConnectionOperationçš„ä¸€ä¸ªæ–¹æ³•.
 è¿™å„¿çš„waitUntilFinishedåŒ4. NSOperationQueue
 progressBlockä¸€èˆ¬ç”¨åœ¨è¿›åº¦è®¡ç®—ä¸­, æ¯”å¦‚æ‰§è¡Œäº†å¤šå°‘ç™¾åˆ†æ¯”, å¯ä»¥è‡ªå®šä¹‰ä¸€äº›ç‚«é…·åŠ¨ç”»</p>

<pre><code> AFHTTPRequestOperation *queue = [[AFHTTPRequestOperation alloc] initWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@"http://www.baidu.com"]]];
     [queue setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) {
         NSLog(@"A");
     } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
         NSLog(@"A");
     }];
     [queue resume];

 AFHTTPRequestOperation *queue2 = [[AFHTTPRequestOperation alloc] initWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@"http://www.baidu.com"]]];
 [queue2 setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) {
     NSLog(@"B");
 } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
     NSLog(@"B");
 }];
 [queue2 resume];

 NSArray *operations = [AFHTTPRequestOperation batchOfRequestOperations:@[queue, queue2] progressBlock:^(NSUInteger numberOfFinishedOperations, NSUInteger totalNumberOfOperations) {
     NSLog(@"%ld/%ld", numberOfFinishedOperations, totalNumberOfOperations);
 } completionBlock:^(NSArray *operations) {
     NSLog(@"C");
 }];

 [[NSOperationQueue mainQueue] addOperations:operations waitUntilFinished:NO];
</code></pre></li>
</ol>


<p>6.å…¶ä»–</p>

<pre><code>è€æ—©ä»¥å‰, æˆ‘ä¸€èˆ¬æ˜¯åœ¨ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ä¸­çš„completionBlockæˆ–è€…successBlockä¸­æ‹¿åˆ°éœ€è¦çš„å€¼, ä¸ºç©ºåˆ¤æ–­å,ç›´æ¥åœ¨blocké‡Œé¢å†å†™ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹...å…¶å®è¿™æ ·çš„å†™æ³•å¯èƒ½å¾ˆå¤šäººéƒ½ç”¨è¿‡,ä½†æ˜¯ä»£ç çš„é˜…è¯»æ€§å¤ªå¼±äº†,èŠ±æ‹¬å·å¤ªå¤š,çœ‹çš„çœ¼èŠ±ç¼­ä¹±çš„...
å…¶å®è¿˜å¯ä»¥è®¾ç½®flagè¿›è¡Œåˆ¤æ–­ç­‰ç­‰æ–¹æ³•...
æš‚æ—¶å°±æƒ³åˆ°è¿™ä¹ˆå¤š, è¿˜æœ‰åˆ«çš„æ–¹æ¡ˆçš„è¯, æ¬¢è¿ç•™è¨€å“ˆ,å¤§å®¶å…±åŒå­¦ä¹ !!!
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-æ•°æ®ç»“æ„å¸¸è§æ“ä½œä¸æ€»ç»“]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/28/xiu-xing-pian-shu-ju-jie-gou-chang-jian-cao-zuo-yu-zong-jie/"/>
    <updated>2016-08-28T12:33:11+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/28/xiu-xing-pian-shu-ju-jie-gou-chang-jian-cao-zuo-yu-zong-jie</id>
    <content type="html"><![CDATA[<h1>ä¸€ã€æ ˆ</h1>

<p>æ ˆæ˜¯åªèƒ½åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„çº¿æ€§è¡¨ã€‚
ï¼ˆåˆ«çœ‹åªæ˜¯ä¸ªå®šä¹‰ï¼Œéå¸¸é‡è¦ï¼Œå·²ç»é“å‡ºäº†è¿ç®—æ–¹æ³•ï¼šåªèƒ½åœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤ã€‚)</p>

<blockquote><p>æ ˆçš„ç‰¹å¾ï¼šåè¿›å…ˆå‡ºï¼Œå…ˆè¿›åå‡ºã€‚</p></blockquote>

<p>æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„ä¸€ç«¯ç§°ä¸ºæ ˆé¡¶ã€‚ï¼ˆè¯´æ˜äº†æˆ‘ä»¬åœ¨æ ˆé¡¶æ“ä½œï¼‰
å¦ä¸€ç«¯ç§°ä¸ºæ ˆåº•ã€‚
æ’å…¥å…ƒç´ å’Œåˆ é™¤å…ƒç´ çš„æ“ä½œç§°ä¸ºå…¥æ ˆå’Œå‡ºæ ˆã€‚</p>

<!--more-->


<h3>1.é¡ºåºæ ˆ</h3>

<p>ç»“æ„ï¼š(topæ€»æ˜¯æŒ‡å‘æ•°ç»„æœ€åçš„å…ƒç´ ï¼Œæ¯”å¦‚data[n]ï¼Œè€Œä¸æ˜¯å‰é¢)</p>

<pre><code>#define MAXSIZE 100
typedef struct
{
    elementtype data[MAXSIZE];
    int top;
} seqstack;
</code></pre>

<p>åˆå§‹åŒ–æ ˆï¼š</p>

<pre><code>void init_stack(seqstack *S)
{
    S-&gt;top = -1;    //ä¸€ä¸ªå…ƒç´ ä¹Ÿæ²¡æœ‰ï¼Œæ³¨æ„å› ä¸ºTOPæ˜¯ä¸‹æ ‡è€Œä¸æ˜¯å…ƒç´ ä¸ªæ•°ï¼Œç”¨-1
}
</code></pre>

<p>åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºï¼š</p>

<pre><code>int stack_empty(seqstack *S)
{
    if (S-&gt;top == -1)
        return 1;
    else
        return 0;
}
</code></pre>

<p>å–æ ˆé¡¶å…ƒç´ ï¼š</p>

<pre><code>elementtype stack_top(seqstack *S)
{
    if (stack_empty(S))
        error("æ ˆä¸ºç©ºï¼");
    else
        return S-&gt;data[S-&gt;top];
}
</code></pre>

<p>å…¥æ ˆï¼š</p>

<pre><code>void push_stack(seqstack *S, elementtype x)
{
    if (S-&gt;top == MAXSIZE -1)
        error("æº¢å‡ºï¼");
    else
        S-&gt;data[++S-&gt;top] = x;    //æ³¨æ„-&gt;è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„
}
</code></pre>

<p>å‡ºæ ˆï¼š</p>

<pre><code>elementtype pop_stack(seqstack *S)
{
    if (stack_empty(S))
        error("æ ˆä¸ºç©ºï¼");
    else
        return S-&gt;data[S-&gt;top--];
}
</code></pre>

<p>åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºæ»¡ï¼š</p>

<pre><code>int stack_full(seqstack *S)
{
    if (S-&gt;top == MAXSIZE -1)
        return 1;
    else
        return 0;
}
</code></pre>

<p>æ€»ä½“æ¥è¯´ï¼Œé¡ºåºæ ˆå¾ˆç®€å•ï¼Œå‡ºçš„æ—¶å€™å–æœ€åçš„å…ƒç´ ï¼Œè¿›çš„æ—¶å€™ä¸€æ ·è¿›åœ¨å°¾éƒ¨ã€‚</p>

<h3>2.é“¾æ ˆ</h3>

<p>æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„ç§°ä¸ºé“¾æ ˆã€‚
å…¶æ’å…¥å’Œåˆ é™¤æ“ä½œä»…é™åˆ¶åœ¨è¡¨å¤´ä½ç½®ä¸Šè¿›è¡Œã€‚
ç”±äºåªèƒ½åœ¨é“¾è¡¨å¤´éƒ¨è¿›è¡Œæ“ä½œï¼Œæ•…é“¾æ ˆæ²¡æœ‰å¿…è¦è±¡å•é“¾è¡¨é‚£æ ·æ·»åŠ å¤´ç»“ç‚¹ã€‚æ ˆé¡¶æŒ‡é’ˆå°±æ˜¯é“¾è¡¨çš„å¤´æŒ‡é’ˆã€‚
ç»“æ„ï¼š</p>

<pre><code>typedef struct node    //å’Œä¸€èˆ¬é“¾è¡¨çš„ç»“æ„ä¸€æ ·ã€‚
{
    elementtype data;
    struct node *next;
} linkstack; 
linkstack *top;
å½“top=NULLæ—¶ï¼Œé“¾æ ˆä¸ºç©ºæ ˆã€‚
</code></pre>

<p>å…¥æ ˆï¼š</p>

<pre><code>void push_stack(linkstack *top, elementtype x)
{
    linkstack *P = (linkstack *)malloc(sizeof(linkstack));
    P-&gt;data = x;
    P-&gt;next = top-&gt;next;
    top = P;
}
</code></pre>

<p>å‡ºæ ˆï¼š</p>

<pre><code>elementype pop_stack(linkstack *top)
{
    elementtype x;
    linkstack *P;
    if (top == NULL)
        error("æ ˆä¸ºç©ºï¼");
    else
    {
        x = top-&gt;data;
        P = top;
        top = top-&gt;next;
        free(P);
        return x;
    }
}
</code></pre>

<h1>äºŒã€é˜Ÿåˆ—</h1>

<p>é˜Ÿåˆ—æ˜¯åªèƒ½åœ¨ä¸€ç«¯æ’å…¥ï¼Œå¦ä¸€ç«¯åˆ é™¤çš„çº¿æ€§è¡¨ã€‚
ç‰¹å¾æ˜¯ï¼šå…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡ºã€‚</p>

<h1>1.é¡ºåºé˜Ÿåˆ—</h1>

<p>æ³¨æ„é¡ºåºé˜Ÿåˆ—å¤šæ˜¯å¾ªç¯é˜Ÿåˆ—ï¼Œè¿™é‡Œè¦æ³¨æ„å‡ ç‚¹ï¼š</p>

<ul>
<li>(1)frontæ˜¯é˜Ÿå¤´çš„å‰ä¸€ä¸ªä½ç½®ã€‚</li>
<li>(2)å°¾éƒ¨å…¥é˜Ÿï¼Œå¤´éƒ¨å‡ºé˜Ÿã€‚</li>
<li><p>(3)ç”±äºå¾ªç¯ï¼Œä»»ä½•çš„ä½ç½®ç§»åŠ¨è®¡ç®—ä¹‹åè¦å–ä½™ï¼šP = (P + 1) % MAXSIZE ã€‚
ç»“æ„ï¼š</p>

<p>  #define MAXSIZE 100
  typedef struct
  {
      elementtype data[MAXSIZE];
      int front;    //å¤´åºå·ï¼ˆæ³¨æ„æ˜¯é˜Ÿå¤´çš„å‰ä¸€ä¸ªä½ç½®ï¼‰
      int rear;    //å°¾åºå·ï¼ˆç›´æ¥æŒ‡å‘å°¾å…ƒç´ ï¼‰
  } seqqueue;</p></li>
</ul>


<p>åˆå§‹åŒ–é˜Ÿåˆ—ï¼š</p>

<pre><code>void init_queue(seqqueue *Q)
{
    Q-&gt;front = 0;
    Q-&gt;rear = 0;
}
</code></pre>

<p>è¿˜æœ‰ä¸€ç§å†™æ³•ï¼š</p>

<pre><code>void init_queue(seqqueue *Q)
{
    Q-&gt;front = MAXSIZE - 1;
    Q-&gt;rear = MAXSIZE - 1;
}
</code></pre>

<p>ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«æ˜¯ç¬¬ä¸€ç§æ’å…¥ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯data[1]ï¼Œè€Œç¬¬äºŒç§æ˜¯data[0]ã€‚
åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼š</p>

<pre><code>int queue_empty(seqqueue *Q)
{
    if (Q-&gt;front == Q-&gt;rear)
        return 1;
    else
        return -1;
}
</code></pre>

<p>åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºæ»¡ï¼š</p>

<pre><code>int queue_full(seqqueue *Q)
{
    if ((Q-&gt;rear + 1) % MAXSIZE == Q-&gt;front)
        return 1;
    else
        return 0;
}
</code></pre>

<p>å–é˜Ÿå¤´å…ƒç´ ï¼š</p>

<pre><code>elementtype queue_front(seqqueue *Q)
{
    if (queue_empty(Q))
        error("é˜Ÿåˆ—ä¸ºç©ºï¼");
    else
        return Q-&gt;data[(Q-&gt;front + 1) % MAXSIZE];
}
</code></pre>

<p>å…¥é˜Ÿï¼š</p>

<pre><code>void Enqueue(seqqueue *Q, elementtype x)
{
    if (queue_full(Q))
        error("é˜Ÿåˆ—æ»¡ï¼");
    else
    {
        Q-&gt;rear = (Q-&gt;rear + 1) % MAXSIZE;    //åƒä¸‡ä¸èƒ½ç›´æ¥ç”¨Q-&gt;rear++ï¼Œåœ¨å¾ªç¯é˜Ÿåˆ—è¦ç‰¹åˆ«æ³¨æ„
        Q-&gt;data[Q-&gt;rear] = x;
    }
}
</code></pre>

<p>å‡ºé˜Ÿï¼š</p>

<pre><code>elementtype Outqueue(seqqueue *Q)
{
    if (queue_empty(Q))
        error("é˜Ÿåˆ—ä¸ºç©ºï¼");
    else
    {
        Q-&gt;front = (Q-&gt;front + 1) % MAXSIZE;
        return Q-&gt;data[Q-&gt;front];
    }
}
</code></pre>

<h3>2.é“¾é˜Ÿåˆ—</h3>

<p>å‡ºé˜Ÿæ—¶ï¼Œåˆ é™¤è¡¨å¤´æ“ä½œï¼Œå…¥é˜Ÿæ—¶ï¼Œåœ¨è¡¨å°¾æ·»åŠ ç»“ç‚¹ã€‚ï¼ˆä¹Ÿå°±æ˜¯å¤´éƒ¨å‡ºï¼Œå°¾éƒ¨è¿›ï¼‰
ä½¿ç”¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨å½¢å¼ã€‚ï¼ˆæ³¨æ„é“¾æ ˆæ˜¯ä¸å¸¦å¤´ç»“ç‚¹çš„ï¼‰
ç»“æ„ï¼š</p>

<pre><code>typedef struct mynode
{
    elementtype data;
    mynode *next;
} node;    //å°±æ˜¯å•é“¾è¡¨
typedef struct
{
    node *front;
    node *rear;
} linkqueue;
</code></pre>

<p>åˆå§‹åŒ–é˜Ÿåˆ—ï¼š</p>

<pre><code>void init_queue(linkqueue *Q)
{
    Q-&gt;front = (node *)malloc(sizeof(node));    //ç”Ÿæˆå¤´ç»“ç‚¹ï¼ˆæ³¨æ„æ˜¯NODEç±»å‹ï¼ŒQç»“æ„æ˜¯å·²æœ‰çš„ä¸€ä¸ªç»“æ„ï¼Œè¿™é‡Œæœ‰ç‚¹ç‰¹æ®Šï¼Œä»”ç»†ä½“ä¼šï¼‰
    Q-&gt;rear = Q-&gt;front;
    Q-&gt;front = NULL;
}
</code></pre>

<p>åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼š</p>

<pre><code>int queue_empty(linkqueue *Q)
{
    if (Q-&gt;front == Q-&gt;rear)
        return 1;
    else
        return 0;
}
</code></pre>

<p>å–é˜Ÿå¤´å…ƒç´ ï¼š</p>

<pre><code>elementtype queue_front(linkqueue *Q)
{
    if (queue_empty(Q))
        error("é˜Ÿåˆ—ä¸ºç©ºï¼");
    else
        return Q-&gt;front-&gt;next-&gt;data;
}
</code></pre>

<p>å…¥é˜Ÿï¼š</p>

<pre><code>void Enqueue(linkqueue *Q, elementtype x)
{
    node *P = (node *)malloc(sizeof(node));
    P-&gt;data = x;
    P-&gt;next = NULL;
    Q-&gt;rear-&gt;next = P;
    Q-&gt;rear = P;
}
</code></pre>

<p>å‡ºé˜Ÿï¼š</p>

<pre><code>elementtype Outqueue(linkqueue *Q)
{
    node *P;
    elmenttype x;
    if (queue_empty(Q))
        error("é˜Ÿåˆ—ä¸ºç©ºï¼");
    else
    {
        P = Q-&gt;front-&gt;next;
        Q-&gt;front-&gt;next = P-&gt;next;
        x = P-&gt;data;
        free(P);
    }
    if (Q-&gt;front-&gt;next == NULL)    //åªå‰©ä¸€ä¸ªç»“ç‚¹åˆ é™¤åé˜Ÿåˆ—ä¸ºç©ºæ—¶çš„ç‰¹æ®Šæƒ…å†µï¼Œä¸€å®šè¦æ³¨æ„å¤„ç†
        Q-&gt;rear = Q-&gt;front;
    return x;
}
</code></pre>

<h1>æ•°ç»„</h1>

<p>ä¸»è¦æ˜¯ç¨€ç–çŸ©é˜µçš„å‹ç¼©å­˜å‚¨ï¼š
å½“æ•°ç»„ä¸­éé›¶å…ƒç´ éå¸¸å°‘æ—¶ï¼Œç§°ä¹‹ä¸ºç¨€ç–çŸ©é˜µã€‚
å­˜å‚¨ç‰¹åˆ«å¦‚ä¸‹ï¼š</p>

<ul>
<li>(1)å¯¹ç¨€ç–çŸ©é˜µå‹ç¼©å­˜å‚¨æ—¶ï¼Œé™¤äº†å­˜å‚¨éé›¶å…ƒç´ çš„å€¼vä»¥å¤–ï¼Œè¿˜è¦å­˜å‚¨å…¶è¡Œåˆ—å·iå’Œjï¼Œæ•…æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªä¸‰å…ƒç»„(i, j, v)ã€‚å°†è¿™äº›å…ƒç´ çš„ä¸‰å…ƒç»„ç»„ç»‡èµ·æ¥æ„æˆä¸‰å…ƒç»„è¡¨ã€‚</li>
<li>(2)éœ€è¦åœ¨ä¸‰å…ƒç»„è¡¨ä¸­å¢è®¾å…ƒç´ ä¸ªæ•°ã€è¡Œåˆ—æ•°ï¼Œä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªç¨€ç–çŸ©é˜µã€‚</li>
</ul>


<p>ç»“æ„å¦‚ä¸‹ï¼š</p>

<pre><code>#define MAXSIZE 100
typedef struct    //ä¸‰å…ƒç»„ç»“æ„
{
    int i, j;
    elementtype v;
} tuple;
typedef struct
{
    int mu, nu, tu;    //è¡Œæ•°ã€åˆ—æ•°ã€é0å…ƒç´ ä¸ªæ•°
    tuple data[MAXSIZE];
} spmatrix;
</code></pre>

<h1>æ ‘</h1>

<h3>ä¸€ã€æ ‘</h3>

<p>æ ‘ä¸­çš„æ¯ä¸ªç»“ç‚¹æœ€å¤šåªæœ‰ä¸€ä¸ªå‰é©±ï¼ˆçˆ¶è¾ˆï¼‰ï¼Œä½†å¯èƒ½æœ‰å¤šä¸ªåç»§ï¼ˆåä»£ï¼‰ã€‚
ä¸€ä¸ªç»“ç‚¹çš„åº¦æ˜¯æŒ‡è¯¥ç»“ç‚¹çš„å­©å­æ•°ç›®ã€‚
è‹¥ä¸€ä¸ªç»“ç‚¹çš„åº¦ä¸º0ï¼Œç§°ä¸ºå¶å­ç»“ç‚¹æˆ–ç»ˆç»“ç‚¹ï¼Œå¦åˆ™ç§°ä¸ºåˆ†æ”¯ç»“ç‚¹æˆ–éç»ˆç»“ç‚¹ã€‚
ä¸€æ£µæ ‘çš„åº¦æ˜¯æ ‘ä¸­æœ€å¤§çš„ç»“ç‚¹çš„åº¦ã€‚
æŸä¸ªç»“ç‚¹çš„å­æ ‘çš„æ ¹ç§°ä¸ºå…¶å­©å­ç»“ç‚¹ï¼Œè€Œè¯¥ç»“ç‚¹ä¸ºå…¶å­©å­ç»“ç‚¹çš„åŒäº²ç»“ç‚¹æˆ–çˆ¶ç»“ç‚¹ã€‚
åŒä¸€ä¸ªç»“ç‚¹çš„å­©å­äº’ç›¸ç§°ä¸ºå…„å¼Ÿç»“ç‚¹ã€‚
æ ¹çš„å±‚æ¬¡ä¸º1ï¼Œå…¶ä½™ç»“ç‚¹çš„å±‚æ¬¡ä¸ºçˆ¶ç»“ç‚¹çš„å±‚æ¬¡æ•°åŠ 1ï¼Œè€Œæœ€å¤§çš„å±‚æ¬¡æ•°ç§°ä¸ºæ ‘çš„é«˜åº¦æˆ–æ·±åº¦ã€‚
å¦‚æœæ ‘ä¸­å„å…„å¼Ÿç»“ç‚¹ä¹‹é—´çš„æ’åˆ—æ¬¡åºæ˜¯æ— å…³çš„ï¼Œåˆ™ç§°ä¹‹ä¸ºæœ‰åºæ ‘ï¼Œå¦åˆ™ç§°ä¸ºæ— åºæ ‘ã€‚
ç§°å¤šæ£µæ ‘ä¸ºæ£®æ—ã€‚</p>

<h3>äºŒå‰æ ‘</h3>

<p>äºŒå‰æ ‘å’Œæ ‘ä¸€æ ·ï¼Œéƒ½å¯ä»¥ä¸ºç©ºæ ‘ã€‚
æ³¨æ„äºŒå‰æ ‘æ¯ä¸ªç»“ç‚¹çš„å­©å­éƒ½æœ‰å·¦å³ä¹‹åˆ†ï¼Œæ¯ä¸ªç»“ç‚¹éƒ½æœ‰å·¦å³ä¸¤ä¸ªå­æ ‘ï¼Œè¿™ä¸æ ‘ç»“æ„æ˜æ˜¾ä¸åŒã€‚
äºŒå‰æ ‘å’Œæ ‘æœ¬è´¨ä¸Šæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ç§ç»“æ„ã€‚
 å®šä¹‰ï¼šæ»¡äºŒå‰æ ‘æ˜¯æŒ‡æ¯å±‚éƒ½æœ‰æœ€å¤§æ•°ç›®ç»“ç‚¹çš„äºŒå‰æ ‘ï¼Œå³é«˜åº¦ä¸ºkçš„æ»¡äºŒå‰æ ‘ä¸­æœ‰2k-1ä¸ªç»“ç‚¹ã€‚è€Œå®Œå…¨äºŒå‰æ ‘åˆ™æ˜¯æŒ‡åœ¨æ»¡äºŒå‰æ ‘çš„æœ€ä¸‹å±‚ä»å³åˆ°å·¦è¿ç»­åœ°åˆ é™¤è‹¥å¹²ä¸ªç»“ç‚¹æ‰€å¾—åˆ°çš„äºŒå‰æ ‘ã€‚</p>

<p>äºŒå‰æ ‘çš„æ€§è´¨ï¼š</p>

<ul>
<li>1.åœ¨äºŒå‰æ ‘çš„ç¬¬iå±‚ä¸Šçš„ç»“ç‚¹ä¸ªæ•°&lt;=2i-1(i>0)</li>
<li>2.æ·±åº¦ï¼ˆé«˜åº¦ï¼‰ä¸ºkçš„äºŒå‰æ ‘çš„ç»“ç‚¹ä¸ªæ•°&lt;=2k-1</li>
<li>3.å¯¹ä»»ä¸€æ£µéç©ºçš„äºŒå‰æ ‘ï¼Œå¦‚æœå…¶å¶å­æ•°ä¸ºn0, åº¦ä¸º2çš„ç»“ç‚¹æ•°ä¸ºn2, åˆ™æœ‰ä¸‹é¢çš„å…³ç³»å¼æˆç«‹ï¼šn0=n2+1
(è¿™ä¸ªæ€§è´¨å¾ˆé‡è¦ã€‚ä¸»è¦æ˜¯æœ‰ä¸ªæ¦‚å¿µï¼šé™¤å»æ ¹ç»“ç‚¹ï¼Œæ¯ä¸ªç»“ç‚¹éƒ½ä¸ä¸€ä¸ªå®ƒä¸Šé¢çš„åˆ†æ”¯ä¸€ä¸€å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»“ç‚¹æ•°ï¼åˆ†æ”¯æ•°ï¼‹1ï¼Œæ‰€ä»¥æœ‰ï¼šn-1=n1+2*n2)</li>
<li>4.æœ‰nä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘(n>0)çš„æ·±åº¦ä¸º[log2n]+1([]ä¸ºå–æ•´)</li>
<li>5.åœ¨ç¼–å·çš„å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œå„ç»“ç‚¹çš„ç¼–å·ä¹‹é—´çš„å…³ç³»ä¸ºï¼š
ç¼–å·ä¸ºiçš„ç»“ç‚¹å¦‚æœå­˜åœ¨å·¦å­©å­ï¼Œåˆ™å…¶ç¼–å·ä¸º2iï¼Œå¦‚æœå­˜åœ¨å³å­©å­ï¼Œåˆ™å…¶ç¼–å·ä¸º2i+1ï¼Œå¦‚æœå­˜åœ¨çˆ¶ç»“ç‚¹ï¼Œåˆ™å…¶ç¼–å·ä¸º[i/2]ã€‚</li>
</ul>


<p>äºŒå‰æ ‘çš„å­˜å‚¨ç»“æ„ï¼š
1.é¡ºåºå­˜å‚¨ç»“æ„ï¼š
æŒ‰å®Œå…¨äºŒå‰æ ‘çš„ç¼–å·æ¬¡åºè¿›è¡Œï¼Œå³ç¼–å·ä¸ºiçš„ç»“ç‚¹å­˜å‚¨åœ¨æ•°ç»„ä¸­ä¸‹æ ‡ä¸ºiçš„å…ƒç´ ä¸­ã€‚
ç¼ºç‚¹ï¼šè‹¥äºŒå‰æ ‘ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œåˆ™ä¸ºäº†ä¿æŒç»“ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œä¸å¾—ä¸ç©ºå‡ºè®¸å¤šå…ƒç´ æ¥ï¼Œè¿™å°±é€ æˆäº†ç©ºé—´çš„æµªè´¹ã€‚</p>

<p>2.äºŒå‰é“¾è¡¨å­˜å‚¨ç»“æ„ï¼š</p>

<pre><code>typedef struct node
{
    datatype data;
    struct node *lchild, *rchild;
} bitree;
</code></pre>

<h3>äºŒå‰æ ‘çš„éå†ï¼š</h3>

<p>æ‰€è°“éå†äºŒå‰æ ‘æ˜¯æŒ‡æŒ‰æŸç§æ¬¡åºè®¿é—®äºŒå‰æ ‘ä¸­æ¯ä¸ªç»“ç‚¹ä¸€æ¬¡ä¸”ä»…ä¸€æ¬¡ã€‚
æ ¹æ®è®¿é—®æ ¹ç»“ç‚¹çš„æ¬¡åºï¼Œå¯ä»¥åˆ†ä¸ºå…ˆåºéå†ï¼Œä¸­åºéå†ï¼Œååºéå†ã€‚
å…ˆåºéå†å¯æè¿°ä¸ºï¼š
è‹¥äºŒå‰æ ‘Tä¸ä¸ºç©ºï¼š</p>

<ul>
<li>(1)è®¿é—®Tçš„æ ¹ç»“ç‚¹ï¼›</li>
<li>(2)å…ˆåºéå†Tçš„å·¦å­æ ‘ï¼›</li>
<li><p>(3)å…ˆåºéå†Tçš„å³å­æ ‘ã€‚
éå†çš„ç®—æ³•éå¸¸ç®€å•ï¼Œåªå†™å‡ºå…ˆåºéå†ç®—æ³•ï¼š</p>

<p>  void preorder(bitree *T)
  {
      if (T != NULL)
      {
          visit(T);    //ä¸€èˆ¬ç”¨çš„æœ€å¤šçš„å°±æ˜¯è¾“å‡º
          preorder(T->lchild);
          preorder(T->rchild);
      }
  }</p></li>
</ul>


<h3>çº¿ç´¢äºŒå‰æ ‘</h3>

<p>çº¿ç´¢äºŒå‰æ ‘ä¸»è¦æ˜¯ä¸ºäº†æ±‚è§£åœ¨æŸç§æ¬¡åºä¸‹çš„å‰é©±æˆ–åç»§ç»“ç‚¹ã€‚
å°†äºŒå‰æ ‘å„ç»“ç‚¹ä¸­çš„ç©ºçš„å·¦å­©å­æŒ‡é’ˆåŸŸæ”¹ä¸ºæŒ‡å‘å…¶å‰é©±ï¼Œç©ºçš„å³å­©å­æŒ‡é’ˆåŸŸæ”¹ä¸ºæŒ‡å‘å…¶åç»§ã€‚ç§°è¿™ç§æ–°çš„æŒ‡é’ˆï¼ˆå‰é©±æˆ–åç»§ï¼‰ä¸ºçº¿ç´¢ï¼Œæ‰€å¾—åˆ°çš„äºŒå‰æ ‘è¢«ç§°ä¸ºçº¿ç´¢äºŒå‰æ ‘ï¼Œå°†äºŒå‰æ ‘è½¬å˜æˆçº¿ç´¢äºŒå‰æ ‘çš„è¿‡ç¨‹ç§°ä¸ºçº¿ç´¢åŒ–ã€‚
åŒæ—¶ï¼Œä¸ºäº†åŒºåˆ†åˆ°åº•æŒ‡é’ˆæ˜¯æŒ‡å‘å‰é©±ï¼ˆåç»§ï¼‰è¿˜æ˜¯å­©å­ï¼Œè¦åŠ å…¥ä¸¤ä¸ªæ ‡å¿—æ¥åˆ¤æ–­ã€‚
ç»“æ„ï¼š</p>

<pre><code>typedef struct node
{
    int ltag, rtag;    //0ä¸ºå­©å­ï¼Œ1ä¸ºå‰é©±æˆ–åç»§
    datatype data;
    struct node *lchild, *rchild;
} ordertree;
</code></pre>

<p>å…ˆåºåç»§çš„æ±‚è§£ï¼š</p>

<pre><code>ordertree *presuc(ordertree *P)
{
    if (P-&gt;ltag == 0)
        return P-&gt;lchild;
    else
        return P-&gt;rchild;
}
</code></pre>

<p>ä¸­åºåç»§ï¼š</p>

<pre><code>ordertree *insuc(ordertree *P)
{
    ordertree *q = P-&gt;rchild;
    if (P-&gt;rtag == 1)
        return q;
    else
    {
        while (q-&gt;ltag == 0)
            q = q-&gt;lchild;
        return q;
    }
}
</code></pre>

<p>ä¸­åºå…ˆé©±ï¼š</p>

<pre><code>ordertree *infore(ordertree *P)
{
    ordertree *q = P-&gt;lchild;
    if (P-&gt;ltag == 1)
        return q;
    else
    {
        while (q-&gt;rtag == 0)
            q = q-&gt;rchild;
        return q;
    }
}
</code></pre>

<p>ååºå…ˆé©±ï¼š</p>

<pre><code>ordertree *postfore(ordertree *P)
{
    if (P-&gt;rtag == 0)
        return P-&gt;rchild;
    else
        return P-&gt;lchild;
}
</code></pre>

<h3>æ ‘å’Œæ£®æ—</h3>

<h5>1.æ ‘çš„å­˜å‚¨ç»“æ„ï¼š</h5>

<p>(1)åŒäº²è¡¨ç¤ºæ³•</p>

<pre><code>struct tnode
{
    datatype data;
    int parent;
}
struct tnode treelist[MAXSIZE];    //æ•´ä¸ªæ ‘çš„å­˜å‚¨æ•°ç»„è¯´æ˜
</code></pre>

<p>å…¶ä¸­parentæŒ‡ç¤ºè¯¥ç»“ç‚¹çˆ¶ç»“ç‚¹çš„ä¸‹æ ‡ï¼Œdataå­˜æ”¾ç»“ç‚¹çš„å€¼ã€‚
ä¼˜ç‚¹ï¼šä¾¿äºæœç´¢ç›¸åº”ç»“ç‚¹çš„çˆ¶ç»“ç‚¹å’Œç¥–å…ˆç»“ç‚¹ã€‚
ç¼ºç‚¹ï¼šè‹¥è¦æœç´¢å­©å­ç»“ç‚¹æˆ–åä»£ç»“ç‚¹éœ€è¦æœç´¢æ•´ä¸ªè¡¨ï¼Œæµªè´¹æ—¶é—´ã€‚</p>

<p>(2)å­©å­é“¾è¡¨è¡¨ç¤ºæ³•
åˆ†åˆ«å°†æ¯ä¸ªç»“ç‚¹çš„å­©å­ç»“ç‚¹è¿æˆä¸€ä¸ªé“¾è¡¨ï¼Œç„¶åå°†å„è¡¨å¤´æŒ‡é’ˆæ”¾åœ¨ä¸€ä¸ªè¡¨ä¸­æ„æˆä¸€ä¸ªæ•´ä½“ç»“æ„ã€‚</p>

<pre><code>typedef struct node    //é“¾è¡¨ä¸­æ¯ä¸ªå­©å­ç»“ç‚¹çš„å®šä¹‰
{
    int data;
    struct node *next;
} listnode;
typedef struct    //æ•°ç»„å…ƒç´ çš„å®šä¹‰ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå•é“¾è¡¨ï¼Œå•å¤´å…ƒç´ ä¸åŒ
{
    datatype info;
    listnode *firstchild;
} arrnode;
arrnode tree[MAXSIZE];    //MAXSIZEä¸ºæ‰€æœ‰ç»“ç‚¹çš„ä¸ªæ•°
</code></pre>

<p>ä¼˜ç¼ºç‚¹ï¼šä¸åŒäº²è¡¨ç¤ºæ³•æ°å¥½ç›¸åã€‚</p>

<p>(3)å­©å­ï¼å…„å¼Ÿé“¾è¡¨è¡¨ç¤ºæ³•ï¼ˆäºŒå‰é“¾è¡¨è¡¨ç¤ºæ³•ï¼ŒäºŒå‰æ ‘è¡¨ç¤ºæ³•ï¼‰
æ ‘ä¸­æ¯ä¸ªç»“ç‚¹ç”¨ä¸€ä¸ªé“¾è¡¨ç»“ç‚¹æ¥å­˜å‚¨ï¼Œæ¯ä¸ªé“¾è¡¨ç»“ç‚¹ä¸­é™¤äº†å­˜æ”¾ç»“ç‚¹çš„å€¼å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªç”¨æ¥æŒ‡ç¤ºè¯¥ç»“ç‚¹çš„ç¬¬ä¸€ä¸ªå­©å­ï¼Œå¦ä¸€ä¸ªç”¨äºæŒ‡ç¤ºè¯¥ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿç»“ç‚¹ã€‚</p>

<pre><code>typedef struct node
{
    datatype data;
    struct node *firstchild, *nextbrother;
} tnode;
</code></pre>

<h5>2.æ ‘ï¼ˆæ£®æ—ï¼‰ä¸äºŒå‰æ ‘çš„è½¬æ¢</h5>

<p>æ ‘æˆ–æ£®æ—çš„å­æ ‘è½¬æ¢ä¸ºäºŒå‰æ ‘çš„å·¦å­æ ‘ï¼Œå…„å¼Ÿè½¬åŒ–ä¸ºå³å­æ ‘ã€‚</p>

<h5>3.æ ‘ï¼ˆæ£®æ—ï¼‰çš„éå†</h5>

<p>æ ‘çš„éå†å¯åˆ†ä¸ºå…ˆåºéå†å’Œååºéå†ã€‚ï¼ˆæ³¨æ„æ²¡æœ‰ä¸­åºï¼Œå› ä¸ºæ ‘æœ‰ä¸åªä¸¤ä¸ªå­©å­ï¼‰å³ç»“ç‚¹æ˜¯åœ¨å…¶å­æ ‘ä¹‹å‰è¿˜æ˜¯ä¹‹åè®¿é—®ã€‚
éå†æ ‘ï¼ˆæ£®æ—ï¼‰è¦è½¬æ¢ä¸ºéå†å…¶å¯¹åº”çš„äºŒå‰æ ‘ï¼š
å…ˆåºéå†ï¼šï¼ˆåŒäºŒå‰æ ‘çš„å…ˆåºéå†ï¼‰</p>

<pre><code>void preorder(tnode *T)
{
    if (T != NULL)
    {
        visit(T);
        preorder(T-&gt;firstchild);
        preorder(T-&gt;nextbrother);
    }
}
</code></pre>

<p>ååºéå†ï¼šï¼ˆåŒäºŒå‰æ ‘çš„ä¸­åºéå†ï¼‰</p>

<pre><code>void postorder(tnode *T)
{
    if (T != NULL)
    {
        postorder(T-&gt;firstchild);
        visit(T);
        postorder(T-&gt;nextbrother);
    }
}
</code></pre>

<h3>å“ˆå¤«æ›¼æ ‘</h3>

<p>å“ˆå¤«æ›¼æ ‘ä¸»è¦ç”¨æ¥å¤„ç†å‹ç¼©ç®—æ³•ã€‚
ä¸€èˆ¬çš„åˆ¤æ–­é—®é¢˜çš„æµç¨‹å°±è±¡æ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œå…¶ä¸­åˆ†æ”¯ï¼ˆåˆ¤æ–­ï¼‰ç»“ç‚¹å¯¹åº”äºäºŒå‰æ ‘çš„åˆ†æ”¯ç»“ç‚¹ï¼›è€Œæœ€åå¾—å‡ºçš„ç»“è®ºå¯¹åº”äºå¶å­ç»“ç‚¹ï¼›ä¸€ä¸ªç»“è®ºæ‰€éœ€è¦çš„åˆ¤æ–­æ¬¡æ•°æ˜¯ä»æ ¹ç»“ç‚¹åˆ°è¯¥å¶å­ç»“ç‚¹çš„åˆ†æ”¯çº¿æ•°ï¼ˆå±‚æ¬¡æ•°-1ï¼‰ï¼›æ¯ä¸ªç»“è®ºæˆç«‹çš„æ¬¡æ•°ä½œä¸ºå¶å­ç»“ç‚¹çš„æƒå€¼ã€‚
(è¿™ä¸ªæƒå€¼å¯èƒ½æ¯”è¾ƒå°‘æ¥è§¦,ä½†æ˜¯å…¶å®å®ƒéå¸¸é‡è¦,å› ä¸ºæˆ‘ä»¬å¹³æ—¶è®¾è®¡çš„ç³»ç»Ÿ,åˆ¤æ–­çš„ç»“æœå¸¸å¸¸éƒ½æ˜¯é€šè¿‡é•¿å¹´çš„å®è·µä¼šæœ‰ä¸€ä¸ªå‡ºç°æœºç‡åˆ†é…,è€Œä¸å¯èƒ½æ˜¯å¹³åˆ†çš„,æ¯”å¦‚è€ƒè¯•,å¦‚æœå¸¸å¸¸80-90åˆ†çš„æ¯”è¾ƒå¤š,ä¹Ÿè®¸å°±è¦æ¢ä¸€ç§ç®—æ³•,å½“ç„¶è¿™æ˜¯åè¯,å’Œè€ƒè¯•æ— å…³äº†.)</p>

<p>å“ˆå¤«æ›¼ç®—æ³•æ­¥éª¤å¦‚ä¸‹:</p>

<ul>
<li>(1)æ ¹æ®ç»™å®šçš„nä¸ªæƒå€¼,æ„æˆä¸€æ’ç»“ç‚¹T,æ¯ä¸ªçš„å€¼éƒ½æ˜¯ç›¸åº”çš„æƒå€¼.</li>
<li>(2)ä»Tä¸­é€‰ä¸¤æ£µæƒå€¼æœ€å°çš„äºŒå‰æ ‘,ä½œä¸ºå·¦å³å­æ ‘æ„æˆä¸€æ£µæ–°çš„äºŒå‰æ ‘T',å¹¶ä¸”æ–°äºŒå‰æ ‘çš„æƒå€¼ä¸ºå·¦å³å­æ ‘æƒå€¼ä¹‹å’Œ.</li>
<li>(3)å°†æ–°äºŒå‰æ ‘T'å¹¶å…¥åˆ°Tä¸­,åˆ é™¤åŸæ¥çš„ä¸¤æ£µäºŒå‰æ ‘.</li>
<li>(4)é‡å¤2,3ç›´åˆ°åªå‰©ä¸€æ£µäºŒå‰æ ‘.è¿™æ£µæ ‘å°±æ˜¯å“ˆå¤«æ›¼æ ‘.</li>
</ul>


<p>å“ˆå¤«æ›¼æ ‘çš„å¸¦æƒè·¯å¾„é•¿åº¦WPL=âˆ‘wL
å³æ‰€æœ‰å¶å­ç»“ç‚¹çš„ æƒå€¼*æ¯”è¾ƒæ¬¡æ•°(å±‚æ¬¡æ•°-1) ä¹‹å’Œ.
è€ŒWPLä¹Ÿæ­£å¥½ç­‰äºæ‰€æœ‰åˆ†æ”¯ç»“ç‚¹(ä¸åŒ…æ‹¬å¶å­ç»“ç‚¹)çš„å€¼ä¹‹å’Œ.</p>

<h1>å›¾</h1>

<p>å›¾ä¸­å°†æ¯ä¸ªå¯¹è±¡ç”¨ä¸€ä¸ªé¡¶ç‚¹è¡¨ç¤ºï¼Œå¹¶å¸¸ç”¨ä¸€ä¸ªåºå·æ¥æ ‡è¯†ä¸€ä¸ªé¡¶ç‚¹ã€‚
å…¶ä¸­å¼§è¡¨ç¤ºå•å‘å…³ç³»ï¼Œè¾¹è¡¨ç¤ºåŒå‘å…³ç³»ï¼Œç”¨ç¦»æ•£æ•°å­¦ä¸­çš„æœ¯è¯­æ¥è¯´ï¼Œåˆ™åˆ†åˆ«è¡¨ç¤ºä¸ºéå¯¹ç§°å…³ç³»å’Œå¯¹ç§°å…³ç³»ã€‚
å¼§ç”¨&lt;A, B>è¡¨ç¤ºï¼ˆAä¸ºå°¾ï¼ŒBä¸ºå¤´ï¼‰ï¼Œè¾¹ç”¨(A, B)è¡¨ç¤ºã€‚</p>

<pre><code>ä¸€ä¸ªå›¾Gç”±ä¸¤éƒ¨åˆ†å†…å®¹æ„æˆï¼Œå³é¡¶ç‚¹(vertex)é›†åˆ(V)å’Œè¾¹(æˆ–å¼§edge)çš„é›†åˆ(E)ï¼Œå¹¶ç”¨äºŒå…ƒç»„(V, E)æ¥è¡¨ç¤ºï¼Œè®°åšG = (V, E) 
</code></pre>

<ul>
<li>æ ¹æ®é¡¶ç‚¹é—´çš„å…³ç³»æ˜¯å¦æœ‰å‘è€Œå¼•å…¥æœ‰å‘å›¾å’Œæ— å‘å›¾ã€‚</li>
<li>ç»™æ¯æ¡è¾¹æˆ–å¼§åŠ ä¸Šæƒå€¼ï¼Œè¿™æ ·çš„å¸¦æƒå›¾ç§°ä¸ºç½‘ç»œã€‚</li>
<li>è‹¥æ— å‘å›¾ä¸­ä»»æ„ä¸¤ç‚¹é—´éƒ½æœ‰ä¸€æ¡è¾¹ï¼Œåˆ™ç§°æ­¤å›¾Gä¸ºæ— å‘å®Œå…¨å›¾ã€‚(å…±æœ‰è¾¹æ•° n*(n-1)/2 )</li>
<li><p>è‹¥æœ‰å‘å›¾ä¸­ä»»æ„ä¸€ä¸ªé¡¶ç‚¹åˆ°å…¶ä½™å„ç‚¹é—´å‡æœ‰ä¸€æ¡å¼§ï¼Œåˆ™ç§°ä¸ºæœ‰å‘å®Œå…¨å›¾ã€‚(å…±æœ‰å¼§æ•° n*(n-1) )
è‹¥ä¸€ä¸ªå›¾G1æ˜¯ä»Gä¸­é€‰å–éƒ¨åˆ†é¡¶ç‚¹å’Œéƒ¨åˆ†è¾¹ï¼ˆæˆ–å¼§ï¼‰ç»„æˆï¼Œåˆ™ç§°G1æ˜¯Gçš„å­å›¾ã€‚ï¼ˆæ³¨æ„ï¼Œé¡¶ç‚¹å’Œè¾¹å¿…é¡»éƒ½ä¸ºå­å…³ç³»ï¼‰</p></li>
<li><p>è‹¥æ— å‘å›¾ä¸­ä¸¤ä¸ªé¡¶ç‚¹i, jä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ï¼Œåˆ™ç§°i, jç›¸é‚»æ¥ï¼Œå¹¶äº’ä¸ºé‚»æ¥ç‚¹ã€‚
åœ¨æœ‰å‘å›¾ä¸­ï¼Œè‹¥å­˜åœ¨å¼§&lt;Vi, Vj>ï¼Œä¹ŸåšVi, Vjç›¸é‚»æ¥ï¼Œä½†ä¸ºåŒºåˆ«å¼§çš„å¤´ã€å°¾é¡¶ç‚¹ï¼Œå¯è¿›ä¸€æ­¥ç§°åšVié‚»æ¥åˆ°Vjï¼ŒVjé‚»æ¥äºViã€‚</p></li>
</ul>


<p>ä¸ä¸€ä¸ªé¡¶ç‚¹ç›¸é‚»æ¥çš„é¡¶ç‚¹æ•°ç§°ä¸ºè¯¥é¡¶ç‚¹çš„åº¦ã€‚
åœ¨æœ‰å‘å›¾ä¸­ï¼Œè¿›å…¥ä¸€ä¸ªé¡¶ç‚¹çš„å¼§æ•°ç§°ä¸ºè¯¥é¡¶ç‚¹çš„å…¥åº¦ï¼Œä»ä¸€ä¸ªé¡¶ç‚¹å‘å‡ºçš„å¼§æ•°ä¸ºè¯¥é¡¶ç‚¹çš„å‡ºåº¦ï¼Œå¹¶å°†å…¥åº¦å’Œå‡ºåº¦ä¹‹å’Œä½œä¸ºè¯¥é¡¶ç‚¹çš„åº¦ã€‚</p>

<p>ä¸€ä¸ªé¡¶ç‚¹ç»è¿‡ä¸€å®šçš„å¯ç»è·¯ç¨‹åˆ°è¾¾å¦ä¸€ä¸ªé¡¶ç‚¹ï¼Œå°±ä¸ºé¡¶ç‚¹ä¹‹é—´çš„è·¯å¾„ã€‚</p>

<ul>
<li>è‹¥æŸè·¯å¾„æ‰€ç»è¿‡çš„é¡¶ç‚¹ä¸é‡å¤ï¼Œåˆ™ç§°æ­¤è·¯å¾„ä¸ºç®€å•è·¯å¾„ã€‚</li>
<li>è‹¥æŸè·¯å¾„çš„é¦–å°¾ç›¸åŒï¼Œåˆ™ç§°æ­¤è·¯å¾„ä¸ºå›è·¯ï¼ˆæˆ–ç§°ä¸ºç¯ï¼‰ã€‚</li>
<li><p>è‹¥æŸå›è·¯çš„ä¸­é—´ä¸é‡å¤ï¼Œåˆ™ç§°ä¹‹ä¸ºç®€å•å›è·¯ã€‚</p></li>
<li><p>è‹¥æ— å‘å›¾ä¸­ä»»æ„ä¸¤ç‚¹ä¹‹é—´å‡å­˜åœ¨è·¯å¾„ï¼Œåˆ™ç§°Gä¸ºè¿é€šå›¾ï¼Œå¦åˆ™ä¸è¿é€šï¼Œå°±å­˜åœ¨è‹¥å¹²ä¸ªè¿é€šåˆ†é‡ã€‚</p></li>
<li>è‹¥æœ‰å‘å›¾ä¸­ä»»æ„ä¸¤ç‚¹é—´å¯ä»¥äº’ç›¸åˆ°è¾¾ï¼Œåˆ™ç§°ä¸ºå¼ºè¿é€šå›¾ã€‚</li>
</ul>


<p>ä¸€ä¸ªæ— å‘å›¾ï¼Œè¿é€šå¹¶ä¸”æ— å›è·¯ï¼Œç§°è¿™æ ·çš„å›¾ä¸ºæ ‘ã€‚
è‹¥æœ‰å‘å›¾ä¸­ä»…æœ‰ä¸€ä¸ªé¡¶ç‚¹çš„å…¥åº¦ä¸º0ï¼Œå…¶ä½™é¡¶ç‚¹çš„å…¥åº¦éƒ½ä¸º1ï¼Œç§°æ­¤å›¾ä¸ºæœ‰å‘æ ‘ï¼Œå…¥åº¦ä¸º0çš„é¡¶ç‚¹ä¸ºæ ¹ã€‚</p>

<h3>å›¾çš„å­˜å‚¨ç»“æ„ï¼š</h3>

<h5>1ã€‚é‚»æ¥çŸ©é˜µè¡¨ç¤º</h5>

<p>å¯¹nä¸ªé¡¶ç‚¹çš„å›¾æ¥è¯´ï¼Œå…¶é‚»æ¥çŸ©é˜µä¸ºn*né˜¶çš„ã€‚
é‚»æ¥çŸ©é˜µçš„å…ƒç´ å­˜æ”¾è¾¹ï¼ˆå¼§ï¼‰çš„æƒå€¼ï¼Œå¯¹ä¸å­˜åœ¨çš„è¾¹ï¼ˆå¼§ï¼‰ï¼Œåˆ™ç”¨0æˆ–âˆè¡¨ç¤ºã€‚
å®šä¹‰æ ¼å¼å¦‚ä¸‹ï¼š</p>

<pre><code>#define n 6    /* å›¾é¡¶ç‚¹æ•° */ 
#define e 8    /* å›¾çš„è¾¹ï¼ˆå¼§ï¼‰æ•° */
typedef struct
{
    vextype vexs[n];    /* é¡¶ç‚¹ç±»å‹ */
    datatype arcs[n][n];    /* æƒå€¼ç±»å‹ */
} graph; 
</code></pre>

<p>å»ºç«‹ä¸€ä¸ªæ— å‘ç½‘ç»œçš„ç®—æ³•ï¼š</p>

<pre><code>CreateGraph(graph *G) 
{ 
    int i, j, k; 
    float w; 
    for (i=0; i&lt;n; i++) 
        G-&gt;vexs[i] = getchar();    /* è¯»å…¥é¡¶ç‚¹ä¿¡æ¯ï¼Œåˆ›å»ºè¡¨ï¼Œè¿™é‡Œç”¨å­—ç¬¦å‹ */ 
    for (i=0; i&lt;n; i++) 
        for (j=0; j&lt;n; j++) 
            G-&gt;arcs[i][j] = 0;    /* é‚»æ¥çŸ©é˜µåˆå§‹åŒ– */ 
    for (k=0; k&lt;e; k++) 
    { 
        scanf("%d%d%f", &amp;i, &amp;j, &amp;w);    /* è¯»å…¥è¾¹(vi, vj)ä¸Šçš„æƒw(æš‚ç”¨floatç±»å‹) */ 
        G-&gt;arcs[i][j] = w; 
        G-&gt;arcs[j][i] = w; 
    } 
}
</code></pre>

<h5>2.é‚»æ¥è¡¨è¡¨ç¤ºæ³•</h5>

<p>å°†æ¯ä¸ªé¡¶ç‚¹çš„é‚»æ¥ç‚¹è¿æˆé“¾è¡¨ï¼Œå¹¶å°†å„é“¾è¡¨çš„è¡¨å¤´æŒ‡é’ˆåˆåœ¨ä¸€èµ·ï¼ˆç”¨æ•°ç»„æˆ–é“¾è¡¨è¡¨ç¤ºå‡å¯ï¼‰ï¼Œå…¶ä¸­æ¯ä¸ªå¤´æŒ‡é’ˆä¸è¯¥ç»“ç‚¹çš„ä¿¡æ¯åˆä¸ºä¸€ä¸ªæ•´ä½“ç»“ç‚¹ã€‚
å¦‚æœå°†é‚»æ¥è¡¨ä¸­å„é¡¶ç‚¹çš„é‚»æ¥è¡¨å˜ä¸ºå…¶å‰é©±é¡¶ç‚¹å³å¯ï¼Œä»è€Œå¾—åˆ°é€†é‚»æ¥è¡¨ã€‚
ç”¨é‚»æ¥è¡¨å­˜å‚¨ç½‘ç»œæ—¶ï¼Œéœ€è¦å°†å„æ¡è¾¹ï¼ˆå¼§ï¼‰çš„æƒå€¼ä½œä¸ºç›¸åº”é‚»æ¥ç»“ç‚¹ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚
ç»“æ„ï¼š</p>

<pre><code>typedef struct node
{
    int adjvex;    /* é‚»æ¥ç‚¹åŸŸ */
    struct node *next;    /* é“¾åŸŸ */
    datatype arc;    /* æƒå€¼ */
} edgenode;    /* è¾¹è¡¨æŒ‡é’ˆ */
typedef struct
{
    vextype vertex;    /* é¡¶ç‚¹ä¿¡æ¯ */
    edgenode *link;    /* è¾¹è¡¨å¤´æŒ‡é’ˆ */
} vexnode;    /* é¡¶ç‚¹è¡¨ç»“ç‚¹ */
vexnode gnode[n];    /* æ•´ä¸ªå›¾çš„æ„æˆ */
 å»ºç«‹æ— å‘å›¾çš„é‚»æ¥è¡¨ï¼š
CreateAdjlist(gnode)
{
    int i, j, k;
    edgenode *s;
    for (i=0; i&lt;n; i++)    /* è¯»å…¥é¡¶ç‚¹ä¿¡æ¯ */
    {
        gnode[i].vertex = getchar();
        gnode[i].link = NULL;    /* è¾¹è¡¨æŒ‡é’ˆåˆå§‹åŒ– */
    }
    for (k=0; k&lt;e; k++)    /* å»ºç«‹è¾¹è¡¨ */
    {
        scanf("%d%d", &amp;i, &amp;j);    /* è¯»å…¥è¾¹(vi,vj)çš„é¡¶ç‚¹åºå· */
        s = malloc(sizeof(edgenode));    /* ç”Ÿæˆé‚»æ¥ç‚¹åºå·ä¸ºjçš„è¡¨ç»“ç‚¹ */
        s-&gt;adjvex = j;
        s-&gt;next = gnode[i].link;
        gnode[i].link = s;    /* å°†*sæ’å…¥é¡¶ç‚¹viçš„è¾¹è¡¨å¤´éƒ¨(æ’åˆ°å¤´éƒ¨æ¯”å°¾éƒ¨ç®€å•) */
        s = malloc(sizeof(edgenode));    /* ç”Ÿæˆé‚»æ¥ç‚¹åºå·ä¸ºiçš„è¾¹è¡¨ç»“ç‚¹*s */
        s-&gt;adjvex = i;
        s-&gt;next = gnode[j].link;
        gnode[j].link = s;    /* å°†*sæ’å…¥é¡¶ç‚¹vjçš„è¾¹è¡¨å¤´éƒ¨(æœ€åå››è¡Œç”±äºæ˜¯æ— å‘å›¾ï¼Œæ‰€ä»¥ç›¸äº’ï¼Œä¸¤æ¬¡) */
    }
}
</code></pre>

<h3>å›¾çš„éå†ç®—æ³•åŠå…¶åº”ç”¨</h3>

<h5>1.æ·±åº¦éå†</h5>

<ul>
<li>(1)è®¿é—®V0</li>
<li>(2)ä¾æ¬¡ä»V0 çš„å„ä¸ªæœªè¢«è®¿é—®çš„é‚»æ¥ç‚¹å‡ºå‘æ·±åº¦éå†
ï¼ˆä¸¤å¥è¯è¯´çš„éå¸¸æ¸…æ¥šã€‚æ˜¯ä¸€ç§ä»¥æ·±åº¦ä¸ºç»å¯¹ä¼˜å…ˆçš„è®¿é—®ã€‚ï¼‰</li>
</ul>


<h5>2ã€‚æ·±åº¦ä¼˜å…ˆæœç´¢éå†ç®—æ³•</h5>

<p>ç”±äºå®é™…ç®—æ³•æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œç®—æ³•ä¾èµ–ä¸¤ä¸ªå‡½æ•°æ¥æ±‚è§£ï¼ˆå¯¹äºä¸åŒçš„å­˜å‚¨ç»“æ„æœ‰ä¸åŒçš„å†™æ³•ï¼‰
firstadj(G, v)ï¼šè¿”å›å›¾Gä¸­é¡¶ç‚¹vçš„ç¬¬ä¸€ä¸ªé‚»æ¥ç‚¹ã€‚è‹¥ä¸å­˜åœ¨ï¼Œè¿”å›0ã€‚
nextadj(G, v, w)ï¼šè¿”å›å›¾Gä¸­é¡¶ç‚¹vçš„é‚»æ¥ç‚¹ä¸­å¤„äºwä¹‹åçš„é‚£ä¸ªé‚»æ¥ç‚¹ã€‚è‹¥ä¸å­˜åœ¨ï¼Œè¿”å›0ã€‚
depth first search:</p>

<pre><code>void dfs(graph G, int v)
{
    int w;
    visit(v);
    visited[v] = 1;
    w = firstadj(G, v)
    while (w != 0)
    {
        if (visited[w] == 0)
            dfs(w);
        w = nextadj(G, v, w);
    }
}
</code></pre>

<p>å¦‚æœä¸æ˜¯è¿é€šå›¾ï¼Œæˆ–è€…æ˜¯æœ‰å‘å›¾ï¼Œé‚£ä¹ˆè®¿é—®ä¸€ä¸ªvä¸å¯èƒ½éå†æ‰€æœ‰é¡¶ç‚¹ã€‚æ‰€ä»¥ï¼Œéœ€è¦å†é€‰æ‹©æœªè¢«è®¿é—®çš„é¡¶ç‚¹ä½œä¸ºèµ·ç‚¹å†è°ƒç”¨dfs.</p>

<p>æ‰€ä»¥ï¼Œæ·±åº¦éå†å›¾çš„ç®—æ³•å¦‚ä¸‹ï¼š</p>

<pre><code>void dfs_travel(graph G)
{
    int i;
    for (i=1; i&lt;=n; i++)
        visited[i] = 0;        //åˆå§‹åŒ–å„é¡¶ç‚¹çš„è®¿é—®æ ‡å¿—
    for (i=1; i&lt;=n; i++)
        if (visited[i] == 0)
            dfs(G, i);
}
</code></pre>

<h5>3.å¹¿åº¦ä¼˜å…ˆæœç´¢éå†ç®—æ³•</h5>

<p>å¹¿åº¦ä¼˜å…ˆæœç´¢éå†ç®—æ³•(bfs)æ˜¯ä¸€ç§ç”±è¿‘è€Œè¿œçš„å±‚æ¬¡éå†ç®—æ³•ï¼Œä»é¡¶ç‚¹V0å‡ºå‘çš„å¹¿åº¦éå†bfsæè¿°ä¸ºï¼š</p>

<ul>
<li>(1)è®¿é—®V0ï¼ˆå¯ä½œä¸ºè®¿é—®çš„ç¬¬ä¸€å±‚ï¼‰ï¼›</li>
<li>(2)å‡è®¾æœ€è¿‘ä¸€å±‚çš„è®¿é—®é¡¶ç‚¹ä¾æ¬¡ä¸ºV1, V2, &hellip;, Vkï¼Œåˆ™ä¾æ¬¡è®¿é—®ä»–ä»¬çš„æœªè¢«è®¿é—®çš„é‚»æ¥ç‚¹ã€‚</li>
<li>(3)é‡å¤2ï¼Œç›´åˆ°æ‰¾ä¸åˆ°æœªè¢«è®¿é—®çš„é‚»æ¥ç‚¹ä¸ºæ­¢ã€‚</li>
</ul>


<p>ç®—æ³•</p>

<pre><code>void bfs(graph G, int V0)
{
    int w;
    int v;
    queue Q;
    init_queue(Q);
    visit(V0);
    visited[V0] = 1;
    Enqueue(Q, V0);
    while (!empty(Q))
    {
        v = Outqueue(Q);
        w = firstadj(G, v);
        while (w != 0)
        {
            if (visited[w] == 0)
            {
                visit(w);
                visited[w] = 1;
                Enqueue(Q, w);
            }
            w = nextadj(G, v, w);
        }
    }
}
</code></pre>

<p>å¹¿åº¦éå†å›¾çš„ç®—æ³•å’Œæ·±åº¦ä¸€æ ·ï¼š</p>

<pre><code>void bfs_travel(graph G)
{
    int i;
    for (i=1; i&lt;=n; i++)
        visited[i] = 0;
    for (i=1; i&lt;=n; i++)
        if (visited[i] = 0)
            bfs(G, i);
}
</code></pre>

<p>æœ€å°ç”Ÿæˆæ ‘ï¼š</p>

<pre><code>ä»å›¾ä¸­é€‰å–è‹¥å¹²æ¡è¾¹ï¼Œå°†æ‰€æœ‰é¡¶ç‚¹è¿æ¥èµ·æ¥ï¼Œå¹¶ä¸”æ‰€é€‰å–çš„è¿™äº›è¾¹çš„æƒå€¼ä¹‹å’Œæœ€å°ã€‚
</code></pre>

<p>è¿™æ ·æ‰€é€‰å–çš„è¾¹æ„æˆäº†ä¸€æ£µæ ‘ï¼Œç§°è¿™æ ·çš„æ ‘ä¸ºç”Ÿæˆæ ‘ï¼Œç”±äºæƒå€¼æœ€å°ï¼Œç§°ä¸ºæœ€å°ç”Ÿæˆæ ‘ã€‚</p>

<h3>æ„é€ æœ€å°ç”Ÿæˆæ ‘æœ‰ä¸¤ç§æ–¹æ³•ï¼š</h3>

<h6>1.Primç®—æ³•ï¼š</h6>

<pre><code>é¦–å…ˆå°†æ‰€æŒ‡å®šçš„èµ·ç‚¹ä½œä¸ºå·²é€‰é¡¶ç‚¹ï¼Œç„¶ååå¤åœ¨æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„è¾¹ä¸­é€‰æ‹©ä¸€æ¡æœ€å°è¾¹ï¼Œç›´åˆ°æ‰€æœ‰é¡¶ç‚¹æˆä¸ºå·²é€‰é¡¶ç‚¹ä¸ºæ­¢ï¼ˆé€‰æ‹©n-1æ¡è¾¹ï¼‰ï¼šä¸€ç«¯å·²é€‰ï¼Œå¦ä¸€ç«¯æœªé€‰ã€‚
</code></pre>

<p>(ç®€å•çš„è¯´ï¼Œå°±æ˜¯å…ˆä»»é€‰ä¸€ç‚¹ï¼Œç„¶åæ¯æ¬¡é€‰æ‹©ä¸€æ¡æœ€å°æƒå€¼çš„è¾¹ï¼Œè€Œä¸”åªè¿æ¥åˆ°ä¸€ä¸ªå·²é€‰é¡¶ç‚¹)</p>

<h6>2.Kruskalç®—æ³•ï¼š</h6>

<pre><code>åå¤åœ¨æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„è¾¹ä¸­é€‰å‡ºä¸€æ¡æœ€å°çš„ï¼Œå’Œå·²é€‰è¾¹ä¸å¤Ÿæˆå›è·¯ã€‚
(æ¡ä»¶å°±æ˜¯ä¸å¤Ÿæˆå›è·¯å°±OKï¼Œåå¤é€‰æœ€å°è¾¹ï¼ŒçŸ¥é“æ‰€æœ‰é¡¶ç‚¹éƒ½æœ‰è¿æ¥ï¼‰
</code></pre>

<p>æœ€çŸ­è·¯å¾„ï¼š
ä¸€èˆ¬å³æ˜¯è¦ä¸€ä¸ªé¡¶ç‚¹åˆ°å…¶ä½™å„ä¸ªé¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚ï¼ˆæ¯”å¦‚éš”å¾ˆè¿œçš„é¡¶ç‚¹ï¼Œè¦ç»•å“ªå‡ æ¡è¾¹èµ°ï¼‰
æ±‚è§£æ–¹æ³•ï¼š</p>

<pre><code>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç”»ä¸€ä¸ªè¡¨ï¼Œæ¯ä¸ªé¡¶ç‚¹æœ‰pathå’Œdistä¸¤ä¸ªå€¼ï¼Œåˆ†åˆ«ç”¨æ¥å­˜å‚¨åˆ°å„ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼ˆæ¯”å¦‚(1,5,6)ï¼Œå°±æ˜¯1-5-6è¿™ä¸ªè·¯å¾„ï¼‰å’Œç›¸åº”çš„é•¿åº¦ï¼ˆåˆ°è¯¥ç‚¹çš„æƒå€¼ä¹‹å’Œï¼‰ã€‚
</code></pre>

<ul>
<li>(1)å¯¹Vä»¥å¤–çš„å„é¡¶ç‚¹ï¼Œè‹¥ä¸¤ç‚¹é—´çš„é‚»æ¥è·¯å¾„å­˜åœ¨ï¼Œåˆ™å°†å…¶ä½œä¸ºæœ€çŸ­è·¯å¾„å’Œæœ€çŸ­é•¿åº¦å­˜åˆ°path[v]å’Œdist[v]ä¸­ã€‚(å®é™…ä¸Šä¹Ÿå°±æ˜¯æœ€å¼€å§‹å¯¹é¡¶ç‚¹çš„ç›´æ¥åç»§è¿›è¡Œå¤„ç†ï¼‰</li>
<li>(2)ä»æœªè§£é¡¶ç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªdistå€¼æœ€å°çš„é¡¶ç‚¹vï¼Œåˆ™å½“å‰çš„path[v]å’Œdist[v]å°±æ˜¯é¡¶ç‚¹vçš„æœ€ç»ˆè§£ï¼ˆä»è€Œä½¿væˆä¸ºå·²è§£é¡¶ç‚¹ï¼‰ã€‚</li>
<li>(3)å¦‚æœvçš„ç›´æ¥åç»§ç»è¿‡vä¼šæ›´è¿‘ä¸€äº›ï¼Œåˆ™ä¿®æ”¹vçš„ç›´æ¥åç»§çš„pathå’Œdistå€¼ã€‚</li>
</ul>


<p>(ä¸Šé¢çš„ç¡®æ˜¯å¾ˆéš¾æ‡‚ï¼Œåªèƒ½é€šè¿‡ä¾‹å­è‡ªå·±æ…¢æ…¢ç†Ÿæ‚‰ã€‚ï¼‰</p>

<h1>æŸ¥æ‰¾</h1>

<blockquote><p>åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œé€šå¸¸æ˜¯å°†å¾…æŸ¥æ‰¾çš„æ•°æ®å…ƒç´ é›†ä»¥æŸç§è¡¨çš„å½¢å¼ç»™å‡ºï¼Œä»è€Œæ„æˆä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼ï¼æŸ¥æ‰¾è¡¨ã€‚
è¡¨åŒ…æ‹¬ä¸€äº›â€œå…ƒç´ â€ï¼Œâ€œå­—æ®µâ€ç­‰ç­‰æ¦‚å¿µã€‚</p></blockquote>

<p>åœ¨ä¸€ä¸ªæ•°æ®è¡¨ä¸­ï¼Œè‹¥æŸå­—æ®µçš„å€¼å¯ä»¥æ ‡è¯†ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼Œåˆ™ç§°ä¹‹ä¸ºå…³é”®å­—ï¼ˆæˆ–é”®ï¼‰ã€‚
è‹¥æ­¤å…³é”®å­—çš„æ¯ä¸ªå€¼å‡å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç§°ä¹‹ä¸ºä¸»å…³é”®å­—ï¼Œå¦åˆ™ï¼Œè‹¥è¯¥å…³é”®å­—å¯ä»¥æ ‡è¯†è‹¥å¹²ä¸ªå…ƒç´ ï¼Œåˆ™ç§°ä¹‹ä¸ºæ¬¡å…³é”®å­—ã€‚</p>

<p>æŸ¥æ‰¾ç®—æ³•çš„æ—¶é—´æ€§èƒ½ä¸€èˆ¬ä»¥æŸ¥æ‰¾æ¬¡æ•°æ¥è¡¡é‡ã€‚æ‰€è°“æŸ¥æ‰¾é•¿åº¦æ˜¯æŒ‡æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ æ‰€è¿›è¡Œçš„å…³é”®å­—çš„æ¯”è¾ƒæ¬¡æ•°ã€‚å¸¸ä»¥å¹³å‡æŸ¥æ‰¾æ¬¡æ•°ã€æœ€å¤§æŸ¥æ‰¾æ¬¡æ•°æ¥è¡¡é‡æŸ¥æ‰¾ç®—æ³•çš„æ€§èƒ½ã€‚</p>

<h5>ä¸€ã€ç®€å•é¡ºåºæŸ¥æ‰¾</h5>

<pre><code>int seq_seach(elementtype A[], int n, keytype x)
{
    int i;
    A[0].key = x;        //è®¾å®šç›‘è§†å“¨
    for (i=n; A[i].key!=x; i--);
    return i;
}
</code></pre>

<p>ç›‘è§†å“¨æ˜¯ä¸€ä¸ªå°æŠ€å·§ï¼ŒæŸ¥æ‰¾å¤±è´¥æ—¶ï¼Œè¿™é‡Œè®¾å®šçš„æ•°æ®æ˜¯A[1]-A[n]ï¼Œè‚¯å®šå¯ä»¥åœ¨A[0]ä¸­æ‰¾åˆ°è¯¥å…ƒç´ ï¼Œå¹¶è¿”å›0è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥ã€‚å¦‚æœä¸è®¾å®šç›‘è§†å“¨ï¼Œåˆ™åœ¨æ¯æ¬¡å¾ªç¯ä¸­è¦åˆ¤æ–­ä¸‹æ ‡æ˜¯å¦è¶Šç•Œï¼šfor (i=1; i!=n&amp;&amp;A[i].key!=x;i&ndash;); å¯ä»¥èŠ‚çœä¸€åŠçš„æ—¶é—´ã€‚</p>

<h5>äºŒã€æœ‰åºè¡¨çš„äºŒåˆ†æŸ¥æ‰¾</h5>

<pre><code>int bin_search(elementtype A[], int n, keytype x)
{
    int mid, low, high;
    low = 0;
    high = n - 1;
    while (low &lt;= high)
    {
        mid = (low + high) / 2;
        if (x == A[mid].key)
            return mid;
        else if (x &lt; A[mid].key)
            high = mid - 1;
        else
            low = mid + 1;
    }
    return -1;
}
</code></pre>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨é€’å½’ç®—æ³•ï¼š</p>

<pre><code>int bin_search(elementtype A[], int low, int high, keytype x)
{
    int mid;
    if (low &lt; high)
        return -1;
    else
    {
        mid = (low + high) / 2;
        if (x == A[mid].key)
            return mid;
        else if (x &lt; A[mid],key)
            return bin_search(A, low, mid - 1, x);
        else
            return bin_search(A, mid - 1, high, x);
    }
}
</code></pre>

<h1>æ’åº</h1>

<ul>
<li>å¢æ’åºå’Œå‡æ’åºï¼šå¦‚æœæ’åºçš„ç»“æœæ˜¯æŒ‰å…³é”®å­—ä»å°åˆ°å¤§çš„æ¬¡åºæ’åˆ—çš„ï¼Œå°±æ˜¯å¢æ’åºï¼Œå¦åˆ™å°±æ˜¯å‡æ’åºã€‚</li>
<li>å†…éƒ¨æ’åºå’Œå¤–éƒ¨æ’åºï¼šå¦‚æœåœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¡¨ä¸­æ‰€æœ‰æ•°æ®å‡åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œåˆ™è¿™ç±»æ’åºä¸ºå†…éƒ¨æ’åºï¼Œå¦åˆ™å°±æ˜¯å¤–éƒ¨æ’åºã€‚</li>
<li>ç¨³å®šæ’åºå’Œä¸ç¨³å®šæ’åºï¼šåœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå…³é”®å­—ç›¸åŒçš„ä¸¤ä¸ªå…ƒç´ çš„ç›¸å¯¹æ¬¡åºä¸å˜ï¼Œåˆ™ç§°ä¸ºç¨³å®šæ’åºï¼Œå¦åˆ™æ˜¯ä¸ç¨³å®šæ’åºã€‚</li>
</ul>


<p>åœ¨åˆ†æç®—æ³•çš„æ—¶é—´æ€§èƒ½æ—¶ï¼Œä¸»è¦ä»¥ç®—æ³•ä¸­ç”¨çš„æœ€å¤šçš„åŸºæœ¬æ“ä½œçš„æ‰§è¡Œæ¬¡æ•°ï¼ˆæˆ–è€…å…¶æ•°é‡çº§ï¼‰æ¥è¡¡é‡ï¼Œè¿™äº›æ“ä½œä¸»è¦æ˜¯æ¯”è¾ƒã€ç§»åŠ¨å’Œäº¤æ¢å…ƒç´ ã€‚æœ‰æ—¶ï¼Œå¯èƒ½è¦ç”¨è¿™äº›æ¬¡æ•°çš„å¹³å‡æ•°æ¥è¡¨ç¤ºã€‚</p>

<h3>ä¸€ã€æ’å…¥æ’åº</h3>

<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<blockquote><p>æŠŠæ•´ä¸ªå¾…æ’åºå­è¡¨çœ‹ä½œæ˜¯å·¦å³ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­å·¦è¾¹ä¸ºæœ‰åºåŒºï¼Œå³è¾¹ä¸ºæ— åºåŒºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å°±æ˜¯æŠŠå³è¾¹æ— åºåŒºä¸­çš„å…ƒç´ é€ä¸ªæ’å…¥åˆ°å·¦è¾¹çš„æœ‰åºåŒºä¸­ï¼Œä»¥æ„æˆæ–°çš„æœ‰åºåŒºã€‚
å®é™…ä¸­ï¼Œå¼€å§‹æ’åºæ—¶æŠŠç¬¬ä¸€ä¸ªå…ƒç´ A[0]ï¼ˆæˆ–A[1]ï¼‰çœ‹ä½œå·¦è¾¹çš„æœ‰åºåŒºï¼Œç„¶åæŠŠå‰©ä¸‹çš„2ï½Nä¸ªå…ƒç´ ä¾æ¬¡æ’å…¥åˆ°æœ‰åºè¡¨ä¸­ã€‚</p></blockquote>

<pre><code>void insert_sort(elementtype A[n+1])
{
    int i;
    for (i=2; i&lt;=n; i++)
    {
        A[0] = A[i];        //è®¾ç½®ç›‘è§†å“¨ï¼Œè¿™ä¸ªæ•°ç»„åŒæ ·æ˜¯ä»1å¼€å§‹ï¼ŒA[0]å°±è®¾ä¸ºç›‘è§†å“¨
        j = i - 1;
        while (A[j].key &gt; A[0].key)
        {
            A[j + 1] = A[j];
            j--;
        }
        A[j + 1] = A[0];
    }
}
</code></pre>

<p>æ˜ç™½è¿™ç§æ–¹æ³•çš„ç®€å•åŸç†ï¼š
a1 a2 a3 &hellip; a(i-1) ai &hellip;
å…ˆå°†aiä¸´æ—¶ä¿å­˜èµ·æ¥ï¼Œç„¶åæŠŠa(i-1)å‘å‰åªè¦æ˜¯æ¯”aiå¤§çš„å‘åç§»ï¼Œå†æŠŠaiå¡«è¿›å»å³å¯ã€‚</p>

<h3>äºŒã€å¿«é€Ÿæ’åº</h3>

<p>é€Ÿåº¦æœ€å¿«çš„åŠæ³•ï¼ä¸€å®šè¦æŒæ¡ï¼Œè€ƒè¯•é‡ç‚¹ã€‚</p>

<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<blockquote><p>é¦–å…ˆï¼Œé€‰å®šä¸€ä¸ªå…ƒç´ ä½œä¸ºä¸­é—´å…ƒç´ ï¼Œç„¶åå°†è¡¨ä¸­æ‰€æœ‰å…ƒç´ ä¸è¯¥ä¸­é—´å…ƒç´ ç›¸æ¯”è¾ƒï¼Œå°†è¡¨ä¸­æ¯”ä¸­é—´å…ƒç´ å°çš„å…ƒç´ è°ƒåˆ°è¡¨çš„å‰é¢ï¼Œå°†æ¯”ä¸­é—´å…ƒç´ å¤§çš„å…ƒç´ è°ƒåˆ°åé¢ï¼Œå†å°†ä¸­é—´æ•°æ”¾åœ¨è¿™ä¸¤éƒ¨åˆ†ä¹‹é—´ä½œä¸ºåˆ†ç•Œç‚¹ï¼Œè¿™æ ·ä¾¿å¾—åˆ°ä¸€ä¸ªåˆ’åˆ†ï¼›ç„¶åå†å¯¹å·¦å³ä¸¤éƒ¨åˆ†åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œå¦‚æ­¤åå¤ï¼Œç›´åˆ°æ¯ä¸ªå­è¡¨ä»…æœ‰ä¸€ä¸ªå…ƒç´ æˆ–ç©ºè¡¨ä¸ºæ­¢ã€‚
ä¸­é—´æ•°ä¸€èˆ¬é€‰æ‹©éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p></blockquote>

<pre><code>int partition(elementtype A[n], int s, int t)    //s,tæ˜¯è¦æ’åºå…ƒç´ çš„èµ·ç‚¹å’Œç»ˆç‚¹,å¹¶è¿”å›æœ€åä¸­é—´å…ƒç´ ä½ç½®
{
    elementtype x = A[s];    //ä¿å­˜ä¸­é—´å…ƒç´ åˆ°ä¸´æ—¶å˜é‡x,ä»¥è…¾å‡ºç©ºä½
    int i = s;                        //ç½®ä¸¤ç«¯æœç´¢ä½ç½®çš„åˆå€¼
    int j = t;
    while (i != j)        //ä¸¤ç«¯ä½ç½®é‡å’Œå†åœæ­¢
    {
        while (i &lt; j &amp;&amp; A[j].key &gt; x.key) j--;    //ä»åé¢æœç´¢â€œå°â€çš„å…ƒç´ 
        if (i &lt; j)        //å¦‚æœæ‰¾åˆ°ï¼Œå°±è°ƒåˆ°å‰é¢çš„ç©ºä½ä¸­
        {
            A[i] = A[j];
            i++;
        }
        while (i &lt; j &amp;&amp; A[i].key &lt; x.key) i++;    //ä»å‰é¢æœç´¢â€œå¤§â€çš„å…ƒç´ 
        if (i &lt; j)        //å¦‚æœæ‰¾åˆ°ï¼Œè°ƒåˆ°åé¢çš„ç©ºä½ä¸­
        {
            A[j] = A[i];
            j--;
        }
    }
    A[i] = x;        //å°†ä¸­é—´æ•°ç§»åˆ°æœ€ç»ˆä½ç½®ä¸Š
    return i;
}
</code></pre>

<p>æ•´ä¸ªç®—æ³•ï¼š</p>

<pre><code>void quick_sort(elementtype A[n], int s, int t)    //å¯¹æ•°ç»„ä¸­ä¸‹æ ‡ä»såˆ°tçš„éƒ¨åˆ†è¿›è¡Œå¿«é€Ÿæ’åºï¼Œå¦‚æœæ˜¯æ•´ä¸ªè¡¨å°±æ˜¯0, n-1
{
    int i;
    if (s &lt; t)    //è¡¨ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªå…ƒç´ æ—¶
    {
        i = partition(A, s, t);    //åˆ’åˆ†æ’åºä¸€æ¬¡
        quick_sort(A, i + 1, t);    //å¯¹åé¢éƒ¨åˆ†å¿«é€Ÿæ’åº
        quick_sort(A, s, i - 1);    //å¯¹å‰é¢éƒ¨åˆ†å¿«é€Ÿæ’åº
    }
}
</code></pre>

<h3>ä¸‰ã€é€‰æ‹©æ’åºï¼š</h3>

<p>åœ¨å¾…æ’åºå­è¡¨ä¸­å®Œæ•´åœ°æ¯”è¾ƒä¸€éä»¥ç¡®å®šæœ€å¤§ï¼ˆå°ï¼‰å…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ”¾åœ¨å­è¡¨çš„æœ€å‰ï¼ˆåï¼‰é¢ã€‚
ã€æ³¨ï¼šå¯èƒ½å‘è§‰å’Œå†’æ³¡æ³•æ¯”è¾ƒç±»ä¼¼ï¼Œä½†æ³¨æ„é€‰æ‹©æ³•æ˜¯å…¨éƒ¨æ¯”è¾ƒä¸€éï¼Œæ‰¾åˆ°æœ€å°å…ƒç´ çš„ä¸‹æ ‡ï¼Œå†è¿›è¡Œä¸€æ¬¡äº¤æ¢ï¼Œè€Œå†’æ³¡åˆ™æ˜¯è¿›è¡Œå¤šæ¬¡äº¤æ¢ã€‘</p>

<pre><code>void select_sort(elementtype A[n])
{
   int min, i, j;
   elementtype temp;
   for (i=0; i&lt;n-1; i++)
   {
      min = i;
      for (j=i+1; j&lt;n; j++)
         if (A[min].key &gt; A[j].key) min = j;
      if (min != i)
      {
         temp = A[i];
         A[i] = A[min];
         A[min] = temp;
      }
   }
}
</code></pre>

<h3>å››ã€å½’å¹¶æ’åº</h3>

<p>æ‰€è°“å½’å¹¶æ˜¯æŒ‡å°†ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„æœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºè¡¨ã€‚
å½’å¹¶ç®—æ³•ï¼š</p>

<p>å‡è®¾ä¸¤ä¸ªåºåˆ—A[m]å’ŒB[n]ä¸ºéé™åºåˆ—ï¼ˆå³å­˜åœ¨ç›¸åŒå…ƒç´ çš„å‡åºåˆ—ï¼‰ï¼Œç°è¦æŠŠä»–ä»¬åˆå¹¶ä¸ºä¸€ä¸ªéé™åºåˆ—C[m+n]ã€‚</p>

<pre><code>void merge(elementtype A[], elementtype B[], elementtype C[], int m, int n)
{
    int ia = 0, ib = 0, ic = 0;
    while (ia &lt; m &amp;&amp; ib &lt; n)
        if (A[ia] &lt;= B[ib])
            C[ic++] = A[ia++];
        else
            C[ic++] = B[ib++];
    while (ia &lt; m)
        C[ic++] = A[ia++];
    while (ib &lt; n)
        C[ic++] = B[ib++];
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-ç®—æ³•ä¹‹ç²¾å-ç®—æ³•&amp;å†’æ³¡]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/25/xiu-xing-pian-suan-fa-zhi-jing-hua-suan-fa-and-mou-pao/"/>
    <updated>2016-08-25T12:32:56+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/25/xiu-xing-pian-suan-fa-zhi-jing-hua-suan-fa-and-mou-pao</id>
    <content type="html"><![CDATA[<ul>
<li><p>å†’æ³¡æ’åºï¼ˆäº¤æ¢ï¼‰</p>

<ul>
<li>æ”¹è¿›</li>
</ul>
</li>
<li><p>å¿«é€Ÿæ’åºï¼ˆäº¤æ¢ï¼‰</p>

<ul>
<li>æ”¹è¿›</li>
</ul>
</li>
</ul>


<h2>äº¤æ¢æ’åºâ€”å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰</h2>

<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<blockquote><p>åœ¨è¦æ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œå¯¹å½“å‰è¿˜æœªæ’å¥½åºçš„èŒƒå›´å†…çš„å…¨éƒ¨æ•°ï¼Œè‡ªä¸Šè€Œä¸‹å¯¹ç›¸é‚»çš„ä¸¤ä¸ªæ•°ä¾æ¬¡è¿›è¡Œæ¯”è¾ƒå’Œè°ƒæ•´ï¼Œè®©è¾ƒå¤§çš„æ•°å¾€ä¸‹æ²‰ï¼Œè¾ƒå°çš„å¾€ä¸Šå†’ã€‚å³ï¼šæ¯å½“ä¸¤ç›¸é‚»çš„æ•°æ¯”è¾ƒåå‘ç°å®ƒä»¬çš„æ’åºä¸æ’åºè¦æ±‚ç›¸åæ—¶ï¼Œå°±å°†å®ƒä»¬äº’æ¢ã€‚
ç®—æ³•çš„å®ç°ï¼š</p></blockquote>

<pre><code>void bubbleSort(int a[], int n){  
    for(int i =0 ; i&lt; n-1; ++i) {  
        for(int j = 0; j &lt; n-i-1; ++j) {  
            if(a[j] &gt; a[j+1])  
            {  
                int tmp = a[j] ; a[j] = a[j+1] ;  a[j+1] = tmp;  
            }  
        }  
    }  
}  
</code></pre>

<h4>æ”¹è¿›</h4>

<!--more-->


<blockquote><p>å¯¹å†’æ³¡æ’åºå¸¸è§çš„æ”¹è¿›æ–¹æ³•æ˜¯åŠ å…¥ä¸€æ ‡å¿—æ€§å˜é‡exchangeï¼Œç”¨äºæ ‡å¿—æŸä¸€è¶Ÿæ’åºè¿‡ç¨‹ä¸­æ˜¯å¦æœ‰æ•°æ®äº¤æ¢ï¼Œå¦‚æœè¿›è¡ŒæŸä¸€è¶Ÿæ’åºæ—¶å¹¶æ²¡æœ‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œåˆ™è¯´æ˜æ•°æ®å·²ç»æŒ‰è¦æ±‚æ’åˆ—å¥½ï¼Œå¯ç«‹å³ç»“æŸæ’åºï¼Œé¿å…ä¸å¿…è¦çš„æ¯”è¾ƒè¿‡ç¨‹ã€‚æœ¬æ–‡å†æä¾›ä»¥ä¸‹ä¸¤ç§æ”¹è¿›ç®—æ³•ï¼š</p></blockquote>

<p>1ï¼è®¾ç½®ä¸€æ ‡å¿—æ€§å˜é‡pos,ç”¨äºè®°å½•æ¯è¶Ÿæ’åºä¸­æœ€åä¸€æ¬¡è¿›è¡Œäº¤æ¢çš„ä½ç½®ã€‚ç”±äºposä½ç½®ä¹‹åçš„è®°å½•å‡å·²äº¤æ¢åˆ°ä½,æ•…åœ¨è¿›è¡Œä¸‹ä¸€è¶Ÿæ’åºæ—¶åªè¦æ‰«æåˆ°posä½ç½®å³å¯ã€‚
æ”¹è¿›åç®—æ³•å¦‚ä¸‹:</p>

<pre><code>void Bubble_1 ( int r[], int n) {  
    int i= n -1;  //åˆå§‹æ—¶,æœ€åä½ç½®ä¿æŒä¸å˜  
    while ( i&gt; 0) {   
        int pos= 0; //æ¯è¶Ÿå¼€å§‹æ—¶,æ— è®°å½•äº¤æ¢  
        for (int j= 0; j&lt; i; j++)  
            if (r[j]&gt; r[j+1]) {  
                pos= j; //è®°å½•äº¤æ¢çš„ä½ç½®   
                int tmp = r[j]; r[j]=r[j+1];r[j+1]=tmp;  
            }   
        i= pos; //ä¸ºä¸‹ä¸€è¶Ÿæ’åºä½œå‡†å¤‡  
     }   
}    
</code></pre>

<p>2ï¼ä¼ ç»Ÿå†’æ³¡æ’åºä¸­æ¯ä¸€è¶Ÿæ’åºæ“ä½œåªèƒ½æ‰¾åˆ°ä¸€ä¸ªæœ€å¤§å€¼æˆ–æœ€å°å€¼,æˆ‘ä»¬è€ƒè™‘åˆ©ç”¨åœ¨æ¯è¶Ÿæ’åºä¸­è¿›è¡Œæ­£å‘å’Œåå‘ä¸¤éå†’æ³¡çš„æ–¹æ³•ä¸€æ¬¡å¯ä»¥å¾—åˆ°ä¸¤ä¸ªæœ€ç»ˆå€¼(æœ€å¤§è€…å’Œæœ€å°è€…) , ä»è€Œä½¿æ’åºè¶Ÿæ•°å‡ ä¹å‡å°‘äº†ä¸€åŠã€‚
æ”¹è¿›åçš„ç®—æ³•å®ç°ä¸º:</p>

<pre><code>void Bubble_2 ( int r[], int n){  
    int low = 0;   
    int high= n -1; //è®¾ç½®å˜é‡çš„åˆå§‹å€¼  
    int tmp,j;  
    while (low &lt; high) {  
        for (j= low; j&lt; high; ++j) //æ­£å‘å†’æ³¡,æ‰¾åˆ°æœ€å¤§è€…  
            if (r[j]&gt; r[j+1]) {  
                tmp = r[j]; r[j]=r[j+1];r[j+1]=tmp;  
            }   
        --high;                 //ä¿®æ”¹highå€¼, å‰ç§»ä¸€ä½  
        for ( j=high; j&gt;low; --j) //åå‘å†’æ³¡,æ‰¾åˆ°æœ€å°è€…  
            if (r[j]&lt;r[j-1]) {  
                tmp = r[j]; r[j]=r[j-1];r[j-1]=tmp;  
            }  
        ++low;                  //ä¿®æ”¹lowå€¼,åç§»ä¸€ä½  
    }   
}   
</code></pre>

<h2>äº¤æ¢æ’åºâ€”å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰</h2>

<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<ul>
<li><p>1ï¼‰é€‰æ‹©ä¸€ä¸ªåŸºå‡†å…ƒç´ ,é€šå¸¸é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ æˆ–è€…æœ€åä¸€ä¸ªå…ƒç´ ,</p></li>
<li><p>2ï¼‰é€šè¿‡ä¸€è¶Ÿæ’åºè®²å¾…æ’åºçš„è®°å½•åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…ƒç´ å€¼å‡æ¯”åŸºå‡†å…ƒç´ å€¼å°ã€‚å¦ä¸€éƒ¨åˆ†è®°å½•çš„ å…ƒç´ å€¼æ¯”åŸºå‡†å€¼å¤§ã€‚</p></li>
<li><p>3ï¼‰æ­¤æ—¶åŸºå‡†å…ƒç´ åœ¨å…¶æ’å¥½åºåçš„æ­£ç¡®ä½ç½®</p></li>
<li><p>4ï¼‰ç„¶ååˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç”¨åŒæ ·çš„æ–¹æ³•ç»§ç»­è¿›è¡Œæ’åºï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚</p></li>
</ul>


<p>ç®—æ³•çš„å®ç°ï¼š
 é€’å½’å®ç°ï¼š</p>

<pre><code>void print(int a[], int n){  
    for(int j= 0; j&lt;n; j++){  
        cout&lt;&lt;a[j] &lt;&lt;"  ";  
    }  
    cout&lt;&lt;endl;  
}  

void swap(int *a, int *b)  
{  
    int tmp = *a;  
    *a = *b;  
    *b = tmp;  
}  
int partition(int a[], int low, int high)  
{  
    int privotKey = a[low];                             //åŸºå‡†å…ƒç´   
    while(low &lt; high){                                   //ä»è¡¨çš„ä¸¤ç«¯äº¤æ›¿åœ°å‘ä¸­é—´æ‰«æ  
        while(low &lt; high  &amp;&amp; a[high] &gt;= privotKey) --high;  //ä»high æ‰€æŒ‡ä½ç½®å‘å‰æœç´¢ï¼Œè‡³å¤šåˆ°low+1 ä½ç½®ã€‚å°†æ¯”åŸºå‡†å…ƒç´ å°çš„äº¤æ¢åˆ°ä½ç«¯  
        swap(&amp;a[low], &amp;a[high]);  
        while(low &lt; high  &amp;&amp; a[low] &lt;= privotKey ) ++low;  
        swap(&amp;a[low], &amp;a[high]);  
    }  
    print(a,10);  
    return low;  
}  
void quickSort(int a[], int low, int high){  
    if(low &lt; high){  
        int privotLoc = partition(a,  low,  high);  //å°†è¡¨ä¸€åˆ†ä¸ºäºŒ  
        quickSort(a,  low,  privotLoc -1);          //é€’å½’å¯¹ä½å­è¡¨é€’å½’æ’åº  
        quickSort(a,   privotLoc + 1, high);        //é€’å½’å¯¹é«˜å­è¡¨é€’å½’æ’åº  
    }  
}  
int main(){  
    int a[10] = {3,1,5,7,2,4,9,6,10,8};  
    cout&lt;&lt;"åˆå§‹å€¼ï¼š";  
    print(a,10);  
    quickSort(a,0,9);  
    cout&lt;&lt;"ç»“æœï¼š";  
    print(a,10);  

}  
</code></pre>

<p>åˆ†æï¼š</p>

<blockquote><p>å¿«é€Ÿæ’åºæ˜¯é€šå¸¸è¢«è®¤ä¸ºåœ¨åŒæ•°é‡çº§ï¼ˆO(nlog2n)ï¼‰çš„æ’åºæ–¹æ³•ä¸­å¹³å‡æ€§èƒ½æœ€å¥½çš„ã€‚ä½†è‹¥åˆå§‹åºåˆ—æŒ‰å…³é”®ç æœ‰åºæˆ–åŸºæœ¬æœ‰åºæ—¶ï¼Œå¿«æ’åºåè€Œèœ•åŒ–ä¸ºå†’æ³¡æ’åºã€‚ä¸ºæ”¹è¿›ä¹‹ï¼Œé€šå¸¸ä»¥â€œä¸‰è€…å–ä¸­æ³•â€æ¥é€‰å–åŸºå‡†è®°å½•ï¼Œå³å°†æ’åºåŒºé—´çš„ä¸¤ä¸ªç«¯ç‚¹ä¸ä¸­ç‚¹ä¸‰ä¸ªè®°å½•å…³é”®ç å±…ä¸­çš„è°ƒæ•´ä¸ºæ”¯ç‚¹è®°å½•ã€‚å¿«é€Ÿæ’åºæ˜¯ä¸€ä¸ªä¸ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚
å¿«é€Ÿæ’åºçš„æ”¹è¿›</p></blockquote>

<h4>æ”¹è¿›</h4>

<p>åœ¨æœ¬æ”¹è¿›ç®—æ³•ä¸­,åªå¯¹é•¿åº¦å¤§äºkçš„å­åºåˆ—é€’å½’è°ƒç”¨å¿«é€Ÿæ’åº,è®©åŸåºåˆ—åŸºæœ¬æœ‰åºï¼Œç„¶åå†å¯¹æ•´ä¸ªåŸºæœ¬æœ‰åºåºåˆ—ç”¨æ’å…¥æ’åºç®—æ³•æ’åºã€‚å®è·µè¯æ˜ï¼Œæ”¹è¿›åçš„ç®—æ³•æ—¶é—´å¤æ‚åº¦æœ‰æ‰€é™ä½ï¼Œä¸”å½“kå–å€¼ä¸º 8 å·¦å³æ—¶,æ”¹è¿›ç®—æ³•çš„æ€§èƒ½æœ€ä½³ã€‚ç®—æ³•æ€æƒ³å¦‚ä¸‹ï¼š</p>

<pre><code>void print(int a[], int n){  
    for(int j= 0; j&lt;n; j++){  
        cout&lt;&lt;a[j] &lt;&lt;"  ";  
    }  
    cout&lt;&lt;endl;  
}  
void swap(int *a, int *b)  
{  
    int tmp = *a;  
    *a = *b;  
    *b = tmp;  
}  
int partition(int a[], int low, int high)  
{  
    int privotKey = a[low];                 //åŸºå‡†å…ƒç´   
    while(low &lt; high){                   //ä»è¡¨çš„ä¸¤ç«¯äº¤æ›¿åœ°å‘ä¸­é—´æ‰«æ  
        while(low &lt; high  &amp;&amp; a[high] &gt;= privotKey) --high; //ä»high æ‰€æŒ‡ä½ç½®å‘å‰æœç´¢ï¼Œè‡³å¤šåˆ°low+1 ä½ç½®ã€‚å°†æ¯”åŸºå‡†å…ƒç´ å°çš„äº¤æ¢åˆ°ä½ç«¯  
        swap(&amp;a[low], &amp;a[high]);  
        while(low &lt; high  &amp;&amp; a[low] &lt;= privotKey ) ++low;  
        swap(&amp;a[low], &amp;a[high]);  
    }  
    print(a,10);  
    return low;  
}  
void qsort_improve(int r[ ],int low,int high, int k){  
    if( high -low &gt; k ) { //é•¿åº¦å¤§äºkæ—¶é€’å½’, kä¸ºæŒ‡å®šçš„æ•°  
        int pivot = partition(r, low, high); // è°ƒç”¨çš„Partitionç®—æ³•ä¿æŒä¸å˜  
        qsort_improve(r, low, pivot - 1,k);  
        qsort_improve(r, pivot + 1, high,k);  
    }   
}   
void quickSort(int r[], int n, int k){  
    qsort_improve(r,0,n,k);//å…ˆè°ƒç”¨æ”¹è¿›ç®—æ³•Qsortä½¿ä¹‹åŸºæœ¬æœ‰åº  
    //å†ç”¨æ’å…¥æ’åºå¯¹åŸºæœ¬æœ‰åºåºåˆ—æ’åº  
    for(int i=1; i&lt;=n;i ++){  
        int tmp = r[i];   
        int j=i-1;  
        while(tmp &lt; r[j]){  
            r[j+1]=r[j]; j=j-1;   
        }  
        r[j+1] = tmp;  
    }   

}   
int main(){  
    int a[10] = {3,1,5,7,2,4,9,6,10,8};  
    cout&lt;&lt;"åˆå§‹å€¼ï¼š";  
    print(a,10);  
    quickSort(a,9,4);  
    cout&lt;&lt;"ç»“æœï¼š";  
    print(a,10);  

}  
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-23ç§è®¾è®¡æ¨¡å¼]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/23/xiu-xing-pian-23chong-she-ji-mo-shi/"/>
    <updated>2016-08-23T12:32:39+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/23/xiu-xing-pian-23chong-she-ji-mo-shi</id>
    <content type="html"><![CDATA[<h2>è®¾è®¡æ¨¡å¼</h2>

<p>æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p>

<ul>
<li><p>åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚</p></li>
<li><p>ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼šé€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚</p></li>
<li><p>è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼šç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€‚</p>

<ul>
<li>å…¶å®è¿˜æœ‰ä¸¤ç±»ï¼šå¹¶å‘å‹æ¨¡å¼å’Œçº¿ç¨‹æ± æ¨¡å¼ã€‚</li>
</ul>
</li>
</ul>


<!--more-->


<h2>åˆ›å»ºå‹æ¨¡å¼</h2>

<h3>å·¥å‚æ–¹æ³•æ¨¡å¼</h3>

<p>ç®€å•å·¥å‚æ¨¡å¼çš„æœ€å¤§ä¼˜ç‚¹åœ¨äºå·¥å‚ç±»ä¸­åŒ…å«äº†å¿…è¦çš„é€»è¾‘åˆ¤æ–­ï¼Œæ ¹æ®å®¢æˆ·ç«¯è¾“å…¥çš„é€‰æ‹©æ¡ä»¶åŠ¨æ€çš„å®ä¾‹åŒ–ç›¸å…³çš„ç±»ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå»é™¤äº†ä¸å…·ä½“äº§å“çš„ä¾èµ–ã€‚</p>

<p>ä½†æ˜¯ç®€å•å·¥å‚æ–¹æ³•è¿èƒŒäº†å¼€æ”¾â€”â€”å°é—­æ¨¡å¼ã€‚</p>

<h6>1ã€æ€æƒ³</h6>

<pre><code>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚å·¥å‚æ–¹æ³•ä½¿ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> æ ¸å¿ƒå·¥å‚ç±»ä¸å†è´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»ºï¼Œè€Œæ˜¯å°†å…·ä½“åˆ›å»ºçš„å·¥ä½œäº¤ç»™äº†å­ç±»å»åšï¼Œæˆä¸ºä¸€ä¸ªæŠ½è±¡å·¥å‚è§’è‰²ï¼Œä»…ä»…è´Ÿè´£å…·ä½“å·¥å‚ç±»å¿…é¡»å®ç°çš„æ¥å£ï¼Œè€Œä¸æ¥è§¦å“ªä¸€ä¸ªäº§å“ç±»åº”å½“è¢«å®ä¾‹åŒ–çš„ç»†èŠ‚ã€‚
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼šä¿®æ­£äº†ç®€å•å·¥å‚æ¨¡å¼ä¸­ä¸éµå®ˆå¼€æ”¾ï¼å°é—­åŸåˆ™ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼æŠŠé€‰æ‹©åˆ¤æ–­ç§»åˆ°äº†å®¢æˆ·ç«¯å»å®ç°ï¼Œå¦‚æœæƒ³æ·»åŠ æ–°åŠŸèƒ½å°±ä¸ç”¨ä¿®æ”¹åŸæ¥çš„ç±»ï¼Œç›´æ¥ä¿®æ”¹å®¢æˆ·ç«¯å³å¯ï¼Œä»è€Œä¿æŒäº†å°è£…å¯¹è±¡åˆ›å»ºè¿‡ç¨‹çš„ä¼˜ç‚¹ã€‚ä½¿å¾—æ›´æ¢å¯¹è±¡æ—¶ï¼Œä¸éœ€è¦åšå¤§çš„æ”¹åŠ¨å°±å¯ä»¥å®ç°ï¼Œé™ä½äº†å®¢æˆ·ç¨‹åºä¸äº§å“å¯¹è±¡çš„è€¦åˆã€‚</p>

<p>BADï¼šæ¯å¢åŠ ä¸€ä¸ªäº§å“ï¼Œå°±éœ€è¦å¢åŠ ä¸€ä¸ªäº§å“å·¥å‚ç±»ï¼Œå³å¢åŠ äº†é¢å¤–çš„å¼€å‘é‡</p>

<h3>æŠ½è±¡å·¥å‚æ¨¡å¼</h3>

<h6>ä¸€ã€æ€æƒ³</h6>

<pre><code> å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚Factoryä½¿ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚ï¼ˆå››äººå›¢ï¼‰

å®é™…ä¸Šï¼š å·¥å‚æ¨¡å¼ä¸»è¦å°±æ˜¯ç”¨äºåˆ›å»ºå¯¹è±¡ã€‚æ–°æ·»åŠ ç±»æ—¶ï¼Œä¸ä¼šå½±å“ä»¥å‰çš„ç³»ç»Ÿä»£ç ã€‚
</code></pre>

<h6>äºŒã€åŸºæœ¬æ€æƒ³</h6>

<p>   æ ¸å¿ƒæ€æƒ³ï¼šæ˜¯ç”¨ä¸€ä¸ªå·¥å‚æ¥æ ¹æ®è¾“å…¥çš„æ¡ä»¶äº§ç”Ÿä¸åŒçš„ç±»ï¼Œç„¶åæ ¹æ®ä¸åŒç±»çš„virtualå‡½æ•°å¾—åˆ°ä¸åŒçš„ç»“æœã€‚</p>

<pre><code> å®¢æˆ·ç±»å’Œå·¥å‚ç±»åˆ†å¼€ï¼Œæ¶ˆè´¹è€…ä»»ä½•æ—¶å€™éœ€è¦æŸç§äº§å“ç±»å¯¹è±¡ï¼Œåªéœ€è¦å‘å·¥å‚ç±»ï¼ˆæœ‰é™æ€æˆå‘˜å‡½æ•°æ¥æ”¶ï¼‰æäº¤å‚æ•°å’Œè¯·æ±‚å³å¯ã€‚æ¶ˆè´¹è€…æ— éœ€ä¿®æ”¹ï¼ˆç›´æ¥ç”¨æ‰€æœ‰äº§å“å…±åŒçš„çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘ï¼‰å°±å¯ä»¥æ¥çº³å’Œä½¿ç”¨æ–°äº§å“ç±»çš„å¯¹è±¡ã€‚
</code></pre>

<h6>ä¸‰ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOOD: é€‚ç”¨äºä¸åŒæƒ…å†µåˆ›å»ºä¸åŒçš„ç±»æ—¶</p>

<p>BADï¼š  å®¢æˆ·ç«¯å¿…é¡»è¦çŸ¥é“åŸºç±»å’Œå·¥å‚ç±»ï¼Œè€¦åˆæ€§å·®ï¼Œè€Œä¸”å½“äº§å“ä¿®æ”¹æ—¶ï¼Œå·¥å‚ç±»ä¹Ÿè¦åšç›¸åº”ä¿®æ”¹ï¼ˆå¦‚ï¼šå¦‚ä½•åˆ›å»ºåŠå¦‚ä½•å‘å®¢æˆ·ç«¯æä¾›ï¼‰</p>

<h3>å•ä¾‹æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<p>ç¡®ä¿æŸä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ˆç±»çš„é™æ€æˆå‘˜å˜é‡ï¼‰ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹å•ä¾‹æ¨¡å¼ã€‚</p>

<p>ç›´æ¥å°†ç±»çš„æ„é€ æ–¹æ³•æ”¹æˆç§æœ‰çš„ï¼ˆæ‰€æœ‰ç±»éƒ½æœ‰æ„é€ æ–¹æ³•ï¼Œä¸ç¼–ç åˆ™ç³»ç»Ÿé»˜è®¤ç”Ÿæˆç©ºçš„æ„é€ æ–¹æ³•ï¼Œè‹¥æœ‰æ˜¾ç¤ºå®šä¹‰çš„æ„é€ æ–¹æ³•ï¼Œé»˜è®¤çš„æ„é€ æ–¹æ³•å°±ä¼šå¤±æ•ˆï¼‰ï¼Œç„¶ååœ¨ä¸€ä¸ªpublicçš„å®ä¾‹åŒ–å‡½æ•°ä¸­è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°ï¼Œå®Œæˆä»…æœ‰çš„ä¸€æ¬¡å®ä¾‹åŒ–ã€‚</p>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOOD:å•ä¾‹æ¨¡å¼åªåº”åœ¨æœ‰çœŸæ­£çš„â€œå•ä¸€å®ä¾‹â€çš„éœ€æ±‚æ—¶æ‰å¯ä½¿ç”¨ã€‚</p>

<p>å•ä¾‹æ¨¡å¼å› ä¸ºSingletonç±»å°è£…å®ƒçš„å”¯ä¸€å®ä¾‹ï¼Œè¿™æ ·å®ƒå¯ä»¥ä¸¥æ ¼åœ°æ§åˆ¶å®¢æˆ·æ€æ ·è®¿é—®å®ƒä»¥åŠä½•æ—¶è®¿é—®å®ƒï¼Œç®€å•çš„è¯´å°±æ˜¯å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—®ã€‚</p>

<h3>å»ºé€ è€…æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>å»ºé€ è€…æ¨¡å¼ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤º
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> å°†äº§å“çš„å†…éƒ¨è¡¨è±¡å’Œäº§å“çš„ç”Ÿæˆè¿‡ç¨‹åˆ†å‰²å¼€æ¥ï¼Œä»è€Œä½¿ä¸€ä¸ªå»ºé€ è¿‡ç¨‹ç”Ÿæˆå…·æœ‰ä¸åŒçš„å†…éƒ¨è¡¨è±¡çš„äº§å“å¯¹è±¡ã€‚å»ºé€ æ¨¡å¼ä½¿å¾—äº§å“å†…éƒ¨è¡¨è±¡å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ï¼Œå®¢æˆ·ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ã€‚
</code></pre>

<p>å³ç”¨æˆ·å°±åªéœ€è¦æŒ‡å®šéœ€è¦å»ºé€ çš„ç±»å‹å°±å¯ä»¥å¾—åˆ°äº§å“ï¼Œè€Œå…·ä½“çš„å»ºé€ è¿‡ç¨‹å’Œç»†èŠ‚å°±ä¸éœ€è¦çŸ¥é“äº†ã€‚</p>

<p>å»ºé€ æ¨¡å¼å¯ä»¥å¼ºåˆ¶å®è¡Œä¸€ç§åˆ†æ­¥éª¤è¿›è¡Œçš„å»ºé€ è¿‡ç¨‹ã€‚</p>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼šä½¿å¾—å»ºé€ ä»£ç ä¸è¡¨ç¤ºä»£ç åˆ†ç¦»ï¼Œç”±äºå»ºé€ è€…éšè—äº†è¯¥äº§å“æ˜¯å¦‚ä½•ç»„è£…çš„ï¼Œæ‰€ä»¥è‹¥éœ€è¦æ”¹å˜ä¸€ä¸ªäº§å“çš„å†…éƒ¨è¡¨ç¤ºï¼Œåªéœ€è¦å†å®šä¹‰ä¸€ä¸ªå…·ä½“çš„å»ºé€ è€…å°±å¯ä»¥äº†ã€‚</p>

<h6>é€‚ç”¨äºï¼š</h6>

<p>ï¼ˆ1ï¼‰åœ¨å½“åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•åº”è¯¥ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼æ—¶é€‚ç”¨ã€‚</p>

<p>å°±æ˜¯è¯´ï¼šä¸»è¦ç”¨äºåˆ›å»ºä¸€äº›å¤æ‚çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å†…éƒ¨çš„æ„å»ºé¡ºåºé€šå¸¸æ˜¯ç¨³å®šçš„ï¼Œä½†æ˜¯å¯¹è±¡å†…éƒ¨çš„å…·ä½“å„ä¸ªæ„å»ºæ–¹æ³•é€šå¸¸é¢ä¸´ç€å¤æ‚çš„å˜åŒ–ã€‚</p>

<p>ï¼ˆ2ï¼‰å½“æ„é€ è¿‡ç¨‹å¿…é¡»å…è®¸è¢«æ„é€ çš„å¯¹è±¡æœ‰ä¸åŒçš„è¡¨ç¤ºæ—¶ã€‚</p>

<h3>åŸå‹æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>åŸå‹æ¨¡å¼ï¼šç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> é€šè¿‡ç»™å‡ºä¸€ä¸ªåŸå‹å¯¹è±¡æ¥æŒ‡æ˜æ‰€è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹ï¼Œç„¶åç”¨å¤åˆ¶è¿™ä¸ªåŸå‹å¯¹è±¡çš„æ–¹æ³•åˆ›å»ºå‡ºæ›´å¤šåŒç±»å‹çš„å¯¹è±¡ã€‚åŸå‹æ¨¡å¼å…è®¸åŠ¨æ€çš„å¢åŠ æˆ–å‡å°‘äº§å“ç±»ï¼Œäº§å“ç±»ä¸éœ€è¦éå¾—æœ‰ä»»ä½•äº‹å…ˆç¡®å®šçš„ç­‰çº§ç»“æ„ã€‚
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<p>ä»ä¸€ä¸ªå¯¹è±¡å†åˆ›å»ºå¦å¤–ä¸€ä¸ªå¯å®šåˆ¶çš„å¯¹è±¡ï¼Œè€Œæ— éœ€çŸ¥é“ä»»ä½•åˆ›å»ºçš„ç»†èŠ‚ã€‚å¹¶èƒ½æé«˜åˆ›å»ºçš„æ€§èƒ½ã€‚ è¯´ç™½äº†å°±COPYæŠ€æœ¯ï¼ŒæŠŠä¸€ä¸ªå¯¹è±¡å®Œæ•´çš„COPYå‡ºä¸€ä»½ã€‚</p>

<p>ä¸€èˆ¬åœ¨åˆå§‹åŒ–çš„ä¿¡æ¯ä¸å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ï¼Œå…‹éš†æ˜¯æœ€å¥½çš„åŠæ³•ã€‚è¿™æ—¢éšè—äº†å¯¹è±¡åˆ›å»ºçš„ç»†èŠ‚ï¼Œåˆå¯¹æ€§èƒ½æ˜¯å¤§å¤§çš„æé«˜ã€‚
BADï¼š</p>

<p>ç¼ºç‚¹æ˜¯æ¯ä¸€ä¸ªç±»éƒ½å¿…é¡»é…å¤‡ä¸€ä¸ªå¤åˆ¶æ–¹æ³•ã€‚
å¿…é¡»æ³¨æ„ï¼š</p>

<p>æµ…å¤åˆ¶å’Œæ·±å¤åˆ¶çš„é—®é¢˜ï¼šå¦‚æœå­—æ®µæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„ï¼Œåˆ™ç”¨æ‹·è´æ„é€ å‡½æ•°å³å¯è¿›è¡Œé€ä½å¤åˆ¶ï¼Œä½†å¦‚æœå­—æ®µæ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨ç±»å‹çš„ï¼Œåˆ™å¤åˆ¶å°±ä¸ä»…ä»…è¦å¤åˆ¶æŒ‡é’ˆå’Œå¼•ç”¨æœ¬èº«ï¼Œè¿˜éœ€è¦å¯¹å…¶æ‰€æŒ‡çš„å®é™…æ•°æ®å¯¹è±¡è¿›è¡Œå¤åˆ¶ã€‚</p>

<h2>ç»“æ„å‹æ¨¡å¼</h2>

<h3>é€‚é…å™¨æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>æŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£ä¸å…¼å®¹è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚
</code></pre>

<h6>2ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>é€‚ç”¨æƒ…å†µï¼šå½“ç³»ç»Ÿçš„æ•°æ®å’Œè¡Œä¸ºéƒ½æ­£ç¡®ï¼Œä½†æ¥å£ä¸ç¬¦æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘ä½¿ç”¨é€‚é…å™¨ï¼Œç›®çš„æ˜¯ä½¿æ§åˆ¶èŒƒå›´ä¹‹å¤–çš„ä¸€ä¸ªåŸæœ‰å¯¹è±¡ä¸æŸä¸ªæ¥å£åŒ¹é…ã€‚é€‚é…å™¨æ¨¡å¼ä¸»è¦åº”ç”¨äºå¸Œæœ›å¤ç”¨ä¸€äº›ç°å­˜çš„ç±»ï¼Œä½†æ˜¯æ¥å£åˆä¸å¤ç”¨ç¯å¢ƒè¦æ±‚ä¸ä¸€è‡´çš„æƒ…å†µã€‚
è£…é¥°å™¨æ¨¡å¼</p>

<h3>è£…é¥°æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>è£…é¥°æ¨¡å¼ï¼šåŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼ˆä¸é‡è¦çš„åŠŸèƒ½ï¼Œåªæ˜¯å¶ç„¶ä¸€æ¬¡è¦æ‰§è¡Œï¼‰ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼ŒDecoratoræ¨¡å¼æ¯”ä½¿ç”¨ç»§æ‰¿ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚

 å»ºé€ è¿‡ç¨‹ä¸ç¨³å®šï¼Œéœ€è¦æŠŠæ‰€éœ€çš„åŠŸèƒ½æŒ‰æ­£ç¡®çš„é¡ºåºä¸²è”èµ·æ¥è¿›è¡Œæ§åˆ¶ã€‚
</code></pre>

<h6>2ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOOD:å½“ä½ å‘æ—§çš„ç±»ä¸­æ·»åŠ æ–°ä»£ç æ—¶ï¼Œä¸€èˆ¬æ˜¯ä¸ºäº†æ·»åŠ æ ¸å¿ƒèŒè´£æˆ–ä¸»è¦è¡Œä¸ºã€‚è€Œå½“éœ€è¦åŠ å…¥çš„ä»…ä»…æ˜¯ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹æ‰ä¼šæ‰§è¡Œçš„ç‰¹å®šçš„åŠŸèƒ½æ—¶ï¼ˆç®€å•ç‚¹å°±æ˜¯ä¸æ˜¯æ ¸å¿ƒåº”ç”¨çš„åŠŸèƒ½ï¼‰ï¼Œå°±ä¼šå¢åŠ ç±»çš„å¤æ‚åº¦ã€‚</p>

<pre><code>è£…é¥°æ¨¡å¼å°±æ˜¯æŠŠè¦æ·»åŠ çš„é™„åŠ åŠŸèƒ½åˆ†åˆ«æ”¾åœ¨å•ç‹¬çš„ç±»ä¸­ï¼Œå¹¶è®©è¿™ä¸ªç±»åŒ…å«å®ƒè¦è£…é¥°çš„å¯¹è±¡ï¼Œ

å½“éœ€è¦æ‰§è¡Œæ—¶ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æœ‰é€‰æ‹©åœ°ã€æŒ‰é¡ºåºåœ°ä½¿ç”¨è£…é¥°åŠŸèƒ½åŒ…è£…å¯¹è±¡ã€‚
</code></pre>

<h3>ä»£ç†æ¨¡å¼</h3>

<h6>ä¸€ã€æ€æƒ³</h6>

<pre><code>ä»£ç†æ¨¡å¼ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®
</code></pre>

<h6>äºŒã€åŸºæœ¬æ€æƒ³</h6>

<pre><code> ä»£ç†æ¨¡å¼å®é™…å°±æ˜¯åœ¨è®¿é—®å¯¹è±¡æ—¶å¼•å…¥ä¸€å®šç¨‹åº¦çš„é—´æ¥æ€§ï¼Œå› ä¸ºè¿™ç§é—´æ¥æ€§ï¼Œå¯ä»¥é™„åŠ å¤šç§ç”¨é€”ã€‚
</code></pre>

<h6>ä¸‰ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼šï¼ˆé€‚ç”¨åœºåˆï¼‰</p>

<p>è¿œç¨‹ä»£ç†ï¼šä¹Ÿå°±æ˜¯ä¸ºä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçš„åœ°å€ç©ºé—´æä¾›å±€éƒ¨ä»£è¡¨ï¼Œè¿™æ ·å¯ä»¥éšè—ä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒåœ°å€ç©ºé—´çš„äº‹å®ã€‚</p>

<pre><code>              ä¾‹å¦‚ï¼šå®¢æˆ·ç«¯ç¨‹åºè°ƒç”¨ä»£ç†å°±å¯ä»¥è§£å†³è¿œç¨‹è®¿é—®çš„é—®é¢˜
</code></pre>

<p>è™šæ‹Ÿä»£ç†ï¼šæ˜¯æ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†æ¥å­˜æ”¾å®ä¾‹åŒ–éœ€è¦å¾ˆé•¿æ—¶é—´çš„çœŸå®å¯¹è±¡ï¼Œä»è€Œè¾¾åˆ°æ€§èƒ½çš„æœ€ä¼˜åŒ–ï¼ˆä¾‹å¦‚æµè§ˆå™¨ä½¿ç”¨ä»£ç†æ¨¡å¼æ¥ä¼˜åŒ–ä¸‹è½½ï¼‰ã€‚</p>

<pre><code>              ä¾‹å¦‚ï¼šæ‰“å¼€å¤§ç½‘é¡µæ—¶ï¼Œæœªé©¬ä¸Šæ‰“å¼€çš„å›¾ç‰‡å°±æ˜¯é€šè¿‡è™šæ‹Ÿä»£ç†æ¥æ›¿ä»£äº†çœŸå®çš„å›¾ç‰‡ï¼Œè€Œä»£ç†å­˜å‚¨äº†çœŸå®å›¾ç‰‡çš„è·¯å¾„å’Œå°ºå¯¸ã€‚
</code></pre>

<p>å®‰å…¨ä»£ç†ï¼šç”¨æ¥æ§åˆ¶çœŸå®å¯¹è±¡çš„è®¿é—®æƒé™</p>

<p>æ™ºèƒ½å¼•ç”¨ï¼šå½“è°ƒç”¨çœŸå®å¯¹è±¡æ—¶ï¼Œä»£ç†å¤„ç†å¦å¤–ä¸€äº›äº‹</p>

<h3>å¤–è§‚æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>å¤–è§‚æ¨¡å¼ï¼šä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œæ­¤æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> å¤–éƒ¨ä¸ä¸€ä¸ªå­ç³»ç»Ÿçš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚å¯¹è±¡è¿›è¡Œã€‚å¤–è§‚æ¨¡å¼æä¾›ä¸€ä¸ªé«˜å±‚æ¬¡çš„æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ã€‚æ¯ä¸€ä¸ªå­ç³»ç»Ÿåªæœ‰ä¸€ä¸ªå¤–è§‚ç±»ï¼Œè€Œä¸”æ­¤å¤–è§‚ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¿˜è¯´å®ƒæ˜¯ä¸€ä¸ªå•ä¾‹æ¨¡å¼ã€‚ä½†æ•´ä¸ªç³»ç»Ÿå¯ä»¥æœ‰å¤šä¸ªå¤–è§‚ç±»ã€‚
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<p>ä¸ºå­ç³»ç»Ÿçš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ã€‚ä½¿ç”¨æˆ·ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚</p>

<pre><code>å®Œç¾ä½“ç°äº†ä¾èµ–å€’è½¬åŸåˆ™å’Œè¿ªç±³ç‰¹åŸåˆ™
</code></pre>

<p>é€‚ç”¨æƒ…å†µï¼š</p>

<pre><code>åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š

1ã€é¦–å…ˆï¼Œåœ¨è®¾è®¡åˆæœŸé˜¶æ®µï¼Œåº”è¯¥æœ‰æ„è¯†çš„å°†ä¸åŒçš„ä¸¤ä¸ªå±‚åˆ†ç¦»ï¼Œå³åœ¨å±‚ä¸å±‚ä¹‹é—´å»ºç«‹å¤–è§‚Facade

2ã€å…¶æ¬¡ï¼Œåœ¨å¼€å‘é˜¶æ®µï¼Œå­ç³»ç»Ÿå¾€å¾€å› ä¸ºä¸æ–­çš„é‡æ„æ¼”åŒ–ï¼Œè€Œå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ å¤–è§‚Facadeå¯ä»¥æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œå‡å°‘å®ƒä»¬ä¹‹é—´çš„ä¾èµ–ã€‚

3ã€åœ¨ç»´æŠ¤ä¸€ä¸ªé—ç•™çš„å¤§å‹ç³»ç»Ÿæ—¶ï¼Œå¯èƒ½è¿™ä¸ªç³»ç»Ÿå·²ç»éå¸¸éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•äº†ï¼Œå°±å¯ä»¥ä¸ºæ–°ç³»ç»Ÿå¼€å‘ä¸€ä¸ªå¤–è§‚Facadeç±»ï¼Œæ¥æä¾›è®¾è®¡ç²—ç³™æˆ–é«˜åº¦å¤æ‚çš„é—ç•™ä»£ç çš„æ¯”è¾ƒæ¸…æ™°ç®€å•çš„æ¥å£ï¼Œè®©æ–°ç³»ç»Ÿä¸Facadeå¯¹è±¡äº¤äº’ï¼ŒFacadeä¸é—ç•™ä»£ç äº¤äº’æ‰€æœ‰å¤æ‚çš„å·¥ä½œã€‚
</code></pre>

<h3>æ¡¥æ¥æ¨¡å¼</h3>

<h6>1ã€åˆæˆèšåˆåŸåˆ™</h6>

<p>ç¼˜ç”±ï¼šå¯¹è±¡çš„ç»§æ‰¿å…³ç³»æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å®šä¹‰å¥½äº†ï¼Œæ‰€ä»¥æ— æ³•åœ¨è¿è¡Œæ—¶æ”¹å˜ä»çˆ¶ç±»ç»§æ‰¿çš„å®ç°ã€‚å­ç±»çš„å®ç°ä¸å®ƒçš„çˆ¶ç±»æœ‰éå¸¸ç´§å¯†çš„ä¾èµ–å…³ç³»ï¼Œä»¥è‡³äºçˆ¶ç±»å®ç°ä¸­çš„ä»»ä½•å˜åŒ–å¿…ç„¶ä¼šå¯¼è‡´å­ç±»å‘ç”Ÿå˜åŒ–ã€‚å½“ä½ éœ€è¦å¤ç”¨å­ç±»æ—¶ï¼Œå¦‚æœç»§æ‰¿ä¸‹æ¥çš„å®ç°ä¸é€‚åˆè§£å†³æ–°çš„é—®é¢˜ï¼Œåˆ™çˆ¶ç±»å¿…é¡»é‡å†™æˆ–è¢«å…¶ä»–æ›´é€‚åˆçš„ç±»æ›¿æ¢ã€‚è¿™ç§ä¾èµ–å…³ç³»é™åˆ¶äº†çµæ´»æ€§å¹¶æœ€ç»ˆé™åˆ¶äº†å¤ç”¨æ€§ã€‚</p>

<p>åŸåˆ™ï¼š</p>

<pre><code>åˆæˆ/èšåˆåŸåˆ™(CARP)ï¼šå°½é‡ä½¿ç”¨åˆæˆ/èšåˆï¼Œå°½é‡ä¸è¦ä½¿ç”¨ç±»ç»§æ‰¿
</code></pre>

<ul>
<li><p>èšåˆï¼šä¸€ç§å¼±çš„â€™æ‹¥æœ‰â€™å…³ç³»ï¼Œä½“ç°çš„æ˜¯Aå¯¹è±¡å¯ä»¥åŒ…å«Bå¯¹è±¡ï¼Œä½†Bå¯¹è±¡ä¸æ˜¯Aå¯¹è±¡çš„ä¸€éƒ¨åˆ†</p></li>
<li><p>åˆæˆï¼šä¸€ç§å¼ºçš„â€™æ‹¥æœ‰â€™å…³ç³»ï¼Œä½“ç°äº†ä¸¥æ ¼çš„éƒ¨åˆ†å’Œæ•´ä½“çš„å…³ç³»ï¼Œéƒ¨åˆ†å’Œæ•´ä½“çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·ã€‚</p></li>
</ul>


<h6>åˆæˆèšåˆçš„å¥½å¤„ï¼š</h6>

<p>ä¼˜å…ˆä½¿ç”¨å¯¹è±¡çš„åˆæˆ/èšåˆå°†æœ‰åŠ©äºä½ ä¿æŒæ¯ä¸ªç±»è¢«å°è£…ï¼Œå¹¶è¢«é›†ä¸­åœ¨å•ä¸ªä»»åŠ¡ä¸Šï¼Œè¿™æ ·ç±»å’Œç±»ç»§æ‰¿å±‚æ¬¡ä¼šä¿æŒè¾ƒå°è§„æ¨¡ï¼Œå¹¶ä¸”ä¸å¤ªå¯èƒ½å¢é•¿ä¸ºä¸å¯æ§åˆ¶çš„åºç„¶å¤§ç‰©ã€‚</p>

<h6>2ã€æ¡¥æ¨¡å¼æ€æƒ³</h6>

<pre><code>æ¡¥æ¥æ¨¡å¼(Bridge)ï¼šå°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–
</code></pre>

<p>æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼šæŒ‡çš„æ˜¯æŠ½è±¡ç±»å’Œå®ƒçš„æ´¾ç”Ÿç±»ç”¨æ¥å®ç°è‡ªå·±çš„å¯¹è±¡</p>

<h6>3ã€æ ¸å¿ƒæ€æƒ³</h6>

<p>æ¡¥æ¨¡å¼å°±æ˜¯å°†æŠ½è±¡åŒ–ä¸å®ç°åŒ–è„±è€¦ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´å°†ä»–ä»¬ä¹‹é—´çš„å¼ºå…³è”å˜æˆå¼±å…³è”ï¼Œä¹Ÿå°±æ˜¯æŒ‡åœ¨ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„æŠ½è±¡åŒ–ä¸å®ç°åŒ–ä¹‹é—´ä½¿ç”¨ç»„åˆ/èšåˆå…³ç³»è€Œä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼Œä»è€Œè®©äºŒè€…ç‹¬ç«‹çš„å˜åŒ–ã€‚</p>

<h6>4ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<pre><code>å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚

è¿™é‡Œè¯´çš„æ„æ€ä¸æ˜¯è®©æŠ½è±¡åŸºç±»ä¸å…·ä½“ç±»åˆ†ç¦»ï¼Œè€Œæ˜¯ç°å®ç³»ç»Ÿå¯èƒ½æœ‰å¤šè§’åº¦åˆ†ç±»ï¼Œæ¯ä¸€ç§åˆ†ç±»éƒ½æœ‰å¯èƒ½å˜åŒ–ï¼Œé‚£ä¹ˆæŠŠè¿™ç§å¤šè§’åº¦åˆ†ç¦»å‡ºæ¥è®©å®ƒä»¬ç‹¬ç«‹å˜åŒ–ï¼Œå‡å°‘å®ƒä»¬ä¹‹é—´çš„è€¦åˆæ€§ï¼Œå³å¦‚æœç»§æ‰¿ä¸èƒ½å®ç°â€œå¼€æ”¾ï¼å°é—­åŸåˆ™â€çš„è¯ï¼Œå°±åº”è¯¥è€ƒè™‘ç”¨æ¡¥æ¥æ¨¡å¼ 
</code></pre>

<h3>ç»„åˆæ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>ç»„åˆæ¨¡å¼ï¼šå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†â€”â€”æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§
</code></pre>

<h6>2ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<pre><code>æ•´ä½“å’Œéƒ¨åˆ†å¯ä»¥è¢«ä¸€è‡´å¯¹å¾…ï¼ˆå¦‚WORDä¸­å¤åˆ¶ä¸€ä¸ªæ–‡å­—ã€ä¸€æ®µæ–‡å­—ã€ä¸€ç¯‡æ–‡ç« éƒ½æ˜¯ä¸€æ ·çš„æ“ä½œï¼‰

ç”¨æˆ·ä¸ç”¨å…³å¿ƒåˆ°åº•æ˜¯å¤„ç†ä¸€ä¸ªå¶ç»“ç‚¹è¿˜æ˜¯å¤„ç†ä¸€ä¸ªç»„åˆç»„ä»¶ï¼Œä¹Ÿå°±ä¸ç”¨ä¸ºå®šä¹‰ç»„åˆè€Œå†™ä¸€äº›é€‰æ‹©åˆ¤æ–­è¯­å¥ï¼Œå³ç”¨æˆ·å¯ä»¥ä¸€è‡´çš„ä½¿ç”¨ç»„åˆç»“æ„å’Œå•ä¸ªå¯¹è±¡ã€‚
</code></pre>

<h6>é€‚ç”¨æƒ…å†µï¼š</h6>

<p>å½“éœ€æ±‚ä¸­æ˜¯ä½“ç°éƒ¨åˆ†ä¸æ•´ä½“å±‚æ¬¡çš„ç»“æ„æ—¶ï¼Œä»¥åŠå¸Œæœ›ç”¨æˆ·å¯ä»¥å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„ä¸åŒï¼Œç»Ÿä¸€åœ°ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡æ—¶ï¼Œå°±åº”è¯¥è€ƒè™‘ç”¨ç»„åˆæ¨¡å¼</p>

<h3>äº«å…ƒæ¨¡å¼ã€‚</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>äº«å…ƒæ¨¡å¼ï¼šè¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code>  äº«å…ƒæ¨¡å¼ä»¥å…±äº«çš„æ–¹å¼é«˜æ•ˆçš„æ”¯æŒå¤§é‡çš„ç»†ç²’åº¦å¯¹è±¡ã€‚äº«å…ƒæ¨¡å¼èƒ½åšåˆ°å…±äº«çš„å…³é”®æ˜¯åŒºåˆ†å†…è•´çŠ¶æ€å’Œå¤–è•´çŠ¶æ€ã€‚

 å†…è•´çŠ¶æ€å­˜å‚¨åœ¨äº«å…ƒå†…éƒ¨ï¼Œä¸ä¼šéšç¯å¢ƒçš„æ”¹å˜è€Œæœ‰æ‰€ä¸åŒã€‚å¤–è•´çŠ¶æ€æ˜¯éšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜çš„ã€‚å¤–è•´çŠ¶æ€ä¸èƒ½å½±å“å†…è•´çŠ¶æ€ï¼Œå®ƒä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚

  å°†å¯ä»¥å…±äº«çš„çŠ¶æ€å’Œä¸å¯ä»¥å…±äº«çš„çŠ¶æ€ä»å¸¸è§„ç±»ä¸­åŒºåˆ†å¼€æ¥ï¼Œå°†ä¸å¯ä»¥å…±äº«çš„çŠ¶æ€ä»ç±»é‡Œå‰”é™¤å‡ºå»ã€‚

  å®¢æˆ·ç«¯ä¸å¯ä»¥ç›´æ¥åˆ›å»ºè¢«å…±äº«çš„å¯¹è±¡ï¼Œè€Œåº”å½“ä½¿ç”¨ä¸€ä¸ªå·¥å‚å¯¹è±¡è´Ÿè´£åˆ›å»ºè¢«å…±äº«çš„å¯¹è±¡ã€‚äº«å…ƒæ¨¡å¼å¤§å¹…åº¦çš„é™ä½å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡ã€‚
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<pre><code>ï¼ˆ1ï¼‰è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼ˆå¯¹äºC++æ¥è¯´å°±æ˜¯å…±ç”¨ä¸€ä¸ªå†…å­˜å—å•¦ï¼Œå¯¹è±¡æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªåœ°æ–¹ï¼‰ã€‚

ï¼ˆ2ï¼‰å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤§é‡çš„å¯¹è±¡ï¼Œè€Œè¿™äº›å¯¹è±¡é€ æˆäº†å¾ˆå¤§çš„å­˜å‚¨å¼€é”€å°±åº”è¯¥è€ƒè™‘ä½¿ç”¨ã€‚

ï¼ˆ3ï¼‰è¿˜æœ‰å°±æ˜¯å¯¹è±¡çš„å¤§å¤šæ•°çŠ¶æ€å¯ä»¥å¤–éƒ¨çŠ¶æ€ï¼Œå¦‚æœåˆ é™¤å¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨è¾ƒå°‘çš„å…±äº«å¯¹è±¡å–ä»£å¤šç»„å¯¹è±¡ï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨äº«å…ƒã€‚ 
</code></pre>

<h2>è¡Œä¸ºå‹æ¨¡å¼</h2>

<h3>ç­–ç•¥æ¨¡å¼</h3>

<h6>ä¸€ã€æ€æƒ³</h6>

<pre><code> å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ï¼Œæœ¬æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–â€”â€”å››äººå›¢
</code></pre>

<h6>äºŒã€åŸºæœ¬æ€æƒ³</h6>

<pre><code>å®šä¹‰ç®—æ³•å®¶æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œè®©ç®—æ³•çš„å˜åŒ–ï¼Œä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ã€‚
</code></pre>

<h6>ä¸‰ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOOD:</p>

<p>ï¼ˆ1ï¼‰ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•çš„æ–¹æ³•ï¼Œä»æ¦‚å¿µä¸Šçœ‹ï¼Œæ‰€æœ‰è¿™äº›ç®—æ³•å®Œæˆçš„éƒ½æ˜¯ç›¸åŒçš„å·¥ä½œï¼Œåªæ˜¯å®ç°ä¸åŒã€‚</p>

<pre><code>   æ‰€ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œå°±å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è°ƒç”¨æ‰€æœ‰çš„ç®—æ³•ï¼Œå‡å°‘äº†å„ç§ç®—æ³•ç±»ä¸ä½¿ç”¨ç®—æ³•ç±»ä¹‹é—´çš„è€¦åˆã€‚
</code></pre>

<p>ï¼ˆ2ï¼‰ç­–ç•¥æ¨¡å¼çš„Strategyç±»å±‚æ¬¡ä¸ºContextå®šä¹‰äº†ä¸€ç³»åˆ—çš„å¯ä¾›é‡ç”¨çš„ç®—æ³•æˆ–è¡Œä¸ºã€‚ç»§æ‰¿æœ‰åŠ©äºæå–å‡ºè¿™äº›ç®—æ³•ä¸­çš„å…¬å…±åŠŸèƒ½</p>

<p>ï¼ˆ3ï¼‰ç®€åŒ–äº†å•å…ƒæµ‹è¯•ï¼ˆå› ä¸ºæ¯ä¸ªç®—æ³•éƒ½æœ‰è‡ªå·±çš„ç±»ï¼Œå¯ä»¥é€šè¿‡è‡ªå·±çš„æ¥å£å•ç‹¬æµ‹è¯•ï¼‰</p>

<p>BUG:å®¢æˆ·ç«¯è¦åšå‡ºåˆ¤æ–­ä½¿ç”¨å“ªä¸ªå…·ä½“ç®—æ³•ï¼ˆå¯é€šè¿‡åœ¨contextä¸­ä¸å·¥å‚æ¨¡å¼çš„ç»“åˆæ¥æ¶ˆé™¤è¿™ä¸ªé—®é¢˜ï¼Œè™½ç„¶å½“æ–°å¢åŠ éœ€æ±‚æ—¶ï¼Œè¿˜æ˜¯è¦æ”¹contextä¸­çš„ä»£ç ï¼Œä½†æ˜¯ä»»ä½•éœ€æ±‚çš„å˜æ›´æœ¬èº«å°±æ˜¯éœ€è¦æˆæœ¬çš„ï¼‰
å››ã€é€‚ç”¨æƒ…å†µ</p>

<pre><code> ç­–ç•¥æ¨¡å¼å’Œç®€å•å·¥å‚åŸºæœ¬ç›¸åŒï¼Œä½†ç®€å•å·¥å‚æ¨¡å¼åªèƒ½è§£å†³å¯¹è±¡åˆ›å»ºé—®é¢˜ï¼Œå¯¹äºç±»ä¸­çš„æˆå‘˜ä»¥æ–¹æ³•ä¸ºä¸»ï¼Œè€Œä¸”ç®—æ³•ç»å¸¸å˜åŠ¨çš„ç±»ï¼Œåº”ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚

 åœ¨å®è·µä¸­ï¼Œç­–ç•¥æ¨¡å¼å®é™…ä¸Šå¯ä»¥å°è£…å‡ ä¹ä»»ä½•ç±»å‹çš„è§„åˆ™ï¼Œåªè¦åœ¨åˆ†æè¿‡ç¨‹ä¸­å¬åˆ°éœ€è¦ä¸åŒæ—¶é—´åº”ç”¨ä¸åŒçš„ä¸šåŠ¡è§„åˆ™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¤„ç†è¿™ç§å˜åŒ–çš„å¯èƒ½æ€§ã€‚
</code></pre>

<h3>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚template methodä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> æ¨¡æ¿æ–¹æ³•æ¨¡å¼å‡†å¤‡ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå°†éƒ¨åˆ†é€»è¾‘ä»¥å…·ä½“æ–¹æ³•ä»¥åŠå…·ä½“æ„é€ å­ç±»çš„å½¢å¼å®ç°ï¼Œç„¶åå£°æ˜ä¸€äº›æŠ½è±¡æ–¹æ³•æ¥è¿«ä½¿å­ç±»å‰©ä½™çš„é€»è¾‘ã€‚ä¸åŒçš„å­ç±»å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™äº›æŠ½è±¡æ–¹æ³•ï¼Œä»è€Œå¯¹å‰©ä½™çš„é€»è¾‘æœ‰ä¸åŒçš„å®ç°ã€‚å…ˆåˆ¶å®šä¸€ä¸ªé¡¶çº§é€»è¾‘æ¡†æ¶ï¼Œè€Œå°†é€»è¾‘çš„ç»†èŠ‚ç•™ç»™å…·ä½“çš„å­ç±»å»å®ç°ã€‚

 å½“è¦å®Œæˆåœ¨æŸä¸€ç»†èŠ‚å±‚æ¬¡ä¸€è‡´çš„ä¸€ä¸ªè¿‡ç¨‹æˆ–ä¸€ç³»åˆ—æ­¥éª¤ï¼Œä½†å…¶ä¸ªåˆ«æ­¥éª¤åœ¨æ›´è¯¦ç»†çš„å±‚æ¬¡ä¸Šçš„å®ç°å¯èƒ½ä¸åŒæ—¶ï¼Œé€šå¸¸è€ƒè™‘ç”¨æ¨¡æ¿æ–¹æ³•æ¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬é‡åˆ°ç”±ä¸€ç³»åˆ—æ­¥éª¤æ„æˆçš„è¿‡ç¨‹éœ€è¦æ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹ä»é«˜å±‚æ¬¡ä¸Šçœ‹æ˜¯ç›¸åŒçš„ï¼Œä½†ä»åº•å±‚çœ‹æœ‰äº›å…·ä½“æ­¥éª¤å®ç°åˆå¯èƒ½ä¸åŒï¼Œè¿™æ—¶å€™ï¼Œå°±è¦è€ƒè™‘ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<pre><code>æŠŠä¸å˜çš„ä»£ç éƒ¨åˆ†éƒ½è½¬ç§»åˆ°çˆ¶ç±»ä¸­ï¼Œå°†å¯å˜çš„ä»£ç ç”¨virtualç•™åˆ°å­ç±»é‡å†™ï¼Œä»è€Œæä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„ä»£ç å¤ç”¨å¹³å°ã€‚
</code></pre>

<p>å³å½“ä¸å˜çš„å’Œå¯å˜çš„è¡Œä¸ºåœ¨æ–¹æ³•çš„å­ç±»å®ç°ä¸­æ··åˆåœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œä¸å˜çš„è¡Œä¸ºå°±ä¼šåœ¨å­ç±»ä¸­é‡å¤å‡ºç°ã€‚æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼æŠŠè¿™äº›è¡Œä¸ºæ¬ç§»åˆ°å•ä¸€çš„åœ°æ–¹ï¼Œè¿™æ ·å°±å¸®åŠ©å­ç±»æ‘†è„±é‡å¤çš„ä¸å˜è¡Œä¸ºçš„çº ç¼ ã€‚</p>

<h3>è§‚å¯Ÿè€…æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€ä¸Šå‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚
</code></pre>

<h6>ä½¿ç”¨åŠ¨æœºï¼š</h6>

<p>ã€€ã€€å°†ä¸€ä¸ªç³»ç»Ÿåˆ†å‰²æˆä¸€ç³»åˆ—ç›¸äº’åä½œçš„ç±»æœ‰ä¸€ä¸ªå¾ˆä¸å¥½çš„å‰¯ä½œç”¨ï¼Œé‚£å°±æ˜¯éœ€è¦ç»´æŠ¤ç›¸å…³å¯¹è±¡é—´çš„ä¸€è‡´æ€§ã€‚æˆ‘ä»¬ä¸å¸Œæœ›ä¸ºäº†ç»´æŒä¸€è‡´æ€§è€Œä½¿å„ç±»ç´§å¯†è€¦åˆï¼Œè¿™æ ·ä¼šç»™ç»´æŠ¤ã€æ‰©å±•å’Œé‡ç”¨éƒ½å¸¦æ¥ä¸ä¾¿ã€‚</p>

<h6>æœ¬æ¨¡å¼é€‚ç”¨æƒ…å†µï¼š</h6>

<p>ï¼ˆ1ï¼‰å½“ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜éœ€è¦åŒæ—¶æ”¹å˜å…¶ä»–å¯¹è±¡çš„æ—¶å€™ï¼Œè€Œä¸”å®ƒä¸çŸ¥é“å…·ä½“æœ‰å¤šå°‘å¯¹è±¡æœ‰å¾…æ”¹å˜æ—¶ï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>

<p>ï¼ˆ2ï¼‰å½“ä¸€ä¸ªæŠ½è±¡æ¨¡å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€æ–¹é¢ä¾èµ–äºå¦ä¸€æ–¹é¢ï¼Œè¿™æ—¶ç”¨è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥å°†è¿™ä¸¤è€…å°è£…åœ¨ç‹¬ç«‹çš„å¯¹è±¡ä¸­ï¼Œä½¿å®ƒä»¬å„è‡ªç‹¬ç«‹åœ°æ”¹å˜å’Œå¤ç”¨ã€‚
æ€»ç»“ï¼š</p>

<pre><code>è§‚å¯Ÿè€…æ¨¡å¼æ‰€åšçš„å·¥ä½œå…¶å®å°±æ˜¯è§£é™¤è€¦åˆï¼Œè®©è€¦åˆçš„åŒæ–¹éƒ½ä¾èµ–äºæŠ½è±¡ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå…·ä½“ã€‚ä»è€Œä½¿å¾—å„è‡ªçš„å˜åŒ–éƒ½ä¸ä¼šå½±å“å¦ä¸€è¾¹çš„å˜åŒ–ã€‚

æœ¬æ¨¡å¼æ˜¯ä¾èµ–å€’ç½®åŸåˆ™çš„æœ€ä½³ä½“ç°ï¼

è®¾è®¡åŸåˆ™ï¼šä¸ºäº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€Œå¥‹æ–—åˆ°åº•ï¼
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<pre><code>å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿå¯¹è±¡ï¼ˆå…¬å¸å‘˜å·¥ï¼‰åŒæ—¶ç›‘å¬ä¸€ä¸ªä¸»é¢˜å¯¹è±¡ï¼ˆç§˜ä¹¦ï¼‰ï¼Œä¸»é¢˜å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿæ›´æ–°è‡ªå·±ã€‚
</code></pre>

<p>BAD:</p>

<pre><code>å°½ç®¡ä½¿ç”¨äº†â€œä¾èµ–å€’ç½®åŸåˆ™â€ï¼Œä½†æ˜¯â€œæŠ½è±¡é€šçŸ¥è€…â€è¿˜æ˜¯ä¾èµ–äºâ€œæŠ½è±¡è§‚å¯Ÿè€…â€ã€‚è€Œä¸”æ¯ä¸ªå…·ä½“è§‚å¯Ÿè€…ä¸ä¸€å®šæ˜¯â€œæ›´æ–°â€æ–¹æ³•éœ€è¦è°ƒç”¨ã€‚

åœ¨.netä¸­å¯é€šè¿‡äº‹ä»¶å§”æ‰˜æ–¹æ³•ï¼Œä½¿å¾—é€šçŸ¥è€…å’Œè§‚å¯Ÿè€…ä¹‹é—´æ ¹æœ¬å°±äº’ç›¸ä¸çŸ¥é“ã€‚  
</code></pre>

<h3>è¿­ä»£å­æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>è¿­ä»£å™¨æ¨¡å¼ï¼šæä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>é€‚ç”¨æƒ…å†µï¼š</p>

<p>ï¼ˆ1ï¼‰å½“éœ€è¦è®¿é—®ä¸€ä¸ªèšé›†å¯¹è±¡ï¼Œè€Œä¸”ä¸ç®¡è¿™äº›å¯¹è±¡æ˜¯ä»€ä¹ˆéƒ½éœ€è¦éå†çš„æ—¶å€™ï¼Œå°±åº”è¯¥è€ƒè™‘ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼</p>

<p>ï¼ˆ2ï¼‰å½“éœ€è¦å¯¹èšé›†æœ‰å¤šç§æ–¹å¼éå†æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼</p>

<p>GOODï¼š</p>

<pre><code>æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšæ•›å¯¹è±¡çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚

ä¸ºéå†ä¸åŒçš„èšé›†ç»“æ„æä¾›å¦‚å¼€å§‹ï¼Œä¸‹ä¸€ä¸ªï¼Œæ˜¯å¦ç»“æŸï¼Œå½“å‰ä¸€é¡¹ç­‰ç»Ÿä¸€æ¥å£ã€‚ 
</code></pre>

<h3>è´£ä»»é“¾æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œå°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<p>åœ¨è´£ä»»é“¾æ¨¡å¼ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡ç”±æ¯ä¸€ä¸ªå¯¹è±¡å¯¹å…¶ä¸‹å®¶çš„å¼•ç”¨è€Œæ¥èµ·æ¥å½¢æˆä¸€æ¡é“¾ã€‚è¯·æ±‚åœ¨è¿™ä¸ªé“¾ä¸Šä¼ é€’ï¼Œç›´åˆ°é“¾ä¸Šçš„æŸä¸€ä¸ªå¯¹è±¡å†³å®šå¤„ç†æ­¤è¯·æ±‚ã€‚å®¢æˆ·å¹¶ä¸çŸ¥é“é“¾ä¸Šå…·ä½“çš„å“ªä¸€ä¸ªå¯¹è±¡æœ€ç»ˆå¤„ç†äº†è¿™ä¸ªè¯·æ±‚ï¼Œç³»ç»Ÿå¯ä»¥åœ¨ä¸å½±å“å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€çš„é‡æ–°ç»„ç»‡é“¾å’Œåˆ†é…è´£ä»»ã€‚å¤„ç†è€…æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šæ‰¿æ‹…è´£ä»»æˆ–è€…æŠŠè´£ä»»æ¨ç»™ä¸‹å®¶ã€‚ä¸€ä¸ªè¯·æ±‚å¯ä»¥æœ€ç»ˆä¸è¢«ä»»ä½•æ¥æ”¶ç«¯å¯¹è±¡æ‰€æ¥å—ã€‚</p>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>å…³é”®ç‚¹ï¼šå½“å®¢æˆ·æäº¤ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œè¯·æ±‚æ˜¯æ²¿é“¾ä¼ é€’ç›´è‡³æœ‰ä¸€ä¸ªConcreteHandlerå¯¹è±¡è´Ÿè´£å¤„ç†å®ƒã€‚</p>

<p>GOODï¼š</p>

<pre><code>ï¼ˆ1ï¼‰è¿™å°±ä½¿å¾—æ¥å—è€…å’Œå‘é€è€…ä¹‹é—´éƒ½æ²¡æœ‰å¯¹æ–¹æ˜ç¡®çš„ä¿¡æ¯ï¼Œä¸”é“¾ä¸­çš„å¯¹è±¡è‡ªå·±ä¹Ÿå¹¶ä¸çŸ¥é“æ•´ä¸ªé“¾çš„ç»“æ„ã€‚ç»“æœæ˜¯èŒè´£é“¾å¯ç®€åŒ–å¯¹è±¡çš„ç›¸äº’è¿æ¥ï¼Œå®ƒä»¬ä»…éœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œè€Œä¸éœ€è¦ä¿æŒå®ƒæ‰€æœ‰çš„å€™é€‰æ¥å—è€…çš„å¼•ç”¨ã€‚

ï¼ˆ2ï¼‰å¯ä»¥éšæ—¶åœ°å¢åŠ æˆ–ä¿®æ”¹ä¸€ä¸ªè¯·æ±‚çš„ç»“æ„ï¼Œå¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§

ï¼ˆ3ï¼‰ä¸€ä¸ªè¯·æ±‚ææœ‰å¯èƒ½åˆ°äº†é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ï¼Œæˆ–è€…å› ä¸ºæ²¡æœ‰æ­£ç¡®é…ç½®è€Œå¾—ä¸åˆ°å¤„ç†
</code></pre>

<h3>å‘½ä»¤æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>å‘½ä»¤æ¨¡å¼ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ä½ å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œ
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<p>å‘½ä»¤æ¨¡å¼ï¼šæŠŠä¸€ä¸ªè¯·æ±‚æˆ–è€…æ“ä½œå°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå‘½ä»¤æ¨¡å¼æŠŠå‘å‡ºå‘½ä»¤çš„è´£ä»»å’Œæ‰§è¡Œå‘½ä»¤çš„è´£ä»»åˆ†å‰²å¼€æ¥ï¼Œå§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡ã€‚å‘½ä»¤æ¨¡å¼å…è®¸è¯·æ±‚çš„ä¸€æ–¹å’Œå‘é€çš„ä¸€æ–¹ç‹¬ç«‹å¼€æ¥ï¼Œä½¿å¾—è¯·æ±‚çš„ä¸€æ–¹ä¸å¿…çŸ¥é“æ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹çš„æ¥å£ï¼Œæ›´ä¸å¿…çŸ¥é“è¯·æ±‚æ˜¯æ€ä¹ˆè¢«æ¥æ”¶ï¼Œä»¥åŠæ“ä½œæ˜¯å¦æ‰§è¡Œï¼Œä½•æ—¶è¢«æ‰§è¡Œä»¥åŠæ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„ã€‚</p>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>GOODï¼š</p>

<pre><code>ä¸€ã€èƒ½è¾ƒå®¹æ˜“åœ°å»ºç«‹ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—ï¼›

äºŒã€åœ¨éœ€è¦çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è¾ƒå®¹æ˜“åœ°å°†å‘½ä»¤è®°å…¥æ—¥å¿—ï¼›

ä¸‰ã€å…è®¸æ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹æ˜¯å¦æ‹’ç»è¯·æ±‚ï¼›

å››ã€å¯ä»¥å®¹æ˜“åœ°å®ç°å¯¹è¯·æ±‚çš„æ’¤é”€å’Œé‡åšï¼Œ

äº”ã€ç”±äºåŠ è¿›æ–°çš„å…·ä½“å‘½ä»¤ç±»ä¸å½±å“å…¶ä»–çš„ç±»ï¼Œå› æ­¤æ·»åŠ ä¸€ä¸ªæ–°å‘½ä»¤ç±»ä¸å½±å“å…¶å®ƒç±»ï¼›
</code></pre>

<p>æœ€å…³é”®çš„ä¼˜ç‚¹ï¼šå‘½ä»¤æ¨¡å¼æŠŠè¯·æ±‚ä¸€ä¸ªæ“ä½œçš„å¯¹è±¡ä¸çŸ¥é“æ€ä¹ˆæ“è¡Œä¸€ä¸ªæ“ä½œçš„å¯¹è±¡åˆ†å¼€</p>

<p>é€‚ç”¨åŸåˆ™ï¼šæ•æ·å¼€å‘åŸåˆ™å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸è¦ä¸ºä»£ç æ·»åŠ åŸºäºçŒœæµ‹çš„ã€å®é™…ä¸éœ€è¦çš„åŠŸèƒ½ã€‚å¦‚æœä¸æ¸…æ¥šä¸€ä¸ªç³»ç»Ÿæ˜¯å¦éœ€è¦å‘½ä»¤æ¨¡å¼ï¼Œä¸€èˆ¬ä¸è¦ç€æ€¥å»å®ç°å®ƒï¼Œäº‹å®ä¸Šã€åœ¨éœ€è¦çš„æ—¶å€™é€šè¿‡é‡æ„å®ç°è¿™ä¸ªæ¨¡å¼å¹¶ä¸å›°éš¾ï¼Œåªæœ‰åœ¨çœŸæ­£éœ€è¦å¦‚æ’¤é”€ã€æ¢å¤ç­‰æ“ä½œåŠŸèƒ½æ—¶ï¼Œæ‰æŠŠåŸæœ‰çš„ä»£ç é‡æ„ä¸ºå‘½ä»¤æ¨¡å¼æ‰æœ‰æ„ä¹‰ã€‚</p>

<h3>å¤‡å¿˜å½•æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>åœ¨ä¸ç ´åå°è£…çš„æ¡ä»¶ä¸‹ï¼Œå°†ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ‰ä½ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡å¤–éƒ¨ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨å°†æ¥åˆé€‚çš„æ—¶å€™æŠŠè¿™ä¸ªå¯¹è±¡è¿˜åŸåˆ°å­˜å‚¨èµ·æ¥çš„çŠ¶æ€ã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> å¤‡å¿˜å½•å¯¹è±¡æ˜¯ä¸€ä¸ªç”¨æ¥å­˜å‚¨å¦å¤–ä¸€ä¸ªå¯¹è±¡å†…éƒ¨çŠ¶æ€çš„å¿«ç…§çš„å¯¹è±¡ã€‚
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>é€‚ç”¨äºåŠŸèƒ½æ¯”è¾ƒå¤æ‚çš„ï¼Œä½†éœ€è¦è®°å½•æˆ–ç»´æŠ¤å±æ€§å†å²çš„ç±»ï¼›æˆ–è€…éœ€è¦ä¿å­˜çš„å±æ€§åªæ˜¯ä¼—å¤šå±æ€§ä¸­çš„ä¸€å°éƒ¨åˆ†æ—¶Originatorå¯ä»¥æ ¹æ®ä¿å­˜çš„Memoè¿˜åŸåˆ°å‰ä¸€çŠ¶æ€ã€‚</p>

<h3>çŠ¶æ€æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>çŠ¶æ€æ¨¡å¼ï¼šå½“ä¸€ä¸ªå¯¹è±¡çš„å†…åœ¨çŠ¶æ€æ”¹å˜æ—¶å…è®¸æ”¹å˜å…¶è¡Œä¸ºï¼Œè¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯æ”¹å˜äº†å…¶ç±»ã€‚
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™æ”¹å˜è¡Œä¸ºã€‚è¿™ä¸ªå¯¹è±¡çœ‹ä¸Šå»åƒæ˜¯æ”¹å˜äº†å®ƒçš„ç±»ä¸€æ ·ã€‚çŠ¶æ€æ¨¡å¼æŠŠæ‰€ç ”ç©¶çš„å¯¹è±¡çš„è¡Œä¸ºåŒ…è£…åœ¨ä¸åŒçš„çŠ¶æ€å¯¹è±¡é‡Œï¼Œæ¯ä¸€ä¸ªçŠ¶æ€å¯¹è±¡éƒ½å±äºä¸€ä¸ªæŠ½è±¡çŠ¶æ€ç±»çš„ä¸€ä¸ªå­ç±»ã€‚çŠ¶æ€æ¨¡å¼çš„æ€æƒ³æ˜¯è®©ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œå…¶è¡Œä¸ºä¹Ÿéšä¹‹æ”¹å˜ã€‚çŠ¶æ€æ¨¡å¼éœ€è¦å¯¹æ¯ä¸€ä¸ªç³»ç»Ÿå¯èƒ½å–å¾—çš„çŠ¶æ€åˆ›ç«‹ä¸€ä¸ªçŠ¶æ€ç±»çš„å­ç±»ã€‚å½“ç³»ç»Ÿçš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œç³»ç»Ÿä¾¿æ”¹å˜æ‰€é€‰çš„å­ç±»ã€‚

 çŠ¶æ€æ¨¡å¼ä¸»è¦è§£å†³çš„æ˜¯å½“æ§åˆ¶ä¸€ä¸ªå¯¹è±¡çŠ¶æ€è½¬æ¢çš„æ¡ä»¶è¡¨è¾¾å¼è¿‡äºå¤æ‚æ—¶çš„æƒ…å†µã€‚æŠŠçŠ¶æ€çš„åˆ¤æ–­é€»è¾‘è½¬ç§»åˆ°è¡¨ç¤ºä¸åŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç±»å½“ä¸­ï¼Œå¯ä»¥æŠŠå¤æ‚çš„åˆ¤æ–­é€»è¾‘ç®€åŒ–ã€‚
</code></pre>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>

<ul>
<li><p>çŠ¶æ€æ¨¡å¼çš„å¥½å¤„æ˜¯å°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–ï¼Œå¹¶ä¸”å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å‰²å¼€æ¥ã€‚</p>

<pre><code>  å³ï¼šå°†ç‰¹å®šçš„çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºéƒ½æ”¾å…¥ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œç”±äºæ‰€æœ‰ä¸çŠ¶æ€ç›¸å…³çš„ä»£ç éƒ½å­˜åœ¨äºæŸä¸ªConcreteStateä¸­ï¼Œæ‰€ä»¥é€šè¿‡å®šä¹‰æ–°çš„å­ç±»å¯ä»¥å¾ˆå®¹æ˜“åœ°å¢åŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢ã€‚
</code></pre></li>
<li><p>æ¶ˆé™¤äº†åºå¤§çš„æ¡ä»¶åˆ†æ”¯è¯­å¥ï¼Œå¹¶ä¸”é€šè¿‡æŠŠå„ç§çŠ¶æ€è½¬ç§»é€»è¾‘åˆ†å¸ƒåˆ°Stateçš„å­ç±»ä¹‹é—´ï¼Œæ¥å‡å°‘ç›¸äº’é—´çš„ä¾èµ–ã€‚
é€‚ç”¨æƒ…å†µï¼š</p></li>
<li><p>å½“ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶åˆ»æ ¹æ®çŠ¶æ€æ”¹å˜å®ƒçš„è¡Œä¸ºæ—¶ï¼Œå¯è€ƒè™‘ç”¨åˆ°çŠ¶æ€æ¨¡å¼ã€‚</p></li>
</ul>
</li>
</ul>


<h3>ä¸­ä»‹è€…æ¨¡å¼</h3>

<h6>1ã€æ€æƒ³</h6>

<pre><code>ä¸­ä»‹è€…æ¨¡å¼ï¼šç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’
</code></pre>

<h6>2ã€æ ¸å¿ƒæ€æƒ³</h6>

<p>åŒ…è£…äº†ä¸€ç³»åˆ—å¯¹è±¡ç›¸äº’ä½œç”¨çš„æ–¹å¼ï¼Œä½¿å¾—è¿™äº›å¯¹è±¡ä¸å¿…ç›¸äº’æ˜æ˜¾ä½œç”¨ã€‚ä»è€Œä½¿ä»–ä»¬å¯ä»¥æ¾æ•£è€¦åˆã€‚å½“æŸäº›å¯¹è±¡ä¹‹é—´çš„ä½œç”¨å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸ä¼šç«‹å³å½±å“å…¶ä»–çš„ä¸€äº›å¯¹è±¡ä¹‹é—´çš„ä½œç”¨ã€‚ä¿è¯è¿™äº›ä½œç”¨å¯ä»¥å½¼æ­¤ç‹¬ç«‹çš„å˜åŒ–ã€‚è°ƒåœè€…æ¨¡å¼å°†å¤šå¯¹å¤šçš„ç›¸äº’ä½œç”¨è½¬åŒ–ä¸ºä¸€å¯¹å¤šçš„ç›¸äº’ä½œç”¨ã€‚è°ƒåœè€…æ¨¡å¼å°†å¯¹è±¡çš„è¡Œä¸ºå’Œåä½œæŠ½è±¡åŒ–ï¼ŒæŠŠå¯¹è±¡åœ¨å°å°ºåº¦çš„è¡Œä¸ºä¸Šä¸å…¶ä»–å¯¹è±¡çš„ç›¸äº’ä½œç”¨åˆ†å¼€å¤„ç†ã€‚</p>

<h6>3ã€ä¼˜ç¼ºç‚¹åˆ†æ</h6>

<p>ä¸­ä»‹è€…æ¨¡å¼å¾ˆå®¹æ˜“åœ¨ç³»ç»Ÿä¸­åº”ç”¨ï¼Œä¹Ÿå¾ˆå®¹æ˜“åœ¨ç³»ç»Ÿä¸­è¯¯ç”¨ã€‚å½“ç³»ç»Ÿä¸­å‡ºç°äº†â€™å¤šå¯¹å¤šâ€™äº¤äº’å¤æ‚çš„å¯¹è±¡ç¾¤æ—¶ï¼Œä¸è¦æ€¥äºä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼Œè€Œè¦åæ€ä½ çš„ç³»ç»Ÿåœ¨è®¾è®¡ä¸Šæ˜¯ä¸æ˜¯åˆç†ã€‚</p>

<p>GOOD:</p>

<p>ï¼ˆ1ï¼‰Mediatorçš„å‡ºç°å‡å°‘äº†å„ä¸ªColleagueçš„è€¦åˆï¼Œä½¿å¾—å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å’Œå¤ç”¨å„ä¸ªColleagueç±»å’ŒMediator</p>

<p>ï¼ˆ2ï¼‰ç”±äºæŠŠå¯¹è±¡å¦‚ä½•åä½œè¿›è¡Œäº†æŠ½è±¡ï¼Œå°†ä¸­ä»‹ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¦‚å¿µå¹¶å°†å…¶å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè¿™æ ·å…³æ³¨çš„å¯¹è±¡å°±ä»å¯¹è±¡å„è‡ªæœ¬èº«çš„è¡Œä¸ºè½¬ç§»åˆ°äº†å®ƒä»¬ä¹‹é—´çš„äº¤äº’ä¸Šæ¥ï¼Œä¹Ÿå°±æ˜¯ç«™åœ¨ä¸€ä¸ªæ›´å®è§‚çš„è§’åº¦å»çœ‹å¾…ç³»ç»Ÿã€‚</p>

<p>BAD:</p>

<p>ç”±äºConcreteMediatoræ§åˆ¶äº†é›†ä¸­åŒ–ï¼Œäºæ˜¯å°±æŠŠäº¤äº’å¤æ‚æ€§å˜ä¸ºäº†ä¸­ä»‹è€…çš„å¤æ‚æ€§ï¼Œè¿™å°±ä½¿å¾—ä¸­ä»‹è€…ä¼šå˜å¾—æ¯”ä»»ä½•ä¸€ä¸ªConcreteColleagueéƒ½å¤æ‚ã€‚</p>

<h6>é€‚ç”¨åœºåˆï¼š</h6>

<p>ä¸­ä»‹è€…æ¨¡å¼ä¸€èˆ¬åº”ç”¨äºä¸€ç»„å¯¹è±¡ä»¥å®šä¹‰è‰¯å¥½ä½†æ˜¯å¤æ‚çš„æ–¹å¼è¿›è¡Œé€šä¿¡çš„åœºåˆï¼Œä»¥åŠæƒ³å®šä¹‰ä¸€ä¸ªåˆ†å¸ƒåœ¨å¤šä¸ªç±»ä¸­çš„è¡Œä¸ºï¼Œè€Œåˆä¸æƒ³ç”Ÿæˆå¤ªå¤šçš„å­ç±»çš„åœºåˆã€‚</p>

<h3>è§£é‡Šå™¨æ¨¡å¼</h3>

<h6>æ€æƒ³</h6>

<pre><code>Interpreteræ˜¯ä¸€ç§ç‰¹æ®Šçš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå»ºç«‹ä¸€ä¸ªè§£é‡Šå™¨ï¼Œå¯¹äºç‰¹å®šçš„è®¡ç®—æœºç¨‹åºè®¾è®¡è¯­è¨€ï¼Œç”¨æ¥è§£é‡Šé¢„å…ˆå®šä¹‰çš„æ–‡æ³•ã€‚ç®€å•åœ°è¯´ï¼ŒInterpreteræ¨¡å¼æ˜¯ä¸€ç§ç®€å•çš„è¯­æ³•è§£é‡Šå™¨æ„æ¶ã€‚

ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥æ ‡è¯†æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚
</code></pre>

<h6>é€‚ç”¨åœºæ™¯ï¼š</h6>

<pre><code>    1.å½“æœ‰ä¸€ä¸ªè¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”ä½ å¯å°†è¯¥è¯­è¨€ä¸­çš„å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼Œå¯ä»¥ä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼ã€‚è€Œå½“å­˜åœ¨ä»¥ä¸‹æƒ…å†µæ—¶è¯¥æ¨¡å¼æ•ˆæœæœ€å¥½

    2.è¯¥æ–‡æ³•çš„ç±»å±‚æ¬¡ç»“æ„å˜å¾—åºå¤§è€Œæ— æ³•ç®¡ç†ã€‚æ­¤æ—¶è¯­æ³•åˆ†æç¨‹åºç”Ÿæˆå™¨è¿™æ ·çš„å·¥å…·æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä»–ä»¬æ— éœ€æ„å»ºæŠ½è±¡è¯­æ³•æ ‘å³å¯è§£é‡Šè¡¨è¾¾å¼ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœç©ºé—´è€Œä¸”è¿˜å¯èƒ½èŠ‚çœæ—¶é—´ã€‚

    3.æ•ˆç‡ä¸æ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ï¼Œæœ€é«˜æ•ˆçš„è§£é‡Šå™¨é€šå¸¸ä¸æ˜¯é€šè¿‡ç›´æ¥è§£é‡Šè¯­æ³•åˆ†ææ ‘å®ç°çš„ï¼Œè€Œæ˜¯é¦–å…ˆå°†ä»–ä»¬è£…æ¢æˆå¦ä¸€ç§å½¢å¼ï¼Œä¾‹å¦‚ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸è¢«è£…æ¢æˆçŠ¶æ€æœºï¼Œå³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè½¬æ¢å™¨ä»å¯ç”¨è§£é‡Šå™¨æ¨¡å¼å®ç°ï¼Œè¯¥æ¨¡å¼ä»æ˜¯æœ‰ç”¨çš„
</code></pre>

<h6>ä¼˜ç¼ºç‚¹ï¼š</h6>

<ul>
<li><p>ä¼˜ç‚¹ï¼š 1ã€å¯æ‰©å±•æ€§æ¯”è¾ƒå¥½ï¼Œçµæ´»ã€‚ 2ã€å¢åŠ äº†æ–°çš„è§£é‡Šè¡¨è¾¾å¼çš„æ–¹å¼ã€‚ 3ã€æ˜“äºå®ç°ç®€å•æ–‡æ³•ã€‚</p></li>
<li><p>ç¼ºç‚¹ï¼š 1ã€å¯åˆ©ç”¨åœºæ™¯æ¯”è¾ƒå°‘ã€‚ 2ã€å¯¹äºå¤æ‚çš„æ–‡æ³•æ¯”è¾ƒéš¾ç»´æŠ¤ã€‚ 3ã€è§£é‡Šå™¨æ¨¡å¼ä¼šå¼•èµ·ç±»è†¨èƒ€ã€‚ 4ã€è§£é‡Šå™¨æ¨¡å¼é‡‡ç”¨é€’å½’è°ƒç”¨æ–¹æ³•ã€‚</p></li>
</ul>


<h3>è®¿é—®è€…æ¨¡å¼</h3>

<h6>æ€æƒ³ï¼š</h6>

<pre><code>å°è£…æŸäº›ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œã€‚
</code></pre>

<h6>ä¼˜ç‚¹</h6>

<pre><code>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼šå‡¡æ˜¯é€‚ç”¨è®¿é—®è€…æ¨¡å¼çš„åœºæ™¯ä¸­ï¼Œå…ƒç´ ç±»ä¸­éœ€è¦å°è£…åœ¨è®¿é—®è€…ä¸­çš„æ“ä½œå¿…å®šæ˜¯ä¸å…ƒç´ ç±»æœ¬èº«å…³ç³»ä¸å¤§ä¸”æ˜¯æ˜“å˜çš„æ“ä½œï¼Œä½¿ç”¨è®¿é—®è€…æ¨¡å¼ä¸€æ–¹é¢ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œå¦ä¸€æ–¹é¢ï¼Œå› ä¸ºè¢«å°è£…çš„æ“ä½œé€šå¸¸æ¥è¯´éƒ½æ˜¯æ˜“å˜çš„ï¼Œæ‰€ä»¥å½“å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±å¯ä»¥åœ¨ä¸æ”¹å˜å…ƒç´ ç±»æœ¬èº«çš„å‰æä¸‹ï¼Œå®ç°å¯¹å˜åŒ–éƒ¨åˆ†çš„æ‰©å±•ã€‚
æ‰©å±•æ€§è‰¯å¥½ï¼šå…ƒç´ ç±»å¯ä»¥é€šè¿‡æ¥å—ä¸åŒçš„è®¿é—®è€…æ¥å®ç°å¯¹ä¸åŒæ“ä½œçš„æ‰©å±•ã€‚
</code></pre>

<h6>è®¿é—®è€…æ¨¡å¼çš„é€‚ç”¨åœºæ™¯</h6>

<pre><code>   å‡å¦‚ä¸€ä¸ªå¯¹è±¡ä¸­å­˜åœ¨ç€ä¸€äº›ä¸æœ¬å¯¹è±¡ä¸ç›¸å¹²ï¼ˆæˆ–è€…å…³ç³»è¾ƒå¼±ï¼‰çš„æ“ä½œï¼Œä¸ºäº†é¿å…è¿™äº›æ“ä½œæ±¡æŸ“è¿™ä¸ªå¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥æŠŠè¿™äº›æ“ä½œå°è£…åˆ°è®¿é—®è€…ä¸­å»ã€‚

   å‡å¦‚ä¸€ç»„å¯¹è±¡ä¸­ï¼Œå­˜åœ¨ç€ç›¸ä¼¼çš„æ“ä½œï¼Œä¸ºäº†é¿å…å‡ºç°å¤§é‡é‡å¤çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥å°†è¿™äº›é‡å¤çš„æ“ä½œå°è£…åˆ°è®¿é—®è€…ä¸­å»ã€‚
</code></pre>

<hr />

<h4>å…¶ä»–ï¼š</h4>

<h3>å•ä¸€èŒè´£åŸåˆ™</h3>

<pre><code>å°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚
</code></pre>

<p>ã€€ã€€å¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…çš„èŒè´£è¿‡å¤šï¼Œå°±ç­‰äºæŠŠè¿™äº›èŒè´£è€¦åˆåœ¨ä¸€èµ·ï¼Œä¸€ä¸ªèŒè´£çš„å˜åŒ–å¯èƒ½ä¼šå‰Šå¼±æˆ–è€…æŠ‘åˆ¶è¿™ä¸ªç±»å®Œæˆå…¶å®ƒèŒè´£èƒ½åŠ›ã€‚è¿™ç§è€¦åˆä¼šå¯¼åˆ¶è„†å¼±çš„è®¾è®¡ï¼Œå½“å˜åŒ–å‘ç”Ÿæ—¶ï¼Œè®¾è®¡ä¼šé­å—åˆ°æ„æƒ³ä¸åˆ°çš„ç ´åã€‚</p>

<pre><code>è½¯ä»¶è®¾è®¡çœŸæ­£è¦åšçš„è®¸å¤šå†…å®¹ï¼Œå°±æ˜¯å‘ç°èŒè´£å¹¶æŠŠé‚£äº›èŒè´£ç›¸äº’åˆ†ç¦»ã€‚

å¦‚æœä½ èƒ½å¤Ÿæƒ³åˆ°å¤šäºä¸€ä¸ªçš„åŠ¨æœºå»æ”¹å˜ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±å…·æœ‰å¤šäºä¸€ä¸ªçš„èŒè´£ã€‚
</code></pre>

<h3>å¼€æ”¾â€”â€”å°é—­åŸåˆ™</h3>

<h6>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h6>

<pre><code>  OCP: è½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥å¯ä»¥æ‰©å±•ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹ã€‚

 è§£é‡Šï¼šå³å¯¹äºæ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œå¯¹äºä¿®æ”¹æ˜¯å°é—­çš„ã€‚
</code></pre>

<h6>äºŒã€å®é™…æŠ€å·§</h6>

<pre><code> å®é™…ä¸Šï¼Œæ— è®ºæ¨¡å¼å¤šä¹ˆçš„â€˜å°é—­â€™ï¼Œéƒ½ä¼šå­˜åœ¨ä¸€äº›æ— æ³•å¯¹ä¹‹å°é—­çš„å˜åŒ–ï¼Œæ—¢ç„¶ä¸å¯èƒ½å®Œå…¨å°é—­ï¼Œè®¾è®¡äººå‘˜å¿…é¡»å¯¹äºä»–è®¾è®¡çš„æ¨¡å—åº”è¯¥å¯¹å“ªç§å˜åŒ–å°é—­åšå‡ºé€‰æ‹©ã€‚ä»–å¿…é¡»å…ˆçŒœæµ‹å‡ºæœ€æœ‰å¯èƒ½å‘ç”Ÿçš„å˜åŒ–ç§ç±»ï¼Œç„¶åæ„é€ æŠ½è±¡æ¥éš”ç¦»é‚£äº›å˜åŒ–ã€‚

 å³ï¼šå½“å˜åŒ–å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å°±åˆ›å»ºæŠ½è±¡æ¥éš”ç¦»ä»¥åå‘ç”ŸåŒç±»çš„å˜åŒ–ã€‚ï¼ˆç­‰åˆ°å˜åŒ–å‘ç”Ÿæ—¶ç«‹å³é‡‡å–è¡ŒåŠ¨ï¼‰    

 é¢å¯¹éœ€æ±‚ï¼Œå¯¹ç¨‹åºçš„æ”¹åŠ¨æ˜¯é€šè¿‡å¢åŠ ä»£ç æ¥å®Œæˆçš„ï¼Œè€Œä¸æ˜¯æ”¹åŠ¨ç°æœ‰çš„ä»£ç ã€‚ï¼ˆä¾‹å¦‚ç®€å•å·¥å‚æ¨¡å¼æ€æƒ³ï¼‰
</code></pre>

<h6>ä¸‰ã€ä¼˜ç‚¹</h6>

<pre><code> å¼€æ”¾â€•â€•å°é—­åŸåˆ™æ˜¯é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ‰€åœ¨ã€‚è¿™ä¸ªåŸåˆ™æ‰€å¸¦æ¥çš„ä¼˜ç‚¹å°±æ˜¯å¯ç»´æŠ¤ã€å¯æ‰©å±•ã€å¯å¤ç”¨ã€çµæ´»å‹å¥½ã€‚

 å¼€å‘äººå‘˜åº”è¯¥å¯¹ç¨‹åºä¸­å‘ˆç°å‡ºé¢‘ç¹å˜åŒ–çš„é‚£éƒ¨åˆ†åšå‡ºæŠ½è±¡ï¼Œæ‹’ç»å¯¹ä»»ä½•éƒ¨åˆ†éƒ½åˆ»æ„æŠ½è±¡åŠä¸æˆç†Ÿçš„æŠ½è±¡ã€‚
</code></pre>

<h3>é‡Œæ°ä»£æ¢åŸåˆ™</h3>

<h6>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h6>

<pre><code>  æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚å³é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸è¦å¯¹å®ç°ç¼–ç¨‹ã€‚

Aï¼šé«˜å±‚æ¨¡å—ä¸èƒ½ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”ä¾èµ–æŠ½è±¡ã€‚

Bï¼šæŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ 
</code></pre>

<h6>äºŒã€é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLSPï¼‰</h6>

<pre><code>å­ç±»å‹å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰å®ƒä»¬çš„çˆ¶ç±»å‹
</code></pre>

<p>è§£é‡Šï¼šä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚æœä½¿ç”¨çš„æ˜¯ä¸€ä¸ªçˆ¶ç±»çš„è¯ï¼Œé‚£ä¹ˆä¸€å®šé€‚ç”¨äºå…¶å­ç±»ï¼Œè€Œä¸”å®ƒå¯Ÿè§‰ä¸å‡ºçˆ¶ç±»å¯¹è±¡å’Œå­ç±»å¯¹è±¡çš„åŒºåˆ«ã€‚</p>

<pre><code>   ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è½¯ä»¶é‡Œé¢ï¼ŒæŠŠçˆ¶ç±»éƒ½æ›¿æ¢æˆå®ƒçš„å­ç±»ï¼Œç¨‹åºçš„è¡Œä¸ºæ²¡æœ‰å˜åŒ–ã€‚

   åªæœ‰å½“å­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼Œçˆ¶ç±»æ‰çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œå­ç±»ä¹Ÿèƒ½å¤Ÿåœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚

   æ‰€ä»¥ï¼Œæ­£æ˜¯ç”±äºå­ç±»å‹çš„å¯æ›¿æ¢æ€§æ‰ä½¿å¾—ä½¿ç”¨çˆ¶ç±»ç±»å‹çš„æ¨¡å—åœ¨æ— éœ€ä¿®æ”¹çš„æƒ…å†µä¸‹å°±å¯ä»¥æ‰©å±•ã€‚
</code></pre>

<h3>æœ€å°‘çŸ¥è¯†åŸåˆ™</h3>

<h6>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h6>

<pre><code>è¿ªç±³ç‰¹æ³•åˆ™ï¼šå¦‚æœä¸¤ä¸ªç±»ä¸ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’ä½œç”¨ã€‚å¦‚æœä¸€ä¸ªç±»éœ€è¦è°ƒç”¨å¦ä¸€ä¸ªç±»çš„æŸä¸ªæ–¹æ³•çš„è¯ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰ä¸ªç±»è½¬å‘è¿™ä¸ªè°ƒç”¨ã€‚
</code></pre>

<h6>äºŒã€æ ¸å¿ƒæ€æƒ³</h6>

<pre><code> åœ¨ç±»çš„ç»“æ„è®¾è®¡ä¸Šï¼Œæ¯ä¸€ä¸ªç±»éƒ½åº”è¯¥å°½é‡é™ä½æˆå‘˜çš„è®¿é—®æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šä¸€ä¸ªç±»åŒ…è£…å¥½è‡ªå·±çš„privateçŠ¶æ€ï¼Œä¸éœ€è¦è®©åˆ«çš„ç±»çŸ¥é“çš„å­—æ®µæˆ–è¡Œä¸ºå°±ä¸è¦å…¬å¼€ã€‚

è¿ªç±³ç‰¹åŸåˆ™çš„æ ¹æœ¬æ€æƒ³ï¼šå¼ºè°ƒäº†ç±»ä¹‹é—´çš„æ¾è€¦åˆã€‚     

 ç±»ä¹‹é—´çš„è€¦åˆè¶Šå¼±ï¼Œè¶Šæœ‰åˆ©äºå¤ç”¨ï¼Œä¸€ä¸ªå¤„åœ¨å¼±è€¦åˆçš„ç±»è¢«ä¿®æ”¹ï¼Œä¸ä¼šå¯¹æœ‰å…³ç³»çš„ç±»é€ æˆæ³¢åŠã€‚

  è¯¥æ³•åˆ™åœ¨åé¢çš„é€‚é…å™¨æ¨¡å¼ã€è§£é‡Šæ¨¡å¼ç­‰ä¸­æœ‰å¼ºçƒˆçš„ä½“ç°ã€‚    
</code></pre>

<hr />

<hr />

<h2>æ€»ç»“ï¼š</h2>

<ul>
<li><p>1ã€å½“æ¶‰åŠåˆ°â€œç»´æŠ¤â€æ—¶ï¼Œä¸ºäº†â€œå¤ç”¨â€ç›®çš„è€Œä½¿ç”¨ç»§æ‰¿ï¼Œå¹¶ä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚</p></li>
<li><p>2ã€åˆ©ç”¨ç»§æ‰¿æ¥æä¾›å¯¹è±¡çš„è¡Œä¸ºï¼Œä¼šå¯¼è‡´ä»¥ä¸‹ç¼ºç‚¹ï¼š</p>

<ul>
<li><p>1ï¼‰ä»£ç åœ¨å¤šä¸ªå­ç±»ä¸­é‡å¤ï¼›</p></li>
<li><p>2ï¼‰è¿è¡Œæ—¶çš„è¡Œä¸ºä¸å®¹æ˜“æ”¹å˜ï¼›</p></li>
<li><p>3ï¼‰å¾ˆéš¾çŸ¥é“æ‰€æœ‰å­ç±»çš„å…¨éƒ¨è¡Œä¸ºï¼›</p></li>
<li><p>4ï¼‰æ”¹å˜çˆ¶ç±»ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œé€ æˆå…¶ä»–å­ç±»ä¸æƒ³è¦çš„æ”¹å˜ï¼›</p></li>
</ul>
</li>
<li><p>3ã€ä½¿ç”¨æ¥å£ï¼ˆJAVAï¼‰æˆ–è™šåŸºç±»åŠ å¤šé‡ç»§æ‰¿ï¼ˆC++ï¼‰æ–¹æ³•ï¼Œåˆ™ä¼šéœ€è¦å¯¹éœ€è¦ç»´æŠ¤çš„ä»£ç ä¸­çš„æ¯ä¸ªå­ç±»éƒ½åˆ†åˆ«è€ƒè™‘å…¶ç‰¹æœ‰æ–¹æ³•çš„ç»§æ‰¿æ¥æºã€‚</p></li>
<li><p>4ã€è®¾è®¡åŸåˆ™ï¼šæ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚å³ï¼šæŠŠä¼šå˜åŒ–çš„éƒ¨åˆ†å–å‡ºå¹¶â€œå°è£…â€èµ·æ¥ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥è½»æ˜“çš„æ”¹åŠ¨æˆ–æ‰©å……æ­¤éƒ¨åˆ†ï¼Œè€Œä¸å½±å“ä¸éœ€è¦å˜åŒ–çš„éƒ¨åˆ†ã€‚</p></li>
<li><p>5ã€è®¾è®¡åŸåˆ™ï¼šé’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p></li>
</ul>


<p>å°†å¯¹è±¡çš„è¡Œä¸ºæ”¾åœ¨åˆ†å¼€çš„ç±»ä¸­ï¼Œæ­¤ç±»ä¸“é—¨æä¾›æŸè¡Œä¸ºæ¥å£çš„å®ç°ï¼Œå¹¶ä¸”åœ¨å¯¹è±¡ç±»ä¸­åŒ…å«å¯è®¾å®šè¡Œä¸ºçš„æ–¹æ³•ï¼Œä½¿å¾—ç¨‹åºå¯åœ¨â€œè¿è¡Œæ—¶â€åŠ¨æ€çš„æ”¹å˜ç‰¹å®šå¯¹è±¡çš„è¡Œä¸ºã€‚</p>

<ul>
<li>6ã€å°è£…è¡Œä¸ºçš„å¤§å±€è§‚</li>
</ul>


<p>è®¾è®¡åŸåˆ™ï¼šå¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿</p>

<ul>
<li><p>7ã€ç­–ç•¥æ¨¡å‹ï¼šå®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</p></li>
<li><p>8ã€è®¾è®¡æ¨¡å¼çš„åè¯ä½¿ç”¨ä¸»è¦ä¸ºäº†ç¨‹åºå‘˜é—´äº¤æµæ–¹ä¾¿</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-ä¸ƒå¤§æŸ¥æ‰¾ç®—æ³•]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/20/xiu-xing-pian-qi-da-cha-zhao-suan-fa/"/>
    <updated>2016-08-20T12:32:08+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/20/xiu-xing-pian-qi-da-cha-zhao-suan-fa</id>
    <content type="html"><![CDATA[<p>é˜…è¯»ç›®å½•</p>

<ul>
<li><p>1ã€é¡ºåºæŸ¥æ‰¾</p></li>
<li><p>2ã€äºŒåˆ†æŸ¥æ‰¾</p></li>
<li><p>3ã€æ’å€¼æŸ¥æ‰¾</p></li>
<li><p>4ã€æ–æ³¢é‚£å¥‘æŸ¥æ‰¾</p></li>
<li><p>5ã€æ ‘è¡¨æŸ¥æ‰¾</p></li>
<li><p>6ã€åˆ†å—æŸ¥æ‰¾</p></li>
<li><p>7ã€å“ˆå¸ŒæŸ¥æ‰¾</p></li>
</ul>


<p>æŸ¥æ‰¾æ˜¯åœ¨å¤§é‡çš„ä¿¡æ¯ä¸­å¯»æ‰¾ä¸€ä¸ªç‰¹å®šçš„ä¿¡æ¯å…ƒç´ ï¼Œåœ¨è®¡ç®—æœºåº”ç”¨ä¸­ï¼ŒæŸ¥æ‰¾æ˜¯å¸¸ç”¨çš„åŸºæœ¬è¿ç®—ï¼Œä¾‹å¦‚ç¼–è¯‘ç¨‹åºä¸­ç¬¦å·è¡¨çš„æŸ¥æ‰¾ã€‚</p>

<!--more-->


<blockquote><p>æœ¬æ–‡ç®€å•æ¦‚æ‹¬æ€§çš„ä»‹ç»äº†å¸¸è§çš„ä¸ƒç§æŸ¥æ‰¾ç®—æ³•ï¼Œè¯´æ˜¯ä¸ƒç§ï¼Œå…¶å®äºŒåˆ†æŸ¥æ‰¾ã€æ’å€¼æŸ¥æ‰¾ä»¥åŠæ–æ³¢é‚£å¥‘æŸ¥æ‰¾éƒ½å¯ä»¥å½’ä¸ºä¸€ç±»â€”â€”æ’å€¼æŸ¥æ‰¾ã€‚æ’å€¼æŸ¥æ‰¾å’Œæ–æ³¢é‚£å¥‘æŸ¥æ‰¾æ˜¯åœ¨äºŒåˆ†æŸ¥æ‰¾çš„åŸºç¡€ä¸Šçš„ä¼˜åŒ–æŸ¥æ‰¾ç®—æ³•ã€‚æ ‘è¡¨æŸ¥æ‰¾å’Œå“ˆå¸ŒæŸ¥æ‰¾ä¼šåœ¨åç»­çš„åšæ–‡ä¸­è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p></blockquote>

<p>æŸ¥æ‰¾å®šä¹‰ï¼šæ ¹æ®ç»™å®šçš„æŸä¸ªå€¼ï¼Œåœ¨æŸ¥æ‰¾è¡¨ä¸­ç¡®å®šä¸€ä¸ªå…¶å…³é”®å­—ç­‰äºç»™å®šå€¼çš„æ•°æ®å…ƒç´ ï¼ˆæˆ–è®°å½•ï¼‰ã€‚</p>

<p>æŸ¥æ‰¾ç®—æ³•åˆ†ç±»ï¼š</p>

<p>1ï¼‰é™æ€æŸ¥æ‰¾å’ŒåŠ¨æ€æŸ¥æ‰¾ï¼›</p>

<pre><code>æ³¨ï¼šé™æ€æˆ–è€…åŠ¨æ€éƒ½æ˜¯é’ˆå¯¹æŸ¥æ‰¾è¡¨è€Œè¨€çš„ã€‚åŠ¨æ€è¡¨æŒ‡æŸ¥æ‰¾è¡¨ä¸­æœ‰åˆ é™¤å’Œæ’å…¥æ“ä½œçš„è¡¨ã€‚
</code></pre>

<p>2ï¼‰æ— åºæŸ¥æ‰¾å’Œæœ‰åºæŸ¥æ‰¾ã€‚</p>

<pre><code>æ— åºæŸ¥æ‰¾ï¼šè¢«æŸ¥æ‰¾æ•°åˆ—æœ‰åºæ— åºå‡å¯ï¼›

æœ‰åºæŸ¥æ‰¾ï¼šè¢«æŸ¥æ‰¾æ•°åˆ—å¿…é¡»ä¸ºæœ‰åºæ•°åˆ—ã€‚
</code></pre>

<p>å¹³å‡æŸ¥æ‰¾é•¿åº¦ï¼ˆAverage Search Lengthï¼ŒASLï¼‰ï¼š</p>

<ul>
<li>éœ€å’ŒæŒ‡å®škeyè¿›è¡Œæ¯”è¾ƒçš„å…³é”®å­—çš„ä¸ªæ•°çš„æœŸæœ›å€¼ï¼Œç§°ä¸ºæŸ¥æ‰¾ç®—æ³•åœ¨æŸ¥æ‰¾æˆåŠŸæ—¶çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ã€‚</li>
</ul>


<p>å¯¹äºå«æœ‰nä¸ªæ•°æ®å…ƒç´ çš„æŸ¥æ‰¾è¡¨ï¼ŒæŸ¥æ‰¾æˆåŠŸçš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸ºï¼šASL = Pi*Ciçš„å’Œã€‚</p>

<pre><code>Piï¼šæŸ¥æ‰¾è¡¨ä¸­ç¬¬iä¸ªæ•°æ®å…ƒç´ çš„æ¦‚ç‡ã€‚

Ciï¼šæ‰¾åˆ°ç¬¬iä¸ªæ•°æ®å…ƒç´ æ—¶å·²ç»æ¯”è¾ƒè¿‡çš„æ¬¡æ•°ã€‚
</code></pre>

<h3>1ã€é¡ºåºæŸ¥æ‰¾</h3>

<ul>
<li>è¯´æ˜ï¼šé¡ºåºæŸ¥æ‰¾é€‚åˆäºå­˜å‚¨ç»“æ„ä¸ºé¡ºåºå­˜å‚¨æˆ–é“¾æ¥å­˜å‚¨çš„çº¿æ€§è¡¨ã€‚</li>
</ul>


<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<pre><code>é¡ºåºæŸ¥æ‰¾ä¹Ÿç§°ä¸ºçº¿å½¢æŸ¥æ‰¾ï¼Œå±äºæ— åºæŸ¥æ‰¾ç®—æ³•ã€‚ä»æ•°æ®ç»“æ„çº¿å½¢è¡¨çš„ä¸€ç«¯å¼€å§‹ï¼Œé¡ºåºæ‰«æï¼Œä¾æ¬¡å°†æ‰«æåˆ°çš„ç»“ç‚¹å…³é”®å­—ä¸ç»™å®šå€¼kç›¸æ¯”è¾ƒï¼Œè‹¥ç›¸ç­‰åˆ™è¡¨ç¤ºæŸ¥æ‰¾æˆåŠŸï¼›è‹¥æ‰«æç»“æŸä»æ²¡æœ‰æ‰¾åˆ°å…³é”®å­—ç­‰äºkçš„ç»“ç‚¹ï¼Œè¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥ã€‚
</code></pre>

<p>å¤æ‚åº¦åˆ†æï¼šã€€</p>

<pre><code>æŸ¥æ‰¾æˆåŠŸæ—¶çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸ºï¼šï¼ˆå‡è®¾æ¯ä¸ªæ•°æ®å…ƒç´ çš„æ¦‚ç‡ç›¸ç­‰ï¼‰ ASL = 1/n(1+2+3+â€¦+n) = (n+1)/2 ;
</code></pre>

<p>å½“æŸ¥æ‰¾ä¸æˆåŠŸæ—¶ï¼Œéœ€è¦n+1æ¬¡æ¯”è¾ƒï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n);</p>

<blockquote><p>æ‰€ä»¥ï¼Œé¡ºåºæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p></blockquote>

<pre><code>//é¡ºåºæŸ¥æ‰¾
int SequenceSearch(int a[], int value, int n)
{
    int i;
    for(i=0; i&lt;n; i++)
        if(a[i]==value)
            return i;
    return -1;
}
</code></pre>

<h3>2ã€äºŒåˆ†æŸ¥æ‰¾</h3>

<blockquote><p>è¯´æ˜ï¼šå…ƒç´ å¿…é¡»æ˜¯æœ‰åºçš„ï¼Œå¦‚æœæ˜¯æ— åºçš„åˆ™è¦å…ˆè¿›è¡Œæ’åºæ“ä½œã€‚</p></blockquote>

<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<pre><code>ä¹Ÿç§°ä¸ºæ˜¯æŠ˜åŠæŸ¥æ‰¾ï¼Œå±äºæœ‰åºæŸ¥æ‰¾ç®—æ³•ã€‚ç”¨ç»™å®šå€¼kå…ˆä¸ä¸­é—´ç»“ç‚¹çš„å…³é”®å­—æ¯”è¾ƒï¼Œä¸­é—´ç»“ç‚¹æŠŠçº¿å½¢è¡¨åˆ†æˆä¸¤ä¸ªå­è¡¨ï¼Œè‹¥ç›¸ç­‰åˆ™æŸ¥æ‰¾æˆåŠŸï¼›è‹¥ä¸ç›¸ç­‰ï¼Œå†æ ¹æ®kä¸è¯¥ä¸­é—´ç»“ç‚¹å…³é”®å­—çš„æ¯”è¾ƒç»“æœç¡®å®šä¸‹ä¸€æ­¥æŸ¥æ‰¾å“ªä¸ªå­è¡¨ï¼Œè¿™æ ·é€’å½’è¿›è¡Œï¼Œç›´åˆ°æŸ¥æ‰¾åˆ°æˆ–æŸ¥æ‰¾ç»“æŸå‘ç°è¡¨ä¸­æ²¡æœ‰è¿™æ ·çš„ç»“ç‚¹ã€‚
</code></pre>

<p>å¤æ‚åº¦åˆ†æï¼š</p>

<pre><code>æœ€åæƒ…å†µä¸‹ï¼Œå…³é”®è¯æ¯”è¾ƒæ¬¡æ•°ä¸ºlog2(n+1)ï¼Œä¸”æœŸæœ›æ—¶é—´å¤æ‚åº¦ä¸ºO(log2n)ï¼›
</code></pre>

<blockquote><p>æ³¨ï¼šæŠ˜åŠæŸ¥æ‰¾çš„å‰ææ¡ä»¶æ˜¯éœ€è¦æœ‰åºè¡¨é¡ºåºå­˜å‚¨ï¼Œå¯¹äºé™æ€æŸ¥æ‰¾è¡¨ï¼Œä¸€æ¬¡æ’åºåä¸å†å˜åŒ–ï¼ŒæŠ˜åŠæŸ¥æ‰¾èƒ½å¾—åˆ°ä¸é”™çš„æ•ˆç‡ã€‚ä½†å¯¹äºéœ€è¦é¢‘ç¹æ‰§è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œçš„æ•°æ®é›†æ¥è¯´ï¼Œç»´æŠ¤æœ‰åºçš„æ’åºä¼šå¸¦æ¥ä¸å°çš„å·¥ä½œé‡ï¼Œé‚£å°±ä¸å»ºè®®ä½¿ç”¨ã€‚â€”â€”ã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹</p></blockquote>

<pre><code>    //äºŒåˆ†æŸ¥æ‰¾ï¼ˆæŠ˜åŠæŸ¥æ‰¾ï¼‰ï¼Œç‰ˆæœ¬1
int BinarySearch1(int a[], int value, int n)
{
    int low, high, mid;
    low = 0;
    high = n-1;
    while(low&lt;=high)
    {
        mid = (low+high)/2;
        if(a[mid]==value)
            return mid;
        if(a[mid]&gt;value)
            high = mid-1;
        if(a[mid]&lt;value)
            low = mid+1;
    }
    return -1;
}

//äºŒåˆ†æŸ¥æ‰¾ï¼Œé€’å½’ç‰ˆæœ¬
int BinarySearch2(int a[], int value, int low, int high)
{
    int mid = low+(high-low)/2;
    if(a[mid]==value)
        return mid;
    if(a[mid]&gt;value)
        return BinarySearch2(a, value, low, mid-1);
    if(a[mid]&lt;value)
        return BinarySearch2(a, value, mid+1, high);
}
</code></pre>

<h3>3ã€æ’å€¼æŸ¥æ‰¾</h3>

<p>åœ¨ä»‹ç»æ’å€¼æŸ¥æ‰¾ä¹‹å‰ï¼Œé¦–å…ˆè€ƒè™‘ä¸€ä¸ªæ–°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸Šè¿°ç®—æ³•ä¸€å®šè¦æ˜¯æŠ˜åŠï¼Œè€Œä¸æ˜¯æŠ˜å››åˆ†ä¹‹ä¸€æˆ–è€…æŠ˜æ›´å¤šå‘¢ï¼Ÿ</p>

<pre><code>æ‰“ä¸ªæ¯”æ–¹ï¼Œåœ¨è‹±æ–‡å­—å…¸é‡Œé¢æŸ¥â€œappleâ€ï¼Œä½ ä¸‹æ„è¯†ç¿»å¼€å­—å…¸æ˜¯ç¿»å‰é¢çš„ä¹¦é¡µè¿˜æ˜¯åé¢çš„ä¹¦é¡µå‘¢ï¼Ÿå¦‚æœå†è®©ä½ æŸ¥â€œzooâ€ï¼Œä½ åˆæ€ä¹ˆæŸ¥ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œä½ ç»å¯¹ä¸ä¼šæ˜¯ä»ä¸­é—´å¼€å§‹æŸ¥èµ·ï¼Œè€Œæ˜¯æœ‰ä¸€å®šç›®çš„çš„å¾€å‰æˆ–å¾€åç¿»ã€‚
</code></pre>

<p>åŒæ ·çš„ï¼Œæ¯”å¦‚è¦åœ¨å–å€¼èŒƒå›´1 ~ 10000 ä¹‹é—´ 100 ä¸ªå…ƒç´ ä»å°åˆ°å¤§å‡åŒ€åˆ†å¸ƒçš„æ•°ç»„ä¸­æŸ¥æ‰¾5ï¼Œ æˆ‘ä»¬è‡ªç„¶ä¼šè€ƒè™‘ä»æ•°ç»„ä¸‹æ ‡è¾ƒå°çš„å¼€å§‹æŸ¥æ‰¾ã€‚</p>

<p>ç»è¿‡ä»¥ä¸Šåˆ†æï¼ŒæŠ˜åŠæŸ¥æ‰¾è¿™ç§æŸ¥æ‰¾æ–¹å¼ï¼Œä¸æ˜¯è‡ªé€‚åº”çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´æ˜¯å‚»ç“œå¼çš„ï¼‰ã€‚äºŒåˆ†æŸ¥æ‰¾ä¸­æŸ¥æ‰¾ç‚¹è®¡ç®—å¦‚ä¸‹ï¼š</p>

<pre><code>mid=(low+high)/2, å³mid=low+1/2*(high-low);
</code></pre>

<p>é€šè¿‡ç±»æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸ¥æ‰¾çš„ç‚¹æ”¹è¿›ä¸ºå¦‚ä¸‹ï¼š</p>

<pre><code>mid=low+(key-a[low])/(a[high]-a[low])*(high-low)ï¼Œ
</code></pre>

<p>ä¹Ÿå°±æ˜¯å°†ä¸Šè¿°çš„æ¯”ä¾‹å‚æ•°1/2æ”¹è¿›ä¸ºè‡ªé€‚åº”çš„ï¼Œæ ¹æ®å…³é”®å­—åœ¨æ•´ä¸ªæœ‰åºè¡¨ä¸­æ‰€å¤„çš„ä½ç½®ï¼Œè®©midå€¼çš„å˜åŒ–æ›´é è¿‘å…³é”®å­—keyï¼Œè¿™æ ·ä¹Ÿå°±é—´æ¥åœ°å‡å°‘äº†æ¯”è¾ƒæ¬¡æ•°ã€‚</p>

<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<pre><code>åŸºäºäºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Œå°†æŸ¥æ‰¾ç‚¹çš„é€‰æ‹©æ”¹è¿›ä¸ºè‡ªé€‚åº”é€‰æ‹©ï¼Œå¯ä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚å½“ç„¶ï¼Œå·®å€¼æŸ¥æ‰¾ä¹Ÿå±äºæœ‰åºæŸ¥æ‰¾ã€‚
</code></pre>

<blockquote><p>æ³¨ï¼šå¯¹äºè¡¨é•¿è¾ƒå¤§ï¼Œè€Œå…³é”®å­—åˆ†å¸ƒåˆæ¯”è¾ƒå‡åŒ€çš„æŸ¥æ‰¾è¡¨æ¥è¯´ï¼Œæ’å€¼æŸ¥æ‰¾ç®—æ³•çš„å¹³å‡æ€§èƒ½æ¯”æŠ˜åŠæŸ¥æ‰¾è¦å¥½çš„å¤šã€‚åä¹‹ï¼Œæ•°ç»„ä¸­å¦‚æœåˆ†å¸ƒéå¸¸ä¸å‡åŒ€ï¼Œé‚£ä¹ˆæ’å€¼æŸ¥æ‰¾æœªå¿…æ˜¯å¾ˆåˆé€‚çš„é€‰æ‹©ã€‚</p></blockquote>

<p>å¤æ‚åº¦åˆ†æï¼šæŸ¥æ‰¾æˆåŠŸæˆ–è€…å¤±è´¥çš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(log2(log2n))ã€‚</p>

<pre><code>//æ’å€¼æŸ¥æ‰¾
int InsertionSearch(int a[], int value, int low, int high)
{
    int mid = low+(value-a[low])/(a[high]-a[low])*(high-low);
    if(a[mid]==value)
        return mid;
    if(a[mid]&gt;value)
        return InsertionSearch(a, value, low, mid-1);
    if(a[mid]&lt;value)
        return InsertionSearch(a, value, mid+1, high);
}
</code></pre>

<h3>4ã€æ–æ³¢é‚£å¥‘æŸ¥æ‰¾</h3>

<blockquote><p>åœ¨ä»‹ç»æ–æ³¢é‚£å¥‘æŸ¥æ‰¾ç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹å¾ˆå®ƒç´§å¯†ç›¸è¿å¹¶ä¸”å¤§å®¶éƒ½ç†ŸçŸ¥çš„ä¸€ä¸ªæ¦‚å¿µâ€”â€”é»„é‡‘åˆ†å‰²ã€‚</p></blockquote>

<p>é»„é‡‘æ¯”ä¾‹åˆç§°é»„é‡‘åˆ†å‰²ï¼Œ</p>

<pre><code>æ˜¯æŒ‡äº‹ç‰©å„éƒ¨åˆ†é—´ä¸€å®šçš„æ•°å­¦æ¯”ä¾‹å…³ç³»ï¼Œå³å°†æ•´ä½“ä¸€åˆ†ä¸ºäºŒï¼Œè¾ƒå¤§éƒ¨åˆ†ä¸è¾ƒå°éƒ¨åˆ†ä¹‹æ¯”ç­‰äºæ•´ä½“ä¸è¾ƒå¤§éƒ¨åˆ†ä¹‹æ¯”ï¼Œå…¶æ¯”å€¼çº¦ä¸º1:0.618æˆ–1.618:1ã€‚
</code></pre>

<p>0.618è¢«å…¬è®¤ä¸ºæœ€å…·æœ‰å®¡ç¾æ„ä¹‰çš„æ¯”ä¾‹æ•°å­—ï¼Œè¿™ä¸ªæ•°å€¼çš„ä½œç”¨ä¸ä»…ä»…ä½“ç°åœ¨è¯¸å¦‚ç»˜ç”»ã€é›•å¡‘ã€éŸ³ä¹ã€å»ºç­‘ç­‰è‰ºæœ¯é¢†åŸŸï¼Œè€Œä¸”åœ¨ç®¡ç†ã€å·¥ç¨‹è®¾è®¡ç­‰æ–¹é¢ä¹Ÿæœ‰ç€ä¸å¯å¿½è§†çš„ä½œç”¨ã€‚å› æ­¤è¢«ç§°ä¸ºé»„é‡‘åˆ†å‰²ã€‚</p>

<p>å¤§å®¶è®°ä¸è®°å¾—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼š</p>

<ul>
<li>1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89â€¦â€¦.ï¼ˆä»ç¬¬ä¸‰ä¸ªæ•°å¼€å§‹ï¼Œåè¾¹æ¯ä¸€ä¸ªæ•°éƒ½æ˜¯å‰ä¸¤ä¸ªæ•°çš„å’Œï¼‰ã€‚ç„¶åæˆ‘ä»¬ä¼šå‘ç°ï¼Œéšç€æ–æ³¢é‚£å¥‘æ•°åˆ—çš„é€’å¢ï¼Œå‰åä¸¤ä¸ªæ•°çš„æ¯”å€¼ä¼šè¶Šæ¥è¶Šæ¥è¿‘0.618ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†é»„é‡‘æ¯”ä¾‹è¿ç”¨åˆ°æŸ¥æ‰¾æŠ€æœ¯ä¸­ã€‚</li>
</ul>


<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<pre><code>ä¹Ÿæ˜¯äºŒåˆ†æŸ¥æ‰¾çš„ä¸€ç§æå‡ç®—æ³•ï¼Œé€šè¿‡è¿ç”¨é»„é‡‘æ¯”ä¾‹çš„æ¦‚å¿µåœ¨æ•°åˆ—ä¸­é€‰æ‹©æŸ¥æ‰¾ç‚¹è¿›è¡ŒæŸ¥æ‰¾ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚åŒæ ·åœ°ï¼Œæ–æ³¢é‚£å¥‘æŸ¥æ‰¾ä¹Ÿå±äºä¸€ç§æœ‰åºæŸ¥æ‰¾ç®—æ³•ã€‚
</code></pre>

<p>ç›¸å¯¹äºæŠ˜åŠæŸ¥æ‰¾ï¼Œä¸€èˆ¬å°†å¾…æ¯”è¾ƒçš„keyå€¼ä¸ç¬¬mid=ï¼ˆlow+highï¼‰/2ä½ç½®çš„å…ƒç´ æ¯”è¾ƒï¼Œæ¯”è¾ƒç»“æœåˆ†ä¸‰ç§æƒ…å†µï¼š</p>

<ul>
<li><p>1ï¼‰ç›¸ç­‰ï¼Œmidä½ç½®çš„å…ƒç´ å³ä¸ºæ‰€æ±‚</p></li>
<li><p>2ï¼‰>ï¼Œlow=mid+1;</p></li>
<li><p>3ï¼‰&lt;ï¼Œhigh=mid-1ã€‚</p></li>
</ul>


<p>æ–æ³¢é‚£å¥‘æŸ¥æ‰¾ä¸æŠ˜åŠæŸ¥æ‰¾å¾ˆç›¸ä¼¼ï¼Œä»–æ˜¯æ ¹æ®æ–æ³¢é‚£å¥‘åºåˆ—çš„ç‰¹ç‚¹å¯¹æœ‰åºè¡¨è¿›è¡Œåˆ†å‰²çš„ã€‚ä»–è¦æ±‚å¼€å§‹è¡¨ä¸­è®°å½•çš„ä¸ªæ•°ä¸ºæŸä¸ªæ–æ³¢é‚£å¥‘æ•°å°1ï¼ŒåŠn=F(k)-1;</p>

<p>å¼€å§‹å°†kå€¼ä¸ç¬¬F(k-1)ä½ç½®çš„è®°å½•è¿›è¡Œæ¯”è¾ƒ(åŠmid=low+F(k-1)-1),æ¯”è¾ƒç»“æœä¹Ÿåˆ†ä¸ºä¸‰ç§</p>

<ul>
<li><p>1ï¼‰ç›¸ç­‰ï¼Œmidä½ç½®çš„å…ƒç´ å³ä¸ºæ‰€æ±‚</p></li>
<li><p>2ï¼‰>ï¼Œlow=mid+1,k-=2;</p>

<ul>
<li>è¯´æ˜ï¼šlow=mid+1è¯´æ˜å¾…æŸ¥æ‰¾çš„å…ƒç´ åœ¨[mid+1,high]èŒƒå›´å†…ï¼Œk-=2 è¯´æ˜èŒƒå›´[mid+1,high]å†…çš„å…ƒç´ ä¸ªæ•°ä¸ºn-(F(k-1))= Fk-1-F(k-1)=Fk-F(k-1)-1=F(k-2)-1ä¸ªï¼Œæ‰€ä»¥å¯ä»¥é€’å½’çš„åº”ç”¨æ–æ³¢é‚£å¥‘æŸ¥æ‰¾ã€‚</li>
</ul>
</li>
<li><p>3ï¼‰&lt;ï¼Œhigh=mid-1,k-=1ã€‚</p></li>
</ul>


<p>è¯´æ˜ï¼šlow=mid+1è¯´æ˜å¾…æŸ¥æ‰¾çš„å…ƒç´ åœ¨[low,mid-1]èŒƒå›´å†…ï¼Œk-=1 è¯´æ˜èŒƒå›´[low,mid-1]å†…çš„å…ƒç´ ä¸ªæ•°ä¸ºF(k-1)-1ä¸ªï¼Œæ‰€ä»¥å¯ä»¥é€’å½’ çš„åº”ç”¨æ–æ³¢é‚£å¥‘æŸ¥æ‰¾ã€‚</p>

<p>å¤æ‚åº¦åˆ†æï¼šæœ€åæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(log2n)ï¼Œä¸”å…¶æœŸæœ›å¤æ‚åº¦ä¹Ÿä¸ºO(log2n)ã€‚</p>

<pre><code>// æ–æ³¢é‚£å¥‘æŸ¥æ‰¾.cpp 

#include "stdafx.h"
#include &lt;memory&gt;
#include  &lt;iostream&gt;
using namespace std;

const int max_size=20;//æ–æ³¢é‚£å¥‘æ•°ç»„çš„é•¿åº¦

/*æ„é€ ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°ç»„*/ 
void Fibonacci(int * F)
{
    F[0]=0;
    F[1]=1;
    for(int i=2;i&lt;max_size;++i)
        F[i]=F[i-1]+F[i-2];
}

/*å®šä¹‰æ–æ³¢é‚£å¥‘æŸ¥æ‰¾æ³•*/  
int FibonacciSearch(int *a, int n, int key)  //aä¸ºè¦æŸ¥æ‰¾çš„æ•°ç»„,nä¸ºè¦æŸ¥æ‰¾çš„æ•°ç»„é•¿åº¦,keyä¸ºè¦æŸ¥æ‰¾çš„å…³é”®å­—
{
  int low=0;
  int high=n-1;

  int F[max_size];
  Fibonacci(F);//æ„é€ ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°ç»„F 

  int k=0;
  while(n&gt;F[k]-1)//è®¡ç®—nä½äºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä½ç½®
      ++k;

  int  * temp;//å°†æ•°ç»„aæ‰©å±•åˆ°F[k]-1çš„é•¿åº¦
  temp=new int [F[k]-1];
  memcpy(temp,a,n*sizeof(int));

  for(int i=n;i&lt;F[k]-1;++i)
     temp[i]=a[n-1];

  while(low&lt;=high)
  {
    int mid=low+F[k-1]-1;
    if(key&lt;temp[mid])
    {
      high=mid-1;
      k-=1;
    }
    else if(key&gt;temp[mid])
    {
     low=mid+1;
     k-=2;
    }
    else
    {
       if(mid&lt;n)
           return mid; //è‹¥ç›¸ç­‰åˆ™è¯´æ˜midå³ä¸ºæŸ¥æ‰¾åˆ°çš„ä½ç½®
       else
           return n-1; //è‹¥mid&gt;=nåˆ™è¯´æ˜æ˜¯æ‰©å±•çš„æ•°å€¼,è¿”å›n-1
    }
  }  
  delete [] temp;
  return -1;
}

int main()
{
    int a[] = {0,16,24,35,47,59,62,73,88,99};
    int key=100;
    int index=FibonacciSearch(a,sizeof(a)/sizeof(int),key);
    cout&lt;&lt;key&lt;&lt;" is located at:"&lt;&lt;index;
    return 0;
}
</code></pre>

<h3>5ã€æ ‘è¡¨æŸ¥æ‰¾</h3>

<h5>5.1 æœ€ç®€å•çš„æ ‘è¡¨æŸ¥æ‰¾ç®—æ³•â€”â€”äºŒå‰æ ‘æŸ¥æ‰¾ç®—æ³•ã€‚</h5>

<p>åŸºæœ¬æ€æƒ³ï¼š</p>

<pre><code>äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯å…ˆå¯¹å¾…æŸ¥æ‰¾çš„æ•°æ®è¿›è¡Œç”Ÿæˆæ ‘ï¼Œç¡®ä¿æ ‘çš„å·¦åˆ†æ”¯çš„å€¼å°äºå³åˆ†æ”¯çš„å€¼ï¼Œç„¶ååœ¨å°±è¡Œå’Œæ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ¯”è¾ƒå¤§å°ï¼ŒæŸ¥æ‰¾æœ€é€‚åˆçš„èŒƒå›´ã€‚ è¿™ä¸ªç®—æ³•çš„æŸ¥æ‰¾æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨è¿™ç§æŸ¥æ‰¾æ–¹æ³•è¦é¦–å…ˆåˆ›å»ºæ ‘ã€‚ 
</code></pre>

<p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinarySearch Treeï¼Œä¹Ÿå«äºŒå‰æœç´¢æ ‘ï¼Œæˆ–ç§°äºŒå‰æ’åºæ ‘Binary Sort Treeï¼‰æˆ–è€…æ˜¯ä¸€æ£µç©ºæ ‘ï¼Œæˆ–è€…æ˜¯å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š</p>

<ul>
<li><p>1ï¼‰è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›</p></li>
<li><p>2ï¼‰è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›</p></li>
<li><p>3ï¼‰ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ã€‚</p></li>
</ul>


<p>äºŒå‰æŸ¥æ‰¾æ ‘æ€§è´¨ï¼š</p>

<pre><code>å¯¹äºŒå‰æŸ¥æ‰¾æ ‘è¿›è¡Œä¸­åºéå†ï¼Œå³å¯å¾—åˆ°æœ‰åºçš„æ•°åˆ—ã€‚
</code></pre>

<p>ä¸åŒå½¢æ€çš„äºŒå‰æŸ¥æ‰¾æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p>æœ‰å…³äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œçš„è¯¦ç»†è®²è§£ï¼Œè¯·ç§»æ­¥æµ…è°ˆç®—æ³•å’Œæ•°æ®ç»“æ„: ä¸ƒ äºŒå‰æŸ¥æ‰¾æ ‘ã€‚</p>

<p>å¤æ‚åº¦åˆ†æï¼šå®ƒå’ŒäºŒåˆ†æŸ¥æ‰¾ä¸€æ ·ï¼Œæ’å…¥å’ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(logn)ï¼Œä½†æ˜¯åœ¨æœ€åçš„æƒ…å†µä¸‹ä»ç„¶ä¼šæœ‰O(n)çš„æ—¶é—´å¤æ‚åº¦ã€‚åŸå› åœ¨äºæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œæ ‘æ²¡æœ‰ä¿æŒå¹³è¡¡ï¼ˆæ¯”å¦‚ï¼Œæˆ‘ä»¬æŸ¥æ‰¾ä¸Šå›¾ï¼ˆbï¼‰ä¸­çš„â€œ93â€ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œnæ¬¡æŸ¥æ‰¾æ“ä½œï¼‰ã€‚æˆ‘ä»¬è¿½æ±‚çš„æ˜¯åœ¨æœ€åçš„æƒ…å†µä¸‹ä»ç„¶æœ‰è¾ƒå¥½çš„æ—¶é—´å¤æ‚åº¦ï¼Œè¿™å°±æ˜¯å¹³è¡¡æŸ¥æ‰¾æ ‘è®¾è®¡çš„åˆè¡·ã€‚</p>

<p>ä¸‹å›¾ä¸ºäºŒå‰æ ‘æŸ¥æ‰¾å’Œé¡ºåºæŸ¥æ‰¾ä»¥åŠäºŒåˆ†æŸ¥æ‰¾æ€§èƒ½çš„å¯¹æ¯”å›¾ï¼š</p>

<p>åŸºäºäºŒå‰æŸ¥æ‰¾æ ‘è¿›è¡Œä¼˜åŒ–ï¼Œè¿›è€Œå¯ä»¥å¾—åˆ°å…¶ä»–çš„æ ‘è¡¨æŸ¥æ‰¾ç®—æ³•ï¼Œå¦‚å¹³è¡¡æ ‘ã€çº¢é»‘æ ‘ç­‰é«˜æ•ˆç®—æ³•ã€‚</p>

<h5>5.2 å¹³è¡¡æŸ¥æ‰¾æ ‘ä¹‹2-3æŸ¥æ‰¾æ ‘ï¼ˆ2-3 Treeï¼‰</h5>

<p>2-3æŸ¥æ‰¾æ ‘å®šä¹‰ï¼š</p>

<pre><code>å’ŒäºŒå‰æ ‘ä¸ä¸€æ ·ï¼Œ2-3æ ‘è¿è¡Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜1ä¸ªæˆ–è€…ä¸¤ä¸ªçš„å€¼ã€‚å¯¹äºæ™®é€šçš„2èŠ‚ç‚¹(2-node)ï¼Œä»–ä¿å­˜1ä¸ªkeyå’Œå·¦å³ä¸¤ä¸ªè‡ªå·±ç‚¹ã€‚å¯¹åº”3èŠ‚ç‚¹(3-node)ï¼Œä¿å­˜ä¸¤ä¸ªKeyï¼Œ2-3æŸ¥æ‰¾æ ‘çš„å®šä¹‰å¦‚ä¸‹ï¼š
</code></pre>

<ul>
<li><p>1ï¼‰è¦ä¹ˆä¸ºç©ºï¼Œè¦ä¹ˆï¼š</p></li>
<li><p>2ï¼‰å¯¹äº2èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¿å­˜ä¸€ä¸ªkeyåŠå¯¹åº”valueï¼Œä»¥åŠä¸¤ä¸ªæŒ‡å‘å·¦å³èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œå·¦èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å€¼éƒ½æ¯”keyè¦å°ï¼Œå³èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å€¼æ¯”keyè¦å¤§ã€‚</p></li>
<li><p>3ï¼‰å¯¹äº3èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¿å­˜ä¸¤ä¸ªkeyåŠå¯¹åº”valueï¼Œä»¥åŠä¸‰ä¸ªæŒ‡å‘å·¦ä¸­å³çš„èŠ‚ç‚¹ã€‚å·¦èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å€¼å‡æ¯”ä¸¤ä¸ªkeyä¸­çš„æœ€å°çš„keyè¿˜è¦å°ï¼›ä¸­é—´èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œä¸­é—´èŠ‚ç‚¹çš„keyå€¼åœ¨ä¸¤ä¸ªè·ŸèŠ‚ç‚¹keyå€¼ä¹‹é—´ï¼›å³èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„æ‰€æœ‰keyå€¼æ¯”ä¸¤ä¸ªkeyä¸­çš„æœ€å¤§çš„keyè¿˜è¦å¤§ã€‚</p></li>
</ul>


<p>2-3æŸ¥æ‰¾æ ‘çš„æ€§è´¨ï¼š</p>

<ul>
<li><p>1ï¼‰å¦‚æœä¸­åºéå†2-3æŸ¥æ‰¾æ ‘ï¼Œå°±å¯ä»¥å¾—åˆ°æ’å¥½åºçš„åºåˆ—ï¼›</p></li>
<li><p>2ï¼‰åœ¨ä¸€ä¸ªå®Œå…¨å¹³è¡¡çš„2-3æŸ¥æ‰¾æ ‘ä¸­ï¼Œæ ¹èŠ‚ç‚¹åˆ°æ¯ä¸€ä¸ªä¸ºç©ºèŠ‚ç‚¹çš„è·ç¦»éƒ½ç›¸åŒã€‚ï¼ˆè¿™ä¹Ÿæ˜¯å¹³è¡¡æ ‘ä¸­â€œå¹³è¡¡â€ä¸€è¯çš„æ¦‚å¿µï¼Œæ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„æœ€é•¿è·ç¦»å¯¹åº”äºæŸ¥æ‰¾ç®—æ³•çš„æœ€åæƒ…å†µï¼Œè€Œå¹³è¡¡æ ‘ä¸­æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·ç¦»éƒ½ä¸€æ ·ï¼Œæœ€åæƒ…å†µä¹Ÿå…·æœ‰å¯¹æ•°å¤æ‚åº¦ã€‚ï¼‰</p></li>
</ul>


<p>å¤æ‚åº¦åˆ†æï¼š</p>

<p>2-3æ ‘çš„æŸ¥æ‰¾æ•ˆç‡ä¸æ ‘çš„é«˜åº¦æ˜¯æ¯æ¯ç›¸å…³çš„ã€‚</p>

<pre><code>åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯2-nodeèŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¸ºlgN

åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯3-nodeèŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¸ºlog3Nçº¦ç­‰äº0.631lgN
</code></pre>

<p>è·ç¦»æ¥è¯´ï¼Œå¯¹äº1ç™¾ä¸‡ä¸ªèŠ‚ç‚¹çš„2-3æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸º12-20ä¹‹é—´ï¼Œå¯¹äº10äº¿ä¸ªèŠ‚ç‚¹çš„2-3æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸º18-30ä¹‹é—´ã€‚</p>

<p>å¯¹äºæ’å…¥æ¥è¯´ï¼Œåªéœ€è¦å¸¸æ•°æ¬¡æ“ä½œå³å¯å®Œæˆï¼Œå› ä¸ºä»–åªéœ€è¦ä¿®æ”¹ä¸è¯¥èŠ‚ç‚¹å…³è”çš„èŠ‚ç‚¹å³å¯ï¼Œä¸éœ€è¦æ£€æŸ¥å…¶ä»–èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ•ˆç‡å’ŒæŸ¥æ‰¾ç±»ä¼¼ã€‚ä¸‹é¢æ˜¯2-3æŸ¥æ‰¾æ ‘çš„æ•ˆç‡ï¼š</p>

<h5>5.3 å¹³è¡¡æŸ¥æ‰¾æ ‘ä¹‹çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰</h5>

<p>2-3æŸ¥æ‰¾æ ‘èƒ½ä¿è¯åœ¨æ’å…¥å…ƒç´ ä¹‹åèƒ½ä¿æŒæ ‘çš„å¹³è¡¡çŠ¶æ€ï¼Œæœ€åæƒ…å†µä¸‹å³æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æ˜¯2-nodeï¼Œæ ‘çš„é«˜åº¦ä¸ºlgnï¼Œä»è€Œä¿è¯äº†æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½†æ˜¯2-3æ ‘å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œäºæ˜¯å°±æœ‰äº†ä¸€ç§ç®€å•å®ç°2-3æ ‘çš„æ•°æ®ç»“æ„ï¼Œå³çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰ã€‚</p>

<p>åŸºæœ¬æ€æƒ³ï¼šçº¢é»‘æ ‘çš„æ€æƒ³å°±æ˜¯å¯¹2-3æŸ¥æ‰¾æ ‘è¿›è¡Œç¼–ç ï¼Œå°¤å…¶æ˜¯å¯¹2-3æŸ¥æ‰¾æ ‘ä¸­çš„3-nodesèŠ‚ç‚¹æ·»åŠ é¢å¤–çš„ä¿¡æ¯ã€‚çº¢é»‘æ ‘ä¸­å°†èŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥åˆ†ä¸ºä¸¤ç§ä¸åŒç±»å‹ï¼Œçº¢è‰²é“¾æ¥ï¼Œä»–ç”¨æ¥é“¾æ¥ä¸¤ä¸ª2-nodesèŠ‚ç‚¹æ¥è¡¨ç¤ºä¸€ä¸ª3-nodesèŠ‚ç‚¹ã€‚é»‘è‰²é“¾æ¥ç”¨æ¥é“¾æ¥æ™®é€šçš„2-3èŠ‚ç‚¹ã€‚ç‰¹åˆ«çš„ï¼Œä½¿ç”¨çº¢è‰²é“¾æ¥çš„ä¸¤ä¸ª2-nodesæ¥è¡¨ç¤ºä¸€ä¸ª3-nodesèŠ‚ç‚¹ï¼Œå¹¶ä¸”å‘å·¦å€¾æ–œï¼Œå³ä¸€ä¸ª2-nodeæ˜¯å¦ä¸€ä¸ª2-nodeçš„å·¦å­èŠ‚ç‚¹ã€‚è¿™ç§åšæ³•çš„å¥½å¤„æ˜¯æŸ¥æ‰¾çš„æ—¶å€™ä¸ç”¨åšä»»ä½•ä¿®æ”¹ï¼Œå’Œæ™®é€šçš„äºŒå‰æŸ¥æ‰¾æ ‘ç›¸åŒã€‚</p>

<p>çº¢é»‘æ ‘çš„å®šä¹‰ï¼šçº¢é»‘æ ‘æ˜¯ä¸€ç§å…·æœ‰çº¢è‰²å’Œé»‘è‰²é“¾æ¥çš„å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼ŒåŒæ—¶æ»¡è¶³ï¼š</p>

<pre><code>çº¢è‰²èŠ‚ç‚¹å‘å·¦å€¾æ–œ

ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯èƒ½æœ‰ä¸¤ä¸ªçº¢è‰²é“¾æ¥

æ•´ä¸ªæ ‘å®Œå…¨é»‘è‰²å¹³è¡¡ï¼Œå³ä»æ ¹èŠ‚ç‚¹åˆ°æ‰€ä»¥å¶å­ç»“ç‚¹çš„è·¯å¾„ä¸Šï¼Œé»‘è‰²é“¾æ¥çš„ä¸ªæ•°éƒ½ç›¸åŒã€‚
</code></pre>

<p>ä¸‹å›¾å¯ä»¥çœ‹åˆ°çº¢é»‘æ ‘å…¶å®æ˜¯2-3æ ‘çš„å¦å¤–ä¸€ç§è¡¨ç°å½¢å¼ï¼šå¦‚æœæˆ‘ä»¬å°†çº¢è‰²çš„è¿çº¿æ°´å¹³ç»˜åˆ¶ï¼Œé‚£ä¹ˆä»–é“¾æ¥çš„ä¸¤ä¸ª2-nodeèŠ‚ç‚¹å°±æ˜¯2-3æ ‘ä¸­çš„ä¸€ä¸ª3-nodeèŠ‚ç‚¹äº†ã€‚</p>

<p>çº¢é»‘æ ‘çš„æ€§è´¨ï¼š</p>

<pre><code>æ•´ä¸ªæ ‘å®Œå…¨é»‘è‰²å¹³è¡¡ï¼Œå³ä»æ ¹èŠ‚ç‚¹åˆ°æ‰€ä»¥å¶å­ç»“ç‚¹çš„è·¯å¾„ä¸Šï¼Œé»‘è‰²é“¾æ¥çš„ä¸ªæ•°éƒ½ç›¸åŒï¼ˆ2-3æ ‘çš„ç¬¬2ï¼‰æ€§è´¨ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·ç¦»éƒ½ç›¸ç­‰ï¼‰ã€‚
</code></pre>

<p>å¤æ‚åº¦åˆ†æï¼š</p>

<pre><code>æœ€åçš„æƒ…å†µå°±æ˜¯ï¼Œçº¢é»‘æ ‘ä¸­é™¤äº†æœ€å·¦ä¾§è·¯å¾„å…¨éƒ¨æ˜¯ç”±3-nodeèŠ‚ç‚¹ç»„æˆï¼Œå³çº¢é»‘ç›¸é—´çš„è·¯å¾„é•¿åº¦æ˜¯å…¨é»‘è·¯å¾„é•¿åº¦çš„2å€ã€‚
</code></pre>

<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„çº¢é»‘æ ‘ï¼Œä»ä¸­å¯ä»¥çœ‹åˆ°æœ€é•¿çš„è·¯å¾„(çº¢é»‘ç›¸é—´çš„è·¯å¾„)æ˜¯æœ€çŸ­è·¯å¾„çš„2å€ï¼š</p>

<pre><code>ã€€ã€€çº¢é»‘æ ‘çš„å¹³å‡é«˜åº¦å¤§çº¦ä¸ºlognã€‚
</code></pre>

<p>ä¸‹å›¾æ˜¯çº¢é»‘æ ‘åœ¨å„ç§æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¯ä»¥çœ‹å‡ºçº¢é»‘æ ‘æ˜¯2-3æŸ¥æ‰¾æ ‘çš„ä¸€ç§å®ç°ï¼Œå®ƒèƒ½ä¿è¯æœ€åæƒ…å†µä¸‹ä»ç„¶å…·æœ‰å¯¹æ•°çš„æ—¶é—´å¤æ‚åº¦ã€‚</p>

<p>çº¢é»‘æ ‘è¿™ç§æ•°æ®ç»“æ„åº”ç”¨ååˆ†å¹¿æ³›ï¼Œåœ¨å¤šç§ç¼–ç¨‹è¯­è¨€ä¸­è¢«ç”¨ä½œç¬¦å·è¡¨çš„å®ç°ï¼Œå¦‚ï¼š</p>

<pre><code>Javaä¸­çš„java.util.TreeMap,java.util.TreeSetï¼›

C++ STLä¸­çš„ï¼šmap,multimap,multisetï¼›

.NETä¸­çš„ï¼šSortedDictionary,SortedSet ç­‰ã€‚
</code></pre>

<h5>5.4 Bæ ‘å’ŒB+æ ‘ï¼ˆB Tree/B+ Treeï¼‰</h5>

<p>å¹³è¡¡æŸ¥æ‰¾æ ‘ä¸­çš„2-3æ ‘ä»¥åŠå…¶å®ç°çº¢é»‘æ ‘ã€‚2-3æ ‘ç§ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰2ä¸ªkeyï¼Œè€Œçº¢é»‘æ ‘åˆ™ä½¿ç”¨æŸ“è‰²çš„æ–¹å¼æ¥æ ‡è¯†è¿™ä¸¤ä¸ªkeyã€‚</p>

<blockquote><p>ç»´åŸºç™¾ç§‘å¯¹Bæ ‘çš„å®šä¹‰ä¸ºâ€œåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒBæ ‘ï¼ˆB-treeï¼‰æ˜¯ä¸€ç§æ ‘çŠ¶æ•°æ®ç»“æ„ï¼Œå®ƒèƒ½å¤Ÿå­˜å‚¨æ•°æ®ã€å¯¹å…¶è¿›è¡Œæ’åºå¹¶å…è®¸ä»¥O(log n)çš„æ—¶é—´å¤æ‚åº¦è¿è¡Œè¿›è¡ŒæŸ¥æ‰¾ã€é¡ºåºè¯»å–ã€æ’å…¥å’Œåˆ é™¤çš„æ•°æ®ç»“æ„ã€‚Bæ ‘ï¼Œæ¦‚æ‹¬æ¥è¯´æ˜¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å¤šäº2ä¸ªå­èŠ‚ç‚¹çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚ä¸è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼ŒBæ ‘ä¸ºç³»ç»Ÿæœ€ä¼˜åŒ–å¤§å—æ•°æ®çš„è¯»å’Œå†™æ“ä½œã€‚B-treeç®—æ³•å‡å°‘å®šä½è®°å½•æ—¶æ‰€ç»å†çš„ä¸­é—´è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«å­˜å–é€Ÿåº¦ã€‚æ™®éè¿ç”¨åœ¨æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿã€‚</p></blockquote>

<h6>Bæ ‘å®šä¹‰ï¼š</h6>

<pre><code>Bæ ‘å¯ä»¥çœ‹ä½œæ˜¯å¯¹2-3æŸ¥æ‰¾æ ‘çš„ä¸€ç§æ‰©å±•ï¼Œå³ä»–å…è®¸æ¯ä¸ªèŠ‚ç‚¹æœ‰M-1ä¸ªå­èŠ‚ç‚¹ã€‚

æ ¹èŠ‚ç‚¹è‡³å°‘æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹

æ¯ä¸ªèŠ‚ç‚¹æœ‰M-1ä¸ªkeyï¼Œå¹¶ä¸”ä»¥å‡åºæ’åˆ—

ä½äºM-1å’ŒM keyçš„å­èŠ‚ç‚¹çš„å€¼ä½äºM-1 å’ŒM keyå¯¹åº”çš„Valueä¹‹é—´

å…¶å®ƒèŠ‚ç‚¹è‡³å°‘æœ‰M/2ä¸ªå­èŠ‚ç‚¹
</code></pre>

<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªM=4 é˜¶çš„Bæ ‘:</p>

<p>å¯ä»¥çœ‹åˆ°Bæ ‘æ˜¯2-3æ ‘çš„ä¸€ç§æ‰©å±•ï¼Œä»–å…è®¸ä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šäº2ä¸ªçš„å…ƒç´ ã€‚Bæ ‘çš„æ’å…¥åŠå¹³è¡¡åŒ–æ“ä½œå’Œ2-3æ ‘å¾ˆç›¸ä¼¼ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚</p>

<h6>B+æ ‘å®šä¹‰ï¼š</h6>

<p>B+æ ‘æ˜¯å¯¹Bæ ‘çš„ä¸€ç§å˜å½¢æ ‘ï¼Œå®ƒä¸Bæ ‘çš„å·®å¼‚åœ¨äºï¼š</p>

<pre><code>æœ‰kä¸ªå­ç»“ç‚¹çš„ç»“ç‚¹å¿…ç„¶æœ‰kä¸ªå…³é”®ç ï¼›

éå¶ç»“ç‚¹ä»…å…·æœ‰ç´¢å¼•ä½œç”¨ï¼Œè·Ÿè®°å½•æœ‰å…³çš„ä¿¡æ¯å‡å­˜æ”¾åœ¨å¶ç»“ç‚¹ä¸­ã€‚

æ ‘çš„æ‰€æœ‰å¶ç»“ç‚¹æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œå¯ä»¥æŒ‰ç…§å…³é”®ç æ’åºçš„æ¬¡åºéå†å…¨éƒ¨è®°å½•ã€‚
</code></pre>

<p>å¦‚ä¸‹å›¾ï¼Œæ˜¯ä¸€ä¸ªB+æ ‘:</p>

<pre><code>Bå’ŒB+æ ‘çš„åŒºåˆ«åœ¨äºï¼ŒB+æ ‘çš„éå¶å­ç»“ç‚¹åªåŒ…å«å¯¼èˆªä¿¡æ¯ï¼Œä¸åŒ…å«å®é™…çš„å€¼ï¼Œæ‰€æœ‰çš„å¶å­ç»“ç‚¹å’Œç›¸è¿çš„èŠ‚ç‚¹ä½¿ç”¨é“¾è¡¨ç›¸è¿ï¼Œä¾¿äºåŒºé—´æŸ¥æ‰¾å’Œéå†ã€‚
</code></pre>

<p>B+ æ ‘çš„ä¼˜ç‚¹åœ¨äºï¼š</p>

<pre><code>ç”±äºB+æ ‘åœ¨å†…éƒ¨èŠ‚ç‚¹ä¸Šä¸å¥½å«æ•°æ®ä¿¡æ¯ï¼Œå› æ­¤åœ¨å†…å­˜é¡µä¸­èƒ½å¤Ÿå­˜æ”¾æ›´å¤šçš„keyã€‚ æ•°æ®å­˜æ”¾çš„æ›´åŠ ç´§å¯†ï¼Œå…·æœ‰æ›´å¥½çš„ç©ºé—´å±€éƒ¨æ€§ã€‚å› æ­¤è®¿é—®å¶å­å‡ ç‚¹ä¸Šå…³è”çš„æ•°æ®ä¹Ÿå…·æœ‰æ›´å¥½çš„ç¼“å­˜å‘½ä¸­ç‡ã€‚

B+æ ‘çš„å¶å­ç»“ç‚¹éƒ½æ˜¯ç›¸é“¾çš„ï¼Œå› æ­¤å¯¹æ•´æ£µæ ‘çš„ä¾¿åˆ©åªéœ€è¦ä¸€æ¬¡çº¿æ€§éå†å¶å­ç»“ç‚¹å³å¯ã€‚è€Œä¸”ç”±äºæ•°æ®é¡ºåºæ’åˆ—å¹¶ä¸”ç›¸è¿ï¼Œæ‰€ä»¥ä¾¿äºåŒºé—´æŸ¥æ‰¾å’Œæœç´¢ã€‚è€ŒBæ ‘åˆ™éœ€è¦è¿›è¡Œæ¯ä¸€å±‚çš„é€’å½’éå†ã€‚ç›¸é‚»çš„å…ƒç´ å¯èƒ½åœ¨å†…å­˜ä¸­ä¸ç›¸é‚»ï¼Œæ‰€ä»¥ç¼“å­˜å‘½ä¸­æ€§æ²¡æœ‰B+æ ‘å¥½ã€‚
</code></pre>

<p>ä½†æ˜¯Bæ ‘ä¹Ÿæœ‰ä¼˜ç‚¹ï¼Œå…¶ä¼˜ç‚¹åœ¨äºï¼Œç”±äºBæ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«keyå’Œvalueï¼Œå› æ­¤ç»å¸¸è®¿é—®çš„å…ƒç´ å¯èƒ½ç¦»æ ¹èŠ‚ç‚¹æ›´è¿‘ï¼Œå› æ­¤è®¿é—®ä¹Ÿæ›´è¿…é€Ÿã€‚</p>

<p>B/B+æ ‘å¸¸ç”¨äºæ–‡ä»¶ç³»ç»Ÿå’Œæ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå®ƒé€šè¿‡å¯¹æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸ªæ•°çš„æ‰©å±•ï¼Œä½¿å¾—å¯¹è¿ç»­çš„æ•°æ®èƒ½å¤Ÿè¿›è¡Œè¾ƒå¿«çš„å®šä½å’Œè®¿é—®ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘æŸ¥æ‰¾æ—¶é—´ï¼Œæé«˜å­˜å‚¨çš„ç©ºé—´å±€éƒ¨æ€§ä»è€Œå‡å°‘IOæ“ä½œã€‚å®ƒå¹¿æ³›ç”¨äºæ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ä¸­ï¼Œå¦‚ï¼š</p>

<pre><code>Windowsï¼šHPFSæ–‡ä»¶ç³»ç»Ÿï¼›

Macï¼šHFSï¼ŒHFS+æ–‡ä»¶ç³»ç»Ÿï¼›

Linuxï¼šResiserFSï¼ŒXFSï¼ŒExt3FSï¼ŒJFSæ–‡ä»¶ç³»ç»Ÿï¼›

æ•°æ®åº“ï¼šORACLEï¼ŒMYSQLï¼ŒSQLSERVERç­‰ä¸­ã€‚
</code></pre>

<p>æœ‰å…³B/B+æ ‘åœ¨æ•°æ®åº“ç´¢å¼•ä¸­çš„åº”ç”¨ï¼Œè¯·çœ‹å¼ æ´‹çš„MySQLç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†è¿™ç¯‡æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« å¯¹MySQLä¸­çš„å¦‚ä½•ä½¿ç”¨B+æ ‘è¿›è¡Œç´¢å¼•æœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œæ¨èé˜…è¯»ã€‚</p>

<p>æ ‘è¡¨æŸ¥æ‰¾æ€»ç»“ï¼š</p>

<pre><code>äºŒå‰æŸ¥æ‰¾æ ‘å¹³å‡æŸ¥æ‰¾æ€§èƒ½ä¸é”™ï¼Œä¸ºO(logn)ï¼Œä½†æ˜¯æœ€åæƒ…å†µä¼šé€€åŒ–ä¸ºO(n)ã€‚åœ¨äºŒå‰æŸ¥æ‰¾æ ‘çš„åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¹³è¡¡æŸ¥æ‰¾æ ‘ã€‚å¹³è¡¡æŸ¥æ‰¾æ ‘ä¸­çš„2-3æŸ¥æ‰¾æ ‘ï¼Œè¿™ç§æ•°æ®ç»“æ„åœ¨æ’å…¥ä¹‹åèƒ½å¤Ÿè¿›è¡Œè‡ªå¹³è¡¡æ“ä½œï¼Œä»è€Œä¿è¯äº†æ ‘çš„é«˜åº¦åœ¨ä¸€å®šçš„èŒƒå›´å†…è¿›è€Œèƒ½å¤Ÿä¿è¯æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½†æ˜¯2-3æŸ¥æ‰¾æ ‘å®ç°èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œçº¢é»‘æ ‘æ˜¯2-3æ ‘çš„ä¸€ç§ç®€å•é«˜æ•ˆçš„å®ç°ï¼Œä»–å·§å¦™åœ°ä½¿ç”¨é¢œè‰²æ ‡è®°æ¥æ›¿ä»£2-3æ ‘ä¸­æ¯”è¾ƒéš¾å¤„ç†çš„3-nodeèŠ‚ç‚¹é—®é¢˜ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§æ¯”è¾ƒé«˜æ•ˆçš„å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œåº”ç”¨éå¸¸å¹¿æ³›ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€çš„å†…éƒ¨å®ç°éƒ½æˆ–å¤šæˆ–å°‘çš„é‡‡ç”¨äº†çº¢é»‘æ ‘ã€‚
</code></pre>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œ2-3æŸ¥æ‰¾æ ‘çš„å¦ä¸€ä¸ªæ‰©å±•â€”â€”B/B+å¹³è¡¡æ ‘ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿå’Œæ•°æ®åº“ç³»ç»Ÿä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚</p>

<h3>6ã€åˆ†å—æŸ¥æ‰¾</h3>

<p>åˆ†å—æŸ¥æ‰¾åˆç§°ç´¢å¼•é¡ºåºæŸ¥æ‰¾ï¼Œå®ƒæ˜¯é¡ºåºæŸ¥æ‰¾çš„ä¸€ç§æ”¹è¿›æ–¹æ³•ã€‚</p>

<p>ç®—æ³•æ€æƒ³ï¼š</p>

<pre><code>å°†nä¸ªæ•°æ®å…ƒç´ "æŒ‰å—æœ‰åº"åˆ’åˆ†ä¸ºmå—ï¼ˆm â‰¤ nï¼‰ã€‚æ¯ä¸€å—ä¸­çš„ç»“ç‚¹ä¸å¿…æœ‰åºï¼Œä½†å—ä¸å—ä¹‹é—´å¿…é¡»"æŒ‰å—æœ‰åº"ï¼›å³ç¬¬1å—ä¸­ä»»ä¸€å…ƒç´ çš„å…³é”®å­—éƒ½å¿…é¡»å°äºç¬¬2å—ä¸­ä»»ä¸€å…ƒç´ çš„å…³é”®å­—ï¼›è€Œç¬¬2å—ä¸­ä»»ä¸€å…ƒç´ åˆéƒ½å¿…é¡»å°äºç¬¬3å—ä¸­çš„ä»»ä¸€å…ƒç´ ï¼Œâ€¦â€¦
</code></pre>

<p>ç®—æ³•æµç¨‹ï¼š</p>

<ol>
<li>step1 å…ˆé€‰å–å„å—ä¸­çš„æœ€å¤§å…³é”®å­—æ„æˆä¸€ä¸ªç´¢å¼•è¡¨ï¼›</li>
<li>step2 æŸ¥æ‰¾åˆ†ä¸¤ä¸ªéƒ¨åˆ†ï¼šå…ˆå¯¹ç´¢å¼•è¡¨è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾æˆ–é¡ºåºæŸ¥æ‰¾ï¼Œä»¥ç¡®å®šå¾…æŸ¥è®°å½•</li>
</ol>


<p>åœ¨å“ªä¸€å—ä¸­ï¼›ç„¶åï¼Œåœ¨å·²ç¡®å®šçš„å—ä¸­ç”¨é¡ºåºæ³•è¿›è¡ŒæŸ¥æ‰¾ã€‚</p>

<h3>7ã€å“ˆå¸ŒæŸ¥æ‰¾</h3>

<p>ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼ˆHashï¼‰ï¼Ÿ</p>

<pre><code>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä¸‹æ ‡èŒƒå›´æ¯”è¾ƒå¤§çš„æ•°ç»„æ¥å­˜å‚¨å…ƒç´ ã€‚å¯ä»¥è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼Œ ä¹Ÿå«åšæ•£åˆ—å‡½æ•°ï¼‰ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ çš„å…³é”®å­—éƒ½ä¸ä¸€ä¸ªå‡½æ•°å€¼ï¼ˆå³æ•°ç»„ä¸‹æ ‡ï¼‰ç›¸å¯¹åº”ï¼Œäºæ˜¯ç”¨è¿™ä¸ªæ•°ç»„å•å…ƒæ¥å­˜å‚¨è¿™ä¸ªå…ƒç´ ï¼›ä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼ŒæŒ‰ç…§å…³é”®å­—ä¸ºæ¯ä¸€ä¸ªå…ƒç´ "åˆ†ç±»"ï¼Œç„¶åå°†è¿™ä¸ªå…ƒç´ å­˜å‚¨åœ¨ç›¸åº”"ç±»"æ‰€å¯¹åº”çš„åœ°æ–¹ã€‚ä½†æ˜¯ï¼Œä¸èƒ½å¤Ÿä¿è¯æ¯ä¸ªå…ƒç´ çš„å…³é”®å­—ä¸å‡½æ•°å€¼æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå› æ­¤ææœ‰å¯èƒ½å‡ºç°å¯¹äºä¸åŒçš„å…ƒç´ ï¼Œå´è®¡ç®—å‡ºäº†ç›¸åŒçš„å‡½æ•°å€¼ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†"å†²çª"ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æŠŠä¸åŒçš„å…ƒç´ åˆ†åœ¨äº†ç›¸åŒçš„"ç±»"ä¹‹ä¸­ã€‚åé¢æˆ‘ä»¬å°†çœ‹åˆ°ä¸€ç§è§£å†³"å†²çª"çš„ç®€ä¾¿åšæ³•ã€‚
</code></pre>

<p>æ€»çš„æ¥è¯´ï¼Œ"ç›´æ¥å®šå€"ä¸"è§£å†³å†²çª"æ˜¯å“ˆå¸Œè¡¨çš„ä¸¤å¤§ç‰¹ç‚¹ã€‚</p>

<p>ä»€ä¹ˆæ˜¯å“ˆå¸Œå‡½æ•°ï¼Ÿå“ˆå¸Œå‡½æ•°çš„è§„åˆ™æ˜¯ï¼š</p>

<pre><code>é€šè¿‡æŸç§è½¬æ¢å…³ç³»ï¼Œä½¿å…³é”®å­—é€‚åº¦çš„åˆ†æ•£åˆ°æŒ‡å®šå¤§å°çš„çš„é¡ºåºç»“æ„ä¸­ï¼Œè¶Šåˆ†æ•£ï¼Œåˆ™ä»¥åæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦è¶Šå°ï¼Œç©ºé—´å¤æ‚åº¦è¶Šé«˜ã€‚
</code></pre>

<p>ç®—æ³•æ€æƒ³ï¼š</p>

<pre><code>å“ˆå¸Œçš„æ€è·¯å¾ˆç®€å•ï¼Œå¦‚æœæ‰€æœ‰çš„é”®éƒ½æ˜¯æ•´æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ— åºæ•°ç»„æ¥å®ç°ï¼šå°†é”®ä½œä¸ºç´¢å¼•ï¼Œå€¼å³ä¸ºå…¶å¯¹åº”çš„å€¼ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€Ÿè®¿é—®ä»»æ„é”®çš„å€¼ã€‚è¿™æ˜¯å¯¹äºç®€å•çš„é”®çš„æƒ…å†µï¼Œæˆ‘ä»¬å°†å…¶æ‰©å±•åˆ°å¯ä»¥å¤„ç†æ›´åŠ å¤æ‚çš„ç±»å‹çš„é”®ã€‚
</code></pre>

<p>ç®—æ³•æµç¨‹ï¼š</p>

<ul>
<li><p>1ï¼‰ç”¨ç»™å®šçš„å“ˆå¸Œå‡½æ•°æ„é€ å“ˆå¸Œè¡¨ï¼›</p></li>
<li><p>2ï¼‰æ ¹æ®é€‰æ‹©çš„å†²çªå¤„ç†æ–¹æ³•è§£å†³åœ°å€å†²çªï¼›</p>

<ul>
<li>å¸¸è§çš„è§£å†³å†²çªçš„æ–¹æ³•ï¼šæ‹‰é“¾æ³•å’Œçº¿æ€§æ¢æµ‹æ³•ã€‚</li>
</ul>
</li>
<li><p>3ï¼‰åœ¨å“ˆå¸Œè¡¨çš„åŸºç¡€ä¸Šæ‰§è¡Œå“ˆå¸ŒæŸ¥æ‰¾ã€‚</p></li>
</ul>


<p>å“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªåœ¨æ—¶é—´å’Œç©ºé—´ä¸Šåšå‡ºæƒè¡¡çš„ç»å…¸ä¾‹å­ã€‚å¦‚æœæ²¡æœ‰å†…å­˜é™åˆ¶ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†é”®ä½œä¸ºæ•°ç»„çš„ç´¢å¼•ã€‚é‚£ä¹ˆæ‰€æœ‰çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›å¦‚æœæ²¡æœ‰æ—¶é—´é™åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ— åºæ•°ç»„å¹¶è¿›è¡Œé¡ºåºæŸ¥æ‰¾ï¼Œè¿™æ ·åªéœ€è¦å¾ˆå°‘çš„å†…å­˜ã€‚å“ˆå¸Œè¡¨ä½¿ç”¨äº†é€‚åº¦çš„æ—¶é—´å’Œç©ºé—´æ¥åœ¨è¿™ä¸¤ä¸ªæç«¯ä¹‹é—´æ‰¾åˆ°äº†å¹³è¡¡ã€‚åªéœ€è¦è°ƒæ•´å“ˆå¸Œå‡½æ•°ç®—æ³•å³å¯åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šåšå‡ºå–èˆã€‚</p>

<p>å¤æ‚åº¦åˆ†æï¼š</p>

<pre><code>å•çº¯è®ºæŸ¥æ‰¾å¤æ‚åº¦ï¼šå¯¹äºæ— å†²çªçš„Hashè¡¨è€Œè¨€ï¼ŒæŸ¥æ‰¾å¤æ‚åº¦ä¸ºO(1)ï¼ˆæ³¨æ„ï¼Œåœ¨æŸ¥æ‰¾ä¹‹å‰æˆ‘ä»¬éœ€è¦æ„å»ºç›¸åº”çš„Hashè¡¨ï¼‰ã€‚
</code></pre>

<p>ä½¿ç”¨Hashï¼Œæˆ‘ä»¬ä»˜å‡ºäº†ä»€ä¹ˆï¼Ÿ</p>

<pre><code>æˆ‘ä»¬åœ¨å®é™…ç¼–ç¨‹ä¸­å­˜å‚¨ä¸€ä¸ªå¤§è§„æ¨¡çš„æ•°æ®ï¼Œæœ€å…ˆæƒ³åˆ°çš„å­˜å‚¨ç»“æ„å¯èƒ½å°±æ˜¯mapï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„KV pairï¼Œç»å¸¸ä½¿ç”¨Pythonçš„åšå‹å¯èƒ½æ›´æœ‰è¿™ç§ä½“ä¼šã€‚ä½¿ç”¨mapçš„å¥½å¤„å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨åç»­å¤„ç†æ•°æ®å¤„ç†æ—¶ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„keyå¿«é€Ÿçš„æŸ¥æ‰¾åˆ°å¯¹åº”çš„valueå€¼ã€‚mapçš„æœ¬è´¨å°±æ˜¯Hashè¡¨ï¼Œé‚£æˆ‘ä»¬åœ¨è·å–äº†è¶…é«˜æŸ¥æ‰¾æ•ˆç‡çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä»˜å‡ºäº†ä»€ä¹ˆï¼Ÿ
</code></pre>

<blockquote><p>Hashæ˜¯ä¸€ç§å…¸å‹ä»¥ç©ºé—´æ¢æ—¶é—´çš„ç®—æ³•ï¼Œæ¯”å¦‚åŸæ¥ä¸€ä¸ªé•¿åº¦ä¸º100çš„æ•°ç»„ï¼Œå¯¹å…¶æŸ¥æ‰¾ï¼Œåªéœ€è¦éå†ä¸”åŒ¹é…ç›¸åº”è®°å½•å³å¯ï¼Œä»ç©ºé—´å¤æ‚åº¦ä¸Šæ¥çœ‹ï¼Œå‡å¦‚æ•°ç»„å­˜å‚¨çš„æ˜¯byteç±»å‹æ•°æ®ï¼Œé‚£ä¹ˆè¯¥æ•°ç»„å ç”¨100byteç©ºé—´ã€‚ç°åœ¨æˆ‘ä»¬é‡‡ç”¨Hashç®—æ³•ï¼Œæˆ‘ä»¬å‰é¢è¯´çš„Hashå¿…é¡»æœ‰ä¸€ä¸ªè§„åˆ™ï¼Œçº¦æŸé”®ä¸å­˜å‚¨ä½ç½®çš„å…³ç³»ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªå›ºå®šé•¿åº¦çš„hashè¡¨ï¼Œæ­¤æ—¶ï¼Œä»ç„¶æ˜¯100byteçš„æ•°ç»„ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦çš„100byteç”¨æ¥è®°å½•é”®ä¸ä½ç½®çš„å…³ç³»ï¼Œé‚£ä¹ˆæ€»çš„ç©ºé—´ä¸º200byte,è€Œä¸”ç”¨äºè®°å½•è§„åˆ™çš„è¡¨å¤§å°ä¼šæ ¹æ®è§„åˆ™ï¼Œå¤§å°å¯èƒ½æ˜¯ä¸å®šçš„ã€‚</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-äº”å¤§å¸¸ç”¨ç®—æ³•]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/18/xiu-xing-pian-wu-da-chang-yong-suan-fa/"/>
    <updated>2016-08-18T12:31:31+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/18/xiu-xing-pian-wu-da-chang-yong-suan-fa</id>
    <content type="html"><![CDATA[<h3>åˆ†æ²»ç®—æ³•</h3>

<h6>æ¦‚å¿µï¼šåˆ†è€Œæ²»ä¹‹</h6>

<pre><code>æŠŠä¸€ä¸ªå¤æ‚çš„é—®é¢˜åˆ†æˆä¸¤ä¸ªæˆ–æ›´å¤šçš„ç›¸åŒæˆ–ç›¸ä¼¼çš„å­é—®é¢˜ï¼Œå†æŠŠå­é—®é¢˜åˆ†æˆæ›´å°çš„å­é—®é¢˜â€¦â€¦ç›´åˆ°æœ€åå­é—®é¢˜å¯ä»¥ç®€å•çš„ç›´æ¥æ±‚è§£ï¼ŒåŸé—®é¢˜çš„è§£å³å­é—®é¢˜çš„è§£çš„åˆå¹¶

æ’åºç®—æ³•(å¿«é€Ÿæ’åºï¼Œå½’å¹¶æ’åº)ï¼Œå‚…ç«‹å¶å˜æ¢(å¿«é€Ÿå‚…ç«‹å¶å˜æ¢)â€¦â€¦
</code></pre>

<p>æ€æƒ³ï¼šå°†ä¸€ä¸ªéš¾ä»¥ç›´æ¥è§£å†³çš„å¤§é—®é¢˜ï¼Œåˆ†å‰²æˆä¸€äº›è§„æ¨¡è¾ƒå°çš„ç›¸åŒé—®é¢˜ï¼Œä»¥ä¾¿å„ä¸ªå‡»ç ´ï¼Œåˆ†è€Œæ²»ä¹‹</p>

<pre><code>åˆ†æ²»ç­–ç•¥æ˜¯ï¼šå¯¹äºä¸€ä¸ªè§„æ¨¡ä¸ºnçš„é—®é¢˜ï¼Œè‹¥è¯¥é—®é¢˜å¯ä»¥å®¹æ˜“åœ°è§£å†³ï¼ˆæ¯”å¦‚è¯´è§„æ¨¡nè¾ƒå°ï¼‰åˆ™ç›´æ¥è§£å†³ï¼Œå¦åˆ™å°†å…¶åˆ†è§£ä¸ºkä¸ªè§„æ¨¡è¾ƒå°çš„å­é—®é¢˜ï¼Œè¿™äº›å­é—®é¢˜äº’ç›¸ç‹¬ç«‹ä¸”ä¸åŸé—®é¢˜å½¢å¼ç›¸åŒï¼Œé€’å½’åœ°è§£è¿™äº›å­é—®é¢˜ï¼Œç„¶åå°†å„å­é—®é¢˜çš„è§£åˆå¹¶å¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚è¿™ç§ç®—æ³•è®¾è®¡ç­–ç•¥å«åšåˆ†æ²»æ³•

è¿™è‡ªç„¶å¯¼è‡´é€’å½’è¿‡ç¨‹çš„äº§ç”Ÿã€‚åˆ†æ²»ä¸é€’å½’åƒä¸€å¯¹å­ªç”Ÿå…„å¼Ÿ
</code></pre>

<!--more-->


<h6>ç‰¹å¾ï¼š</h6>

<p>åˆ†æ²»æ³•æ‰€èƒ½è§£å†³çš„é—®é¢˜ä¸€èˆ¬å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ï¼š</p>

<pre><code>1) è¯¥é—®é¢˜çš„è§„æ¨¡ç¼©å°åˆ°ä¸€å®šçš„ç¨‹åº¦å°±å¯ä»¥å®¹æ˜“åœ°è§£å†³

2) è¯¥é—®é¢˜å¯ä»¥åˆ†è§£ä¸ºè‹¥å¹²ä¸ªè§„æ¨¡è¾ƒå°çš„ç›¸åŒé—®é¢˜ï¼Œå³è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ã€‚

3) åˆ©ç”¨è¯¥é—®é¢˜åˆ†è§£å‡ºçš„å­é—®é¢˜çš„è§£å¯ä»¥åˆå¹¶ä¸ºè¯¥é—®é¢˜çš„è§£ï¼›

4) è¯¥é—®é¢˜æ‰€åˆ†è§£å‡ºçš„å„ä¸ªå­é—®é¢˜æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³å­é—®é¢˜ä¹‹é—´ä¸åŒ…å«å…¬å…±çš„å­å­é—®é¢˜ã€‚
</code></pre>

<p>ç»¼ä¸Šï¼š</p>

<ul>
<li><p>ç¬¬ä¸€æ¡ç‰¹å¾æ˜¯ç»å¤§å¤šæ•°é—®é¢˜éƒ½å¯ä»¥æ»¡è¶³çš„ï¼Œå› ä¸ºé—®é¢˜çš„è®¡ç®—å¤æ‚æ€§ä¸€èˆ¬æ˜¯éšç€é—®é¢˜è§„æ¨¡çš„å¢åŠ è€Œå¢åŠ ï¼›</p></li>
<li><p>ç¬¬äºŒæ¡ç‰¹å¾æ˜¯åº”ç”¨åˆ†æ²»æ³•çš„å‰æå®ƒä¹Ÿæ˜¯å¤§å¤šæ•°é—®é¢˜å¯ä»¥æ»¡è¶³çš„ï¼Œæ­¤ç‰¹å¾åæ˜ äº†é€’å½’æ€æƒ³çš„åº”ç”¨ï¼›ã€</p></li>
<li><p>ç¬¬ä¸‰æ¡ç‰¹å¾æ˜¯å…³é”®ï¼Œèƒ½å¦åˆ©ç”¨åˆ†æ²»æ³•å®Œå…¨å–å†³äºé—®é¢˜æ˜¯å¦å…·æœ‰ç¬¬ä¸‰æ¡ç‰¹å¾ï¼Œå¦‚æœå…·å¤‡äº†ç¬¬ä¸€æ¡å’Œç¬¬äºŒæ¡ç‰¹å¾ï¼Œè€Œä¸å…·å¤‡ç¬¬ä¸‰æ¡ç‰¹å¾ï¼Œåˆ™å¯ä»¥è€ƒè™‘ç”¨è´ªå¿ƒæ³•æˆ–åŠ¨æ€è§„åˆ’æ³•ã€‚</p></li>
<li><p>ç¬¬å››æ¡ç‰¹å¾æ¶‰åŠåˆ°åˆ†æ²»æ³•çš„æ•ˆç‡ï¼Œå¦‚æœå„å­é—®é¢˜æ˜¯ä¸ç‹¬ç«‹çš„åˆ™åˆ†æ²»æ³•è¦åšè®¸å¤šä¸å¿…è¦çš„å·¥ä½œï¼Œé‡å¤åœ°è§£å…¬å…±çš„å­é—®é¢˜ï¼Œæ­¤æ—¶è™½ç„¶å¯ç”¨åˆ†æ²»æ³•ï¼Œä½†ä¸€èˆ¬ç”¨åŠ¨æ€è§„åˆ’æ³•è¾ƒå¥½ã€‚</p></li>
</ul>


<h6>æ€§èƒ½ï¼š</h6>

<p> ä¸€ä¸ªåˆ†æ²»æ³•å°†è§„æ¨¡ä¸ºnçš„é—®é¢˜åˆ†æˆkä¸ªè§„æ¨¡ä¸ºnï¼mçš„å­é—®é¢˜å»è§£ã€‚è®¾åˆ†è§£é˜€å€¼n0=1ï¼Œä¸”adhocè§£è§„æ¨¡ä¸º1çš„é—®é¢˜è€—è´¹1ä¸ªå•ä½æ—¶é—´ã€‚å†è®¾å°†åŸé—®é¢˜åˆ†è§£ä¸ºkä¸ªå­é—®é¢˜ä»¥åŠç”¨mergeå°†kä¸ªå­é—®é¢˜çš„è§£åˆå¹¶ä¸ºåŸé—®é¢˜çš„è§£éœ€ç”¨f(n)ä¸ªå•ä½æ—¶é—´ã€‚ç”¨T(n)è¡¨ç¤ºè¯¥åˆ†æ²»æ³•è§£è§„æ¨¡ä¸º|P|=nçš„é—®é¢˜æ‰€éœ€çš„è®¡ç®—æ—¶é—´ï¼Œåˆ™æœ‰ï¼š</p>

<p> Tï¼ˆnï¼‰= k T(n/m)+f(n)</p>

<pre><code>é€šè¿‡è¿­ä»£æ³•æ±‚å¾—æ–¹ç¨‹çš„è§£ï¼š
é€’å½’æ–¹ç¨‹åŠå…¶è§£åªç»™å‡ºnç­‰äºmçš„æ–¹å¹‚æ—¶T(n)çš„å€¼ï¼Œä½†æ˜¯å¦‚æœè®¤ä¸ºT(n)è¶³å¤Ÿå¹³æ»‘ï¼Œé‚£ä¹ˆç”±nç­‰äºmçš„æ–¹å¹‚æ—¶T(n)çš„å€¼å¯ä»¥ä¼°è®¡T(n)çš„å¢é•¿é€Ÿåº¦ã€‚é€šå¸¸å‡å®šT(n)æ˜¯å•è°ƒä¸Šå‡çš„ï¼Œä»è€Œå½“                  miâ‰¤n&lt;mi+1æ—¶ï¼ŒT(mi)â‰¤T(n)&lt;T(mi+1)ã€‚ 
</code></pre>

<h6>ç»å…¸é—®é¢˜</h6>

<ul>
<li>ï¼ˆ1ï¼‰äºŒåˆ†æœç´¢</li>
<li>ï¼ˆ2ï¼‰å¤§æ•´æ•°ä¹˜æ³•</li>
<li>ï¼ˆ3ï¼‰StrassençŸ©é˜µä¹˜æ³•</li>
<li>ï¼ˆ4ï¼‰æ£‹ç›˜è¦†ç›–</li>
<li>ï¼ˆ5ï¼‰åˆå¹¶æ’åº</li>
<li>ï¼ˆ6ï¼‰å¿«é€Ÿæ’åº</li>
<li>ï¼ˆ7ï¼‰çº¿æ€§æ—¶é—´é€‰æ‹©</li>
<li>ï¼ˆ8ï¼‰æœ€æ¥è¿‘ç‚¹å¯¹é—®é¢˜</li>
<li>ï¼ˆ9ï¼‰å¾ªç¯èµ›æ—¥ç¨‹è¡¨</li>
<li>ï¼ˆ10ï¼‰æ±‰è¯ºå¡”</li>
</ul>


<h6>æ€ç»´è¿‡ç¨‹</h6>

<pre><code>å®é™…ä¸Šå°±æ˜¯ç±»ä¼¼äºæ•°å­¦å½’çº³æ³•ï¼Œæ‰¾åˆ°è§£å†³æœ¬é—®é¢˜çš„æ±‚è§£æ–¹ç¨‹å…¬å¼ï¼Œç„¶åæ ¹æ®æ–¹ç¨‹å…¬å¼è®¾è®¡é€’å½’ç¨‹åºã€‚
</code></pre>

<ol>
<li>ä¸€å®šæ˜¯å…ˆæ‰¾åˆ°æœ€å°é—®é¢˜è§„æ¨¡æ—¶çš„æ±‚è§£æ–¹æ³•</li>
<li>ç„¶åè€ƒè™‘éšç€é—®é¢˜è§„æ¨¡å¢å¤§æ—¶çš„æ±‚è§£æ–¹æ³•</li>
<li>æ‰¾åˆ°æ±‚è§£çš„é€’å½’å‡½æ•°å¼åï¼ˆå„ç§è§„æ¨¡æˆ–å› å­ï¼‰ï¼Œè®¾è®¡é€’å½’ç¨‹åºå³å¯ã€‚</li>
</ol>


<h3>åŠ¨æ€è§„åˆ’</h3>

<h6>æ¦‚å¿µ</h6>

<pre><code>æ¯æ¬¡å†³ç­–ä¾èµ–äºå½“å‰çŠ¶æ€ï¼Œåˆéšå³å¼•èµ·çŠ¶æ€çš„è½¬ç§»ã€‚ä¸€ä¸ªå†³ç­–åºåˆ—å°±æ˜¯åœ¨å˜åŒ–çš„çŠ¶æ€ä¸­äº§ç”Ÿå‡ºæ¥çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ç§å¤šé˜¶æ®µæœ€ä¼˜åŒ–å†³ç­–è§£å†³é—®é¢˜çš„è¿‡ç¨‹å°±ç§°ä¸ºåŠ¨æ€è§„åˆ’
</code></pre>

<h6>æ€æƒ³</h6>

<pre><code>åŸºæœ¬æ€æƒ³ä¸åˆ†æ²»æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†å¾…æ±‚è§£çš„é—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ï¼ˆé˜¶æ®µï¼‰ï¼ŒæŒ‰é¡ºåºæ±‚è§£å­é˜¶æ®µï¼Œå‰ä¸€å­é—®é¢˜çš„è§£ï¼Œä¸ºåä¸€å­é—®é¢˜çš„æ±‚è§£æä¾›äº†æœ‰ç”¨çš„ä¿¡æ¯ã€‚åœ¨æ±‚è§£ä»»ä¸€å­é—®é¢˜æ—¶ï¼Œåˆ—å‡ºå„ç§å¯èƒ½çš„å±€éƒ¨è§£ï¼Œé€šè¿‡å†³ç­–ä¿ç•™é‚£äº›æœ‰å¯èƒ½è¾¾åˆ°æœ€ä¼˜çš„å±€éƒ¨è§£ï¼Œä¸¢å¼ƒå…¶ä»–å±€éƒ¨è§£ã€‚ä¾æ¬¡è§£å†³å„å­é—®é¢˜ï¼Œæœ€åä¸€ä¸ªå­é—®é¢˜å°±æ˜¯åˆå§‹é—®é¢˜çš„è§£
</code></pre>

<h6>ç‰¹ç‚¹ï¼š</h6>

<pre><code>å å­é—®é¢˜è¿™ä¸ªç‰¹ç‚¹ï¼Œä¸ºå‡å°‘é‡å¤è®¡ç®—ï¼Œå¯¹æ¯ä¸€ä¸ªå­é—®é¢˜åªè§£ä¸€æ¬¡ï¼Œå°†å…¶ä¸åŒé˜¶æ®µçš„ä¸åŒçŠ¶æ€ä¿å­˜åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­
</code></pre>

<h6>ä¸åˆ†æ²»æ³•æœ€å¤§çš„å·®åˆ«æ˜¯ï¼š</h6>

<pre><code>é€‚åˆäºç”¨åŠ¨æ€è§„åˆ’æ³•æ±‚è§£çš„é—®é¢˜ï¼Œç»åˆ†è§£åå¾—åˆ°çš„å­é—®é¢˜å¾€å¾€ä¸æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼ˆå³ä¸‹ä¸€ä¸ªå­é˜¶æ®µçš„æ±‚è§£æ˜¯å»ºç«‹åœ¨ä¸Šä¸€ä¸ªå­é˜¶æ®µçš„è§£çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„æ±‚è§£ï¼‰ã€‚
</code></pre>

<h6>ä½¿ç”¨</h6>

<ul>
<li><p>(1) æœ€ä¼˜åŒ–åŸç†ï¼šå¦‚æœé—®é¢˜çš„æœ€ä¼˜è§£æ‰€åŒ…å«çš„å­é—®é¢˜çš„è§£ä¹Ÿæ˜¯æœ€ä¼˜çš„ï¼Œå°±ç§°è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„ï¼Œå³æ»¡è¶³æœ€ä¼˜åŒ–åŸç†ã€‚</p></li>
<li><p>(2) æ— åæ•ˆæ€§ï¼šå³æŸé˜¶æ®µçŠ¶æ€ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸å—è¿™ä¸ªçŠ¶æ€ä»¥åå†³ç­–çš„å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸçŠ¶æ€ä»¥åçš„è¿‡ç¨‹ä¸ä¼šå½±å“ä»¥å‰çš„çŠ¶æ€ï¼Œåªä¸å½“å‰çŠ¶æ€æœ‰å…³ã€‚</p></li>
<li><p>ï¼ˆ3ï¼‰æœ‰é‡å å­é—®é¢˜ï¼šå³å­é—®é¢˜ä¹‹é—´æ˜¯ä¸ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªå­é—®é¢˜åœ¨ä¸‹ä¸€é˜¶æ®µå†³ç­–ä¸­å¯èƒ½è¢«å¤šæ¬¡ä½¿ç”¨åˆ°ã€‚ï¼ˆè¯¥æ€§è´¨å¹¶ä¸æ˜¯åŠ¨æ€è§„åˆ’é€‚ç”¨çš„å¿…è¦æ¡ä»¶ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰è¿™æ¡æ€§è´¨ï¼ŒåŠ¨æ€è§„åˆ’ç®—æ³•åŒå…¶ä»–ç®—æ³•ç›¸æ¯”å°±ä¸å…·å¤‡ä¼˜åŠ¿ï¼‰
å®é™…åº”ç”¨</p></li>
</ul>


<h6>ä¸‰è¦ç´ ï¼š</h6>

<p>ä½¿ç”¨åŠ¨æ€è§„åˆ’æ±‚è§£é—®é¢˜ï¼Œæœ€é‡è¦çš„å°±æ˜¯ç¡®å®šåŠ¨æ€è§„åˆ’ä¸‰è¦ç´ ï¼š</p>

<pre><code>ï¼ˆ1ï¼‰é—®é¢˜çš„é˜¶æ®µ 

ï¼ˆ2ï¼‰æ¯ä¸ªé˜¶æ®µçš„çŠ¶æ€

ï¼ˆ3ï¼‰ä»å‰ä¸€ä¸ªé˜¶æ®µè½¬åŒ–åˆ°åä¸€ä¸ªé˜¶æ®µä¹‹é—´çš„é€’æ¨å…³ç³»ã€‚
</code></pre>

<h6>æ€»ç»“</h6>

<p>é€’æ¨å…³ç³»å¿…é¡»æ˜¯ä»æ¬¡å°çš„é—®é¢˜å¼€å§‹åˆ°è¾ƒå¤§çš„é—®é¢˜ä¹‹é—´çš„è½¬åŒ–ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼ŒåŠ¨æ€è§„åˆ’å¾€å¾€å¯ä»¥ç”¨é€’å½’ç¨‹åºæ¥å®ç°ï¼Œä¸è¿‡å› ä¸ºé€’æ¨å¯ä»¥å……åˆ†åˆ©ç”¨å‰é¢ä¿å­˜çš„å­é—®é¢˜çš„è§£æ¥å‡å°‘é‡å¤è®¡ç®—ï¼Œæ‰€ä»¥å¯¹äºå¤§è§„æ¨¡é—®é¢˜æ¥è¯´ï¼Œæœ‰é€’å½’ä¸å¯æ¯”æ‹Ÿçš„ä¼˜åŠ¿ï¼Œè¿™ä¹Ÿæ˜¯åŠ¨æ€è§„åˆ’ç®—æ³•çš„æ ¸å¿ƒä¹‹å¤„ã€‚</p>

<pre><code>ç¡®å®šäº†åŠ¨æ€è§„åˆ’çš„è¿™ä¸‰è¦ç´ ï¼Œæ•´ä¸ªæ±‚è§£è¿‡ç¨‹å°±å¯ä»¥ç”¨ä¸€ä¸ªæœ€ä¼˜å†³ç­–è¡¨æ¥æè¿°ï¼Œæœ€ä¼˜å†³ç­–è¡¨æ˜¯ä¸€ä¸ªäºŒç»´è¡¨ï¼Œå…¶ä¸­è¡Œè¡¨ç¤ºå†³ç­–çš„é˜¶æ®µï¼Œåˆ—è¡¨ç¤ºé—®é¢˜çŠ¶æ€ï¼Œè¡¨æ ¼éœ€è¦å¡«å†™çš„æ•°æ®ä¸€èˆ¬å¯¹åº”æ­¤é—®é¢˜çš„åœ¨æŸä¸ªé˜¶æ®µæŸä¸ªçŠ¶æ€ä¸‹çš„æœ€ä¼˜å€¼ï¼ˆå¦‚æœ€çŸ­è·¯å¾„ï¼Œæœ€é•¿å…¬å…±å­åºåˆ—ï¼Œæœ€å¤§ä»·å€¼ç­‰ï¼‰ï¼Œå¡«è¡¨çš„è¿‡ç¨‹å°±æ˜¯æ ¹æ®é€’æ¨å…³ç³»ï¼Œä»1è¡Œ1åˆ—å¼€å§‹ï¼Œä»¥è¡Œæˆ–è€…åˆ—ä¼˜å…ˆçš„é¡ºåºï¼Œä¾æ¬¡å¡«å†™è¡¨æ ¼ï¼Œæœ€åæ ¹æ®æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®é€šè¿‡ç®€å•çš„å–èˆæˆ–è€…è¿ç®—æ±‚å¾—é—®é¢˜çš„æœ€ä¼˜è§£ã€‚

      f(n,m)=max{f(n-1,m), f(n-1,m-w[n])+P(n,m)}
</code></pre>

<h3>è´ªå¿ƒç®—æ³•</h3>

<h6>æ¦‚å¿µ</h6>

<pre><code>åœ¨å¯¹é—®é¢˜æ±‚è§£æ—¶ï¼Œæ€»æ˜¯åšå‡ºåœ¨å½“å‰çœ‹æ¥æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä»æ•´ä½“æœ€ä¼˜ä¸ŠåŠ ä»¥è€ƒè™‘ï¼Œä»–æ‰€åšå‡ºçš„ä»…æ˜¯åœ¨æŸç§æ„ä¹‰ä¸Šçš„å±€éƒ¨æœ€ä¼˜è§£ã€‚
</code></pre>

<blockquote><p>è´ªå¿ƒç®—æ³•ä¸æ˜¯å¯¹æ‰€æœ‰é—®é¢˜éƒ½èƒ½å¾—åˆ°æ•´ä½“æœ€ä¼˜è§£ï¼Œé€‰æ‹©çš„è´ªå¿ƒç­–ç•¥å¿…é¡»å…·å¤‡æ— åæ•ˆæ€§ï¼Œå³æŸä¸ªçŠ¶æ€ä»¥åçš„è¿‡ç¨‹ä¸ä¼šå½±å“ä»¥å‰çš„çŠ¶æ€ï¼Œåªä¸å½“å‰çŠ¶æ€æœ‰å…³ã€‚</p></blockquote>

<h6>æ€æƒ³</h6>

<ol>
<li>å»ºç«‹æ•°å­¦æ¨¡å‹æ¥æè¿°é—®é¢˜ã€‚</li>
<li>æŠŠæ±‚è§£çš„é—®é¢˜åˆ†æˆè‹¥å¹²ä¸ªå­é—®é¢˜ã€‚</li>
<li>å¯¹æ¯ä¸€å­é—®é¢˜æ±‚è§£ï¼Œå¾—åˆ°å­é—®é¢˜çš„å±€éƒ¨æœ€ä¼˜è§£ã€‚</li>
<li>æŠŠå­é—®é¢˜çš„è§£å±€éƒ¨æœ€ä¼˜è§£åˆæˆåŸæ¥è§£é—®é¢˜çš„ä¸€ä¸ªè§£ã€‚</li>
</ol>


<h6>ä½¿ç”¨</h6>

<p>å±€éƒ¨æœ€ä¼˜ç­–ç•¥èƒ½å¯¼è‡´äº§ç”Ÿå…¨å±€æœ€ä¼˜è§£ã€‚</p>

<pre><code>å®é™…ä¸Šï¼Œè´ªå¿ƒç®—æ³•é€‚ç”¨çš„æƒ…å†µå¾ˆå°‘ã€‚ä¸€èˆ¬ï¼Œå¯¹ä¸€ä¸ªé—®é¢˜åˆ†ææ˜¯å¦é€‚ç”¨äºè´ªå¿ƒç®—æ³•ï¼Œå¯ä»¥å…ˆé€‰æ‹©è¯¥é—®é¢˜ä¸‹çš„å‡ ä¸ªå®é™…æ•°æ®è¿›è¡Œåˆ†æï¼Œå°±å¯åšå‡ºåˆ¤æ–­ã€‚
</code></pre>

<p>å®é™…åº”ç”¨</p>

<p>å®ç°æ¡†æ¶
    ä»é—®é¢˜çš„æŸä¸€åˆå§‹è§£å‡ºå‘ï¼›
    while ï¼ˆèƒ½æœç»™å®šæ€»ç›®æ ‡å‰è¿›ä¸€æ­¥ï¼‰
    {
          åˆ©ç”¨å¯è¡Œçš„å†³ç­–ï¼Œæ±‚å‡ºå¯è¡Œè§£çš„ä¸€ä¸ªè§£å…ƒç´ ï¼›
    }
    ç”±æ‰€æœ‰è§£å…ƒç´ ç»„åˆæˆé—®é¢˜çš„ä¸€ä¸ªå¯è¡Œè§£ï¼›</p>

<pre><code>    å› ä¸ºç”¨è´ªå¿ƒç®—æ³•åªèƒ½é€šè¿‡è§£å±€éƒ¨æœ€ä¼˜è§£çš„ç­–ç•¥æ¥è¾¾åˆ°å…¨å±€æœ€ä¼˜è§£ï¼Œå› æ­¤ï¼Œä¸€å®šè¦æ³¨æ„åˆ¤æ–­é—®é¢˜æ˜¯å¦é€‚åˆé‡‡ç”¨è´ªå¿ƒç®—æ³•ç­–ç•¥ï¼Œæ‰¾åˆ°çš„è§£æ˜¯å¦ä¸€å®šæ˜¯é—®é¢˜çš„æœ€ä¼˜è§£ã€‚
</code></pre>

<h6>æ€»ç»“</h6>

<blockquote><p>è´ªå¿ƒç®—æ³•å¹¶ä¸æ˜¯å®Œå…¨ä¸å¯ä»¥ä½¿ç”¨ï¼Œè´ªå¿ƒç­–ç•¥ä¸€æ—¦ç»è¿‡è¯æ˜æˆç«‹åï¼Œå®ƒå°±æ˜¯ä¸€ç§é«˜æ•ˆçš„ç®—æ³•ã€‚</p></blockquote>

<ul>
<li>éœ€è¦è¯æ˜: è´ªå¿ƒç®—æ³•çš„è¯æ˜å›´ç»•ç€ï¼šæ•´ä¸ªé—®é¢˜çš„æœ€ä¼˜è§£ä¸€å®šç”±åœ¨è´ªå¿ƒç­–ç•¥ä¸­å­˜åœ¨çš„å­é—®é¢˜çš„æœ€ä¼˜è§£å¾—æ¥çš„ã€‚</li>
</ul>


<h3>å›æº¯ç®—æ³•</h3>

<h6>æ¦‚å¿µ</h6>

<pre><code>ä¸€ä¸ªç±»ä¼¼æšä¸¾çš„æœç´¢å°è¯•è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯åœ¨æœç´¢å°è¯•è¿‡ç¨‹ä¸­å¯»æ‰¾é—®é¢˜çš„è§£ï¼Œå½“å‘ç°å·²ä¸æ»¡è¶³æ±‚è§£æ¡ä»¶æ—¶ï¼Œå°±â€œå›æº¯â€è¿”å›ï¼Œå°è¯•åˆ«çš„è·¯å¾„

å›æº¯æ³•æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›ä¸€æ­¥é‡æ–°é€‰æ‹©ï¼Œè¿™ç§èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯æ¡ä»¶çš„æŸä¸ªçŠ¶æ€çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚
</code></pre>

<p>ç‰¹ç‚¹ï¼šæœ‰â€œé€šç”¨è§£é¢˜æ–¹æ³•â€çš„ç¾ç§°ã€‚</p>

<h6>æ€æƒ³</h6>

<p>åœ¨åŒ…å«é—®é¢˜çš„æ‰€æœ‰è§£çš„è§£ç©ºé—´æ ‘ä¸­ï¼ŒæŒ‰ç…§æ·±åº¦ä¼˜å…ˆæœç´¢çš„ç­–ç•¥ï¼Œä»æ ¹ç»“ç‚¹å‡ºå‘æ·±åº¦æ¢ç´¢è§£ç©ºé—´æ ‘ã€‚å½“æ¢ç´¢åˆ°æŸä¸€ç»“ç‚¹æ—¶ï¼Œè¦å…ˆåˆ¤æ–­è¯¥ç»“ç‚¹æ˜¯å¦åŒ…å«é—®é¢˜çš„è§£ï¼Œå¦‚æœåŒ…å«ï¼Œå°±ä»è¯¥ç»“ç‚¹å‡ºå‘ç»§ç»­æ¢ç´¢ä¸‹å»ï¼Œå¦‚æœè¯¥ç»“ç‚¹ä¸åŒ…å«é—®é¢˜çš„è§£ï¼Œåˆ™é€å±‚å‘å…¶ç¥–å…ˆç»“ç‚¹å›æº¯ã€‚ï¼ˆå…¶å®å›æº¯æ³•å°±æ˜¯å¯¹éšå¼å›¾çš„æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼‰ã€‚</p>

<pre><code>   è‹¥ç”¨å›æº¯æ³•æ±‚é—®é¢˜çš„æ‰€æœ‰è§£æ—¶ï¼Œè¦å›æº¯åˆ°æ ¹ï¼Œä¸”æ ¹ç»“ç‚¹çš„æ‰€æœ‰å¯è¡Œçš„å­æ ‘éƒ½è¦å·²è¢«æœç´¢éæ‰ç»“æŸã€‚

   è€Œè‹¥ä½¿ç”¨å›æº¯æ³•æ±‚ä»»ä¸€ä¸ªè§£æ—¶ï¼Œåªè¦æœç´¢åˆ°é—®é¢˜çš„ä¸€ä¸ªè§£å°±å¯ä»¥ç»“æŸã€‚
</code></pre>

<h6>ä½¿ç”¨</h6>

<pre><code>ï¼ˆ1ï¼‰é’ˆå¯¹æ‰€ç»™é—®é¢˜ï¼Œç¡®å®šé—®é¢˜çš„è§£ç©ºé—´ï¼šé¦–å…ˆåº”æ˜ç¡®å®šä¹‰é—®é¢˜çš„è§£ç©ºé—´ï¼Œé—®é¢˜çš„è§£ç©ºé—´åº”è‡³å°‘åŒ…å«é—®é¢˜çš„ä¸€ä¸ªï¼ˆæœ€ä¼˜ï¼‰è§£ã€‚

ï¼ˆ2ï¼‰ç¡®å®šç»“ç‚¹çš„æ‰©å±•æœç´¢è§„åˆ™

ï¼ˆ3ï¼‰ä»¥æ·±åº¦ä¼˜å…ˆæ–¹å¼æœç´¢è§£ç©ºé—´ï¼Œå¹¶åœ¨æœç´¢è¿‡ç¨‹ä¸­ç”¨å‰ªæå‡½æ•°é¿å…æ— æ•ˆæœç´¢ã€‚å®é™…åº”ç”¨
</code></pre>

<h3>åˆ†æ”¯é™ç•Œæ³•</h3>

<h6>æ¦‚å¿µ</h6>

<pre><code> ç±»ä¼¼äºå›æº¯æ³•ï¼Œä¹Ÿæ˜¯ä¸€ç§åœ¨é—®é¢˜çš„è§£ç©ºé—´æ ‘Tä¸Šæœç´¢é—®é¢˜è§£çš„ç®—æ³•ã€‚ä½†åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ†æ”¯é™ç•Œæ³•ä¸å›æº¯æ³•çš„æ±‚è§£ç›®æ ‡ä¸åŒã€‚å›æº¯æ³•çš„æ±‚è§£ç›®æ ‡æ˜¯æ‰¾å‡ºTä¸­æ»¡è¶³çº¦æŸæ¡ä»¶çš„æ‰€æœ‰è§£ï¼Œè€Œåˆ†æ”¯é™ç•Œæ³•çš„æ±‚è§£ç›®æ ‡åˆ™æ˜¯æ‰¾å‡ºæ»¡è¶³çº¦æŸæ¡ä»¶çš„ä¸€ä¸ªè§£ï¼Œæˆ–æ˜¯åœ¨æ»¡è¶³çº¦æŸæ¡ä»¶çš„è§£ä¸­æ‰¾å‡ºä½¿æŸä¸€ç›®æ ‡å‡½æ•°å€¼è¾¾åˆ°æå¤§æˆ–æå°çš„è§£ï¼Œå³åœ¨æŸç§æ„ä¹‰ä¸‹çš„æœ€ä¼˜è§£ã€‚
</code></pre>

<p>å›æº¯æ³•å’Œåˆ†æ”¯é™ç•Œæ³•çš„ä¸€äº›åŒºåˆ«</p>

<pre><code>æœ‰ä¸€äº›é—®é¢˜å…¶å®æ— è®ºç”¨å›æº¯æ³•è¿˜æ˜¯åˆ†æ”¯é™ç•Œæ³•éƒ½å¯ä»¥å¾—åˆ°å¾ˆå¥½çš„è§£å†³ï¼Œä½†æ˜¯å¦å¤–ä¸€äº›åˆ™ä¸ç„¶ã€‚ä¹Ÿè®¸æˆ‘ä»¬éœ€è¦å…·ä½“ä¸€äº›çš„åˆ†æâ€”â€”åˆ°åº•ä½•æ—¶ä½¿ç”¨åˆ†æ”¯é™ç•Œè€Œä½•æ—¶ä½¿ç”¨å›æº¯å‘¢ï¼Ÿ
</code></pre>

<h6>æœç´¢ç®—æ³•</h6>

<pre><code>æ‰€è°“â€œåˆ†æ”¯â€å°±æ˜¯é‡‡ç”¨å¹¿åº¦ä¼˜å…ˆçš„ç­–ç•¥ï¼Œä¾æ¬¡æœç´¢E-ç»“ç‚¹çš„æ‰€æœ‰åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰ç›¸é‚»ç»“ç‚¹ï¼ŒæŠ›å¼ƒä¸æ»¡è¶³çº¦æŸæ¡ä»¶çš„ç»“ç‚¹ï¼Œå…¶ä½™ç»“ç‚¹åŠ å…¥æ´»ç»“ç‚¹è¡¨ã€‚ç„¶åä»è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªE-ç»“ç‚¹ï¼Œç»§ç»­æœç´¢ã€‚

 é€‰æ‹©ä¸‹ä¸€ä¸ªE-ç»“ç‚¹çš„æ–¹å¼ä¸åŒï¼Œåˆ™ä¼šæœ‰å‡ ç§ä¸åŒçš„åˆ†æ”¯æœç´¢æ–¹å¼ã€‚
</code></pre>

<p>   1ï¼‰FIFOæœç´¢</p>

<p>   2ï¼‰LIFOæœç´¢</p>

<p>   3ï¼‰ä¼˜å…ˆé˜Ÿåˆ—å¼æœç´¢</p>

<h6>å›æº¯æ³•å’Œåˆ†æ”¯é™ç•Œæ³•çš„åŒºåˆ«ï¼š</h6>

<ul>
<li><p>æ–¹æ³•å¯¹è§£ç©ºé—´æ ‘çš„æœç´¢æ–¹å¼       å­˜å‚¨ç»“ç‚¹çš„å¸¸ç”¨æ•°æ®ç»“æ„      ç»“ç‚¹å­˜å‚¨ç‰¹æ€§å¸¸ç”¨åº”ç”¨</p></li>
<li><p>å›æº¯æ³•æ·±åº¦ä¼˜å…ˆæœç´¢å †æ ˆæ´»ç»“ç‚¹çš„æ‰€æœ‰å¯è¡Œå­ç»“ç‚¹è¢«éå†åæ‰è¢«ä»æ ˆä¸­å¼¹å‡ºæ‰¾å‡ºæ»¡è¶³çº¦æŸæ¡ä»¶çš„æ‰€æœ‰è§£</p></li>
<li><p>åˆ†æ”¯é™ç•Œæ³•å¹¿åº¦ä¼˜å…ˆæˆ–æœ€å°æ¶ˆè€—ä¼˜å…ˆæœç´¢é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—æ¯ä¸ªç»“ç‚¹åªæœ‰ä¸€æ¬¡æˆä¸ºæ´»ç»“ç‚¹çš„æœºä¼šæ‰¾å‡ºæ»¡è¶³çº¦æŸæ¡ä»¶çš„ä¸€ä¸ªè§£æˆ–ç‰¹å®šæ„ä¹‰ä¸‹çš„æœ€ä¼˜è§£</p></li>
</ul>


<hr />

<p>æ€»ç»“</p>

<blockquote><p>å¤šç†è§£ï¼Œå¤šç†è§£ï¼Œå¤šç†è§£ã€‚ã€‚ã€‚ã€‚</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-å…«å¤§æ’åºç®—æ³•]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/16/xiu-xing-pian-chang-jian-pai-xu-suan-fa/"/>
    <updated>2016-08-16T12:31:14+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/16/xiu-xing-pian-chang-jian-pai-xu-suan-fa</id>
    <content type="html"><![CDATA[<p>å¸¸ç”¨æ’åºç®—æ³•</p>

<blockquote><p>è¿™é‡Œæˆ‘ä»¬å¤§æ¦‚æŒ‰ç…§é‡è¦æ€§çš„å…ˆåé¡ºåºä»‹ç»</p></blockquote>

<h2>å¿«é€Ÿæ’åº</h2>

<ul>
<li><p>å¿«é€Ÿæ’åºæ˜¯ä¸ç¨³å®šçš„ï¼Œå…¶æ—¶é—´å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯O ( nlgn )ã€‚</p></li>
<li><p>å¿«é€Ÿæ’åºé‡‡ç”¨çš„æ€æƒ³æ˜¯åˆ†æ²»æ€æƒ³ã€‚</p></li>
</ul>


<p>æ€è·¯:å¿«é€Ÿæ’åºæ˜¯æ‰¾å‡ºä¸€ä¸ªå…ƒç´ ï¼ˆç†è®ºä¸Šå¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªï¼‰ä½œä¸ºåŸºå‡†(pivot),ç„¶åå¯¹æ•°ç»„è¿›è¡Œåˆ†åŒºæ“ä½œ,ä½¿åŸºå‡†å·¦è¾¹å…ƒç´ çš„å€¼éƒ½ä¸å¤§äºåŸºå‡†å€¼,åŸºå‡†å³è¾¹çš„å…ƒç´ å€¼ éƒ½ä¸å°äºåŸºå‡†å€¼ï¼Œå¦‚æ­¤ä½œä¸ºåŸºå‡†çš„å…ƒç´ è°ƒæ•´åˆ°æ’åºåçš„æ­£ç¡®ä½ç½®ã€‚é€’å½’å¿«é€Ÿæ’åºï¼Œå°†å…¶ä»–n-1ä¸ªå…ƒç´ ä¹Ÿè°ƒæ•´åˆ°æ’åºåçš„æ­£ç¡®ä½ç½®ã€‚æœ€åæ¯ä¸ªå…ƒç´ éƒ½æ˜¯åœ¨æ’åºåçš„æ­£ ç¡®ä½ç½®ï¼Œæ’åºå®Œæˆã€‚æ‰€ä»¥å¿«é€Ÿæ’åºç®—æ³•çš„æ ¸å¿ƒç®—æ³•æ˜¯åˆ†åŒºæ“ä½œï¼Œå³å¦‚ä½•è°ƒæ•´åŸºå‡†çš„ä½ç½®ä»¥åŠè°ƒæ•´è¿”å›åŸºå‡†çš„æœ€ç»ˆä½ç½®ä»¥ä¾¿åˆ†æ²»é€’å½’ã€‚</p>

<!--more-->


<p>ä¼ªä»£ç </p>

<pre><code>void quickSort(int a[], int len, int left, int right) {
   // æ‰€æœ‰éƒ½æ’åºå®Œæ¯•äº†ï¼Œå°±é€€å‡ºé€’å½’
   if left &gt;= right {
     return;
   }

   // æ¯ä¸€è¶Ÿåˆ’åˆ†ï¼Œä½¿å·¦è¾¹çš„æ¯”åŸºå‡†å°ï¼Œå³è¾¹çš„æ¯”åŸºå‡†å¤§ï¼Œå¹¶è¿”å›æ–°çš„åŸºå‡†çš„ä½ç½®
   int baseIndex = partition(a, len, left, right);

   // é€’å½’æ’åºå·¦éƒ¨åˆ†
   quickSort(a, len, left, baseIndex - 1);
   // é€’å½’æ’åºå³éƒ¨åˆ†
   quickSort(a, len, baseIndex + 1, right)
}

int partition(int a[], int len, int left, int right) {
   // è®°å½•å“ªä¸ªæ˜¯åŸºå‡†æ•°
   int base = a[left];
   // è®°å½•å½“å‰åŸºå‡†æ•°çš„ä½ç½®
   int baseIndex = left;

   while left &lt; right {
     // å…ˆä»å³è¾¹å¾€å·¦è¾¹æ‰«æï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”baseè¿˜è¦å°çš„æ•°ï¼Œä½†æ˜¯ä¸èƒ½ä¸leftç›¸é‡
     while left &lt; right &amp;&amp; a[right] &gt;= base {
       right--;
     }

     // å†ä»å·¦è¾¹å¾€å³è¾¹æ‰«æï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”baseè¿˜è¦å¤§çš„æ•°ï¼Œä½†æ˜¯ä¸èƒ½ä¸rightç›¸é‡
     while left &lt; right &amp;&amp; a[left] &lt;= base {
       left++;
     }

     // å°†æ‰€æ‰«æåˆ°çš„ç¬¬ä¸€ä¸ªæ¯”åŸºå‡†æ•°å°å’Œç¬¬ä¸€ä¸ªæ¯”åŸºå‡†æ•°å¤§çš„æ•°äº¤æ¢
     swap(a, left, right);
   }

   // äº¤æ¢leftä¸baseIndexå¯¹åº”çš„å…ƒç´ ï¼Œå°†leftä½ç½®çš„å…ƒç´ ä½œä¸ºæ–°çš„åŸºå‡†æ•°
   swap(a, baseIndex, left);

   // è¿”å›æ–°çš„åŸºå‡†ä½ç½®
   return left;
}

void swap(int a[], int i, int j) {
   int temp = a[i];

   a[i] = a[j];
   a[j] = temp;
}
</code></pre>

<p>Cè¯­è¨€ç‰ˆ</p>

<pre><code>void quickSort(int a[], int len, int left, int right) {
  if (left &gt;= right) {
    return;
  }

  // ä¸€æ¬¡åˆ’åˆ†åï¼Œå¾—åˆ°åŸºå‡†æ•°æ®çš„ä½ç½®
 int baseIndex = partition(a, len, left, right);

  // å¿«æ’å·¦è¾¹éƒ¨åˆ†
  quickSort(a, len, left, baseIndex - 1);
  // å¿«æ’å³è¾¹éƒ¨åˆ†
  quickSort(a, len, baseIndex + 1, right);
}

int partition(int a[], int len, int left, int right) {
  // æ¯ä¸€æ¬¡çš„åˆ’åˆ†ï¼Œéƒ½è®©ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†
  int base = a[left];
  // è®°ä¸‹åˆšå¼€å§‹çš„åŸºå‡†çš„ä½ç½®ï¼Œ ä¾¿äºæœ€åç›¸é‡æ—¶äº¤æ¢
  int baseIndex = left;

  while (left &lt; right) {
    // æŸ¥æ‰¾å³éƒ¨åˆ†æ¯”baseè¿˜å°çš„å…ƒç´ çš„ä¸‹æ ‡
    while (left &lt; right &amp;&amp; a[right] &gt;= base) {
      right--;
    }

    // æŸ¥æ‰¾å·¦éƒ¨åˆ†æ¯”baseè¿˜å¤§çš„å…ƒç´ çš„ä¸‹æ ‡
    while (left &lt; right &amp;&amp; a[left] &lt;= base) {
      left++;
    }

    // å°†è¿™ä¸€è¶Ÿæ¯”åŸºå‡†å¤§å’Œæ¯”åŸºå‡†å°çš„æ‰€æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œäº’ç›¸äº¤æ¢
    swap(a, left, right);
  }

  // åœ¨leftä¸rightç›¸é‡æ—¶ï¼Œå°†åŸºå‡†æ•°ä¸ç›¸é‡ç‚¹äº¤æ¢
  // è¿™æ ·è¿™ä¸€æ¬¡åˆ’åˆ†ï¼Œå°±å¯ä»¥ä¿è¯å·¦è¾¹çš„æ¯”åŸºå‡†æ•°å°ï¼Œå³è¾¹çš„æ¯”åŸºå‡†æ•°å¤§
  swap(a, baseIndex, left);

  // åˆ’åˆ†å®Œæˆåï¼Œä»¥leftä½ç½®çš„å…ƒç´ ä½œä¸ºæ–°çš„åŸºå‡†ï¼Œåˆ†æˆå·¦å³åºåˆ—ï¼Œåˆ†åˆ«é€’å½’æ’åº
  return left;
}

void swap(int a[], int i, int j) {
  int temp = a[i];
  a[i] = a[j];
  a[j] = temp;
}
</code></pre>

<p>Swiftç‰ˆ</p>

<pre><code>func quickSort(inout a: [Int], left: Int, right: Int) {
  if left &gt;= right {
    return
  }

  let baseIndex = partition(&amp;a, left: left, right: right)

  quickSort(&amp;a, left: left, right: baseIndex - 1)
  quickSort(&amp;a, left: baseIndex + 1, right: right)
}

func partition(inout a: [Int], var left: Int, var right: Int) -&gt;Int {
  let base = a[left]
  let baseIndex = left

  while left &lt; right {
    while left &lt; right &amp;&amp; a[right] &gt;= base {
      right--
    }

    while left &lt; right &amp;&amp; a[left] &lt;= base {
      left++
    }

    swapInt(&amp;a, i: left, j: right)
  }

  swapInt(&amp;a, i: baseIndex, j: left)

  return left
}

func swapInt(inout a: [Int], i: Int, j: Int) {
  let temp = a[i]
  a[i] = a[j]
  a[j] = temp
}
</code></pre>

<hr />

<h2>å†’æ³¡æ’åº</h2>

<p>ç®—æ³•æ€è·¯ï¼šå†’æ³¡æ’åºçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯é€šè¿‡ä¸ç›¸é‚»å…ƒç´ çš„æ¯”è¾ƒå’Œäº¤æ¢ï¼ŒæŠŠå°çš„æ•°äº¤æ¢åˆ°æœ€å‰é¢ã€‚å› ä¸ºè¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºæ°´æ³¡å‘ä¸Šå‡ä¸€æ ·ï¼Œå› æ­¤è¢«å‘½åä¸ºå†’æ³¡æ’åºã€‚</p>

<blockquote><p>å†’æ³¡æ’åºéœ€è¦ä¸¤ä¸ªå¾ªç¯æ¥æ§åˆ¶éå†ï¼Œä¹Ÿå°±æ˜¯éœ€è¦n * nè¶Ÿæ‰èƒ½åˆ¤æ–­ã€äº¤æ¢å®Œæˆã€‚</p></blockquote>

<p>å†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO ( n2 )ã€‚</p>

<p>ä¼ªä»£ç </p>

<pre><code>void bubbleSort(int a[], int len) {
   for i = 0; i &lt; len - 1; ++i {
      for j = len - 1; j &gt; i; --j {
         if a[j] &lt; a[j - 1] {
            swap(a, j, j - 1);
         }
      }
   }
}

void swap(int a[], int i, int j) {
   int temp = a[i];
   a[i] = a[j];
   a[j] = temp;
}
</code></pre>

<p>Cè¯­è¨€ç‰ˆ</p>

<pre><code>void bubbleSortUsingC(int arr[], int len) {
  // ä»£è¡¨èµ°å¤šå°‘è¶Ÿï¼Œæœ€åä¸€è¶Ÿå°±ä¸ç”¨å†èµ°äº†
  for (int i = 0; i &lt; len - 1; ++i) {

    // ä»åå¾€å‰èµ°ï¼Œç›¸å½“äºæ³¡ä»æ°´åº•å†’å‡ºæ¥åˆ°æ°´é¢
    for (int j = len - 1; j &gt; i; --j) {

      // å¦‚æœåé¢çš„æ¯”å‰é¢ä¸€ä¸ªçš„å€¼è¿˜è¦å°ï¼Œåˆ™éœ€è¦äº¤æ¢
      if (arr[j] &lt; arr[j - 1]) {
        swap(arr, j, j - 1);
      }
    }
  }
}

void swap(int arr[], int i, int j) {
  int temp = arr[i];
  arr[i] = arr[j];
  arr[j] = temp;
}
</code></pre>

<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>

<pre><code>int a[5] = {5,3,8,6,4};

bubbleSortUsingC(a, sizeof(a) / sizeof(int));

for (int i = 0; i &lt; sizeof(a) / sizeof(int); ++i) {
    NSLog(@"%d", a[i]);
}

// æ‰“å°: 3, 4, 5, 6, 8 åˆæ­¥å¦‚æœŸæ•ˆæœ

ObjCç‰ˆ

- (void)bubbleSort:(int [])array len:(size_t)len {
  for (size_t i = 0; i &lt; len - 1; ++i) {
    for (size_t j = len - 1; j &gt; i; --j) {
      if (array[j] &lt; array[j - 1]) {
        // äº¤æ¢
        int temp = array[j];
        array[j] = array[j - 1];
        array[j - 1] = temp;
      }
    }
  }
}
</code></pre>

<p>æµ‹è¯•ä½¿ç”¨ï¼š</p>

<p>int a[5] = {5,3,8,6,4};
[self bubbleSort:a len:sizeof(a) / sizeof(int)];
for (int i = 0; i &lt; sizeof(a) / sizeof(int); ++i) {
    NSLog(@&ldquo;%d&rdquo;, a[i]);
}</p>

<p>Swiftç‰ˆ</p>

<pre><code>func bubbleSort(var arr: [Int]) -&gt;[Int] {
  // èµ°å¤šå°‘è¶Ÿ
  for var i = 0; i &lt; arr.count - 1; ++i {

    // ä»åå¾€å‰
    for var j = arr.count - 1; j &gt; i; --j {

      // åè€… &lt; å‰è€… ï¼Ÿ äº¤æ¢ ï¼š ä¸äº¤æ¢
      if arr[j] &lt; arr[j - 1] {
        let temp = arr[j]

        arr[j] = arr[j - 1]
        arr[j - 1] = temp
      }
    }
  }

  return arr
}
</code></pre>

<p>æµ‹è¯•ä½¿ç”¨ï¼š</p>

<pre><code>// ç”±äºswiftä¸­æ•°ç»„ä¹Ÿæ˜¯ç»“æ„ä½“ï¼Œæ˜¯å€¼ç±»å‹ï¼Œå› æ­¤éœ€è¦æ¥æ”¶è¿”å›å€¼æ‰èƒ½å¾—åˆ°æ’åºåçš„æ•°ç»„
var arr = [5, 3, 8, 6, 4]
arr = bubbleSort(arr)
print(arr)

å°è¯•ç»™Modelæ’åº

- (void)bubbleSort:(NSMutableArray *)array {
  for (NSUInteger i = 0; i &lt; array.count - 1; ++i) {

    for (NSUInteger j = array.count - 1; j &gt; i; --j) {
      HYBTestModel *modelj = [array objectAtIndex:j];
      HYBTestModel *modelj_1 = [array objectAtIndex:j - 1];

      // å‰è€… &lt; åè€… ï¼Ÿ äº¤æ¢ ï¼š ä¸äº¤æ¢
      if ([modelj.uid compare:modelj_1.uid options:NSCaseInsensitiveSearch] == NSOrderedAscending) {
        [array exchangeObjectAtIndex:j withObjectAtIndex:j - 1];
      }
    }
  }
}
</code></pre>

<p>æµ‹è¯•ï¼š</p>

<pre><code>NSMutableArray *array = [[NSMutableArray alloc] init];
for (NSUInteger i = 0; i &lt; 10; ++i) {
  HYBTestModel *model = [[HYBTestModel alloc] init];
  model.title = [NSString stringWithFormat:@"æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š%ld", 10 - (i + 1)];
  model.uid = [NSString stringWithFormat:@"%ld", 10 - (i + 1)];

  [array addObject:model];
}

[self bubbleSort:array];

for (HYBTestModel *model in array) {
  NSLog(@"%@ %@", model.uid, model.title);
}
</code></pre>

<p>// æ‰“å°:</p>

<pre><code>2016-03-10 22:57:37.524 DataAgorithmDemos[96148:3779265] 0 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š0
2016-03-10 22:57:37.526 DataAgorithmDemos[96148:3779265] 1 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š1
2016-03-10 22:57:37.526 DataAgorithmDemos[96148:3779265] 2 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š2
2016-03-10 22:57:37.526 DataAgorithmDemos[96148:3779265] 3 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š3
2016-03-10 22:57:37.582 DataAgorithmDemos[96148:3779265] 4 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š4
2016-03-10 22:57:37.588 DataAgorithmDemos[96148:3779265] 5 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š5
2016-03-10 22:57:37.589 DataAgorithmDemos[96148:3779265] 6 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š6
2016-03-10 22:57:37.593 DataAgorithmDemos[96148:3779265] 7 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š7
2016-03-10 22:57:37.594 DataAgorithmDemos[96148:3779265] 8 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š8
2016-03-10 22:57:37.596 DataAgorithmDemos[96148:3779265] 9 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š9
</code></pre>

<p>è¯´æ˜æ’åºæ­£å¸¸çš„~</p>

<h2>é€‰æ‹©æ’åº</h2>

<ul>
<li>é€‰æ‹©æ’åº:çš„æ€æƒ³å…¶å®å’Œå†’æ³¡æ’åºæœ‰ç‚¹ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨ä¸€æ¬¡æ’åºåæŠŠæœ€å°çš„å…ƒç´ æ”¾åˆ°æœ€å‰é¢ã€‚ä½†æ˜¯è¿‡ç¨‹ä¸åŒï¼Œå†’æ³¡æ’åºæ˜¯é€šè¿‡ç›¸é‚»çš„æ¯”è¾ƒå’Œäº¤æ¢ã€‚è€Œé€‰æ‹©æ’åºæ˜¯é€šè¿‡å¯¹æ•´ä½“çš„é€‰æ‹©</li>
</ul>


<p>ç®—æ³•æ€æƒ³ï¼šæ¯ä¸€è¶Ÿä»å‰å¾€åæŸ¥æ‰¾å‡ºå€¼æœ€å°çš„ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰ï¼Œæœ€åé€šè¿‡æ¯”è¾ƒæ˜¯å¦éœ€è¦äº¤æ¢ã€‚æ¯ä¸€è¶Ÿéƒ½å°†æœ€å°çš„å…ƒç´ äº¤æ¢åˆ°æœ€å‰é¢ã€‚</p>

<p>å…¶å®é€‰æ‹©æ’åºå¯ä»¥çœ‹æˆæ˜¯å†’æ³¡æ’åºçš„ä¼˜åŒ–ï¼Œå› ä¸ºå…¶ç›®çš„ç›¸åŒï¼Œåªæ˜¯é€‰æ‹©æ’åºåªæœ‰åœ¨ç¡®å®šäº†æœ€å°æ•°çš„å‰æä¸‹æ‰è¿›è¡Œäº¤æ¢ï¼Œå¤§å¤§å‡å°‘äº†äº¤æ¢çš„æ¬¡æ•°ï¼Œè€Œæ¯”è¾ƒæ¬¡æ•°æ˜¯ä¸€æ ·çš„ã€‚</p>

<blockquote><p>æ³¨æ„ï¼šå†’æ³¡æ’åºæ˜¯ä»åå¾€å‰æ‰«ï¼Œä½¿å¤§çš„å¾€ä¸‹æ²‰ï¼Œè€Œå°çš„å¾€ä¸Šæµ®ï¼›é€‰æ‹©æ’åºæ˜¯ä»å‰å¾€åæ‰«ï¼Œæ¯è¶Ÿæ‰¾å‡ºå€¼æœ€å°çš„ç´¢å¼•ï¼Œä½¿æ¯è¶Ÿæœ€å°å€¼éƒ½äº¤æ¢åˆ°è¯¥è¶Ÿçš„æœ€å‰é¢ï¼Œä»è€Œå¾—åˆ°å‡åºåºåˆ—</p></blockquote>

<p>é€‰æ‹©æ’åºå¯ä»¥çœ‹ä½œå†’æ³¡æ’åºçš„ä¼˜åŒ–ç‰ˆæœ¬ï¼Œä¸€æ ·è¦ä¸¤å±‚å¾ªç¯æ‰èƒ½æ’åºå®Œæˆã€‚</p>

<p>æ‰€ä»¥ï¼Œé€‰æ‹©æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO ( n2 )</p>

<p>ä¼ªä»£ç </p>

<pre><code>void selectSort(int arr[], int len) {
  int min = 0;

  // åªéœ€è¦n-1è¶Ÿå³å¯ï¼Œåˆ°æœ€åä¸€è¶Ÿåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¸€å®šæ˜¯æœ€å°çš„äº†
  for i = 0; i &lt; len - 1; ++i {

    // æ¯ä¸€è¶Ÿçš„å¼€å§‹ï¼Œå‡è®¾è¯¥è¶Ÿçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æœ€å°çš„
    min = i;

    // æŸ¥æ‰¾è¯¥è¶Ÿæœ‰æ²¡æœ‰æ›´å°çš„ï¼Œå¦‚æœæ‰¾åˆ°æ›´å°çš„ï¼Œåˆ™æ›´æ–°æœ€å°å€¼çš„ä¸‹æ ‡
    for j = i + 1; j &lt; len; ++j {
       if arr[j] &lt; arr[min] {
          min = j;
       } 
    }

    // å¦‚æœè¯¥è¶Ÿçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸æ˜¯æœ€å°çš„ï¼Œè¯´æ˜éœ€è¦äº¤æ¢
    if min != i {
       int temp = arr[i];
       arr[i] = arr[min];
       arr[min] = temp;
    }
  }
}
</code></pre>

<p>Cè¯­è¨€ç‰ˆ</p>

<pre><code>void selectSort(int arr[], int len) {
  int min = 0;

  // åªéœ€è¦n-1è¶Ÿ
  for (int i = 0; i &lt; len - 1; ++i) {
    min = i;

    // ä»ç¬¬n+1è¶Ÿèµ·å§‹æ‰¾åˆ°æœ«å°¾
    for (int j = i + 1; j &lt; len; ++j) {

      // æ‰¾åˆ°æ¯”minä½ç½®æ›´å°çš„ï¼Œå°±æ›´æ–°è¿™ä¸€è¶Ÿæ‰€æ‰¾åˆ°çš„æœ€å°å€¼çš„ä½ç½®
      if (arr[j] &lt; arr[min]) {
        min = j;
      }
    }

    // å¦‚æœminä¸iä¸ç›¸ç­‰ï¼Œè¯´æ˜æœ‰æ¯”iä½ç½®æ›´å°çš„ï¼Œæ‰€ä»¥éœ€è¦äº¤æ¢
    if (min != i) {
      int temp = arr[min];
      arr[min] = arr[i];
      arr[i] = temp;
    }
  }
}
</code></pre>

<p>ObjCç‰ˆ</p>

<pre><code>- (void)selectSort:(int [])arr len:(int)len {
  int min = 0;

  // åªéœ€è¦n-1è¶Ÿ
  for (int i = 0; i &lt; len - 1; ++i) {
    min = i;

    // ä»ç¬¬n+1è¶Ÿèµ·å§‹æ‰¾åˆ°æœ«å°¾
    for (int j = i + 1; j &lt; len; ++j) {

      // æ‰¾åˆ°æ¯”minä½ç½®æ›´å°çš„ï¼Œå°±æ›´æ–°è¿™ä¸€è¶Ÿæ‰€æ‰¾åˆ°çš„æœ€å°å€¼çš„ä½ç½®
      if (arr[j] &lt; arr[min]) {
        min = j;
      }
    }

    // å¦‚æœminä¸iä¸ç›¸ç­‰ï¼Œè¯´æ˜æœ‰æ¯”iä½ç½®æ›´å°çš„ï¼Œæ‰€ä»¥éœ€è¦äº¤æ¢
    if (min != i) {
      int temp = arr[min];
      arr[min] = arr[i];
      arr[i] = temp;
    }
  }
}
</code></pre>

<p>Swiftç‰ˆ</p>

<pre><code>func selectSort(var arr: [Int]) -&gt;[Int] {
  var min = 0

  // åªéœ€è¦n-1è¶Ÿ
  for var i = 0; i &lt; arr.count - 1; ++i {
    min = i

    // ä»ç¬¬n+1è¶Ÿèµ·å§‹æ‰¾åˆ°æœ«å°¾
    for var j = i + 1; j &lt; arr.count; ++j {

      // æ‰¾åˆ°æ¯”minä½ç½®æ›´å°çš„ï¼Œå°±æ›´æ–°è¿™ä¸€è¶Ÿæ‰€æ‰¾åˆ°çš„æœ€å°å€¼çš„ä½ç½®
      if arr[j] &lt; arr[min] {
        min = j
      }
    }

    // å¦‚æœminä¸iä¸ç›¸ç­‰ï¼Œè¯´æ˜æœ‰æ¯”iä½ç½®æ›´å°çš„ï¼Œæ‰€ä»¥éœ€è¦äº¤æ¢
    if min != i {
      let temp = arr[i]
      arr[i] = arr[min]
      arr[min] = temp
    }
  }

  return arr
}
</code></pre>

<p>å°è¯•ObjCå®ç°æ¨¡å‹é€‰æ‹©æ’åº</p>

<pre><code>- (void)selectSort:(NSMutableArray *)array {
  NSUInteger minIndex = 0;

  for (NSUInteger i = 0; i &lt; array.count - 1; ++i) {
    minIndex = i;

    for (NSUInteger j = i + 1; j &lt; array.count; ++j) {
      HYBTestModel *modelj = [array objectAtIndex:j];
      HYBTestModel *model = [array objectAtIndex:minIndex];

      // æ¯”minä¸‹çš„è¿˜è¦å°ï¼Œåˆ™æ›´æ–°min
      if ([modelj.uid compare:model.uid options:NSCaseInsensitiveSearch] == NSOrderedAscending) {
        minIndex = j;
      }
    }

    if (minIndex != i) {
      [array exchangeObjectAtIndex:minIndex withObjectAtIndex:i];
    }
  }
}
</code></pre>

<p>æµ‹è¯•ï¼š</p>

<pre><code>NSMutableArray *array = [[NSMutableArray alloc] init];
for (NSUInteger i = 0; i &lt; 10; ++i) {
  HYBTestModel *model = [[HYBTestModel alloc] init];
  model.title = [NSString stringWithFormat:@"æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š%ld", 10 - (i + 1)];
  model.uid = [NSString stringWithFormat:@"%ld", 10 - (i + 1)];

  [array addObject:model];

}

[self selectSort:array];

for (HYBTestModel *model in array) {
  NSLog(@"%@ %@", model.uid, model.title);
}
</code></pre>

<p>// æ‰“å°:</p>

<pre><code>2016-03-11 11:52:47.482 DataAgorithmDemos[97923:4012461] 0 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š0
2016-03-11 11:52:47.484 DataAgorithmDemos[97923:4012461] 1 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š1
2016-03-11 11:52:47.484 DataAgorithmDemos[97923:4012461] 2 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š2
2016-03-11 11:52:47.484 DataAgorithmDemos[97923:4012461] 3 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š3
2016-03-11 11:52:47.484 DataAgorithmDemos[97923:4012461] 4 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š4
2016-03-11 11:52:47.484 DataAgorithmDemos[97923:4012461] 5 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š5
2016-03-11 11:52:47.484 DataAgorithmDemos[97923:4012461] 6 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š6
2016-03-11 11:52:47.485 DataAgorithmDemos[97923:4012461] 7 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š7
2016-03-11 11:52:47.487 DataAgorithmDemos[97923:4012461] 8 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š8
2016-03-11 11:52:47.487 DataAgorithmDemos[97923:4012461] 9 æ ‡å“¥çš„æŠ€æœ¯åšå®¢ï¼š9
</code></pre>

<h2>å †æ’åº</h2>

<p>å †æ˜¯æŒ‡äºŒå‰å †ï¼ŒäºŒå‰å †åˆç§°å®Œå…¨äºŒå‰æ ‘æˆ–è€…å«è¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘ã€‚äºŒå‰å †åˆåˆ†ä¸ºæœ€å¤§å †å’Œæœ€å°å †ã€‚</p>

<p>å †æ’åº(Heapsort)æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ï¼Œå®ƒæ˜¯é€‰æ‹©æ’åºçš„ä¸€ç§ã€‚å¯ä»¥åˆ©ç”¨æ•°ç»„çš„ç‰¹ç‚¹å¿«é€Ÿå®šä½æŒ‡å®šç´¢å¼•çš„å…ƒç´ ã€‚æ•°ç»„å¯ä»¥æ ¹æ®ç´¢å¼•ç›´æ¥è·å–å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆ1ï¼‰ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡ï¼Œå› æ­¤å¯¹äºå–å€¼æ•ˆç‡æé«˜ã€‚</p>

<p>æœ€å¤§å †çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p>

<pre><code>çˆ¶ç»“ç‚¹çš„é”®å€¼æ€»æ˜¯å¤§äºæˆ–è€…ç­‰äºä»»ä½•ä¸€ä¸ªå­èŠ‚ç‚¹çš„é”®å€¼
æ¯ä¸ªç»“ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯ä¸€ä¸ªæœ€å¤§å †
</code></pre>

<p>æœ€å°å †çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p>

<pre><code>çˆ¶ç»“ç‚¹çš„é”®å€¼æ€»æ˜¯å°äºæˆ–è€…ç­‰äºä»»ä½•ä¸€ä¸ªå­èŠ‚ç‚¹çš„é”®å€¼
æ¯ä¸ªç»“ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯ä¸€ä¸ªæœ€å°å †
</code></pre>

<p>å †æ’åºçš„æ—¶é—´ï¼Œä¸»è¦ç”±å»ºç«‹åˆå§‹å †å’Œåå¤è°ƒæ•´å †è¿™ä¸¤éƒ¨åˆ†çš„æ—¶é—´å¼€é”€æ„æˆ.ç”±äºå †æ’åºæ˜¯ä¸ç¨³å®šçš„ï¼Œå®ƒå¾—æ‰­åˆ°çš„æ—¶é—´å¤æ‚åº¦ä¼šæ ¹æ®å®é™…æƒ…å†µè¾ƒå¤§ï¼Œå› æ­¤åªèƒ½å–å¹³å‡æ—¶é—´å¤æ‚åº¦ã€‚</p>

<p>å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO( N * log2(N) )</p>

<p>ä½¿ç”¨å»ºè®®ï¼š</p>

<pre><code>ç”±äºåˆå§‹åŒ–å †éœ€è¦æ¯”è¾ƒçš„æ¬¡æ•°è¾ƒå¤šï¼Œå› æ­¤ï¼Œå †æ’åºæ¯”è¾ƒé€‚åˆäºæ•°æ®é‡éå¸¸å¤§çš„åœºåˆï¼ˆç™¾ä¸‡æ•°æ®æˆ–æ›´å¤šï¼‰ã€‚ç”±äºé«˜æ•ˆçš„å¿«é€Ÿæ’åºæ˜¯åŸºäºé€’å½’å®ç°çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®é‡éå¸¸å¤§æ—¶ä¼šå‘ç”Ÿå †æ ˆæº¢å‡ºé”™è¯¯ã€‚
</code></pre>

<p>åŸºäºæœ€å¤§å †å®ç°å‡åºæ’åº</p>

<pre><code>// åˆå§‹åŒ–å †
void initHeap(int a[], int len) {
  // ä»å®Œå…¨äºŒå‰æ ‘æœ€åä¸€ä¸ªéå­èŠ‚ç‚¹å¼€å§‹
  // åœ¨æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯0
  // ç¬¬nä¸ªå…ƒç´ çš„å·¦å­©å­ä¸º2n+1ï¼Œå³å­©å­ä¸º2n+2ï¼Œ
  // æœ€åä¸€ä¸ªéå­èŠ‚ç‚¹ä½ç½®åœ¨(n - 1) / 2
  for (int i = (len - 1) / 2; i &gt;= 0; --i) {
    adjustMaxHeap(a, len, i);
  }
}

void adjustMaxHeap(int a[], int len, int parentNodeIndex) {
  // è‹¥åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆåªèƒ½æ˜¯å †é¡¶å…ƒç´ ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦å†æ’åºäº†
  if (len &lt;= 1) {
    return;
  }

  // è®°å½•æ¯”çˆ¶èŠ‚ç‚¹å¤§çš„å·¦å­©å­æˆ–è€…å³å­©å­çš„ç´¢å¼•
  int targetIndex = -1;

  // è·å–å·¦ã€å³å­©å­çš„ç´¢å¼•
  int leftChildIndex = 2 * parentNodeIndex + 1;
  int rightChildIndex = 2 * parentNodeIndex + 2;

  // æ²¡æœ‰å·¦å­©å­
  if (leftChildIndex &gt;= len) {
    return;
  }

  // æœ‰å·¦å­©å­ï¼Œä½†æ˜¯æ²¡æœ‰å³å­©å­
  if (rightChildIndex &gt;= len) {
    targetIndex = leftChildIndex;
  }
  // æœ‰å·¦å­©å­å’Œå³å­©å­
  else {
    // å–å·¦ã€å³å­©å­ä¸¤è€…ä¸­æœ€å¤§çš„ä¸€ä¸ª
    targetIndex = a[leftChildIndex] &gt; a[rightChildIndex] ? leftChildIndex : rightChildIndex;
  }

  // åªæœ‰å­©å­æ¯”çˆ¶èŠ‚ç‚¹çš„å€¼è¿˜è¦å¤§ï¼Œæ‰éœ€è¦äº¤æ¢
  if (a[targetIndex] &gt; a[parentNodeIndex]) {
    int temp = a[targetIndex];

    a[targetIndex] = a[parentNodeIndex];
    a[parentNodeIndex] = temp;


    // äº¤æ¢å®Œæˆåï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´a[targetIndex]ç»“ç‚¹æ‰€å½¢æˆçš„å­æ ‘ä¸æ»¡è¶³å †çš„æ¡ä»¶ï¼Œ
    // è‹¥ä¸æ»¡è¶³å †çš„æ¡ä»¶ï¼Œåˆ™è°ƒæ•´ä¹‹ä½¿ä¹‹ä¹Ÿæˆä¸ºå †
    adjustMaxHeap(a, len, targetIndex);
  }
}

void heapSort(int a[], int len) {
  if (len &lt;= 1) {
    return;
  }

  // åˆå§‹å †æˆæ— åºæœ€å¤§å †
  initHeap(a, len);

  for (int i = len - 1; i &gt; 0; --i) {
    // å°†å½“å‰å †é¡¶å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œä¿è¯è¿™ä¸€è¶Ÿæ‰€æŸ¥æ‰¾åˆ°çš„å †é¡¶å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢
    // æ³¨æ„ï¼šè¿™é‡Œæ‰€è¯´çš„æœ€åä¸æ˜¯a[len - 1]ï¼Œè€Œæ˜¯æ¯ä¸€è¶Ÿçš„èŒƒå›´ä¸­æœ€åä¸€ä¸ªå…ƒç´ 
    // ä¸ºä»€ä¹ˆè¦åŠ ä¸Š&gt;0åˆ¤æ–­ï¼Ÿæ¯æ¬¡ä¸æ˜¯è¯´å †é¡¶ä¸€å®šæ˜¯æœ€å¤§å€¼å—ï¼Ÿæ²¡é”™ï¼Œæ¯ä¸€è¶Ÿè°ƒæ•´åï¼Œå †é¡¶æ˜¯æœ€å¤§å€¼çš„
    // ä½†æ˜¯ï¼Œç”±äºlençš„èŒƒå›´ä¸æ–­åœ°ç¼©å°ï¼Œå¯¼è‡´æŸäº›ç‰¹æ®Šçš„åºåˆ—å‡ºç°å¼‚å¸¸
    // æ¯”å¦‚è¯´ï¼Œ5, 3, 8, 6, 4åºåˆ—ï¼Œå½“è°ƒæ•´i=1æ—¶ï¼Œå·²ç»è°ƒæ•´ä¸º3,4,5,6,8åºåˆ—ï¼Œå·²ç»æœ‰åºäº†
    // ä½†æ˜¯å¯¼è‡´äº†a[i]ä¸a[0]äº¤æ¢ï¼Œç”±äºå˜æˆäº†4,3,5,6,8åè€Œå˜æˆæ— åºäº†!
    if (a[0] &gt; a[i]) {
      int temp = a[0];
      a[0] = a[i];
      a[i] = temp;
    }

    // èŒƒå›´å˜æˆä¸ºï¼š
    // 0...len-1
    // 0...len-1-1
    // 0...1 // ç»“æŸ
    // å…¶ä¸­ï¼Œ0æ˜¯å †é¡¶ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‰¾å‡ºåœ¨æŒ‡å®šçš„èŒƒå›´å†…æ¯”å †é¡¶è¿˜å¤§çš„å…ƒç´ ï¼Œç„¶åä¸å †é¡¶å…ƒç´ äº¤æ¢
    adjustMaxHeap(a, i - 1, 0);
  }
}
</code></pre>

<p>åŸºäºæœ€å°å †å®ç°é™åºæ’åº</p>

<pre><code>// åˆå§‹åŒ–å †
void initHeap(int a[], int len) {
  // ä»å®Œå…¨äºŒå‰æ ‘æœ€åä¸€ä¸ªéå­èŠ‚ç‚¹å¼€å§‹
  // åœ¨æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯0
  // ç¬¬nä¸ªå…ƒç´ çš„å·¦å­©å­ä¸º2n+1ï¼Œå³å­©å­ä¸º2n+2ï¼Œ
  // æœ€åä¸€ä¸ªéå­èŠ‚ç‚¹ä½ç½®åœ¨(n - 1) / 2
  for (int i = (len - 1) / 2; i &gt;= 0; --i) {
    adjustMinHeap(a, len, i);
  }
}

void adjustMinHeap(int a[], int len, int parentNodeIndex) {
  // è‹¥åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆåªèƒ½æ˜¯å †é¡¶å…ƒç´ ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦å†æ’åºäº†
  if (len &lt;= 1) {
    return;
  }

  // è®°å½•æ¯”çˆ¶èŠ‚ç‚¹å¤§çš„å·¦å­©å­æˆ–è€…å³å­©å­çš„ç´¢å¼•
  int targetIndex = -1;

  // è·å–å·¦ã€å³å­©å­çš„ç´¢å¼•
  int leftChildIndex = 2 * parentNodeIndex + 1;
  int rightChildIndex = 2 * parentNodeIndex + 2;

  // æ²¡æœ‰å·¦å­©å­
  if (leftChildIndex &gt;= len) {
    return;
  }

  // æœ‰å·¦å­©å­ï¼Œä½†æ˜¯æ²¡æœ‰å³å­©å­
  if (rightChildIndex &gt;= len) {
    targetIndex = leftChildIndex;
  }
  // æœ‰å·¦å­©å­å’Œå³å­©å­
  else {
    // å–å·¦ã€å³å­©å­ä¸¤è€…ä¸­æœ€ä¸Šçš„ä¸€ä¸ª
    targetIndex = a[leftChildIndex] &lt; a[rightChildIndex] ? leftChildIndex : rightChildIndex;
  }

  // åªæœ‰å­©å­æ¯”çˆ¶èŠ‚ç‚¹çš„å€¼è¿˜è¦å°ï¼Œæ‰éœ€è¦äº¤æ¢
  if (a[targetIndex] &lt; a[parentNodeIndex]) {
    int temp = a[targetIndex];

    a[targetIndex] = a[parentNodeIndex];
    a[parentNodeIndex] = temp;


    // äº¤æ¢å®Œæˆåï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´a[targetIndex]ç»“ç‚¹æ‰€å½¢æˆçš„å­æ ‘ä¸æ»¡è¶³å †çš„æ¡ä»¶ï¼Œ
    // è‹¥ä¸æ»¡è¶³å †çš„æ¡ä»¶ï¼Œåˆ™è°ƒæ•´ä¹‹ä½¿ä¹‹ä¹Ÿæˆä¸ºå †
    adjustMinHeap(a, len, targetIndex);
  }
}

void heapSort(int a[], int len) {
  if (len &lt;= 1) {
    return;
  }

  // åˆå§‹å †æˆæ— åºæœ€å°å †
  initHeap(a, len);

  for (int i = len - 1; i &gt; 0; --i) {
    // å°†å½“å‰å †é¡¶å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œä¿è¯è¿™ä¸€è¶Ÿæ‰€æŸ¥æ‰¾åˆ°çš„å †é¡¶å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢
    // æ³¨æ„ï¼šè¿™é‡Œæ‰€è¯´çš„æœ€åä¸æ˜¯a[len - 1]ï¼Œè€Œæ˜¯æ¯ä¸€è¶Ÿçš„èŒƒå›´ä¸­æœ€åä¸€ä¸ªå…ƒç´ 
    // ä¸ºä»€ä¹ˆè¦åŠ ä¸Š&gt;0åˆ¤æ–­ï¼Ÿæ¯æ¬¡ä¸æ˜¯è¯´å †é¡¶ä¸€å®šæ˜¯æœ€å°å€¼å—ï¼Ÿæ²¡é”™ï¼Œæ¯ä¸€è¶Ÿè°ƒæ•´åï¼Œå †é¡¶æ˜¯æœ€å°å€¼çš„
    // ä½†æ˜¯ï¼Œç”±äºlençš„èŒƒå›´ä¸æ–­åœ°ç¼©å°ï¼Œå¯¼è‡´æŸäº›ç‰¹æ®Šçš„åºåˆ—å‡ºç°å¼‚å¸¸
    // æ¯”å¦‚è¯´ï¼Œ5, 3, 8, 6, 4åºåˆ—ï¼Œå½“è°ƒæ•´i=1æ—¶ï¼Œå·²ç»è°ƒæ•´ä¸º3,4,5,6,8åºåˆ—ï¼Œå·²ç»æœ‰åºäº†
    // ä½†æ˜¯å¯¼è‡´äº†a[i]ä¸a[0]äº¤æ¢ï¼Œç”±äºå˜æˆäº†4,3,5,6,8åè€Œå˜æˆæ— åºäº†!
    if (a[0] &lt; a[i]) {
      int temp = a[0];
      a[0] = a[i];
      a[i] = temp;
    }

    // èŒƒå›´å˜æˆä¸ºï¼š
    // 0...len-1
    // 0...len-1-1
    // 0...1 // ç»“æŸ
    // å…¶ä¸­ï¼Œ0æ˜¯å †é¡¶ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‰¾å‡ºåœ¨æŒ‡å®šçš„èŒƒå›´å†…æ¯”å †é¡¶è¿˜å°çš„å…ƒç´ ï¼Œç„¶åä¸å †é¡¶å…ƒç´ äº¤æ¢
    adjustMinHeap(a, i - 1, 0);
  }
}
</code></pre>

<p>Cè¯­è¨€ç‰ˆæµ‹è¯•</p>

<p>å¤§å®¶å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>

<pre><code>//  int a[] = {5, 3, 8, 6, 4};
int a[] = {89,-7,999,-89,7,0,-888,7,-7};
heapSort(a, sizeof(a) / sizeof(int));

for (int i = 0; i &lt; sizeof(a) / sizeof(int); ++i) {
    NSLog(@"%d", a[i]);
}
</code></pre>

<p>Swiftç‰ˆå®ç°
åŸºäºæœ€å¤§å †å®ç°å‡åºæ’åº</p>

<pre><code>func initHeap(inout a: [Int]) {
  for var i = (a.count - 1) / 2; i &gt;= 0; --i {
    adjustMaxHeap(&amp;a, len: a.count, parentNodeIndex: i)
  }
}

func adjustMaxHeap(inout a: [Int], len: Int, parentNodeIndex: Int) {
  // å¦‚æœlen &lt;= 0ï¼Œè¯´æ˜å·²ç»æ— åºåŒºå·²ç»ç¼©å°åˆ°0
  guard len &gt; 1 else {
    return
  }

  // çˆ¶ç»“ç‚¹çš„å·¦ã€å³å­©å­çš„ç´¢å¼•
  let leftChildIndex = 2 * parentNodeIndex + 1

  // å¦‚æœè¿å·¦å­©å­éƒ½æ²¡æœ‰ï¼Œ ä¸€å®šæ²¡æœ‰å³å­©å­ï¼Œè¯´æ˜å·²ç»ä¸ç”¨å†å¾€ä¸‹äº†
  guard leftChildIndex &lt; len else {
    return
  }

  let rightChildIndex = 2 * parentNodeIndex + 2

  // ç”¨äºè®°å½•éœ€è¦ä¸çˆ¶ç»“ç‚¹äº¤æ¢çš„å­©å­çš„ç´¢å¼•
  var targetIndex = -1

  // è‹¥æ²¡æœ‰å³å­©å­ï¼Œä½†æœ‰å·¦å­©å­ï¼Œåªèƒ½é€‰æ‹©å·¦å­©å­
  if rightChildIndex &gt; len {
    targetIndex = leftChildIndex
  } else {
    // å·¦ã€å³å­©å­éƒ½æœ‰ï¼Œåˆ™éœ€è¦æ‰¾å‡ºæœ€å¤§çš„ä¸€ä¸ª
    targetIndex = a[leftChildIndex] &gt; a[rightChildIndex] ? leftChildIndex : rightChildIndex
  }

  // åªæœ‰å­©å­æ¯”çˆ¶ç»“ç‚¹è¿˜è¦å¤§ï¼Œå†éœ€è¦äº¤æ¢
  if a[targetIndex] &gt; a[parentNodeIndex] {
    let temp = a[targetIndex]

    a[targetIndex] = a[parentNodeIndex]
    a[parentNodeIndex] = temp

    // ç”±äºäº¤æ¢åï¼Œå¯èƒ½ä¼šç ´åæ‰æ–°çš„å­æ ‘å †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦è°ƒæ•´ä»¥a[targetIndex]ä¸ºçˆ¶ç»“ç‚¹çš„å­æ ‘ï¼Œä½¿ä¹‹æ»¡è¶³å †çš„æ€§è´¨
    adjustMaxHeap(&amp;a, len: len, parentNodeIndex: targetIndex)
  }
}

func maxHeapSort(inout a: [Int]) {
  guard a.count &gt; 1 else {
    return
  }

  initHeap(&amp;a)

  for var i = a.count - 1; i &gt; 0; --i {
    // æ¯ä¸€è¶Ÿéƒ½å°†å †é¡¶äº¤æ¢åˆ°æŒ‡å®šèŒƒå›´å†…çš„æœ€åä¸€ä¸ªä½ç½®
    if a[0] &gt; a[i] {
      let temp = a[0]

      a[0] = a[i]
      a[i] = temp
    }
    print(a)
    print(i - 1)
    // æœ‰åºåŒºé•¿åº¦+1ï¼Œè€Œæ— åºåŒºé•¿åº¦-1ï¼Œç»§ç»­ç¼©å°æ— åºåŒºï¼Œæ‰€ä»¥i-1
    // å †é¡¶æ°¸è¿œæ˜¯åœ¨0å·ä½ç½®ï¼Œæ‰€ä»¥çˆ¶ç»“ç‚¹è°ƒæ•´ä»å †é¡¶å¼€å§‹å°±å¯ä»¥äº†
    adjustMaxHeap(&amp;a, len: i - 1, parentNodeIndex: 0)
    print(a)
  }
}
</code></pre>

<p>åŸºäºæœ€å°å †é™åºæ’åº</p>

<pre><code>func initHeap(inout a: [Int]) {
  for var i = (a.count - 1) / 2; i &gt;= 0; --i {
    adjustMinHeap(&amp;a, len: a.count, parentNodeIndex: i)
  }
}

func adjustMinHeap(inout a: [Int], len: Int, parentNodeIndex: Int) {
  // å¦‚æœlen &lt;= 0ï¼Œè¯´æ˜å·²ç»æ— åºåŒºå·²ç»ç¼©å°åˆ°0
  guard len &gt; 1 else {
    return
  }

  // çˆ¶ç»“ç‚¹çš„å·¦ã€å³å­©å­çš„ç´¢å¼•
  let leftChildIndex = 2 * parentNodeIndex + 1

  // å¦‚æœè¿å·¦å­©å­éƒ½æ²¡æœ‰ï¼Œ ä¸€å®šæ²¡æœ‰å³å­©å­ï¼Œè¯´æ˜å·²ç»ä¸ç”¨å†å¾€ä¸‹äº†
  guard leftChildIndex &lt; len else {
    return
  }

  let rightChildIndex = 2 * parentNodeIndex + 2

  // ç”¨äºè®°å½•éœ€è¦ä¸çˆ¶ç»“ç‚¹äº¤æ¢çš„å­©å­çš„ç´¢å¼•
  var targetIndex = -1

  // è‹¥æ²¡æœ‰å³å­©å­ï¼Œä½†æœ‰å·¦å­©å­ï¼Œåªèƒ½é€‰æ‹©å·¦å­©å­
  if rightChildIndex &gt; len {
    targetIndex = leftChildIndex
  } else {
    // å·¦ã€å³å­©å­éƒ½æœ‰ï¼Œåˆ™éœ€è¦æ‰¾å‡ºæœ€å¤§çš„ä¸€ä¸ª
    targetIndex = a[leftChildIndex] &lt; a[rightChildIndex] ? leftChildIndex : rightChildIndex
  }

  // åªæœ‰å­©å­æ¯”çˆ¶ç»“ç‚¹è¿˜è¦å¤§ï¼Œå†éœ€è¦äº¤æ¢
  if a[targetIndex] &lt; a[parentNodeIndex] {
    let temp = a[targetIndex]

    a[targetIndex] = a[parentNodeIndex]
    a[parentNodeIndex] = temp

    // ç”±äºäº¤æ¢åï¼Œå¯èƒ½ä¼šç ´åæ‰æ–°çš„å­æ ‘å †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦è°ƒæ•´ä»¥a[targetIndex]ä¸ºçˆ¶ç»“ç‚¹çš„å­æ ‘ï¼Œä½¿ä¹‹æ»¡è¶³å †çš„æ€§è´¨
    adjustMinHeap(&amp;a, len: len, parentNodeIndex: targetIndex)
  }
}

func minHeapSort(inout a: [Int]) {
  guard a.count &gt; 1 else {
    return
  }

  initHeap(&amp;a)

  for var i = a.count - 1; i &gt; 0; --i {
    // æ¯ä¸€è¶Ÿéƒ½å°†å †é¡¶äº¤æ¢åˆ°æŒ‡å®šèŒƒå›´å†…çš„æœ€åä¸€ä¸ªä½ç½®
    if a[0] &lt; a[i] {
      let temp = a[0]

      a[0] = a[i]
      a[i] = temp
    } else {
       return // å¯ä»¥ç›´æ¥é€€å‡ºäº†ï¼Œå› ä¸ºå·²ç»å…¨éƒ¨æœ‰åºäº†
    }

    // æœ‰åºåŒºé•¿åº¦+1ï¼Œè€Œæ— åºåŒºé•¿åº¦-1ï¼Œç»§ç»­ç¼©å°æ— åºåŒºï¼Œæ‰€ä»¥i-1
    // å †é¡¶æ°¸è¿œæ˜¯åœ¨0å·ä½ç½®ï¼Œæ‰€ä»¥çˆ¶ç»“ç‚¹è°ƒæ•´ä»å †é¡¶å¼€å§‹å°±å¯ä»¥äº†
    adjustMinHeap(&amp;a, len: i - 1, parentNodeIndex: 0)
  }
}
</code></pre>

<p>æµ‹è¯•ï¼š</p>

<pre><code>var arr = [5, 3, 8, 6, 4]
//var arr = [89,-7,999,-89,7,0,-888,7,-7]
maxHeapSort(&amp;arr)

print(arr)

// æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š
[4, 6, 5, 3, 8]
3
[6, 4, 5, 3, 8]

[3, 4, 5, 6, 8]
2
[5, 4, 3, 6, 8]

[3, 4, 5, 6, 8]
1
[3, 4, 5, 6, 8]

[3, 4, 5, 6, 8]
0
[3, 4, 5, 6, 8]

[3, 4, 5, 6, 8]
</code></pre>

<h2>å½’å¹¶æ’åº</h2>

<p>å½’å¹¶æ’åºï¼ˆMERGE-SORTï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•,è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸ºäºŒè·¯å½’å¹¶ã€‚</p>

<p>å½’å¹¶æ’åºçš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œå‡è®¾æ•°åˆ—é•¿åº¦ä¸ºNï¼Œé‡‡ç”¨ä¸­åˆ†æ³•çš„æ–¹å¼å°†æ•°åˆ—åˆ†å¼€æˆè‹¥å¹²ä¸ªå°æ•°åˆ—ä¸€å…±è¦log2N æ­¥ï¼Œæ¯æ­¥éƒ½æ˜¯ä¸€ä¸ªåˆå¹¶æœ‰åºæ•°åˆ—çš„è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥è®°ä¸ºO ( N )ï¼Œæ•…ä¸€å…±ä¸ºO ( N * log2N )ã€‚</p>

<p>å› ä¸ºå½’å¹¶æ’åºæ¯æ¬¡éƒ½æ˜¯åœ¨ç›¸é‚»çš„æ•°æ®ä¸­è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥å½’å¹¶æ’åºåœ¨å¸¸ç”¨çš„å‡ ç§æ’åºæ–¹æ³•ï¼ˆå¿«é€Ÿæ’åºï¼Œå½’å¹¶æ’åºï¼Œå¸Œå°”æ’åºï¼Œå †æ’åºï¼‰ä¸­ä¹Ÿæ˜¯æ•ˆç‡æ¯”è¾ƒé«˜çš„ã€‚</p>

<p>æ—¶é—´å¤æ‚åº¦ï¼šO ( N * log2N )</p>

<p>Cè¯­è¨€å®ç°</p>

<pre><code>/**
 *  å½’å¹¶æ’åºç®—æ³•
 *
 *  @param list   å¾…æ’åºçš„åºåˆ—
 *  @param first    å­åºåˆ—çš„èµ·ç‚¹ç´¢å¼•
 *  @param last   å­åºåˆ—çš„ç»ˆç‚¹ç´¢å¼•
 *  @param temp   ä¸´æ—¶æ•°ç»„ï¼Œç”¨äºå°†ä¸¤ä¸ªå­åºåˆ—äºŒè·¯å½’å¹¶æ—¶å­˜å‚¨
 */
void mergeSort(int list[], int first, int last, int temp[]) {
  if (first &lt; last) {
    int mid = (first + last) / 2;

    // é€’å½’å½’å¹¶ä¸­åˆ†å·¦å­åºåˆ—ï¼Œä½¿å­åºåˆ—æœ‰åº
    mergeSort(list, first, mid, temp);

    // é€’å½’å½’å¹¶ä¸­åˆ†å³å­åºåˆ—ï¼Œä½¿å­åºåˆ—æœ‰åº
    mergeSort(list, mid + 1, last, temp);

    // æœ€åäºŒè·¯å½’å¹¶ï¼Œä½¿åºåˆ—æˆæœ‰åº
    // å¿…é¡»æ˜ç™½çš„ä¸€ç‚¹ï¼Œæ¯æ¬¡ä¸­åˆ†é€’å½’å½’å¹¶éƒ½éœ€è¦äºŒè·¯å½’å¹¶ï¼Œå› ä¸ºä¸­åˆ†åçš„ä»»æ„å­åºåˆ—
    // åœ¨æœ‰åºåï¼Œéƒ½è¦äºŒè·¯å½’å¹¶æˆä¸€ä¸ªåºåˆ—
    mergeList(list, first, mid, last, temp);
  }
}

/**
 *  äºŒè·¯å½’å¹¶list[first...mid]å­åºåˆ—ä¸list[mid+1...last]
 *
 *  @param list åºåˆ—
 *  @param first    å·¦å­åºåˆ—çš„èµ·ç‚¹
 *  @param mid      åºåˆ—ä¸­é—´åˆ†å‰²ç‚¹
 *  @param last å³åºåˆ—ç»ˆç‚¹
 *  @param temp ä¸´æ—¶åºåˆ—ï¼Œç”¨äºå°†ä¸¤ä¸ªæ— åºçš„å­åºåˆ—å½’å¹¶åˆ°tempä¸­ï¼Œä½¿ä¹‹æœ‰åº
 */
void mergeList(int list[], int first, int mid, int last, int temp[]) {
  int leftIndex = first;
  int leftEndIndex = mid;

  int rightIndex = mid + 1;
  int rightEndIndex = last;

  int tempIndex = 0;

  // å¯»æ‰¾ä¸¤ä¸ªå­åºåˆ—ï¼Œé¡ºåºéå†ï¼Œå°†å€¼å°çš„å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ä¸­ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå­åºåˆ—éå†å®Œæ¯•
  while (leftIndex &lt;= leftEndIndex &amp;&amp; rightIndex &lt;= rightEndIndex) {
    // å€¼å°çš„å°±å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ä¸­
    if (list[leftIndex] &lt;= list[rightIndex]) {
      temp[tempIndex] = list[leftIndex];
      tempIndex++;
      leftIndex++;
    } else {
      temp[tempIndex] = list[rightIndex];
      tempIndex++;
      rightIndex++;
    }
  }

  // æœ‰å¯èƒ½å·¦å­åºåˆ—æ›´é•¿ï¼Œå› æ­¤å°†å‰©ä¸‹çš„éƒ¨åˆ†ç›´æ¥å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ä¸­
  while (leftIndex &lt;= leftEndIndex) {
    temp[tempIndex++] = list[leftIndex++];
  }

  // æœ‰å¯èƒ½å³å­åºåˆ—æ›´é•¿ï¼Œå› æ­¤å°†å‰©ä¸‹çš„éƒ¨åˆ†ç›´æ¥å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ä¸­
  while (rightIndex &lt;= rightEndIndex) {
    temp[tempIndex++] = list[rightIndex++];
  }

  // æœ€åè¿˜éœ€è¦å°†æœ‰åºçš„ä¸´æ—¶æ•°ç»„å¤åˆ¶åˆ°åŸå§‹åºåˆ—ä¸­
  for (int i = 0; i &lt; tempIndex; ++i) {
    list[first + i] = temp[i];
  }

 // è¿™é‡Œæ·»åŠ ä¸€ä¸ªæ‰“å°ï¼Œè®°å½•å½’å¹¶
 NSMutableString *str = [[NSMutableString alloc] init];
  for (int i = 0; i &lt; sizeof(list) - 1; ++i) {
    if (i == 0) {
      [str appendFormat:@"%d", list[i]];
    } else {
      [str appendFormat:@", %d", list[i]];
    }
  }
  NSLog(@"æ­¤æ¬¡äºŒè·¯å½’å¹¶åï¼Œå¾—åˆ°çš„åºåˆ—ä¸ºï¼š(%@)", str);
}
</code></pre>

<p>æµ‹è¯•ï¼š</p>

<pre><code>int list[] = {6, 202, 100, 301, 38, 8, 1};
int temp[7] = {0};
mergeSort(list, 0, 7-1, temp);
</code></pre>

<p>æ‰“å°æ•ˆæœï¼š</p>

<pre><code>æ­¤æ¬¡äºŒè·¯å½’å¹¶åï¼Œå¾—åˆ°çš„åºåˆ—ä¸ºï¼š(6, 202, 100, 301, 38, 8, 1)
æ­¤æ¬¡äºŒè·¯å½’å¹¶åï¼Œå¾—åˆ°çš„åºåˆ—ä¸ºï¼š(6, 202, 100, 301, 38, 8, 1)
æ­¤æ¬¡äºŒè·¯å½’å¹¶åï¼Œå¾—åˆ°çš„åºåˆ—ä¸ºï¼š(6, 100, 202, 301, 38, 8, 1)
æ­¤æ¬¡äºŒè·¯å½’å¹¶åï¼Œå¾—åˆ°çš„åºåˆ—ä¸ºï¼š(6, 100, 202, 301, 8, 38, 1)
æ­¤æ¬¡äºŒè·¯å½’å¹¶åï¼Œå¾—åˆ°çš„åºåˆ—ä¸ºï¼š(6, 100, 202, 301, 1, 8, 38)
æ­¤æ¬¡äºŒè·¯å½’å¹¶åï¼Œå¾—åˆ°çš„åºåˆ—ä¸ºï¼š(1, 6, 8, 38, 100, 202, 301)
</code></pre>

<p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œæœç„¶ä¸æˆ‘ä»¬å‰é¢çš„ç®—æ³•åˆ†ææ˜¯ä¸€æ ·çš„ã€‚</p>

<h2>æ’å…¥æ’åº</h2>

<p>æ’å…¥æ’åºæœ‰ä¸¤ç§ï¼š</p>

<pre><code>ç›´æ¥æ’å…¥æ’åº
æŠ˜åŠæ’å…¥æ’åº
</code></pre>

<p>åŸç†ï¼š</p>

<pre><code>ç¬¬ä¸€ä¸ªå…ƒç´ å°±è®¤ä¸ºæ˜¯æœ‰åºçš„
å–ç¬¬äºŒä¸ªå…ƒç´ ï¼Œåˆ¤æ–­æ˜¯å¦å¤§äºç¬¬ä¸€ä¸ªå…ƒç´ ã€‚è‹¥æ˜¯å¤§äºï¼Œè¡¨ç¤ºå·²ç»æœ‰åºï¼Œä¸ç”¨ç§»åŠ¨ï¼Œå¦åˆ™å°†å·²ç»æœ‰åºçš„åºåˆ—æ•´ä½“å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®
ä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å·²ç»æœ‰åºã€‚
</code></pre>

<p>ç›´æ¥æ’å…¥æ’åº</p>

<p>éœ€è¦åˆ°ä¸¤å±‚å¾ªç¯æ¥å¤„ç†ï¼Œå¤–å±‚å¾ªç¯ç”¨äºè·‘å¤šå°‘è¶Ÿï¼Œè€Œå†…å±‚å¾ªç¯ç”¨äºç§»åŠ¨å…ƒç´ ä½ç½®ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä»ä¸º O ( n2 )</p>

<p>ä¼ªä»£ç </p>

<pre><code>void insertSort(int a[], int len) {
  for i = 1; i &lt; len; ++i {     
     // åè€…&gt;å‰è€…ï¼Œæ‰éœ€è¦ç§»åŠ¨å’Œæ’å…¥
     if a[i] &lt; a[i - 1] {
        // è®°å½•ä¸‹è¦ç§»åŠ¨çš„å…ƒç´ 
        int target = a[i];

        // å°†å‰j-1ä¸ªæœ‰åºçš„å…ƒç´ åˆ†åˆ«åç§»ä¸€ä¸ªä½ç½®
        int j = i;
        while j &gt; 0 &amp;&amp; a[j - 1] &gt; target {
          a[j] = a[j - 1];
          j--;
        }

        // å°†ç›®æ ‡å…ƒç´ æ’å…¥å¯¹åº”çš„ä½ç½®ï¼Œä½¿ä¹‹æœ‰åº
        a[j] = target;
     }
  }
}
</code></pre>

<p>Cè¯­è¨€ç‰ˆ</p>

<pre><code>void insertSort(int a[], int len) {
  for (int i = 1; i &lt; len; ++i) {

    // é‡åˆ°ä¸æ˜¯æœ‰åºçš„ï¼Œæ‰è¿›å…¥ç§»åŠ¨å…ƒç´ 
    if (a[i] &lt; a[i - 1]) {
      int target = a[i];

      // ç§»åŠ¨å‰j-1å…ƒç´ ï¼Œåˆ†åˆ«å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®
      int j = i;
      while (j &gt; 0 &amp;&amp; a[j - 1] &gt; target) {
        a[j] = a[j - 1];

        j--;
      }

      // å°†ç›®æ ‡å…ƒç´ æ”¾åˆ°ç›®æ ‡ä½ç½®ï¼Œä½¿ä¹‹æœ‰åº
      a[j] = target;
    }
  }
}
</code></pre>

<p>OjbCç‰ˆ</p>

<pre><code>- (void)insertSort:(int[])a len:(int)len {
  for (int i = 1; i &lt; len; ++i) {

    // é‡åˆ°ä¸æ˜¯æœ‰åºçš„ï¼Œæ‰è¿›å…¥ç§»åŠ¨å…ƒç´ 
    if (a[i] &lt; a[i - 1]) {
      int target = a[i];

      // ç§»åŠ¨å‰j-1å…ƒç´ ï¼Œåˆ†åˆ«å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®
      int j = i;
      while (j &gt; 0 &amp;&amp; a[j - 1] &gt; target) {
        a[j] = a[j - 1];

        j--;
      }

      // å°†ç›®æ ‡å…ƒç´ æ”¾åˆ°ç›®æ ‡ä½ç½®ï¼Œä½¿ä¹‹æœ‰åº
      a[j] = target;
    }
  }
}
</code></pre>

<p>Swiftç‰ˆ</p>

<pre><code>func insertSort(var a: [Int]) -&gt;[Int] {
  for var i = 1; i &lt; a.count; ++i {
    if a[i] &lt; a[i - 1] {
      let target = a[i]

      var j = i
      while j &gt; 0 &amp;&amp; a[j - 1] &gt; target {
        a[j] = a[j - 1]

        j--
      }

      a[j] = target
    }
  }

  return a
}
</code></pre>

<p>æŠ˜åŠæ’å…¥æ’åº</p>

<p>ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹é€ä¸ªç½®å…¥ç›‘è§†å“¨ï¼Œä½¿ç”¨lowã€highæ ‡ç­¾è¿›è¡ŒæŠ˜åŠåˆ¤æ–­æ¯”è¾ƒå¤§å°ï¼Œå¹¶ç¡®è®¤æ’å…¥ä½ç½®ï¼Œè¯¥ä½ç½®åˆ°æœ€åä¸€ä¸ªæ•°å…¨éƒ¨åç§»ä¸€ä½ï¼Œç„¶åè…¾å‡ºè¯¥ä½ç½®ï¼ŒæŠŠç›‘è§†å“¨é‡Œé¢çš„æ•°ç½®å…¥è¯¥ä½ç½®ã€‚ä¾æ­¤ç±»æ¨è¿›è¡Œæ’åºï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ•°æ¯”è¾ƒå®Œæ¯•ã€‚
æ—¶é—´å¤æ‚åº¦</p>

<p>æŠ˜åŠæ’å…¥æ’åº, å³æŸ¥æ‰¾æ’å…¥ç‚¹çš„ä½ç½®, å¯ä»¥ä½¿ç”¨æŠ˜åŠæŸ¥æ‰¾ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ¯”è¾ƒçš„æ¬¡æ•°, ä½†æ˜¯ç§»åŠ¨çš„æ¬¡æ•°ä¸å˜ï¼Œå› æ­¤ï¼Œæ—¶é—´å¤æ‚åº¦ä»ä¸º O(n2) ;
ä¼ªä»£ç </p>

<pre><code>void binaryInsertSort(int a[], int len) {
  for int i = 2; i &lt; len; ++i {
     // å°†å…ƒç´ æ”¾åˆ°å“¨å…µçš„ä½ç½®
     a[0] = a[i];

     int low = 1;
     int high = i - 1;

     // æŠ˜åŠæŸ¥æ‰¾ä½ç½®
     while low &lt;= high {
        int mid = (low + high) / 2;

        // åœ¨ä½åŠåŒº
        if a[mid] &gt; a[0] {
          high = mid - 1;
        } else { // åœ¨é«˜åŠåŒº
          low = mid + 1;
        }
     }

     // å°†å‰i - 1ä¸ªå…ƒç´ åç§»
     // æ‰¾åˆ°highï¼Œé‚£ä¹ˆhigh+1å°±æ˜¯iè¦æ’å…¥çš„ä½ç½®  
     for int j = i - 1; j &gt;= high + 1; --j {
        a[j + 1] = a[j];
     }

     // å°†ä¸´æ—¶æ”¾åœ¨å²—å“¨çš„å…ƒç´ æ”¾åˆ°æ‰€æŸ¥æ‰¾åˆ°çš„ä½ç½®å¤„
     a[high + 1] = a[0];
  }
}
</code></pre>

<p>Cè¯­è¨€ç‰ˆ</p>

<pre><code>void binaryInsertSort(int a[], int len) {
  for (int i = 2; i &lt; len; ++i) {
    // ç¬¬ä¸€ä¸ªä½ç½®æ°¸è¿œåªæ˜¯å½“ä½œå“¨å…µç”¨
    a[0] = a[i];

    int low = 1;
    int high = i - 1;

    while (low &lt;= high) {
      int mid = (low + high) / 2;

      if (a[mid] &gt; a[0]) {
        high = mid - 1;
      } else {
        low = mid + 1;
      }
    }

    // ç§»åŠ¨å‰i - 1ä¸ªå…ƒç´ 
    for (int j = i - 1; j &gt;= high + 1; --j) {
      a[j + 1] = a[j];
    }

    // æ”¾åˆ°æŸ¥æ‰¾åˆ°çš„ä½ç½®å¤„
    a[high + 1] = a[0];
  }
}
</code></pre>

<p>Swiftç‰ˆ</p>

<pre><code>func binaryInsertSort(var a: [Int]) -&gt;[Int] {
  for var i = 2; i &lt; a.count; ++i {
    a[0] = a[i]

    var low = 1
    var high = i - 1
    while low &lt;= high {
      let mid = (low + high) / 2

      if a[mid] &gt; a[0] {
        high = mid - 1
      } else {
        low = mid + 1
      }
    }

    for var j = i - 1; j &gt;= high + 1; --j {
      a[j + 1] = a[j]
    }

    a[high + 1] = a[0]
  }

  return a
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-æ•°æ®ç»“æ„]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/15/xiu-xing-pian-shu-ju-jie-gou/"/>
    <updated>2016-08-15T12:30:55+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/15/xiu-xing-pian-shu-ju-jie-gou</id>
    <content type="html"><![CDATA[<p>æ¦‚å¿µï¼šæ•°æ®å…ƒç´ ç›¸äº’ä¹‹é—´çš„å…³ç³»ç§°ä¸ºç»“æ„ã€‚</p>

<p>æœ‰å››ç±»åŸºæœ¬ç»“æ„ï¼šé›†åˆã€çº¿æ€§ç»“æ„ã€æ ‘å½¢ç»“æ„ã€å›¾çŠ¶ç»“æ„;</p>

<ul>
<li><p>é›†åˆç»“æ„:é™¤äº†åŒå±äºä¸€ç§ç±»å‹å¤–ï¼Œåˆ«æ— å…¶å®ƒå…³ç³»</p></li>
<li><p>çº¿æ€§ç»“æ„:å…ƒç´ ä¹‹é—´å­˜åœ¨ä¸€å¯¹ä¸€å…³ç³»å¸¸è§ç±»å‹æœ‰: æ•°ç»„,é“¾è¡¨,é˜Ÿåˆ—,æ ˆ,å®ƒä»¬ä¹‹é—´åœ¨æ“ä½œä¸Šæœ‰æ‰€åŒºåˆ«.ä¾‹å¦‚:é“¾è¡¨å¯åœ¨ä»»æ„ä½ç½®æ’å…¥æˆ–åˆ é™¤å…ƒç´ ,è€Œé˜Ÿåˆ—åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ,é˜Ÿå¤´åˆ é™¤å…ƒç´ ,æ ˆåªèƒ½åœ¨æ ˆé¡¶è¿›è¡Œæ’
å…¥,åˆ é™¤æ“ä½œ.</p></li>
<li><p>æ ‘å½¢ç»“æ„:å…ƒç´ ä¹‹é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»,å¸¸è§ç±»å‹æœ‰:æ ‘(æœ‰è®¸å¤šç‰¹ä¾‹:äºŒå‰æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€æŸ¥æ‰¾æ ‘ç­‰)</p></li>
<li><p>å›¾å½¢ç»“æ„:å…ƒç´ ä¹‹é—´å­˜åœ¨å¤šå¯¹å¤šå…³ç³»,å›¾å½¢ç»“æ„ä¸­æ¯ä¸ªç»“ç‚¹çš„å‰é©±ç»“ç‚¹æ•°å’Œåç»­ç»“ç‚¹å¤šä¸ªæ•°å¯ä»¥ä»»æ„</p></li>
</ul>


<p>æ€»ç»“+å®æˆ˜+æ–¹æ¡ˆ</p>

<ol>
<li>å †</li>
<li>æ ˆ</li>
<li>æ ‘ï¼ˆäºŒå‰æ ‘ï¼‰</li>
<li>å›¾</li>
<li>é˜Ÿåˆ—ï¼ˆå¾ªç¯é˜Ÿåˆ—ï¼‰</li>
<li>è¡¨ï¼ˆå•é“¾è¡¨ï¼Œçº¿æ€§è¡¨ï¼Œhashè¡¨ï¼‰</li>
</ol>


<!--more-->


<h2>å †</h2>

<blockquote><p>å †(heap)åˆè¢«ä¸ºä¼˜å…ˆé˜Ÿåˆ—(priority queue)ã€‚</p></blockquote>

<p>å°½ç®¡åä¸ºä¼˜å…ˆé˜Ÿåˆ—ï¼Œä½†å †å¹¶ä¸æ˜¯é˜Ÿåˆ—ã€‚å›å¿†ä¸€ä¸‹ï¼Œåœ¨é˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œçš„é™å®šæ“ä½œæ˜¯dequeueå’Œenqueueã€‚dequeueæ˜¯æŒ‰ç…§è¿›å…¥é˜Ÿåˆ—çš„å…ˆåé¡ºåºæ¥å–å‡ºå…ƒç´ ã€‚è€Œåœ¨å †ä¸­ï¼Œæˆ‘ä»¬ä¸æ˜¯æŒ‰ç…§å…ƒç´ è¿›å…¥é˜Ÿåˆ—çš„å…ˆåé¡ºåºå–å‡ºå…ƒç´ çš„ï¼Œè€Œæ˜¯æŒ‰ç…§å…ƒç´ çš„ä¼˜å…ˆçº§å–å‡ºå…ƒç´ ã€‚</p>

<ul>
<li><p>å †æ˜¯å®ç°è°ƒåº¦å™¨(Linux:ä½¿ç”¨niceæ§åˆ¶)çš„ç†æƒ³æ•°æ®ç»“æ„ã€‚</p></li>
<li><p>æ’å…¥å…ƒç´ ï¼Œåˆ é™¤æœ€å¤§ä¼˜å…ˆçº§å…ƒç´ </p></li>
<li><p>å †çš„ä¸€ä¸ªç»å…¸çš„å®ç°æ˜¯å®Œå…¨äºŒå‰æ ‘(complete binary tree)ã€‚è¿™æ ·å®ç°çš„å †æˆä¸ºäºŒå‰å †(binary heap)ã€‚</p></li>
</ul>


<p>å®Œå…¨äºŒå‰æ ‘æ˜¯å¢åŠ äº†é™å®šæ¡ä»¶çš„äºŒå‰æ ‘ã€‚å‡è®¾ä¸€ä¸ªäºŒå‰æ ‘çš„æ·±åº¦ä¸ºnã€‚ä¸ºäº†æ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„è¦æ±‚ï¼Œè¯¥äºŒå‰æ ‘çš„å‰n-1å±‚å¿…é¡»å¡«æ»¡ï¼Œç¬¬nå±‚ä¹Ÿå¿…é¡»æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºè¢«å¡«æ»¡</p>

<h2>æ ˆ</h2>

<blockquote><p>ç‰¹æ€§ï¼šåè¿›å…ˆå‡º</p></blockquote>

<h6>æ³¨æ„ï¼šå¦‚æœæ ˆä¸ºç©ºçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´ä¸‹æº¢</h6>

<p>æ ˆä¸­çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºä¸€ä¸ªframeã€‚è€Œæœ€ä¸Šå±‚å…ƒç´ ç§°ä¸ºtop frameã€‚æ ˆåªæ”¯æŒä¸‰ä¸ªæ“ä½œï¼Œ pop, top, pushã€‚</p>

<pre><code>popå–å‡ºæ ˆä¸­æœ€ä¸Šå±‚å…ƒç´ (8)ï¼Œæ ˆçš„æœ€ä¸Šå±‚å…ƒç´ å˜ä¸ºæ—©å…ˆè¿›å…¥çš„å…ƒç´ (9)ã€‚

topæŸ¥çœ‹æ ˆçš„æœ€ä¸Šå±‚å…ƒç´ (8)ã€‚

pushå°†ä¸€ä¸ªæ–°çš„å…ƒç´ (5)æ”¾åœ¨æ ˆçš„æœ€ä¸Šå±‚ã€‚
</code></pre>

<p>å®ç°æ–¹å¼</p>

<ul>
<li>æ•°ç»„å®ç°ï¼šéœ€è¦ä¸€ä¸ªå˜é‡æ¥æ ‡è®°æ ˆé¡¶ä½ç½®</li>
<li>é“¾è¡¨å®ç°ï¼šæ’å…¥å…ƒç´ æ—¶å¯¹è¡¨å¤´æ“ä½œéœ€è¦æ³¨æ„</li>
</ul>


<p>å¸¸è§é¢˜ç›®</p>

<ul>
<li>æ‹¬å·åŒ¹é…</li>
<li>ç¿»è½¬å­—ç¬¦ä¸²</li>
<li>æ¨¡æ‹Ÿé€’å½’ï¼ˆNçš‡åé—®é¢˜ï¼‰</li>
</ul>


<p>æ ˆæœ€ç»å…¸çš„è®¡ç®—æœºåº”ç”¨æ˜¯å‡½æ•°è°ƒç”¨ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆï¼Œæ¯ä¸ªframeä¸­è®°å½•äº†è°ƒç”¨å‡½æ•°çš„å‚æ•°ï¼Œè‡ªåŠ¨å˜é‡å’Œè¿”å›åœ°å€ã€‚å½“è¯¥å‡½æ•°è°ƒç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°æ—¶ï¼Œæ ˆä¸­ä¼š pushä¸€ä¸ªframeã€‚å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•è¿”å›æ—¶ï¼Œè¯¥frameä¼špopï¼Œä»è€Œè¿›å…¥è°ƒç”¨è¯¥å‡½æ•°çš„åŸå‡½æ•°ï¼Œç»§ç»­æ‰§è¡Œ</p>

<p>+ç”±äºæ ˆæ˜¯é™å®šäº†æ“ä½œçš„æœ‰åºçš„å…ƒç´ é›†åˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ—¢å¯ä»¥åœ¨æ•°ç»„çš„åŸºç¡€ä¸Šæ¥å®ç°æ ˆï¼Œä¹Ÿå¯ä»¥åœ¨è¡¨çš„åŸºç¡€ä¸Šæ¥å®ç°æ ˆã€‚å¦‚æœä½¿ç”¨æ•°ç»„æ¥å®ç°æ ˆï¼Œæˆ‘ä»¬éœ€è¦é¢„ç•™å……è¶³çš„ç©ºé—´ä¾›æ ˆä½¿ç”¨ï¼Œå¹¶éœ€è¦ä¸€ä¸ªä¸‹æ ‡æ¥è®°å½•æœ€ä¸Šå±‚å…ƒç´ çš„ä½ç½®</p>

<h2>æ ‘</h2>

<blockquote><p>æ ‘(Tree)æ˜¯å…ƒç´ çš„é›†åˆ</p></blockquote>

<p>ä¸¥æ ¼çš„å®šä¹‰æ ‘çš„æ–¹æ³•ï¼š</p>

<ol>
<li><p>æ ‘æ˜¯å…ƒç´ çš„é›†åˆã€‚</p></li>
<li><p>è¯¥é›†åˆå¯ä»¥ä¸ºç©ºã€‚è¿™æ—¶æ ‘ä¸­æ²¡æœ‰å…ƒç´ ï¼Œæˆ‘ä»¬ç§°æ ‘ä¸ºç©ºæ ‘ (empty tree)ã€‚</p></li>
<li><p>å¦‚æœè¯¥é›†åˆä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¯¥é›†åˆæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œä»¥åŠ0ä¸ªæˆ–è€…å¤šä¸ªå­æ ‘ã€‚æ ¹èŠ‚ç‚¹ä¸å®ƒçš„å­æ ‘çš„æ ¹èŠ‚ç‚¹ç”¨ä¸€ä¸ªè¾¹(edge)ç›¸è¿ã€‚</p></li>
</ol>


<p>ä¸Šé¢çš„ç¬¬ä¸‰ç‚¹æ˜¯ä»¥é€’å½’çš„æ–¹å¼æ¥å®šä¹‰æ ‘ï¼Œä¹Ÿå°±æ˜¯åœ¨å®šä¹‰æ ‘çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†æ ‘è‡ªèº«(å­æ ‘)ã€‚ç”±äºæ ‘çš„é€’å½’ç‰¹å¾ï¼Œè®¸å¤šæ ‘ç›¸å…³çš„æ“ä½œä¹Ÿå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨é€’å½’å®ç°</p>

<ul>
<li><p>äºŒå‰æ ‘(binary)æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘ã€‚äºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªèƒ½æœ‰2ä¸ªå­èŠ‚ç‚¹</p></li>
<li><p>äºŒå‰æœç´¢æ ‘(binary search tree)çš„ç‰¹æ®ŠäºŒå‰æ ‘ã€‚äºŒå‰æœç´¢æ ‘è¦æ±‚ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸æ¯”å®ƒå·¦å­æ ‘çš„ä»»æ„å…ƒç´ å°ï¼Œè€Œä¸”ä¸æ¯”å®ƒçš„å³å­æ ‘çš„ä»»æ„å…ƒç´ å¤§</p>

<p>  å‰æœç´¢æ ‘å¯ä»¥æ–¹ä¾¿çš„å®ç°æœç´¢ç®—æ³•ã€‚åœ¨æœç´¢å…ƒç´ xçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°†xå’Œæ ¹èŠ‚ç‚¹æ¯”è¾ƒ:</p>

<ol>
<li><p>å¦‚æœxç­‰äºæ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ‰¾åˆ°xï¼Œåœæ­¢æœç´¢ (ç»ˆæ­¢æ¡ä»¶)</p></li>
<li><p>å¦‚æœxå°äºæ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœç´¢å·¦å­æ ‘</p></li>
<li><p>å¦‚æœxå¤§äºæ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœç´¢å³å­æ ‘</p></li>
</ol>


<p>  äºŒå‰æœç´¢æ ‘æ‰€éœ€è¦è¿›è¡Œçš„æ“ä½œæ¬¡æ•°æœ€å¤šä¸æ ‘çš„æ·±åº¦ç›¸ç­‰ã€‚nä¸ªèŠ‚ç‚¹çš„äºŒå‰æœç´¢æ ‘çš„æ·±åº¦æœ€å¤šä¸ºnï¼Œæœ€å°‘ä¸ºlog(n)ã€‚</p></li>
</ul>


<h2>å›¾</h2>

<p>å›¾(graph)æ˜¯ä¸€ç§æ¯”è¾ƒæ¾æ•£çš„æ•°æ®ç»“æ„ã€‚å®ƒæœ‰ä¸€äº›èŠ‚ç‚¹(vertice)ï¼Œåœ¨æŸäº›èŠ‚ç‚¹ä¹‹é—´ï¼Œç”±è¾¹(edge)ç›¸è¿ã€‚èŠ‚ç‚¹çš„æ¦‚å¿µåœ¨æ ‘ä¸­ä¹Ÿå‡ºç°è¿‡ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨èŠ‚ç‚¹ä¸­å‚¨å­˜æ•°æ®ã€‚è¾¹è¡¨ç¤ºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å­˜åœ¨å…³ç³»ã€‚åœ¨æ ‘ä¸­ï¼Œæˆ‘ä»¬ç”¨è¾¹æ¥è¡¨ç¤ºå­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å½’å±å…³ç³»ã€‚æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„å›¾ï¼Œä½†é™åˆ¶æ€§æ›´å¼ºä¸€äº›</p>

<ul>
<li>å®šä¹‰ï¼šå›¾G=(V,E)æ˜¯ç”±èŠ‚ç‚¹çš„é›†åˆVå’Œè¾¹çš„é›†åˆEæ„æˆçš„ã€‚ä¸€ä¸ªå›¾çš„æ‰€æœ‰èŠ‚ç‚¹æ„æˆä¸€ä¸ªé›†åˆVã€‚ä¸€ä¸ªè¾¹å¯ä»¥è¡¨ç¤ºä¸º(v1,v2)ï¼Œå…¶ä¸­v1,v2âˆˆVï¼Œå³ä¸¤ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœ(v1,v2)æœ‰åºï¼Œå³(v1,v2)ä¸(v2,v1)ä¸åŒï¼Œé‚£ä¹ˆå›¾æ˜¯æœ‰å‘çš„(directed)ã€‚æœ‰åºçš„è¾¹å¯ä»¥ç†è§£ä¸ºå•è¡Œé“ï¼Œåªèƒ½æ²¿ä¸€ä¸ªæ–¹å‘è¡Œè¿›ã€‚å¦‚æœ(v1,v2)æ— åºï¼Œé‚£ä¹ˆå›¾æ˜¯æ— å‘çš„(undirected)ã€‚æ— åºçš„è¾¹å¯ä»¥ç†è§£æˆåŒå‘éƒ½å¯ä»¥è¡Œè¿›çš„é“è·¯ã€‚ä¸€ä¸ªæ— åºçš„è¾¹å¯ä»¥çœ‹ä½œè¿æ¥ç›¸åŒèŠ‚ç‚¹çš„ä¸¤ä¸ªåå‘çš„æœ‰åºè¾¹ï¼Œæ‰€ä»¥æ— å‘å›¾å¯ä»¥ç†è§£ä¸ºæœ‰å‘å›¾çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ</li>
</ul>


<p>ä¸€ç§ç®€å•çš„å®ç°å›¾çš„æ–¹æ³•æ˜¯ä½¿ç”¨äºŒç»´æ•°ç»„</p>

<blockquote><p>å›¾çš„ç»„ç»‡æ–¹å¼æ¯”è¾ƒæ¾æ•£ï¼Œè‡ªç”±åº¦æ¯”è¾ƒå¤§ï¼Œä½†ä¹Ÿé€ æˆæ¯”è¾ƒé«˜çš„ç®—æ³•å¤æ‚åº¦</p></blockquote>

<h2>é˜Ÿåˆ—</h2>

<blockquote><p>é˜Ÿåˆ—æœ€å¤§çš„ç‰¹å¾æ˜¯First In, First Out (FIFOï¼Œå…ˆè¿›å…ˆå‡º)</p></blockquote>

<p>é˜Ÿåˆ—(queue)æ˜¯ä¸€ä¸ªç®€å•è€Œå¸¸è§çš„æ•°æ®ç»“æ„ã€‚é˜Ÿåˆ—ä¹Ÿæ˜¯æœ‰åºçš„å…ƒç´ é›†åˆã€‚</p>

<ul>
<li>é˜Ÿé¦–çš„å…ƒç´ ç¦»å¼€é˜Ÿåˆ—(dequeue)ï¼Œå’Œæ–°å…ƒç´ åŠ å…¥é˜Ÿå°¾(enqueue)ã€‚</li>
</ul>


<p>åº”ç”¨</p>

<ul>
<li>ä¸€ä¸ªç»å…¸çš„åº”ç”¨æ˜¯æ¶ˆæ¯é˜Ÿåˆ—(å‚è€ƒLinuxè¿›ç¨‹é—´é€šä¿¡)ï¼Œå®é™…ä¸Šå°±æ˜¯åˆ©ç”¨é˜Ÿåˆ—æ¥åˆ†é…æœ‰é™çš„è¿›ç¨‹ã€‚</li>
<li>è¿˜æœ‰FIFOæ–‡ä»¶(å“¦ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ–‡ä»¶å«åšFIFOï¼Œè‚¯å®šæ˜¯å’Œé˜Ÿåˆ—æœ‰å…³)ï¼Œç”¨ä»¥å®ç°ç®¡é“ä¼ è¾“ã€‚</li>
<li>å†æ¯”å¦‚ï¼Œæˆ‘ä»¬å°†å¤šä¸ªæ‰“å°ä»»åŠ¡å‘é€ç»™æ‰“å°æœºï¼Œæ‰“å°æœºä¹Ÿæ˜¯ä½¿ç”¨é˜Ÿåˆ—æ¥å®‰æ’ä»»åŠ¡çš„é¡ºåº</li>
</ul>


<p>å’Œæ ˆç›¸ä¼¼ï¼Œé˜Ÿåˆ—ä¹Ÿå¯ä»¥æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œè¿™é‡Œæ˜¯åŸºäºå•é“¾è¡¨çš„å®ç°ã€‚</p>

<p>ä¸è¡¨(list)ä¸­çš„å®ç°æ–¹å¼ç•¥æœ‰ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„head nodeæœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ª(next)æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ª(end)æŒ‡å‘é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯æ–¹ä¾¿æˆ‘ä»¬æ‰¾åˆ°é˜Ÿå°¾ï¼Œä»¥æ–¹ä¾¿çš„è¿›è¡Œenqueueæ“ä½œã€‚æˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„è¡¨ï¼Œåœ¨éœ€è¦æ‰¾åˆ°é˜Ÿå°¾çš„æ—¶å€™éå†æœç´¢åˆ°æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p>

<h2>è¡¨</h2>

<blockquote><p>å†…å­˜ä¸­ç¦»æ•£åˆ†å¸ƒçš„æœ‰åºèŠ‚ç‚¹</p></blockquote>

<p>è¡¨(list)æ˜¯å¸¸è§çš„æ•°æ®ç»“æ„ã€‚ä»æ•°å­¦ä¸Šæ¥è¯´ï¼Œè¡¨æ˜¯ä¸€ä¸ªæœ‰åºçš„å…ƒç´ é›†åˆã€‚åœ¨Cè¯­è¨€çš„å†…å­˜ä¸­ï¼Œè¡¨å‚¨å­˜ä¸ºåˆ†æ•£çš„èŠ‚ç‚¹(node)ã€‚æ¯ä¸ªèŠ‚ç‚¹åŒ…å«æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ª(æˆ–è€…ä¸Šä¸€ä¸ª)å…ƒç´ çš„æŒ‡é’ˆ</p>

<p>å›¾ä¸­çš„è¡¨ä¸­æœ‰å››ä¸ªèŠ‚ç‚¹ã€‚ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹(head node)ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸ç”¨äºå‚¨å­˜å…ƒç´ ï¼Œåªç”¨äºæ ‡æ˜è¡¨çš„èµ·å§‹ã€‚å¤´èŠ‚ç‚¹å¯ä»¥è®©æˆ‘ä»¬æ–¹ä¾¿çš„æ’å…¥æˆ–è€…åˆ é™¤è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ•´ä¸ªè¡¨ä¸­åŒ…å«æœ‰ä¸‰ä¸ªå…ƒç´ (5ï¼Œ 2ï¼Œ 15)ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆä¸ºNULLï¼Œæˆ‘ä»¬ç”¨â€œæ¥åœ°â€æ¥å›¾ç¤ºè¯¥æŒ‡é’ˆã€‚</p>

<ul>
<li><p>è¡¨çš„åŠŸèƒ½ä¸æ•°ç»„(array)å¾ˆç±»ä¼¼ï¼Œæ•°ç»„ä¹Ÿæ˜¯æœ‰åºçš„å…ƒç´ é›†åˆï¼Œä½†æ•°ç»„åœ¨å†…å­˜ä¸­ä¸ºä¸€æ®µè¿ç»­å†…å­˜ï¼Œè€Œè¡¨çš„æ¯ä¸ªèŠ‚ç‚¹å æ®çš„å†…å­˜å¯ä»¥æ˜¯ç¦»æ•£çš„ã€‚åœ¨æ•°ç»„ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è·³è¿‡å›ºå®šçš„å†…å­˜é•¿åº¦æ¥å¯»æ‰¾æŸä¸ªç¼–å·çš„å…ƒç´ ã€‚ä½†åœ¨è¡¨ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»æ²¿ç€æŒ‡é’ˆè”ç³»èµ·çš„é•¿é“¾ï¼Œéå†æŸ¥è¯¢å…ƒç´ ã€‚æ­¤å¤–ï¼Œæ•°ç»„æœ‰å›ºå®šçš„å¤§å°ï¼Œè¡¨å¯ä»¥æ ¹æ®è¿è¡Œæƒ…å†µæ’å…¥æˆ–è€…åˆ é™¤èŠ‚ç‚¹ï¼ŒåŠ¨æ€çš„æ›´æ”¹å¤§å°ã€‚è¡¨æ’å…¥èŠ‚ç‚¹æ—¶éœ€è¦ä»è¿›ç¨‹ç©ºé—´çš„å †ä¸­å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œç”¨ä»¥å‚¨å­˜èŠ‚ç‚¹ã€‚åˆ é™¤èŠ‚ç‚¹å¯ä»¥å°†èŠ‚ç‚¹å æ®çš„å†…å­˜å½’è¿˜ç»™è¿›ç¨‹ç©ºé—´</p></li>
<li><p>è¡¨æœ‰å¤šç§å˜ç§ã€‚ä¸Šé¢çš„è¡¨ä¸­ï¼ŒæŒ‡é’ˆæŒ‡å‘æ˜¯ä»å‰å‘åçš„ï¼Œç§°ä¸ºå•å‘é“¾è¡¨(linked list)ã€‚</p></li>
<li>è¿˜æœ‰åŒå‘é“¾è¡¨(double-linked list)ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªæŒ‡å‘å‰é¢ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆã€‚</li>
<li>ä»¥åŠå¾ªç¯é“¾è¡¨(tabular list)ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆå¹¶ä¸ä¸ºNULLï¼Œè€Œæ˜¯æŒ‡å‘å¤´èŠ‚ç‚¹ã€‚ä¸åŒç±»å‹çš„é“¾è¡¨æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚</li>
</ul>


<p>ä¸€ä¸ªæ•°æ®ç»“æ„çš„å®ç°æœ‰ä¸¤æ–¹é¢:</p>

<ol>
<li>æ•°æ®ç»“æ„çš„å†…å­˜è¡¨è¾¾æ–¹å¼;</li>
<li>å®šä¹‰åœ¨è¯¥æ•°æ®ç»“æ„ä¸Šçš„æ“ä½œã€‚</li>
</ol>


<p>æˆ‘ä»¬è¿™é‡Œå®ç°æœ€ç®€å•çš„å•å‘é“¾è¡¨</p>

<h2>å“ˆå¸Œè¡¨</h2>

<p>å“ˆå¸Œè¡¨(hash table)æ˜¯ä»ä¸€ä¸ªé›†åˆAåˆ°å¦ä¸€ä¸ªé›†åˆBçš„æ˜ å°„(mapping)ã€‚æ˜ å°„æ˜¯ä¸€ç§å¯¹åº”å…³ç³»ï¼Œè€Œä¸”é›†åˆAçš„æŸä¸ªå…ƒç´ åªèƒ½å¯¹åº”é›†åˆBä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚ä½†åè¿‡æ¥ï¼Œé›†åˆBä¸­çš„ä¸€ä¸ªå…ƒç´ å¯èƒ½å¯¹åº”å¤šä¸ªé›†åˆAä¸­çš„å…ƒç´ ã€‚å¦‚æœBä¸­çš„å…ƒç´ åªèƒ½å¯¹åº”Aä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ ·çš„æ˜ å°„è¢«ç§°ä¸ºä¸€ä¸€æ˜ å°„</p>

<p>hashåªè¦æ±‚ä»Aåˆ°Bçš„å¯¹åº”ä¸ºä¸€ä¸ªæ˜ å°„ï¼Œå®ƒå¹¶æ²¡æœ‰é™å®šè¯¥å¯¹åº”å…³ç³»ä¸ºä¸€ä¸€æ˜ å°„ã€‚</p>

<ul>
<li>å› æ­¤ä¼šæœ‰è¿™æ ·çš„å¯èƒ½ï¼šä¸¤ä¸ªä¸åŒçš„é”®å€¼å¯¹åº”åŒä¸€ä¸ªhashå€¼ã€‚è¿™ç§æƒ…å†µå«åšhashç¢°æ’(hash collision)ã€‚</li>
<li>æ¯”å¦‚ç½‘ç»œåè®®ä¸­çš„checksumå°±å¯èƒ½å‡ºç°è¿™ç§çŠ¶å†µï¼Œå³æ‰€è¦æ ¡éªŒçš„å†…å®¹ä¸åŸæ–‡å¹¶ä¸åŒï¼Œä½†ä¸åŸæ–‡ç”Ÿæˆçš„checksum(hashå€¼)ç›¸åŒã€‚</li>
<li>å†æ¯”å¦‚ï¼ŒMD5ç®—æ³•å¸¸ç”¨æ¥è®¡ç®—å¯†ç çš„hashå€¼ã€‚å·²ç»æœ‰å®éªŒè¡¨æ˜ï¼ŒMD5ç®—æ³•æœ‰å¯èƒ½å‘ç”Ÿç¢°æ’ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„æ˜æ–‡å¯†ç ç”Ÿæˆç›¸åŒçš„hashå€¼ï¼Œè¿™å°†ç»™ç³»ç»Ÿå¸¦æ¥å¾ˆå¤§çš„å®‰å…¨æ¼æ´</li>
</ul>


<p>hashè¡¨è¢«å¹¿æ³›çš„ç”¨äºæœç´¢ï¼ˆåŒºåˆ«å»æ•°ç»„ï¼šéå†æ•´æ•°ç»„ï¼Œç®—æ³•å¤æ‚åº¦ä¸ºnï¼‰ï¼Œç®—æ³•å¤æ‚åº¦ä¸º1</p>

<pre><code>æ•°ç»„è™½ç„¶å¯ä»¥éšæœºè¯»å–ï¼Œä½†æ•°ç»„ä¸‹æ ‡æ˜¯éšæœºçš„ï¼Œå®ƒä¸å…ƒç´ å€¼æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€æ¬¡è®¿é—®å„ä¸ªå…ƒç´ ã€‚é€šè¿‡hashå‡½æ•°ï¼Œæˆ‘ä»¬é™å®šäº†æ¯ä¸ªä¸‹æ ‡ä½ç½®å¯èƒ½å­˜å‚¨çš„å…ƒç´ ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åˆ©ç”¨é”®å€¼å’Œhashå‡½æ•°ï¼Œå°±å¯ä»¥å…·å¤‡ç›¸å½“çš„å…ˆéªŒçŸ¥è¯†ï¼Œæ¥é€‰æ‹©é€‚å½“çš„ä¸‹æ ‡è¿›è¡Œæœç´¢ã€‚åœ¨æ²¡æœ‰hashç¢°æ’çš„å‰æä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦é€‰æ‹©ä¸€æ¬¡ï¼Œå°±å¯ä»¥ä¿è¯è¯¥ä¸‹æ ‡æŒ‡å‘çš„å…ƒç´ æ˜¯æˆ‘ä»¬æƒ³è¦çš„å…ƒç´ 
</code></pre>

<p>hashå‡½æ•°éœ€è¦è§£å†³hashå†²çªçš„é—®é¢˜ã€‚</p>

<pre><code>æ¯”å¦‚ï¼Œä¸Šé¢çš„hashå‡½æ•°ä¸­ï¼Œ"Obama"å’Œ"Oaamb"æœ‰ç›¸åŒçš„hashå€¼ä¸€ä¸ªæ–¹æ¡ˆæ˜¯å°†å‘ç”Ÿå†²çªçš„è®°å½•ç”¨é“¾è¡¨å‚¨å­˜èµ·æ¥ï¼Œè®©hashå€¼æŒ‡å‘è¯¥é“¾è¡¨ï¼Œè¿™å«åšopen hashing:
</code></pre>

<ul>
<li><p>æˆ‘ä»¬åœ¨æœç´¢çš„æ—¶å€™ï¼Œå…ˆæ ¹æ®hashå€¼æ‰¾åˆ°é“¾è¡¨ï¼Œå†æ ¹æ®keyå€¼éå†æœç´¢é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°è®°å½•ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å…¶ä»–æ•°æ®ç»“æ„ä»£æ›¿é“¾è¡¨ã€‚</p></li>
<li><p>open hashingéœ€è¦ä½¿ç”¨æŒ‡é’ˆã€‚æˆ‘ä»¬æœ‰æ—¶å€™æƒ³è¦é¿å…ä½¿ç”¨æŒ‡é’ˆï¼Œä»¥ä¿æŒéšæœºå­˜å‚¨çš„ä¼˜åŠ¿ï¼Œæ‰€ä»¥é‡‡ç”¨closed hashingçš„æ–¹å¼æ¥è§£å†³å†²çªã€‚ï¼ˆclosed hashingçš„å…³é”®åœ¨å¦‚ä½•æ¢æµ‹ä¸‹ä¸€ä¸ªä½ç½®ï¼‰</p></li>
</ul>


<hr />

<p>è¯´åœ¨æœ€å
ä¸€ã€æ ˆï¼š</p>

<pre><code>1ã€åç¼€è¡¨è¾¾å¼çš„æ±‚å€¼ï¼› 
2ã€ä¸­ç¼€åˆ°åç¼€è¡¨è¾¾å¼çš„è½¬æ¢ï¼› 
3ã€æ·±åº¦ä¼˜å…ˆæœç´¢çš„éé€’å½’å®ç°ï¼› 
4ã€åŠ¨æ€è§„åˆ’çš„ä¼˜åŒ–ï¼šç”¨äºç»´æŠ¤ä¸€ä¸ªå‡¸åºåˆ—ï¼Œä¾¿äºäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚LISé—®é¢˜çš„O(nlgn)ç®—æ³•ã€‚ 
</code></pre>

<p>äºŒã€é˜Ÿåˆ—ï¼š</p>

<pre><code>1ã€æ ‘çš„å±‚åºéå†ï¼› 
2ã€å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼› 
3ã€Bellman-Fordç®—æ³•çš„SPFAå®ç°ï¼› 
4ã€ç½‘ç»œæµä¸­FFç®—æ³•çš„Edmonds-Karpå®ç°ï¼Œä»¥åŠPreflowç®—æ³•çš„é˜Ÿåˆ—ä¼˜åŒ–å®ç°ã€‚ 
</code></pre>

<p>ä¸‰ã€äºŒå‰æœç´¢æ ‘ï¼š</p>

<pre><code>1ã€å¯¹å¤§é‡çš„å…³é”®å­—çš„ç´¢å¼•æŸ¥æ‰¾ï¼› 
2ã€æœ‰å¾ˆå¤šå¹³è¡¡ç­–ç•¥ä»¥æ”¹å–„å…¶å¹³å‡æ€§èƒ½ï¼š 
</code></pre>

<p>å¸¸ç”¨å¹³è¡¡æ ‘ï¼šAVLï¼Œçº¢é»‘æ ‘ï¼ŒéšæœºåŒ–BSTï¼ŒSplay Treeï¼ŒTreapï¼ˆæˆ–å«ç¬›å¡å„¿æ ‘ï¼‰ã€‚</p>

<p>å››ã€æ•£åˆ—è¡¨ï¼ˆhashè¡¨ï¼‰ï¼š</p>

<pre><code>1ã€ä¸€èˆ¬é’ˆå¯¹å€¼åŸŸè¾ƒå¤§ä½†çŠ¶æ€å¾ˆç¨€ç–çš„åº”ç”¨ï¼Œæ¯”å¦‚çŠ¶æ€å‹ç¼©è®°å¿†åŒ–æœç´¢ï¼› 
2ã€å®ç°æ˜ å°„åŠŸèƒ½ã€‚ 
</code></pre>

<p>äº”ã€æ£€ç´¢æ ‘ï¼ˆTrieï¼‰ï¼š</p>

<pre><code>1ã€ä¸€èˆ¬ç”¨äºå­—ç¬¦ä¸²ç´¢å¼•ç®—æ³•ï¼Œé€Ÿåº¦å¿«ï¼Œä½†å ç”¨ç©ºé—´è¾ƒå¤§ï¼ˆç›¸å¯¹hashï¼‰ï¼› 
2ã€å¸¸ç”¨çš„æ”¹è¿›ç»“æ„ï¼šPatriciaçº¿ç´¢æ ‘ï¼Œå¤šå‰æ£€ç´¢æ ‘ï¼ˆTSTï¼‰ã€‚ 
</code></pre>

<p>å…­ã€ä¼˜å…ˆé˜Ÿåˆ—ï¼š</p>

<pre><code>1ã€å¸¸ç”¨çš„æ˜¯äºŒå‰å †çš„å®ç°ï¼Œå…·ä½“åº”ç”¨å¦‚å †æ’åºå’ŒDijkstraç®—æ³•ï¼› 
2ã€å½“éœ€è¦å¿«é€Ÿåˆå¹¶ä¸¤ä¸ªä¼˜å…ˆé˜Ÿåˆ—æ—¶ï¼Œå¸¸ç”¨äºŒé¡¹å¼é˜Ÿåˆ—ï¼Œå®ç°ç®€å•ã€‚ 
3ã€æ³¨æ„æœ€å¤§æœ€å°å †çš„é…å¯¹ä½¿ç”¨ã€‚ 
</code></pre>

<p>ä¸ƒã€çº¿æ®µæ ‘å’Œæ ‘çŠ¶æ•°ç»„ï¼š</p>

<pre><code>1ã€ä¸¤è€…éƒ½å¯ä»¥ç”¨äºç¦»æ•£å¯¹è±¡çš„ç»Ÿè®¡ï¼› 
2ã€åè€…çš„æ­¥è¿›å‡½æ•°çš„æ€§è´¨å’Œåº”ç”¨å€¼å¾—æ³¨æ„ï¼› 
3ã€å‰è€…åŸºæœ¬ä¸Šé€‚ç”¨äºä»»ä½•çš„åŒºé—´æ“ä½œï¼Œå¦‚æ±‚åŒºé—´æœ€å€¼ï¼Œæ”¹å˜åŒºé—´çš„å€¼ç­‰ã€‚ 
4ã€çº¿æ®µæ ‘è¿˜å¯ä»¥ç”¨äºä¼˜åŒ–çŠ¶æ€çš„æšä¸¾ï¼Œç»å¸¸å’ŒåŠ¨æ€è§„åˆ’ç»“åˆã€‚ 
</code></pre>

<p>å…«ã€åç¼€æ ‘ä¸åç¼€æ•°ç»„ï¼š</p>

<pre><code>1ã€æ€»ä½“è§„å¾‹æ˜¯ä¸¤è€…çš„å®ç°éƒ½æ¯”è¾ƒå¤æ‚ï¼Œå‰è€…æ›´ç”šï¼Œä½†æ˜¯å‰è€…çš„åŠŸèƒ½ä¹Ÿæ›´å¼ºå¤§ï¼› 
2ã€å‡ ä¹å¯ä»¥è§£å†³æ‰€æœ‰å¸¸è§çš„å…³äºå­—ç¬¦ä¸²çš„ç®—æ³•ï¼Œå¦‚æœ€é•¿å›æ–‡å­ä¸²ï¼Œæœ€é•¿é‡å¤å­ä¸²ï¼Œä»¥åŠå¾ˆå¤šçš„æ¨¡å¼åŒ¹é…é—®é¢˜ã€‚ 
</code></pre>

<p>ä¹ã€å¹¶æŸ¥é›†ï¼š</p>

<pre><code>1ã€è§£å†³æ— å‘å›¾çš„è¿é€šæ€§é—®é¢˜ï¼Œå¦‚ç”¨äºKruskalç®—æ³•ï¼› 
2ã€è§£å†³ç­‰ä»·å…³ç³»çš„æŸ¥è¯¢ï¼ˆè¿™æ˜¯å®ƒçš„ä¸»è¦ç”¨æ­¦ä¹‹åœ°ï¼‰ï¼Œå¦‚05å¹´Baiduä¹‹æ˜Ÿåˆèµ›çš„çŸ³å¤´å‰ªå­å¸ƒæ¸¸æˆï¼› 
3ã€ä¼˜ç‚¹æ˜¯å®ç°å¼‚å¸¸ç®€å•ï¼Œç¼ºç‚¹æ˜¯åˆå¹¶åæ— æ³•åˆ†ç¦»ï¼Œè‹¥éœ€è¦å¯ä»¥é€‰æ‹©ç”¨åŠ¨æ€æ ‘ã€‚ 
</code></pre>

<p>åã€é‚»æ¥è¡¨å’Œè¾¹è¡¨ï¼š</p>

<pre><code>1ã€è¡¨ç¤ºå›¾çš„æœ€ç›´æ¥çš„æ–¹æ³•ï¼› 
2ã€åè€…æ›´çœç©ºé—´ï¼Œå¹¶ä¸”åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ›´å¥½ç”¨ï¼Œæ¯”å¦‚Bellman-Fordç®—æ³•ã€‚ 
</code></pre>

<p>ps:æ•°ç»„ã€é“¾è¡¨å¤ªåŸºç¡€ä¸åœ¨è€ƒè™‘ä¹‹åˆ—ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿®è¡Œç¯‡-æ¢ç¨‹åºä¹‹ç²¾å]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/08/oneday/"/>
    <updated>2016-08-08T23:53:19+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/08/oneday</id>
    <content type="html"><![CDATA[<blockquote><p>åšäº†è¿™ä¹ˆä¹…ioså¼€å‘ï¼Œç”±äºæœ€è¿‘å‘ç°è‡ªå·±åœ¨æ€§èƒ½å’Œåº•å±‚ç›¸å…³æ–¹é¢ï¼Œè¿˜æœ‰æœ‰å¾…æé«˜ï¼Œä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼šçŸ¥å…¶ç„¶ï¼Œè€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p></blockquote>

<p>æœ€è¿‘ä¹Ÿä¸€ç›´åœ¨ç ”ç©¶ç›¸å…³æ–¹é¢çš„æŠ€æœ¯ï¼ŒåŒ…æ‹¬iosç›¸å…³æŠ€æœ¯çš„åº•å±‚å®ç°ï¼Œä½†æ˜¯è¿™è¿˜æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œä¸€ä¸ªçœŸæ­£çš„ç¨‹åºå‘˜æ˜¯å¿…é¡»åšåˆ°â€œå­¦æ— æ­¢å¢ƒâ€ã€‚</p>

<p>ç»è¿‡è¿™å‡ å¹´çš„å¼€å‘ä¸å­¦ä¹ ï¼ŒåŒ…æ‹¬å’ŒåŒè¡Œæœ‹å‹çš„äº†è§£ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¿…å¤‡çš„æŠ€æœ¯æœ‰ä»¥ä¸‹å››ç§ã€‚</p>

<ul>
<li>ç®—æ³•</li>
<li>æ•°æ®ç»“æ„

<ul>
<li>ç¨‹åº=ç®—æ³•+æ•°æ®ç»“æ„</li>
</ul>
</li>
<li>è®¾è®¡æ¨¡å¼</li>
<li>æ•°æ®åº“</li>
</ul>


<!--more-->


<p>å½“ç„¶å¯èƒ½è¿˜æœ‰å…¶ä»–çš„ï¼Œæ¯”å¦‚æ“ä½œç³»ç»Ÿï¼Œè½¯ä»¶å·¥ç¨‹ï¼Œå½“ç„¶Cè¯­éŸ³æ˜¯ä¸èƒ½å†åŸºç¡€çš„åŸºç¡€ï¼Œä½†æ˜¯é™¤äº†ä¸Šé¢å››ç‚¹ï¼Œç¬”è€…å¯èƒ½ä¸ä¼šä¸“é—¨å»ç ”ç©¶ï¼Œæœ€å¤šä½œä¸ºäº†è§£ã€‚</p>

<blockquote><p>ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘å°†ä»ä¸Šé¢å››ç‚¹å¼€å§‹äººç”Ÿçš„ç¬¬äºŒæ¬¡æ”€çˆ¬ï¼Œå¸Œæœ›èƒ½çˆ¬åˆ°ä¸€ä¸ªå±äºæˆ‘è‡ªå·±çš„é«˜å³°ï¼Œä¹Ÿå¸Œæœ›èƒ½å¯¹å’Œæˆ‘æœ‰æ„ä¹‰å¿ƒæ€çš„äººæœ‰æ‰€å¸®åŠ©ã€‚</p></blockquote>

<h4>è·¯çº¿</h4>

<ol>
<li>ç®—æ³•ï¼Œæ•°æ®ç»“æ„ï¼Œè®¾è®¡æ¨¡å¼ï¼Œæ•°æ®åº“ï¼Œç›¸å…³æ¦‚å¿µçš„ä»‹ç»ä¸ç†è§£(å¯èƒ½ä¼šæœ‰éƒ¨åˆ†çš„è½¯ä»¶å·¥ç¨‹å’Œæ“ä½œç³»ç»Ÿç›¸å…³)</li>
<li>ç®€å•ä»£ç æ¼”ç¤ºä»¥ä¾¿æ›´åŠ æ·±åˆ»ç†è§£</li>
<li>å®é™…åº”ç”¨ä»¥ä¾¿æ›´åŠ æ·±å…¥ç†è§£</li>
<li>ä¸¾ä¸€åä¸‰</li>
<li>ç›¸å…³æ€»ç»“</li>
</ol>


<hr />

<p>æ›´æ–°ä¸­ï¼Œæ•¬è¯·å…³æ³¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSå¼€å‘å„ç§åº•å±‚å®ç°--åŒ…ä½ æ»¡æ„ğŸ˜˜ï¼]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/01/gezhongdicenshixian/"/>
    <updated>2016-08-01T23:30:19+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/01/gezhongdicenshixian</id>
    <content type="html"><![CDATA[<p>iOSå¼€å‘å¸¸ç”¨æŠ€æœ¯åº•å±‚å®ç°ï¼ˆç²¾ç®€æ¦‚è¿°ï¼‰</p>

<p>æœ¬ç« å°†å¯¹ioså¼€å‘æŠ€æœ¯åº•å±‚å®ç°çš„æ€»ç»“ï¼Œå…¶å®å…³äºioså¼€å‘ä¸­å„ç§åº•å±‚çš„å®ç°ï¼Œç½‘ä¸Šç›¸å…³æ–‡ç« å¤šåˆ°æ•°ä¸è¿‡æ¥ï¼Œè€Œä¸ä¸”éå¸¸ä¸é”™ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰è‡ªä¿¡æˆ‘èƒ½æ¯”ä»–ä»¬åšçš„æ›´å¥½ï¼Œå› ä¸ºæ¯•ç«Ÿæ¯ä¸ªäººä¸“ç ”çš„ä¸œè¥¿ä¸ä¸€æ ·ï¼Œæœ¬æ–‡ä¸»è¦æ­£å¯¹ä¸‰ç±»ç”¨æˆ·ï¼</p>

<ol>
<li>èµ„æ·±çš„ioså¼€å‘è€…ï¼Œå¯¹åº•å±‚åšè¿‡ä¸“é—¨ç ”ç©¶ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªç³»ç»Ÿæ•´ç†ï¼Œæˆ–è€…è¯´ä¸èƒ½å¾ˆæ¸…æ¥šçš„è¡¨è¾¾ã€‚</li>
<li>ioså¼€å‘åˆå­¦è€…ï¼Œæ²¡æœ‰ä¸“é—¨ç ”ç©¶è¿‡åº•å±‚æˆ–è€…ç›¸å…³æºç çš„åˆå­¦è€…ï¼Œä½†æ˜¯ä¸å¤ªå»ºè®®ä¸€å¼€å§‹å°±çœ‹ï¼Œå› ä¸ºå¦‚æœä½ æ²¡æœ‰è¿‡ä¸€ç‚¹æ¥è§¦ï¼Œçœ‹äº†ä¹Ÿçœ‹ä¸æ‡‚ï¼Œæˆ–è€…çœ‹äº†ä¹Ÿç™½çœ‹ï¼Œæœ€å¤šå°±æ˜¯ç•™ä¸ªå°è±¡åœ¨è„‘å­äº†ï¼Œå¯¹åˆå­¦è€…æ¥è¯´ï¼Œåˆ‡è®°ä¸èƒ½é èƒŒæˆ–è€…äº†è§£ï¼Œè€Œä¸”ç»†ç»†ç ”ç©¶æ¯ä¸€ä¸ªæŠ€æœ¯ç‚¹ï¼Œå†æ…¢æ…¢æ·±å…¥æŒ–æ˜ã€‚</li>
<li>ioså¼€å‘å¾…ä¸šç¨‹åºå‘˜ï¼ˆé¢è¯•ï¼‰ä¸“ç”¨ï¼Œä¸ç®¡ä½ æœ‰æ²¡æœ‰æ¥è§¦è¿‡ioså¼€å‘ç›¸å…³çš„åº•å±‚ï¼Œåªè¦ä½ æ˜¯åœ¨å‡†å¤‡æ‰¾å·¥ä½œçš„ç¨‹åºå‘˜ï¼Œæˆ‘ç›¸ä¿¡ä½ çœ‹äº†ç»å¯¹æœ‰ç”¨ï¼Œä½†æ˜¯å¹¶ä¸èƒ½æ­£é¢ä½ å°±çœŸçš„ç†è§£äº†ï¼Œæ‰€ä»¥å¸Œæœ›è¿™å¯¹ä½ æ¥è¯´åªæ˜¯çŸ­æš‚çš„ï¼Œåç»­å¾—èŠ±å¤§é‡æ—¶é—´å»ä¸“é—¨ç ”ç©¶æ‰èƒ½åœ¨è¿™æ¡è·¯ä¸Šèµ°å¾—æ›´è¿œï¼Œä¸ç„¶ä½ æ°¸è¿œåªæ˜¯ä¸ªç å†œï¼</li>
</ol>


<p>å¥½äº†ï¼ŒåºŸè¯ä¹Ÿä¸å¤šè¯´äº†ï¼Œæˆ‘ä»¬å¼€å§‹å§ã€‚ã€‚ã€‚ã€‚ã€‚</p>

<h6>ç³»ç»Ÿç¯‡</h6>

<ul>
<li>å†…å­˜ç®¡ç†</li>
<li>Runtime</li>
</ul>


<h6>äº‹ä»¶ç¯‡</h6>

<ul>
<li>äº‹ä»¶ä¼ é€’</li>
<li>äº‹ä»¶å“åº”</li>
</ul>


<h6>ä»£ç ç¯‡</h6>

<ul>
<li>Block</li>
<li>__Block</li>
</ul>


<!--more-->


<h6>å®æˆ˜</h6>

<ul>
<li>KVO</li>
<li>KVC</li>
</ul>


<h6>é«˜çº§</h6>

<ul>
<li>GCD</li>
</ul>


<h6>å…¨æ ˆç¯‡</h6>

<ul>
<li>JSPatch</li>
<li>React Native</li>
</ul>


<h6>å¿…å¤‡ç¯‡</h6>

<ul>
<li>å¤šçº¿ç¨‹</li>
<li>ç½‘ç»œ</li>
<li>æ•°æ®æŒä¹…åŒ–</li>
</ul>


<h6>é€šç”¨ç¯‡</h6>

<ul>
<li>æ•°ç»„</li>
<li>å­—å…¸</li>
<li>é›†åˆ</li>
</ul>


<h6>#å†™åœ¨æœ€å</h6>

<hr />

<h1>ç³»ç»Ÿç¯‡</h1>

<hr />

<h3>å†…å­˜ç®¡ç†</h3>

<ul>
<li><p>é»„é‡‘æ³•åˆ™</p>

<ul>
<li>å¦‚æœä¸€ä¸ªå¯¹è±¡ä½¿ç”¨äº†allocï¼Œ[mutable] copyï¼Œretainï¼Œé‚£ä¹ˆä½ å¿…é¡»ä½¿ç”¨ç›¸åº”çš„releaseæˆ–autonrelease</li>
</ul>
</li>
</ul>


<p>MRC:</p>

<pre><code> æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼ˆretain, release, autorelease,ä¸å¤šè¯´ï¼‰ æŒæœ‰å¯¹è±¡,retain +1 ,å¼•ç”¨è®¡æ•°åŠ 1, é‡Šæ”¾å¯¹è±¡:release -1, å¼•ç”¨è®¡æ•°å‡1,å½“å¼•ç”¨è®¡æ•°ä¸º0æ—¶,ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜.  autoreleaseå¯¹è±¡å†…å­˜çš„ç®¡ç†æ”¾åˆ°autoreleasepoolä¸­, å½“pool drainæ—¶,å›æ”¶å†…å­˜. (è¿™æ˜¯åŸºäº objective-cçš„è¿è¡Œæ—¶ç‰¹æ€§å’Œåƒåœ¾å›æ”¶æœºåˆ¶)
</code></pre>

<p>ARC:</p>

<pre><code> æ‰‹åŠ¨ç®¡ç†å†…å­˜, è¿™æ˜¯xcode4.xç‰ˆæœ¬çš„ç‰¹æ€§,(4.1åŠä»¥å‰æ²¡æœ‰,æˆ‘ä»4.6å¼€å§‹çš„), åŸç†æ˜¯:åœ¨ç¼–è¯‘ä»£ç çš„æ—¶å€™ä¸ºä½ è‡ªåŠ¨åœ¨åˆé€‚çš„ä½ç½®æ’å…¥release å’Œ autorelease, (è¿è¡Œæ—¶å¤„ç†åƒåœ¾å›æ”¶å°±å¦‚ä½•MRCä¸€æ ·).
</code></pre>

<p>æ€»ç»“: ARCæœºåˆ¶æ‹¥æœ‰å’ŒMRCä¸€æ ·çš„æ•ˆç‡, ARCé€šè¿‡åœ¨éƒ¨åˆ†ä¼˜åŒ–å’Œåœ¨æœ€åˆé€‚çš„åœ°æ–¹å®Œæˆå¼•ç”¨è®¡æ•°çš„ç»´æŠ¤,æ‰€ä»¥æ”¯æŒä½¿ç”¨ARC.</p>

<p>è§„åˆ™</p>

<p>è§„åˆ™ï¼š</p>

<ul>
<li><p>1ã€Objective-Cç±»ä¸­å®ç°äº†å¼•ç”¨è®¡æ•°å™¨ï¼Œå¯¹è±¡çŸ¥é“è‡ªå·±å½“å‰è¢«å¼•ç”¨çš„æ¬¡æ•°</p></li>
<li><p>2ã€æœ€åˆå¯¹è±¡çš„è®¡æ•°å™¨ä¸º1</p></li>
<li><p>3ã€å¦‚æœéœ€è¦å¼•ç”¨å¯¹è±¡ï¼Œå¯ä»¥ç»™å¯¹è±¡å‘é€ä¸€ä¸ªretainæ¶ˆæ¯ï¼Œè¿™æ ·å¯¹è±¡çš„è®¡æ•°å™¨å°±åŠ 1</p></li>
<li><p>4ã€å½“ä¸éœ€è¦å¼•ç”¨å¯¹è±¡äº†ï¼Œå¯ä»¥ç»™å¯¹è±¡å‘é€releaseæ¶ˆæ¯ï¼Œè¿™æ ·å¯¹è±¡è®¡æ•°å™¨å°±å‡1</p></li>
<li><p>5ã€å½“è®¡æ•°å™¨å‡åˆ°0ï¼Œè‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„deallocå‡½æ•°ï¼Œå¯¹è±¡å°±ä¼šé‡Šæ”¾å†…å­˜</p></li>
<li><p>6ã€è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡ä¸èƒ½å†ä½¿ç”¨releaseå’Œå…¶ä»–æ–¹æ³•</p></li>
</ul>


<h3>Runtime</h3>

<p>ä¸€å¥—çº¯ä½å±‚çš„Cè¯­è¨€åº“
å¹³æ—¶æˆ‘ä»¬ç¼–å†™çš„OCä»£ç éƒ½ä¼šè½¬æˆRuntimeå»æ‰§è¡Œ</p>

<p>ç‰¹æ€§ï¼š</p>

<pre><code>åŠ¨æ€ç±»å‹ï¼šç¨‹åºç›´åˆ°æ‰§è¡Œæ—¶æ‰èƒ½ç¡®å®šæ‰€å±çš„ç±»ã€‚

åŠ¨æ€ç»‘å®šï¼šç¨‹åºç›´åˆ°æ‰§è¡Œæ—¶æ‰èƒ½ç¡®å®šå®é™…è¦è°ƒç”¨çš„æ–¹æ³•ã€‚

åŠ¨æ€åŠ è½½ï¼šæ ¹æ®éœ€æ±‚åŠ è½½æ‰€éœ€è¦çš„èµ„æº
</code></pre>

<p>Runtimeæ¶ˆæ¯æœºåˆ¶</p>

<p>é¦–å…ˆé€šè¿‡objçš„isaæŒ‡é’ˆæ‰¾åˆ°objå¯¹åº”çš„classã€‚</p>

<ul>
<li>é¦–å…ˆæ£€æµ‹è¿™ä¸ª selector æ˜¯ä¸æ˜¯è¦å¿½ç•¥ã€‚æ¯”å¦‚ Mac OS X å¼€å‘ï¼Œæœ‰äº†åƒåœ¾å›æ”¶å°±ä¸ç†ä¼š retainï¼Œrelease è¿™äº›å‡½æ•°ã€‚</li>
<li>æ£€æµ‹è¿™ä¸ª selector çš„ target æ˜¯ä¸æ˜¯ nilï¼ŒObjc å…è®¸æˆ‘ä»¬å¯¹ä¸€ä¸ª nil å¯¹è±¡æ‰§è¡Œä»»ä½•æ–¹æ³•ä¸ä¼š Crashï¼Œå› ä¸ºè¿è¡Œæ—¶ä¼šè¢«å¿½ç•¥æ‰ã€‚</li>
<li>å¦‚æœä¸Šé¢ä¸¤æ­¥éƒ½é€šè¿‡äº†ï¼Œé‚£ä¹ˆå°±å¼€å§‹æŸ¥æ‰¾è¿™ä¸ªç±»çš„å®ç° IMPï¼Œ</li>
<li>åœ¨Classä¸­å…ˆå»cacheä¸­ é€šè¿‡SELæŸ¥æ‰¾å¯¹åº”å‡½æ•°methodï¼Œæ‰¾åˆ°å°±æ‰§è¡Œå¯¹åº”çš„å®ç°ã€‚</li>
<li>è‹¥cacheä¸­æœªæ‰¾åˆ°ï¼Œå†å»methodListä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å°±æ‰§è¡Œå¯¹åº”çš„å®ç°ã€‚</li>
<li>è‹¥methodlistä¸­æœªæ‰¾åˆ°ï¼Œåˆ™å–superClassä¸­æŸ¥æ‰¾ï¼ˆé‡å¤æ‰§è¡Œä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æœ€æ ¹çš„ç±»ä¸ºæ­¢ã€‚</li>
<li>è‹¥ä»»ä½•ä¸€éƒ¨èƒ½æ‰¾åˆ°ï¼Œåˆ™å°†methodåŠ  å…¥åˆ°cacheä¸­ï¼Œä»¥æ–¹ä¾¿ä¸‹æ¬¡æŸ¥æ‰¾ï¼Œå¹¶é€šè¿‡methodä¸­çš„å‡½æ•°æŒ‡é’ˆè·³è½¬åˆ°å¯¹åº”çš„å‡½æ•°ä¸­å»æ‰§è¡Œã€‚</li>
<li>å¦‚æœä»¥ä¸Šéƒ½ä¸èƒ½æ‰¾åˆ°ï¼Œåˆ™ä¼šå¼€å§‹è¿›è¡Œæ¶ˆæ¯è½¬å‘</li>
</ul>


<p>æ¶ˆæ¯è½¬å‘</p>

<ul>
<li>1.åŠ¨æ€æ–¹æ³•è§£æï¼šå‘å½“å‰ç±»å‘é€ resolveInstanceMethod: ä¿¡å·ï¼Œæ£€æŸ¥æ˜¯å¦åŠ¨æ€å‘è¯¥ç±»æ·»åŠ äº†æ–¹æ³•ã€‚ï¼ˆè¿·èŒ«è¯·æœç´¢ï¼š@dynamicï¼‰</li>
<li>2.å¿«é€Ÿæ¶ˆæ¯è½¬å‘ï¼šæ£€æŸ¥è¯¥ç±»æ˜¯å¦å®ç°äº† forwardingTargetForSelector: æ–¹æ³•ï¼Œè‹¥å®ç°äº†åˆ™è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è‹¥è¯¥æ–¹æ³•è¿”å›å€¼å¯¹è±¡énilæˆ–éselfï¼Œåˆ™å‘è¯¥è¿”å›å¯¹è±¡é‡æ–°å‘é€æ¶ˆæ¯ã€‚</li>
<li>3.æ ‡å‡†æ¶ˆæ¯è½¬å‘ï¼šruntimeå‘é€methodSignatureForSelector:æ¶ˆæ¯è·å–Selectorå¯¹åº”çš„æ–¹æ³•ç­¾åã€‚è¿”å›å€¼éç©ºåˆ™é€šè¿‡forwardInvocation:è½¬å‘æ¶ˆæ¯ï¼Œè¿”å›å€¼ä¸ºç©ºåˆ™å‘å½“å‰å¯¹è±¡å‘é€doesNotRecognizeSelector:æ¶ˆæ¯ï¼Œç¨‹åºå´©æºƒé€€å‡º</li>
</ul>


<p>æ€»ç»“å°±æ˜¯ï¼š
åœ¨ä¸€ä¸ªå‡½æ•°æ‰¾ä¸åˆ°æ—¶ï¼ŒOCæä¾›äº†ä¸‰ç§æ–¹å¼å»è¡¥æ•‘ï¼š</p>

<ul>
<li>1ã€è°ƒç”¨resolveInstanceMethodç»™ä¸ªæœºä¼šè®©ç±»æ·»åŠ è¿™ä¸ªå®ç°è¿™ä¸ªå‡½æ•°</li>
<li>2ã€è°ƒç”¨forwardingTargetForSelectorè®©åˆ«çš„å¯¹è±¡å»æ‰§è¡Œè¿™ä¸ªå‡½æ•°</li>
<li>3ã€è°ƒç”¨forwardInvocationï¼ˆå‡½æ•°æ‰§è¡Œå™¨ï¼‰çµæ´»çš„å°†ç›®æ ‡å‡½æ•°ä»¥å…¶ä»–å½¢å¼æ‰§è¡Œã€‚
å¦‚æœéƒ½ä¸ä¸­ï¼Œè°ƒç”¨doesNotRecognizeSelectoræŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>


<hr />

<h1>äº‹ä»¶ç¯‡</h1>

<h3>åº”ç”¨å¦‚ä½•æ‰¾åˆ°æœ€åˆé€‚çš„æ§ä»¶æ¥å¤„ç†äº‹ä»¶ï¼Ÿ</h3>

<pre><code>1.é¦–å…ˆåˆ¤æ–­ä¸»çª—å£ï¼ˆkeyWindowï¼‰è‡ªå·±æ˜¯å¦èƒ½æ¥å—è§¦æ‘¸äº‹ä»¶
2.åˆ¤æ–­è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è‡ªå·±èº«ä¸Š
3.å­æ§ä»¶æ•°ç»„ä¸­ä»åå¾€å‰éå†å­æ§ä»¶ï¼Œé‡å¤å‰é¢çš„ä¸¤ä¸ªæ­¥éª¤ï¼ˆæ‰€è°“ä»åå¾€å‰éå†å­æ§ä»¶ï¼Œå°±æ˜¯é¦–å…ˆæŸ¥æ‰¾å­æ§ä»¶æ•°ç»„ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæ‰§è¡Œ1ã€2æ­¥éª¤ï¼‰
4.viewï¼Œæ¯”å¦‚å«åšfitViewï¼Œé‚£ä¹ˆä¼šæŠŠè¿™ä¸ªäº‹ä»¶äº¤ç»™è¿™ä¸ªfitViewï¼Œå†éå†è¿™ä¸ªfitViewçš„å­æ§ä»¶ï¼Œç›´è‡³æ²¡æœ‰æ›´åˆé€‚çš„viewä¸ºæ­¢ã€‚
5.å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­æ§ä»¶ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè‡ªå·±æœ€åˆé€‚å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è‡ªå·±æ˜¯æœ€åˆé€‚çš„view
</code></pre>

<h2>äº‹ä»¶çš„ä¼ é€’å’Œå“åº”çš„åŒºåˆ«ï¼š</h2>

<ul>
<li>äº‹ä»¶çš„ä¼ é€’æ˜¯ä»ä¸Šåˆ°ä¸‹ï¼ˆçˆ¶æ§ä»¶åˆ°å­æ§ä»¶ï¼‰ï¼Œäº‹ä»¶çš„å“åº”æ˜¯ä»ä¸‹åˆ°ä¸Šï¼ˆé¡ºç€å“åº”è€…é“¾æ¡å‘ä¸Šä¼ é€’ï¼šå­æ§ä»¶åˆ°çˆ¶æ§ä»¶ã€‚</li>
</ul>


<h3>äº‹ä»¶å“åº”</h3>

<h5>å“åº”è€…é“¾çš„äº‹ä»¶ä¼ é€’è¿‡ç¨‹:</h5>

<pre><code>1&gt;å¦‚æœå½“å‰viewæ˜¯æ§åˆ¶å™¨çš„viewï¼Œé‚£ä¹ˆæ§åˆ¶å™¨å°±æ˜¯ä¸Šä¸€ä¸ªå“åº”è€…ï¼Œäº‹ä»¶å°±ä¼ é€’ç»™æ§åˆ¶å™¨ï¼›å¦‚æœå½“å‰viewä¸æ˜¯æ§åˆ¶å™¨çš„viewï¼Œé‚£ä¹ˆçˆ¶è§†å›¾å°±æ˜¯å½“å‰viewçš„ä¸Šä¸€ä¸ªå“åº”è€…ï¼Œäº‹ä»¶å°±ä¼ é€’ç»™å®ƒçš„çˆ¶è§†å›¾
2&gt;åœ¨è§†å›¾å±‚æ¬¡ç»“æ„çš„æœ€é¡¶çº§è§†å›¾ï¼Œå¦‚æœä¹Ÿä¸èƒ½å¤„ç†æ”¶åˆ°çš„äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™windowå¯¹è±¡è¿›è¡Œå¤„ç†
3&gt;å¦‚æœwindowå¯¹è±¡ä¹Ÿä¸å¤„ç†ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™UIApplicationå¯¹è±¡
4&gt;å¦‚æœUIApplicationä¹Ÿä¸èƒ½å¤„ç†è¯¥äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒ
</code></pre>

<h3>äº‹ä»¶ä¼ é€’</h3>

<h5>äº‹ä»¶å¤„ç†çš„æ•´ä¸ªæµç¨‹æ€»ç»“ï¼š</h5>

<pre><code>ã€€ã€€1.è§¦æ‘¸å±å¹•äº§ç”Ÿè§¦æ‘¸äº‹ä»¶åï¼Œè§¦æ‘¸äº‹ä»¶ä¼šè¢«æ·»åŠ åˆ°ç”±UIApplicationç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼ˆå³ï¼Œé¦–å…ˆæ¥æ”¶åˆ°äº‹ä»¶çš„æ˜¯UIApplicationï¼‰ã€‚
ã€€ã€€2.UIApplicationä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºæœ€å‰é¢çš„äº‹ä»¶ï¼ŒæŠŠäº‹ä»¶ä¼ é€’ç»™åº”ç”¨ç¨‹åºçš„ä¸»çª—å£ï¼ˆkeyWindowï¼‰ã€‚
ã€€ã€€3.ä¸»çª—å£ä¼šåœ¨è§†å›¾å±‚æ¬¡ç»“æ„ä¸­æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„è§†å›¾æ¥å¤„ç†è§¦æ‘¸äº‹ä»¶ã€‚ï¼ˆè‡³æ­¤ï¼Œç¬¬ä¸€æ­¥å·²å®Œæˆ)
ã€€ã€€4.æœ€åˆé€‚çš„viewä¼šè°ƒç”¨è‡ªå·±çš„touchesæ–¹æ³•å¤„ç†äº‹ä»¶
ã€€ã€€5.touchesé»˜è®¤åšæ³•æ˜¯æŠŠäº‹ä»¶é¡ºç€å“åº”è€…é“¾æ¡å‘ä¸ŠæŠ›ã€‚
</code></pre>

<hr />

<h1>ä»£ç ç¯‡</h1>

<hr />

<h3>Blockçš„åº•å±‚å®ç°</h3>

<p>ä¸€å¥è¯:</p>

<pre><code>æ ˆåœ°å€å’Œå¯¹åœ°å€å€¼çš„æ‹·è´

blockå°±æ˜¯ä¸€ä¸ªé‡Œé¢å­˜å‚¨äº†æŒ‡å‘å‡½æ•°ä½“ä¸­åŒ…å«å®šä¹‰blockæ—¶çš„ä»£ç å—çš„å‡½æ•°æŒ‡é’ˆï¼Œä»¥åŠblockå¤–éƒ¨ä¸Šä¸‹æ–‡å˜é‡ç­‰ä¿¡æ¯çš„ç»“æ„ä½“ã€‚
</code></pre>

<p>Blockç»“æ„ä½“ä¸­å«æœ‰isaæŒ‡é’ˆï¼Œè¿™å°±è¯æ˜äº†Blockå…¶å®å°±æ˜¯å¯¹è±¡ï¼Œå¹¶å…·æœ‰ä¸€èˆ¬å¯¹è±¡çš„æ‰€æœ‰åŠŸèƒ½ã€‚è¿™ä¸ªisaæŒ‡é’ˆè¢«åˆå§‹åŒ–ä¸º <em>NSConcreteStackBlock æˆ–è€… </em>NSConcreteGlobalBlock ç±»çš„åœ°å€ã€‚åœ¨æ²¡æœ‰å¼€å¯ARCçš„æƒ…å†µä¸‹ï¼Œå¦‚æœBlockä¸­åŒ…å«æœ‰å±€éƒ¨å˜é‡åˆ™isaè¢«åˆå§‹åŒ–ä¸ºå‰è€…ï¼Œå¦åˆ™å°±è¢«åˆå§‹åŒ–ä¸ºåè€…ã€‚è€Œå½“ARCå¼€å¯åï¼Œå¦‚æœBlockä¸­åŒ…å«æœ‰å±€éƒ¨å˜é‡åˆ™isaè¢«åˆå§‹åŒ–ä¸º <em>NSConcreteMallocBlock ï¼Œå¦åˆ™å°±è¢«åˆå§‹åŒ–ä¸º </em>NSConcreteGlobalBlock ã€‚invokeæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„æ˜¯Blockè¢«è½¬æ¢æˆå‡½æ•°çš„åœ°å€ã€‚æœ€åçš„imported variableséƒ¨åˆ†æ˜¯Blockéœ€è¦è®¿é—®çš„å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä»–ä»¬åœ¨ç¼–è¯‘å°±ä¼šè¢«æ‹·è´åˆ°Blockä¸­ï¼Œè¿™æ ·ä¸€æ¥Blockå°±æ˜¯æˆä¸ºä¸€ä¸ªé—­åŒ…äº†ã€‚</p>

<h3>__blockåº•å±‚å®ç°</h3>

<pre><code>ä¸€å¥è¯ï¼šä¼ å€¼ å’Œä¼ å€
</code></pre>

<p><strong>blockæ‰“å°C++æºç å¯ä»¥çœ‹åˆ°</strong>Block_byref_a_0ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸­å«æœ‰isaæŒ‡é’ˆï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæ˜¯ç”¨æ¥åŒ…è£…å±€éƒ¨å˜é‡açš„ã€‚å½“blockè¢«copyåˆ°å †ä¸­æ—¶ï¼Œ<strong>Person</strong>test_block_impl_0çš„æ‹·è´è¾…åŠ©å‡½æ•°<strong>Person</strong>test_block_copy_0ä¼šå°†__Block_byref_a_0æ‹·è´è‡³å †ä¸­ï¼Œæ‰€ä»¥å³ä½¿å±€éƒ¨å˜é‡æ‰€åœ¨å †è¢«é”€æ¯ï¼Œblockä¾ç„¶èƒ½å¯¹å †ä¸­çš„å±€éƒ¨å˜é‡è¿›è¡Œæ“ä½œ</p>

<pre><code>è¿™æ ·åšæ˜¯ä¸ºäº†ä¿è¯æ“ä½œçš„å€¼å§‹ç»ˆæ˜¯å †ä¸­çš„æ‹·è´ï¼Œè€Œä¸æ˜¯æ ˆä¸­çš„å€¼ã€‚ï¼ˆå¤„ç†åœ¨å±€éƒ¨å˜é‡æ‰€åœ¨æ ˆè¿˜æ²¡é”€æ¯ï¼Œå°±è°ƒç”¨blockæ¥æ”¹å˜å±€éƒ¨å˜é‡å€¼çš„æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰__forwardingæŒ‡é’ˆï¼Œåˆ™ä¿®æ”¹æ— æ•ˆï¼‰
</code></pre>

<hr />

<h1>å®æˆ˜ç¯‡</h1>

<hr />

<h2>KVO/KVC</h2>

<p>VC/KVOæ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œåœ¨Cocoaä¸­æ˜¯ä»¥è¢«ä¸‡ç‰©ä¹‹æºNSObjectç±»å®ç°çš„NSKeyValueCoding/NSKeyValueObservingéæ­£å¼åè®®çš„å½¢å¼è¢«å®šä¹‰ä¸ºåŸºç¡€æ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚ä»åè®®çš„è§’åº¦æ¥è¯´ï¼ŒKVC/KVOæœ¬è´¨ä¸Šæ˜¯å®šä¹‰äº†ä¸€å¥—è®©æˆ‘ä»¬å»éµå®ˆå’Œå®ç°çš„æ–¹æ³•ã€‚
å½“ç„¶ï¼ŒKVC/KVOå®ç°çš„æ ¹æœ¬æ˜¯Objective-Cçš„åŠ¨æ€æ€§å’Œruntimeï¼Œè¿™åœ¨åæ–‡çš„åŸç†éƒ¨åˆ†ä¼šæœ‰è¯¦è¿°ã€‚
å¦å¤–ï¼ŒKVC/KVOæœºåˆ¶ç¦»ä¸å¼€è®¿é—®å™¨æ–¹æ³•çš„å®ç°ï¼Œè¿™åœ¨åæ–‡ä¸­ä¹Ÿæœ‰è§£é‡Šã€‚</p>

<p>1ã€KVCç®€ä»‹</p>

<pre><code>å…¨ç§°æ˜¯Key-value codingï¼Œç¿»è¯‘æˆé”®å€¼ç¼–ç ã€‚é¡¾åæ€ä¹‰ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šè·Ÿmapçš„å…³ç³»åŒªæµ…ã€‚å®ƒæä¾›äº†ä¸€ç§ä½¿ç”¨å­—ç¬¦ä¸²è€Œä¸æ˜¯è®¿é—®å™¨æ–¹æ³•å»è®¿é—®ä¸€ä¸ªå¯¹è±¡å®ä¾‹å˜é‡çš„æœºåˆ¶ã€‚
</code></pre>

<p>2ã€KVOç®€ä»‹</p>

<pre><code>å…¨ç§°æ˜¯Key-value observingï¼Œç¿»è¯‘æˆé”®å€¼è§‚å¯Ÿã€‚æä¾›äº†ä¸€ç§å½“å…¶å®ƒå¯¹è±¡å±æ€§è¢«ä¿®æ”¹çš„æ—¶å€™èƒ½é€šçŸ¥å½“å‰å¯¹è±¡çš„æœºåˆ¶ã€‚å†MVCå¤§è¡Œå…¶é“çš„Cocoaä¸­ï¼ŒKVOæœºåˆ¶å¾ˆé€‚åˆå®ç°modelå’Œcontrollerç±»ä¹‹é—´çš„é€šè®¯ã€‚
</code></pre>

<h3>KVOçš„åº•å±‚å®ç°ï¼ˆåŸºäºKVC-ã€‹è¿è¡Œæ—¶ï¼‰</h3>

<p>å½“æŸä¸ªç±»çš„å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«è§‚å¯Ÿæ—¶ï¼Œç³»ç»Ÿå°±ä¼šåœ¨è¿è¡ŒæœŸåŠ¨æ€åœ°åˆ›å»ºè¯¥ç±»çš„ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼Œåœ¨è¿™ä¸ªæ´¾ç”Ÿç±»ä¸­é‡å†™åŸºç±»ä¸­ä»»ä½•è¢«è§‚å¯Ÿå±æ€§çš„ setter æ–¹æ³•ã€‚</p>

<pre><code>æ´¾ç”Ÿç±»åœ¨è¢«é‡å†™çš„ setter æ–¹æ³•å®ç°çœŸæ­£çš„é€šçŸ¥æœºåˆ¶ï¼Œå°±å¦‚å‰é¢æ‰‹åŠ¨å®ç°é”®å€¼è§‚å¯Ÿé‚£æ ·ã€‚è¿™ä¹ˆåšæ˜¯åŸºäºè®¾ç½®å±æ€§ä¼šè°ƒç”¨ setter æ–¹æ³•ï¼Œè€Œé€šè¿‡é‡å†™å°±è·å¾—äº† KVO éœ€è¦çš„é€šçŸ¥æœºåˆ¶ã€‚å½“ç„¶å‰ææ˜¯è¦é€šè¿‡éµå¾ª KVO çš„å±æ€§è®¾ç½®æ–¹å¼æ¥å˜æ›´å±æ€§å€¼ï¼Œå¦‚æœä»…æ˜¯ç›´æ¥ä¿®æ”¹å±æ€§å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œæ˜¯æ— æ³•å®ç° KVO çš„ã€‚

åŒæ—¶æ´¾ç”Ÿç±»è¿˜é‡å†™äº† class æ–¹æ³•ä»¥â€œæ¬ºéª—â€å¤–éƒ¨è°ƒç”¨è€…å®ƒå°±æ˜¯èµ·åˆçš„é‚£ä¸ªç±»ã€‚ç„¶åç³»ç»Ÿå°†è¿™ä¸ªå¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°è¯ç”Ÿçš„æ´¾ç”Ÿç±»ï¼Œå› æ­¤è¿™ä¸ªå¯¹è±¡å°±æˆä¸ºè¯¥æ´¾ç”Ÿç±»çš„å¯¹è±¡äº†ï¼Œå› è€Œåœ¨è¯¥å¯¹è±¡ä¸Šå¯¹ setter çš„è°ƒç”¨å°±ä¼šè°ƒç”¨é‡å†™çš„ setterï¼Œä»è€Œæ¿€æ´»é”®å€¼é€šçŸ¥æœºåˆ¶ã€‚æ­¤å¤–ï¼Œæ´¾ç”Ÿç±»è¿˜é‡å†™äº† dealloc æ–¹æ³•æ¥é‡Šæ”¾èµ„æº
</code></pre>

<p>isaæŒ‡é’ˆæŒ‡å‘çš„å…¶å®æ˜¯ç±»çš„å…ƒç±»ï¼Œå¦‚æœä¹‹å‰çš„ç±»åä¸ºï¼šPersonï¼Œé‚£ä¹ˆè¢«runtimeæ›´æ”¹ä»¥åçš„ç±»åä¼šå˜æˆï¼šNSKVONotifying_Personã€‚
æ–°çš„NSKVONotifying_Personç±»ä¼šé‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š
å¢åŠ äº†ç›‘å¬çš„å±æ€§å¯¹åº”çš„setæ–¹æ³•ï¼Œclassï¼Œdeallocï¼Œ_isKVOA</p>

<h3>KVCçš„åº•å±‚å®ç°</h3>

<p>KVCè¿ç”¨äº†ä¸€ä¸ªisa-swizzlingæŠ€æœ¯ã€‚isa-swizzlingå°±æ˜¯ç±»å‹æ··åˆæŒ‡é’ˆæœºåˆ¶ã€‚KVCä¸»è¦é€šè¿‡isa-swizzlingï¼Œæ¥å®ç°å…¶å†…éƒ¨æŸ¥æ‰¾å®šä½çš„ã€‚isaæŒ‡é’ˆï¼Œå¦‚å…¶åç§°æ‰€æŒ‡ï¼Œï¼ˆå°±æ˜¯is a kind ofçš„æ„æ€ï¼‰ï¼ŒæŒ‡å‘ç»´æŠ¤åˆ†å‘è¡¨çš„å¯¹è±¡çš„ç±»ã€‚è¯¥åˆ†å‘è¡¨å®é™…ä¸ŠåŒ…å«äº†æŒ‡å‘å®ç°ç±»ä¸­çš„æ–¹æ³•çš„æŒ‡é’ˆï¼Œå’Œå…¶å®ƒæ•°æ®ã€‚</p>

<p>ä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨setValueçš„æ—¶å€™ï¼Œ</p>

<ul>
<li>ï¼ˆ1ï¼‰é¦–å…ˆæ ¹æ®æ–¹æ³•åæ‰¾åˆ°è¿è¡Œæ–¹æ³•çš„æ—¶å€™æ‰€éœ€è¦çš„ç¯å¢ƒå‚æ•°ã€‚</li>
<li>ï¼ˆ2ï¼‰ä»–ä¼šä»è‡ªå·±isaæŒ‡é’ˆç»“åˆç¯å¢ƒå‚æ•°ï¼Œæ‰¾åˆ°å…·ä½“çš„æ–¹æ³•å®ç°çš„æ¥å£ã€‚</li>
<li>ï¼ˆ3ï¼‰å†ç›´æ¥æŸ¥æ‰¾å¾—æ¥çš„å…·ä½“çš„æ–¹æ³•å®ç°ã€‚</li>
</ul>


<hr />

<h1>é«˜çº§</h1>

<hr />

<h3>GCDåº•å±‚å®ç°</h3>

<p>GCDå†…éƒ¨æ˜¯æ€ä¹ˆå®ç°çš„</p>

<ul>
<li>1 IOSå’ŒOS Xçš„æ ¸å¿ƒæ˜¯XNUå†…æ ¸ï¼ŒGCDæ˜¯åŸºäºXUNå†…æ ¸å®ç°çš„</li>
<li>2 GCDçš„APIå…¨éƒ¨åœ¨libdispatchåº“ä¸­</li>
<li><p>3 GCDçš„åº•å±‚å®ç°ä¸»è¦æœ‰Dispatch Queue å’ŒDispatch Source</p>

<ul>
<li>Dispatch Queue ï¼šç®¡ç†blockæ“ä½œ</li>
<li>Dispatch Source :å¤„ç†äº‹ä»¶(æ¯”å¦‚çº¿ç¨‹é—´é€šä¿¡)</li>
</ul>
</li>
</ul>


<p>NSOperationQueue å’ŒGCDçš„åŒºåˆ«å’Œç±»ä¼¼çš„åœ°æ–¹</p>

<ul>
<li>1 GCDæ˜¯çº¯Cè¯­è¨€çš„APIï¼Œ NSOperationQueueæ˜¯åŸºäºGCDçš„OCç‰ˆæœ¬å°è£…</li>
<li>2 GCDåªæ”¯æŒFIFOçš„é˜Ÿåˆ—ï¼ŒNSOperationQueueå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒæ•´æ‰§è¡Œé¡ºåº è®¾ç½®æœ€å¤§å¹¶å‘æ•°é‡</li>
<li>3 NSOperationQueue å¯ä»¥è½»æ¾åœ°åœ¨operation é—´è®¾ç½®ä¾èµ–å…³ç³»ï¼Œè€ŒGCDéœ€è¦å†™å¾ˆå¤šçš„ä»£ç </li>
<li>4 NSOperationQueueæ”¯æŒKVOï¼Œå¯ä»¥ç›‘æµ‹operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œ(is Executed),æ˜¯å¦ç»“æŸ(is finished),æ˜¯å¦å–æ¶ˆ( is canceld);</li>
<li>5 GCDçš„æ‰§è¡Œé€Ÿåº¦æ¯”NSOperationQueueå¿«</li>
</ul>


<hr />

<h1>å…¨æ ˆç¯‡</h1>

<hr />

<h3>JSpatchåº•å±‚å®ç°</h3>

<p>JSPatch èƒ½åšåˆ°é€šè¿‡ JS è°ƒç”¨å’Œæ”¹å†™ OC æ–¹æ³•æœ€æ ¹æœ¬çš„åŸå› æ˜¯ Objective-C æ˜¯åŠ¨æ€è¯­è¨€ï¼ŒOC ä¸Šæ‰€æœ‰æ–¹æ³•çš„è°ƒç”¨/ç±»çš„ç”Ÿæˆéƒ½é€šè¿‡ Objective-C Runtime åœ¨è¿è¡Œæ—¶è¿›è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç±»å/æ–¹æ³•ååå°„å¾—åˆ°ç›¸åº”çš„ç±»å’Œæ–¹æ³•ï¼š</p>

<pre><code>Class class = NSClassFromString("UIViewController");
id viewController = [[class alloc] init];
SEL selector = NSSelectorFromString("viewDidLoad");
[viewController performSelector:selector];
</code></pre>

<p>ä¹Ÿå¯ä»¥æ›¿æ¢æŸä¸ªç±»çš„æ–¹æ³•ä¸ºæ–°çš„å®ç°ï¼š</p>

<pre><code>static void newViewDidLoad(id slf, SEL sel) {}
class_replaceMethod(class, selector, newViewDidLoad, @"");
</code></pre>

<p>è¿˜å¯ä»¥æ–°æ³¨å†Œä¸€ä¸ªç±»ï¼Œä¸ºç±»æ·»åŠ æ–¹æ³•ï¼š</p>

<pre><code>Class cls = objc_allocateClassPair(superCls, "JPObject", 0);
objc_registerClassPair(cls);
class_addMethod(cls, selector, implement, typedesc);
</code></pre>

<p>å¯¹äº Objective-C å¯¹è±¡æ¨¡å‹å’ŒåŠ¨æ€æ¶ˆæ¯å‘é€çš„åŸç†å·²æœ‰å¾ˆå¤šæ–‡ç« é˜è¿°å¾—å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†é˜è¿°äº†ã€‚ç†è®ºä¸Šä½ å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ç±»å/æ–¹æ³•åè°ƒç”¨åˆ°ä»»ä½• OC æ–¹æ³•ï¼Œæ›¿æ¢ä»»ä½•ç±»çš„å®ç°ä»¥åŠæ–°å¢ä»»æ„ç±»ã€‚æ‰€ä»¥ JSPatch çš„åŸºæœ¬åŸç†å°±æ˜¯ï¼šJS ä¼ é€’å­—ç¬¦ä¸²ç»™ OCï¼ŒOC é€šè¿‡ Runtime æ¥å£è°ƒç”¨å’Œæ›¿æ¢ OC æ–¹æ³•ã€‚è¿™æ˜¯æœ€åŸºç¡€çš„åŸç†ï¼Œå®é™…å®ç°è¿‡ç¨‹è¿˜æœ‰å¾ˆå¤šæ€ªè¦æ‰“ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“æ˜¯æ€æ ·å®ç°çš„ã€‚</p>

<h6>æ€»ç»“ï¼š</h6>

<p>ä½¿ç”¨JSåˆ©ç”¨OCçš„åŠ¨æ€ç‰¹æ€§ï¼Œæ‰§è¡Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„ä»£ç </p>

<h3>React Native</h3>

<p>RNä¸»è¦çš„é€šä¿¡åœ¨äºjavaä¸jsä¹‹é—´ï¼Œå¹³å¸¸æˆ‘ä»¬å†™çš„jsxä»£ç æœ€ç»ˆä¼šè°ƒç”¨åˆ°åŸç”Ÿçš„Viewã€‚ä¸Šä¸€ç¯‡åšå®¢æˆ‘ä»¬ä¹Ÿäº†è§£åˆ°äº†è¦æ–°å»ºä¸€ä¸ªåŸç”Ÿæ¨¡å—éœ€è¦åœ¨javaå±‚å’Œjså±‚åˆ†åˆ«å†™ä¸€ä¸ªModule</p>

<p>ç‰¹ç‚¹ï¼š</p>

<ul>
<li><p>å¯ä»¥åŸºäº React Nativeä½¿ç”¨ JavaScript ç¼–å†™åº”ç”¨é€»è¾‘ï¼ŒUI åˆ™å¯ä»¥ä¿æŒå…¨æ˜¯åŸç”Ÿçš„ã€‚è¿™æ ·çš„è¯å°±æ²¡æœ‰å¿…è¦å°± HTML5 çš„ UI åšå‡ºå¸¸è§çš„å¦¥åï¼›</p></li>
<li><p>React å¼•å…¥äº†ä¸€ç§ä¸ä¼—ä¸åŒçš„ã€ç•¥æ˜¾æ¿€è¿›ä½†å…·å¤‡é«˜å¯ç”¨æ€§çš„æ–¹æ¡ˆæ¥æ„å»ºç”¨æˆ·ç•Œé¢ã€‚é•¿è¯çŸ­è¯´ï¼Œåº”ç”¨çš„ UI ç®€å•é€šè¿‡ä¸€ä¸ªåŸºäºåº”ç”¨ç›®å‰çŠ¶æ€çš„å‡½æ•°æ¥è¡¨è¾¾ã€‚</p></li>
</ul>


<p>RNæ€»å…±åˆ†ä¸ºä¸‰å±‚ï¼Œjavaå±‚ï¼ŒC++å±‚ï¼Œjså±‚</p>

<ul>
<li>Javaå±‚ï¼šjavaå±‚å°±æ˜¯appåŸç”Ÿä»£ç ï¼Œå®ƒé€šè¿‡å¯åŠ¨C++å±‚çš„javascriptè§£æå™¨javascriptCoreæ¥æ‰§è¡Œjsä»£ç ï¼Œä»è€Œæ„å»ºåŸç”ŸUIç­‰ã€‚javaå±‚ä¾èµ–äºä¼—å¤šä¼˜ç§€å¼€æºåº“ï¼Œåœ¨å›¾ç‰‡å¤„ç†ä½¿ç”¨çš„æ˜¯Frescoï¼Œç½‘ç»œé€šä¿¡ä½¿ç”¨çš„æ˜¯okhttpï¼ŒJsonè§£æå·¥å…·ç”¨jackson,åŠ¨ç”»åº“ç”¨NineOldAndroidsç­‰ï¼Œåœ¨javaå±‚åŸç”Ÿçš„åŠŸèƒ½å‡å°è£…ä¸ºModuleï¼Œå¦‚Toastå’ŒLogç­‰ã€‚</li>
<li>C++å±‚ï¼šc++å±‚æœ€ä¸»è¦æ˜¯å°è£…äº†JavaScriptCoreï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨æ–°çš„æ”¯æŒES6çš„webKitã€‚Bridgeè¿æ¥äº†javaä¸jsä¹‹é—´çš„é€šä¿¡ã€‚è§£æjsæ–‡ä»¶æ˜¯é€šè¿‡JSCExectutorè¿›è¡Œçš„ã€‚</li>
<li>Jså±‚ï¼šä¸»è¦å¤„ç†äº‹ä»¶åˆ†å‘åŠUI Layoutï¼Œå¹³å¸¸å¼€å‘æœ€å¸¸ç”¨çš„ã€‚é€šç”¨jsxæ¥å†™ä¸šåŠ¡ä»£ç ï¼Œé€šè¿‡flexboxæ¥å®ç°å¸ƒå±€ã€‚ä¸ä¾èµ–DOMã€‚ç”±äºreactæœ‰ DOM diffè¿™ä¸ªç®—æ³•ï¼Œæ‰€ä»¥å®ƒçš„æ•ˆç‡éå¸¸é«˜ã€‚
é€šä¿¡æœºåˆ¶</li>
</ul>


<p>åœ¨Javaå±‚ä¸Jså±‚çš„bridgeåˆ†åˆ«å­˜æœ‰ç›¸åŒä¸€ä»½æ¨¡å—é…ç½®è¡¨ï¼ŒJavaä¸Jsäº’ç›¸é€šä¿¡æ—¶ï¼Œé€šè¿‡å°†é‡Œé…ç½®è¡¨ä¸­çš„moduleIDï¼ŒmethodIDè½¬æ¢æˆjsonæ•°æ®çš„å½¢å¼ä¼ é€’ç»™åˆ°C++å±‚ï¼ŒC++å±‚ä¼ é€åˆ°jså±‚ï¼Œé€šè¿‡jså±‚çš„çš„æ¨¡å—é…ç½®è¡¨æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•è¿›è¡Œæ‰§è¡Œï¼Œå¦‚æœæœ‰callbackï¼Œåˆ™å›ä¼ ç»™javaå±‚ã€‚è¿™é‡Œåªæ˜¯å¤§æ¦‚ä»‹ç»ã€‚</p>

<p>æ€»ç»“ï¼š</p>

<ul>
<li>åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè°ƒç”¨ReactActivityçš„onCreateå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼šå»åˆ›å»ºä¸€ä¸ªReactInstanceManagerImplå¯¹è±¡ã€‚é€šè¿‡ReactRootViewçš„startReactApplicationæ–¹æ³•å¼€å¯æ•´ä¸ªRNä¸–ç•Œçš„å¤§é—¨ã€‚</li>
<li>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªAsyncTaskå»åˆ›å»ºReactContext</li>
<li>åœ¨åˆ›å»ºReactContextä¸­ï¼Œæˆ‘ä»¬æŠŠæˆ‘ä»¬è‡ªå·±æ³¨å…¥å’ŒCoreModulesPackageé€šè¿‡processPackageæ–¹æ³•å°†å…¶ä¸­çš„å„ä¸ªmodulesæ³¨å…¥åˆ°äº†å¯¹åº”çš„Registryä¸­ã€‚æœ€åé€šè¿‡CatalystInstanceImplä¸­çš„ReactBridgeå°†NativeModuleå’ŒJSModuleæ³¨å†Œè¡¨é€šè¿‡jniä¼ è¾“åˆ°äº†JSå±‚ã€‚</li>
<li>javaè°ƒç”¨jsæ—¶ï¼Œä¼šåœ¨ReactApplicationContextåˆ›å»ºçš„æ—¶å€™å­˜å…¥æ³¨å†Œè¡¨ç±»JavaScriptModuleRegistryä¸­ï¼ŒåŒæ—¶é€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆä»£ç†å®ä¾‹ï¼Œå¹¶åœ¨ä»£ç†æ‹¦æˆªç±»JavaScriptModuleInvocationHandlerä¸­ç»Ÿä¸€å¤„ç†å‘å‘Javascriptçš„æ‰€æœ‰é€šä¿¡è¯·æ±‚ã€‚</li>
<li>JSCExecutorå°†æ‰€æœ‰æ¥è‡ªJavaå±‚çš„é€šä¿¡è¯·æ±‚å°è£…æˆJavascriptæ‰§è¡Œè¯­å¥ã€‚</li>
<li>æ¥ç€åœ¨jså±‚ä¸­çš„MessageQueueé‡ŒåŒ¹é…ModuleIdå’ŒMethodIdã€‚æ‰¾åˆ°è°ƒç”¨æ¨¡å—ã€‚</li>
<li>å¦‚æœæ˜¯jså±‚è°ƒç”¨javaå±‚ï¼Œjsæœ€ç»ˆéƒ½ä¼šè°ƒç”¨<em>_nativeCallæ–¹æ³•ï¼Œé€šè¿‡flushedQueueå°†this.</em>queueè¿”å›ç»™Bridgerã€‚</li>
<li>C++å±‚è°ƒç”¨PlatformBridgeCallbackå¯¹è±¡çš„onCallNativeModulesæ–¹æ³•ï¼Œæ‰§è¡ŒmakeJavaCallæ–¹æ³•ï¼Œé‡Œé¢æœ€ç»ˆé€šè¿‡env->CallVoidMethodè°ƒç”¨äº†Javaå±‚çš„æ–¹æ³•ã€‚</li>
<li>è°ƒç”¨Javaå±‚NativeModulesReactCallbackçš„callæ–¹æ³•ï¼Œé€šè¿‡moduleIDä»ä¿å­˜åœ¨å…¶å†…éƒ¨çš„NativeModuleæ˜ å°„è¡¨ï¼ŒåŒ¹é…åˆ°éœ€è¦è¢«æ‰§è¡Œçš„NativeModuleå¯¹è±¡ï¼Œå†é€šè¿‡methodIDåŒ¹é…åˆ°æ‰€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚é€šè¿‡invokeåå°„æ–¹å¼æ‰§è¡ŒNativeModuleçš„æ–¹æ³•ã€‚</li>
</ul>


<hr />

<h1>å¿…å¤‡ç¯‡</h1>

<hr />

<h5>å¤šçº¿ç¨‹</h5>

<h5>ç½‘ç»œ</h5>

<h5>æ•°æ®æŒä¹…åŒ–</h5>

<hr />

<hr />

<h1>é€šç”¨ç¯‡</h1>

<hr />

<h5>æ•°ç»„</h5>

<h5>å­—å…¸</h5>

<h5>é›†åˆ</h5>

<hr />

<p>æ›´æ–°ä¸­ï¼Œæ•¬è¯·å…³æ³¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¦åˆ©ï¼šæŠ¢çº¢åŒ…ç¥å™¨å°±æ˜¯è¿™ä¹ˆæ¥çš„]]></title>
    <link href="http://al1020119.github.io/blog/2016/08/01/weixinhongbao/"/>
    <updated>2016-08-01T11:52:15+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/08/01/weixinhongbao</id>
    <content type="html"><![CDATA[<p>å¾®ä¿¡çº¢åŒ…</p>

<p><img src="http://al1020119.github.io/images/weixinhongbao0001.jpg" title="Caption" ></p>

<p>æœ¬æ–‡æ‘˜è‡ªç®€ä¹¦å¤§ç‰›<a href="http://www.jianshu.com/p/189afbe3b429">east520</a>.</p>

<p>åˆ«å‘Šè¯‰æˆ‘ä½ å¯¹çº¢åŒ…ä¸æ„Ÿå…´è¶£ï¼Œå¦‚æœçœŸçš„æ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆè¯·ç»•é“ï¼Œå“ˆå“ˆã€‚</p>

<p>ç°åœ¨ç”±äºå¾®ä¿¡å’ŒQQçš„æ™®åŠï¼Œå‡ ä¹æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä½¿ç”¨çº¢åŒ…è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ï¼Œæ¯çœ‹åˆ°ä¸€ä¸ªå¥½çš„åŠŸèƒ½éƒ½ä¼šåŠªåŠ›è¯•ç€ç ”ç©¶ä¸€ä¸‹ï¼Œå“ªæ€•ä¸èƒ½æˆåŠŸï¼Œç”±äºçœ‹åˆ°äº†ä¸€ç¯‡æ¯”è¾ƒçœ‹çš„æ–‡ç« ï¼Œæ‰€ä»¥å°±ä¸“é—¨èŠ±æ—¶é—´å»æä¸€é¡¿ï¼Œç»“æœå¤§åƒä¸€æƒŠã€‚</p>

<p>æœ€è¿‘æœ‰ä¸å°‘æœ‹å‹æ‰¾æˆ‘è¦çº¢åŒ…å°¾æ•°çš„åŠŸèƒ½ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä»–ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¸ªï¼Œå¯èƒ½æ˜¯ç¬”è€…å¤ªå¹´è½»äº†ã€‚ä½†æ˜¯æˆ‘è§‰å¾—è¿™ä¸ªå¯èƒ½ä¸ç®€å•ï¼Œè€Œä¸”è¿™æ ·çš„åŠŸèƒ½åšå¥½äº†ä¹Ÿä¸èƒ½å¤–æ¼ï¼Œä¸ç„¶ç¬”è€…çš„ç¨‹åºå‘˜èŒä¸šç”Ÿæ¶¯ä¼°è®¡å°±åˆ°å¤´äº†ï¼</p>

<pre><code>å‰è¨€ï¼šæœ€è¿‘ç¬”è€…åœ¨ç ”ç©¶iOSé€†å‘å·¥ç¨‹ï¼Œé¡ºä¾¿æ‹¿å¾®ä¿¡æ¥ç»ƒæ‰‹ï¼Œåœ¨éè¶Šç‹±æ‰‹æœºä¸Šå®ç°äº†å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…çš„åŠŸèƒ½ã€‚
</code></pre>

<p>é¢˜å¤–è¯ï¼šæ­¤æ•™ç¨‹æ˜¯ä¸€ç¯‡ä¸¥è‚ƒçš„å­¦æœ¯æ¢è®¨ç±»æ–‡ç« ï¼Œä»…ä»…ç”¨äºå­¦ä¹ ç ”ç©¶ï¼Œä¹Ÿè¯·è¯»è€…ä¸è¦ç”¨äºå•†ä¸šæˆ–å…¶ä»–éæ³•é€”å¾„ä¸Šï¼Œç¬”è€…ä¸€æ¦‚ä¸è´Ÿè´£å“Ÿ~~</p>

<p>å¥½äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥è¿›å…¥æ­£é¢˜äº†ï¼</p>

<!--more-->


<h2>æ­¤æ•™ç¨‹æ‰€éœ€è¦çš„å·¥å…·/æ–‡ä»¶</h2>

<pre><code>yololib
class-dump
dumpdecrypted
iOSOpenDev
iTools
OpenSSH(Cydia)
iFile(Cydia)
Cycript(Cydia)
Command Line Tools
Xcode
è‹¹æœå¼€å‘è€…è¯ä¹¦æˆ–ä¼ä¸šè¯ä¹¦
ä¸€å°è¶Šç‹±çš„iPhone
</code></pre>

<p>æ˜¯çš„ï¼Œæƒ³è¦å®ç°åœ¨éè¶Šç‹±iPhoneä¸Šè¾¾åˆ°è‡ªåŠ¨æŠ¢çº¢åŒ…çš„ç›®çš„ï¼Œå·¥å…·ç”¨çš„å¯èƒ½æ˜¯æœ‰ç‚¹å¤šï¼ˆå·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨^_^ï¼‰ã€‚ä¸è¿‡ï¼Œæ²¡å…³ç³»ï¼Œå¤§å®¶å¯ä»¥æŒ‰ç…§æ•™ç¨‹çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥æ‰§è¡Œï¼Œä¸æ¸…æ¥šçš„æ­¥éª¤å¯ä»¥é‡å¤å®éªŒï¼Œæ¯•ç«Ÿå¤©ä¸Šä¸ä¼šæ‰é¦…é¥¼å˜›ã€‚</p>

<h1>è§£å¯†å¾®ä¿¡å¯æ‰§è¡Œæ–‡ä»¶(Mach-O)</h1>

<p>å› ä¸ºä»Appstoreä¸‹è½½å®‰è£…çš„åº”ç”¨éƒ½æ˜¯åŠ å¯†è¿‡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ä¸€äº›å·¥å…·æ¥ä¸ºä¸‹è½½çš„Appè§£å¯†ï¼Œä¿—ç§°ç ¸å£³ã€‚è¿™æ ·æ‰èƒ½ä¾¿äºåé¢åˆ†æAppçš„ä»£ç ç»“æ„ã€‚</p>

<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€å°å·²ç»è¶Šç‹±çš„iPhoneæ‰‹æœº(ç°åœ¨å¸‚é¢ä¸Šè¶Šç‹±å·²ç»å¾ˆæˆç†Ÿï¼Œå…·ä½“è¶Šç‹±æ–¹æ³•è¿™é‡Œå°±ä¸ä»‹ç»äº†)ã€‚ç„¶åè¿›å…¥Cydiaï¼Œå®‰è£…OpenSSHã€Cycriptã€iFile(è°ƒè¯•ç¨‹åºæ—¶å¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶)è¿™ä¸‰æ¬¾è½¯ä»¶ã€‚</p>

<pre><code>PSï¼šç¬”è€…çš„æ‰‹æœºæ˜¯iPhone 6Plusï¼Œç³»ç»Ÿç‰ˆæœ¬ä¸ºiOS9.1ã€‚
</code></pre>

<p>åœ¨ç”µè„‘ä¸Šç”¨iTunesä¸Šä¸‹è½½ä¸€ä¸ªæœ€æ–°çš„å¾®ä¿¡ï¼Œç¬”è€…å½“æ—¶ä¸‹è½½çš„å¾®ä¿¡ç‰ˆæœ¬ä¸º6.3.13ã€‚ä¸‹è½½å®Œåï¼ŒiTunesä¸Šä¼šæ˜¾ç¤ºå‡ºå·²ä¸‹è½½çš„appã€‚</p>

<p>itnues</p>

<p><img src="http://al1020119.github.io/images/weixinhongbao0002.jpg" title="Caption" ></p>

<p>è¿ä¸ŠiPhoneï¼Œç”¨iTunesè£…ä¸Šåˆšåˆšä¸‹è½½çš„å¾®ä¿¡åº”ç”¨ã€‚</p>

<p>æ‰“å¼€Macçš„ç»ˆç«¯ï¼Œç”¨sshè¿›å…¥è¿ä¸Šçš„iPhone(ç¡®ä¿iPhoneå’ŒMacåœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œç¬”è€…iPhoneçš„IPåœ°å€ä¸º192.168.8.54)ã€‚OpenSSHçš„rootå¯†ç é»˜è®¤ä¸ºalpineã€‚</p>

<p>ssh
<img src="http://al1020119.github.io/images/weixinhongbao0003.jpg" title="Caption" ></p>

<p>æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦æ‰¾åˆ°å¾®ä¿¡çš„Bundle idäº†ï¼Œï¼Œè¿™é‡Œç¬”è€…æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠiPhoneä¸Šçš„æ‰€æœ‰Appéƒ½å…³æ‰ï¼Œå”¯ç‹¬ä¿ç•™å¾®ä¿¡ï¼Œç„¶åè¾“å…¥å‘½ä»¤ ps -e</p>

<p>å¾®ä¿¡bundle id
<img src="http://al1020119.github.io/images/weixinhongbao0004.jpg" title="Caption" ><br/>
è¿™æ ·æˆ‘ä»¬å°±æ‰¾åˆ°äº†å¾®ä¿¡çš„å¯æ‰§è¡Œæ–‡ä»¶Wechatçš„å…·ä½“è·¯å¾„äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç”¨Cycriptæ‰¾å‡ºå¾®ä¿¡çš„Documentsçš„è·¯å¾„ï¼Œè¾“å…¥å‘½ä»¤cycript -p WeChat</p>

<p>cycript
<img src="http://al1020119.github.io/images/weixinhongbao0005.jpg" title="Caption" ></p>

<pre><code>ç¼–è¯‘dumpdecrypted
å…ˆè®°ä¸‹åˆšåˆšæˆ‘ä»¬è·å–åˆ°çš„ä¸¤ä¸ªè·¯å¾„(Bundleå’ŒDocuments)ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±è¦å¼€å§‹ç”¨dumpdecryptedæ¥ä¸ºå¾®ä¿¡äºŒè¿›åˆ¶æ–‡ä»¶(WeChat)ç ¸å£³äº†ã€‚
ç¡®ä¿æˆ‘ä»¬ä»Githubä¸Šä¸‹è½½äº†æœ€æ–°çš„dumpdecryptedæºç ï¼Œè¿›å…¥dumpdecryptedæºç çš„ç›®å½•ï¼Œç¼–è¯‘dumpdecrypted.dylibï¼Œå‘½ä»¤å¦‚ä¸‹:
</code></pre>

<p>dumpdecrypted.dylib
<img src="http://al1020119.github.io/images/weixinhongbao0006.jpg" title="Caption" ><br/>
è¿™æ ·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°dumpdecryptedç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªdumpdecrypted.dylibçš„æ–‡ä»¶ã€‚</p>

<pre><code>scp
æ‹·è´dumpdecrypted.dylibåˆ°iPhoneä¸Šï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°scpå‘½ä»¤.
scp æºæ–‡ä»¶è·¯å¾„ ç›®æ ‡æ–‡ä»¶è·¯å¾„ ã€‚å…·ä½“å¦‚ä¸‹ï¼š
</code></pre>

<p>scp
<img src="http://al1020119.github.io/images/weixinhongbao0007.jpg" title="Caption" ><br/>
    å¼€å§‹ç ¸å£³
    dumpdecrypted.dylibçš„å…·ä½“ç”¨æ³•æ˜¯ï¼šDYLD_INSERT_LIBRARIES=/PathFrom/dumpdecrypted.dylib /PathTo</p>

<p>dumpdecrypted
<img src="http://al1020119.github.io/images/weixinhongbao0008.jpg" title="Caption" ><br/>
è¿™æ ·å°±ä»£è¡¨ç ¸å£³æˆåŠŸäº†ï¼Œå½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆç ¸å£³åçš„æ–‡ä»¶ï¼Œå³WeChat.decryptedã€‚åŒæ ·ç”¨scpå‘½ä»¤æŠŠWeChat.decryptedæ–‡ä»¶æ‹·è´åˆ°ç”µè„‘ä¸Š,æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ­£å¼çš„dumpå¾®ä¿¡çš„å¯æ‰§è¡Œæ–‡ä»¶äº†ã€‚</p>

<h1>dumpå¾®ä¿¡å¯æ‰§è¡Œæ–‡ä»¶</h1>

<pre><code>ä»Githubä¸Šä¸‹è½½æœ€æ–°çš„class-dumpæºä»£ç ï¼Œç„¶åç”¨Xcodeç¼–è¯‘å³å¯ç”Ÿæˆclass-dump(è¿™é‡Œæ¯”è¾ƒç®€å•ï¼Œç¬”è€…å°±ä¸è¯¦ç»†è¯´æ˜äº†)ã€‚

å¯¼å‡ºå¾®ä¿¡çš„å¤´æ–‡ä»¶
ä½¿ç”¨class-dumpå‘½ä»¤,æŠŠåˆšåˆšç ¸å£³åçš„WeChat.decrypted,å¯¼å‡ºå…¶ä¸­çš„å¤´æ–‡ä»¶ã€‚./class-dump -s -S -H ./WeChat.decrypted -o ./header6.3-arm64
</code></pre>

<p>å¯¼å‡ºçš„å¤´æ–‡ä»¶
<img src="http://al1020119.github.io/images/weixinhongbao0009.jpg" title="Caption" ><br/>
è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªXcodeé¡¹ç›®ï¼ŒæŠŠåˆšåˆšå¯¼å‡ºçš„å¤´æ–‡ä»¶åŠ åˆ°æ–°å»ºçš„é¡¹ç›®ä¸­ï¼Œè¿™æ ·ä¾¿äºæŸ¥æ‰¾å¾®ä¿¡çš„ç›¸å…³ä»£ç ã€‚</p>

<p>å¾®ä¿¡çš„å¤´æ–‡ä»¶
<img src="http://al1020119.github.io/images/weixinhongbao0010.jpg" title="Caption" ><br/>
æ‰¾åˆ°CMessageMgr.hå’ŒWCRedEnvelopesLogicMgr.hè¿™ä¸¤æ–‡ä»¶ï¼Œå…¶ä¸­æˆ‘ä»¬æ³¨æ„åˆ°æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š- (void)AsyncOnAddMsg:(id)arg1 MsgWrap:(id)arg2; ï¼Œ- (void)OpenRedEnvelopesRequest:(id)arg1;ã€‚æ²¡é”™ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ˜¯è¦åˆ©ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥å®ç°å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…åŠŸèƒ½ã€‚å…¶å®ç°åŸç†æ˜¯ï¼Œé€šè¿‡hookå¾®ä¿¡çš„æ–°æ¶ˆæ¯å‡½æ•°ï¼Œæˆ‘ä»¬åˆ¤æ–­æ˜¯å¦ä¸ºçº¢åŒ…æ¶ˆæ¯ï¼Œå¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°±è°ƒç”¨å¾®ä¿¡çš„æ‰“å¼€çº¢åŒ…æ–¹æ³•ã€‚è¿™æ ·å°±èƒ½è¾¾åˆ°è‡ªåŠ¨æŠ¢çº¢åŒ…çš„ç›®çš„äº†ã€‚å“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å§ã€‚</p>

<pre><code>æ–°å»ºä¸€ä¸ªdylibå·¥ç¨‹ï¼Œå› ä¸ºXcodeé»˜è®¤ä¸æ”¯æŒç”Ÿæˆdylibï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸‹è½½iOSOpenDevï¼Œå®‰è£…å®Œæˆå(Xcode7ç¯å¢ƒä¼šæç¤ºå®‰è£…iOSOpenDevå¤±è´¥ï¼Œè¯·å‚è€ƒiOSOpenDevå®‰è£…é—®é¢˜)ï¼Œé‡æ–°æ‰“å¼€Xcodeï¼Œåœ¨æ–°å»ºé¡¹ç›®çš„é€‰é¡¹ä¸­å³å¯çœ‹åˆ°iOSOpenDevé€‰é¡¹äº†ã€‚
</code></pre>

<p>iOSOpenDev
<img src="http://al1020119.github.io/images/weixinhongbao0011.jpg" title="Caption" ><br/>
    dylibä»£ç 
    é€‰æ‹©Cocoa Touch Libraryï¼Œè¿™æ ·æˆ‘ä»¬å°±æ–°å»ºäº†ä¸€ä¸ªdylibå·¥ç¨‹äº†ï¼Œæˆ‘ä»¬å‘½åä¸ºautoGetRedEnvã€‚</p>

<pre><code>åˆ é™¤autoGetRedEnv.hæ–‡ä»¶ï¼Œä¿®æ”¹autoGetRedEnv.mä¸ºautoGetRedEnv.mmï¼Œç„¶ååœ¨é¡¹ç›®ä¸­åŠ å…¥CaptainHook.h

å› ä¸ºå¾®ä¿¡ä¸ä¼šä¸»åŠ¨æ¥åŠ è½½æˆ‘ä»¬çš„hookä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠhooké€»è¾‘å†™åˆ°æ„é€ å‡½æ•°ä¸­ã€‚

__attribute__((constructor)) static void entry()
{
  //å…·ä½“hookæ–¹æ³•
}

hookå¾®ä¿¡çš„AsyncOnAddMsg: MsgWrap:æ–¹æ³•ï¼Œå®ç°æ–¹æ³•å¦‚ä¸‹ï¼š

//å£°æ˜CMessageMgrç±»
CHDeclareClass(CMessageMgr);
CHMethod(2, void, CMessageMgr, AsyncOnAddMsg, id, arg1, MsgWrap, id, arg2)
{
  //è°ƒç”¨åŸæ¥çš„AsyncOnAddMsg:MsgWrap:æ–¹æ³•
  CHSuper(2, CMessageMgr, AsyncOnAddMsg, arg1, MsgWrap, arg2);
  //å…·ä½“æŠ¢çº¢åŒ…é€»è¾‘
  //...
  //è°ƒç”¨åŸç”Ÿçš„æ‰“å¼€çº¢åŒ…çš„æ–¹æ³•
  //æ³¨æ„è¿™é‡Œå¿…é¡»ä¸ºç»™objc_msgSendçš„ç¬¬ä¸‰ä¸ªå‚æ•°å£°æ˜ä¸ºNSMutableDictionary,ä¸ç„¶è°ƒç”¨objc_msgSendæ—¶ï¼Œä¸ä¼šè§¦å‘æ‰“å¼€çº¢åŒ…çš„æ–¹æ³•
  ((void (*)(id, SEL, NSMutableDictionary*))objc_msgSend)(logicMgr, @selector(OpenRedEnvelopesRequest:), params);
}
__attribute__((constructor)) static void entry()
{
  //åŠ è½½CMessageMgrç±»
  CHLoadLateClass(CMessageMgr);
  //hook AsyncOnAddMsg:MsgWrap:æ–¹æ³•
  CHClassHook(2, CMessageMgr, AsyncOnAddMsg, MsgWrap);
}

    é¡¹ç›®çš„å…¨éƒ¨ä»£ç ï¼Œç¬”è€…å·²æ”¾å…¥Githubä¸­ã€‚

å®Œæˆå¥½å…·ä½“å®ç°é€»è¾‘åï¼Œå°±å¯ä»¥é¡ºåˆ©ç”Ÿæˆdylibäº†ã€‚
</code></pre>

<h1>é‡æ–°æ‰“åŒ…å¾®ä¿¡App</h1>

<pre><code>ä¸ºå¾®ä¿¡å¯æ‰§è¡Œæ–‡ä»¶æ³¨å…¥dylib
è¦æƒ³å¾®ä¿¡åº”ç”¨è¿è¡Œåï¼Œèƒ½æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œé¦–å…ˆéœ€è¦å¾®ä¿¡åŠ å…¥æˆ‘ä»¬çš„dylibï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°ä¸€ä¸ªdylibæ³¨å…¥ç¥å™¨:yololibï¼Œä»ç½‘ä¸Šä¸‹è½½æºä»£ç ï¼Œç¼–è¯‘åå¾—åˆ°yololibã€‚

ä½¿ç”¨yololibç®€å•çš„æ‰§è¡Œä¸‹é¢ä¸€å¥å°±å¯ä»¥æˆåŠŸå®Œæˆæ³¨å…¥ã€‚æ³¨å…¥ä¹‹å‰æˆ‘ä»¬å…ˆæŠŠä¹‹å‰ä¿å­˜çš„WeChat.decryptedé‡å‘½åä¸ºWeChatï¼Œå³å·²ç ¸å®Œå£³çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
./yololib ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶ éœ€æ³¨å…¥çš„dylib
æ³¨å…¥æˆåŠŸåå³å¯è§åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š

dylibæ³¨å…¥
</code></pre>

<p><img src="http://al1020119.github.io/images/weixinhongbao0012.jpg" title="Caption" ><br/>
    æ–°å»ºEntitlements.plist</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
  &lt;key&gt;application-identifier&lt;/key&gt;
  &lt;string&gt;123456.com.autogetredenv.demo&lt;/string&gt;
  &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt;
  &lt;string&gt;123456&lt;/string&gt;
  &lt;key&gt;get-task-allow&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;keychain-access-groups&lt;/key&gt;
  &lt;array&gt;
      &lt;string&gt;123456.com.autogetredenv.demo&lt;/string&gt;
  &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;

è¿™é‡Œå¤§å®¶ä¹Ÿè®¸ä¸æ¸…æ¥šè‡ªå·±çš„è¯ä¹¦TeamidåŠå…¶ä»–ä¿¡æ¯ï¼Œæ²¡å…³ç³»ï¼Œç¬”è€…è¿™é‡Œæœ‰ä¸€ä¸ªå°çªé—¨ï¼Œå¤§å®¶å¯ä»¥æ‰¾åˆ°ä¹‹å‰ç”¨å¼€å‘è€…è¯ä¹¦æˆ–ä¼ä¸šè¯ä¹¦æ‰“åŒ…è¿‡çš„App(ä¾‹å¦‚å«Demo)ï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š
./ldid -e ./Demo.app/demo

ç»™å¾®ä¿¡é‡æ–°ç­¾å
æ¥ä¸‹æ¥æŠŠæˆ‘ä»¬ç”Ÿæˆçš„dylib(libautoGetRedEnv.dylib)ã€åˆšåˆšæ³¨å…¥dylibçš„WeChatã€ä»¥åŠembedded.mobileprovisionæ–‡ä»¶(å¯ä»¥åœ¨ä¹‹å‰æ‰“åŒ…è¿‡çš„Appä¸­æ‰¾åˆ°)æ‹·è´åˆ°WeChat.appä¸­ã€‚

å‘½ä»¤æ ¼å¼ï¼šcodesign -f -s è¯ä¹¦åå­— ç›®æ ‡æ–‡ä»¶

    PS:è¯ä¹¦åå­—å¯ä»¥åœ¨é’¥åŒ™ä¸²ä¸­æ‰¾åˆ°

åˆ†åˆ«ç”¨codesignå‘½ä»¤æ¥ä¸ºå¾®ä¿¡ä¸­çš„ç›¸å…³æ–‡ä»¶ç­¾å,å…·ä½“å®ç°å¦‚ä¸‹ï¼š

é‡æ–°ç­¾å
</code></pre>

<p><img src="http://al1020119.github.io/images/weixinhongbao0013.jpg" title="Caption" ><br/>
    æ‰“åŒ…æˆipa
    ç»™å¾®ä¿¡é‡æ–°ç­¾ååï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨xcrunæ¥ç”Ÿæˆipaäº†ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š
    xcrun -sdk iphoneos PackageApplication -v WeChat.app  -o ~/WeChat.ipa</p>

<h1>å®‰è£…æ‹¥æœ‰æŠ¢çº¢åŒ…åŠŸèƒ½çš„å¾®ä¿¡</h1>

<p>ä»¥ä¸Šæ­¥éª¤å¦‚æœéƒ½æˆåŠŸå®ç°çš„è¯ï¼Œé‚£ä¹ˆçœŸçš„å°±æ˜¯ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£äº†~~~</p>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨iToolså·¥å…·ï¼Œæ¥ä¸ºiPhone(æ­¤iPhone Device idéœ€åŠ å…¥è¯ä¹¦ä¸­)å®‰è£…æ”¹è‰¯è¿‡çš„å¾®ä¿¡äº†ã€‚</p>

<p>iTools
<img src="http://al1020119.github.io/images/weixinhongbao0014.jpg" title="Caption" ></p>

<h1>å¤§å·¥å‘Šæˆï¼ï¼</h1>

<p>å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹hookè¿‡çš„å¾®ä¿¡æŠ¢çº¢åŒ…æ•ˆæœäº†~</p>

<p>è‡ªåŠ¨æŠ¢çº¢åŒ…
<img src="http://al1020119.github.io/images/weixinhongbao0015.gif" title="Caption" ><br/>
å“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆçˆ½å•Šï¼Œ"å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘æŠ¢çº¢åŒ…äº†ã€‚"ã€‚å¤§å®¶å¦‚æœæœ‰å…´è¶£å¯ä»¥ç»§ç»­hookå¾®ä¿¡çš„å…¶ä»–å‡½æ•°ï¼Œè¿™æ ·æ—¢åŠ å¼ºäº†å­¦ä¹ ï¼Œåˆæ»¡è¶³äº†è‡ªå·±çš„ç‰¹(zhuang)æ®Š(bi)éœ€æ±‚å˜›ã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é‡æ•´ä¹‹é“ï¼ˆé¢è¯•+æŠ€æœ¯+åº•å±‚+é«˜çº§ï¼‰]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/26/chongzhengzhidao/"/>
    <updated>2016-07-26T13:53:19+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/26/chongzhengzhidao</id>
    <content type="html"><![CDATA[<p>é‡æ•´ä¹‹é“ï¼ˆé¢è¯•+æŠ€æœ¯+åº•å±‚+é«˜çº§ï¼‰</p>

<p>ä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ã€‚</p>

<p>æˆ‘ï¼Œå°±æ˜¯è¿™ä¹ˆæœ‰å°¿æ€§ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>

<p>å‰é¢ä¸‰éƒ¨åˆ†å·²ç»åŸºæœ¬ä¸Šå®Œæˆï¼Œåé¢éƒ¨åˆ†ä¼šé™†ç»­æ›´æ–°ï¼Œæ•¬è¯·æœŸå¾…ã€‚ä½†æ˜¯å…‰é ä¸€ç¯‡è¿™ä¹ˆçŸ­çš„æ–‡ç« æƒ³å°†é€šè¿™äº›äº‹ä¸å¯èƒ½çš„ï¼Œè¿™é‡Œä¸»è¦æ­£å¯¹é¢è¯•æ—ï¼Œæˆ–è€…å¥å¿˜æ—ï¼Œäº¦æˆ–è€…æ˜¯è£…é€¼æ—ã€‚å¥½äº†åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼</p>

<ul>
<li>è¿è¡Œæ—¶ï¼ˆåº•å±‚ï¼‰</li>
<li>RunLoopï¼ˆåº•å±‚ï¼‰</li>
<li>å¤šçº¿ç¨‹ï¼ˆåº•å±‚ä¸å®‰å…¨ï¼‰</li>
</ul>


<hr />

<ul>
<li>ç½‘ç»œï¼ˆåº•å±‚ä¸å®‰å…¨ï¼‰</li>
<li>æ•°æ®æŒä¹…åŒ–ï¼ˆå„ç§ä½¿ç”¨ä¸åŒºåˆ«ï¼‰ï¼ˆCoreDataã€SQLiteï¼‰</li>
<li>Blockï¼ˆåº•å±‚/__Blockï¼‰</li>
<li>éŸ³è§†é¢‘</li>
<li>ç›´æ’­</li>
<li>å®‰å…¨</li>
<li>ä¼˜åŒ–ï¼ˆæ€§èƒ½ã€å¡é¡¿ï¼‰</li>
<li>å¸¸è§é”™è¯¯</li>
<li>å¸¸ç”¨æŠ€æœ¯</li>
<li>å…¨æ ˆç›¸å…³</li>
<li>ç®—æ³•ï¼ˆå¸¸ç”¨ã€æ’åºï¼‰</li>
<li>æ•°æ®ç»“æ„</li>
<li>è®¾è®¡æ¨¡å¼ï¼ˆ32ä¸­ï¼‰</li>
<li>æ¶æ„è®¾è®¡</li>
<li>é€†å‘å·¥ç¨‹</li>
<li>å®æˆ˜åº”ç”¨</li>
</ul>


<!--more-->


<h3>è¿è¡Œæ—¶ï¼ˆåº•å±‚ï¼‰</h3>

<h6>ä»‹ç»</h6>

<p>runtimeæ˜¯ä¸€ä¸ªcå’Œæ±‡ç¼–å†™çš„åŠ¨æ€åº“(æ„Ÿè°¢Lisionçš„æŒ‡æ­£)ï¼Œæ˜¯ä¸€å¥—æ¯”è¾ƒåº•å±‚çš„Cè¯­è¨€APIï¼Œå±äºä¸€ä¸ªCè¯­è¨€åº“ï¼Œå¹³æ—¶æˆ‘ä»¬æ‰€å†™çš„OCä»£ç ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æˆruntimeçš„Cè¯­è¨€ä»£ç å»æ‰§è¡Œã€‚</p>

<p>è¿™ä¸ªç³»ç»Ÿä¸»è¦åšä¸¤ä»¶äº‹ ï¼š</p>

<ol>
<li>å°è£…Cè¯­è¨€çš„ç»“æ„ä½“å’Œå‡½æ•°ï¼Œè®©å¼€å‘è€…åœ¨è¿è¡Œæ—¶åˆ›å»ºã€æ£€æŸ¥æˆ–è€…ä¿®æ”¹ç±»ã€å¯¹è±¡å’Œæ–¹æ³•ç­‰ç­‰ã€‚</li>
<li>ä¼ é€’æ¶ˆæ¯ï¼Œæ‰¾å‡ºæ–¹æ³•çš„æœ€ç»ˆæ‰§è¡Œä»£ç ã€‚</li>
</ol>


<h6>å¸¸ç”¨å…³é”®å­—</h6>

<p>è¦æƒ³å…¨é¢äº†è§£ Runtime æœºåˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆäº†è§£ Runtime çš„ä¸€äº›æœ¯è¯­ï¼Œä»–ä»¬éƒ½å¯¹åº”ç€æ•°æ®ç»“æ„ã€‚</p>

<p>SEL</p>

<pre><code>å®ƒæ˜¯selectoråœ¨ Objc ä¸­çš„è¡¨ç¤º(Swift ä¸­æ˜¯ Selector ç±»)ã€‚selector æ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼Œå…¶å®ä½œç”¨å°±å’Œåå­—ä¸€æ ·ï¼Œæ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡äººåè¾¨åˆ«è°æ˜¯è°ï¼Œæ³¨æ„ Objc åœ¨ç›¸åŒçš„ç±»ä¸­ä¸ä¼šæœ‰å‘½åç›¸åŒçš„ä¸¤ä¸ªæ–¹æ³•ã€‚selector å¯¹æ–¹æ³•åè¿›è¡ŒåŒ…è£…ï¼Œä»¥ä¾¿æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚å®ƒçš„æ•°æ®ç»“æ„æ˜¯ï¼š

typedef struct objc_selector *SEL;

æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸ªæ˜ å°„åˆ°æ–¹æ³•çš„ C å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥é€šè¿‡ Objc ç¼–è¯‘å™¨å™¨å‘½ä»¤@selector() æˆ–è€… Runtime ç³»ç»Ÿçš„ sel_registerName å‡½æ•°æ¥è·å–ä¸€ä¸ª SEL ç±»å‹çš„æ–¹æ³•é€‰æ‹©å™¨ã€‚

æ³¨æ„ï¼š
ä¸åŒç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•æ‰€å¯¹åº”çš„ selector æ˜¯ç›¸åŒçš„ï¼Œç”±äºå˜é‡çš„ç±»å‹ä¸åŒï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´å®ƒä»¬è°ƒç”¨æ–¹æ³•å®ç°æ··ä¹±ã€‚
</code></pre>

<p>id</p>

<pre><code>id æ˜¯ä¸€ä¸ªå‚æ•°ç±»å‹ï¼Œå®ƒæ˜¯æŒ‡å‘æŸä¸ªç±»çš„å®ä¾‹çš„æŒ‡é’ˆã€‚å®šä¹‰å¦‚ä¸‹ï¼š

ä»¥ä¸Šå®šä¹‰ï¼Œçœ‹åˆ° objc_object ç»“æ„ä½“åŒ…å«ä¸€ä¸ª isa æŒ‡é’ˆï¼Œæ ¹æ® isa æŒ‡é’ˆå°±å¯ä»¥æ‰¾åˆ°å¯¹è±¡æ‰€å±çš„ç±»ã€‚

æ³¨æ„ï¼š
isa æŒ‡é’ˆåœ¨ä»£ç è¿è¡Œæ—¶å¹¶ä¸æ€»æŒ‡å‘å®ä¾‹å¯¹è±¡æ‰€å±çš„ç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½ä¾é å®ƒæ¥ç¡®å®šç±»å‹ï¼Œè¦æƒ³ç¡®å®šç±»å‹è¿˜æ˜¯éœ€è¦ç”¨å¯¹è±¡çš„ -class æ–¹æ³•ã€‚

PS:KVO çš„å®ç°æœºç†å°±æ˜¯å°†è¢«è§‚å¯Ÿå¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»è€Œä¸æ˜¯çœŸå®ç±»å‹ï¼Œè¯¦è§:KVOç« èŠ‚ã€‚
</code></pre>

<p>Class</p>

<pre><code>typedef struct objc_class *Class;

Class å…¶å®æ˜¯æŒ‡å‘ objc_class ç»“æ„ä½“çš„æŒ‡é’ˆã€‚

ä¸€ä¸ªè¿è¡Œæ—¶ç±»ä¸­å…³è”äº†å®ƒçš„çˆ¶ç±»æŒ‡é’ˆã€ç±»åã€æˆå‘˜å˜é‡ã€æ–¹æ³•ã€ç¼“å­˜ä»¥åŠé™„å±çš„åè®®ã€‚


ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€ä¿®æ”¹ *methodList çš„å€¼æ¥æ·»åŠ æˆå‘˜æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ Category å®ç°çš„åŸç†ï¼ŒåŒæ ·è§£é‡Šäº† Category ä¸èƒ½æ·»åŠ å±æ€§çš„åŸå› ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒä¸‹ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„æ–‡ç« ï¼šæ·±å…¥ç†è§£ Objective-C: Categoryã€‚

objc_ivar_list ç»“æ„ä½“ç”¨æ¥å­˜å‚¨æˆå‘˜å˜é‡çš„åˆ—è¡¨ï¼Œè€Œ objc_ivar åˆ™æ˜¯å­˜å‚¨äº†å•ä¸ªæˆå‘˜å˜é‡çš„ä¿¡æ¯ï¼›åŒç†ï¼Œobjc_method_list ç»“æ„ä½“å­˜å‚¨ç€æ–¹æ³•æ•°ç»„çš„åˆ—è¡¨ï¼Œè€Œå•ä¸ªæ–¹æ³•çš„ä¿¡æ¯åˆ™ç”± objc_method ç»“æ„ä½“å­˜å‚¨ã€‚

å€¼å¾—æ³¨æ„çš„æ—¶ï¼Œobjc_class ä¸­ä¹Ÿæœ‰ä¸€ä¸ª isa æŒ‡é’ˆï¼Œè¿™è¯´æ˜ Objc ç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ä¸ºäº†å¤„ç†ç±»å’Œå¯¹è±¡çš„å…³ç³»ï¼ŒRuntime åº“åˆ›å»ºäº†ä¸€ç§å«åš Meta Class(å…ƒç±») çš„ä¸œè¥¿ï¼Œç±»å¯¹è±¡æ‰€å±çš„ç±»å°±å«åšå…ƒç±»ã€‚Meta Class è¡¨è¿°äº†ç±»å¯¹è±¡æœ¬èº«æ‰€å…·å¤‡çš„å…ƒæ•°æ®ã€‚

æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ç±»æ–¹æ³•ï¼Œå°±æºè‡ªäº Meta Classã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºç±»æ–¹æ³•å°±æ˜¯ç±»å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ã€‚æ¯ä¸ªç±»ä»…æœ‰ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè€Œæ¯ä¸ªç±»å¯¹è±¡ä»…æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„å…ƒç±»ã€‚

å½“ä½ å‘å‡ºä¸€ä¸ªç±»ä¼¼ [NSObject alloc](ç±»æ–¹æ³•) çš„æ¶ˆæ¯æ—¶ï¼Œå®é™…ä¸Šï¼Œè¿™ä¸ªæ¶ˆæ¯è¢«å‘é€ç»™äº†ä¸€ä¸ªç±»å¯¹è±¡(Class Object)ï¼Œè¿™ä¸ªç±»å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªå…ƒç±»çš„å®ä¾‹ï¼Œè€Œè¿™ä¸ªå…ƒç±»åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ ¹å…ƒç±»(Root Meta Class)çš„å®ä¾‹ã€‚æ‰€æœ‰å…ƒç±»çš„ isa æŒ‡é’ˆæœ€ç»ˆéƒ½æŒ‡å‘æ ¹å…ƒç±»ã€‚

æ‰€ä»¥å½“ [NSObject alloc] è¿™æ¡æ¶ˆæ¯å‘é€ç»™ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œè¿è¡Œæ—¶ä»£ç  objc_msgSend() ä¼šå»å®ƒå…ƒç±»ä¸­æŸ¥æ‰¾èƒ½å¤Ÿå“åº”æ¶ˆæ¯çš„æ–¹æ³•å®ç°ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ä¼šå¯¹è¿™ä¸ªç±»å¯¹è±¡æ‰§è¡Œæ–¹æ³•è°ƒç”¨ã€‚



super_class æŒ‡é’ˆï¼Œè™šçº¿æ—¶ isa æŒ‡é’ˆã€‚è€Œæ ¹å…ƒç±»çš„çˆ¶ç±»æ˜¯ NSObjectï¼ŒisaæŒ‡å‘äº†è‡ªå·±ã€‚è€Œ NSObject æ²¡æœ‰çˆ¶ç±»ã€‚

æœ€å objc_class ä¸­è¿˜æœ‰ä¸€ä¸ª objc_cache ï¼Œç¼“å­˜ï¼Œå®ƒçš„ä½œç”¨å¾ˆé‡è¦ï¼Œåé¢ä¼šæåˆ°ã€‚
</code></pre>

<p>Method</p>

<pre><code>Method ä»£è¡¨ç±»ä¸­æŸä¸ªæ–¹æ³•çš„ç±»å‹

typedef struct objc_method *Method;

objc_method å­˜å‚¨äº†æ–¹æ³•åï¼Œæ–¹æ³•ç±»å‹å’Œæ–¹æ³•å®ç°ï¼š

æ–¹æ³•åç±»å‹ä¸º SEL
æ–¹æ³•ç±»å‹ method_types æ˜¯ä¸ª char æŒ‡é’ˆï¼Œå­˜å‚¨æ–¹æ³•çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹
method_imp æŒ‡å‘äº†æ–¹æ³•çš„å®ç°ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ
</code></pre>

<p>Ivar</p>

<pre><code>Ivar æ˜¯è¡¨ç¤ºæˆå‘˜å˜é‡çš„ç±»å‹ã€‚

typedef struct objc_ivar *Ivar;


å…¶ä¸­ ivar_offset æ˜¯åŸºåœ°å€åç§»å­—èŠ‚
</code></pre>

<p>IMP</p>

<pre><code>IMPåœ¨objc.hä¸­çš„å®šä¹‰æ˜¯ï¼š

typedef id (*IMP)(id, SEL, ...);

å®ƒå°±æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¿™æ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ã€‚å½“ä½ å‘èµ·ä¸€ä¸ª ObjC æ¶ˆæ¯ä¹‹åï¼Œæœ€ç»ˆå®ƒä¼šæ‰§è¡Œçš„é‚£æ®µä»£ç ï¼Œå°±æ˜¯ç”±è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å®šçš„ã€‚è€Œ IMP è¿™ä¸ªå‡½æ•°æŒ‡é’ˆå°±æŒ‡å‘äº†è¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚

å¦‚æœå¾—åˆ°äº†æ‰§è¡ŒæŸä¸ªå®ä¾‹æŸä¸ªæ–¹æ³•çš„å…¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»•å¼€æ¶ˆæ¯ä¼ é€’é˜¶æ®µï¼Œç›´æ¥æ‰§è¡Œæ–¹æ³•ï¼Œè¿™åœ¨åé¢ Cache ä¸­ä¼šæåˆ°ã€‚

ä½ ä¼šå‘ç° IMP æŒ‡å‘çš„æ–¹æ³•ä¸ objc_msgSend å‡½æ•°ç±»å‹ç›¸åŒï¼Œå‚æ•°éƒ½åŒ…å« id å’Œ SEL ç±»å‹ã€‚æ¯ä¸ªæ–¹æ³•åéƒ½å¯¹åº”ä¸€ä¸ª SEL ç±»å‹çš„æ–¹æ³•é€‰æ‹©å™¨ï¼Œè€Œæ¯ä¸ªå®ä¾‹å¯¹è±¡ä¸­çš„ SEL å¯¹åº”çš„æ–¹æ³•å®ç°è‚¯å®šæ˜¯å”¯ä¸€çš„ï¼Œé€šè¿‡ä¸€ç»„ idå’Œ SEL å‚æ•°å°±èƒ½ç¡®å®šå”¯ä¸€çš„æ–¹æ³•å®ç°åœ°å€ã€‚

è€Œä¸€ä¸ªç¡®å®šçš„æ–¹æ³•ä¹Ÿåªæœ‰å”¯ä¸€çš„ä¸€ç»„ id å’Œ SEL å‚æ•°ã€‚
</code></pre>

<p>Cache</p>

<pre><code>typedef struct objc_cache *Cache

Cache ä¸ºæ–¹æ³•è°ƒç”¨çš„æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œæ¯å½“å®ä¾‹å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå®ƒä¸ä¼šç›´æ¥åœ¨ isa æŒ‡é’ˆæŒ‡å‘çš„ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­éå†æŸ¥æ‰¾èƒ½å¤Ÿå“åº”çš„æ–¹æ³•ï¼Œå› ä¸ºæ¯æ¬¡éƒ½è¦æŸ¥æ‰¾æ•ˆç‡å¤ªä½äº†ï¼Œè€Œæ˜¯ä¼˜å…ˆåœ¨ Cache ä¸­æŸ¥æ‰¾ã€‚

Runtime ç³»ç»Ÿä¼šæŠŠè¢«è°ƒç”¨çš„æ–¹æ³•å­˜åˆ° Cache ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå®ƒæœ‰å¯èƒ½ä»Šåè¿˜ä¼šè¢«è°ƒç”¨ï¼Œä¸‹æ¬¡æŸ¥æ‰¾çš„æ—¶å€™å°±ä¼šæ•ˆç‡æ›´é«˜ã€‚å°±åƒè®¡ç®—æœºç»„æˆåŸç†ä¸­ CPU ç»•è¿‡ä¸»å­˜å…ˆè®¿é—® Cache ä¸€æ ·ã€‚
</code></pre>

<p>Property
    typedef struct objc_property *objc_property_t;//è¿™ä¸ªæ›´å¸¸ç”¨</p>

<pre><code>å¯ä»¥é€šè¿‡class_copyPropertyList å’Œ protocol_copyPropertyList æ–¹æ³•è·å–ç±»å’Œåè®®ä¸­çš„å±æ€§ï¼š

æ³¨æ„ï¼š
è¿”å›çš„æ˜¯å±æ€§åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª objc_property_t æŒ‡é’ˆ
</code></pre>

<h6>åŠ¨æ€ç‰¹æ€§</h6>

<pre><code>Objective-Cå…·æœ‰ç›¸å½“å¤šçš„åŠ¨æ€ç‰¹æ€§ï¼ŒåŸºæœ¬çš„ï¼Œä¹Ÿæ˜¯ç»å¸¸è¢«æåˆ°å’Œç”¨åˆ°çš„æœ‰

    åŠ¨æ€ç±»å‹ï¼ˆDynamic typingï¼‰
    åŠ¨æ€ç»‘å®šï¼ˆDynamic bindingï¼‰
    åŠ¨æ€åŠ è½½ï¼ˆDynamic loadingï¼‰

åŠ¨æ€ç±»å‹ï¼šç¨‹åºç›´åˆ°æ‰§è¡Œæ—¶æ‰èƒ½ç¡®å®šæ‰€å±çš„ç±»ã€‚

id æ•°æ®ç±»å‹ï¼Œid é€šç”¨çš„å¯¹è±¡ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œidåé¢æ²¡æœ‰å·ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸ªæŒ‡é’ˆï¼Œç±»ä¼¼äºvoid ï¼Œä½†åªå¯ä»¥æŒ‡å‘å¯¹è±¡ç±»å‹

é™æ€ç±»å‹ä¸åŠ¨æ€ç±»å‹

    ç¼–è¯‘æœŸæ£€æŸ¥ä¸è¿è¡Œæ—¶æ£€æŸ¥
    é™æ€ç±»å‹åœ¨ç¼–è¯‘æœŸå°±èƒ½æ£€æŸ¥å‡ºé”™è¯¯
    é™æ€ç±»å‹å£°æ˜ä»£ç å¯è¯»æ€§å¥½
    åŠ¨æ€ç±»å‹åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯

åŠ¨æ€ç»‘å®šï¼šç¨‹åºç›´åˆ°æ‰§è¡Œæ—¶æ‰èƒ½ç¡®å®šå®é™…è¦è°ƒç”¨çš„æ–¹æ³•ã€‚

åŠ¨æ€ç»‘å®šæ‰€åšçš„ï¼Œå³æ˜¯åœ¨å®ä¾‹æ‰€å±ç±»ç¡®å®šåï¼Œå°†æŸäº›å±æ€§å’Œç›¸åº”çš„æ–¹æ³•ç»‘å®šåˆ°å®ä¾‹ä¸Šã€‚

è¯´æ˜ï¼šobjective-c ä¸­çš„BOOLå®é™…ä¸Šæ˜¯ä¸€ç§å¯¹å¸¦ç¬¦å·çš„å­—ç¬¦ç±»å‹ï¼ˆsigned charï¼‰çš„ç±»å‹å®šä¹‰ï¼ˆtypedefï¼‰ï¼Œå®ƒä½¿ç”¨8ä½çš„å­˜å‚¨ç©ºé—´ã€‚é€šè¿‡#defineæŒ‡ä»¤æŠŠYESå®šä¹‰ä¸º1ï¼ŒNOå®šä¹‰ä¸º0ã€‚

åŠ¨æ€åŠ è½½ï¼šæ ¹æ®éœ€æ±‚åŠ è½½æ‰€éœ€è¦çš„èµ„æº

è¿™ç‚¹å¾ˆå®¹æ˜“ç†è§£ï¼Œå¯¹äºiOSå¼€å‘æ¥è¯´ï¼ŒåŸºæœ¬å°±æ˜¯æ ¹æ®ä¸åŒçš„æœºå‹åšé€‚é…ã€‚æœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯åœ¨Retinaè®¾å¤‡ä¸ŠåŠ è½½@2xçš„å›¾ç‰‡ï¼Œè€Œåœ¨è€ä¸€äº›çš„æ™®é€šå±è®¾å¤‡ä¸ŠåŠ è½½åŸå›¾ã€‚éšç€Retina iPadçš„æ¨å‡ºï¼Œå’Œä¹‹åå¯èƒ½çš„Retina Macçš„å‡ºç°ï¼Œè¿™ä¸ªç‰¹æ€§ç›¸ä¿¡ä¼šè¢«è¶Šæ¥è¶Šå¤šåœ°ä½¿ç”¨ã€‚
å¤šæ€çš„å‡ºç°æ—¶ä¸ºäº†è®©ä¸åŒçš„ç±»èƒ½ä½¿ç”¨åŒåçš„æ–¹æ³•ã€‚è¿™ä¸ªè®©ç¨‹åºçš„å¯è¯»æ€§å¤§å¤§æé«˜ï¼Œä¹Ÿé™ä½äº†ç¼–ç¨‹éš¾åº¦ã€‚

åŠ¨æ€ç±»å‹ä¸åŠ¨æ€ç»‘å®šæ˜¯ä¸ºäº†è§£å†³éšå¤šæ€çš„ä¾¿åˆ©è€Œå¼•èµ·çš„å¼Šç«¯ï¼Œæœ‰äº†åŠ¨æ€ç±»å‹ä¸åŠ¨æ€ç»‘å®šï¼Œä¸ç”¨å»è€ƒè™‘è¾“å‡ºä¸­çš„æ–¹æ³•æ˜¯å“ªä¸ªç±»å‹çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨åˆ¤å®šã€‚

è€Œidç±»å‹çš„å‡ºç°å°±æ˜¯ä¸ºäº†æ›´å¥½çš„æ‰¿æ¥åŠ¨æ€ç±»å‹ä¸åŠ¨æ€æ–¹æ³•å‡ºæ¥çš„è¿”å›å€¼ã€‚
</code></pre>

<h6>å¸¸ç”¨æ–¹æ³•</h6>

<p>Ivar <em>ivars = class_copyIvarList([iCocosObject class], &amp;count);
Method </em>met = class_copyMethodList([iCocosObject class], &amp;meth);
objc_property_t *xsL = class_copyPropertyList([iCocosObject class], &amp;xs);
Method ic =  class_getInstanceMethod(NSClassFromString(@&ldquo;<em>NSArrayM&rdquo;), @selector(iCocosobject:));
Method add =  class_getInstanceMethod(NSClassFromString(@&ldquo;</em>NSArrayM&rdquo;), @selector(addObject:));</p>

<pre><code>objc_msgSend : ç»™å¯¹è±¡å‘é€æ¶ˆæ¯
class_copyMethodList : éå†æŸä¸ªç±»æ‰€æœ‰çš„æ–¹æ³•
class_copyIvarList : éå†æŸä¸ªç±»æ‰€æœ‰çš„æˆå‘˜å˜é‡
class_..... è¿™æ˜¯æˆ‘ä»¬å­¦ä¹ runtimeå¿…é¡»çŸ¥é“çš„å‡½æ•°ï¼
</code></pre>

<h6>å±æ€§ä¸æˆå‘˜å˜é‡</h6>

<p>Ivar: å®ä¾‹å˜é‡ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘objc_ivarç»“æ„ä½“çš„æŒ‡é’ˆã€‚objc_property_tï¼šå£°æ˜çš„å±æ€§çš„ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘objc_propertyç»“æ„ä½“çš„æŒ‡é’ˆ</p>

<ol>
<li>å±æ€§å˜é‡ æ˜¯å·²ç»è®¾ç½®äº† setter getteræ–¹æ³•çš„ OCå·²ç»è‡ªå·±ç»™è®¾ç½®äº†</li>
<li>å±æ€§å˜é‡ ä½ æ¯æ¬¡è°ƒç”¨ self.å±æ€§å˜é‡ çš„æ—¶å€™ éƒ½è¦è°ƒç”¨getteræˆ–è€…setteræ–¹æ³•
å°è£…</li>
</ol>


<p>å¦‚æœæˆå‘˜å˜é‡æ˜¯privateï¼Œç¨‹åºä¸­çš„å…¶å®ƒå¯¹è±¡å¾ˆéš¾ç›´æ¥è®¿é—®è¯¥æˆå‘˜å˜é‡ã€‚å¦‚æœæ˜¯å±æ€§ï¼Œç›¸å¯¹æ›´å®¹æ˜“ç”¨çˆ¶ç±»æ–¹æ³•è¯»å†™å±æ€§ã€‚</p>

<p>æ€§èƒ½</p>

<pre><code>æˆå‘˜å˜é‡åœ°å€å¯ä»¥æ ¹æ®å®ä¾‹çš„å†…å­˜åœ°å€åç§»å¯»å€ã€‚è€Œå±æ€§çš„è¯»å†™éƒ½éœ€è¦å‡½æ•°è°ƒç”¨ï¼Œç›¸å¯¹æ›´æ…¢ã€‚
</code></pre>

<p>éåŸºç¡€ç±»å‹</p>

<pre><code>å¯¹äºå¤æ‚çš„C++ç±»å‹ï¼Œå¾€å¾€è®¾ä¸ºæˆå‘˜å˜é‡æ›´åˆé€‚ï¼Œä¹Ÿè®¸è¿™ç§ç±»å‹ä¸æ”¯æŒcopyï¼Œæˆ–è€…å®Œå…¨å¤åˆ¶å¾ˆéº»çƒ¦ã€‚
</code></pre>

<p>å¤šçº¿ç¨‹</p>

<pre><code>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¸ºä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨éœ€è¦åŒæ­¥æ‰§è¡Œçš„ä»£ç æ®µæ›´åº”è¯¥ä½¿ç”¨æˆå‘˜å˜é‡ã€‚å¦‚æœå¯¹éœ€è¦åŒæ­¥æ›´æ–°çš„æ•°æ®ç”¨getter/setter æ–¹æ³•ï¼Œæ•°æ®æ›´æ–°æ•ˆç‡ä½ï¼Œä¼šå¸¦æ¥æ›´å¤šçš„è·å–é”è¯·æ±‚å¤±è´¥ã€‚
</code></pre>

<p>ç¨‹åºæ­£ç¡®æ€§</p>

<pre><code>æˆå‘˜å˜é‡å¯ä»¥åšç›´è§‚çš„å†…å­˜ç®¡ç†ã€‚å±æ€§å¯ä»¥ä¸€å±‚å±‚ç»§æ‰¿ï¼Œè¿˜å¯ä»¥å¤å†™ã€‚å®¹æ˜“å‡ºé”™ã€‚
</code></pre>

<p>äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½“ç§¯</p>

<pre><code>é»˜è®¤ç”¨å±æ€§ï¼Œä¼šç”Ÿæˆä¸å¿…è¦çš„getter/setter æ–¹æ³•ï¼Œç¨‹åºä½“ç§¯ä¼šå˜å¤§ã€‚
</code></pre>

<p>1.å¦‚æœåªæ˜¯å•çº¯çš„privateå˜é‡ï¼Œæœ€å¥½å£°æ˜åœ¨implementationé‡Œ.
2.å¦‚æœæ˜¯ç±»çš„publicå±æ€§ï¼Œå°±ç”¨propertyå†™åœ¨.hæ–‡ä»¶é‡Œ
3.å¦‚æœè‡ªå·±å†…éƒ¨éœ€è¦setterå’Œgetteræ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œå°±åœ¨.mæ–‡ä»¶çš„ç±»ç›®é‡Œç”¨propertyæ¥å£°æ˜</p>

<h6>æ¶ˆæ¯æœºåˆ¶æ¶ˆæ¯æœºåˆ¶</h6>

<pre><code>[obj makeText];==objc_msgSend(obj, @selector (makeText));


é¦–å…ˆé€šè¿‡objçš„isaæŒ‡é’ˆæ‰¾åˆ°objå¯¹åº”çš„classã€‚

é¦–å…ˆæ£€æµ‹è¿™ä¸ª selector æ˜¯ä¸æ˜¯è¦å¿½ç•¥ã€‚æ¯”å¦‚ Mac OS X å¼€å‘ï¼Œæœ‰äº†åƒåœ¾å›æ”¶å°±ä¸ç†ä¼š retainï¼Œrelease è¿™äº›å‡½æ•°ã€‚
æ£€æµ‹è¿™ä¸ª selector çš„ target æ˜¯ä¸æ˜¯ nilï¼ŒObjc å…è®¸æˆ‘ä»¬å¯¹ä¸€ä¸ª nil å¯¹è±¡æ‰§è¡Œä»»ä½•æ–¹æ³•ä¸ä¼š Crashï¼Œå› ä¸ºè¿è¡Œæ—¶ä¼šè¢«å¿½ç•¥æ‰ã€‚
å¦‚æœä¸Šé¢ä¸¤æ­¥éƒ½é€šè¿‡äº†ï¼Œé‚£ä¹ˆå°±å¼€å§‹æŸ¥æ‰¾è¿™ä¸ªç±»çš„å®ç° IMPï¼Œ
åœ¨Classä¸­å…ˆå»cacheä¸­ é€šè¿‡SELæŸ¥æ‰¾å¯¹åº”å‡½æ•°methodï¼Œæ‰¾åˆ°å°±æ‰§è¡Œå¯¹åº”çš„å®ç°ã€‚
è‹¥cacheä¸­æœªæ‰¾åˆ°ï¼Œå†å»methodListä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å°±æ‰§è¡Œå¯¹åº”çš„å®ç°ã€‚
è‹¥methodlistä¸­æœªæ‰¾åˆ°ï¼Œåˆ™å–superClassä¸­æŸ¥æ‰¾ï¼ˆé‡å¤æ‰§è¡Œä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æœ€æ ¹çš„ç±»ä¸ºæ­¢ã€‚
è‹¥ä»»ä½•ä¸€éƒ¨èƒ½æ‰¾åˆ°ï¼Œåˆ™å°†methodåŠ  å…¥åˆ°cacheä¸­ï¼Œä»¥æ–¹ä¾¿ä¸‹æ¬¡æŸ¥æ‰¾ï¼Œå¹¶é€šè¿‡methodä¸­çš„å‡½æ•°æŒ‡é’ˆè·³è½¬åˆ°å¯¹åº”çš„å‡½æ•°ä¸­å»æ‰§è¡Œã€‚
å¦‚æœä»¥ä¸Šéƒ½ä¸èƒ½æ‰¾åˆ°ï¼Œåˆ™ä¼šå¼€å§‹è¿›è¡Œæ¶ˆæ¯è½¬å‘
</code></pre>

<h6>æ¶ˆæ¯è½¬å‘</h6>

<pre><code>1.åŠ¨æ€æ–¹æ³•è§£æï¼šå‘å½“å‰ç±»å‘é€ resolveInstanceMethod: ä¿¡å·ï¼Œæ£€æŸ¥æ˜¯å¦åŠ¨æ€å‘è¯¥ç±»æ·»åŠ äº†æ–¹æ³•ã€‚ï¼ˆè¿·èŒ«è¯·æœç´¢ï¼š@dynamicï¼‰
2.å¿«é€Ÿæ¶ˆæ¯è½¬å‘ï¼šæ£€æŸ¥è¯¥ç±»æ˜¯å¦å®ç°äº† forwardingTargetForSelector: æ–¹æ³•ï¼Œè‹¥å®ç°äº†åˆ™è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è‹¥è¯¥æ–¹æ³•è¿”å›å€¼å¯¹è±¡énilæˆ–éselfï¼Œåˆ™å‘è¯¥è¿”å›å¯¹è±¡é‡æ–°å‘é€æ¶ˆæ¯ã€‚
3.æ ‡å‡†æ¶ˆæ¯è½¬å‘ï¼šruntimeå‘é€methodSignatureForSelector:æ¶ˆæ¯è·å–Selectorå¯¹åº”çš„æ–¹æ³•ç­¾åã€‚è¿”å›å€¼éç©ºåˆ™é€šè¿‡forwardInvocation:è½¬å‘æ¶ˆæ¯ï¼Œè¿”å›å€¼ä¸ºç©ºåˆ™å‘å½“å‰å¯¹è±¡å‘é€doesNotRecognizeSelector:æ¶ˆæ¯ï¼Œç¨‹åºå´©æºƒé€€å‡º

æ€»ç»“å°±æ˜¯ï¼š
åœ¨ä¸€ä¸ªå‡½æ•°æ‰¾ä¸åˆ°æ—¶ï¼ŒOCæä¾›äº†ä¸‰ç§æ–¹å¼å»è¡¥æ•‘ï¼š
1ã€è°ƒç”¨resolveInstanceMethodç»™ä¸ªæœºä¼šè®©ç±»æ·»åŠ è¿™ä¸ªå®ç°è¿™ä¸ªå‡½æ•°
2ã€è°ƒç”¨forwardingTargetForSelectorè®©åˆ«çš„å¯¹è±¡å»æ‰§è¡Œè¿™ä¸ªå‡½æ•°
3ã€è°ƒç”¨forwardInvocationï¼ˆå‡½æ•°æ‰§è¡Œå™¨ï¼‰çµæ´»çš„å°†ç›®æ ‡å‡½æ•°ä»¥å…¶ä»–å½¢å¼æ‰§è¡Œã€‚
å¦‚æœéƒ½ä¸ä¸­ï¼Œè°ƒç”¨doesNotRecognizeSelectoræŠ›å‡ºå¼‚å¸¸ã€‚
</code></pre>

<h6>å¸¸è§ç”¨é€”</h6>

<ul>
<li>å¢åŠ ï¼Œåˆ é™¤ï¼Œä¿®æ”¹ä¸€ä¸ªç±»ï¼Œå±æ€§ï¼Œæˆå‘˜å˜é‡ï¼Œæ–¹æ³•</li>
</ul>


<h6>å®é™…åº”ç”¨</h6>

<ul>
<li>å…³è”å¯¹è±¡</li>
<li>æ–¹æ³•æ··æ·†</li>
<li>NSCoding(å½’æ¡£å’Œè§£æ¡£, åˆ©ç”¨runtimeéå†æ¨¡å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§)</li>
<li>å­—å…¸ &ndash;> æ¨¡å‹ (åˆ©ç”¨runtimeéå†æ¨¡å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§, æ ¹æ®å±æ€§åä»å­—å…¸ä¸­å–å‡ºå¯¹åº”çš„å€¼, è®¾ç½®åˆ°æ¨¡å‹çš„å±æ€§ä¸Š)</li>
<li>KVO(åˆ©ç”¨runtimeåŠ¨æ€äº§ç”Ÿä¸€ä¸ªç±»)</li>
<li>ç”¨äºå°è£…æ¡†æ¶(æƒ³æ€ä¹ˆæ”¹å°±æ€ä¹ˆæ”¹) è¿™å°±æ˜¯æˆ‘ä»¬runtimeæœºåˆ¶çš„åªè¦è¿ç”¨æ–¹å‘</li>
</ul>


<h3>RunLoopï¼ˆåº•å±‚ï¼‰</h3>

<h6>RunLoop çš„ç®€å•æ¦‚è¿°</h6>

<p>RunLoop:</p>

<pre><code>   Runloopæ˜¯äº‹ä»¶æ¥æ”¶å’Œåˆ†å‘æœºåˆ¶çš„ä¸€ä¸ªå®ç°ã€‚

   Runloopæä¾›äº†ä¸€ç§å¼‚æ­¥æ‰§è¡Œä»£ç çš„æœºåˆ¶ï¼Œä¸èƒ½å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ã€‚

   åœ¨ä¸»é˜Ÿåˆ—ä¸­ï¼ŒMain RunLoopç›´æ¥é…åˆä»»åŠ¡çš„æ‰§è¡Œï¼Œè´Ÿè´£å¤„ç†UIäº‹ä»¶ã€å®šæ—¶å™¨ä»¥åŠå…¶ä»–å†…æ ¸ç›¸å…³äº‹ä»¶ã€‚
</code></pre>

<p>ä¸»è¦ç›®çš„ï¼š</p>

<pre><code>   ä¿è¯ç¨‹åºæ‰§è¡Œçš„çº¿ç¨‹ä¸ä¼šè¢«ç³»ç»Ÿç»ˆæ­¢ã€‚   
</code></pre>

<p>ä½¿ç”¨Runloop ï¼Ÿ</p>

<pre><code>   å½“éœ€è¦å’Œè¯¥çº¿ç¨‹è¿›è¡Œäº¤äº’çš„æ—¶å€™æ‰ä¼šä½¿ç”¨Runloop.


   æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰å…¶å¯¹åº”çš„RunLoopï¼Œä½†æ˜¯é»˜è®¤éä¸»çº¿ç¨‹çš„RunLoopæ˜¯æ²¡æœ‰è¿è¡Œçš„ï¼Œéœ€è¦ä¸ºRunLoopæ·»åŠ è‡³å°‘ä¸€ä¸ªäº‹ä»¶æºï¼Œç„¶åå»runå®ƒã€‚


   ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯æ²¡æœ‰å¿…è¦å»å¯ç”¨çº¿ç¨‹çš„RunLoopçš„ï¼Œé™¤éä½ åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­éœ€è¦é•¿ä¹…çš„æ£€æµ‹æŸä¸ªäº‹ä»¶ã€‚
</code></pre>

<p>ä¸»çº¿ç¨‹é»˜è®¤æœ‰Runloopã€‚å½“è‡ªå·±å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœåªæ˜¯ç”¨äºå¤„ç†å•ä¸€çš„äº‹ä»¶ï¼Œåˆ™è¯¥çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä¹‹åå°±é€€å‡ºäº†ã€‚æ‰€ä»¥å½“æˆ‘ä»¬éœ€è¦è®©è¯¥çº¿ç¨‹ç›‘å¬æŸé¡¹äº‹åŠ¡
æ—¶ï¼Œå°±å¾—è®©çº¿ç¨‹ä¸€ç›´ä¸é€€å‡ºï¼Œrunloopå°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå¾ªç¯ï¼Œæ²¡æœ‰äº‹ä»¶çš„æ—¶å€™ï¼Œä¸€ç›´å¡ç€ï¼Œæœ‰äº‹ä»¶æ¥ä¸´äº†ï¼Œæ‰§è¡Œå…¶å¯¹åº”çš„å‡½æ•°ã€‚</p>

<pre><code>   RunLoop,æ­£å¦‚å…¶åæ‰€ç¤º,æ˜¯çº¿ç¨‹è¿›å…¥å’Œè¢«çº¿ç¨‹ç”¨æ¥ç›¸åº”äº‹ä»¶ä»¥åŠè°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•°çš„åœ°æ–¹.éœ€è¦åœ¨ä»£ç ä¸­ä½¿ç”¨æ§åˆ¶è¯­å¥å®ç°RunLoopçš„å¾ªç¯,ä¹Ÿå°±æ˜¯è¯´,éœ€è¦ä»£ç æä¾›whileæˆ–è€…forå¾ªç¯æ¥é©±åŠ¨RunLoop.


   åœ¨è¿™ä¸ªå¾ªç¯ä¸­,ä½¿ç”¨ä¸€ä¸ªrunLoopå¯¹è±¡[NSRunloop currentRunloop]æ‰§è¡Œæ¥æ”¶æ¶ˆæ¯,è°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°.


    Runloopæ¥æ”¶ä¸¤ç§æºäº‹ä»¶:input sourceså’Œtimer sourcesã€‚


   input sources ä¼ é€’å¼‚æ­¥äº‹ä»¶ï¼Œé€šå¸¸æ˜¯æ¥è‡ªå…¶ä»–çº¿ç¨‹å’Œä¸åŒçš„ç¨‹åºä¸­çš„æ¶ˆæ¯ï¼›


   timer sources(å®šæ—¶å™¨) ä¼ é€’åŒæ­¥äº‹ä»¶ï¼ˆé‡å¤æ‰§è¡Œæˆ–è€…åœ¨ç‰¹å®šæ—¶é—´ä¸Šè§¦å‘ï¼‰ã€‚


   é™¤äº†å¤„ç†input sourcesï¼ŒRunloop
</code></pre>

<p>ä¹Ÿä¼šäº§ç”Ÿä¸€äº›å…³äºæœ¬èº«è¡Œä¸ºçš„notificaitonã€‚æ³¨å†Œæˆä¸ºRunloopçš„observerï¼Œå¯ä»¥æ¥æ”¶åˆ°è¿™äº›notificationï¼Œåšä¸€äº›é¢å¤–
çš„å¤„ç†ã€‚ï¼ˆä½¿ç”¨CoreFoundationæ¥æˆä¸ºrunloopçš„observerï¼‰ã€‚</p>

<p>Runloopå·¥ä½œçš„ç‰¹ç‚¹:</p>

<pre><code>   1&gt;å½“æœ‰æ—¶é—´å‘ç”Ÿæ—¶,Runloopä¼šæ ¹æ®å…·ä½“çš„äº‹ä»¶ç±»å‹é€šçŸ¥åº”ç”¨ç¨‹åºä½œå‡ºç›¸åº”;


   2&gt;å½“æ²¡æœ‰äº‹ä»¶å‘ç”Ÿæ—¶,Runloopä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€,ä»è€Œè¾¾åˆ°çœç”µçš„ç›®çš„;


   3&gt;å½“äº‹ä»¶å†æ¬¡å‘ç”Ÿæ—¶,Runloopä¼šè¢«é‡æ–°å”¤é†’,å¤„ç†äº‹ä»¶.
</code></pre>

<p>æç¤º:ä¸€èˆ¬åœ¨å¼€å‘ä¸­å¾ˆå°‘ä¼šä¸»åŠ¨åˆ›å»ºRunloop,è€Œé€šå¸¸ä¼šæŠŠäº‹ä»¶æ·»åŠ åˆ°Runloopä¸­.</p>

<p>è‹¹æœæä¾›äº†ä¸¤ä¸ªé€”å¾„æ¥è·å–åˆ†åˆ«æ˜¯Cocoeé‡Œé¢å®šä¹‰çš„NSRunLoopä»¥åŠCoreFoundationé‡Œé¢å®šä¹‰çš„CFRunLoopRefã€‚</p>

<pre><code>CFRunLoopRefæä¾›äº†çº¯Cå‡½æ•°çš„APIï¼Œæ‰€æœ‰è¿™äº›APIéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
NSRunLoopæä¾›äº†é¢å‘å¯¹è±¡çš„APIï¼Œä½†è¿™äº›APIä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
</code></pre>

<h6>RunLoop ä¸çº¿ç¨‹çš„å…³ç³»</h6>

<p>iOS å¼€å‘ä¸­èƒ½é‡åˆ°ä¸¤ä¸ªçº¿ç¨‹å¯¹è±¡: pthread_t å’Œ NSThreadã€‚è¿‡å»è‹¹æœæœ‰ä»½æ–‡æ¡£æ ‡æ˜äº† NSThread åªæ˜¯ pthread_t çš„å°è£…ï¼Œä½†é‚£ä»½æ–‡æ¡£å·²ç»å¤±æ•ˆäº†ï¼Œç°åœ¨å®ƒä»¬ä¹Ÿæœ‰å¯èƒ½éƒ½æ˜¯ç›´æ¥åŒ…è£…è‡ªæœ€åº•å±‚çš„ mach threadã€‚è‹¹æœå¹¶æ²¡æœ‰æä¾›è¿™ä¸¤ä¸ªå¯¹è±¡ç›¸äº’è½¬æ¢çš„æ¥å£ï¼Œä½†ä¸ç®¡æ€ä¹ˆæ ·ï¼Œå¯ä»¥è‚¯å®šçš„æ˜¯ pthread_t å’Œ NSThread æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ pthread_main_np() æˆ– [NSThread mainThread] æ¥è·å–ä¸»çº¿ç¨‹ï¼›ä¹Ÿå¯ä»¥é€šè¿‡ pthread_self() æˆ– [NSThread currentThread] æ¥è·å–å½“å‰çº¿ç¨‹ã€‚CFRunLoop æ˜¯åŸºäº pthread æ¥ç®¡ç†çš„ã€‚</p>

<p>è‹¹æœä¸å…è®¸ç›´æ¥åˆ›å»º RunLoopï¼Œå®ƒåªæä¾›äº†ä¸¤ä¸ªè‡ªåŠ¨è·å–çš„å‡½æ•°ï¼šCFRunLoopGetMain() å’Œ CFRunLoopGetCurrent()ã€‚</p>

<p>çº¿ç¨‹å’Œ RunLoop ä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå…¶å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ Dictionary é‡Œã€‚çº¿ç¨‹åˆšåˆ›å»ºæ—¶å¹¶æ²¡æœ‰ RunLoopï¼Œå¦‚æœä½ ä¸ä¸»åŠ¨è·å–ï¼Œé‚£å®ƒä¸€ç›´éƒ½ä¸ä¼šæœ‰ã€‚RunLoop çš„åˆ›å»ºæ˜¯å‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶ï¼ŒRunLoop çš„é”€æ¯æ˜¯å‘ç”Ÿåœ¨çº¿ç¨‹ç»“æŸæ—¶ã€‚ä½ åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹çš„å†…éƒ¨è·å–å…¶ RunLoopï¼ˆä¸»çº¿ç¨‹é™¤å¤–ï¼‰ã€‚</p>

<h6>RunLoop çš„ Mode</h6>

<ol>
<li><p>kCFRunLoopDefaultMode: Appçš„é»˜è®¤ Modeï¼Œé€šå¸¸ä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ª Mode ä¸‹è¿è¡Œçš„ã€‚</p></li>
<li><p>UITrackingRunLoopMode: ç•Œé¢è·Ÿè¸ª Modeï¼Œç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“ã€‚</p></li>
<li><p>UIInitializationRunLoopMode: åœ¨åˆšå¯åŠ¨ App æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨ã€‚</p></li>
<li><p>GSEventReceiveRunLoopMode: æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Modeï¼Œé€šå¸¸ç”¨ä¸åˆ°ã€‚</p></li>
<li><p>kCFRunLoopCommonModes: è¿™æ˜¯ä¸€ä¸ªå ä½çš„ Modeï¼Œæ²¡æœ‰å®é™…ä½œç”¨ã€‚</p></li>
</ol>


<p>ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ›´å¤šçš„è‹¹æœå†…éƒ¨çš„ Modeï¼Œä½†é‚£äº› Mode åœ¨å¼€å‘ä¸­å°±å¾ˆéš¾é‡åˆ°äº†ã€‚</p>

<p>ä¸€ä¸ª RunLoop åŒ…å«è‹¥å¹²ä¸ª Modeï¼Œæ¯ä¸ª Mode åˆåŒ…å«è‹¥å¹²ä¸ª Source/Timer/Observerã€‚æ¯æ¬¡è°ƒç”¨ RunLoop çš„ä¸»å‡½æ•°æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Modeï¼Œè¿™ä¸ªModeè¢«ç§°ä½œ CurrentModeã€‚å¦‚æœéœ€è¦åˆ‡æ¢ Modeï¼Œåªèƒ½é€€å‡º Loopï¼Œå†é‡æ–°æŒ‡å®šä¸€ä¸ª Mode è¿›å…¥ã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒç»„çš„ Source/Timer/Observerï¼Œè®©å…¶äº’ä¸å½±å“ã€‚</p>

<h6>RunLoop çš„åº•å±‚å®ç°(å†…éƒ¨é€»è¾‘)</h6>

<p>RunLoop çš„æ ¸å¿ƒæ˜¯åŸºäº mach port çš„ï¼Œå…¶è¿›å…¥ä¼‘çœ æ—¶è°ƒç”¨çš„å‡½æ•°æ˜¯ mach_msg()</p>

<p>RunLoop çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ª mach_msg() (è§ä¸Šé¢ä»£ç çš„ç¬¬7æ­¥)ï¼ŒRunLoop è°ƒç”¨è¿™ä¸ªå‡½æ•°å»æ¥æ”¶æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰åˆ«äººå‘é€ port æ¶ˆæ¯è¿‡æ¥ï¼Œå†…æ ¸ä¼šå°†çº¿ç¨‹ç½®äºç­‰å¾…çŠ¶æ€ã€‚ä¾‹å¦‚ä½ åœ¨æ¨¡æ‹Ÿå™¨é‡Œè·‘èµ·ä¸€ä¸ª iOS çš„ Appï¼Œç„¶ååœ¨ App é™æ­¢æ—¶ç‚¹å‡»æš‚åœï¼Œä½ ä¼šçœ‹åˆ°ä¸»çº¿ç¨‹è°ƒç”¨æ ˆæ˜¯åœç•™åœ¨ mach_msg_trap() è¿™ä¸ªåœ°æ–¹ã€‚</p>

<h6>åº”ç”¨</h6>

<ul>
<li><p>AutoreleasePool</p></li>
<li><p>äº‹ä»¶å“åº”</p></li>
<li><p>æ‰‹åŠ¿è¯†åˆ«</p></li>
<li><p>ç•Œé¢æ›´æ–°</p></li>
<li><p>å®šæ—¶å™¨</p></li>
<li><p>PerformSelecter</p></li>
<li><p>å…³äºGCD</p></li>
<li><p>å…³äºç½‘ç»œè¯·æ±‚</p></li>
<li><p>AFNetworking</p></li>
<li><p>AsyncDisplayKit</p></li>
</ul>


<h3>å¤šçº¿ç¨‹ï¼ˆåº•å±‚ä¸å®‰å…¨ï¼‰</h3>

<p>çº¿ç¨‹ï¼š1ä¸ªè¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹.çº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ</p>

<p>åº•å±‚ï¼šMachæ˜¯ç¬¬ä¸€ä¸ªä»¥å¤šçº¿ç¨‹æ–¹å¼å¤„ç†ä»»åŠ¡çš„ç³»ç»Ÿï¼Œå› æ­¤å¤šçº¿ç¨‹çš„åº•å±‚å®ç°æœºåˆ¶æ˜¯åŸºäºMachçš„çº¿ç¨‹ã€‚</p>

<pre><code> 1ã€‹Cè¯­è¨€çš„POSIXæ¥å£ï¼š#include&lt;pthread.h&gt;POSIXçº¿ç¨‹ï¼ˆPOSIX threadsï¼‰ï¼Œç®€ç§°Pthreadsï¼Œæ˜¯çº¿ç¨‹çš„POSIXæ ‡å‡†ã€‚è¯¥æ ‡å‡†å®šä¹‰äº†åˆ›å»ºå’Œæ“çºµçº¿ç¨‹çš„ä¸€æ•´å¥—APIã€‚åœ¨ç±»Unixæ“ä½œç³»ç»Ÿï¼ˆUnixã€Linuxã€Mac OS Xç­‰ï¼‰ä¸­ï¼Œéƒ½ä½¿ç”¨Pthreadsä½œä¸ºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹
 2ã€‹OCçš„NSThread
 3ã€‹ Cè¯­è¨€çš„GCDæ¥å£ï¼ˆæ€§èƒ½æœ€å¥½ï¼Œä»£ç æ›´ç²¾ç®€ï¼‰  
 4ã€‹  OCçš„NSOperationå’ŒNSOperationQueueï¼ˆåŸºäºGCDï¼‰
</code></pre>

<p>å¥½å¤„ï¼š</p>

<pre><code>1ã€ä½¿ç”¨çº¿ç¨‹å¯ä»¥æŠŠç¨‹åºä¸­å æ®æ—¶é—´é•¿çš„ä»»åŠ¡æ”¾åˆ°åå°å»å¤„ç†ï¼Œå¦‚å›¾ç‰‡ã€è§†é¢‘çš„ä¸‹è½½

2ã€å‘æŒ¥å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿ï¼Œå¹¶å‘æ‰§è¡Œè®©ç³»ç»Ÿè¿è¡Œçš„æ›´å¿«ã€æ›´æµç•…ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½
</code></pre>

<p>ç¼ºç‚¹ï¼š</p>

<pre><code>1ã€å¤§é‡çš„çº¿ç¨‹é™ä½ä»£ç çš„å¯è¯»æ€§ï¼Œ

2ã€æ›´å¤šçš„çº¿ç¨‹éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´

3ã€å½“å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªèµ„æºå‡ºç°äº‰å¤ºçš„æ—¶å€™è¦æ³¨æ„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚
</code></pre>

<p>GCDå†…éƒ¨æ€ä¹ˆå®ç°çš„</p>

<pre><code>  1ã€‹ iOSå’ŒOSXçš„æ ¸å¿ƒæ˜¯XNUå†…æ ¸ï¼ˆè‹¹æœç”µè„‘å‘å±•çš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼‰ï¼ŒGCDæ˜¯åŸºäºXNUå†…æ ¸å®ç°çš„ã€‚
  2ã€‹GCDçš„APIå…¨éƒ¨åœ¨libdispatchåº“ä¸­
  3ã€‹GCDçš„åº•å±‚å®ç°ä¸»è¦æœ‰ï¼šDispatch Queueå’ŒDispatch Source
    Dispatch Queue :ç®¡ç†blockæ“ä½œ
    Dispatch Sourceï¼šå¤„ç†äº‹ä»¶ï¼ˆæ¯”å¦‚è¯´çº¿ç¨‹é—´çš„é€šä¿¡ï¼‰
</code></pre>

<p>6.GCDå’ŒNSOperationQueue</p>

<pre><code>   1ã€‹GCDæ˜¯çº¯Cè¯­è¨€çš„APIï¼ŒNSOperationQueueæ˜¯åŸºäºGCDçš„OCç‰ˆæœ¬çš„å°è£…
   2ã€‹GCDåªæ”¯æŒFIFOçš„é˜Ÿåˆ—ï¼ŒNSOperationQueueå¯ä»¥å¾ˆæ–¹ä¾¿çš„è°ƒæ•´æ‰§è¡Œé¡ºåºï¼Œå¯ä»¥æ·»åŠ ä¾èµ–è®¾ç½®æœ€å¤§å¹¶å‘æ•°é‡ã€‚
   3ã€‹GCDçš„æ‰§è¡Œé€Ÿåº¦æ¯”NSOperationQueueå¿«
   4ã€‹NSOperationQueueæ”¯æŒKVOï¼Œå¯ä»¥æ£€æµ‹Operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼Œæ˜¯å¦ç»“æŸï¼Œæ˜¯å¦å–æ¶ˆã€‚
</code></pre>

<p>å¦‚ä½•è¿›è¡Œé€‰æ‹©ï¼Ÿ
ä»»åŠ¡ä¹‹é—´ä¸å¤ªç›¸äº’ä¾èµ–ï¼Œé€‰ç”¨GCDï¼›
ä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–ï¼Œæˆ–è€…è¦ç›‘å¬ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼šNSOperationQueue</p>

<p>ä¸€ã€å‰è¨€
     1ã€‹åªåœ¨ä¸»çº¿ç¨‹åˆ·æ–°è®¿é—®UI
     2ã€‹å¦‚æœè¦é˜²æ­¢èµ„æºæŠ¢å¤ºï¼Œå¾—ç”¨synchronizeè¿›è¡ŒåŠ é”ä¿æŠ¤ã€‚
     3ã€‹å¦‚æœå¼‚æ­¥æ“ä½œè¦ä¿è¯çº¿ç¨‹å®‰å…¨ç­‰é—®é¢˜ï¼Œå°½é‡ä½¿ç”¨GCDã€‚ï¼ˆGCDæœ‰äº›å‡½æ•°é»˜è®¤å°±æ˜¯å®‰å…¨çš„ï¼‰</p>

<p>å‰æ®µæ—¶é—´çœ‹äº†å‡ ä¸ªå¼€æºé¡¹ç›®ï¼Œå‘ç°ä»–ä»¬ä¿æŒçº¿ç¨‹åŒæ­¥çš„æ–¹å¼å„ä¸ç›¸åŒï¼Œæœ‰@synchronizedã€NSLockã€dispatch_semaphoreã€NSConditionã€pthread_mutexã€OSSpinLockã€‚åæ¥ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°ä»–ä»¬çš„å®ç°æœºåˆ¶å„ä¸ç›¸åŒï¼Œæ€§èƒ½ä¹Ÿå„ä¸ä¸€æ ·ã€‚ä¸å¥½æ„æ€ï¼Œæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨æœ€å¤šçš„@synchronizedæ˜¯æ€§èƒ½æœ€å·®çš„ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆåˆ†åˆ«ä»‹ç»æ¯ä¸ªåŠ é”æ–¹å¼çš„ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥å¯¹ä»–ä»¬è¿›è¡Œæ€§èƒ½å¯¹æ¯”ã€‚</p>

<p>äºŒã€ä»‹ç»ä¸ä½¿ç”¨</p>

<p>2.1ã€@synchronized</p>

<pre><code>NSObject *obj = [[NSObject alloc] init];
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    @synchronized(obj) {
       NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");
       sleep(3);
       NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");
    }
});
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    sleep(1);
    @synchronized(obj) {
       NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2");
    }
});
</code></pre>

<p>@synchronized(obj)æŒ‡ä»¤ä½¿ç”¨çš„objä¸ºè¯¥é”çš„å”¯ä¸€æ ‡è¯†ï¼Œåªæœ‰å½“æ ‡è¯†ç›¸åŒæ—¶ï¼Œæ‰ä¸ºæ»¡è¶³äº’æ–¥ï¼Œå¦‚æœçº¿ç¨‹2ä¸­çš„@synchronized(obj)æ”¹ä¸º@synchronized(self),åˆšçº¿ç¨‹2å°±ä¸ä¼šè¢«é˜»å¡ï¼Œ@synchronizedæŒ‡ä»¤å®ç°é”çš„ä¼˜ç‚¹å°±æ˜¯æˆ‘ä»¬ä¸éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼çš„åˆ›å»ºé”å¯¹è±¡ï¼Œä¾¿å¯ä»¥å®ç°é”çš„æœºåˆ¶ï¼Œä½†ä½œä¸ºä¸€ç§é¢„é˜²æªæ–½ï¼Œ@synchronizedå—ä¼šéšå¼çš„æ·»åŠ ä¸€ä¸ªå¼‚å¸¸å¤„ç†ä¾‹ç¨‹æ¥ä¿æŠ¤ä»£ç ï¼Œè¯¥å¤„ç†ä¾‹ç¨‹ä¼šåœ¨å¼‚å¸¸æŠ›å‡ºçš„æ—¶å€™è‡ªåŠ¨çš„é‡Šæ”¾äº’æ–¥é”ã€‚æ‰€ä»¥å¦‚æœä¸æƒ³è®©éšå¼çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹å¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨é”å¯¹è±¡ã€‚</p>

<p>2.2ã€dispatch_semaphore</p>

<pre><code>dispatch_semaphore_t signal = dispatch_semaphore_create(1);
dispatch_time_t overTime = dispatch_time(DISPATCH_TIME_NOW, 3 * NSEC_PER_SEC);
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    dispatch_semaphore_wait(signal, overTime);
            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");
            sleep(2);
            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");
        dispatch_semaphore_signal(signal);
});
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        sleep(1);
        dispatch_semaphore_wait(signal, overTime);
            NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2");
        dispatch_semaphore_signal(signal);
});
</code></pre>

<p>dispatch_semaphoreæ˜¯GCDç”¨æ¥åŒæ­¥çš„ä¸€ç§æ–¹å¼ï¼Œä¸ä»–ç›¸å…³çš„å…±æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯dispatch_semaphore_createï¼Œdispatch_semaphore_signalï¼Œdispatch_semaphore_waitã€‚</p>

<p>ï¼ˆ1ï¼‰dispatch_semaphore_createçš„å£°æ˜ä¸ºï¼š</p>

<p>dispatch_semaphore_t dispatch_semaphore_create(long value);</p>

<p>ä¼ å…¥çš„å‚æ•°ä¸ºlongï¼Œè¾“å‡ºä¸€ä¸ªdispatch_semaphore_tç±»å‹ä¸”å€¼ä¸ºvalueçš„ä¿¡å·é‡ã€‚</p>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ä¼ å…¥çš„å‚æ•°valueå¿…é¡»å¤§äºæˆ–ç­‰äº0ï¼Œå¦åˆ™dispatch_semaphore_createä¼šè¿”å›NULLã€‚</p>

<p>ï¼ˆ2ï¼‰dispatch_semaphore_signalçš„å£°æ˜ä¸ºï¼š</p>

<p>long dispatch_semaphore_signal(dispatch_semaphore_t dsema);</p>

<p>è¿™ä¸ªå‡½æ•°ä¼šä½¿ä¼ å…¥çš„ä¿¡å·é‡dsemaçš„å€¼åŠ 1ï¼›</p>

<p>(3) dispatch_semaphore_waitçš„å£°æ˜ä¸ºï¼š</p>

<p>long dispatch_semaphore_wait(dispatch_semaphore_t dsema, dispatch_time_t timeout);</p>

<p>è¿™ä¸ªå‡½æ•°ä¼šä½¿ä¼ å…¥çš„ä¿¡å·é‡dsemaçš„å€¼å‡1ï¼›è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœdsemaä¿¡å·é‡çš„å€¼å¤§äº0ï¼Œè¯¥å‡½æ•°æ‰€å¤„çº¿ç¨‹å°±ç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œå¹¶ä¸”å°†ä¿¡å·é‡çš„å€¼å‡1ï¼›å¦‚æœdesemaçš„å€¼ä¸º0ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±é˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…timeoutï¼ˆæ³¨æ„timeoutçš„ç±»å‹ä¸ºdispatch_time_tï¼Œä¸èƒ½ç›´æ¥ä¼ å…¥æ•´å½¢æˆ–floatå‹æ•°ï¼‰ï¼Œå¦‚æœç­‰å¾…çš„æœŸé—´desemaçš„å€¼è¢«dispatch_semaphore_signalå‡½æ•°åŠ 1äº†ï¼Œä¸”è¯¥å‡½æ•°ï¼ˆå³dispatch_semaphore_waitï¼‰æ‰€å¤„çº¿ç¨‹è·å¾—äº†ä¿¡å·é‡ï¼Œé‚£ä¹ˆå°±ç»§ç»­å‘ä¸‹æ‰§è¡Œå¹¶å°†ä¿¡å·é‡å‡1ã€‚å¦‚æœç­‰å¾…æœŸé—´æ²¡æœ‰è·å–åˆ°ä¿¡å·é‡æˆ–è€…ä¿¡å·é‡çš„å€¼ä¸€ç›´ä¸º0ï¼Œé‚£ä¹ˆç­‰åˆ°timeoutæ—¶ï¼Œå…¶æ‰€å¤„çº¿ç¨‹è‡ªåŠ¨æ‰§è¡Œå…¶åè¯­å¥ã€‚</p>

<p>dispatch_semaphore æ˜¯ä¿¡å·é‡ï¼Œä½†å½“ä¿¡å·æ€»é‡è®¾ä¸º 1 æ—¶ä¹Ÿå¯ä»¥å½“ä½œé”æ¥ã€‚åœ¨æ²¡æœ‰ç­‰å¾…æƒ…å†µå‡ºç°æ—¶ï¼Œå®ƒçš„æ€§èƒ½æ¯” pthread_mutex è¿˜è¦é«˜ï¼Œä½†ä¸€æ—¦æœ‰ç­‰å¾…æƒ…å†µå‡ºç°æ—¶ï¼Œæ€§èƒ½å°±ä¼šä¸‹é™è®¸å¤šã€‚ç›¸å¯¹äº OSSpinLock æ¥è¯´ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äºç­‰å¾…æ—¶ä¸ä¼šæ¶ˆè€— CPU èµ„æºã€‚</p>

<p>å¦‚ä¸Šçš„ä»£ç ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´overTimeè®¾ç½®æˆ>2ï¼Œå¯å®ŒæˆåŒæ­¥æ“ä½œã€‚å¦‚æœoverTime&lt;2çš„è¯ï¼Œåœ¨çº¿ç¨‹1è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆçš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶è¶…æ—¶äº†ï¼Œå°†è‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</p>

<p>2.3ã€NSLock</p>

<pre><code>NSLock *lock = [[NSLock alloc] init];
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    //[lock lock];
    [lock lockBeforeDate:[NSDate date]];
    NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");
    sleep(2);
    NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");
    [lock unlock];
});
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    sleep(1);
    if ([lock tryLock]) {//å°è¯•è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°è¿”å›NOï¼Œä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹
        NSLog(@"é”å¯ç”¨çš„æ“ä½œ");
        [lock unlock];
    }else{
        NSLog(@"é”ä¸å¯ç”¨çš„æ“ä½œ");
    }
    NSDate *date = [[NSDate alloc] initWithTimeIntervalSinceNow:3];
    if ([lock lockBeforeDate:date]) {//å°è¯•åœ¨æœªæ¥çš„3så†…è·å–é”ï¼Œå¹¶é˜»å¡è¯¥çº¿ç¨‹ï¼Œå¦‚æœ3så†…è·å–ä¸åˆ°æ¢å¤çº¿ç¨‹, è¿”å›NO,ä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹
        NSLog(@"æ²¡æœ‰è¶…æ—¶ï¼Œè·å¾—é”");
        [lock unlock];
    }else{
        NSLog(@"è¶…æ—¶ï¼Œæ²¡æœ‰è·å¾—é”");
    }
});
</code></pre>

<p>NSLockæ˜¯Cocoaæä¾›ç»™æˆ‘ä»¬æœ€åŸºæœ¬çš„é”å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸æ‰€ä½¿ç”¨çš„ï¼Œé™¤lockå’Œunlockæ–¹æ³•å¤–ï¼ŒNSLockè¿˜æä¾›äº†tryLockå’ŒlockBeforeDate:ä¸¤ä¸ªæ–¹æ³•ï¼Œå‰ä¸€ä¸ªæ–¹æ³•ä¼šå°è¯•åŠ é”ï¼Œå¦‚æœé”ä¸å¯ç”¨(å·²ç»è¢«é”ä½)ï¼Œåˆšå¹¶ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¹¶è¿”å›NOã€‚lockBeforeDate:æ–¹æ³•ä¼šåœ¨æ‰€æŒ‡å®šDateä¹‹å‰å°è¯•åŠ é”ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰éƒ½ä¸èƒ½åŠ é”ï¼Œåˆ™è¿”å›NOã€‚</p>

<pre><code>@protocol NSLocking
- (void)lock;
- (void)unlock;
@end
@interface NSLock : NSObject  {
@private
    void *_priv;
}
- (BOOL)tryLock;
- (BOOL)lockBeforeDate:(NSDate *)limit;
@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);
@end
</code></pre>

<p>2.4ã€NSRecursiveLocké€’å½’é”</p>

<pre><code>//NSLock *lock = [[NSLock alloc] init];
NSRecursiveLock *lock = [[NSRecursiveLock alloc] init];
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
       static void (^RecursiveMethod)(int);
       RecursiveMethod = ^(int value) {
       [lock lock];
         if (value &gt; 0) {
                NSLog(@"value = %d", value);
                sleep(1);
                RecursiveMethod(value - 1);
          }
         [lock unlock];
     };
     RecursiveMethod(5);
});
</code></pre>

<p>NSRecursiveLockå®é™…ä¸Šå®šä¹‰çš„æ˜¯ä¸€ä¸ªé€’å½’é”ï¼Œè¿™ä¸ªé”å¯ä»¥è¢«åŒä¸€çº¿ç¨‹å¤šæ¬¡è¯·æ±‚ï¼Œè€Œä¸ä¼šå¼•èµ·æ­»é”ã€‚è¿™ä¸»è¦æ˜¯ç”¨åœ¨å¾ªç¯æˆ–é€’å½’æ“ä½œä¸­ã€‚</p>

<p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªå…¸å‹çš„æ­»é”æƒ…å†µã€‚åœ¨æˆ‘ä»¬çš„çº¿ç¨‹ä¸­ï¼ŒRecursiveMethodæ˜¯é€’å½’è°ƒç”¨çš„ã€‚æ‰€ä»¥æ¯æ¬¡è¿›å…¥è¿™ä¸ªblockæ—¶ï¼Œéƒ½ä¼šå»åŠ ä¸€æ¬¡é”ï¼Œè€Œä»ç¬¬äºŒæ¬¡å¼€å§‹ï¼Œç”±äºé”å·²ç»è¢«ä½¿ç”¨äº†ä¸”æ²¡æœ‰è§£é”ï¼Œæ‰€ä»¥å®ƒéœ€è¦ç­‰å¾…é”è¢«è§£é™¤ï¼Œè¿™æ ·å°±å¯¼è‡´äº†æ­»é”ï¼Œçº¿ç¨‹è¢«é˜»å¡ä½äº†ã€‚è°ƒè¯•å™¨ä¸­ä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨NSRecursiveLockã€‚å®ƒå¯ä»¥å…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡åŠ é”ï¼Œè€Œä¸ä¼šé€ æˆæ­»é”ã€‚é€’å½’é”ä¼šè·Ÿè¸ªå®ƒè¢«lockçš„æ¬¡æ•°ã€‚æ¯æ¬¡æˆåŠŸçš„lockéƒ½å¿…é¡»å¹³è¡¡è°ƒç”¨unlockæ“ä½œã€‚åªæœ‰æ‰€æœ‰è¾¾åˆ°è¿™ç§å¹³è¡¡ï¼Œé”æœ€åæ‰èƒ½è¢«é‡Šæ”¾ï¼Œä»¥ä¾›å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬å°†NSLockä»£æ›¿ä¸ºNSRecursiveLockï¼Œä¸Šé¢ä»£ç åˆ™ä¼šæ­£ç¡®æ‰§è¡Œã€‚</p>

<p>å¦‚æœéœ€è¦å…¶ä»–åŠŸèƒ½ï¼Œæºç å®šä¹‰å¦‚ä¸‹ï¼š</p>

<pre><code>@interface NSRecursiveLock : NSObject  {
@private
    void *_priv;
}
- (BOOL)tryLock;
- (BOOL)lockBeforeDate:(NSDate *)limit;
@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);
@end
</code></pre>

<p>2.5ã€NSConditionLockæ¡ä»¶é”</p>

<pre><code>NSMutableArray *products = [NSMutableArray array];
NSInteger HAS_DATA = 1;
NSInteger NO_DATA = 0;
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    while (1) {
        [lock lockWhenCondition:NO_DATA];
        [products addObject:[[NSObject alloc] init]];
        NSLog(@"produce a product,æ€»é‡:%zi",products.count);
        [lock unlockWithCondition:HAS_DATA];
        sleep(1);
    }
});
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    while (1) {
       NSLog(@"wait for product");
        [lock lockWhenCondition:HAS_DATA];
       [products removeObjectAtIndex:0];
       NSLog(@"custome a product");
       [lock unlockWithCondition:NO_DATA];
    }
});
</code></pre>

<p>å½“æˆ‘ä»¬åœ¨ä½¿ç”¨å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œæœ‰æ—¶ä¸€æŠŠåªä¼šlockå’Œunlockçš„é”æœªå¿…å°±èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„ä½¿ç”¨ã€‚å› ä¸ºæ™®é€šçš„é”åªèƒ½å…³å¿ƒé”ä¸ä¸é”ï¼Œè€Œä¸åœ¨ä¹ç”¨ä»€ä¹ˆé’¥åŒ™æ‰èƒ½å¼€é”ï¼Œè€Œæˆ‘ä»¬åœ¨å¤„ç†èµ„æºå…±äº«çš„æ—¶å€™ï¼Œå¤šæ•°æƒ…å†µæ˜¯åªæœ‰æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æƒ…å†µä¸‹æ‰èƒ½æ‰“å¼€è¿™æŠŠé”ï¼š</p>

<p>åœ¨çº¿ç¨‹1ä¸­çš„åŠ é”ä½¿ç”¨äº†lockï¼Œæ‰€ä»¥æ˜¯ä¸éœ€è¦æ¡ä»¶çš„ï¼Œæ‰€ä»¥é¡ºåˆ©çš„å°±é”ä½äº†ï¼Œä½†åœ¨unlockçš„ä½¿ç”¨äº†ä¸€ä¸ªæ•´å‹çš„æ¡ä»¶ï¼Œå®ƒå¯ä»¥å¼€å¯å…¶å®ƒçº¿ç¨‹ä¸­æ­£åœ¨ç­‰å¾…è¿™æŠŠé’¥åŒ™çš„ä¸´ç•Œåœ°ï¼Œè€Œçº¿ç¨‹2åˆ™éœ€è¦ä¸€æŠŠè¢«æ ‡è¯†ä¸º2çš„é’¥åŒ™ï¼Œæ‰€ä»¥å½“çº¿ç¨‹1å¾ªç¯åˆ°æœ€åä¸€æ¬¡çš„æ—¶å€™ï¼Œæ‰æœ€ç»ˆæ‰“å¼€äº†çº¿ç¨‹2ä¸­çš„é˜»å¡ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼ŒNSConditionLockä¹Ÿè·Ÿå…¶å®ƒçš„é”ä¸€æ ·ï¼Œæ˜¯éœ€è¦lockä¸unlockå¯¹åº”çš„ï¼Œåªæ˜¯lock,lockWhenCondition:ä¸unlockï¼ŒunlockWithCondition:æ˜¯å¯ä»¥éšæ„ç»„åˆçš„ï¼Œå½“ç„¶è¿™æ˜¯ä¸ä½ çš„éœ€æ±‚ç›¸å…³çš„ã€‚</p>

<p>å¦‚æœä½ éœ€è¦å…¶ä»–åŠŸèƒ½ï¼Œæºç å®šä¹‰å¦‚ä¸‹ï¼š</p>

<pre><code>@interface NSConditionLock : NSObject  {
@private
    void *_priv;
}
- (instancetype)initWithCondition:(NSInteger)condition NS_DESIGNATED_INITIALIZER;
@property (readonly) NSInteger condition;
- (void)lockWhenCondition:(NSInteger)condition;
- (BOOL)tryLock;
- (BOOL)tryLockWhenCondition:(NSInteger)condition;
- (void)unlockWithCondition:(NSInteger)condition;
- (BOOL)lockBeforeDate:(NSDate *)limit;
- (BOOL)lockWhenCondition:(NSInteger)condition beforeDate:(NSDate *)limit;
@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);
@end
</code></pre>

<p>2.6ã€NSCondition</p>

<pre><code>NSCondition *condition = [[NSCondition alloc] init];
NSMutableArray *products = [NSMutableArray array];
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        while (1) {
            [condition lock];
            if ([products count] == 0) {
                NSLog(@"wait for product");
                [condition wait];
            }
            [products removeObjectAtIndex:0];
            NSLog(@"custome a product");
            [condition unlock];
        }
    });
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        while (1) {
            [condition lock];
            [products addObject:[[NSObject alloc] init]];
            NSLog(@"produce a product,æ€»é‡:%zi",products.count);
            [condition signal];
            [condition unlock];
            sleep(1);
        }
});
</code></pre>

<p>ä¸€ç§æœ€åŸºæœ¬çš„æ¡ä»¶é”ã€‚æ‰‹åŠ¨æ§åˆ¶çº¿ç¨‹waitå’Œsignalã€‚</p>

<p>[condition lock];ä¸€èˆ¬ç”¨äºå¤šçº¿ç¨‹åŒæ—¶è®¿é—®ã€ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®æºï¼Œä¿è¯åœ¨åŒä¸€æ—¶é—´å†…æ•°æ®æºåªè¢«è®¿é—®ã€ä¿®æ”¹ä¸€æ¬¡ï¼Œå…¶ä»–çº¿ç¨‹çš„å‘½ä»¤éœ€è¦åœ¨lock å¤–ç­‰å¾…ï¼Œåªåˆ°unlock ï¼Œæ‰å¯è®¿é—®</p>

<p>[condition unlock];ä¸lock åŒæ—¶ä½¿ç”¨</p>

<p>[condition wait];è®©å½“å‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€</p>

<p>[condition signal];CPUå‘ä¿¡å·å‘Šè¯‰çº¿ç¨‹ä¸ç”¨åœ¨ç­‰å¾…ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ</p>

<p>2.7ã€pthread_mutex</p>

<pre><code>__block pthread_mutex_t theLock;
pthread_mutex_init(&amp;theLock, NULL);
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        pthread_mutex_lock(&amp;theLock);
        NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");
        sleep(3);
        NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");
        pthread_mutex_unlock(&amp;theLock);
});
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        sleep(1);
        pthread_mutex_lock(&amp;theLock);
        NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2");
        pthread_mutex_unlock(&amp;theLock);
});
</code></pre>

<p>cè¯­è¨€å®šä¹‰ä¸‹å¤šçº¿ç¨‹åŠ é”æ–¹å¼ã€‚</p>

<p>1ï¼špthread_mutex_init(pthread_mutex_t mutex,const pthread_mutexattr_t attr);</p>

<p>åˆå§‹åŒ–é”å˜é‡mutexã€‚atträ¸ºé”å±æ€§ï¼ŒNULLå€¼ä¸ºé»˜è®¤å±æ€§ã€‚</p>

<p>2ï¼špthread_mutex_lock(pthread_mutex_t mutex);åŠ é”</p>

<p>3ï¼špthread_mutex_tylock(<em>pthread_mutex_t </em>mutex);åŠ é”ï¼Œä½†æ˜¯ä¸2ä¸ä¸€æ ·çš„æ˜¯å½“é”å·²ç»åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿”å›ä¸ºEBUSYï¼Œè€Œä¸æ˜¯æŒ‚èµ·ç­‰å¾…ã€‚</p>

<p>4ï¼špthread_mutex_unlock(pthread_mutex_t *mutex);é‡Šæ”¾é”</p>

<p>5ï¼špthread_mutex_destroy(pthread_mutex_t* mutex);ä½¿ç”¨å®Œåé‡Šæ”¾</p>

<p>ä»£ç æ‰§è¡Œæ“ä½œç»“æœå¦‚ä¸‹ï¼š</p>

<p>2.8ã€pthread_mutex(recursive)</p>

<pre><code> __block pthread_mutex_t theLock;
//pthread_mutex_init(&amp;theLock, NULL);
pthread_mutexattr_t attr;
pthread_mutexattr_init(&amp;attr);
pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE);
pthread_mutex_init(&amp;lock, &amp;attr);
pthread_mutexattr_destroy(&amp;attr);
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    static void (^RecursiveMethod)(int);
    RecursiveMethod = ^(int value) {
            pthread_mutex_lock(&amp;theLock);
            if (value &gt; 0) {
                NSLog(@"value = %d", value);
                sleep(1);
                RecursiveMethod(value - 1);
            }
            pthread_mutex_unlock(&amp;theLock);
     };
    RecursiveMethod(5);
});
</code></pre>

<p>è¿™æ˜¯pthread_mutexä¸ºäº†é˜²æ­¢åœ¨é€’å½’çš„æƒ…å†µä¸‹å‡ºç°æ­»é”è€Œå‡ºç°çš„é€’å½’é”ã€‚ä½œç”¨å’ŒNSRecursiveLocké€’å½’é”ç±»ä¼¼ã€‚</p>

<p>å¦‚æœä½¿ç”¨pthread_mutex_init(&amp;theLock, NULL);åˆå§‹åŒ–é”çš„è¯ï¼Œä¸Šé¢çš„ä»£ç ä¼šå‡ºç°æ­»é”ç°è±¡ã€‚å¦‚æœä½¿ç”¨é€’å½’é”çš„å½¢å¼ï¼Œåˆ™æ²¡æœ‰é—®é¢˜ã€‚</p>

<p>2.9ã€OSSpinLock</p>

<pre><code>__block OSSpinLock theLock = OS_SPINLOCK_INIT;
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    OSSpinLockLock(&amp;theLock);
    NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹");
    sleep(3);
    NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ");
    OSSpinLockUnlock(&amp;theLock);
});
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    OSSpinLockLock(&amp;theLock);
    sleep(1);
    NSLog(@"éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2");
    OSSpinLockUnlock(&amp;theLock);
});
</code></pre>

<p>OSSpinLock è‡ªæ—‹é”ï¼Œæ€§èƒ½æœ€é«˜çš„é”ã€‚åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ç›´ do while å¿™ç­‰ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯å½“ç­‰å¾…æ—¶ä¼šæ¶ˆè€—å¤§é‡ CPU èµ„æºï¼Œæ‰€ä»¥å®ƒä¸é€‚ç”¨äºè¾ƒé•¿æ—¶é—´çš„ä»»åŠ¡ã€‚ ä¸è¿‡æœ€è¿‘YYå¤§ç¥åœ¨è‡ªå·±çš„åšå®¢ä¸å†å®‰å…¨çš„ OSSpinLockä¸­è¯´æ˜äº†OSSpinLockå·²ç»ä¸å†å®‰å…¨ï¼Œè¯·å¤§å®¶è°¨æ…ä½¿ç”¨ã€‚</p>

<p>ä¸‰ã€æ€§èƒ½å¯¹æ¯”</p>

<pre><code>OSSpinLockå’Œdispatch_semaphoreçš„æ•ˆç‡è¿œè¿œé«˜äºå…¶ä»–ã€‚

@synchronizedå’ŒNSConditionLockæ•ˆç‡è¾ƒå·®ã€‚

é‰´äºOSSpinLockçš„ä¸å®‰å…¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¼€å‘ä¸­å¦‚æœè€ƒè™‘æ€§èƒ½çš„è¯ï¼Œå»ºè®®ä½¿ç”¨dispatch_semaphoreã€‚

å¦‚æœä¸è€ƒè™‘æ€§èƒ½ï¼Œåªæ˜¯å›¾ä¸ªæ–¹ä¾¿çš„è¯ï¼Œé‚£å°±ä½¿ç”¨@synchronizedã€‚
</code></pre>

<h3>ç½‘ç»œï¼ˆåº•å±‚ä¸å®‰å…¨ï¼‰</h3>

<h3>æ•°æ®æŒä¹…åŒ–ï¼ˆå„ç§ä½¿ç”¨ä¸åŒºåˆ«ï¼‰ï¼ˆCoreDataã€SQLiteï¼‰</h3>

<h3>Blockï¼ˆåº•å±‚/__Blockï¼‰</h3>

<h3>éŸ³è§†é¢‘</h3>

<h3>ç›´æ’­</h3>

<h3>å®‰å…¨</h3>

<h3>ä¼˜åŒ–ï¼ˆæ€§èƒ½ã€å¡é¡¿ï¼‰</h3>

<h3>å¸¸è§é”™è¯¯</h3>

<h3>å¸¸ç”¨æŠ€æœ¯</h3>

<p>KVC</p>

<pre><code>KVCè¿ç”¨äº†ä¸€ä¸ªisa-swizzlingæŠ€æœ¯ã€‚isa-swizzlingå°±æ˜¯ç±»å‹æ··åˆæŒ‡é’ˆæœºåˆ¶ã€‚KVCä¸»è¦é€šè¿‡isa-swizzlingï¼Œæ¥å®ç°å…¶å†…éƒ¨æŸ¥æ‰¾å®šä½çš„ã€‚isaæŒ‡é’ˆï¼Œå¦‚å…¶åç§°æ‰€æŒ‡ï¼Œï¼ˆå°±æ˜¯is a kind ofçš„æ„æ€ï¼‰ï¼ŒæŒ‡å‘ç»´æŠ¤åˆ†å‘è¡¨çš„å¯¹è±¡çš„ç±»ã€‚è¯¥åˆ†å‘è¡¨å®é™…ä¸ŠåŒ…å«äº†æŒ‡å‘å®ç°ç±»ä¸­çš„æ–¹æ³•çš„æŒ‡é’ˆï¼Œå’Œå…¶å®ƒæ•°æ®
ä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨setValueçš„æ—¶å€™ï¼Œï¼ˆ1ï¼‰é¦–å…ˆæ ¹æ®æ–¹æ³•åæ‰¾åˆ°è¿è¡Œæ–¹æ³•çš„æ—¶å€™æ‰€éœ€è¦çš„ç¯å¢ƒå‚æ•°ã€‚ï¼ˆ2ï¼‰ä»–ä¼šä»è‡ªå·±isaæŒ‡é’ˆç»“åˆç¯å¢ƒå‚æ•°ï¼Œæ‰¾åˆ°å…·ä½“çš„æ–¹æ³•å®ç°çš„æ¥å£ã€‚ï¼ˆ3ï¼‰å†ç›´æ¥æŸ¥æ‰¾å¾—æ¥çš„å…·ä½“çš„æ–¹æ³•å®ç°ã€‚
</code></pre>

<p>KVO</p>

<pre><code>è§‚å¯Ÿè€…ä¸ºä¸€ä¸ªå¯¹è±¡çš„å±æ€§è¿›è¡Œäº†æ³¨å†Œï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡é’ˆè¢«ä¿®æ”¹çš„æ—¶å€™ï¼ŒisaæŒ‡é’ˆå°±ä¼šæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»ï¼ˆsetter/getteræ–¹æ³•ï¼‰ï¼Œè€Œä¸æ˜¯çœŸå®çš„ç±»ã€‚æ‰€ä»¥isaæŒ‡é’ˆå…¶å®ä¸éœ€è¦æŒ‡å‘å®ä¾‹å¯¹è±¡çœŸå®çš„ç±»ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºæœ€å¥½ä¸è¦ä¾èµ–äºisaæŒ‡é’ˆã€‚åœ¨è°ƒç”¨ç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œæœ€å¥½è¦æ˜ç¡®å¯¹è±¡å®ä¾‹çš„ç±»åã€‚
ç†Ÿæ‚‰KVOçš„æœ‹å‹éƒ½çŸ¥é“ï¼Œåªæœ‰å½“æˆ‘ä»¬è°ƒç”¨KVCå»è®¿é—®keyå€¼çš„æ—¶å€™KVOæ‰ä¼šèµ·ä½œç”¨ã€‚æ‰€ä»¥è‚¯å®šç¡®å®šçš„æ˜¯ï¼ŒKVOæ˜¯åŸºäºKVCå®ç°çš„ã€‚å…¶å®çœ‹äº†ä¸Šé¢æˆ‘ä»¬çš„åˆ†æä»¥åï¼Œå…³ç³»KVOçš„æ¶æ„çš„æ„æ€ä¹Ÿå°±æ°´åˆ°æ¸ æˆäº†ã€‚
</code></pre>

<p>ä»»ä½•å·¥ç¨‹äº§å“ï¼ˆæ³¨æ„æ˜¯ä»»ä½•å·¥ç¨‹äº§å“ï¼‰éƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ä¹‹ä¸€è¿›è¡Œæµ‹è¯•ã€‚
é»‘ç›’æµ‹è¯•ï¼šå·²çŸ¥äº§å“çš„åŠŸèƒ½è®¾è®¡è§„æ ¼ï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•è¯æ˜æ¯ä¸ªå®ç°äº†çš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚
ç™½ç›’æµ‹è¯•ï¼šå·²çŸ¥äº§å“çš„å†…éƒ¨å·¥ä½œè¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡æµ‹è¯•è¯æ˜æ¯ç§å†…éƒ¨æ“ä½œæ˜¯å¦ç¬¦åˆè®¾è®¡è§„æ ¼è¦æ±‚ï¼Œæ‰€æœ‰å†…éƒ¨æˆåˆ†æ˜¯å¦ä»¥ç»è¿‡æ£€æŸ¥ã€‚</p>

<h5>é»‘ç›’æµ‹è¯•</h5>

<p>è½¯ä»¶çš„é»‘ç›’æµ‹è¯•æ„å‘³ç€æµ‹è¯•è¦åœ¨è½¯ä»¶çš„æ¥å£å¤„è¿›è¡Œã€‚è¿™ç§æ–¹æ³•æ˜¯æŠŠæµ‹è¯•å¯¹è±¡çœ‹åšä¸€ä¸ªé»‘ç›’å­ï¼Œæµ‹è¯•äººå‘˜å®Œå…¨ä¸è€ƒè™‘ç¨‹åºå†…éƒ¨çš„é€»è¾‘ç»“æ„å’Œå†…éƒ¨ç‰¹æ€§ï¼Œåªä¾æ®ç¨‹åºçš„éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ï¼Œæ£€æŸ¥ç¨‹åºçš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆå®ƒçš„åŠŸèƒ½è¯´æ˜ã€‚å› æ­¤é»‘ç›’æµ‹è¯•åˆå«åŠŸèƒ½æµ‹è¯•æˆ–æ•°æ®é©±åŠ¨æµ‹è¯•ã€‚</p>

<pre><code>é»‘ç›’æµ‹è¯•ä¸»è¦æ˜¯ä¸ºäº†å‘ç°ä»¥ä¸‹å‡ ç±»é”™è¯¯ï¼š
1ã€æ˜¯å¦æœ‰ä¸æ­£ç¡®æˆ–é—æ¼çš„åŠŸèƒ½ï¼Ÿ
2ã€åœ¨æ¥å£ä¸Šï¼Œè¾“å…¥æ˜¯å¦èƒ½æ­£ç¡®çš„æ¥å—ï¼Ÿèƒ½å¦è¾“å‡ºæ­£ç¡®çš„ç»“æœï¼Ÿ
3ã€æ˜¯å¦æœ‰æ•°æ®ç»“æ„é”™è¯¯æˆ–å¤–éƒ¨ä¿¡æ¯ï¼ˆä¾‹å¦‚æ•°æ®æ–‡ä»¶ï¼‰è®¿é—®é”™è¯¯ï¼Ÿ
4ã€æ€§èƒ½ä¸Šæ˜¯å¦èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ï¼Ÿ
5ã€æ˜¯å¦æœ‰åˆå§‹åŒ–æˆ–ç»ˆæ­¢æ€§é”™è¯¯ï¼Ÿ
</code></pre>

<h5>ç™½ç›’æµ‹è¯•</h5>

<p>è½¯ä»¶çš„ç™½ç›’æµ‹è¯•æ˜¯å¯¹è½¯ä»¶çš„è¿‡ç¨‹æ€§ç»†èŠ‚åšç»†è‡´çš„æ£€æŸ¥ã€‚è¿™ç§æ–¹æ³•æ˜¯æŠŠæµ‹è¯•å¯¹è±¡çœ‹åšä¸€ä¸ªæ‰“å¼€çš„ç›’å­ï¼Œå®ƒå…è®¸æµ‹è¯•äººå‘˜åˆ©ç”¨ç¨‹åºå†…éƒ¨çš„é€»è¾‘ç»“æ„åŠæœ‰å…³ä¿¡æ¯ï¼Œè®¾è®¡æˆ–é€‰æ‹©æµ‹è¯•ç”¨ä¾‹ï¼Œå¯¹ç¨‹åºæ‰€æœ‰é€»è¾‘è·¯å¾„è¿›è¡Œæµ‹è¯•ã€‚é€šè¿‡åœ¨ä¸åŒç‚¹æ£€æŸ¥ç¨‹åºçŠ¶æ€ï¼Œç¡®å®šå®é™…çŠ¶æ€æ˜¯å¦ä¸é¢„æœŸçš„çŠ¶æ€ä¸€è‡´ã€‚å› æ­¤ç™½ç›’æµ‹è¯•åˆç§°ä¸ºç»“æ„æµ‹è¯•æˆ–é€»è¾‘é©±åŠ¨æµ‹è¯•ã€‚</p>

<pre><code>ç™½ç›’æµ‹è¯•ä¸»è¦æ˜¯æƒ³å¯¹ç¨‹åºæ¨¡å—è¿›è¡Œå¦‚ä¸‹æ£€æŸ¥ï¼š
1ã€å¯¹ç¨‹åºæ¨¡å—çš„æ‰€æœ‰ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„è‡³å°‘æµ‹è¯•ä¸€éã€‚
2ã€å¯¹æ‰€æœ‰çš„é€»è¾‘åˆ¤å®šï¼Œå–â€œçœŸâ€ä¸å–â€œå‡â€çš„ä¸¤ç§æƒ…å†µéƒ½èƒ½è‡³å°‘æµ‹ä¸€éã€‚
3ã€åœ¨å¾ªç¯çš„è¾¹ç•Œå’Œè¿è¡Œçš„ç•Œé™å†…æ‰§è¡Œå¾ªç¯ä½“ã€‚
4ã€æµ‹è¯•å†…éƒ¨æ•°æ®ç»“æ„çš„æœ‰æ•ˆæ€§ï¼Œç­‰ç­‰ã€‚
</code></pre>

<p>ä»¥ä¸Šäº‹å®è¯´æ˜ï¼Œè½¯ä»¶æµ‹è¯•æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼Œå³æµ‹è¯•çš„ä¸å®Œå…¨ã€ä¸å½»åº•æ€§ã€‚ç”±äºä»»ä½•ç¨‹åºåªèƒ½è¿›è¡Œå°‘é‡ï¼ˆç›¸å¯¹äºç©·ä¸¾çš„å·¨å¤§æ•°é‡è€Œè¨€ï¼‰çš„æœ‰é™çš„æµ‹è¯•ï¼Œåœ¨æœªå‘ç°é”™è¯¯æ—¶ï¼Œä¸èƒ½è¯´æ˜ç¨‹åºä¸­æ²¡æœ‰é”™è¯¯ã€‚</p>

<h5>ç°ç›’æµ‹è¯•</h5>

<p>ç°ç›’æµ‹è¯•ï¼Œæ˜¯ä»‹äºç™½ç›’æµ‹è¯•ä¸é»‘ç›’æµ‹è¯•ä¹‹é—´çš„ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼Œç°ç›’æµ‹è¯•å…³æ³¨è¾“å‡ºå¯¹äºè¾“å…¥çš„æ­£ç¡®æ€§ï¼ŒåŒæ—¶ä¹Ÿå…³æ³¨å†…éƒ¨è¡¨ç°ï¼Œä½†è¿™ç§å…³æ³¨ä¸è±¡ç™½ç›’é‚£æ ·è¯¦ç»†ã€å®Œæ•´ï¼Œåªæ˜¯é€šè¿‡ä¸€äº›è¡¨å¾æ€§çš„ç°è±¡ã€äº‹ä»¶ã€æ ‡å¿—æ¥åˆ¤æ–­å†…éƒ¨çš„è¿è¡ŒçŠ¶æ€ï¼Œæœ‰æ—¶å€™è¾“å‡ºæ˜¯æ­£ç¡®çš„ï¼Œä½†å†…éƒ¨å…¶å®å·²ç»é”™è¯¯äº†ï¼Œè¿™ç§æƒ…å†µéå¸¸å¤šï¼Œå¦‚æœæ¯æ¬¡éƒ½é€šè¿‡ç™½ç›’æµ‹è¯•æ¥æ“ä½œï¼Œæ•ˆç‡ä¼šå¾ˆä½ï¼Œå› æ­¤éœ€è¦é‡‡å–è¿™æ ·çš„ä¸€ç§ç°ç›’çš„æ–¹æ³•ã€‚</p>

<h3>å…¨æ ˆç›¸å…³</h3>

<h3>ç®—æ³•ï¼ˆå¸¸ç”¨ã€æ’åºï¼‰</h3>

<h3>æ•°æ®ç»“æ„</h3>

<h3>è®¾è®¡æ¨¡å¼ï¼ˆ32ä¸­ï¼‰</h3>

<h3>æ¶æ„è®¾è®¡</h3>

<h3>é€†å‘å·¥ç¨‹</h3>

<h3>å®æˆ˜åº”ç”¨</h3>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¤šçº¿ç¨‹ä¹‹è‘µèŠ±å®å…¸]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/10/duoxianc/"/>
    <updated>2016-07-10T14:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/10/duoxianc</id>
    <content type="html"><![CDATA[<h2>ä¸€ã€è¿›ç¨‹å’Œçº¿ç¨‹</h2>

<h4>1.ä»€ä¹ˆæ˜¯è¿›ç¨‹</h4>

<pre><code>è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åº

æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†…





æ¯”å¦‚åŒæ—¶æ‰“å¼€QQã€Xcodeï¼Œç³»ç»Ÿå°±ä¼šåˆ†åˆ«å¯åŠ¨2ä¸ªè¿›ç¨‹

é€šè¿‡â€œæ´»åŠ¨ç›‘è§†å™¨â€å¯ä»¥æŸ¥çœ‹Macç³»ç»Ÿä¸­æ‰€å¼€å¯çš„è¿›ç¨‹
</code></pre>

<!--more-->


<h4>2.ä»€ä¹ˆæ˜¯çº¿ç¨‹</h4>

<pre><code>1ä¸ªè¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹ï¼ˆæ¯1ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰1æ¡çº¿ç¨‹ï¼‰

çº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ

æ¯”å¦‚ä½¿ç”¨é…·ç‹—æ’­æ”¾éŸ³ä¹ã€ä½¿ç”¨è¿…é›·ä¸‹è½½ç”µå½±ï¼Œéƒ½éœ€è¦åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ
</code></pre>

<p> ã€€ã€€</p>

<h4>3.çº¿ç¨‹çš„ä¸²è¡Œ</h4>

<pre><code>1ä¸ªçº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„

å¦‚æœè¦åœ¨1ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆåªèƒ½ä¸€ä¸ªä¸€ä¸ªåœ°æŒ‰é¡ºåºæ‰§è¡Œè¿™äº›ä»»åŠ¡

ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒä¸€æ—¶é—´å†…ï¼Œ1ä¸ªçº¿ç¨‹åªèƒ½æ‰§è¡Œ1ä¸ªä»»åŠ¡

æ¯”å¦‚åœ¨1ä¸ªçº¿ç¨‹ä¸­ä¸‹è½½3ä¸ªæ–‡ä»¶ï¼ˆåˆ†åˆ«æ˜¯æ–‡ä»¶Aã€æ–‡ä»¶Bã€æ–‡ä»¶Cï¼‰
</code></pre>

<h2>äºŒã€å¤šçº¿ç¨‹</h2>

<h4>1.ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹</h4>

<pre><code>1ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¯ä»¥å¹¶è¡Œï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œä¸åŒçš„ä»»åŠ¡

è¿›ç¨‹ -&gt;è½¦é—´ï¼Œçº¿ç¨‹-&gt;è½¦é—´å·¥äºº

å¤šçº¿ç¨‹æŠ€æœ¯å¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡

æ¯”å¦‚åŒæ—¶å¼€å¯3æ¡çº¿ç¨‹åˆ†åˆ«ä¸‹è½½3ä¸ªæ–‡ä»¶ï¼ˆåˆ†åˆ«æ˜¯æ–‡ä»¶Aã€æ–‡ä»¶Bã€æ–‡ä»¶Cï¼‰
</code></pre>

<h4>2.å¤šçº¿ç¨‹çš„åŸç†</h4>

<pre><code>åŒä¸€æ—¶é—´ï¼ŒCPUåªèƒ½å¤„ç†1æ¡çº¿ç¨‹ï¼Œåªæœ‰1æ¡çº¿ç¨‹åœ¨å·¥ä½œï¼ˆæ‰§è¡Œï¼‰
å¤šçº¿ç¨‹å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼Œå…¶å®æ˜¯CPUå¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰
å¦‚æœCPUè°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«ï¼Œå°±é€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡
æ€è€ƒï¼šå¦‚æœçº¿ç¨‹éå¸¸éå¸¸å¤šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ
CPUä¼šåœ¨Nå¤šçº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ŒCPUä¼šç´¯æ­»ï¼Œæ¶ˆè€—å¤§é‡çš„CPUèµ„æº
æ¯æ¡çº¿ç¨‹è¢«è°ƒåº¦æ‰§è¡Œçš„é¢‘æ¬¡ä¼šé™ä½ï¼ˆçº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡é™ä½ï¼‰
</code></pre>

<h4>3.å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹</h4>

<p>å¤šçº¿ç¨‹çš„ä¼˜ç‚¹</p>

<pre><code>èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡

èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜åˆ©ç”¨ç‡ï¼‰
</code></pre>

<p>å¤šçº¿ç¨‹çš„ç¼ºç‚¹</p>

<pre><code>å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å ç”¨1Mï¼Œå­çº¿ç¨‹å ç”¨512KBï¼‰ï¼Œå¦‚æœå¼€å¯å¤§é‡çš„çº¿ç¨‹ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ï¼Œé™ä½ç¨‹åºçš„æ€§èƒ½

çº¿ç¨‹è¶Šå¤šï¼ŒCPUåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§

ç¨‹åºè®¾è®¡æ›´åŠ å¤æ‚ï¼šæ¯”å¦‚çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€å¤šçº¿ç¨‹çš„æ•°æ®å…±äº«
</code></pre>

<h4>4.å¤šçº¿ç¨‹åœ¨iOSå¼€å‘ä¸­çš„åº”ç”¨</h4>

<pre><code>ä¸»çº¿ç¨‹:ä¸€ä¸ªiOSç¨‹åºè¿è¡Œåï¼Œé»˜è®¤ä¼šå¼€å¯1æ¡çº¿ç¨‹ï¼Œç§°ä¸ºâ€œä¸»çº¿ç¨‹â€æˆ–â€œUIçº¿ç¨‹â€

ä¸»çº¿ç¨‹çš„ä¸»è¦ä½œç”¨

æ˜¾ç¤º\åˆ·æ–°UIç•Œé¢

å¤„ç†UIäº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ã€æ»šåŠ¨äº‹ä»¶ã€æ‹–æ‹½äº‹ä»¶ç­‰ï¼‰
</code></pre>

<p>ä¸»çº¿ç¨‹çš„ä½¿ç”¨æ³¨æ„:åˆ«å°†æ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­ã€‚</p>

<p>è€—æ—¶æ“ä½œä¼šå¡ä½ä¸»çº¿ç¨‹ï¼Œä¸¥é‡å½±å“UIçš„æµç•…åº¦ï¼Œç»™ç”¨æˆ·ä¸€ç§â€œå¡â€çš„åä½“éªŒ</p>

<h2>å¤šçº¿ç¨‹çš„å››ä¸­æ–¹å¼</h2>

<h4>1. Pthreads</h4>

<h4>2. NSThread</h4>

<h4>3. GCD</h4>

<h4>4. NSOperation &amp; NSOperationQueue</h4>

<h2>å¤šçº¿ç¨‹çš„å…¨è§£æ-çœ‹äº†ä¸ä¿¡ä½ è¿˜ä¸ä¼šï¼Ÿ</h2>

<p><img src="http://al1020119.github.io/images/multithread.png" title="Caption" ></p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CoreData ğŸ˜˜ SQLite ğŸ˜ FMDB]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/05/zsqlfmdbcoredata/"/>
    <updated>2016-07-05T14:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/05/zsqlfmdbcoredata</id>
    <content type="html"><![CDATA[<p>æ¦‚è§ˆ</p>

<p>åœ¨iOSå¼€å‘ä¸­æ•°æ®å­˜å‚¨çš„æ–¹å¼å¯ä»¥å½’çº³ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯å­˜å‚¨ä¸ºæ–‡ä»¶ï¼Œå¦ä¸€ç±»æ˜¯å­˜å‚¨åˆ°æ•°æ®åº“ã€‚ä¾‹å¦‚å‰é¢IOSå¼€å‘ç³»åˆ—â€”Objective-Cä¹‹Foundationæ¡†æ¶çš„æ–‡ç« ä¸­æåˆ°å½’æ¡£ã€plistæ–‡ä»¶å­˜å‚¨ï¼ŒåŒ…æ‹¬åå¥½è®¾ç½®å…¶æœ¬è´¨éƒ½æ˜¯å­˜å‚¨ä¸ºæ–‡ä»¶ï¼Œåªæ˜¯è¯´å½’æ¡£æˆ–è€…plistæ–‡ä»¶å­˜å‚¨å¯ä»¥é€‰æ‹©ä¿å­˜åˆ°æ²™ç›’ä¸­ï¼Œè€Œåå¥½è®¾ç½®ç³»ç»Ÿå·²ç»è§„å®šåªèƒ½ä¿å­˜åˆ°æ²™ç›’çš„Library/Preferencesç›®å½•ã€‚å½“ç„¶ï¼Œæ–‡ä»¶å­˜å‚¨å¹¶ä¸ä½œä¸ºæœ¬æ–‡çš„é‡ç‚¹å†…å®¹ã€‚æœ¬æ–‡é‡ç‚¹è¿˜æ˜¯è¯´æ•°æ®åº“å­˜å‚¨ï¼Œåšè¿‡æ•°æ®åº“å¼€å‘çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡SQLç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ORMè¿›è¡Œå¯¹è±¡å…³ç³»æ˜ å°„è®¿é—®æ•°æ®åº“ã€‚è¿™ä¸¤ç§æ–¹å¼æ°æ°å¯¹åº”iOSä¸­SQLiteå’ŒCore Dataçš„å†…å®¹ï¼Œåœ¨æ­¤å°†é‡ç‚¹è¿›è¡Œåˆ†æ:</p>

<h3>1. SQLite</h3>

<h3>2. Core Data</h3>

<h3>3. FMDB</h3>

<!--more-->


<hr />

<h2>SQLite</h2>

<p>SQLiteæ˜¯ç›®å‰ä¸»æµçš„åµŒå…¥å¼å…³ç³»å‹æ•°æ®åº“ï¼Œå…¶æœ€ä¸»è¦çš„ç‰¹ç‚¹å°±æ˜¯è½»é‡çº§ã€è·¨å¹³å°ï¼Œå½“å‰å¾ˆå¤šåµŒå…¥å¼æ“ä½œç³»ç»Ÿéƒ½å°†å…¶ä½œä¸ºæ•°æ®åº“é¦–é€‰ã€‚è™½ç„¶SQLiteæ˜¯ä¸€æ¬¾è½»å‹æ•°æ®åº“ï¼Œä½†æ˜¯å…¶åŠŸèƒ½ä¹Ÿç»ä¸äºšäºå¾ˆå¤šå¤§å‹å…³ç³»æ•°æ®åº“ã€‚å­¦ä¹ æ•°æ®åº“å°±è¦å­¦ä¹ å…¶ç›¸å…³çš„å®šä¹‰ã€æ“ä½œã€æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶æ—¥å¸¸è¯´å¾—SQLè¯­å¥ã€‚å’Œå…¶ä»–æ•°æ®åº“ç›¸æ¯”ï¼ŒSQLiteä¸­çš„SQLè¯­æ³•å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ï¼Œå› æ­¤è¿™é‡Œå¯¹äºSQLè¯­å¥çš„å†…å®¹ä¸ä¼šè¿‡å¤šèµ˜è¿°ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒSQLiteä¸­å…¶ä»–SQLç›¸å…³çš„å†…å®¹ï¼Œè¿™é‡Œè¿˜æ˜¯é‡ç‚¹è®²è§£iOSä¸­å¦‚ä½•ä½¿ç”¨SQLiteæ„å»ºåº”ç”¨ç¨‹åºã€‚å…ˆçœ‹ä¸€ä¸‹SQLiteæ•°æ®åº“çš„å‡ ä¸ªç‰¹ç‚¹ï¼š</p>

<ol>
<li><p>åŸºäºCè¯­è¨€å¼€å‘çš„è½»å‹æ•°æ®åº“</p></li>
<li><p>åœ¨iOSä¸­éœ€è¦ä½¿ç”¨Cè¯­è¨€è¯­æ³•è¿›è¡Œæ•°æ®åº“æ“ä½œã€è®¿é—®ï¼ˆæ— æ³•ä½¿ç”¨ObjCç›´æ¥è®¿é—®ï¼Œå› ä¸ºlibqlite3æ¡†æ¶åŸºäºCè¯­è¨€ç¼–å†™ï¼‰</p></li>
<li><p>SQLiteä¸­é‡‡ç”¨çš„æ˜¯åŠ¨æ€æ•°æ®ç±»å‹ï¼Œå³ä½¿åˆ›å»ºæ—¶å®šä¹‰äº†ä¸€ç§ç±»å‹ï¼Œåœ¨å®é™…æ“ä½œæ—¶ä¹Ÿå¯ä»¥å­˜å‚¨å…¶ä»–ç±»å‹ï¼Œä½†æ˜¯æ¨èå»ºåº“æ—¶ä½¿ç”¨åˆé€‚çš„ç±»å‹ï¼ˆç‰¹åˆ«æ˜¯åº”ç”¨éœ€è¦è€ƒè™‘è·¨å¹³å°çš„æƒ…å†µæ—¶ï¼‰</p></li>
<li><p>å»ºç«‹è¿æ¥åé€šå¸¸ä¸éœ€è¦å…³é—­è¿æ¥ï¼ˆå°½ç®¡å¯ä»¥æ‰‹åŠ¨å…³é—­ï¼‰</p></li>
</ol>


<p>è¦ä½¿ç”¨SQLiteå¾ˆç®€å•ï¼Œå¦‚æœåœ¨Mac OSXä¸Šä½¿ç”¨å¯ä»¥è€ƒè™‘åˆ°SQLiteå®˜æ–¹ç½‘ç«™ä¸‹è½½å‘½ä»¤è¡Œå·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼äºSQLiteManagerã€Navicat for SQLiteç­‰å·¥å…·ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶å¼€å‘è°ƒè¯•ï¼Œå»ºè®®åœ¨å¼€å‘ç¯å¢ƒä¸­å®‰è£…ä¸Šè¿°å·¥å…·ã€‚</p>

<p>åœ¨iOSä¸­æ“ä½œSQLiteæ•°æ®åº“å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼ˆæ³¨æ„å…ˆåœ¨é¡¹ç›®ä¸­å¯¼å…¥libsqlite3æ¡†æ¶ï¼‰ï¼š</p>

<ol>
<li><p>æ‰“å¼€æ•°æ®åº“ï¼Œåˆ©ç”¨sqlite3_open()æ‰“å¼€æ•°æ®åº“ä¼šæŒ‡å®šä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€ï¼Œå¦åˆ™åˆ›å»ºå¹¶æ‰“å¼€ã€‚æ‰“å¼€æ•°æ®åº“ä¼šå¾—åˆ°ä¸€ä¸ªsqlite3ç±»å‹çš„å¯¹è±¡ï¼Œåé¢éœ€è¦å€ŸåŠ©è¿™ä¸ªå¯¹è±¡è¿›è¡Œå…¶ä»–æ“ä½œã€‚</p></li>
<li><p>æ‰§è¡ŒSQLè¯­å¥ï¼Œæ‰§è¡ŒSQLè¯­å¥åˆåŒ…æ‹¬æœ‰è¿”å›å€¼çš„è¯­å¥å’Œæ— è¿”å›å€¼è¯­å¥ã€‚</p></li>
<li><p>å¯¹äºæ— è¿”å›å€¼çš„è¯­å¥ï¼ˆå¦‚å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ï¼‰ç›´æ¥é€šè¿‡sqlite3_exec()å‡½æ•°æ‰§è¡Œï¼›</p></li>
<li><p>å¯¹äºæœ‰è¿”å›å€¼çš„è¯­å¥åˆ™é¦–å…ˆé€šè¿‡sqlite3_prepare_v2()è¿›è¡Œsqlè¯­å¥è¯„ä¼°ï¼ˆè¯­æ³•æ£€æµ‹ï¼‰ï¼Œç„¶åé€šè¿‡sqlite3_step()ä¾æ¬¡å–å‡ºæŸ¥è¯¢ç»“æœçš„æ¯ä¸€è¡Œæ•°æ®ï¼Œå¯¹äºæ¯è¡Œæ•°æ®éƒ½å¯ä»¥é€šè¿‡å¯¹åº”çš„sqlite3_column_ç±»å‹()æ–¹æ³•è·å¾—å¯¹åº”åˆ—çš„æ•°æ®ï¼Œå¦‚æ­¤åå¤å¾ªç¯ç›´åˆ°éå†å®Œæˆã€‚å½“ç„¶ï¼Œæœ€åéœ€è¦é‡Šæ”¾å¥æŸ„ã€‚</p></li>
</ol>


<p>åœ¨æ•´ä¸ªæ“ä½œè¿‡ç¨‹ä¸­æ— éœ€ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œå¯¹äºåµŒå…¥å¼SQLiteæ“ä½œæ˜¯æŒä¹…è¿æ¥ï¼ˆå°½ç®¡å¯ä»¥é€šè¿‡sqlite3_close()å…³é—­ï¼‰ï¼Œä¸éœ€è¦å¼€å‘äººå‘˜è‡ªå·±é‡Šæ”¾è¿æ¥ã€‚çºµè§‚æ•´ä¸ªæ“ä½œè¿‡ç¨‹ï¼Œå…¶å®ä¸å…¶ä»–å¹³å°çš„å¼€å‘æ²¡æœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼Œè¾ƒä¸ºéº»çƒ¦çš„å°±æ˜¯æ•°æ®è¯»å–ï¼Œåœ¨iOSå¹³å°ä¸­ä½¿ç”¨Cè¿›è¡Œæ•°æ®è¯»å–é‡‡ç”¨äº†æ¸¸æ ‡çš„å½¢å¼ï¼Œæ¯æ¬¡åªèƒ½è¯»å–ä¸€è¡Œæ•°æ®ï¼Œè¾ƒä¸ºéº»çƒ¦ã€‚å› æ­¤å®é™…å¼€å‘ä¸­ä¸å¦¨å¯¹è¿™äº›æ“ä½œè¿›è¡Œå°è£…ï¼š</p>

<p>KCDbManager.h
    //
    //  DbManager.h
    //  DataAccess
    //
    //  Created by Kenshin Cui on 14-3-29.
    //  Copyright &copy; 2014å¹´ Kenshin Cui. All rights reserved.
    //
    #import &lt;Foundation/Foundation.h>
    #import &lt;sqlite3.h>
    #import &ldquo;KCSingleton.h&rdquo;
    @interface KCDbManager : NSObject
    singleton_interface(KCDbManager);
    #pragma mark - å±æ€§
    #pragma mark æ•°æ®åº“å¼•ç”¨ï¼Œä½¿ç”¨å®ƒè¿›è¡Œæ•°æ®åº“æ“ä½œ
    @property (nonatomic) sqlite3 <em>database;
    #pragma mark - å…±æœ‰æ–¹æ³•
    /**
     *  æ‰“å¼€æ•°æ®åº“
     *
     *  @param dbname æ•°æ®åº“åç§°
     </em>/
    -(void)openDb:(NSString <em>)dbname;
    /**
     *  æ‰§è¡Œæ— è¿”å›å€¼çš„sql
     *
     *  @param sql sqlè¯­å¥
     </em>/
    -(void)executeNonQuery:(NSString <em>)sql;
    /**
     *  æ‰§è¡Œæœ‰è¿”å›å€¼çš„sql
     *
     *  @param sql sqlè¯­å¥
     *
     *  @return æŸ¥è¯¢ç»“æœ
     </em>/
    -(NSArray <em>)executeQuery:(NSString </em>)sql;
    @end</p>

<pre><code>KCDbManager.m
//
//  DbManager.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import "KCDbManager.h"
#import &lt;sqlite3.h&gt;
#import "KCSingleton.h"
#import "KCAppConfig.h"
#ifndef kDatabaseName
#define kDatabaseName @"myDatabase.db"
#endif
@interface KCDbManager()
@end
@implementation KCDbManager
singleton_implementation(KCDbManager)
#pragma mark é‡å†™åˆå§‹åŒ–æ–¹æ³•
-(instancetype)init{
    KCDbManager *manager;
    if((manager=[super init]))
    {
        [manager openDb:kDatabaseName];
    }
    return manager;
}
-(void)openDb:(NSString *)dbname{
    //å–å¾—æ•°æ®åº“ä¿å­˜è·¯å¾„ï¼Œé€šå¸¸ä¿å­˜æ²™ç›’Documentsç›®å½•
    NSString *directory=[NSSearchPathForDirectoriesInDomains(NSDocumentationDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@"%@",directory);
    NSString *filePath=[directory stringByAppendingPathComponent:dbname];
    //å¦‚æœæœ‰æ•°æ®åº“åˆ™ç›´æ¥æ‰“å¼€ï¼Œå¦åˆ™åˆ›å»ºå¹¶æ‰“å¼€ï¼ˆæ³¨æ„filePathæ˜¯ObjCä¸­çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦è½¬åŒ–ä¸ºCè¯­è¨€å­—ç¬¦ä¸²ç±»å‹ï¼‰
    if (SQLITE_OK ==sqlite3_open(filePath.UTF8String, &amp;_database)) {
        NSLog(@"æ•°æ®åº“æ‰“å¼€æˆåŠŸ!");
    }else{
        NSLog(@"æ•°æ®åº“æ‰“å¼€å¤±è´¥!");
    }
}
-(void)executeNonQuery:(NSString *)sql{
    char *error;
    //å•æ­¥æ‰§è¡Œsqlè¯­å¥ï¼Œç”¨äºæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤
    if (SQLITE_OK!=sqlite3_exec(_database, sql.UTF8String, NULL, NULL,&amp;error)) {
        NSLog(@"æ‰§è¡ŒSQLè¯­å¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼é”™è¯¯ä¿¡æ¯ï¼š%s",error);
    }
}
-(NSArray *)executeQuery:(NSString *)sql{
    NSMutableArray *rows=[NSMutableArray array];//æ•°æ®è¡Œ

    //è¯„ä¼°è¯­æ³•æ­£ç¡®æ€§
    sqlite3_stmt *stmt;
    //æ£€æŸ¥è¯­æ³•æ­£ç¡®æ€§
    if (SQLITE_OK==sqlite3_prepare_v2(_database, sql.UTF8String, -1, &amp;stmt, NULL)) {
        //å•æ­¥æ‰§è¡Œsqlè¯­å¥
        while (SQLITE_ROW==sqlite3_step(stmt)) {
            int columnCount= sqlite3_column_count(stmt);
            NSMutableDictionary *dic=[NSMutableDictionary dictionary];
            for (int i=0; i&lt;columnCount; i++) {
                const char *name= sqlite3_column_name(stmt, i);//å–å¾—åˆ—å
                const unsigned char *value= sqlite3_column_text(stmt, i);//å–å¾—æŸåˆ—çš„å€¼
                dic[[NSString stringWithUTF8String:name]]=[NSString stringWithUTF8String:(const char *)value];
            }
            [rows addObject:dic];
        }
    }

    //é‡Šæ”¾å¥æŸ„
    sqlite3_finalize(stmt);

    return rows;
}
@end
</code></pre>

<p>åœ¨ä¸Šé¢çš„ç±»ä¸­å¯¹äºæ•°æ®åº“æ“ä½œè¿›è¡Œäº†å°è£…ï¼Œå°è£…ä¹‹åæ•°æ®æ“ä½œæ›´åŠ æ–¹ä¾¿ï¼ŒåŒæ—¶æ‰€æœ‰çš„è¯­æ³•éƒ½ç”±Cè½¬æ¢æˆäº†ObjCã€‚</p>

<p>ä¸‹é¢ä»ç„¶ä»¥å¾®åšæŸ¥çœ‹ä¸ºä¾‹è¿›è¡ŒSQLiteæ¼”ç¤ºã€‚å½“ç„¶å®é™…å¼€å‘ä¸­å¾®åšæ•°æ®æ˜¯ä»ç½‘ç»œè¯»å–çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç¼“å­˜é—®é¢˜ï¼Œé€šå¸¸ä¼šé€‰æ‹©å°†å¾®åšæ•°æ®ä¿å­˜åˆ°æœ¬åœ°ï¼Œä¸‹é¢çš„Demoæ¼”ç¤ºäº†å°†æ•°æ®å­˜æ”¾åˆ°æœ¬åœ°æ•°æ®åº“ä»¥åŠæ•°æ®è¯»å–çš„è¿‡ç¨‹ã€‚å½“ç„¶ï¼Œå®é™…å¼€å‘ä¸­å¹¶ä¸ä¼šåœ¨è§†å›¾æ§åˆ¶å™¨ä¸­ç›´æ¥è°ƒç”¨æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼Œåœ¨è¿™é‡Œé€šå¸¸ä¼šå¼•å…¥ä¸¤ä¸ªæ¦‚å¿µModelå’ŒServiceã€‚Modelè‡ªä¸å¿…å¤šè¯´ï¼Œå°±æ˜¯MVCä¸­çš„æ¨¡å‹ã€‚è€ŒServiceæŒ‡çš„æ˜¯æ“ä½œæ•°æ®åº“çš„æœåŠ¡å±‚ï¼Œå®ƒå°è£…äº†å¯¹äºModelçš„åŸºæœ¬æ“ä½œæ–¹æ³•ï¼Œå®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚ä¸ºäº†è§£è€¦ï¼Œåœ¨æ§åˆ¶å™¨ä¸­æ˜¯ä¸ä¼šç›´æ¥æ¥è§¦æ•°æ®åº“çš„ï¼Œæ§åˆ¶å™¨ä¸­åªå’Œæ¨¡å‹ï¼ˆæ¨¡å‹æ˜¯é¢†åŸŸçš„æŠ½è±¡ï¼‰ã€æœåŠ¡å¯¹è±¡æœ‰å…³ç³»ï¼Œå€ŸåŠ©æœåŠ¡å±‚å¯¹æ¨¡å‹è¿›è¡Œå„ç±»æ“ä½œï¼Œæ¨¡å‹çš„æ“ä½œååº”åˆ°æ•°æ®åº“ä¸­å°±æ˜¯å¯¹è¡¨ä¸­æ•°æ®çš„æ“ä½œã€‚å…·ä½“å…³ç³»å¦‚ä¸‹ï¼š</p>

<p><img src="http://al1020119.github.io/images/CSR001.jpg" title="Caption" ></p>

<p>è¦å®Œæˆä¸Šè¿°åŠŸèƒ½ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªåº”ç”¨ç¨‹åºå…¨å±€å¯¹è±¡è¿›è¡Œæ•°æ®åº“ã€è¡¨çš„åˆ›å»ºã€‚ä¸ºäº†é¿å…æ¯æ¬¡éƒ½åˆ›å»ºæ•°æ®åº“å’Œè¡¨å‡ºé”™ï¼Œè¿™é‡Œåˆ©ç”¨äº†åå¥½è®¾ç½®è¿›è¡Œä¿å­˜å½“å‰åˆ›å»ºçŠ¶æ€ï¼ˆå…¶å®è¿™ä¹Ÿæ˜¯æ•°æ®å­˜å‚¨çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¦‚æœåˆ›å»ºè¿‡äº†æ•°æ®åº“åˆ™ä¸å†åˆ›å»ºï¼Œå¦åˆ™åˆ›å»ºæ•°æ®åº“å’Œè¡¨ã€‚</p>

<p>KCDatabaseCreator.m</p>

<pre><code>//
//  KCDatabaseCreator.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import "KCDatabaseCreator.h"
#import "KCDbManager.h"
@implementation KCDatabaseCreator
+(void)initDatabase{
    NSString *key=@"IsCreatedDb";
    NSUserDefaults *defaults=[[NSUserDefaults alloc]init];
    if ([[defaults valueForKey:key] intValue]!=1) {
        [self createUserTable];
        [self createStatusTable];
        [defaults setValue:@1 forKey:key];
    }
}
+(void)createUserTable{
    NSString *sql=@"CREATE TABLE User (Id integer PRIMARY KEY AUTOINCREMENT,name text,screenName text, profileImageUrl text,mbtype text,city text)";
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
+(void)createStatusTable{
    NSString *sql=@"CREATE TABLE Status (Id integer PRIMARY KEY AUTOINCREMENT,source text,createdAt date,\"text\" text,user integer REFERENCES User (Id))";
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
@end
</code></pre>

<p>å…¶æ¬¡ï¼Œå®šä¹‰æ•°æ®æ¨¡å‹ï¼Œè¿™é‡Œå®šä¹‰ç”¨æˆ·Userå’Œå¾®åšStatusä¸¤ä¸ªæ•°æ®æ¨¡å‹ç±»ã€‚æ³¨æ„æ¨¡å‹åº”è¯¥å°½é‡ä¿æŒå…¶å•çº¯æ€§ï¼Œä»…ä»…æ˜¯ç®€å•çš„POCOï¼Œä¸è¦å¼•å…¥è§†å›¾ã€æ§åˆ¶å™¨ç­‰ç›¸å…³å†…å®¹ã€‚</p>

<p>KCUser.h</p>

<pre><code>//
//  KCUser.h
//  UrlConnection
//
//  Created by Kenshin Cui on 14-3-22.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import &lt;Foundation/Foundation.h&gt;
@interface KCUser : NSObject
#pragma mark ç¼–å·
@property (nonatomic,strong) NSNumber *Id;
#pragma mark ç”¨æˆ·å
@property (nonatomic,copy) NSString *name;
#pragma mark ç”¨æˆ·æ˜µç§°
@property (nonatomic,copy) NSString *screenName;
#pragma mark å¤´åƒ
@property (nonatomic,copy) NSString *profileImageUrl;
#pragma mark ä¼šå‘˜ç±»å‹
@property (nonatomic,copy) NSString *mbtype;
#pragma mark åŸå¸‚
@property (nonatomic,copy) NSString *city;
#pragma mark - åŠ¨æ€æ–¹æ³•
/**
 *  åˆå§‹åŒ–ç”¨æˆ·
 *
 *  @param name ç”¨æˆ·å
 *  @param city æ‰€åœ¨åŸå¸‚
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 */
-(KCUser *)initWithName:(NSString *)name screenName:(NSString *)screenName profileImageUrl:(NSString *)profileImageUrl mbtype:(NSString *)mbtype city:(NSString *)city;
/**
 *  ä½¿ç”¨å­—å…¸åˆå§‹åŒ–ç”¨æˆ·å¯¹è±¡
 *
 *  @param dic ç”¨æˆ·æ•°æ®
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 */
-(KCUser *)initWithDictionary:(NSDictionary *)dic;
#pragma mark - é™æ€æ–¹æ³•
+(KCUser *)userWithName:(NSString *)name screenName:(NSString *)screenName profileImageUrl:(NSString *)profileImageUrl mbtype:(NSString *)mbtype city:(NSString *)city;
@end
</code></pre>

<p>KCUser.m</p>

<pre><code>//
//  KCUser.m
//  UrlConnection
//
//  Created by Kenshin Cui on 14-3-22.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import "KCUser.h"
@implementation KCUser
-(KCUser *)initWithName:(NSString *)name screenName:(NSString *)screenName profileImageUrl:(NSString *)profileImageUrl mbtype:(NSString *)mbtype city:(NSString *)city{
    if (self=[super init]) {
        self.name=name;
        self.screenName=screenName;
        self.profileImageUrl=profileImageUrl;
        self.mbtype=mbtype;
        self.city=city;
    }
    return self;
}
-(KCUser *)initWithDictionary:(NSDictionary *)dic{
    if (self=[super init]) {
        [self setValuesForKeysWithDictionary:dic];
    }
    return self;
}
+(KCUser *)userWithName:(NSString *)name screenName:(NSString *)screenName profileImageUrl:(NSString *)profileImageUrl mbtype:(NSString *)mbtype city:(NSString *)city{
    KCUser *user=[[KCUser alloc]initWithName:name screenName:screenName profileImageUrl:profileImageUrl mbtype:mbtype city:city];
    return user;
}
</code></pre>

<p>@end</p>

<p>KCStatus.h</p>

<pre><code>//
//  KCStatus.h
//  UITableView
//
//  Created by Kenshin Cui on 14-3-1.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import &lt;Foundation/Foundation.h&gt;
#import "KCUser.h"
@interface KCStatus : NSObject
#pragma mark - å±æ€§
@property (nonatomic,strong) NSNumber *Id;//å¾®åšid
@property (nonatomic,strong) KCUser *user;//å‘é€ç”¨æˆ·
@property (nonatomic,copy) NSString *createdAt;//åˆ›å»ºæ—¶é—´
@property (nonatomic,copy) NSString *source;//è®¾å¤‡æ¥æº
@property (nonatomic,copy) NSString *text;//å¾®åšå†…å®¹
#pragma mark - åŠ¨æ€æ–¹æ³•
/**
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param user            å‘é€ç”¨æˆ·
 *
 *  @return å¾®åšå¯¹è±¡
 */
-(KCStatus *)initWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text user:(KCUser *)user;
/**
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param profileImageUrl ç”¨æˆ·å¤´åƒ
 *  @param mbtype          ä¼šå‘˜ç±»å‹
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param userId          ç”¨æˆ·ç¼–å·
 *
 *  @return å¾®åšå¯¹è±¡
 */
-(KCStatus *)initWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text userId:(int)userId;
/**
 *  ä½¿ç”¨å­—å…¸åˆå§‹åŒ–å¾®åšå¯¹è±¡
 *
 *  @param dic å­—å…¸æ•°æ®
 *
 *  @return å¾®åšå¯¹è±¡
 */
-(KCStatus *)initWithDictionary:(NSDictionary *)dic;
#pragma mark - é™æ€æ–¹æ³•
/**
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param user            å‘é€ç”¨æˆ·
 *
 *  @return å¾®åšå¯¹è±¡
 */
+(KCStatus *)statusWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text user:(KCUser *)user;
/**
 *  åˆå§‹åŒ–å¾®åšæ•°æ®
 *
 *  @param profileImageUrl ç”¨æˆ·å¤´åƒ
 *  @param mbtype          ä¼šå‘˜ç±»å‹
 *  @param createAt        åˆ›å»ºæ—¥æœŸ
 *  @param source          æ¥æº
 *  @param text            å¾®åšå†…å®¹
 *  @param userId          ç”¨æˆ·ç¼–å·
 *
 *  @return å¾®åšå¯¹è±¡
 */
+(KCStatus *)statusWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text userId:(int)userId;
@end
</code></pre>

<p>KCStatus.m</p>

<pre><code>//
//  KCStatus.m
//  UITableView
//
//  Created by Kenshin Cui on 14-3-1.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import "KCStatus.h"
@implementation KCStatus
-(KCStatus *)initWithDictionary:(NSDictionary *)dic{
    if (self=[super init]) {
        [self setValuesForKeysWithDictionary:dic];
        self.user=[[KCUser alloc]init];
        self.user.Id=dic[@"user"];
    }
    return self;
}
-(KCStatus *)initWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text user:(KCUser *)user{
    if (self=[super init]) {
        self.createdAt=createAt;
        self.source=source;
        self.text=text;
        self.user=user;
    }
    return self;
}
-(KCStatus *)initWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text userId:(int)userId{
    if (self=[super init]) {
        self.createdAt=createAt;
        self.source=source;
        self.text=text;
        KCUser *user=[[KCUser alloc]init];
        user.Id=[NSNumber numberWithInt:userId];
        self.user=user;
    }
    return self;
}
-(NSString *)source{
    return [NSString stringWithFormat:@"æ¥è‡ª %@",_source];
}
+(KCStatus *)statusWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text user:(KCUser *)user{
    KCStatus *status=[[KCStatus alloc]initWithCreateAt:createAt source:source text:text user:user];
    return status;
}
+(KCStatus *)statusWithCreateAt:(NSString *)createAt source:(NSString *)source text:(NSString *)text userId:(int)userId{
    KCStatus *status=[[KCStatus alloc]initWithCreateAt:createAt source:source text:text userId:userId];
    return status;
}
@end
</code></pre>

<p>ç„¶åï¼Œç¼–å†™æœåŠ¡ç±»ï¼Œè¿›è¡Œæ•°æ®çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œï¼Œç”±äºæœåŠ¡ç±»æ–¹æ³•åŒæ ·ä¸éœ€è¦è¿‡å¤šçš„é…ç½®ï¼Œå› æ­¤å®šä¹‰ä¸ºå•ä¾‹ï¼Œä¿è¯ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹å³å¯ã€‚æœåŠ¡ç±»ä¸­è°ƒç”¨å‰é¢å°è£…çš„æ•°æ®åº“æ–¹æ³•å°†å¯¹æ•°æ®åº“çš„æ“ä½œè½¬æ¢ä¸ºå¯¹æ¨¡å‹çš„æ“ä½œã€‚</p>

<p>KCUserService.h</p>

<pre><code>//
//  KCUserService.h
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import &lt;Foundation/Foundation.h&gt;
#import "KCUser.h"
#import "KCSingleton.h"
@interface KCUserService : NSObject
singleton_interface(KCUserService)
/**
 *  æ·»åŠ ç”¨æˆ·ä¿¡æ¯
 *
 *  @param user ç”¨æˆ·å¯¹è±¡
 */
-(void)addUser:(KCUser *)user;
/**
 *  åˆ é™¤ç”¨æˆ·
 *
 *  @param user ç”¨æˆ·å¯¹è±¡
 */
-(void)removeUser:(KCUser *)user;
/**
 *  æ ¹æ®ç”¨æˆ·ååˆ é™¤ç”¨æˆ·
 *
 *  @param name ç”¨æˆ·å
 */
-(void)removeUserByName:(NSString *)name;
/**
 *  ä¿®æ”¹ç”¨æˆ·å†…å®¹
 *
 *  @param user ç”¨æˆ·å¯¹è±¡
 */
-(void)modifyUser:(KCUser *)user;
/**
 *  æ ¹æ®ç”¨æˆ·ç¼–å·å–å¾—ç”¨æˆ·
 *
 *  @param Id ç”¨æˆ·ç¼–å·
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 */
-(KCUser *)getUserById:(int)Id;
/**
 *  æ ¹æ®ç”¨æˆ·åå–å¾—ç”¨æˆ·
 *
 *  @param name ç”¨æˆ·å
 *
 *  @return ç”¨æˆ·å¯¹è±¡
 */
-(KCUser *)getUserByName:(NSString *)name;
@end
</code></pre>

<p>KCUserService.m</p>

<pre><code>//
//  KCUserService.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import "KCUserService.h"
#import "KCUser.h"
#import "KCDbManager.h"
@implementation KCUserService
singleton_implementation(KCUserService)
-(void)addUser:(KCUser *)user{
    NSString *sql=[NSString stringWithFormat:@"INSERT INTO User (name,screenName, profileImageUrl,mbtype,city) VALUES('%@','%@','%@','%@','%@')",user.name,user.screenName, user.profileImageUrl,user.mbtype,user.city];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)removeUser:(KCUser *)user{
    NSString *sql=[NSString stringWithFormat:@"DELETE FROM User WHERE Id='%@'",user.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)removeUserByName:(NSString *)name{
    NSString *sql=[NSString stringWithFormat:@"DELETE FROM User WHERE name='%@'",name];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)modifyUser:(KCUser *)user{
    NSString *sql=[NSString stringWithFormat:@"UPDATE User SET name='%@',screenName='%@',profileImageUrl='%@',mbtype='%@',city='%@' WHERE Id='%@'",user.name,user.screenName,user.profileImageUrl,user.mbtype,user.city,user.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(KCUser *)getUserById:(int)Id{
    KCUser *user=[[KCUser alloc]init];
    NSString *sql=[NSString stringWithFormat:@"SELECT name,screenName,profileImageUrl,mbtype,city FROM User WHERE Id='%i'", Id];
    NSArray *rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    if (rows&amp;&amp;rows.count&gt;0) {
        [user setValuesForKeysWithDictionary:rows[0]];
    }
    return user;
}
-(KCUser *)getUserByName:(NSString *)name{
    KCUser *user=[[KCUser alloc]init];
    NSString *sql=[NSString stringWithFormat:@"SELECT Id, name,screenName,profileImageUrl,mbtype,city FROM User WHERE name='%@'", name];
    NSArray *rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    if (rows&amp;&amp;rows.count&gt;0) {
        [user setValuesForKeysWithDictionary:rows[0]];
    }
    return user;
}
@end
</code></pre>

<p>KCStatusService.h</p>

<pre><code>//
//  KCStatusService.h
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import &lt;Foundation/Foundation.h&gt;
#import "KCSingleton.h"
@class KCStatus;
@interface KCStatusService : NSObject
singleton_interface(KCStatusService)
/**
 *  æ·»åŠ å¾®åšä¿¡æ¯
 *
 *  @param status å¾®åšå¯¹è±¡
 */
-(void)addStatus:(KCStatus *)status;
/**
 *  åˆ é™¤å¾®åš
 *
 *  @param status å¾®åšå¯¹è±¡
 */
-(void)removeStatus:(KCStatus *)status;
/**
 *  ä¿®æ”¹å¾®åšå†…å®¹
 *
 *  @param status å¾®åšå¯¹è±¡
 */
-(void)modifyStatus:(KCStatus *)status;
/**
 *  æ ¹æ®ç¼–å·å–å¾—å¾®åš
 *
 *  @param Id å¾®åšç¼–å·
 *
 *  @return å¾®åšå¯¹è±¡
 */
-(KCStatus *)getStatusById:(int)Id;
/**
 *  å–å¾—æ‰€æœ‰å¾®åšå¯¹è±¡
 *
 *  @return æ‰€æœ‰å¾®åšå¯¹è±¡
 */
-(NSArray *)getAllStatus;
@end
</code></pre>

<p>KCStatusService.m</p>

<pre><code>//
//  KCStatusService.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import "KCStatusService.h"
#import "KCDbManager.h"
#import "KCStatus.h"
#import "KCUserService.h"
#import "KCSingleton.h"
@interface KCStatusService(){

}
@end
@implementation KCStatusService
singleton_implementation(KCStatusService)
-(void)addStatus:(KCStatus *)status{
    NSString *sql=[NSString stringWithFormat:@"INSERT INTO Status (source,createdAt,\"text\" ,user) VALUES('%@','%@','%@','%@')",status.source,status.createdAt,status.text,status.user.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)removeStatus:(KCStatus *)status{
    NSString *sql=[NSString stringWithFormat:@"DELETE FROM Status WHERE Id='%@'",status.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(void)modifyStatus:(KCStatus *)status{
    NSString *sql=[NSString stringWithFormat:@"UPDATE Status SET source='%@',createdAt='%@',\"text\"='%@' ,user='%@' WHERE Id='%@'",status.source,status.createdAt,status.text,status.user, status.Id];
    [[KCDbManager sharedKCDbManager] executeNonQuery:sql];
}
-(KCStatus *)getStatusById:(int)Id{
    KCStatus *status=[[KCStatus alloc]init];
    NSString *sql=[NSString stringWithFormat:@"SELECT Id, source,createdAt,\"text\" ,user FROM Status WHERE Id='%i'", Id];
    NSArray *rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    if (rows&amp;&amp;rows.count&gt;0) {
        [status setValuesForKeysWithDictionary:rows[0]];
        status.user=[[KCUserService sharedKCUserService] getUserById:[(NSNumber *)rows[0][@"user"] intValue]] ;
    }
    return status;
}
-(NSArray *)getAllStatus{
    NSMutableArray *array=[NSMutableArray array];
    NSString *sql=@"SELECT Id, source,createdAt,\"text\" ,user FROM Status ORDER BY Id";
    NSArray *rows= [[KCDbManager sharedKCDbManager] executeQuery:sql];
    for (NSDictionary *dic in rows) {
        KCStatus *status=[self getStatusById:[(NSNumber *)dic[@"Id"] intValue]];
        [array addObject:status];
    }
    return array;
}
@end
</code></pre>

<p>æœ€åï¼Œåœ¨è§†å›¾æ§åˆ¶å™¨ä¸­è°ƒç”¨ç›¸åº”çš„æœåŠ¡å±‚è¿›è¡Œå„ç±»æ•°æ®æ“ä½œï¼Œåœ¨ä¸‹é¢çš„ä»£ç ä¸­åˆ†åˆ«æ¼”ç¤ºäº†å¢ã€åˆ ã€æ”¹ã€æŸ¥å››ç±»æ“ä½œã€‚</p>

<pre><code>KCMainViewController.m
//
//  KCMainTableViewController.m
//  DataAccess
//
//  Created by Kenshin Cui on 14-3-29.
//  Copyright (c) 2014å¹´ Kenshin Cui. All rights reserved.
//
#import "KCMainTableViewController.h"
#import "KCDbManager.h"
#import "KCDatabaseCreator.h"
#import "KCUser.h"
#import "KCStatus.h"
#import "KCUserService.h"
#import "KCStatusService.h"
#import "KCStatusTableViewCell.h"
@interface KCMainTableViewController (){
    NSArray *_status;
    NSMutableArray *_statusCells;
}
@end
@implementation KCMainTableViewController
- (void)viewDidLoad {
    [super viewDidLoad];
    [KCDatabaseCreator initDatabase];

//    [self addUsers];
//    [self removeUser];
//    [self modifyUserInfo];

//    [self addStatus];

    [self loadStatusData];

}
-(void)addUsers{
    KCUser *user1=[KCUser userWithName:@"Binger" screenName:@"å†°å„¿" profileImageUrl:@"binger.jpg" mbtype:@"mbtype.png" city:@"åŒ—äº¬"];
    [[KCUserService sharedKCUserService] addUser:user1];
    KCUser *user2=[KCUser userWithName:@"Xiaona" screenName:@"å°å¨œ" profileImageUrl:@"xiaona.jpg" mbtype:@"mbtype.png" city:@"åŒ—äº¬"];
    [[KCUserService sharedKCUserService] addUser:user2];
    KCUser *user3=[KCUser userWithName:@"Lily" screenName:@"ä¸½ä¸½" profileImageUrl:@"lily.jpg" mbtype:@"mbtype.png" city:@"åŒ—äº¬"];
    [[KCUserService sharedKCUserService] addUser:user3];
    KCUser *user4=[KCUser userWithName:@"Qianmo" screenName:@"é˜¡é™Œ" profileImageUrl:@"qianmo.jpg" mbtype:@"mbtype.png" city:@"åŒ—äº¬"];
    [[KCUserService sharedKCUserService] addUser:user4];
    KCUser *user5=[KCUser userWithName:@"Yanyue" screenName:@"ç‚æœˆ" profileImageUrl:@"yanyue.jpg" mbtype:@"mbtype.png" city:@"åŒ—äº¬"];
    [[KCUserService sharedKCUserService] addUser:user5];
}
-(void)addStatus{
    KCStatus *status1=[KCStatus statusWithCreateAt:@"9:00" source:@"iPhone 6" text:@"ä¸€åªé›ªçŒ´åœ¨æ—¥æœ¬è¾¹æ³¡æ¸©æ³‰è¾¹ç©iPhoneçš„ç…§ç‰‡ï¼Œè·å¾—äº†\"2014å¹´é‡ç”ŸåŠ¨ç‰©æ‘„å½±å¸ˆ\"å¤§èµ›ç‰¹ç­‰å¥–ã€‚ä¸€èµ·æ¥ä¸ºçŒ´å­é…ä¸ªè¯" userId:1];
    [[KCStatusService sharedKCStatusService] addStatus:status1];
    KCStatus *status2=[KCStatus statusWithCreateAt:@"9:00" source:@"iPhone 6" text:@"ä¸€åªé›ªçŒ´åœ¨æ—¥æœ¬è¾¹æ³¡æ¸©æ³‰è¾¹ç©iPhoneçš„ç…§ç‰‡ï¼Œè·å¾—äº†\"2014å¹´é‡ç”ŸåŠ¨ç‰©æ‘„å½±å¸ˆ\"å¤§èµ›ç‰¹ç­‰å¥–ã€‚ä¸€èµ·æ¥ä¸ºçŒ´å­é…ä¸ªè¯" userId:1];
    [[KCStatusService sharedKCStatusService] addStatus:status2];
    KCStatus *status3=[KCStatus statusWithCreateAt:@"9:30" source:@"iPhone 6" text:@"ã€æˆ‘ä»¬é€iPhone6äº† è¦æ±‚å¾ˆç®€å•ã€‘çœŸå¿ƒå›é¦ˆç²‰ä¸ï¼Œå°ç¼–è§‰å¾—ç°åœ¨æœ€å¥½çš„å¥–å“å°±æ˜¯iPhone6äº†ã€‚ä»Šèµ·åˆ°12æœˆ31æ—¥ï¼Œå…³æ³¨æˆ‘ä»¬ï¼Œè½¬å‘å¾®åšï¼Œå°±æœ‰æœºä¼šè·iPhone6(å¥–å“å¯èƒ½éœ€è¦ç­‰å¾…)ï¼æ¯æœˆæŠ½ä¸€å°[é¼“æŒ]ã€‚ä¸è´¹äº‹ï¼Œè¿˜æ˜¯è¯•è¯•å§ï¼Œä¸‡ä¸€ä¸­äº†å‘¢" userId:2];
    [[KCStatusService sharedKCStatusService] addStatus:status3];
    KCStatus *status4=[KCStatus statusWithCreateAt:@"9:45" source:@"iPhone 6" text:@"é‡å¤§æ–°é—»ï¼šè’‚å§†åº“å…‹å®£å¸ƒå‡ºæŸœåï¼ŒISISæˆ˜å£«æ€’æ‰”iPhoneï¼Œæ²™ç‰¹ç¥èŒäººå‘˜å‘¼åäººä»¬æ¢å›iPhone 4ã€‚[via Pan-Arabia Enquirer]" userId:3];
    [[KCStatusService sharedKCStatusService] addStatus:status4];
    KCStatus *status5=[KCStatus statusWithCreateAt:@"10:05" source:@"iPhone 6" text:@"å°ä¼™ä¼´ä»¬ï¼Œæœ‰è°çŸ¥é“æ€ä¹ˆå¾€Iphone4Sé‡Œå€’ä¸œè¥¿ï¼Ÿå€’å…¥çš„ä¸œè¥¿åˆè¯¥åœ¨å“ªé‡Œæ‰¾ï¼Ÿç”¨äº†Iphoneè¿™ä¹ˆé•¿æ—¶é—´ï¼Œè¿˜çœŸçš„ä¸çŸ¥é“æ€ä¹ˆå¼„ï¼æœ‰è°çŸ¥é“å•Šï¼Ÿè°¢è°¢ï¼" userId:4];
    [[KCStatusService sharedKCStatusService] addStatus:status5];
    KCStatus *status6=[KCStatus statusWithCreateAt:@"10:07" source:@"iPhone 6" text:@"åœ¨éŸ³æ‚¦å°iPhoneå®¢æˆ·ç«¯é‡Œå‘ç°ä¸€ä¸ªæ‚¦å•ã€ŠInfinite é‡‘æ˜æ´™ã€‹ï¼Œæ¨èç»™å¤§å®¶! " userId:1];
    [[KCStatusService sharedKCStatusService] addStatus:status6];
    KCStatus *status7=[KCStatus statusWithCreateAt:@"11:20" source:@"iPhone 6" text:@"å¦‚æœsonyå§mp3æ’­æ”¾å™¨äº§å“å‘å±•ä¸‹å»ï¼Œä¸è´ªå›¾æ‰‹å¤´èŠ‚ç›®æºçš„ç°å®åˆ©ç›Šï¼Œå°±æœ¨æœ‰è‹¹æœçš„ipodï¼Œä¹Ÿå°±æœ¨æœ‰iphoneã€‚æŸ¯è¾¾ç±»ä¼¼çš„ç°å®åˆ©ç›Šï¼Œä¸è‡ªæˆ‘é©å‘½çš„æ¡ˆä¾‹ä¹Ÿæ˜¯ä¸€ç§å·¨å¤´çš„å®¿å‘½ã€‚" userId:2];
    [[KCStatusService sharedKCStatusService] addStatus:status7];
    KCStatus *status8=[KCStatus statusWithCreateAt:@"13:00" source:@"iPhone 6" text:@"ã€iPhone 7 Plusã€‘æ–°ä¹°çš„iPhone 7 Plus ï¼Œå¦‚ä½•ï¼Ÿå¤Ÿé…·ç‚«ä¹ˆï¼Ÿ" userId:2];
    [[KCStatusService sharedKCStatusService] addStatus:status8];
    KCStatus *status9=[KCStatus statusWithCreateAt:@"13:24" source:@"iPhone 6" text:@"è‡ªæ‹ç¥å™¨#å¡è¥¿æ¬§TR500#ï¼Œtr350Sï½ä»·æ ¼ç¾ä¸½ï¼Œè¡Œè´§ï¼Œå…¨å›½è”ä¿ï½iPhone6 iPhone6Pluså¡è¥¿æ¬§TR150 TR200 TR350 TR350Så…¨é¢åˆ°è´§ æ‹›æ”¶å„ç§ä»£ç†ï¼[ç»™åŠ›]å¾®ä¿¡ï¼š39017366" userId:3];
    [[KCStatusService sharedKCStatusService] addStatus:status9];
    KCStatus *status10=[KCStatus statusWithCreateAt:@"13:26" source:@"iPhone 6" text:@"çŒœåˆ°çŒ´å“¥ç©æ‰‹æœºæ—¶æ‰€æ€æ‰€æƒ³è€…ï¼Œå†å¥–iPhoneä¸€éƒ¨ã€‚ï¼ˆå¥–å“ç”±â€œ2014å¹´é‡ç”ŸåŠ¨ç‰©æ‘„å½±å¸ˆâ€è¯„å§”ä¼šé¢å‘ï¼‰" userId:3];
    [[KCStatusService sharedKCStatusService] addStatus:status10];
}
-(void)removeUser{
    //æ³¨æ„åœ¨SQLiteä¸­åŒºåˆ†å¤§å°å†™
    [[KCUserService sharedKCUserService] removeUserByName:@"Yanyue"];
}
-(void)modifyUserInfo{
    KCUser *user1= [[KCUserService sharedKCUserService]getUserByName:@"Xiaona"];
    user1.city=@"ä¸Šæµ·";
    [[KCUserService sharedKCUserService] modifyUser:user1];

    KCUser *user2= [[KCUserService sharedKCUserService]getUserByName:@"Lily"];
    user2.city=@"æ·±åœ³";
    [[KCUserService sharedKCUserService] modifyUser:user2];
}
#pragma mark åŠ è½½æ•°æ®
-(void)loadStatusData{
    _statusCells=[[NSMutableArray alloc]init];
    _status=[[KCStatusService sharedKCStatusService]getAllStatus];
    [_status enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) {
        KCStatusTableViewCell *cell=[[KCStatusTableViewCell alloc]init];
        cell.status=(KCStatus *)obj;
        [_statusCells addObject:cell];
    }];
    NSLog(@"%@",[_status lastObject]);
}
#pragma mark - Table view data source
- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {
    return 1;
}
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return _status.count;
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    static NSString *identtityKey=@"myTableViewCellIdentityKey1";
    KCStatusTableViewCell *cell=[self.tableView dequeueReusableCellWithIdentifier:identtityKey];
    if(cell==nil){
        cell=[[KCStatusTableViewCell alloc]initWithStyle:UITableViewCellStyleValue1 reuseIdentifier:identtityKey];
    }
    cell.status=_status[indexPath.row];
    return cell;
}
-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    return ((KCStatusTableViewCell *)_statusCells[indexPath.row]).height;
}
-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{
    return 20.0f;
}
@end
</code></pre>

<p>é¡¹ç›®ç›®å½•ç»“æ„ï¼š</p>

<p><img src="http://al1020119.github.io/images/CSR002.jpg" title="Caption" ></p>

<p>è¿è¡Œæ•ˆæœ</p>

<p><img src="http://al1020119.github.io/images/CSR003.jpg" title="Caption" >
Core Data</p>

<p>åŸºæœ¬æ¦‚å¿µ</p>

<p>å½“å‰ï¼Œå„ç±»åº”ç”¨å¼€å‘ä¸­åªè¦ç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œé€šå¸¸éƒ½ä¼šç”¨åˆ°ä¸€ä¸ªæ¦‚å¿µâ€œå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰â€ã€‚ä¾‹å¦‚åœ¨Javaå¹³å°ä½¿ç”¨Hibernateï¼Œåœ¨.NETå¹³å°ä½¿ç”¨Entity Frameworkã€Linqã€NHibernateç­‰ã€‚åœ¨iOSä¸­ä¹Ÿä¸ä¾‹å¤–ï¼ŒiOSä¸­ORMæ¡†æ¶é¦–é€‰Core Dataï¼Œè¿™æ˜¯å®˜æ–¹æ¨èçš„ï¼Œä¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚æ— è®ºæ˜¯å“ªç§å¹³å°ã€å“ªç§æŠ€æœ¯ï¼ŒORMæ¡†æ¶çš„ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£å°±æ˜¯å°†å…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ï¼ˆå‡†ç¡®çš„è¯´æ˜¯å®ä½“ï¼‰è½¬æ¢ä¸ºç¨‹åºä¸­çš„å¯¹è±¡ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯å¯¹æ•°æ®åº“çš„æ“ä½œï¼ˆä¾‹å¦‚Core Dataä¸­å¦‚æœå­˜å‚¨ç±»å‹é…ç½®ä¸ºSQLiteåˆ™æœ¬è´¨è¿˜æ˜¯æ“ä½œçš„SQLiteæ•°æ®åº“ï¼‰ã€‚ç»†å¿ƒçš„æœ‹å‹åº”è¯¥å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä¸Šé¢çš„SQLiteä¸­å…¶å®æˆ‘ä»¬åœ¨KCMainViewControllerä¸­è¿›è¡Œçš„æ•°æ®åº“æ“ä½œå·²ç»è½¬æ¢ä¸ºäº†å¯¹è±¡æ“ä½œï¼ŒæœåŠ¡å±‚ä¸­çš„æ–¹æ³•ä¸­å·²ç»å°†å¯¹æ•°æ®åº“çš„æ“ä½œå°è£…èµ·æ¥ï¼Œè½¬æ¢ä¸ºäº†å¯¹Modelçš„æ“ä½œï¼Œè¿™ç§æ–¹å¼å·²ç»æ˜¯é¢å‘å¯¹è±¡çš„ã€‚ä¸Šè¿°é€šè¿‡å°†å¯¹è±¡æ˜ å°„åˆ°å®ä½“çš„è¿‡ç¨‹å®Œå…¨æ˜¯æ‰‹åŠ¨å®Œæˆçš„ï¼Œç›¸å¯¹æ¥è¯´æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œå°±æ‹¿å¯¹KCStatuså¯¹è±¡çš„æ“ä½œæ¥è¯´ï¼šé¦–å…ˆè¦æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ï¼ˆStatusè¡¨ï¼‰ï¼Œå…¶æ¬¡æ‰‹åŠ¨åˆ›å»ºæ¨¡å‹KCStatusï¼Œæ¥ç€åˆ›å»ºæœåŠ¡å±‚KCStatusServiceã€‚Core Dataæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œå®ƒå°†æ•°æ®åº“çš„åˆ›å»ºã€è¡¨çš„åˆ›å»ºã€å¯¹è±¡å’Œè¡¨çš„è½¬æ¢ç­‰æ“ä½œå°è£…èµ·æ¥ï¼Œç®€åŒ–äº†æˆ‘ä»¬çš„æ“ä½œï¼ˆæ³¨æ„Core Dataåªæ˜¯å°†å¯¹è±¡å…³ç³»çš„æ˜ å°„ç®€åŒ–äº†ï¼Œå¹¶ä¸æ˜¯æŠŠæœåŠ¡å±‚æ›¿ä»£äº†ï¼Œè¿™ä¸€ç‚¹å¤§å®¶éœ€è¦æ˜ç™½ï¼‰ã€‚</p>

<p>ä½¿ç”¨Core Dataè¿›è¡Œæ•°æ®åº“å­˜å–å¹¶ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨ç”±Core Dataæ¡†æ¶å®Œæˆï¼Œå¼€å‘äººå‘˜é¢å¯¹çš„æ˜¯æ¨¡å‹ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯æŠŠæ¨¡å‹åˆ›å»ºèµ·æ¥ï¼Œå…·ä½“æ•°æ®åº“å¦‚ä½•åˆ›å»ºåˆ™ä¸ç”¨ç®¡ã€‚åœ¨iOSé¡¹ç›®ä¸­æ·»åŠ â€œData Modelâ€æ–‡ä»¶ã€‚ç„¶ååœ¨å…¶ä¸­åˆ›å»ºå®ä½“å’Œå…³ç³»ï¼š</p>

<p><img src="http://al1020119.github.io/images/CSR004.jpg" title="Caption" >
<img src="http://al1020119.github.io/images/CSR005.jpg" title="Caption" ></p>

<p>æ¨¡å‹åˆ›å»ºçš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ï¼š</p>

<p>1.å®ä½“å¯¹è±¡ä¸éœ€è¦åˆ›å»ºIDä¸»é”®ï¼ŒAttributesä¸­åº”è¯¥æ˜¯æœ‰æ„ä¹‰å±æ€§ï¼ˆåˆ›å»ºè¿‡ç¨‹ä¸­åº”è¯¥è€ƒè™‘å¯¹è±¡çš„å±æ€§è€Œä¸æ˜¯æ•°æ®åº“ä¸­è¡¨æœ‰å‡ ä¸ªå­—æ®µï¼Œå°½ç®¡å¤šæ•°å±æ€§ä¼šå¯¹åº”è¡¨çš„å­—æ®µï¼‰ã€‚</p>

<p>2.æ‰€æœ‰çš„å±æ€§åº”è¯¥æŒ‡å®šå…·ä½“ç±»å‹ï¼ˆå°½ç®¡åœ¨SQLiteä¸­å¯ä»¥ä¸æŒ‡å®šï¼‰ï¼Œå› ä¸ºå®ä½“å¯¹è±¡ä¼šå¯¹åº”ç”ŸæˆObjCæ¨¡å‹ç±»ã€‚</p>

<p>3.å®ä½“å¯¹è±¡ä¸­å…¶ä»–å®ä½“å¯¹è±¡ç±»å‹çš„å±æ€§åº”è¯¥é€šè¿‡Relationshipså»ºç«‹ï¼Œå¹¶ä¸”æ³¨æ„å®ä½“ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼ˆä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡å¾®åšï¼Œè€Œä¸€æ¡å¾®åšåˆ™åªå±äºä¸€ä¸ªç”¨æˆ·,ç”¨æˆ·å’Œå¾®åšå½¢æˆä¸€å¯¹å¤šçš„å…³ç³»ï¼‰ã€‚</p>

<p>ä»¥ä¸Šæ¨¡å‹åˆ›å»ºåï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®ä¸Šé¢çš„æ¨¡å‹æ–‡ä»¶ï¼ˆ.xcdatamodeldæ–‡ä»¶ï¼‰ç”Ÿæˆå…·ä½“çš„å®ä½“ç±»ã€‚åœ¨Xcodeä¸­æ·»åŠ â€œNSManagedObject Subclassâ€æ–‡ä»¶ï¼ŒæŒ‰ç…§æ­¥éª¤é€‰æ‹©åˆ›å»ºçš„æ¨¡å‹åŠå®ä½“ï¼ŒXcodeå°±ä¼šæ ¹æ®æ‰€åˆ›å»ºæ¨¡å‹ç”Ÿæˆå…·ä½“çš„å®ä½“ç±»ã€‚</p>

<p>User.h</p>

<pre><code>//
//  User.h
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright (c) 2014å¹´ cmjstudio. All rights reserved.
//
#import &lt;Foundation/Foundation.h&gt;
#import &lt;CoreData/CoreData.h&gt;
@class Status;
@interface User : NSManagedObject
@property (nonatomic, retain) NSString * city;
@property (nonatomic, retain) NSString * mbtype;
@property (nonatomic, retain) NSString * name;
@property (nonatomic, retain) NSString * profileImageUrl;
@property (nonatomic, retain) NSString * screenName;
@property (nonatomic, retain) NSSet *statuses;
@end
@interface User (CoreDataGeneratedAccessors)
- (void)addStatusesObject:(Status *)value;
- (void)removeStatusesObject:(Status *)value;
- (void)addStatuses:(NSSet *)values;
- (void)removeStatuses:(NSSet *)values;
@end
</code></pre>

<p>User.m</p>

<pre><code>//
//  User.m
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright (c) 2014å¹´ cmjstudio. All rights reserved.
//
#import "User.h"
#import "Status.h"
@implementation User
@dynamic city;
@dynamic mbtype;
@dynamic name;
@dynamic profileImageUrl;
@dynamic screenName;
@dynamic statuses;
@end
</code></pre>

<p>Status.h</p>

<pre><code>//
//  Status.h
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright (c) 2014å¹´ cmjstudio. All rights reserved.
//
#import &lt;Foundation/Foundation.h&gt;
#import &lt;CoreData/CoreData.h&gt;
@interface Status : NSManagedObject
@property (nonatomic, retain) NSDate * createdAt;
@property (nonatomic, retain) NSString * source;
@property (nonatomic, retain) NSString * text;
@property (nonatomic, retain) NSManagedObject *user;
@end

Status.m


//
//  Status.m
//  CoreData
//
//  Created by Kenshin Cui on 14/03/27.
//  Copyright (c) 2014å¹´ cmjstudio. All rights reserved.
//
#import "Status.h"
@implementation Status
@dynamic createdAt;
@dynamic source;
@dynamic text;
@dynamic user;
@end
</code></pre>

<p>å¾ˆæ˜¾ç„¶ï¼Œé€šè¿‡æ¨¡å‹ç”Ÿæˆç±»çš„è¿‡ç¨‹ç›¸å½“ç®€å•ï¼Œé€šå¸¸è¿™äº›ç±»ä¹Ÿä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ï¼Œå¦‚æœæ¨¡å‹å‘ç”Ÿçš„å˜åŒ–åªè¦é‡æ–°ç”Ÿæˆå³å¯ã€‚æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>

<p>1.æ‰€æœ‰çš„å®ä½“ç±»å‹éƒ½ç»§æ‰¿äºNSManagedObjectï¼Œæ¯ä¸ªNSManagedObjectå¯¹è±¡å¯¹åº”ç€æ•°æ®åº“ä¸­ä¸€æ¡è®°å½•ã€‚</p>

<p>2.é›†åˆå±æ€§ï¼ˆä¾‹å¦‚Userä¸­çš„statusï¼‰ç”Ÿæˆäº†è®¿é—®æ­¤å±æ€§çš„åˆ†ç±»æ–¹æ³•ã€‚</p>

<p>3.ä½¿ç”¨@dynamicä»£è¡¨å…·ä½“å±æ€§å®ç°ï¼Œå…·ä½“å®ç°ç»†èŠ‚ä¸éœ€è¦å¼€å‘äººå‘˜å…³å¿ƒã€‚</p>

<p>å½“ç„¶ï¼Œäº†è§£äº†è¿™äº›è¿˜ä¸è¶³ä»¥å®Œæˆæ•°æ®çš„æ“ä½œã€‚ç©¶ç«ŸCore Dataå…·ä½“çš„è®¾è®¡å¦‚ä½•ï¼Œè¦å®Œæˆæ•°æ®çš„å­˜å–æˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸€ä¸‹Core Dataå‡ ä¸ªæ ¸å¿ƒçš„ç±»ã€‚</p>

<p><img src="http://al1020119.github.io/images/CSR006.jpg" title="Caption" ></p>

<ol>
<li><p>Persistent Object Storeï¼šå¯ä»¥ç†è§£ä¸ºå­˜å‚¨æŒä¹…å¯¹è±¡çš„æ•°æ®åº“ï¼ˆä¾‹å¦‚SQLiteï¼Œæ³¨æ„Core Dataä¹Ÿæ”¯æŒå…¶ä»–ç±»å‹çš„æ•°æ®å­˜å‚¨ï¼Œä¾‹å¦‚xmlã€äºŒè¿›åˆ¶æ•°æ®ç­‰ï¼‰ã€‚</p></li>
<li><p>Managed Object Modelï¼šå¯¹è±¡æ¨¡å‹ï¼Œå¯¹åº”Xcodeä¸­åˆ›å»ºçš„æ¨¡å‹æ–‡ä»¶ã€‚</p></li>
<li><p>Persistent Store Coordinatorï¼šå¯¹è±¡æ¨¡å‹å’Œå®ä½“ç±»ä¹‹é—´çš„è½¬æ¢åè°ƒå™¨ï¼Œç”¨äºç®¡ç†ä¸åŒå­˜å‚¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ã€‚</p></li>
<li><p>Managed Object Context:å¯¹è±¡ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œè´Ÿè´£å®ä½“å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´çš„äº¤äº’ã€‚</p></li>
</ol>


<p>Core Dataä½¿ç”¨</p>

<p>Core Dataä½¿ç”¨èµ·æ¥ç›¸å¯¹ç›´æ¥ä½¿ç”¨SQLite3çš„APIè€Œè¨€æ›´åŠ çš„é¢å‘å¯¹è±¡ï¼Œæ“ä½œè¿‡ç¨‹é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>

<p>1.åˆ›å»ºç®¡ç†ä¸Šä¸‹æ–‡</p>

<p>åˆ›å»ºç®¡ç†ä¸Šä¸‹å¯ä»¥ç»†åˆ†ä¸ºï¼šåŠ è½½æ¨¡å‹æ–‡ä»¶->æŒ‡å®šæ•°æ®å­˜å‚¨è·¯å¾„->åˆ›å»ºå¯¹åº”æ•°æ®ç±»å‹çš„å­˜å‚¨->åˆ›å»ºç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–¹å¹¶æŒ‡å®šå­˜å‚¨ã€‚</p>

<p>ç»è¿‡è¿™å‡ ä¸ªæ­¥éª¤ä¹‹åå¯ä»¥å¾—åˆ°ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡NSManagedObjectContextï¼Œä»¥åæ‰€æœ‰çš„æ•°æ®æ“ä½œéƒ½ç”±æ­¤å¯¹è±¡è´Ÿè´£ã€‚åŒæ—¶å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºä¸Šä¸‹æ–‡ï¼ŒCore Dataä¼šè‡ªåŠ¨åˆ›å»ºå­˜å‚¨æ–‡ä»¶ï¼ˆä¾‹å¦‚è¿™é‡Œä½¿ç”¨SQLite3å­˜å‚¨ï¼‰ï¼Œå¹¶ä¸”æ ¹æ®æ¨¡å‹å¯¹è±¡åˆ›å»ºå¯¹åº”çš„è¡¨ç»“æ„ã€‚ä¸‹å›¾ä¸ºç¬¬ä¸€æ¬¡è¿è¡Œç”Ÿæˆçš„æ•°æ®åº“åŠç›¸å…³æ˜ å°„æ–‡ä»¶ï¼š</p>

<p><img src="http://al1020119.github.io/images/CSR007.jpg" title="Caption" ></p>

<p>ä¸ºäº†æ–¹ä¾¿åé¢ä½¿ç”¨ï¼ŒNSManagedObjectContextå¯¹è±¡å¯ä»¥ä½œä¸ºå•ä¾‹æˆ–é™æ€å±æ€§æ¥ä¿å­˜ï¼Œä¸‹é¢æ˜¯åˆ›å»ºçš„ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„ä¸»è¦ä»£ç ï¼š</p>

<pre><code>-(NSManagedObjectContext *)createDbContext{
    NSManagedObjectContext *context;
    //æ‰“å¼€æ¨¡å‹æ–‡ä»¶ï¼Œå‚æ•°ä¸ºnilåˆ™æ‰“å¼€åŒ…ä¸­æ‰€æœ‰æ¨¡å‹æ–‡ä»¶å¹¶åˆå¹¶æˆä¸€ä¸ª
    NSManagedObjectModel *model=[NSManagedObjectModel mergedModelFromBundles:nil];
    //åˆ›å»ºè§£æå™¨
    NSPersistentStoreCoordinator *storeCoordinator=[[NSPersistentStoreCoordinator alloc]initWithManagedObjectModel:model];
    //åˆ›å»ºæ•°æ®åº“ä¿å­˜è·¯å¾„
    NSString *dir=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@"%@",dir);
    NSString *path=[dir stringByAppendingPathComponent:@"myDatabase.db"];
    NSURL *url=[NSURL fileURLWithPath:path];
    //æ·»åŠ SQLiteæŒä¹…å­˜å‚¨åˆ°è§£æå™¨
    NSError *error;
    [storeCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:url options:nil error:&amp;error];
    if(error){
        NSLog(@"æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼é”™è¯¯:%@",error.localizedDescription);
    }else{
        context=[[NSManagedObjectContext alloc]init];
        context.persistentStoreCoordinator=storeCoordinator;
        NSLog(@"æ•°æ®åº“æ‰“å¼€æˆåŠŸï¼");
    }
    return context;
}
</code></pre>

<p>2.æŸ¥è¯¢æ•°æ®</p>

<p>å¯¹äºæœ‰æ¡ä»¶çš„æŸ¥è¯¢ï¼Œåœ¨Core Dataä¸­æ˜¯é€šè¿‡è°“è¯æ¥å®ç°çš„ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åè®¾ç½®è¯·æ±‚æ¡ä»¶ï¼Œæœ€åè°ƒç”¨ä¸Šä¸‹æ–‡æ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•ã€‚</p>

<pre><code>-(void)addUserWithName:(NSString *)name screenName:(NSString *)screenName profileImageUrl:(NSString *)profileImageUrl mbtype:(NSString *)mbtype city:(NSString *)city{
    //æ·»åŠ ä¸€ä¸ªå¯¹è±¡
    User *us= [NSEntityDescription insertNewObjectForEntityForName:@"User" inManagedObjectContext:self.context];
    us.name=name;
    us.screenName=screenName;
    us.profileImageUrl=profileImageUrl;
    us.mbtype=mbtype;
    us.city=city;
    NSError *error;
    //ä¿å­˜ä¸Šä¸‹æ–‡
    if (![self.context save:&amp;error]) {
        NSLog(@"æ·»åŠ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯,é”™è¯¯ä¿¡æ¯ï¼š%@ï¼",error.localizedDescription);
    }
}
</code></pre>

<p>å¦‚æœæœ‰å¤šä¸ªæ¡ä»¶ï¼Œåªè¦ä½¿ç”¨è°“è¯ç»„åˆå³å¯ï¼Œé‚£ä¹ˆå¯¹äºå…³è”å¯¹è±¡æ¡ä»¶æ€ä¹ˆæŸ¥è¯¢å‘¢ï¼Ÿè¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µè¿›è¡Œä»‹ç»ï¼š</p>

<p>a.æŸ¥æ‰¾ä¸€ä¸ªå¯¹è±¡åªæœ‰å”¯ä¸€ä¸€ä¸ªå…³è”å¯¹è±¡çš„æƒ…å†µï¼Œä¾‹å¦‚æŸ¥æ‰¾ç”¨æˆ·åä¸ºâ€œBingerâ€çš„å¾®åšï¼ˆä¸€ä¸ªå¾®åšåªèƒ½å±äºä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œé€šè¿‡keypathæŸ¥è¯¢</p>

<pre><code>-(NSArray *)getStatusesByUserName:(NSString *)name{
    NSFetchRequest *request=[NSFetchRequest fetchRequestWithEntityName:@"Status"];
    request.predicate=[NSPredicate predicateWithFormat:@"user.name=%@",name];
    NSArray *array=[self.context executeFetchRequest:request error:nil];
    return  array;
}
</code></pre>

<p>æ­¤æ—¶å¦‚æœè·Ÿè¸ªCore Dataç”Ÿæˆçš„SQLè¯­å¥ä¼šå‘ç°å…¶å®å°±æ˜¯æŠŠStatusè¡¨å’ŒUserè¡¨è¿›è¡Œäº†å…³è”æŸ¥è¯¢ï¼ˆJOINè¿æ¥ï¼‰ã€‚</p>

<p>b.æŸ¥æ‰¾ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå…³è”å¯¹è±¡çš„æƒ…å†µï¼Œä¾‹å¦‚æŸ¥æ‰¾å‘é€å¾®åšå†…å®¹ä¸­åŒ…å«â€œWatchâ€å¹¶ä¸”ç”¨æˆ·æ˜µç§°ä¸ºâ€œå°å¨œâ€çš„ç”¨æˆ·ï¼ˆä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡å¾®åšï¼‰ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åˆ©ç”¨è°“è¯è¿›è¡Œè¿‡æ»¤ã€‚</p>

<pre><code>-(NSArray *)getUsersByStatusText:(NSString *)text screenName:(NSString *)screenName{
    NSFetchRequest *request=[NSFetchRequest fetchRequestWithEntityName:@"Status"];
    request.predicate=[NSPredicate predicateWithFormat:@"text LIKE '*Watch*'",text];
    NSArray *statuses=[self.context executeFetchRequest:request error:nil];

    NSPredicate *userPredicate= [NSPredicate predicateWithFormat:@"user.screenName=%@",screenName];
    NSArray *users= [statuses filteredArrayUsingPredicate:userPredicate];
    return users;
}
</code></pre>

<p>æ³¨æ„ï¼šå¦‚æœå•çº¯æŸ¥æ‰¾å¾®åšä¸­åŒ…å«â€œWatchâ€çš„ç”¨æˆ·ï¼Œç›´æ¥æŸ¥å‡ºå¯¹åº”çš„å¾®åšï¼Œç„¶åé€šè¿‡æ¯ä¸ªå¾®åšçš„userå±æ€§å³å¯è·å¾—ç”¨æˆ·ï¼Œæ­¤æ—¶å°±ä¸ç”¨ä½¿ç”¨é¢å¤–çš„è°“è¯è¿‡æ»¤æ¡ä»¶ã€‚</p>

<p>3.æ’å…¥æ•°æ®</p>

<p>æ’å…¥æ•°æ®éœ€è¦è°ƒç”¨å®ä½“æè¿°å¯¹è±¡NSEntityDescriptionè¿”å›ä¸€ä¸ªå®ä½“å¯¹è±¡ï¼Œç„¶åè®¾ç½®å¯¹è±¡å±æ€§ï¼Œæœ€åä¿å­˜å½“å‰ä¸Šä¸‹æ–‡å³å¯ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¢ã€åˆ ã€æ”¹æ“ä½œå®Œæœ€åå¿…é¡»è°ƒç”¨ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„ä¿å­˜æ–¹æ³•ï¼Œå¦åˆ™æ“ä½œä¸ä¼šæ‰§è¡Œã€‚</p>

<pre><code>-(void)addUserWithName:(NSString *)name screenName:(NSString *)screenName profileImageUrl:(NSString *)profileImageUrl mbtype:(NSString *)mbtype city:(NSString *)city{
    //æ·»åŠ ä¸€ä¸ªå¯¹è±¡
    User *us= [NSEntityDescription insertNewObjectForEntityForName:@"User" inManagedObjectContext:self.context];
    us.name=name;
    us.screenName=screenName;
    us.profileImageUrl=profileImageUrl;
    us.mbtype=mbtype;
    us.city=city;
    NSError *error;
    //ä¿å­˜ä¸Šä¸‹æ–‡
    if (![self.context save:&amp;error]) {
        NSLog(@"æ·»åŠ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯,é”™è¯¯ä¿¡æ¯ï¼š%@ï¼",error.localizedDescription);
    }
}
</code></pre>

<p>4.åˆ é™¤æ•°æ®</p>

<p>åˆ é™¤æ•°æ®å¯ä»¥ç›´æ¥è°ƒç”¨ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„deleteObjectæ–¹æ³•ï¼Œåˆ é™¤å®Œä¿å­˜ä¸Šä¸‹æ–‡å³å¯ã€‚æ³¨æ„ï¼Œåˆ é™¤æ•°æ®å‰å¿…é¡»å…ˆæŸ¥è¯¢åˆ°å¯¹åº”å¯¹è±¡ã€‚</p>

<pre><code>-(void)removeUser:(User *)user{
    [self.context deleteObject:user];
    NSError *error;
    if (![self.context save:&amp;error]) {
        NSLog(@"åˆ é™¤è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ï¼š%@!",error.localizedDescription);
    }
}
</code></pre>

<p>5.ä¿®æ”¹æ•°æ®</p>

<p>ä¿®æ”¹æ•°æ®é¦–å…ˆä¹Ÿæ˜¯å–å‡ºå¯¹åº”çš„å®ä½“å¯¹è±¡ï¼Œç„¶åé€šè¿‡ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œæœ€åä¿å­˜ä¸Šä¸‹æ–‡ã€‚</p>

<pre><code>-(void)modifyUserWithName:(NSString *)name screenName:(NSString *)screenName profileImageUrl:(NSString *)profileImageUrl mbtype:(NSString *)mbtype city:(NSString *)city{
    User *us=[self getUserByName:name];
    us.screenName=screenName;
    us.profileImageUrl=profileImageUrl;
    us.mbtype=mbtype;
    us.city=city;
    NSError *error;
    if (![self.context save:&amp;error]) {
        NSLog(@"ä¿®æ”¹è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯,é”™è¯¯ä¿¡æ¯ï¼š%@",error.localizedDescription);
    }
}
</code></pre>

<p>è°ƒè¯•</p>

<p>è™½ç„¶Core Dataï¼ˆå¦‚æœä½¿ç”¨SQLiteæ•°æ®åº“ï¼‰æ“ä½œæœ€ç»ˆè½¬æ¢ä¸ºSQLæ“ä½œï¼Œä½†æ˜¯è°ƒè¯•èµ·æ¥å´ä¸æƒ³æ“ä½œSQLé‚£ä¹ˆæ–¹ä¾¿ã€‚ç‰¹åˆ«æ˜¯å¯¹äºåˆå­¦è€…è€Œè¨€ç»å¸¸å‡ºç°æŸ¥è¯¢æŠ¥é”™çš„é—®é¢˜ï¼Œå¦‚æœèƒ½çœ‹åˆ°æœ€ç»ˆç”Ÿæˆçš„SQLè¯­å¥è‡ªç„¶å¯¹äºè°ƒè¯•å¾ˆæœ‰å¸®åŠ©ã€‚äº‹å®ä¸Šåœ¨Xcodeä¸­æ˜¯æ”¯æŒCore Dataè°ƒè¯•çš„ï¼Œå…·ä½“æ“ä½œï¼šProduct-Scheme-Edit Scheme-Run-Argumentsä¸­ä¾æ¬¡æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼ˆæ³¨æ„å‚æ•°é¡ºåºä¸èƒ½é”™ï¼‰ï¼š-com.apple.CoreData.SQLDebugã€1ã€‚ç„¶ååœ¨è¿è¡Œç¨‹åºè¿‡ç¨‹ä¸­å¦‚æœæ“ä½œäº†æ•°æ®åº“å°±ä¼šå°†SQLè¯­å¥æ‰“å°åœ¨è¾“å‡ºé¢æ¿ã€‚</p>

<p><img src="http://al1020119.github.io/images/CSR008.jpg" title="Caption" ></p>

<p>æ³¨æ„ï¼šå¦‚æœæ¨¡å‹å‘ç”Ÿäº†å˜åŒ–ï¼Œæ­¤æ—¶å¯ä»¥é‡æ–°ç”Ÿæˆå®ä½“ç±»æ–‡ä»¶ï¼Œä½†æ˜¯æ‰€ç”Ÿæˆçš„æ•°æ®åº“å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘é‡æ–°ç”Ÿæˆæ•°æ®åº“å¹¶è¿ç§»åŸæœ‰çš„æ•°æ®ã€‚</p>

<p>FMDB</p>

<p>åŸºæœ¬ä½¿ç”¨</p>

<p>ç›¸æ¯”äºSQLite3æ¥è¯´Core Dataå­˜åœ¨ç€è¯¸å¤šä¼˜åŠ¿ï¼Œå®ƒé¢å‘å¯¹è±¡ï¼Œå¼€å‘äººå‘˜ä¸å¿…è¿‡å¤šçš„å…³å¿ƒæ›´å¤šæ•°æ®åº“æ“ä½œçŸ¥è¯†ï¼ŒåŒæ—¶å®ƒåŸºäºObjCæ“ä½œï¼Œä¹¦å†™æ›´åŠ ä¼˜é›…ç­‰ã€‚ä½†æ˜¯å®ƒæœ¬èº«ä¹Ÿå­˜åœ¨ç€ä¸€å®šçš„é™åˆ¶ï¼Œä¾‹å¦‚å¦‚æœè€ƒè™‘åˆ°è·¨å¹³å°ï¼Œåˆ™åªèƒ½é€‰æ‹©SQLiteï¼Œå› ä¸ºæ— è®ºæ˜¯iOSè¿˜æ˜¯Androidéƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“ï¼Œé™ä½äº†å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚å…¶æ¬¡æ˜¯å½“å‰å¤šæ•°ORMæ¡†æ¶éƒ½å­˜åœ¨çš„æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºORMæœ€ç»ˆè½¬åŒ–ä¸ºSQLæ“ä½œï¼Œå…¶ä¸­ç‰µæ‰¯åˆ°æ¨¡å‹æ•°æ®è½¬åŒ–ï¼Œå…¶æ€§èƒ½è‡ªç„¶æ¯”ä¸ä¸Šç›´æ¥ä½¿ç”¨SQLæ“ä½œæ•°æ®åº“ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„é€‰æ‹©å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¯¹SQLiteè¿›è¡Œå°è£…ã€‚</p>

<p>å…¶å®é€šè¿‡å‰é¢å¯¹äºSQLiteçš„åˆ†æï¼Œå¤§å®¶åº”è¯¥å·²ç»çœ‹åˆ°KCDbManagerå°±æ˜¯å¯¹äºSQLiteå°è£…çš„ç»“æœï¼Œå¼€å‘äººå‘˜é¢å¯¹çš„åªæœ‰SQLå’ŒObjCæ–¹æ³•ï¼Œä¸ç”¨è¿‡å¤šlibsqlite3çš„Cè¯­è¨€APIã€‚ä½†å®ƒæ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªç®€å•çš„å°è£…ï¼Œè¿˜æœ‰æ›´å¤šçš„ç»†èŠ‚æ²¡æœ‰è€ƒè™‘ï¼Œä¾‹å¦‚å¦‚ä½•å¤„ç†å¹¶å‘å®‰å…¨æ€§ï¼Œå¦‚ä½•æ›´å¥½çš„å¤„ç†äº‹åŠ¡ç­‰ã€‚å› æ­¤ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶FMDBï¼Œæ•´ä¸ªæ¡†æ¶éå¸¸è½»é‡çº§ä½†åˆä¸å¤±çµæ´»æ€§ï¼Œä¹Ÿæ˜¯å¾ˆå¤šä¼ä¸šå¼€å‘çš„é¦–é€‰ã€‚</p>

<p>1.FMDBæ—¢ç„¶æ˜¯å¯¹äºlibsqlite3æ¡†æ¶çš„å°è£…ï¼Œè‡ªç„¶ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½¿ç”¨å‰ä¹Ÿè¦æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“æ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€å¦åˆ™ä¼šåˆ›å»ºå¹¶æ‰“å¼€ã€‚è¿™é‡ŒFMDBå¼•å…¥äº†ä¸€ä¸ªMFDatabaseå¯¹è±¡æ¥è¡¨ç¤ºæ•°æ®åº“ï¼Œæ‰“å¼€æ•°æ®åº“å’Œåé¢çš„æ•°æ®åº“æ“ä½œå…¨éƒ¨ä¾èµ–æ­¤å¯¹è±¡ã€‚ä¸‹é¢æ˜¯æ‰“å¼€æ•°æ®åº“è·å¾—MFDatabaseå¯¹è±¡çš„ä»£ç ï¼š</p>

<pre><code>-(void)openDb:(NSString *)dbname{
    //å–å¾—æ•°æ®åº“ä¿å­˜è·¯å¾„ï¼Œé€šå¸¸ä¿å­˜æ²™ç›’Documentsç›®å½•
    NSString *directory=[NSSearchPathForDirectoriesInDomains(NSDocumentationDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@"%@",directory);
    NSString *filePath=[directory stringByAppendingPathComponent:dbname];
    //åˆ›å»ºFMDatabaseå¯¹è±¡
    self.database=[FMDatabase databaseWithPath:filePath];
    //æ‰“å¼€æ•°æ®ä¸Š
    if ([self.database open]) {
        NSLog(@"æ•°æ®åº“æ‰“å¼€æˆåŠŸ!");
    }else{
        NSLog(@"æ•°æ®åº“æ‰“å¼€å¤±è´¥!");
    }
}
</code></pre>

<p>æ³¨æ„ï¼šdataWithPathä¸­çš„è·¯å¾„å‚æ•°ä¸€èˆ¬ä¼šé€‰æ‹©ä¿å­˜åˆ°æ²™ç®±ä¸­çš„Documentsç›®å½•ä¸­ï¼›å¦‚æœè¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºnilåˆ™æ•°æ®åº“ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºï¼›å¦‚æœè®¾ç½®ä¸º@â€â€åˆ™ä¼šåœ¨æ²™ç®±ä¸­çš„ä¸´æ—¶ç›®å½•åˆ›å»º,åº”ç”¨ç¨‹åºå…³é—­åˆ™æ–‡ä»¶åˆ é™¤ã€‚</p>

<p>2.å¯¹äºæ•°æ®åº“çš„æ“ä½œè·Ÿå‰é¢KCDbManagerçš„å°è£…æ˜¯ç±»ä¼¼çš„ï¼Œåœ¨FMDBä¸­FMDatabaseç±»æä¾›äº†ä¸¤ä¸ªæ–¹æ³•executeUpdate:å’ŒexecuteQuery:åˆ†åˆ«ç”¨äºæ‰§è¡Œæ— è¿”å›ç»“æœçš„æŸ¥è¯¢å’Œæœ‰è¿”å›ç»“æœçš„æŸ¥è¯¢ã€‚å½“ç„¶è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å¾ˆå¤šçš„é‡è½½è¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šäº†ã€‚å”¯ä¸€éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå¦‚æœè°ƒç”¨æœ‰æ ¼å¼åŒ–å‚æ•°çš„sqlè¯­å¥æ—¶ï¼Œæ ¼å¼åŒ–ç¬¦å·ä½¿ç”¨â€œ?â€è€Œä¸æ˜¯â€œ%@â€ã€ç­‰ã€‚ä¸‹é¢æ˜¯ä¸¤ç§æƒ…å†µçš„ä»£ç ç‰‡æ®µï¼š</p>

<p>a.æ— è¿”å›ç»“æœ</p>

<p>-(void)executeNonQuery:(NSString *)sql{
    //æ‰§è¡Œæ›´æ–°sqlè¯­å¥ï¼Œç”¨äºæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤
    if (![self.database executeUpdate:sql]) {
        NSLog(@&ldquo;æ‰§è¡ŒSQLè¯­å¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼&rdquo;);
    }
}</p>

<p>b.æœ‰è¿”å›ç»“æœ</p>

<p>-(NSArray <em>)executeQuery:(NSString </em>)sql{
    NSMutableArray <em>array=[NSMutableArray array];
    //æ‰§è¡ŒæŸ¥è¯¢sqlè¯­å¥
    FMResultSet </em>result= [self.database executeQuery:sql];
    while (result.next) {
        NSMutableDictionary *dic=[NSMutableDictionary dictionary];
        for (int i=0; i&lt;result.columnCount; ++i) {
            dic[[result columnNameForIndex:i]]=[result stringForColumnIndex:i];
        }
        [array addObject:dic];
    }
    return array;
}</p>

<p>å¯¹äºæœ‰è¿”å›ç»“æœçš„æŸ¥è¯¢è€Œè¨€ï¼ŒæŸ¥è¯¢å®Œè¿”å›ä¸€ä¸ªæ¸¸æ ‡FMResultSetï¼Œé€šè¿‡éå†æ¸¸æ ‡è¿›è¡ŒæŸ¥è¯¢ã€‚è€Œä¸”FMDBä¸­æä¾›äº†å¤§é‡intForColumnã€stringForColumnç­‰æ–¹æ³•è¿›è¡Œå–å€¼ã€‚</p>

<p>å¹¶å‘å’Œäº‹åŠ¡</p>

<p>æˆ‘ä»¬çŸ¥é“ç›´æ¥ä½¿ç”¨libsqlite3è¿›è¡Œæ•°æ®åº“æ“ä½œå…¶å®æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœé‡åˆ°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªè¡¨çš„æ—¶å€™å¯èƒ½ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨FMDatabaseQueueå¯¹è±¡ï¼Œç›¸æ¯”FMDatabaseè€Œè¨€ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>

<p>åˆ›å»ºFMDatabaseQueueçš„æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œè°ƒç”¨databaseQueueWithPath:æ–¹æ³•å³å¯ã€‚æ³¨æ„è¿™é‡Œä¸éœ€è¦è°ƒç”¨æ‰“å¼€æ“ä½œã€‚</p>

<pre><code>-(void)openDb:(NSString *)dbname{
    //å–å¾—æ•°æ®åº“ä¿å­˜è·¯å¾„ï¼Œé€šå¸¸ä¿å­˜æ²™ç›’Documentsç›®å½•
    NSString *directory=[NSSearchPathForDirectoriesInDomains(NSDocumentationDirectory, NSUserDomainMask, YES) firstObject];
    NSLog(@"%@",directory);
    NSString *filePath=[directory stringByAppendingPathComponent:dbname];
    //åˆ›å»ºFMDatabaseQueueå¯¹è±¡
    self.database=[FMDatabaseQueue databaseQueueWithPath:filePath];
}
</code></pre>

<p>ç„¶åæ‰€æœ‰çš„å¢åˆ æ”¹æŸ¥æ“ä½œè°ƒç”¨FMDatabaseQueueçš„inDatabase:æ–¹æ³•åœ¨blockä¸­æ‰§è¡Œæ“ä½œsqlè¯­å¥å³å¯ã€‚</p>

<pre><code>-(void)executeNonQuery:(NSString *)sql{
    //æ‰§è¡Œæ›´æ–°sqlè¯­å¥ï¼Œç”¨äºæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤
    [self.database inDatabase:^(FMDatabase *db) {
        [db executeQuery:sql];
    }];
}
-(NSArray *)executeQuery:(NSString *)sql{
    NSMutableArray *array=[NSMutableArray array];
    [self.database inDatabase:^(FMDatabase *db) {
        //æ‰§è¡ŒæŸ¥è¯¢sqlè¯­å¥
        FMResultSet *result= [db executeQuery:sql];
        while (result.next) {
            NSMutableDictionary *dic=[NSMutableDictionary dictionary];
            for (int i=0; i&lt;result.columnCount; ++i) {
                dic[[result columnNameForIndex:i]]=[result stringForColumnIndex:i];
            }
            [array addObject:dic];
        }
    }];
    return array;
}
</code></pre>

<p>ä¹‹æ‰€ä»¥å°†äº‹åŠ¡æ”¾åˆ°FMDBä¸­å»è¯´å¹¶ä¸æ˜¯å› ä¸ºåªæœ‰FMDBæ‰æ”¯æŒäº‹åŠ¡ï¼Œè€Œæ˜¯å› ä¸ºFMDBå°†å…¶å°è£…æˆäº†å‡ ä¸ªæ–¹æ³•æ¥è°ƒç”¨ï¼Œä¸ç”¨è‡ªå·±å†™å¯¹åº”çš„sqlè€Œå·²ã€‚å…¶å®åœ¨åœ¨ä½¿ç”¨libsqlite3æ“ä½œæ•°æ®åº“æ—¶ä¹Ÿæ˜¯åŸç”Ÿæ”¯æŒäº‹åŠ¡çš„ï¼ˆå› ä¸ºè¿™é‡Œçš„äº‹åŠ¡æ˜¯åŸºäºæ•°æ®åº“çš„ï¼ŒFMDBè¿˜æ˜¯ä½¿ç”¨çš„SQLiteæ•°æ®åº“ï¼‰ï¼Œåªè¦åœ¨æ‰§è¡Œsqlè¯­å¥å‰åŠ ä¸Šâ€œbegin transaction;â€æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œâ€œcommit transaction;â€æˆ–è€…â€œrollback transaction;â€è¿›è¡Œæäº¤æˆ–å›æ»šå³å¯ã€‚å¦å¤–åœ¨Core Dataä¸­å¤§å®¶ä¹Ÿå¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„å¢ã€åˆ ã€æ”¹æ“ä½œä¹‹åå¿…é¡»è°ƒç”¨ä¸Šä¸‹æ–‡çš„ä¿å­˜æ–¹æ³•ï¼Œå…¶å®æœ¬èº«å°±æä¾›äº†äº‹åŠ¡çš„æ”¯æŒï¼Œåªè¦ä¸è°ƒç”¨ä¿å­˜æ–¹æ³•ï¼Œä¹‹å‰æ‰€æœ‰çš„æ“ä½œæ˜¯ä¸ä¼šæäº¤çš„ã€‚åœ¨FMDBä¸­FMDatabaseæœ‰beginTransactionã€commitã€rollbackä¸‰ä¸ªæ–¹æ³•è¿›è¡Œå¼€å¯äº‹åŠ¡ã€æäº¤äº‹åŠ¡å’Œå›æ»šäº‹åŠ¡ã€‚</p>

<p>æ€»ç»“ï¼š</p>

<p>core data</p>

<p>core data åŸºäºmodel-view-controllerï¼ˆmvcï¼‰æ¨¡å¼ä¸‹ï¼Œä¸ºåˆ›å»ºåˆ†è§£çš„cocoaåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªçµæ´»å’Œå¼ºå¤§çš„æ•°æ®æ¨¡å‹æ¡†æ¶ã€‚</p>

<p>core dataå¯ä»¥ä½¿ä½ ä»¥å›¾å½¢ç•Œé¢çš„æ–¹å¼å¿«é€Ÿçš„å®šä¹‰appçš„æ•°æ®æ¨¡å‹ï¼ŒåŒæ—¶åœ¨ä½ çš„ä»£ç ä¸­å®¹æ˜“è·å–åˆ°å®ƒã€‚core dataæä¾›äº†åŸºç¡€ç»“æ„å»å¤„ç†å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ä¿å­˜ï¼Œæ¢å¤ï¼Œæ’¤é”€å’Œé‡åšï¼Œå…è®¸ä½ åœ¨appä¸­ç»§ç»­åˆ›å»ºæ–°çš„ä»»åŠ¡ã€‚åœ¨ä½¿ç”¨core dataçš„æ—¶å€™ï¼Œä½ ä¸ç”¨å®‰è£…é¢å¤–çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå› ä¸ºcore dataä½¿ç”¨å†…ç½®çš„sqliteæ•°æ®åº“ã€‚</p>

<p>core dataæä¾›äº†ä¸€ä¸ªé€šç”¨çš„æ•°æ®ç®¡ç†è§£å†³æ–¹æ¡ˆæ¥å¤„ç†é‚£äº›æ‰€æœ‰éœ€è¦æ•°æ®æ¨¡å‹çš„app(æˆ–å¤§æˆ–å°)ã€‚appä½¿ç”¨core dataæ¥ç®¡ç†æ•°æ®å¯¹è±¡æ˜¯å¾ˆå¤šçš„ç›Šå¤„ã€‚</p>

<p>è‹¹æœçš„å›¾å½¢ç”¨æˆ·ç•Œé¢ç¼–è¯‘å™¨-interface builderï¼ˆIBï¼‰ï¼Œæä¾›äº†å¯¹core data controllerå¯¹è±¡çš„é¢„æ„å»ºï¼Œä»è€Œæ¥å‡å°‘appçš„ç”¨æˆ·ç•Œé¢å’Œå®ƒçš„æ•°æ®æ¨¡å‹ä¹‹é—´çš„ç²˜æ»ä»£ç ã€‚åœ¨ä½¿ç”¨core dataçš„æ—¶å€™ä½ ä¸éœ€è¦è€ƒè™‘sqlçš„è¯­æ³•é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦ç®¡ç†ç›¸å…³çš„é€»è¾‘æ ‘å»è¿½è¸ªç”¨æˆ·çš„è¡Œä¸ºï¼Œæ›´ä¸ç”¨å»ºç«‹æ–°çš„æ°¸ä¹…æœºåˆ¶ã€‚å½“ä½ å†™ä½ appçš„ç”¨æˆ·ç•Œé¢åˆ°å®ƒçš„ core dataæ¨¡å‹çš„æ—¶å€™ï¼Œå®ƒå·²ç»ä¸ºä½ æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½åšå¥½äº†ã€‚</p>

<p>core dataå°†ä½ appçš„æ¨¡å‹å±‚æ”¾å…¥åˆ°ä¸€ç»„å®šä¹‰åœ¨å†…å­˜ä¸­çš„æ•°æ®å¯¹è±¡ã€‚core dataä¼šè¿½è¸ªè¿™äº›å¯¹è±¡çš„æ”¹å˜ï¼ŒåŒæ—¶å¯ä»¥æ ¹æ®éœ€è¦åšç›¸åçš„æ”¹å˜ï¼Œä¾‹å¦‚ç”¨æˆ·æ‰§è¡Œæ’¤é”€å‘½ä»¤ã€‚å½“core dataåœ¨å¯¹ä½ appæ•°æ®çš„æ”¹å˜è¿›è¡Œä¿å­˜çš„æ—¶å€™ï¼Œcore dataä¼šæŠŠè¿™äº›æ•°æ®å½’æ¡£ï¼Œå¹¶æ°¸ä¹…æ€§ä¿å­˜ã€‚å®ƒä¿å­˜çš„æ•°æ®åœ¨ä¸€äº›å¸¸è§„çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨Finderä¸­å¯ä»¥è¿›è¡Œç®¡ç†ï¼Œç”¨spotlightè¿›è¡Œæœç´¢ï¼Œå¤‡ä»½åˆ° cdï¼Œå’Œemailç»™æœ‹å‹æˆ–è€…å®¶äººã€‚</p>

<p>åœ¨ä½¿ç”¨core dataæ¡†æ¶çš„æ—¶å€™ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç®¡ç†å¯¹è±¡çš„æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æä¾›äº†å¯¹æ¨¡å‹å¯¹è±¡çš„æŠ½è±¡å®šä¹‰ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€çŸ¥é“çš„entitiesï¼Œå®ƒå¯ä»¥åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ä½¿ç”¨ã€‚</p>

<p>core dataæ˜¯ä¸€ä¸ªå®ä½“-å…³ç³»æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ˜¯ä½¿ç”¨Xcodeçš„æ•°æ®æ¨¡å‹è®¾è®¡å·¥å…·æ¥å®šä¹‰çš„ï¼Œå¯¹æ•°æ®å®ä½“ä»¥åŠä»–ä»¬çš„å…³ç³»æä¾›äº†ä¸°å¯Œçš„ç¯å¢ƒã€‚</p>

<p>sqlite</p>

<p>mac os xä¸­sqliteåº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§åŠŸèƒ½å¼ºå¤§çš„å…³ç³»æ•°æ®å¼•æ“ï¼Œä¹Ÿå¾ˆå®¹æ˜“åµŒå…¥åˆ°åº”ç”¨ç¨‹åºã€‚å¯ä»¥åœ¨å¤šä¸ªå¹³å°ä½¿ç”¨ï¼Œsqliteæ˜¯ä¸€ä¸ªè½»é‡çº§çš„åµŒå…¥å¼sqlæ•°æ®åº“ç¼–ç¨‹ã€‚ä¸core dataæ¡†æ¶ä¸åŒçš„æ˜¯ï¼Œsqliteæ˜¯ä½¿ç”¨ç¨‹åºå¼çš„ï¼Œsqlçš„ä¸»è¦çš„APIæ¥ç›´æ¥æ“ä½œæ•°æ®è¡¨ã€‚</p>

<p>fmdb
FMDBæ¡†æ¶å…¶å®åªæ˜¯ä¸€å±‚å¾ˆè–„çš„å°è£…ï¼Œä¸»è¦çš„ç±»ä¹Ÿå°±ä¸¤ä¸ªï¼šFMDatabaseå’ŒFMResultSetã€‚åœ¨ä½¿ç”¨fmdbçš„æ—¶å€™è¿˜éœ€è¦å¯¼å…¥libsqlite3.0.dylibã€‚</p>

<p>core dataå…è®¸ç”¨æˆ·ä½¿ç”¨ä»£è¡¨å®ä½“å’Œå®ä½“é—´å…³ç³»çš„é«˜å±‚å¯¹è±¡æ¥æ“ä½œæ•°æ®ã€‚å®ƒä¹Ÿå¯ä»¥ç®¡ç†ä¸²è¡ŒåŒ–çš„æ•°æ®ï¼Œæä¾›å¯¹è±¡ç”Ÿå­˜æœŸç®¡ç†ä¸object_graph ç®¡ç†ï¼ŒåŒ…æ‹¬å­˜å‚¨ã€‚Core Dataç›´æ¥ä¸Sqliteäº¤äº’ï¼Œé¿å…å¼€å‘è€…ä½¿ç”¨åŸæœ¬çš„SQLè¯­å¥.</p>

<p>ä¸Šé¢çš„ä¸‰ç§ï¼Œéƒ½æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å‘¢ï¼Ÿ
åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™å°½é‡ä½¿ç”¨core dataï¼Œè¿™æ ·æ‰æ˜¯æœ€ä¼˜çš„é€‰æ‹©ã€‚
è‡³äºsqliteå’Œfmdbçš„ä½¿ç”¨æƒ…å†µï¼Œè¿™ä¸ªçœ‹ä¸ªäººå–œå¥½äº†ï¼Œä¸ªäººè§‰å¾—æ²¡ä»€ä¹ˆæ ‡å‡†ã€‚fmdbå°±æ˜¯å¯¹sqliteçš„å°è£…ï¼Œä½¿ç”¨èµ·æ¥æœ‰æ–¹ä¾¿çš„æ¥å£ï¼Œæ²¡é‚£ä¹ˆéº»çƒ¦è€Œå·²ã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CoreData å¤§æˆ˜ SQLite]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/05/xsqlyucoredata/"/>
    <updated>2016-07-05T14:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/05/xsqlyucoredata</id>
    <content type="html"><![CDATA[<p>å‡­è‰¯å¿ƒè®²ï¼Œæˆ‘ä¸èƒ½å‘Šè¯‰ä½ ä¸å»ä½¿ç”¨Core Dataã€‚å®ƒä¸é”™ï¼Œè€Œä¸”ä¹Ÿåœ¨å˜å¥½ï¼Œå¹¶ä¸”å®ƒè¢«å¾ˆå¤šå…¶ä»–Cocoaå¼€å‘è€…æ‰€ç†è§£ï¼Œå½“æœ‰æ–°äººåŠ å…¥ä½ çš„ç»„æˆ–è€…éœ€è¦åˆ«äººæ¥æ‰‹ä½ çš„é¡¹ç›®çš„æ—¶å€™ï¼Œè¿™ç‚¹å¾ˆé‡è¦ã€‚</p>

<p>æ›´é‡è¦çš„æ˜¯ï¼Œä¸å€¼å¾—èŠ±æ—¶é—´å’Œç²¾åŠ›å»å†™è‡ªå·±çš„ç³»ç»Ÿå»ä»£æ›¿å®ƒã€‚çœŸçš„ï¼Œä½¿ç”¨Core Dataå§ã€‚</p>

<p>ä¸ºä»€ä¹ˆæˆ‘ä¸ä½¿ç”¨Core Data<br/>
 Mike Ashå†™åˆ°ï¼šå°±æˆ‘è‡ªå·±è€Œè¨€ï¼Œæˆ‘ä¸æ˜¯ä¸ªç‹‚çƒ­ç²‰ä¸ã€‚æˆ‘å‘ç°APIæ˜¯ç¬¨æ‹™çš„ï¼Œå¹¶ä¸”æ¡†æ¶æœ¬èº«å¯¹äºå¤§é‡çš„æ•°æ®æ˜¯æå…¶ç¼“æ…¢çš„ã€‚</p>

<p>ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š10,000æ¡ç›®
æƒ³è±¡ä¸€ä¸ªRSSé˜…è¯»å™¨ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥åœ¨ä¸€ä¸ªfeedä¸Šç‚¹å‡»å³é”®ï¼Œå¹¶ä¸”é€‰æ‹©æ ‡è®°æ‰€æœ‰ä¸ºå·²è¯»ã€‚</p>

<!--more-->


<p>å¼•æ“ä¸‹ï¼Œæœ‰ä¸€ä¸ªå¸¦æœ‰readå±æ€§çš„Articleå®ä½“ã€‚æŠŠæ‰€æœ‰æ¡ç›®æ ‡è®°ä¸ºå·²è¯»ï¼Œç¨‹åºéœ€è¦åŠ è½½è¿™ä¸ªfeedçš„æ‰€æœ‰æ–‡ç« (å¯èƒ½é€šè¿‡ä¸€å¯¹å¤šçš„å…³ç³»)ï¼Œç„¶åè®¾ç½®readå±æ€§ä¸ºYESã€‚</p>

<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™æ ·æ²¡å…³ç³»ã€‚ä½†æ˜¯è®¾æƒ³é‚£ä¸ªfeedé‡Œæœ‰200ä¸ªæ–‡ç« ï¼Œä¸ºäº†é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½ å¯èƒ½è€ƒè™‘åœ¨åå°çº¿ç¨‹é‡Œåšè¿™ä¸ªå·¥ä½œ(ç‰¹åˆ«å½“ä½ çš„ç¨‹åºæ˜¯ä¸€ä¸ªiPhoneåº”ç”¨)ã€‚å½“ä½ ä¸€å¼€å§‹ä½¿ç”¨Core Dataå¤šçº¿ç¨‹ï¼Œäº‹æƒ…å°±å¼€å§‹å˜çš„ä¸å¥½å¤„ç†äº†ã€‚</p>

<p>è¿™å¯èƒ½è¿˜å‡‘åˆï¼Œè‡³å°‘ä¸å€¼å¾—åˆ‡æ¢èµ°Core Dataã€‚</p>

<p>ä½†æ˜¯æ¥ä¸‹æ¥åŠ åŒæ­¥ã€‚</p>

<p>æˆ‘ç”¨è¿‡ä¸¤ç§ä¸åŒçš„è·å–å·²è¯»æ–‡ç« IDåˆ—è¡¨çš„RSSåŒæ­¥æ¥å£ã€‚å…¶ä¸­ä¸€ä¸ªè¿”å›è¿‘10,000ä¸ªIDã€‚</p>

<p>ä½ ä¸ä¼šæ‰“ç®—åœ¨ä¸»çº¿ç¨‹ä¸­åŠ è½½10,000ä¸ªæ–‡ç« ï¼Œç„¶åè®¾ç½®readä¸ºNOã€‚ä½ ç”šè‡³ä¸æƒ³åœ¨åå°çº¿ç¨‹é‡ŒåŠ è½½10,000ä¸ªæ–‡ç« ï¼Œå³ä½¿å¾ˆå°å¿ƒçš„ç®¡ç†å†…å­˜ï¼Œè¿™æœ‰å¤ªå¤šçš„å·¥ä½œï¼ˆå¦‚æœä½ é¢‘ç¹çš„è¿™ä¹ˆåšï¼Œæƒ³ä¸€ä¸‹å¯¹ç”µæ± å¯¿å‘½çš„å½±å“ï¼‰ã€‚</p>

<p>ä½ çœŸæ­£æƒ³è¦åšçš„æ˜¯ï¼Œè®©æ•°æ®åº“ç»™åœ¨IDåˆ—è¡¨é‡Œçš„æ¯ä¸€ä¸ªæ–‡ç« è®¾ç½®readä¸ºYESã€‚</p>

<p>SQLiteå¯ä»¥åšåˆ°è¿™ä¸ªï¼Œåªç”¨ä¸€æ¬¡è°ƒç”¨ã€‚å‡è®¾uniqueIDä¸Šæœ‰ç´¢å¼•ï¼Œè¿™ä¼šå¾ˆå¿«ã€‚è€Œä¸”ä½ å¯ä»¥åœ¨åå°çº¿ç¨‹æ‰§è¡Œåƒåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä¸€æ ·å®¹æ˜“ã€‚</p>

<p>å¦ä¸€ä¸ªä¾‹å­ï¼šå¿«é€Ÿå¯åŠ¨
æˆ‘æƒ³å‡å°‘æˆ‘çš„å¦ä¸€ä¸ªç¨‹åºçš„å¯åŠ¨æ—¶é—´ï¼Œä¸åªæ˜¯å¼€å§‹çš„æ—¶é—´ï¼Œè€Œæ˜¯åœ¨æ•°æ®æ˜¾ç¤ºä¹‹å‰çš„æ‰€æœ‰æ—¶é—´ã€‚</p>

<p>é‚£æ˜¯ä¸ªç±»ä¼¼Twitterçš„åº”ç”¨(è™½ç„¶å®ƒä¸æ˜¯)ï¼Œå®ƒæ˜¾ç¤ºæ¶ˆæ¯çš„æ—¶é—´è½´ã€‚æ˜¾ç¤ºæ—¶é—´è½´æ„å‘³ç€è·å–æ¶ˆæ¯ï¼ŒåŠ è½½ç›¸å…³ç”¨æˆ·ã€‚å®ƒå¾ˆå¿«ï¼Œä½†æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå¡«å……UIï¼Œç„¶åå¡«å……æ•°æ®ã€‚</p>

<p>å…³äºiPhoneçš„åº”ç”¨ï¼ˆæˆ–è€…æ‰€æœ‰åº”ç”¨ï¼‰æˆ‘çš„ç†è®ºæ˜¯ï¼Œå¯åŠ¨æ—¶é—´å¾ˆé‡è¦ï¼Œæ¯”å…¶ä»–å¤§éƒ¨åˆ†å¼€å‘è€…æƒ³çš„éƒ½è¦é‡è¦ã€‚åº”ç”¨çš„å¯åŠ¨å¾ˆæ…¢çœ‹èµ·æ¥ä¸åƒæ˜¯è¦å¯åŠ¨ä¸€æ ·ï¼Œå› ä¸ºäººä»¬æ½œæ„è¯†é‡Œè®°å¾—ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿé˜»æ­¢å¯åŠ¨åº”ç”¨çš„æƒ³æ³•ã€‚å‡å°‘å¯åŠ¨æ—¶é—´å°±å‡å°‘äº†æ‘©æ“¦ï¼Œè®©ç”¨æˆ·æ›´æœ‰å¯èƒ½ç»§ç»­ä½¿ç”¨ä½ çš„åº”ç”¨ï¼Œå¹¶ä¸”æ¨èç»™å…¶ä»–äººã€‚è¿™æ˜¯ä½ è®©ä½ çš„åº”ç”¨æˆåŠŸçš„ä¸€éƒ¨åˆ†ã€‚</p>

<p>å› ä¸ºæˆ‘ä¸ä½¿ç”¨Core Dataï¼Œæˆ‘æ‰‹è¾¹æœ‰ä¸€ä¸ªç®€å•çš„ï¼Œä¿å®ˆçš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘æŠŠtimelineï¼ˆæ¶ˆæ¯å’Œäººç‰©å¯¹è±¡ï¼‰é€šè¿‡NSCodingä¿å­˜åˆ°ä¸€ä¸ªplistæ–‡ä»¶ä¸­ã€‚å¯åŠ¨çš„æ—¶å€™å®ƒè¯»è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ›å»ºæ¶ˆæ¯å’Œäººç‰©å¯¹è±¡ï¼ŒUIä¸€å‡ºç°å°±æ˜¾ç¤ºæ—¶é—´è½´ã€‚</p>

<p>è¿™æ˜æ˜¾çš„å‡å°‘äº†å»¶è¿Ÿã€‚</p>

<p>æŠŠæ¶ˆæ¯å’Œäººç‰©å¯¹è±¡ä½œä¸ºNSManagedObjectçš„å®ä¾‹å¯¹è±¡ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå‡è®¾æˆ‘æœ‰ç¼–ç çš„å¹¶ä¸”å­˜å‚¨çš„IDså¯¹è±¡ï¼Œä½†æ˜¯é‚£æ„å‘³ç€è¯»plistç„¶åè§¦åŠæ•°æ®åº“ã€‚è¿™ç§æ–¹å¼æˆ‘å®Œå…¨é¿å…äº†æ•°æ®åº“ï¼‰ã€‚</p>

<p>åœ¨æ›´æ–°æ›´å¿«çš„æœºå™¨å‡ºæ¥å, æˆ‘å»æ‰äº†é‚£äº›ä»£ç ã€‚å›é¡¾è¿‡å»ï¼Œæˆ‘å¸Œæœ›æˆ‘å¯ä»¥æŠŠå®ƒç•™ä¸‹æ¥ã€‚</p>

<p>æˆ‘æ€ä¹ˆè€ƒè™‘è¿™ä¸ªé—®é¢˜
å½“è€ƒè™‘æ˜¯å¦ä½¿ç”¨Core Dataæ—¶ï¼Œæˆ‘è€ƒè™‘ä¸‹é¢è¿™äº›äº‹æƒ…ï¼š</p>

<p>ä¼šæœ‰éš¾ä»¥ç½®ä¿¡æ•°é‡çš„æ•°æ®å—ï¼Ÿ
å¯¹äºä¸€ä¸ªRSSé˜…è¯»å™¨æˆ–è€…Twitteråº”ç”¨ï¼Œç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼šæ˜¯çš„ã€‚æœ‰äº›äººå…³æ³¨ä¸Šç™¾ä¸ªäººã€‚ä¸€ä¸ªäººå¯èƒ½è®¢é˜…äº†ä¸Šåƒä¸ªfeedsã€‚</p>

<p>å³ä½¿ä½ çš„åº”ç”¨ä¸ä»ç½‘ç»œè·å–æ•°æ®ï¼Œä»ç„¶æœ‰å¯èƒ½è®©ç”¨æˆ·è‡ªåŠ¨æ·»åŠ æ•°æ®ã€‚å¦‚æœä½ ç”¨ä¸€ä¸ªæ”¯æŒAppleScriptçš„Macï¼Œæœ‰äº›äººä¼šå†™è„šæœ¬å»åŠ è½½éå¸¸å¤šçš„æ•°æ®ã€‚å¦‚æœé€šè¿‡web APIå»åŠ æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>

<p>ä¼šæœ‰ä¸€ä¸ªWeb APIåŒ…å«ç±»ä¼¼äºæ•°æ®åº“çš„ç»ˆç«¯å—ï¼ˆå¯¹æ¯”ç±»å¯¹è±¡ç»ˆç«¯ï¼‰ï¼Ÿ
ä¸€ä¸ªRSSåŒæ­¥APIèƒ½å¤Ÿè¿”å›ä¸€ä¸ªå·²è¯»æ–‡ç« çš„uniquelIDsåˆ—è¡¨ã€‚ä¸€ä¸ªè®°ç¬”è®°çš„åº”ç”¨çš„ä¸€ä¸ªåŒæ­¥APIå¯èƒ½è¿”å›å·²å­˜æ¡£çš„å’Œå·²åˆ é™¤çš„ç¬”è®°çš„uniquelIDsã€‚</p>

<p>ç”¨æˆ·å¯èƒ½é€šè¿‡æ“ä½œå¤„ç†å¤§é‡å¯¹è±¡å—ï¼Ÿ
åœ¨åº•å±‚ï¼Œéœ€è¦è€ƒè™‘å’Œä¹‹å‰ä¸€æ ·çš„é—®é¢˜ã€‚å½“æœ‰äººåˆ é™¤æ‰€æœ‰ä¸‹è½½çš„5ï¼Œ000ä¸ªé¢é£Ÿé£Ÿè°±ï¼Œä½ çš„é£Ÿè°±åº”ç”¨å¯ä»¥å¤šå¥½çš„å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼ˆåœ¨iPhoneä¸Šï¼Ÿï¼‰ï¼Ÿ</p>

<p>å½“æˆ‘å†³å®šä½¿ç”¨Core Dataï¼ˆæˆ‘å·²ç»å‘å¸ƒè¿‡ä½¿ç”¨Core Dataçš„åº”ç”¨ï¼‰ï¼Œæˆ‘ä¼šå°å¿ƒç•™æ„æˆ‘æ€ä¹ˆä½¿ç”¨å®ƒã€‚ä¸ºäº†å¾—åˆ°å¥½çš„æ€§èƒ½ï¼Œæˆ‘å‘ç°æˆ‘æŠŠå®ƒå½“åšä¸€ä¸ªSQLæ•°æ®åº“çš„ä¸€ä¸ªå¥‡æ€ªæ¥å£æ¥ä½¿ç”¨ï¼Œç„¶åæˆ‘çŸ¥é“æˆ‘åº”è¯¥èˆå¼ƒCore Dataï¼Œç›´æ¥ä½¿ç”¨SQLiteã€‚</p>

<p>æˆ‘æ€ä¹ˆä½¿ç”¨SQLite
æˆ‘é€šè¿‡FMDB Wrapperæ¥ä½¿ç”¨SQLiteï¼ŒFMDBæ¥è‡ªFlying Meat Softwareï¼Œç”±Gus Muelleræä¾›ã€‚</p>

<p>åŸºæœ¬æ“ä½œ
æˆ‘åœ¨iPhoneä»¥å‰ï¼ŒCore Dataä»¥å‰å°±ä½¿ç”¨è¿‡SQLiteã€‚è¿™æ˜¯å®ƒæ€ä¹ˆå·¥ä½œçš„çš„è¦ç‚¹ï¼š</p>

<ol>
<li>æ‰€æœ‰æ•°æ®åº“è®¿é—®-è¯»å’Œå†™-å‘ç”Ÿåœ¨è¿ç»­çš„é˜Ÿåˆ—é‡Œï¼Œåœ¨ä¸€ä¸ªåå°çº¿ç¨‹ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­è§¦åŠæ•°æ®åº“æ˜¯ä»æ¥ä¸è¢«å…è®¸çš„ã€‚ä½¿ç”¨ä¸€ä¸ªè¿ç»­é˜Ÿåˆ—æ¥ä¿è¯æ¯ä¸€ä»¶äº‹æ˜¯æŒ‰é¡ºåºå‘ç”Ÿçš„ã€‚</li>
<li>æˆ‘å¤§é‡ä½¿ç”¨blocksæ¥è®©å¼‚æ­¥ç¨‹åºå®¹æ˜“ç‚¹ã€‚</li>
<li>æ¨¡å‹å¯¹è±¡åªå­˜åœ¨åœ¨ä¸»çº¿ç¨‹ï¼ˆä½†æœ‰ä¸¤ä¸ªé‡è¦çš„ä¾‹å¤–ï¼‰ï¼Œæ”¹å˜ä¼šè§¦å‘ä¸€ä¸ªåå°ä¿å­˜ã€‚</li>
<li>æ¨¡å‹å¯¹è±¡åˆ—å‡ºæ¥ä»–ä»¬åœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„å±æ€§ã€‚å¯èƒ½åœ¨ä»£ç é‡Œæˆ–è€…åœ¨plistæ–‡ä»¶é‡Œã€‚
5, ä¸€äº›æ¨¡å‹å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œä¸€äº›ä¸æ˜¯ã€‚å–å†³äºåº”ç”¨çš„éœ€è¦ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µæ˜¯å”¯ä¸€çš„ï¼‰ã€‚</li>
<li>å¯¹å…³ç³»å‹æ•°æ®ï¼Œæˆ‘å°½å¯èƒ½é¿å…è¿è¡¨æŸ¥è¯¢ã€‚</li>
<li>ä¸€äº›å¯¹è±¡ç±»å‹åœ¨å¯åŠ¨çš„æ—¶å€™å°±å®Œå…¨è¯»å…¥å†…å­˜ï¼Œå¦ä¸€äº›å¯¹è±¡ç±»å‹å¯èƒ½åªéœ€è¦åˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ªä»–ä»¬çš„uniqueIDsçš„ã€‚NSMutableSetï¼Œæ‰€ä»¥ä¸éœ€è¦å»è§¦åŠæ•°æ®åº“ï¼Œæˆ‘å°±çŸ¥é“å·²ç»æœ‰ä»€ä¹ˆã€‚</li>
<li>Web APIçš„è°ƒç”¨å‘ç”Ÿåœ¨åå°çº¿ç¨‹ï¼Œä»–ä»¬ä½¿ç”¨åˆ†å¼€çš„æ¨¡å‹å¯¹è±¡ã€‚
æˆ‘ä¼šé€šè¿‡æˆ‘ç°åœ¨çš„åº”ç”¨çš„ä»£ç æ¥è¯¦ç»†æè¿°ã€‚</li>
</ol>


<p>æ•°æ®åº“æ›´æ–°
åœ¨æˆ‘æœ€è¿‘çš„åº”ç”¨ä¸­ï¼Œæœ‰ä¸€ä¸ªå•ä¸€çš„æ•°æ®åº“æ§åˆ¶å™¨-VSDatabaseControllerï¼Œå®ƒé€šè¿‡FMDBæ¥ä¸SQLiteå¯¹è¯ã€‚</p>

<p>FMDBåŒºåˆ†æ›´æ–°å’ŒæŸ¥è¯¢ã€‚æ›´æ–°æ•°æ®åº“ï¼Œappè°ƒç”¨ï¼š</p>

<pre><code>-[VSDatabaseController runDatabaseBlockInTransaction:(VSDatabaseUpdateBlock)databaseBlock] 
</code></pre>

<p>VSDatabaseUpdateBlockå¾ˆç®€å•ï¼š</p>

<pre><code>typedef void (^VSDatabaseUpdateBlock)(FMDatabase *database); 
</code></pre>

<p>runDatabaseBlockInTransactionä¹Ÿå¾ˆç®€å•ï¼š</p>

<pre><code>- (void)runDatabaseBlockInTransaction:(VSDatabaseUpdateBlock)databaseBlock { 
    dispatch_async(self.serialDispatchQueue, ^{ 
        @autoreleasepool { 
            [self beginTransaction]; 
            databaseBlock(self.database); 
            [self endTransaction]; 
        } 
    }); 
} 
</code></pre>

<p>ï¼ˆæ³¨æ„æˆ‘ç”¨è‡ªå·±çš„è¿ç»­è°ƒåº¦é˜Ÿåˆ—ã€‚Guså»ºè®®çœ‹ä¸€ä¸‹FMDatabaseQueueï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¿ç»­è°ƒåº¦é˜Ÿåˆ—ã€‚æˆ‘è¿˜æ²¡èƒ½å»çœ‹ä¸€ä¸‹ï¼Œå› ä¸ºå®ƒæ¯”FMDBçš„å…¶ä»–ä¸œè¥¿éƒ½è¦æ–°ã€‚ï¼‰</p>

<p>beginTransactionå’ŒendTransactionçš„è°ƒç”¨æ˜¯å¯åµŒå¥—çš„ï¼ˆåœ¨æˆ‘çš„æ•°æ®åº“æ§åˆ¶å™¨é‡Œï¼‰ã€‚åœ¨åˆé€‚çš„æ—¶å€™ä»–ä»¬ä¼šè°ƒç”¨-[FMDatabase beginTransaction] å’Œ -[FMDatabase commit]ã€‚ï¼ˆä½¿ç”¨äº‹åŠ¡æ˜¯è®©SQLiteå˜å¿«çš„å…³é”®ã€‚ï¼‰æç¤ºï¼šæˆ‘æŠŠå½“å‰äº‹åŠ¡å­˜å‚¨åœ¨-[NSThread threadDictionary]ã€‚å®ƒå¾ˆå¥½è·å–æ¯ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®ï¼Œæˆ‘å‡ ä¹ä»ä¸ç”¨å…¶ä»–çš„ã€‚</p>

<p>è¿™å„¿æœ‰ä¸ªè°ƒç”¨æ›´æ–°æ•°æ®åº“çš„ç®€å•ä¾‹å­ï¼š</p>

<pre><code>- (void)emptyTagsLookupTableForNote:(VSNote *)note { 
    NSString *uniqueID = note.uniqueID; 
    [self runDatabaseBlockInTransaction:^(FMDatabase *database) { 
        [database executeUpdate: 
            @"delete from tagsNotesLookup where noteUniqueID = ?;", uniqueID]; 
    }]; 
} 
</code></pre>

<p>è¿™è¯´æ˜ä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆSQLä¸å¯æ€•ã€‚å³ä½¿ä½ ä»æ²¡è§è¿‡å®ƒï¼Œä½ ä¹ŸçŸ¥é“è¿™è¡Œä»£ç åšäº†ä»€ä¹ˆã€‚</p>

<p>åƒVSDatabaseControllerçš„æ‰€æœ‰å…¶ä»–å…¬å…±æ¥å£ï¼ŒemptyTagsLookupTableForNoteåº”è¯¥åœ¨ä¸»çº¿ç¨‹ä¸­è¢«è°ƒç”¨ã€‚æ¨¡å‹å¯¹è±¡åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¢«å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨blockä¸­ç”¨uniqueIDï¼Œè€Œä¸æ˜¯VSNoteå¯¹è±¡ã€‚</p>

<p>æ³¨æ„åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘æ›´æ–°äº†ä¸€ä¸ªæŸ¥æ‰¾è¡¨ã€‚Noteså’Œtagsæ˜¯å¤šå¯¹å¤šå…³ç³»ï¼Œä¸€ç§è¡¨ç°æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªæ•°æ®åº“è¡¨æ˜ å°„note uniqueIDså’Œtag uniqueIDsã€‚è¿™äº›è¡¨ä¸ä¼šå¾ˆéš¾ç»´æŠ¤ï¼Œä½†æ˜¯å¦‚æœå¯èƒ½ï¼Œæˆ‘ç¡®å®å°è¯•é¿å…ä»–ä»¬çš„ä½¿ç”¨ã€‚</p>

<p>æ³¨æ„åœ¨æ›´æ–°å­—ç¬¦ä¸²ä¸­çš„?ã€‚-[FMDatabase executeUpdate:] æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ã€‚SQLiteæ”¯æŒä½¿ç”¨å ä½ç¬¦?ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æŠŠæ­£çœŸçš„å€¼æ”¾å…¥å­—ç¬¦ä¸²ã€‚è¿™å„¿æœ‰ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼šå®ƒå¸®åŠ©å®ˆæŠ¤ç¨‹åºåå¯¹SQLæ’å…¥ã€‚å¦‚æœä½ éœ€è¦é¿å¼€æŸäº›å€¼ï¼Œå®ƒä¹Ÿä¸ºä½ çœäº†éº»çƒ¦ã€‚</p>

<p>æœ€åï¼Œåœ¨tagsNotesLookupè¡¨ä¸­ï¼Œæœ‰ä¸€ä¸ªnoteUniquelIDçš„ç´¢å¼•ï¼ˆç´¢å¼•æ˜¯SQLiteæ€§èƒ½çš„åˆä¸€ä¸ªå…³é”®ï¼‰ã€‚è¿™è¡Œä»£ç åœ¨æ¯æ¬¡å¯åŠ¨æ—¶éƒ½è°ƒç”¨ï¼š</p>

<pre><code>[self.database executeUpdate: 
    @"CREATE INDEX if not exists noteUniqueIDIndex on tagsNotesLookup (noteUniqueID);"]; 
</code></pre>

<p>æ•°æ®åº“è·å–
è¦è·å–å¯¹è±¡ï¼Œappè°ƒç”¨ï¼š</p>

<pre><code>-[VSDatabaseController runFetchForClass:(Class)databaseObjectClass  
                             fetchBlock:(VSDatabaseFetchBlock)fetchBlock  
                      fetchResultsBlock:(VSDatabaseFetchResultsBlock)fetchResultsBlock]; 
</code></pre>

<p>è¿™ä¸¤è¡Œä»£ç åšäº†å¤§éƒ¨åˆ†å·¥ä½œï¼š</p>

<pre><code>FMResultSet *resultSet = fetchBlock(self.database); 
NSArray *fetchedObjects = [self databaseObjectsWithResultSet:resultSet  
                                                       class:databaseObjectClass]; 
</code></pre>

<p>ç”¨FMDBæŸ¥æ‰¾æ•°æ®åº“è¿”å›ä¸€ä¸ªFMResultSet. é€šè¿‡resultSetä½ å¯ä»¥é€å¥å¾ªç¯ï¼Œåˆ›å»ºæ¨¡å‹å¯¹è±¡ã€‚</p>

<p>æˆ‘å»ºè®®å†™é€šç”¨çš„ä»£ç å»è½¬æ¢æ•°æ®åº“è¡Œåˆ°å¯¹è±¡ã€‚ä¸€ç§æˆ‘ä½¿ç”¨çš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªplistï¼Œæ˜ å°„columnåå­—åˆ°å¯¹è±¡å±æ€§ã€‚å®ƒä¹ŸåŒ…å«ç±»å‹ï¼Œæ‰€ä»¥ä½ çŸ¥é“æ˜¯å¦éœ€è¦è°ƒç”¨ -[FMResultSet dateForColumn:]ï¼Œ -[FMResultSet stringForColumn:]æˆ–å…¶ä»–ã€‚</p>

<p>åœ¨æˆ‘çš„æœ€æ–°åº”ç”¨é‡Œæˆ‘åšäº†äº›ç®€å•çš„äº‹æƒ…ã€‚æ•°æ®åº“è¡Œåˆšå¥½å¯¹åº”æ¨¡å‹å¯¹è±¡å±æ€§çš„åå­—ã€‚æ‰€æœ‰å±æ€§éƒ½æ˜¯stringsï¼Œé™¤äº†é‚£äº›åå­—ä»¥â€œDateâ€ç»“å°¾çš„å±æ€§ã€‚å¾ˆç®€å•ï¼Œä½†æ˜¯ä½ å¯ä»¥çœ‹åˆ°éœ€è¦ä¸€ä¸ªæ¸…æ™°çš„å¯¹åº”å…³ç³»ã€‚</p>

<p>å”¯ä¸€å¯¹è±¡
åˆ›å»ºæ¨¡å‹å¯¹è±¡å’Œä»æ•°æ®åº“è·å–æ•°æ®åœ¨åŒä¸€ä¸ªåå°çº¿ç¨‹ã€‚ä¸€è·å–åˆ°ï¼Œç¨‹åºä¼šæŠŠä»–ä»¬è½¬åˆ°ä¸»çº¿ç¨‹ã€‚</p>

<p>é€šå¸¸æˆ‘æœ‰uniquedå¯¹è±¡ã€‚åŒä¸€ä¸ªæ•°æ®åº“è¡Œç»“æœå§‹ç»ˆå¯¹åº”åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>

<p>ä¸ºäº†åšåˆ°å”¯ä¸€ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ç¼“å­˜ï¼Œä¸€ä¸ªNSMapTableï¼Œåœ¨initå‡½æ•°é‡Œï¼š_objectCache = [NSMapTable weakToWeakObjectsMapTable]ã€‚æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼š</p>

<p>ä¾‹å¦‚ï¼Œå½“ä½ åšä¸€ä¸ªæ•°æ®åº“è·å–å¹¶ä¸”æŠŠå¯¹è±¡è½¬äº¤ç»™ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨ï¼Œä½ å¸Œæœ›åœ¨è§†å›¾æ§åˆ¶å™¨ä½¿ç”¨å®Œè¿™äº›å¯¹è±¡åï¼Œæˆ–è€…ä¸€ä¸ªä¸ä¸€æ ·çš„è§†å›¾æ§åˆ¶å™¨æ˜¾ç¤ºäº†ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥æ¶ˆå¤±ã€‚</p>

<p>å¦‚æœä½ çš„å¯¹è±¡ç¼“å­˜æ˜¯ä¸€ä¸ªNSMutableDictionaryï¼Œä½ å°†éœ€è¦åšä¸€äº›é¢å¤–çš„å·¥ä½œæ¥æ¸…ç©ºç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚ç¡®å®šå®ƒå¯¹åº”çš„å¯¹è±¡åœ¨åˆ«çš„åœ°æ–¹æ˜¯å¦æœ‰å¼•ç”¨å°±å˜çš„å¾ˆç—›è‹¦ã€‚NSMapTableæ˜¯å¼±å¼•ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p>

<p>æ‰€ä»¥ï¼šæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­è®©å¯¹è±¡å”¯ä¸€ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å·²ç»åœ¨å¯¹è±¡ç¼“å­˜ä¸­å­˜åœ¨ï¼Œæˆ‘ä»¬å°±ç”¨é‚£ä¸ªå­˜åœ¨çš„å¯¹è±¡ã€‚ï¼ˆä¸»çº¿ç¨‹èƒœå‡ºï¼Œå› ä¸ºå®ƒå¯èƒ½æœ‰æ–°çš„æ”¹å˜ã€‚ï¼‰å¦‚æœå¯¹è±¡ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå®ƒä¼šè¢«åŠ ä¸Šã€‚</p>

<p>ä¿æŒå¯¹è±¡åœ¨å†…å­˜ä¸­
æœ‰å¾ˆå¤šæ¬¡ï¼ŒæŠŠæ•´ä¸ªå¯¹è±¡ç±»å‹ä¿ç•™åœ¨å†…å­˜ä¸­æ˜¯æœ‰é“ç†çš„ã€‚æˆ‘æœ€æ–°çš„appæœ‰ä¸€ä¸ªVSTagå¯¹è±¡ã€‚è™½ç„¶å¯èƒ½æœ‰æˆç™¾ä¸Šåƒä¸ªç¬”è®°ï¼Œä½†tagsçš„æ•°é‡å¾ˆå°ï¼ŒåŸºæœ¬å°‘äº10ã€‚ä¸€ä¸ªtagåªæœ‰6ä¸ªå±æ€§ï¼š3ä¸ªBOOLï¼Œä¸¤ä¸ªå¾ˆå°çš„NSstringï¼Œè¿˜æœ‰ä¸€ä¸ªNSDateã€‚</p>

<p>å¯åŠ¨çš„æ—¶å€™ï¼Œappè·å–æ‰€æœ‰tagså¹¶ä¸”æŠŠä»–ä»¬ä¿å­˜åœ¨ä¸¤ä¸ªå­—å…¸é‡Œï¼Œä¸€ä¸ªä¸»é”®æ˜¯tagçš„uniqueIDï¼Œå¦ä¸€ä¸ªä¸»é”®æ˜¯tagåå­—çš„å°å†™ã€‚</p>

<p>è¿™ç®€åŒ–äº†å¾ˆå¤šäº‹ï¼Œä¸åªæ˜¯tagè‡ªåŠ¨è¡¥å…¨ç³»ç»Ÿï¼Œè¿™ä¸ªå¯ä»¥å®Œå…¨åœ¨å†…å­˜ä¸­æ“ä½œï¼Œä¸éœ€è¦æ•°æ®åº“è·å–ã€‚</p>

<p>ä½†æ˜¯å¾ˆå¤šæ¬¡ï¼ŒæŠŠæ‰€æœ‰æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­æ˜¯ä¸å®é™…çš„ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸ä¼šåœ¨å†…å­˜ä¸­ä¿ç•™æ‰€æœ‰ç¬”è®°ã€‚</p>

<p>ä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šæ¬¡ï¼Œå½“ä¸èƒ½åœ¨å†…å­˜ä¸­ä¿ç•™å¯¹è±¡æ—¶ï¼Œä½ å¸Œæœ›åœ¨å†…å­˜ä¸­ä¿ç•™æ‰€æœ‰uniqueIDsã€‚ä½ ä¼šåƒè¿™æ ·åšä¸€ä¸ªè·å–ï¼š</p>

<pre><code>FMResultSet *resultSet = [self.database executeQuery:@"select uniqueID from some_table"]; 
</code></pre>

<p>resultSetåªåŒ…å«äº†uniqueIDsï¼Œ ä½ å¯ä»¥å­˜å‚¨åˆ°ä¸€ä¸ªNSMutableSeté‡Œã€‚</p>

<p>æˆ‘å‘ç°æœ‰æ—¶è¿™ä¸ªå¯¹web APIså¾ˆæœ‰ç”¨ã€‚æƒ³è±¡ä¸€ä¸ªAPIè°ƒç”¨è¿”å›ä»æŸä¸ªç¡®å®šçš„æ—¶é—´ä»¥åçš„ï¼Œå·²åˆ›å»ºç¬”è®°çš„uniqueIDsåˆ—è¡¨ã€‚å¦‚æœæˆ‘æœ¬åœ°å·²ç»æœ‰äº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç¬”è®°uniqueIDsçš„NSMutableSetï¼Œæˆ‘å¯ä»¥å¿«é€Ÿæ£€æŸ¥(é€šè¿‡ -[NSMutableSet minusSet])æ˜¯å¦æœ‰æ¼æ‰çš„ç¬”è®°ï¼Œç„¶åå»è°ƒç”¨å¦ä¸€ä¸ªAPIä¸‹è½½é‚£äº›æ¼æ‰çš„ç¬”è®°ã€‚è¿™äº›å®Œå…¨ä¸éœ€è¦è§¦åŠæ•°æ®åº“ã€‚</p>

<p>ä½†æ˜¯ï¼Œåƒè¿™æ ·çš„äº‹æƒ…åº”è¯¥å°å¿ƒå¤„ç†ã€‚appå¯ä»¥æä¾›è¶³å¤Ÿçš„å†…å­˜å—ï¼Ÿå®ƒçœŸçš„ç®€åŒ–ç¼–ç¨‹å¹¶ä¸”æé«˜æ€§èƒ½äº†å—ï¼Ÿ</p>

<p>ç”¨SQLiteå’ŒFMDBè€Œä¸æ˜¯Core Dataï¼Œç»™ä½ å¸¦æ¥å¤§é‡çš„çµæ´»æ€§å’Œèªæ˜è§£å†³åŠæ³•çš„ç©ºé—´ã€‚è®°ä½æœ‰çš„æ—¶å€™èªæ˜æ˜¯å¥½çš„ï¼Œä¹Ÿæœ‰çš„æ—¶å€™èªæ˜æ˜¯ä¸€ä¸ªå¤§é”™è¯¯ã€‚</p>

<p>Web APIs
æˆ‘çš„APIè°ƒç”¨åœ¨åå°è¿›ç¨‹ï¼ˆç»å¸¸ç”¨ä¸€ä¸ªNSOperationQueueï¼Œæ‰€ä»¥æˆ‘å¯ä»¥å–æ¶ˆæ“ä½œï¼‰ã€‚æ¨¡å‹å¯¹è±¡åªåœ¨ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯æˆ‘è¿˜ä¼ é€’æ¨¡å‹å¯¹è±¡ç»™æˆ‘çš„APIè°ƒç”¨ã€‚</p>

<p>æ˜¯è¿™æ ·çš„ï¼šä¸€ä¸ªæ•°æ®åº“å¯¹è±¡æœ‰ä¸€ä¸ªdetachedCopyæ–¹æ³•ï¼Œå¯ä»¥å¤åˆ¶æ•°æ®åº“å¯¹è±¡ã€‚è¿™ä¸ªå¤åˆ¶å¯¹è±¡ä¸æ˜¯å¼•ç”¨è‡ªæˆ‘ç”¨æ¥å”¯ä¸€åŒ–çš„å¯¹è±¡ç¼“å­˜ã€‚å”¯ä¸€å¼•ç”¨é‚£ä¸ªå¯¹è±¡çš„åœ°æ–¹æ˜¯APIè°ƒç”¨ï¼Œå½“APIè°ƒç”¨ç»“æŸï¼Œé‚£ä¸ªå¤åˆ¶çš„å¯¹è±¡å°±æ¶ˆå¤±äº†ã€‚</p>

<p>è¿™æ˜¯ä¸€ä¸ªå¥½çš„ç³»ç»Ÿï¼Œå› ä¸ºå®ƒæ„å‘³ç€æˆ‘å¯ä»¥åœ¨APIè°ƒç”¨é‡Œä½¿ç”¨æ¨¡å‹å¯¹è±¡ã€‚æ–¹æ³•çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>

<pre><code>- (void)uploadNote:(VSNote *)note { 
    VSNoteAPICall *apiCall = [[VSNoteAPICall alloc] initWithNote:[note detachedCopy]]; 
    [self enqueueAPICall:apiCall]; 
} 
</code></pre>

<p>VSNoteAPICallä»å¤åˆ¶çš„VSNoteè·å–å€¼ï¼Œå¹¶ä¸”åˆ›å»ºHTTPè¯·æ±‚ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—å…¸æˆ–å…¶ä»–ç¬”è®°çš„è¡¨ç°å½¢å¼ã€‚</p>

<p>å¤„ç†Web APIè¿”å›å€¼
æˆ‘å¯¹webè¿”å›å€¼åšäº†ä¸€äº›ç±»ä¼¼çš„äº‹æƒ…ã€‚æˆ‘ä¼šå¯¹è¿”å›çš„JSONæˆ–è€…XMLåˆ›å»ºä¸€ä¸ªæ¨¡å‹å¯¹è±¡ï¼Œè¿™ä¸ªæ¨¡å‹å¯¹è±¡ä¹Ÿæ˜¯åˆ†ç¦»çš„ã€‚å®ƒä¸æ˜¯å­˜å‚¨åœ¨ä¸ºäº†å”¯ä¸€æ€§çš„æ¨¡å‹ç¼“å­˜é‡Œã€‚</p>

<p>è¿™å„¿æœ‰äº›äº‹æƒ…æ˜¯ä¸ç¡®å®šçš„ã€‚æœ‰æ—¶æœ‰å¿…è¦ç”¨é‚£ä¸ªæ¨¡å‹å¯¹è±¡åœ¨ä¸¤ä¸ªåœ°æ–¹åšæœ¬åœ°ä¿®æ”¹ï¼šåœ¨å†…å­˜ç¼“å­˜å’Œæ•°æ®åº“ã€‚</p>

<p>æ•°æ®åº“é€šå¸¸æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚æ¯”å¦‚ï¼šæˆ‘çš„åº”ç”¨å·²ç»æœ‰ä¸€ä¸ªæ–¹æ³•æ¥ä¿å­˜ç¬”è®°å¯¹è±¡ã€‚å®ƒç”¨ä¸€ä¸ªSQL insertæˆ–è€…replaceå­—ç¬¦ä¸²ã€‚æˆ‘åªéœ€è°ƒç”¨é‚£ä¸ªä»web APIè¿”å›å€¼ç”Ÿæˆçš„ç¬”è®°å¯¹è±¡ï¼Œæ•°æ®åº“å°±ä¼šæ›´æ–°ã€‚</p>

<p>ä½†æ˜¯å¯èƒ½é‚£ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„ç‰ˆæœ¬ï¼Œå¹¸è¿çš„æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“æ‰¾åˆ°ï¼š</p>

<pre><code>VSNote *cachedNote = [self.mapTable objectForKey:downloadedNote.uniqueID]; 
</code></pre>

<p>å¦‚æœcachedNoteå­˜åœ¨ï¼Œæˆ‘ä¼šè®©å®ƒä»downloadedNoteä¸­è·å–å€¼ï¼Œè€Œä¸æ˜¯æ›¿æ¢å®ƒï¼ˆè¿™æ ·å¯èƒ½è¿åå”¯ä¸€æ€§ï¼‰ã€‚è¿™å¯ä»¥å…±äº«detachedCopyæ–¹æ³•çš„ä»£ç ã€‚</p>

<p>ä¸€æ—¦cachedNoteæ›´æ–°äº†ï¼Œè§‚å¯Ÿè€…ä¼šé€šè¿‡KVOé€šçŸ¥ç¬”è®°ï¼Œæˆ–è€…æˆ‘ä¼šå‘é€ä¸€ä¸ªNSNotificationï¼Œæˆ–è€…ä¸¤è€…éƒ½åšã€‚</p>

<p>Web APIè°ƒç”¨ä¹Ÿä¼šè¿”å›ä¸€äº›å…¶ä»–å€¼ã€‚æˆ‘æåˆ°è¿‡RSSé˜…è¯»å™¨å¯èƒ½è·å¾—ä¸€ä¸ªå·²è¯»æ¡ç›®çš„å¤§åˆ—è¡¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ç”¨é‚£ä¸ªåˆ—è¡¨åˆ›å»ºäº†ä¸€ä¸ªNSSetï¼Œåœ¨å†…å­˜ä¸­æ›´æ–°æ¯ä¸€ä¸ªç¼“å­˜æ–‡ç« çš„readå±æ€§ï¼Œç„¶åè°ƒç”¨-[FMDatabase executeUpdate:]ã€‚</p>

<p>è®©å®ƒå·¥ä½œå¿«é€Ÿçš„å…³é”®æ˜¯NSMapTableçš„æŸ¥æ‰¾æ˜¯å¿«é€Ÿçš„ã€‚å¦‚æœä½ æ‰¾çš„å¯¹è±¡åœ¨ä¸€ä¸ªNSArrayé‡Œï¼Œæˆ‘ä»¬è¯¥é‡æ–°è€ƒè™‘ã€‚</p>

<p>æ•°æ®åº“è¿ç§»
Core Dataçš„æ•°æ®åº“è¿ç§»å¾ˆé…·ï¼Œå½“å®ƒå¯è¡Œçš„æ—¶å€™ã€‚ä½†æ˜¯ä¸å¯é¿å…çš„ï¼Œå®ƒæ˜¯ä»£ç å’Œæ•°æ®åº“ä¸­çš„ä¸€å±‚ã€‚å¦‚æœä½ è¶Šç›´æ¥ä½¿ç”¨SQLiteï¼Œä½ æ›´æ–°æ•°æ®åº“è¶Šç›´æ¥ã€‚ä½ å¯ä»¥å®‰å…¨å®¹æ˜“çš„åšåˆ°è¿™ç‚¹ã€‚</p>

<p>æ¯”å¦‚åŠ ä¸€ä¸ªè¡¨ï¼š</p>

<pre><code>[self.database executeUpdate:@"CREATE TABLE if not exists tags " 
    "(uniqueID TEXT UNIQUE, name TEXT, deleted INTEGER, deletedModificationDate DATE);"]; 
</code></pre>

<p>æˆ–è€…åŠ ä¸€ä¸ªç´¢å¼•ï¼š</p>

<pre><code>[self.database executeUpdate:@"CREATE INDEX if not exists " 
    "archivedSortDateIndex on notes (archived, sortDate);"]; 
</code></pre>

<p>æˆ–è€…åŠ ä¸€åˆ—ï¼š</p>

<pre><code>[self.database executeUpdate:@"ALTER TABLE tags ADD deletedDate DATE"]; 
</code></pre>

<p>åº”ç”¨åº”è¯¥åœ¨ä»£ç çš„ç¬¬ä¸€ä¸ªåœ°æ–¹ç”¨ä¸Šé¢è¿™äº›ä»£ç è®¾ç½®æ•°æ®åº“ã€‚ä»¥åçš„æ”¹å˜åªéœ€åŠ executeUpdateçš„è°ƒç”¨ â€” æˆ‘è®©ä»–ä»¬æŒ‰é¡ºåºæ‰§è¡Œã€‚å› ä¸ºæˆ‘çš„æ•°æ®åº“æ˜¯æˆ‘è®¾è®¡çš„ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆæˆ‘ä»æ²¡ç¢°åˆ°æ€§èƒ½é—®é¢˜ï¼Œå®ƒå¾ˆå¿«ï¼‰ã€‚</p>

<p>å½“ç„¶å¤§çš„æ”¹å˜éœ€è¦æ›´å¤šä»£ç ã€‚å¦‚æœä½ çš„æ•°æ®é€šè¿‡webè·å–ï¼Œæœ‰æ—¶ä½ å¯ä»¥ä»ä¸€ä¸ªæ–°æ•°æ®åº“æ¨¡å‹å¼€å§‹ï¼Œé‡æ–°ä¸‹è½½ä½ éœ€è¦çš„æ•°æ®ã€‚</p>

<p>æ€§èƒ½æŠ€å·§
SQLiteå¯ä»¥éå¸¸éå¸¸å¿«ï¼Œå®ƒä¹Ÿå¯ä»¥éå¸¸æ…¢ã€‚å®Œå…¨å–å†³äºä½ æ€ä¹ˆä½¿ç”¨å®ƒã€‚</p>

<p>äº‹åŠ¡
æŠŠæ›´æ–°åŒ…è£…åœ¨äº‹åŠ¡é‡Œã€‚åœ¨æ›´æ–°å‰è°ƒç”¨ -[FMDatabase beginTransaction] ï¼Œæ›´æ–°åè°ƒç”¨-[FMDatabase commit]ã€‚</p>

<p>å¦‚æœä½ ä¸å¾—ä¸åè§„èŒƒåŒ–ï¼ˆ Denormalizeï¼‰
åè§„èŒƒåŒ–è®©äººå¾ˆä¸çˆ½ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ï¼Œä¸ºäº†åŠ é€Ÿæ£€ç´¢è€Œæ·»åŠ å†—ä½™æ•°æ®ï¼Œä½†æ˜¯å®ƒæ„å‘³ç€ä½ éœ€è¦ç»´æŠ¤å†—ä½™æ•°æ®ã€‚</p>

<p>æˆ‘æ€»æ˜¯ç–¯ç‹‚é¿å…å®ƒï¼Œç›´åˆ°è¿™æ ·èƒ½æœ‰ä¸¥é‡çš„æ€§èƒ½åŒºåˆ«ã€‚ç„¶åæˆ‘ä¼šå°½å¯èƒ½å°‘å¾—è¿™ä¹ˆåšã€‚</p>

<p>ä½¿ç”¨ç´¢å¼•
æˆ‘çš„åº”ç”¨ä¸­tagsè¡¨çš„åˆ›å»ºè¯­å¥åƒè¿™æ ·ï¼š</p>

<pre><code>CREATE TABLE if not exists tags  
  (uniqueID TEXT UNIQUE, name TEXT, deleted INTEGER, deletedModificationDate DATE); 
</code></pre>

<p>uniqueIDåˆ—æ˜¯è‡ªåŠ¨ç´¢å¼•çš„ï¼Œå› ä¸ºå®ƒå®šä¹‰ä¸ºuniqueã€‚ä½†æ˜¯å¦‚æœæˆ‘æƒ³ç”¨nameæ¥æŸ¥è¯¢è¡¨ï¼Œæˆ‘å¯èƒ½ä¼šåœ¨nameä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œåƒè¿™æ ·ï¼š</p>

<pre><code>CREATE INDEX if not exists tagNameIndex on tags (name); 
</code></pre>

<p>ä½ å¯ä»¥ä¸€æ¬¡æ€§åœ¨å¤šåˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œåƒè¿™æ ·ï¼š</p>

<pre><code>CREATE INDEX if not exists archivedSortDateIndex on notes (archived, sortDate); 
</code></pre>

<p>ä½†æ˜¯æ³¨æ„å¤ªå¤šç´¢å¼•ä¼šé™ä½ä½ çš„æ’å…¥é€Ÿåº¦ã€‚ä½ åªéœ€è¦è¶³å¤Ÿæ•°é‡å¹¶ä¸”æ˜¯å¯¹çš„é‚£äº›ã€‚</p>

<p>ä½¿ç”¨å‘½ä»¤è¡Œåº”ç”¨
å½“æˆ‘çš„appåœ¨æ¨¡æ‹Ÿå™¨é‡Œè¿è¡Œæ—¶ï¼Œæˆ‘ä¼šæ‰“å°æ•°æ®åº“çš„è·¯å¾„ã€‚æˆ‘å¯ä»¥é€šè¿‡sqlite3çš„å‘½ä»¤è¡Œæ¥æ‰“å¼€æ•°æ®åº“ã€‚ï¼ˆé€šè¿‡man sqlite3å‘½ä»¤æ¥äº†è§£è¿™ä¸ªåº”ç”¨çš„æ›´å¤šä¿¡æ¯ï¼‰ã€‚</p>

<p>æ‰“å¼€æ•°æ®åº“çš„å‘½ä»¤ï¼šsqlite3 â€œæ•°æ®åº“çš„è·¯å¾„â€ã€‚</p>

<p>æ‰“å¼€ä»¥åï¼Œä½ å¯ä»¥çœ‹schema: type .schemaã€‚</p>

<p>ä½ å¯ä»¥æ›´æ–°å’ŒæŸ¥è¯¢ï¼Œè¿™æ˜¯åœ¨ä½¿ç”¨ä½ çš„appä¹‹å‰æ£€æŸ¥SQLæ˜¯å¦æ­£ç¡®çš„å¾ˆå¥½çš„æ–¹å¼ã€‚</p>

<p>è¿™é‡Œé¢æœ€é…·çš„ä¸€éƒ¨åˆ†æ˜¯ï¼ŒSQLite Explain Query Planå‘½ä»¤ï¼Œä½ ä¼šå¸Œæœ›ç¡®ä¿ä½ çš„è¯­å¥æ‰§è¡Œçš„å°½å¯èƒ½å¿«ã€‚</p>

<p>çœŸå®çš„ä¾‹å­
æˆ‘çš„åº”ç”¨æ˜¾ç¤ºæ‰€æœ‰æ²¡æœ‰å½’æ¡£ç¬”è®°çš„æ ‡ç­¾åˆ—è¡¨ã€‚æ¯å½“ç¬”è®°æˆ–è€…æ ‡ç­¾æœ‰å˜åŒ–ï¼Œè¿™ä¸ªæŸ¥è¯¢å°±ä¼šé‡æ–°æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å®ƒéœ€è¦å¾ˆå¿«ã€‚</p>

<p>æˆ‘å¯ä»¥ç”¨SQL joinæ¥æŸ¥è¯¢ï¼Œä½†æ˜¯å¾ˆæ…¢ï¼ˆjoinséƒ½å¾ˆæ…¢ï¼‰ã€‚</p>

<p>æ‰€ä»¥æˆ‘æ”¾å¼ƒsqlite3å¹¶å¼€å§‹å°è¯•åˆ«çš„æ–¹æ³•ã€‚æˆ‘åˆçœ‹äº†ä¸€æ¬¡æˆ‘çš„schemaï¼Œæ„è¯†åˆ°æˆ‘å¯ä»¥åè§„èŒƒåŒ–ã€‚ä¸€ä¸ªç¬”è®°çš„å½’æ¡£çŠ¶æ€å¯ä»¥å­˜å‚¨åœ¨notesè¡¨é‡Œï¼Œå®ƒä¹Ÿå¯ä»¥å­˜å‚¨åœ¨tagsNotesLookupè¡¨ã€‚</p>

<p>ç„¶åæˆ‘å¯ä»¥æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼š</p>

<pre><code>select distinct tagUniqueID from tagsNotesLookup where archived=0; 
</code></pre>

<p>æˆ‘å·²ç»æœ‰äº†ä¸€ä¸ªåœ¨tagUniqueIDä¸Šçš„ç´¢å¼•ã€‚æ‰€ä»¥æˆ‘ç”¨explain query planæ¥å‘Šè¯‰æˆ‘å½“æˆ‘æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>

<pre><code>sqlite&gt; explain query plan select distinct tagUniqueID from tagsNotesLookup where archived=0; 
0|0|0|SCAN TABLE tagsNotesLookup USING INDEX tagUniqueIDIndex (~100000 rows) 
</code></pre>

<p>å®ƒç”¨äº†ä¸€ä¸ªç´¢å¼•ï¼Œä½†æ˜¯SCAN TABLEå¬èµ·æ¥ä¸å¤ªå¥½ï¼Œæœ€å¥½æ˜¯ä¸€ä¸ªSEARCH TABLEå¹¶ä¸”è¦†ç›–ä¸€ä¸ªç´¢å¼•ã€‚
æˆ‘åœ¨tagUniqueIDå’Œarchiveä¸Šå»ºäº†ç´¢å¼•ï¼š</p>

<pre><code>CREATE INDEX archivedTagUniqueID on tagsNotesLookup(archived, tagUniqueID); 
</code></pre>

<p>å†æ¬¡æ‰§è¡Œexplain query plan:</p>

<pre><code>sqlite&gt; explain query plan select distinct tagUniqueID from tagsNotesLookup where archived=0; 
0|0|0|SEARCH TABLE tagsNotesLookup USING COVERING INDEX archivedTagUniqueID (archived=?) (~10 rows) 
</code></pre>

<p>å¥½å¤šäº†ã€‚</p>

<p>æ›´å¤šæ€§èƒ½æç¤º
FMDBçš„æŸå¤„åŠ äº†ç¼“å­˜statementsçš„èƒ½åŠ›ï¼Œæ‰€ä»¥å½“åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“çš„æ—¶å€™ï¼Œæˆ‘æ€»æ˜¯è°ƒç”¨[self.database setShouldCacheStatements:YES] ã€‚è¿™æ„å‘³ç€å¯¹æ¯ä¸ªè°ƒç”¨ä½ ä¸éœ€è¦å†æ¬¡ç¼–è¯‘æ¯ä¸ªstatementã€‚</p>

<p>æˆ‘ä»æ¥æ²¡æœ‰æ‰¾åˆ°ä½¿ç”¨vacuumçš„å¥½çš„æŒ‡å¼•ï¼Œå¦‚æœæ•°æ®åº“æ²¡æœ‰å®šæœŸå‹ç¼©ï¼Œå®ƒä¼šè¶Šæ¥è¶Šæ…¢ã€‚æˆ‘çš„åº”ç”¨ä¼šè·‘ä¸€ä¸ªvacuumï¼Œä½†åªæ˜¯æ¯å‘¨ä¸€æ¬¡ï¼ˆå®ƒåœ¨NSUserDefaultsé‡Œå­˜å‚¨ä¸Šæ¬¡vacuumçš„æ—¶é—´ï¼Œç„¶ååœ¨å¼€å§‹çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦è¿‡äº†ä¸€å‘¨ï¼‰ã€‚</p>

<p>å¦‚æœèƒ½auto_vacuumé‚£æ›´å¥½ï¼Œçœ‹pragma statements supported by SQLiteåˆ—è¡¨ã€‚</p>

<p>å…¶ä»–é…·çš„ä¸œè¥¿
Gus Muellerè®©æˆ‘æ¶‰åŠè‡ªå®šä¹‰SQLiteæ–¹æ³•çš„å†…å®¹ã€‚æˆ‘å¹¶æ²¡æœ‰çœŸçš„ä½¿ç”¨è¿™äº›ä¸œè¥¿ï¼Œæ—¢ç„¶ä»–æŒ‡å‡ºäº†ï¼Œæˆ‘å¯ä»¥æ”¾å¿ƒçš„è¯´æˆ‘èƒ½æ‰¾åˆ°å®ƒçš„ç”¨å¤„ã€‚å› ä¸ºå®ƒå¾ˆé…·ã€‚</p>

<p>åœ¨Gusçš„å¸–å­é‡Œï¼Œæœ‰ä¸€ä¸ªæŸ¥è¯¢æ˜¯è¿™æ ·çš„ï¼š</p>

<pre><code>select displayName, key from items where UTTypeConformsTo(uti, ?) order by 2; 
</code></pre>

<p>SQLiteå®Œå…¨ä¸çŸ¥é“UITypesã€‚ä½†æ˜¯ä½ å¯ä»¥åŠ æ ¸å¿ƒæ–¹æ³•ï¼ŒæŸ¥çœ‹-[FMDatabase makeFunctionNamed:maximumArguments:withBlock:]ã€‚</p>

<p>ä½ å¯ä»¥æ‰§è¡Œä¸€ä¸ªå¤§çš„æŸ¥è¯¢æ¥æ›¿ä»£ï¼Œç„¶åè¯„ä¼°æ¯ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯é‚£éœ€è¦æ›´å¤šå·¥ä½œã€‚æœ€å¥½åœ¨SQLçº§å°±è¿‡æ»¤ï¼Œè€Œä¸æ˜¯åœ¨å°†è¡¨æ ¼è¡Œè½¬ä¸ºå¯¹è±¡ä»¥åã€‚</p>

<p>æœ€å
ä½ çœŸçš„åº”è¯¥ä½¿ç”¨Core Dataï¼Œæˆ‘ä¸æ˜¯åœ¨å¼€ç©ç¬‘ã€‚</p>

<p>æˆ‘ç”¨SQLiteå’ŒFMDBä¸€æ®µæ—¶é—´äº†ï¼Œæˆ‘å¯¹å¤šå¾—çš„å¥½å¤„æ„Ÿåˆ°å¾ˆå…´å¥‹ï¼Œä¹Ÿå¾—åˆ°éåŒä¸€èˆ¬çš„æ€§èƒ½ã€‚ä½†æ˜¯è®°ä½æœºå™¨åœ¨å˜å¿«ï¼Œå…¶ä»–çœ‹ä½ ä»£ç çš„äººæœŸæœ›çœ‹åˆ°ä»–å·²ç»çŸ¥é“çš„Core Data, å¦ä¸€äº›ä¸æ‰“ç®—çœ‹ä½ çš„æ•°æ®åº“ä»£ç ã€‚æ‰€ä»¥è¯·æŠŠè¿™æ•´ç¯‡æ–‡ç« çœ‹åšä¸€ä¸ªç–¯å­çš„å«å–Šï¼Œå…³äºä»–ä¸ºè‡ªå·±å»ºç«‹çš„ç»†èŠ‚çš„ç–¯ç‹‚çš„ä¸–ç•Œï¼Œå¹¶æŠŠè‡ªå·±é”åœ¨é‡Œé¢ã€‚</p>

<p>è¯·äº«å—äº†ä¸èµ·çš„Core Dataçš„æ–‡ç« ï¼ˆæœ‰ç‚¹éš¾è¿‡çš„æ‘‡å¤´ï¼‰ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œåœ¨æŸ¥å®ŒGusæŒ‡å‡ºçš„è‡ªå®šä¹‰SQLiteæ–¹æ³•ç‰¹æ€§åï¼Œæˆ‘ä¼šç ”ç©¶SQLiteçš„full-text search extension. æ€»æœ‰æ›´å¤šçš„å†…å®¹éœ€è¦å»å­¦ä¹ ã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Realm çˆ†èŠ CoreData]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/05/ycoredatayurealm/"/>
    <updated>2016-07-05T04:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/05/ycoredatayurealm</id>
    <content type="html"><![CDATA[<p>æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­ã€‚æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨ï¼Œä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–ä½¿ç”¨ï¼Œè¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥ï¼Œè°¢è°¢æ‚¨çš„ç†è§£åˆä½œã€‚å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™ï¼Œè¿™æ ·æ‚¨å°†èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è·å–æœ¬ç«™ä¿¡æ¯ã€‚
ç¢ç¢å¿µ</p>

<p>OhMyStar 2 ä¹Ÿè¿›è¡Œäº†ä¸€æ®µæ—¶æ—¥ï¼Œæˆ‘æŠŠæŒä¹…åŒ–çš„æ–¹å¼ä»CoreData æ¢åˆ°äº† Realmã€‚æœ‰äº›æ„Ÿæ‚Ÿï¼Œé¡ºæ‰‹å°±è®°å½•ä¸€ä¸‹å§ã€‚ä»¥ä¸‹è¯„è®ºéƒ½æ˜¯è‡ªå·±å¾ˆä¸»è§‚çš„æ„Ÿå—ï¼Œæ— å®é™…æµ‹è¯•æ•°æ®æ”¯æŒã€‚
è®º iOS çš„æŒä¹…åŒ–</p>

<!--more-->


<p>iOS æŒä¹…åŒ–å…¶å®ä¹Ÿæ²¡å¤šå°‘é€‰æ‹©ï¼Œ é«˜ç«¯ä¸€ç‚¹CoreDataã€Realmã€FMDBã€KVç±»(LevelDBç­‰)ã€‚ä½ç«¯ä¸€äº›ç›´æ¥ä¸€ä¸ª NSArray å°±å†™æˆ Plist ä¹Ÿèƒ½æŒä¹…åŒ–ä¸‹æ¥ã€‚</p>

<p>åœ¨ç½‘ç»œç¯å¢ƒè¶Šæ¥è¶Šå¿«çš„å½“ä¸‹å’Œå¤§éƒ¨åˆ†åº”ç”¨æ•°æ®éƒ½å¯èƒ½æ˜¯ç½‘ç»œåº”ç”¨ï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œå…¶å®æç«¯ä¸€ç‚¹å°±åªç”¨å†™åˆ° JSON è½¬ Object å°±å¥½äº†ã€‚è€Œä¸”ä¸€å †è¿™æ ·å¥½ç”¨çš„å°è£…ï¼Œè¿œæœ‰Mantle è¿‘æœ‰YYModelã€‚</p>

<p>æ‰€ä»¥éœ€è¦æŒä¹…åŒ–çš„æ—¶å€™ï¼Œæˆ‘è§‰çš„å¯ä»¥æ…é‡çš„è¯„ä¼°ä¸€ä¸‹éœ€æ±‚ã€‚æƒ³æ˜ç™½äº†ï¼Œåé¢å¯ä»¥èŠ‚çœå¾ˆå¤šäº‹æƒ…ã€‚</p>

<p>æœ¬æ–‡ç« ä¸»è¦å¯¹æ¯” Realm å’Œ CoreDataï¼Œå…¶ä»–çš„å°±ä¸æ¶‰åŠäº†ã€‚</p>

<p>Realm
ä¼˜ç‚¹
å…¥é—¨é—¨æ§›ä½</p>

<p>Realmæ–‡æ¡£å°±ç®—ä¸€ä¸ªå­—ä¸€ä¸ªå­—æ‰£ç€è¯»å®Œï¼Œä¸€ä¸ªä¸‹åˆå°±è¶³å¤Ÿäº†ã€‚è€Œä¸”è¿˜æœ‰ä¸­æ–‡ç‰ˆæœ¬ï¼Œä¸è¦å¤ªå‹å¥½å“¦ï¼Œæœ‰ç‚¹ä¸ä¹ æƒ¯è¯¶ã€‚</p>

<p>æ–‡æ¡£è¦†ç›–äº†80%çš„ä½¿ç”¨æƒ…å†µï¼Œç”šè‡³æœ‰äº›å¤ªç®€é™‹çš„å«Œç–‘ã€‚ä½†ä¸ç®¡æ€ä¹ˆæ ·ï¼Œè¿™ç§å…¥é—¨æ¡ä»¶æ¯”èµ· CoreData å†™äº†ä¸‰ä¸ªæœˆéƒ½æ²¡ææ¸…æ¥š Context è¦å¥½çš„å¤šã€‚</p>

<p>åœ¨åº“çš„å·¥å…·é“¾ä¸Šï¼Œå®‰è£…ä¸€ä¸ª Realm Browser ä»¥åå°±ä¸éœ€è¦å…¶ä»–è¾…åŠ©äº†ã€‚è¿˜æ˜¯ç®€å•ã€‚</p>

<p>å‡ ä¹åšåˆ°äº†ä¸Šæ‰‹å³ç”¨çš„ç¨‹åº¦ã€‚äº”æ˜Ÿå¥½è¯„ã€‚</p>

<p>PSï¼šæˆ‘ç”¨äº†ä¸€ä¸ªé€šå®µæŠŠ OhMyStar 2 çš„æŒä¹…åŒ–ä» CoreData æ¢åˆ°äº† Realm ï¼Œä¼˜åŒ–è°ƒæ•´äº†å¤§æ¦‚5å¤©å·¦å³è¾¾åˆ°å‹‰å¼ºå¯ä»¥ç”¨çš„æƒ…å†µ ã€‚åœ¨è¿™ä¹‹å‰å¹¶æ²¡æœ‰ä»»ä½• Realm çš„ç»éªŒã€‚
æ®è¯´æ€§èƒ½å¥½ä¸€äº›</p>

<p>Realmå®˜æ–¹ä»‹ç»Fastä¸€æ®µä¸­</p>

<p>Counts</p>

<p><img src="http://al1020119.github.io/images/benchmarks.001b.png" title="Caption" ></p>

<p>Queries</p>

<p><img src="http://al1020119.github.io/images/benchmarks.002b.png" title="Caption" ></p>

<p>Inserts</p>

<p><img src="http://al1020119.github.io/images/benchmarks.003b.png" title="Caption" ></p>

<p>åœ¨å†™è¿™é‡Œçš„æ—¶å€™æˆ‘é¡ºæ‰‹Googleäº†ä¸€ä¸‹ å‘ç°ä¸€ç¯‡Core Data, FMDB, Realm æ€§èƒ½æµ‹è¯•ã€‚æˆ‘å°±å¤šè¯´å‡ å¥</p>

<p>æ€»è§‰å¾—å¤§å®¶å¯¹ CoreData è¯¯ä¼šè›®æ·±ï¼Œä»£ç  Fork çœ‹äº†ä¸€ä¸‹ï¼Œ æ€»è§‰å¾—ä¸åº”è¯¥è¿™æ ·å†™æ¥æ¯”æ€§èƒ½çš„ï¼Œä½†æ˜¯ä¸€æ—¶åŠä¼šä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ”¹ã€‚æˆ‘åªèƒ½è¯´æˆ‘åœ¨ä¼˜åŒ– CoreData çš„æ—¶å€™æ ¹æ® WWDC ä¸Šæ•™çš„è¿˜æ˜¯æå‡å¾ˆé«˜ï¼Œå¦å¤–ä¸€ä¸ªäº‹æƒ…æ˜¯ CoreData ä¸€èˆ¬éƒ½ç”¨ Sqlite åšåç«¯ã€‚æ‰€ä»¥å¦‚æœä½ çš„æŸ¥è¯¢æ˜¯ç»è¿‡ä¼˜åŒ–çš„ï¼Œç¡®è®¤æ‰“å‡ºæ¥çš„SQLè¯­å¥ç§‘å­¦ä»¥åï¼ŒSqlite(CoreData) è·Ÿ Sqlite(FMDB)æˆ‘è§‰å¾—æ€§èƒ½å°±ç®—æœ‰å·®è·ï¼Œè¿™å·®è·æ²¡æœ‰èƒ½å¤§åˆ°é€‰æ‹©æ–¹æ¡ˆçš„å†³å®šæ€§å› ç´ ã€‚å¦‚æœä½¿ç”¨ CoreData é‡åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œä½ åº”è¯¥ä»”ç»†çš„ç ”ç©¶ WWDC å’Œå‡ ç¯‡å¾ˆå¥½çš„æ–‡ç« ã€‚ç¡®ä¿ä½ çš„ CoreData ä½¿ç”¨æ–¹å¼æ˜¯æ­£ç¡®ç§‘å­¦çš„ã€‚
æ²¡æœ‰éœ€è¦æ¶æ„Contexté‚£ç§çƒ¦äººçš„ä¸œè¥¿</p>

<p>åº”è¯¥ä¹Ÿç®—Realmç®€å•çš„ä¸€ä¸ªæ–¹é¢ï¼ŒRealm åªè¦ä¿æŒè‡ªå·±çº¿ç¨‹é‡Œé¢ï¼Œè‡ªå·±çš„ Realm Store æ“ä½œæ˜¯æ­£ç¡®çš„å³å¯ã€‚å¦‚æœæ˜¯ CoreDataï¼Œæ€ä¹ˆæ¶æ„ä¸€ä¸ªç§‘å­¦çš„ Context Stack å°±è¶³å¤Ÿè®©æˆ‘å¤´ç–¼ä¸€æ•´ï¼ŒiOS è¿˜å¥½ï¼Œç•Œé¢æ˜¯ä¸€ä¸ªæ¥ç€ä¸€ä¸ª(VCè·ŸVCä¹‹é—´çš„å±‚çº§å…³ç³»å¾ˆæ¸…æ™°)ã€‚è€Œ OhMyStar 2 è¿™ç§ OS X æ¡Œé¢åº”ç”¨åœºæ™¯VCä¹‹é—´å¾ˆå¤æ‚ï¼Œçº¿ç¨‹ä¹‹é—´Contextçš„å…³ç³»è®©å‡ºç°å¾ˆå¤šé—®é¢˜ã€‚
æ”¯æŒ NSPredicate</p>

<p>ä» CoreData è½¬è¿‡æ¥å¹¶æ²¡æœ‰å¤ªå¤šçš„ä¸é€‚åº”
å¾ˆç®€å•çš„ä½¿ç”¨å¤šä¸ªå­˜å‚¨æ–‡ä»¶</p>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¤šç”¨æˆ·ç™»é™†æƒ…å†µä¸‹ã€‚ç”¨æˆ·æ˜¯å•ç‹¬çš„å­˜å‚¨æ–‡ä»¶ï¼Œå’Œå…¨éƒ¨ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªå­˜å‚¨æ–‡ä»¶ã€‚åè€…éœ€è¦æ¯æ¡ç”¨æˆ·æ•°æ®éƒ½è¦å…³è”ä¸€æ¬¡å½“å‰ç”¨æˆ·ï¼Œæ‰€æœ‰æŸ¥è¯¢ç”¨æˆ·æ•°æ®çš„æ—¶å€™ï¼Œä½ éƒ½å¿…é¡»åŠ ä¸Šå½“å‰ç”¨æˆ·çš„æŸ¥è¯¢é¡¹ã€‚è€Œä½¿ç”¨æ¯ä¸ªç”¨æˆ·å•ç‹¬ä¸€ä¸ªæ•°æ®æ–‡ä»¶çš„æ—¶å€™ï¼Œæ•´ä¸ªå­˜å‚¨ç»“æ„ä¼šæ¸…çˆ½å¾ˆå¤šã€‚
æŠ€æœ¯æ”¯æŒ</p>

<p>è‡³å°‘å®åœ¨æ²¡æ³•çš„æ—¶å€™è¿˜å¯ä»¥å»å¾®åšä¸Šåæ§½ä»–ä»¬ï¼Œä»–ä»¬å…¶å®ä¹Ÿæœ‰æå¤§çš„çƒ­æƒ…æ¥è§£å†³ä½ é‡åˆ°çš„é—®é¢˜ã€‚CoreData è¿™ç§é‡åˆ°é—®é¢˜å°±åªèƒ½è‡ªå·±é»˜é»˜çš„åä¸‹ã€‚
ç¼ºç‚¹
å…³è”å…³ç³»å¼±çš„ä¸€é€¼</p>

<p>ç®€å•è¯´æ¥å°±æ˜¯å¯¹è±¡è·Ÿå¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»å’Œå¤šå¯¹å¤šå…³ç³»ã€‚å¹¶ä¸èƒ½æ˜ å°„ï¼Œéœ€è¦åœ¨åŒæ–¹é‡Œé¢éƒ½å†™ä¸Šå±æ€§ï¼Œæ­¤å¤–è¿˜éœ€è¦åœ¨è®¾ç½®çš„æ—¶å€™ä¸¤è¾¹åŒæ—¶è®¾ç½®ã€‚æŸ¥è¯¢æ—¶å€™ä¹Ÿæ˜¯ NSPredicate ä¹Ÿä»…ä»…åªæ”¯æŒä¸€äº›ä¸€å±‚çš„æŸ¥è¯¢ï¼Œæ²¡æ³•åšå‡ºå¸¦SUBQUERYçš„å¤æ‚æŸ¥è¯¢å‡ºæ¥ã€‚
å¼ºåˆ¶å†…çœå®¹é”™æœºåˆ¶å¯¼è‡´å­˜å‚¨æ–‡ä»¶ä¸æ–­å˜å¤§</p>

<p>Realmæœ¬èº«æ„Ÿè§‰æœ‰ä¸€ä¸ªæ•°æ®å®¹é”™æœºåˆ¶ã€‚ä½†æ˜¯è¿™ä¸ªæœºåˆ¶åœ¨æ•°æ®åº“æ–‡ä»¶æœ‰é”™è¯¯çš„æƒ…å†µè‡ªå·±ä¿®å¤çš„æ—¶å€™ï¼Œä¼šæ— é™å¢å¤§ã€‚å…·ä½“æˆ‘è¿™é‡Œè¡¨ç°ä¸ºï¼Œæ‰“å¼€çœ‹åªæœ‰3000æ¡æ•°æ®ï¼Œä½†æ˜¯æ–‡ä»¶å¤§å°å·²ç»æœ‰3GBã€‚é‡ç°Bugä¹Ÿå¾ˆå®¹æ˜“ï¼Œåªè¦ä½ åœ¨å†™æ•°æ®åº“çš„æ—¶å€™,ç”¨Realm BrowseræŸ¥çœ‹ä¸€ä¸‹ï¼Œcrashä¹‹ååœ¨æ‰“å¼€å°±å¾ˆå®¹æ˜“å‡ºç°ã€‚</p>

<p>å®˜æ–¹æ–‡æ¡£é‡Œé¢æœ‰è¯´åˆ°ä¼šé€ æˆè¿™ç§æƒ…å½¢çš„åŸå› ï¼Œæˆ‘åœ¨å°½æˆ‘æ‰€èƒ½çš„é¿å…é—®é¢˜ä»¥åã€‚å­˜å‚¨æ–‡ä»¶è¿˜æ˜¯ä¼šæœ‰å¯èƒ½ä¸é‚£ä¹ˆå¤¸å¼ çš„å˜å¤§ä¸€äº›ã€‚ä½†æ˜¯ç”¨Realm BrowseræŸ¥çœ‹æ•°æ®æ˜¯æ­£å¸¸çš„ã€‚æ‰€ä»¥æˆ‘è§‰å¾—å®˜æ–¹åº”è¯¥æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥åˆ é™¤æ‰é‚£äº›å®¹æ˜“çš„ä¸œè¥¿ã€‚ä¿æŒå­˜å‚¨æ–‡ä»¶çš„å¹²å‡€ã€‚
æ²¡æœ‰ç»†ç²’åŒ–é€šçŸ¥</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘åœ¨æŸä¸ªåœ°æ–¹åšå‡ºä¿®æ”¹ã€‚ æˆ‘å…¶ä»–åœ°æ–¹åªçŸ¥é“Realmæœ‰ä¿®æ”¹ï¼Œä½†æ˜¯æ²¡æ³•çŸ¥é“æˆ‘æ˜¯å¢åŠ ã€ä¿®æ”¹è¿˜æ˜¯åˆ é™¤äº†æ•°æ®ã€‚ä¸çŸ¥é“æˆ‘æ›´æ–°çš„æ˜¯é‚£ä¸€æ¡æ•°æ®ã€‚æ®æ–‡æ¡£è¯´ï¼Œå°†æ¥ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±åªæœ‰æ‹­ç›®ä»¥å¾…ã€‚
å¢åŠ åŒ…ä½“ç§¯</p>

<p>æ®å®˜æ–¹è¯´ä¼šå¢åŠ 1MBå·¦å³çš„åŒ…å¤§å°ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªå°ä½“ç§¯åº”ç”¨ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå‡ åƒä¸‡ç”¨æˆ·çš„ä¸»æµåº”ç”¨ã€‚å¯¹åŒ…å¤§å°æ•æ„Ÿçš„è¯æ…ç”¨ã€‚
æ ¸å¿ƒä»£ç ç›®å‰é—­æº</p>

<p>å¯¹äºåœ¨æˆ‘ä»¬è¿™æ ·ä¸€ä¸ªä½œæ¶æ»¡å¤©é£çš„å¤©æœé•¿å¤§çš„å­©å­æ¥è¯´ï¼Œæœ‰äº›å­©å­å¯¹é—­æºè¿™ä¸ªäº‹æƒ…è¿˜æ˜¯æŒºåœ¨æ„çš„ã€‚ä¸è¿‡å®˜æ–¹è¯´å°†æ¥ä¼šå¼€æºï¼Œæˆ‘è¿˜æ˜¯å€¾å‘äºç›¸ä¿¡ Realm ä»–ä»¬çš„äººå“ã€‚
CoreData</p>

<p>CoreData ç›¸å…³èµ„æ–™ç›¸å¯¹å¤šä¸€äº›æˆ‘å°±ç®€å•è¯´
ä¼˜ç‚¹
å®˜æ–¹æ”¯æŒ &amp;&amp; äº²å„¿å­</p>

<p>ç³»ç»Ÿè‡ªå¸¦ï¼ŒAppleæ”¯æŒ
å¸¦å›¾å½¢åŒ–çš„Modelç¼–è¾‘</p>

<p>å¯¹äºè§†è§‰åŒ–åŠ¨ç‰©æ¥è¯´æ¯”è¾ƒå‹å¥½ï¼Œä¹Ÿå¯ä»¥æ¸…æ¥šçš„çŸ¥é“è‡ªå·±è®¾è®¡çš„ Model ä¹‹é—´çš„å…³ç³»
å¼ºå¤§çš„å…³è”å…³ç³»</p>

<p>ä»¥å‰ä¸è§‰å¾—ï¼Œç”¨äº† Realm æ‰å‘ç° CoreData çš„å…³è”å…³ç³»å¦‚æ­¤å¥½ç”¨ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šã€‚æƒ³æ€ä¹ˆæŸ¥è¯¢å°±æ€ä¹ˆæŸ¥è¯¢ï¼Œå¯ä»¥å†™å‡ºå¾ˆå¤æ‚çš„æŸ¥è¯¢é€»è¾‘æ¥ã€‚
å¼ºå¤§çš„æŸ¥è¯¢</p>

<p>è™½ç„¶å¯èƒ½åœ¨è®¾ç½®NSFetchRequestçš„æ—¶å€™æ„Ÿè§‰å¾ˆå¤šä¸œè¥¿è¦å¼„ï¼Œä½†æ˜¯å¤æ‚ä¹Ÿå¸¦æ¥äº†å¼ºå¤§çš„åŠŸèƒ½ï¼ŒNSFetchRequest å¯ä»¥è®¾ç½®å¾ˆå¤šï¼Œæ¯”å¦‚é™åˆ¶æŸ¥è¯¢æ•°é‡ï¼Œ é™åˆ¶åªè¿”å›æŸäº›å±æ€§å€¼ç­‰ç­‰ã€‚å°±ä¸å±•å¼€è¯´äº†ã€‚
ç²¾ç»†åŒ–çš„é€šçŸ¥</p>

<p>å¯ä»¥çŸ¥é“å…·ä½“æ’å…¥äº†ä»€ä¹ˆã€æ›´æ–°äº†ä»€ä¹ˆã€åˆ é™¤äº†ä»€ä¹ˆã€‚è¿™æ ·åœ¨åˆ·UIï¼Œæ¯”å¦‚ä¸€ä¸ªtableviewçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥æ§åˆ¶çš„å¾ˆå‡†ç¡®ã€‚
ç¼ºç‚¹
å…¥é—¨é—¨æ§›é«˜</p>

<pre><code>CoreData æ˜¯ä¸€ä¸ªåšå¤§ç²¾æ·±çš„æŠ€æœ¯ï¼Œä¸è¦å¦„æƒ³å‡ å¤©ä¹‹å†…å¯ä»¥ç”¨çš„å¾ˆæºœã€‚
CoreData æ˜¯ä¸€ä¸ªåšå¤§ç²¾æ·±çš„æŠ€æœ¯ï¼Œä¸è¦å¦„æƒ³å‡ å¤©ä¹‹å†…å¯ä»¥ç”¨çš„å¾ˆæºœã€‚
CoreData æ˜¯ä¸€ä¸ªåšå¤§ç²¾æ·±çš„æŠ€æœ¯ï¼Œä¸è¦å¦„æƒ³å‡ å¤©ä¹‹å†…å¯ä»¥ç”¨çš„å¾ˆæºœã€‚
</code></pre>

<p>å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å’Œç²¾åŠ›å»æ¥å…¥ CoreDataã€‚ é‚£é€‰å‹çš„æ—¶å€™åº”å½“æ…é‡è€ƒè™‘ã€‚
éœ€è¦ä¸€äº›å·¥å…·æ‰æ„Ÿè§‰å¥½ä½¿</p>

<p>ä¸ç®¡æ˜¯è€æ‰‹è¿˜æ˜¯æ–°æ‰‹ï¼Œä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹çš„å°è£…åº“å’Œå·¥å…·éƒ½ä¼šå¤§å¤§çš„æé«˜ä½¿ç”¨ CoreData çš„å¹¸ç¦æŒ‡æ•°ã€‚</p>

<p>mogenerator æ˜¯å¿…é¡»å¿…é¡»è¦çš„ã€‚</p>

<p>MagicalRecord æ— æ„§ CoreData ç¬¬ä¸€åº“ï¼Œæ®å°é“æ¶ˆæ¯ ä¸»è¦è´¡çŒ®è€… Saul Mora å¯èƒ½å»äº†å¾®ä¿¡äº†ã€‚
Context</p>

<p>å…¶å®è¿˜æ˜¯ CoreData é—¨æ§›é«˜çš„é—®é¢˜ï¼Œå¯¹æˆ‘æ¥è¯´ã€‚Contextä¹‹é—´çš„å…³ç³»å’Œçº¿ç¨‹ä¹‹é—´çš„å¤„ç†è®©æˆ‘æ„Ÿåˆ°å¾ˆå¤´ç—›ï¼Œç‰¹åˆ«æ˜¯ OS X  æ˜¯ä¸€å¤§å †VCé“ºåˆ°å±å¹•ä¸Šï¼Œæˆ‘æ°´å¹³åˆèœï¼Œå‡ºçš„é—®é¢˜å¾ˆå¤šã€‚
å¤šä¸ªæŒä¹…åŒ–æ–‡ä»¶å¾ˆéº»çƒ¦</p>

<p>ä¸æ˜¯è¯´ä¸å¯ä»¥ï¼Œä½†æ˜¯çœŸçš„å¥½éº»çƒ¦ã€‚</p>

<p>æœ‰ä¸ªç¬¬ä¸‰æ–¹åº“æœ‰è§£å†³CoreDataè¿™ä¸ªé—®é¢˜ CoreStore ä½†æ˜¯æˆ‘ç”¨ç€ä¸æ˜¯å¾ˆé¡ºæ‰‹æœ€åå¼ƒç”¨.
æ€»ç»“</p>

<p>å…¶å®å§ç”¨å•¥æŒä¹…åŒ–éƒ½è¡Œï¼Œå…·ä½“è¿˜æ˜¯éœ€è¦çœ‹ä½ çš„éœ€æ±‚å’Œæ–¹æ¡ˆä¸Šæ¥è¯´å“ªä¸€ä¸ªæ–¹æ¡ˆæ›´åŠ é€‚åˆã€‚</p>

<p>å¦‚æœç®€å•è¯´æ¥ï¼Œå°±æ˜¯ Realm æ›´åŠ é€‚åˆä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸æ€ä¹ˆå¤æ‚çš„åœºæ™¯ï¼Œå›¢é˜Ÿé…ç½®è¦æ±‚ä¸é«˜ï¼Œæœ‰ç»éªŒçš„äººç¨å¾®çœ‹ä¸€ä¸‹åˆå°±èƒ½ä¸Šæ‰‹ã€‚</p>

<p>CoreData æ›´åŠ é€‚åˆä¸šåŠ¡é€»è¾‘å¤æ‚çš„æƒ…å†µï¼Œå›¢é˜Ÿé…ç½®è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæœ‰ç»éªŒçš„è€æ‰‹ä¹Ÿéœ€è¦å‡ å‘¨ç”šè‡³æ›´é•¿çš„æ—¶é—´æ‰èƒ½ç§‘å­¦çš„ä½¿ç”¨CoreDataã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MagicalRecordé­”æ³•]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/04/coredatedzhuangbimegic/"/>
    <updated>2016-07-04T20:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/04/coredatedzhuangbimegic</id>
    <content type="html"><![CDATA[<p>æ­£æ–‡ï¼š</p>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»å°†CoreDataç›¸å…³çš„çŸ¥è¯†ç‚¹éƒ½è®²å®Œäº†ã€‚</p>

<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦è®²ä¸€ä¸ªCoreDataç¬¬ä¸‰æ–¹åº“-MagicalRecordã€‚ç›®å‰ä¸ºæ­¢è¿™ä¸ªç¬¬ä¸‰æ–¹åœ¨Githubä¸Šæœ‰9500+çš„Starï¼Œæ˜¯æ‰€æœ‰CoreDataç¬¬ä¸‰æ–¹åº“ä¸­ä½¿ç”¨æœ€å¤šã€åŠŸèƒ½æœ€å…¨çš„ã€‚åœ¨æ–‡ç« çš„åé¢è¿˜ä¼šå¯¹CoreDataåšä¸€ä¸ªæ€»ç»“ï¼Œä»¥åŠå¯¹æœ¬ç³»åˆ—æ‰€æœ‰æ–‡ç« åšä¸€ä¸ªæ€»ç»“ã€‚</p>

<p>æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼</p>

<!--more-->


<h4>MagicalRecord</h4>

<p>CoreDataæ˜¯è‹¹æœè‡ªå®¶æ¨å‡ºçš„ä¸€ä¸ªæŒä¹…åŒ–æ¡†æ¶ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ é¢å‘å¯¹è±¡ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¤§é‡ä»£ç ï¼Œè€Œä¸”CoreDataå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ï¼Œå¦‚æœæŒæ¡ä¸å¥½ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“é€ æˆå…¶ä»–é—®é¢˜ã€‚</p>

<p>å›½å¤–å¼€å‘è€…å¼€æºäº†ä¸€ä¸ªåŸºäºCoreDataå°è£…çš„ç¬¬ä¸‰æ–¹â€”â€”MagicalRecordï¼Œå°±åƒæ˜¯FMDBå°è£…SQLiteä¸€æ ·ï¼ŒMagicalRecordå°è£…çš„CoreDataï¼Œä½¿å¾—åŸç”Ÿçš„CoreDataæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚å¹¶ä¸”MagicalRecordé™ä½äº†CoreDataçš„ä½¿ç”¨é—¨æ§›ï¼Œä¸ç”¨å»æ‰‹åŠ¨ç®¡ç†ä¹‹å‰çš„PSCã€MOCç­‰å¯¹è±¡ã€‚</p>

<p>æ ¹æ®Githubä¸ŠMagicalRecordçš„å®˜æ–¹æ–‡æ¡£ï¼ŒMagicalRecordçš„ä¼˜ç‚¹ä¸»è¦æœ‰ä¸‰æ¡ï¼š</p>

<ol>
<li><p>æ¸…ç†é¡¹ç›®ä¸­CoreDataä»£ç </p></li>
<li><p>æ”¯æŒæ¸…æ™°ã€ç®€å•ã€ä¸€è¡Œå¼çš„æŸ¥è¯¢æ“ä½œ</p></li>
<li><p>å½“éœ€è¦ä¼˜åŒ–è¯·æ±‚æ—¶ï¼Œå¯ä»¥è·å–NSFetchRequestè¿›è¡Œä¿®æ”¹</p></li>
</ol>


<p>æ·»åŠ MagicalRecordåˆ°é¡¹ç›®ä¸­</p>

<p>å°†MagicalRecordæ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå’Œä½¿ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸‹è½½æºç å’ŒCocoaPodsä¸¤ç§æ–¹å¼æ·»åŠ ã€‚</p>

<ol>
<li><p>ä»Githubä¸‹è½½MagicalRecordæºç ï¼Œå°†æºç ç›´æ¥æ‹–åˆ°é¡¹ç›®ä¸­ï¼Œåç»­éœ€è¦æ‰‹åŠ¨æ›´æ–°æºç ã€‚</p></li>
<li><p>ä¹Ÿå¯ä»¥é€šè¿‡CocoaPodså®‰è£…MagicalRecordï¼Œéœ€è¦åœ¨Podfileä¸­åŠ å…¥ä¸‹é¢å‘½ä»¤ï¼Œåç»­åªéœ€è¦é€šè¿‡å‘½ä»¤æ¥æ›´æ–°ã€‚</p></li>
</ol>


<h6>å®‰è£…</h6>

<pre><code>pod "MagicalRecord"
</code></pre>

<p>åœ¨ä¹‹å‰åˆ›å»ºæ–°é¡¹ç›®æ—¶ï¼Œé€šè¿‡å‹¾é€‰"Use Core Data"çš„æ–¹å¼æ·»åŠ CoreDataåˆ°é¡¹ç›®ä¸­ï¼Œä¼šåœ¨AppDelegateæ–‡ä»¶ä¸­ç”Ÿæˆå¤§é‡CoreDataç›¸å…³ä»£ç ã€‚å¦‚æœæ˜¯å¤§å‹é¡¹ç›®ï¼Œè¢«å ç”¨çš„ä½ç½®æ˜¯å¾ˆé‡è¦çš„ã€‚è€Œå¯¹äºMagicalRecordæ¥è¯´ï¼Œåªéœ€è¦ä¸¤è¡Œä»£ç å³å¯ã€‚</p>

<pre><code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
// åˆå§‹åŒ–CoreDataå †æ ˆï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåˆå§‹åŒ–æŸä¸ªCoreDataå †æ ˆ
[MagicalRecord setupCoreDataStack];
return YES;
}
- (void)applicationWillTerminate:(UIApplication *)application {
// åœ¨åº”ç”¨é€€å‡ºæ—¶ï¼Œåº”è¯¥è°ƒç”¨cleanUpæ–¹æ³•
[MagicalRecord cleanUp];
}
</code></pre>

<p>MagicalRecordæ˜¯æ”¯æŒCoreDataçš„.xcdatamodeldæ–‡ä»¶çš„ï¼Œä½¿å¾—CoreDataè¿™ä¸€ä¼˜ç‚¹å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚å»ºç«‹æ•°æ®ç»“æ„æ—¶è¿˜æ˜¯åƒä¹‹å‰ä½¿ç”¨CoreDataä¸€æ ·ï¼Œé€šè¿‡.xcdatamodeldæ–‡ä»¶çš„æ–¹å¼å»ºç«‹ã€‚</p>

<p><img src="http://al1020119.github.io/images/coredateduoxianchenganquan004.png" title="Caption" ></p>

<h4>æ”¯æŒiCloud</h4>

<p>CoreDataæ˜¯æ”¯æŒiCloudçš„ï¼ŒMagicalRecordå¯¹iCloudç›¸å…³çš„æ“ä½œä¹Ÿåšäº†å°è£…ï¼Œåªéœ€è¦ä½¿ç”¨MagicalRecord+iCloud.hç±»ä¸­æä¾›çš„æ–¹æ³•ï¼Œå°±å¯ä»¥è¿›è¡ŒiCloudç›¸å…³çš„æ“ä½œã€‚</p>

<p>ä¾‹å¦‚ä¸‹é¢æ˜¯MagicalRecord+iCloud.hä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œéœ€è¦å°†ç›¸å…³å‚æ•°ä¼ å…¥å³å¯ã€‚</p>

<pre><code>+ (void)setupCoreDataStackWithiCloudContainer:(NSString *)containerID localStoreNamed:(NSString *)localStore;
</code></pre>

<h6>åˆ›å»ºä¸Šä¸‹æ–‡</h6>

<p>MagicalRecordå¯¹ä¸Šä¸‹æ–‡çš„ç®¡ç†å’Œåˆ›å»ºä¹Ÿæ¯”è¾ƒå…¨é¢ï¼Œä¸‹é¢æ˜¯MagicalRecordæä¾›çš„éƒ¨åˆ†åˆ›å»ºå’Œè·å–ä¸Šä¸‹æ–‡çš„ä»£ç ã€‚å› ä¸ºæ˜¯ç»™NSManagedObjectContextæ·»åŠ çš„Categoryï¼Œå¯ä»¥ç›´æ¥ç”¨NSManagedObjectContextç±»è°ƒç”¨ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚</p>

<p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œè™½ç„¶ç³»ç»Ÿå¸®æˆ‘ä»¬ç®¡ç†äº†ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¯¹äºè€—æ—¶æ“ä½œä»ç„¶è¦æ”¾åœ¨åå°çº¿ç¨‹ä¸­å¤„ç†ï¼Œå¹¶ä¸”åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡ŒUIæ“ä½œã€‚</p>

<pre><code>+ [NSManagedObjectContext MR_context]  è®¾ç½®é»˜è®¤çš„ä¸Šä¸‹æ–‡ä¸ºå®ƒçš„çˆ¶çº§ä¸Šä¸‹æ–‡ï¼Œå¹¶å‘ç±»å‹ä¸ºNSPrivateQueueConcurrencyType

+ [NSManagedObjectContext MR_newMainQueueContext]  åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å‘ç±»å‹ä¸ºNSMainQueueConcurrencyType

+ [NSManagedObjectContext MR_newPrivateQueueContext]  åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å‘ç±»å‹ä¸ºNSPrivateQueueConcurrencyType

+ [NSManagedObjectContext MR_contextWithParent:]  åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå…è®¸è‡ªå®šä¹‰çˆ¶çº§ä¸Šä¸‹æ–‡ï¼Œå¹¶å‘ç±»å‹ä¸ºNSPrivateQueueConcurrencyType

+ [NSManagedObjectContext MR_contextWithStoreCoordinator:]  åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å…è®¸è‡ªå®šä¹‰æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨ï¼Œå¹¶å‘ç±»å‹ä¸ºNSPrivateQueueConcurrencyType

+ [NSManagedObjectContext MR_defaultContext]  è·å–é»˜è®¤ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œé¡¹ç›®ä¸­æœ€åŸºç¡€çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶å‘ç±»å‹æ˜¯NSMainQueueConcurrencyType
</code></pre>

<p>å¢åˆ æ”¹æŸ¥</p>

<p>MagicalRecordå¯¹NSManagedObjectæ·»åŠ äº†ä¸€ä¸ªCategoryï¼Œå°†å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œæ”¾åœ¨è¿™ä¸ªCategoryä¸­ï¼Œä½¿å¾—è¿™äº›æ“ä½œå¯ä»¥ç›´æ¥è¢«NSManagedObjectç±»åŠå…¶å­ç±»è°ƒç”¨ã€‚</p>

<ol>
<li>å¢</li>
</ol>


<p>å¯¹äºæ‰˜ç®¡æ¨¡å‹çš„åˆ›å»ºéå¸¸ç®€å•ï¼Œä¸éœ€è¦åƒä¹‹å‰è¿˜éœ€è¦è¿›è¡Œä¸Šä¸‹æ–‡çš„æ“ä½œï¼Œç°åœ¨è¿™éƒ½æ˜¯MagicalRecordå¸®æˆ‘ä»¬å®Œæˆçš„ã€‚</p>

<pre><code>// åˆ›å»ºå¹¶æ’å…¥åˆ°ä¸Šä¸‹æ–‡ä¸­
Employee *emp = [Employee MR_createEntity];
</code></pre>

<ol>
<li>åˆ </li>
</ol>


<p>åˆ é™¤æ•°æ®</p>

<pre><code>// ä»ä¸Šä¸‹æ–‡ä¸­åˆ é™¤å½“å‰å¯¹è±¡
[emp MR_deleteEntity];
</code></pre>

<ol>
<li>æ”¹</li>
</ol>


<p>ä¿®æ”¹æ•°æ®</p>

<pre><code>// è·å–ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡
NSManagedObjectContext *defaultContext = [NSManagedObjectContext MR_defaultContext];
// åœ¨å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Employeeå¯¹è±¡
Employee *emp = [Employee MR_createEntityInContext:defaultContext];
emp.name      = @"lxz";
emp.brithday  = [NSDate date];
emp.height    = @1.7;
// ä¿å­˜ä¿®æ”¹åˆ°å½“å‰ä¸Šä¸‹æ–‡ä¸­
[defaultContext MR_saveToPersistentStoreAndWait];
</code></pre>

<ol>
<li>æŸ¥</li>
</ol>


<p> æŸ¥è¯¢æ•°æ®</p>

<pre><code>// æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œï¼Œå¹¶è®¾ç½®æ’åºæ¡ä»¶
NSArray *empSorted = [Employee MR_findAllSortedBy:@"height" ascending:YES];
</code></pre>

<h4>è‡ªå®šä¹‰NSFetchRequest</h4>

<p>ä¸‹é¢ç¤ºä¾‹ä»£ç ä¸­ï¼ŒEmployeeæ ¹æ®å·²æœ‰çš„employeeFilterè°“è¯å¯¹è±¡ï¼Œåˆ›å»ºäº†employeeRequestè¯·æ±‚å¯¹è±¡ï¼Œå¹¶å°†è¯·æ±‚å¯¹è±¡åšä¿®æ”¹åï¼Œä»MOCä¸­è·å–è¯·æ±‚ç»“æœï¼Œå®ç°è‡ªå®šä¹‰æŸ¥æ‰¾æ¡ä»¶ã€‚</p>

<pre><code>NSPredicate *employeeFilter = [NSPredicate predicateWithFormat:@"name LIKE %@", @"*lxz*"];
NSFetchRequest *employeeRequest = [Employee MR_requestAllWithPredicate:employeeFilter];
employeeRequest.fetchOffset = 10;
employeeRequest.fetchLimit = 10;
NSArray *employees = [Employee MR_executeFetchRequest:employeeRequest];
</code></pre>

<h6>å‚æ•°è®¾ç½®</h6>

<ol>
<li><p>å¯ä»¥é€šè¿‡ä¿®æ”¹MR_LOGGING_DISABLEDé¢„ç¼–è¯‘æŒ‡ä»¤çš„å€¼ï¼Œæ§åˆ¶logæ‰“å°ã€‚</p>

<ul>
<li>&ldquo;#defne MR_LOGGING_DISABLED 1&rdquo;.</li>
</ul>
</li>
</ol>


<p>2.MagicalRecordåœ¨DEBUGæ¨¡å¼ä¸‹ï¼Œå¯¹æ¨¡å‹æ–‡ä»¶å‘ç”Ÿäº†æ›´æ”¹ï¼Œå¹¶ä¸”æ²¡æœ‰åˆ›å»ºæ–°çš„æ¨¡å‹æ–‡ä»¶ç‰ˆæœ¬ã€‚MagicalRecordé»˜è®¤ä¼šå°†æ—§çš„æŒä¹…åŒ–å­˜å‚¨åˆ é™¤ï¼Œåˆ›å»ºæ–°çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</p>

<p>MagicalRecordçš„ä½¿ç”¨æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œåªæ˜¯å°†ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„æ‹¿å‡ºæ¥è®²è®²ï¼Œå…¶ä»–å°±ä¸ä¸€ä¸€è®²è§£äº†ã€‚åœ¨Githubä¸Šæœ‰å›½äººç¿»è¯‘çš„MagicalRecordå®˜æ–¹æ–‡æ¡£ï¼Œç¿»è¯‘çš„éå¸¸å…¨é¢ï¼Œè€Œä¸”æ˜¯å®æ—¶æ›´æ–°çš„ã€‚</p>

<p>è¿™ç¯‡æ–‡ç« å…³äºMagicalRecordçš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å‚è€ƒæ–‡ç« æ¥å†™çš„ï¼Œæˆ‘è¿™é‡Œå°±çŠ¯äº†ä¸ªæ‡’â€¦â€¦</p>

<h2>MagicalRecordä¸­æ–‡æ–‡æ¡£</h2>

<h4>CoreDataä¼˜ç¼ºç‚¹æ€»ç»“</h4>

<p>æ— è®ºæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œè‚¯å®šä¸ä¼šæ˜¯ç»å¯¹å®Œç¾çš„ï¼ŒCoreDataä¹Ÿæ˜¯å¦‚æ­¤ã€‚CoreDataè¢«è®¾è®¡å‡ºæ¥åï¼Œå¯¹æ¯”å…¶ä»–æœ¬åœ°æŒä¹…åŒ–æ–¹æ¡ˆæœ‰è‡ªå·±ç‹¬æœ‰çš„ä¼˜åŠ¿ï¼Œä¹Ÿæœ‰æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ã€‚</p>

<p>å¯¹äºä¸€ä¸ªæœ¬åœ°æŒä¹…åŒ–æ–¹æ¡ˆçš„é€‰å–ï¼Œè¿˜æ˜¯è¦æ ¹æ®å…¬å¸ä¸šåŠ¡éœ€æ±‚ï¼Œæ¥é€‰æ‹©ä¸€ä¸ªé€‚åˆé¡¹ç›®çš„æ–¹æ¡ˆï¼Œå¹¶æ²¡æœ‰å“ªä¸ªæ–¹æ¡ˆæ˜¯ä¸‡èƒ½çš„ã€‚</p>

<h6>ä¼˜ç‚¹</h6>

<pre><code>å¯ä»¥è®¾ç½®å…³è”å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰è®²è¿‡çš„å…³è”å±æ€§ï¼Œå…³è”å±æ€§å¯ä»¥å’Œå½“å‰å¯¹è±¡ä¸€èµ·è¢«MOCæ“ä½œã€‚

ä¾‹å¦‚Companyå…³è”ä¸€ä¸ªPersonå¯¹è±¡ï¼Œå¯¹Companyè¿›è¡Œæ“ä½œæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç‚¹è¯­æ³•ä»Companyä¸­è·å–Personï¼ŒPersonçš„ä¿®æ”¹ä¼šéšç€Companyä¸€èµ·è¢«æŒä¹…åŒ–ã€‚

å¦‚æœç”¨SQLiteå®ç°èµ·æ¥æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œä½†CoreDataå¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆï¼Œè¿™ä¹Ÿæ˜¯CoreDataæ›´åŠ é¢å‘å¯¹è±¡çš„ä¸€ç§ä½“ç°ã€‚

æ›´åŠ é¢å‘å¯¹è±¡ï¼Œå°†ä¹‹å‰Modelå±‚çš„è¡¨ç¤ºå’ŒæŒä¹…åŒ–åˆäºŒä¸ºä¸€ã€‚æŠŠæ•°æ®åº“çš„äº¤äº’å’Œå¯¹è±¡çš„è½¬æ¢å°è£…èµ·æ¥ï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦æ¥è§¦åˆ°ä»»ä½•SQLiteç›¸å…³çš„ä»£ç ï¼Œç›´æ¥ä½¿ç”¨æ‰˜ç®¡å¯¹è±¡å³å¯ã€‚

å¼€å‘æ•ˆç‡æ¯”è¾ƒå¿«ï¼Œå¯ä»¥å¾ˆå¿«çš„å°è£…ä¸€ä¸ªåŸºäºCoreDataå®ç°çš„Modelå±‚ï¼Œè€Œä¸éœ€è¦å¤ªå¤šçš„ä»£ç å°±å¯ä»¥å®ç°ã€‚

å¯ä»¥å¾ˆå¥½çš„é˜²èŒƒSQLæ³¨å…¥çš„é—®é¢˜ã€‚å¯¹äºSQLiteæ¥è¯´ï¼Œå¦‚æœæ˜¯ç”¨FMDBå¹¶ä¸”ç”¨?å ä½ç¬¦ï¼Œä¹Ÿå¯ä»¥é˜²èŒƒSQLæ³¨å…¥çš„é—®é¢˜ã€‚

å¯è§†åŒ–åŒ–æ•ˆæœå¥½ä¸”ç»“æ„æ¸…æ™°ã€‚å°†æ¨¡å‹æ–‡ä»¶å†…éƒ¨çš„ç»“æ„ï¼Œä»¥åŠå®ä½“ä¹‹é—´çš„å¯¹åº”å…³ç³»ç­‰ï¼Œä»¥å¯è§†åŒ–çš„ç»“æ„å±•ç°å‡ºæ¥ã€‚

å¯¹OCåŸç”Ÿç¼–ç¨‹æ”¯æŒéå¸¸å¥½ï¼Œæ”¯æŒkeyPathæ“ä½œæ–¹å¼ã€‚ä¾‹å¦‚è®¾ç½®NSPredicateæŸ¥æ‰¾æ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨keyPathçš„ç‚¹è¯­æ³•è®¾ç½®å±æ€§ã€‚è€Œå…¶ä»–æŒä¹…åŒ–å­˜å‚¨å¯¹äºè¿™ç‚¹æ”¯æŒçš„ä¸å¤ªå¥½ï¼Œéœ€è¦ç¼–å†™å¾ˆå¤æ‚çš„æŸ¥æ‰¾æ¡ä»¶ï¼Œçœ‹èµ·æ¥ä¹Ÿä¸å¤ªå¥½ç†è§£ã€‚

æ¯•ç«Ÿæ˜¯Appleè‡ªå®¶æ¨å‡ºçš„ï¼Œæ‰€ä»¥å¯¹OCèåˆåº¦æ¯”è¾ƒé«˜ï¼Œå¯ä»¥å¾ˆå¥½çš„é…åˆå’Œä½¿ç”¨OCå¯¹è±¡ã€‚

è®¾ç½®ä¸€å¯¹ä¸€æˆ–ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè®¾ç½®å…³ç³»ååšå­˜å‚¨å’ŒæŸ¥è¯¢ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œè¿™æ˜¯éå¸¸ä¾¿äºå¼€å‘çš„ã€‚å¦‚æœå¯¹äºæ€§èƒ½æ²¡æœ‰è‹›åˆ»çš„è¦æ±‚ï¼Œå¹¶ä¸”æŒä¹…åŒ–å¯¹è±¡ä¹‹é—´å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œæ¯”è¾ƒæ¨èä½¿ç”¨CoreDataã€‚
</code></pre>

<h6>ç¼ºç‚¹</h6>

<pre><code>çµæ´»æ€§ä¸å¦‚SQLiteï¼ŒCoreDataæ˜¯å¯¹SQLiteçš„ä¸€ä¸ªå°è£…ï¼Œä¸Šå±‚ä¸èƒ½ç›´æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚å¤„ç†ä»»ä½•æ•°æ®éƒ½è¦æŒ‰ç…§CoreDataå†…éƒ¨çš„å®ç°é€»è¾‘æ‰§è¡Œï¼Œè€Œä¸èƒ½è‡ªå®šä¹‰æ‰§è¡Œé€»è¾‘ï¼Œå¯¹æ‰§è¡Œé€»è¾‘æ²¡æœ‰å¯æ§æ€§ã€‚

è¿›è¡Œå¤§é‡æ•°æ®å¤„ç†æ—¶æ¯”è¾ƒåƒåŠ›ï¼Œæ€§èƒ½æ˜æ˜¾ä½äºç›´æ¥æ“ä½œSQLiteæ•°æ®åº“ï¼Œè€Œä¸”å†…å­˜å ç”¨éå¸¸å¤§ï¼Œéœ€è¦æ‰‹åŠ¨åšå†…å­˜æ§åˆ¶ã€‚

å½“æ‰§è¡Œä¸€ä¸ªæ“ä½œæ—¶æ¶‰åŠçš„æ•°æ®æ¯”è¾ƒå¤šï¼Œéœ€è¦å°†æ‰€æœ‰ç›¸å…³çš„æ‰˜ç®¡å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œä¸”ä¸­é—´è¿˜æ¶‰åŠåˆ°å¯¹è±¡çš„è½¬æ¢ç­‰æ“ä½œã€‚è¿™æ ·å¯¹æ€§èƒ½å’Œå†…å­˜çš„æ¶ˆè€—éƒ½æ˜¯éå¸¸å¤§çš„ï¼Œå’Œæ¶‰åŠåˆ°çš„æ•°æ®é‡æˆæ­£æ¯”ã€‚
</code></pre>

<p>å› ä¸ºCoreDataåº•å±‚æ˜¯ç”¨SQLiteå®ç°çš„ï¼Œå¯ä»¥åœ¨CoreDataçš„åŸºç¡€ä¸Šï¼Œç›´æ¥ç¼–å†™SQLè¯­å¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚ä½†æ˜¯å¹¶ä¸æ¨èè¿™æ ·åšï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­åº”è¯¥åªæœ‰ä¸€ç§æŒä¹…åŒ–çš„ä¸»ä½“æ–¹æ¡ˆã€‚è€Œä¸”å¦‚æœè¿™ä¸¤ç§æ–¹å¼æ··ç”¨çš„è¯ï¼Œå¯¹äºåæœŸç»´æŠ¤æ˜¯éå¸¸å›°éš¾çš„ã€‚</p>

<pre><code>å¦‚æœå‡ºç°è¿™æ ·çš„éœ€æ±‚ï¼Œæœ€å¥½ç›´æ¥å»ç”¨SQLiteã€‚

CoreDataå…¥é—¨é—¨æ§›æ¯”è¾ƒé«˜ï¼Œå¾ˆéš¾å¾ˆå¥½çš„æŒæ¡ã€‚
</code></pre>

<p>å¾ˆå¤šäººéƒ½è¯´CoreDataä¸å¥½ç”¨ï¼Œè¿™ä¸ªåŸå› å¾ˆå¤§ä¸€éƒ¨åˆ†éƒ½æ˜¯å› ä¸ºä½¿ç”¨æ–¹å¼çš„é—®é¢˜ã€‚CoreDataæ¡†æ¶å­¦ä¹ éš¾åº¦æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´å¾ˆå¤šäººéƒ½åªæ˜¯ç®€å•çš„ä½¿ç”¨CoreDataï¼Œè¿™äº›ç”¨æ³•å¾ˆå¤šéƒ½æ˜¯ä¸åˆç†çš„ï¼Œå¾ˆå¤šçš„é«˜çº§ç”¨æ³•å¹¶æ²¡æœ‰ç”¨åˆ°ã€‚</p>

<h4>å†™åœ¨æœ€å</h4>

<p>åˆ°ç›®å‰ä¸ºæ­¢CoreDataç³»åˆ—çš„å…­ç¯‡æ–‡ç« å°±éƒ½å†™å®Œäº†ï¼Œæ–‡ç« ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›æ²¡æœ‰æ³¨æ„çš„é—®é¢˜ï¼Œè¿˜è¯·å„ä½æå‡ºã€‚åšå®¢ä¸­åŒ…æ‹¬CoreDataåœ¨å†…çš„æ‰€æœ‰æ–‡ç« æ°¸ä¹…æ›´æ–°ç»´æŠ¤ï¼Œä¼šä¸æ–­å°†æ–°çŸ¥è¯†æ·»åŠ åˆ°å¯¹åº”çš„æ–‡ç« ä¸­ï¼Œä¹Ÿä¼šå¯¹è½åçš„æ–‡ç« è¿›è¡Œé‡å†™ã€‚</p>

<p>åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ä¹Ÿè¯´åˆ°ï¼Œæˆ‘æ¥è§¦CoreDataæ—¶é—´ä¹Ÿä¸æ˜¯å¾ˆé•¿ï¼Œè¿™ç³»åˆ—æ–‡ç« æ›´åƒæ˜¯æˆ‘å­¦ä¹ çš„ä¸€ä¸ªæ€»ç»“ã€‚ä½†æ˜¯æˆ‘ç¡®å®æ˜¯å¾ˆè®¤çœŸçš„åœ¨å†™ï¼Œæ–‡ç« å†…å®¹ä¹Ÿæ˜¯æ£€æŸ¥äº†å¾ˆå¤šéï¼Œé˜²æ­¢é”™å­—æˆ–è€…è¯­æ³•é—®é¢˜ã€‚çŸ¥è¯†ç‚¹æ€»ç»“çš„è¿˜æ˜¯æ¯”è¾ƒå…¨é¢çš„ï¼Œåœ¨åç»­æˆ‘è¿˜ä¼šæ›´æ·±å…¥çš„å­¦ä¹ CoreDataï¼Œä¹Ÿå¯èƒ½ä¼šæ¨å‡ºåç»­æ–‡ç« ã€‚</p>

<blockquote><p>è®¸å¤šäººå¯¹äºCoreDataæœ‰å¾ˆå¤šæ„è§ï¼Œè®¤ä¸ºCoreDataæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œè¿™å¹¶ä¸æ˜¯ç©ºç©´æ¥é£ã€‚åœ¨æˆ‘å­¦ä¹ CoreDataçš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå‘ç°CoreDataç¡®å®å­˜åœ¨è¯¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚æŸ¥è¯¢æ€§èƒ½ç•¥å·®ã€çµæ´»æ€§ç­‰ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨CoreDataçš„æ—¶å€™ï¼Œè¿˜æ˜¯æ ¹æ®å…¬å¸ä¸šåŠ¡éœ€æ±‚æ¥æƒè¡¡æ˜¯å¦ä½¿ç”¨CoreDataã€‚</p></blockquote>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CoreDataå®‰å…¨é—®é¢˜ï¼]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/04/coredatedzhuangbianquang/"/>
    <updated>2016-07-04T18:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/04/coredatedzhuangbianquang</id>
    <content type="html"><![CDATA[<p>æ­£æ–‡ï¼š</p>

<p>CoreDataä½¿ç”¨ç›¸å…³çš„æŠ€æœ¯ç‚¹å·²ç»è®²å·®ä¸å¤šäº†ï¼Œæˆ‘æ‰€æŒæ¡çš„ä¹Ÿå°±è¿™ä¹ˆå¤šäº†&hellip;.</p>

<p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸»è¦è®²CoreDataçš„å¤šçº¿ç¨‹ï¼Œå…¶ä¸­ä¼šåŒ…æ‹¬å¹¶å‘é˜Ÿåˆ—ç±»å‹ã€çº¿ç¨‹å®‰å…¨ç­‰æŠ€æœ¯ç‚¹ã€‚æˆ‘å¯¹å¤šçº¿ç¨‹çš„ç†è§£å¯èƒ½ä¸æ˜¯å¤ªé€å½»ï¼Œæ–‡ç« ä¸­å‡ºç°çš„é—®é¢˜è¿˜è¯·å„ä½æŒ‡å‡ºã€‚åœ¨ä¹‹åå…¬å¸é¡¹ç›®ä½¿ç”¨CoreDataçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šå°†å…¶ä¸­é‡åˆ°çš„å¤šçº¿ç¨‹ç›¸å…³çš„é—®é¢˜æ›´æ–°åˆ°æ–‡ç« ä¸­ã€‚</p>

<p>åœ¨æ–‡ç« çš„æœ€åï¼Œä¼šæ ¹æ®æˆ‘å¯¹CoreDataå¤šçº¿ç¨‹çš„å­¦ä¹ ï¼Œä»¥åŠåœ¨å·¥ä½œä¸­çš„å…·ä½“ä½¿ç”¨ï¼Œç»™å‡ºä¸€äº›å…³äºå¤šçº¿ç¨‹ç»“æ„çš„è®¾è®¡å»ºè®®ï¼Œå„ä½å¯ä»¥å½“åšå‚è€ƒã€‚</p>

<p>æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼</p>

<!--more-->


<h4>MOCå¹¶å‘é˜Ÿåˆ—ç±»å‹</h4>

<p>åœ¨CoreDataä¸­MOCæ˜¯æ”¯æŒå¤šçº¿ç¨‹çš„ï¼Œå¯ä»¥åœ¨åˆ›å»ºMOCå¯¹è±¡æ—¶ï¼ŒæŒ‡å®šå…¶å¹¶å‘é˜Ÿåˆ—çš„ç±»å‹ã€‚å½“æŒ‡å®šé˜Ÿåˆ—ç±»å‹åï¼Œç³»ç»Ÿä¼šå°†æ“ä½œéƒ½æ”¾åœ¨æŒ‡å®šçš„é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œå¦‚æœæŒ‡å®šçš„æ˜¯ç§æœ‰é˜Ÿåˆ—ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ã€‚ä½†è¿™éƒ½æ˜¯ç³»ç»Ÿå†…éƒ¨çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½è·å–è¿™ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ç”±ç³»ç»Ÿæ‰€æ‹¥æœ‰ï¼Œå¹¶ç”±ç³»ç»Ÿå°†ä»»åŠ¡æ´¾å‘åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­æ‰§è¡Œçš„ã€‚</p>

<p>NSManagedObjectContextå¹¶å‘é˜Ÿåˆ—ç±»å‹:</p>

<pre><code>NSConfinementConcurrencyType : å¦‚æœä½¿ç”¨initæ–¹æ³•åˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªå¹¶å‘ç±»å‹ã€‚è¿™ä¸ªæšä¸¾å€¼æ˜¯ä¸æ”¯æŒå¤šçº¿ç¨‹çš„ï¼Œä»åå­—ä¸Šä¹Ÿä½“ç°å‡ºæ¥äº†ã€‚

NSPrivateQueueConcurrencyType : ç§æœ‰å¹¶å‘é˜Ÿåˆ—ç±»å‹ï¼Œæ“ä½œéƒ½æ˜¯åœ¨å­çº¿ç¨‹ä¸­å®Œæˆçš„ã€‚

NSMainQueueConcurrencyType : ä¸»å¹¶å‘é˜Ÿåˆ—ç±»å‹ï¼Œå¦‚æœæ¶‰åŠåˆ°UIç›¸å…³çš„æ“ä½œï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨è¿™ä¸ªæšä¸¾å€¼åˆå§‹åŒ–ä¸Šä¸‹æ–‡ã€‚
</code></pre>

<p>å…¶ä¸­NSConfinementConcurrencyTypeç±»å‹åœ¨iOS9ä¹‹åå·²ç»è¢«è‹¹æœåºŸå¼ƒï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªAPIã€‚ä½¿ç”¨æ­¤ç±»å‹åˆ›å»ºçš„MOCï¼Œè°ƒç”¨æŸäº›æ¯”è¾ƒæ–°çš„CoreDataçš„APIå¯èƒ½ä¼šå¯¼è‡´å´©æºƒã€‚</p>

<h4>MOCå¤šçº¿ç¨‹è°ƒç”¨æ–¹å¼</h4>

<p>åœ¨CoreDataä¸­MOCä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä½¿ç”¨MOCæ—¶ï¼Œä¸èƒ½ç®€å•çš„å°†MOCä»ä¸€ä¸ªçº¿ç¨‹ä¸­ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œè¿™å¹¶ä¸æ˜¯CoreDataçš„å¤šçº¿ç¨‹ï¼Œè€Œä¸”ä¼šå‡ºé—®é¢˜ã€‚å¯¹äºMOCå¤šçº¿ç¨‹çš„ä½¿ç”¨ï¼Œè‹¹æœç»™å‡ºäº†è‡ªå·±çš„è§£å†³æ–¹æ¡ˆã€‚</p>

<p>åœ¨åˆ›å»ºçš„MOCä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ— è®ºæ˜¯ç§æœ‰é˜Ÿåˆ—è¿˜æ˜¯ä¸»é˜Ÿåˆ—ï¼Œéƒ½åº”è¯¥é‡‡ç”¨ä¸‹é¢ä¸¤ç§å¤šçº¿ç¨‹çš„ä½¿ç”¨æ–¹å¼ï¼Œè€Œä¸æ˜¯è‡ªå·±æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ã€‚è°ƒç”¨ä¸‹é¢æ–¹æ³•åï¼Œç³»ç»Ÿå†…éƒ¨ä¼šå°†ä»»åŠ¡æ´¾å‘åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è°ƒç”¨MOCçš„è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯å…è®¸çš„ã€‚</p>

<pre><code>- (void)performBlock:(void (^)())block         //å¼‚æ­¥æ‰§è¡Œçš„blockï¼Œè°ƒç”¨ä¹‹åä¼šç«‹åˆ»è¿”å›
- (void)performBlockAndWait:(void (^)())block    //åŒæ­¥æ‰§è¡Œçš„blockï¼Œè°ƒç”¨ä¹‹åä¼šç­‰å¾…è¿™ä¸ªä»»åŠ¡å®Œæˆï¼Œæ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ
</code></pre>

<p>ä¸‹é¢æ˜¯å¤šçº¿ç¨‹è°ƒç”¨çš„ç¤ºä¾‹ä»£ç ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹æ‰§è¡ŒMOCçš„saveæ–¹æ³•ï¼Œå°±æ˜¯å°†saveæ–¹æ³•æ”¾åœ¨MOCçš„blockä½“ä¸­å¼‚æ­¥æ‰§è¡Œï¼Œå…¶ä»–æ–¹æ³•çš„è°ƒç”¨ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>

<pre><code>[context performBlock:^{
    [context save:nil];
}];
</code></pre>

<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªblockæ–¹æ³•ä¸èƒ½åœ¨NSConfinementConcurrencyTypeç±»å‹çš„MOCä¸‹è°ƒç”¨ï¼Œè¿™ä¸ªç±»å‹çš„MOCæ˜¯ä¸æ”¯æŒå¤šçº¿ç¨‹çš„ï¼Œåªæ”¯æŒå…¶ä»–ä¸¤ç§å¹¶å‘æ–¹å¼çš„MOCã€‚</p>

<h4>å¤šçº¿ç¨‹çš„ä½¿ç”¨</h4>

<p>åœ¨ä¸šåŠ¡æ¯”è¾ƒå¤æ‚çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿›è¡Œå¤§é‡æ•°æ®å¤„ç†ï¼Œå¹¶ä¸”è¿˜éœ€è¦æ¶‰åŠåˆ°UIçš„æ“ä½œã€‚å¯¹äºè¿™ç§å¤æ‚éœ€æ±‚ï¼Œå¦‚æœéƒ½æ”¾åœ¨ä¸»é˜Ÿåˆ—ä¸­ï¼Œå¯¹æ€§èƒ½å’Œç•Œé¢æµç•…åº¦éƒ½ä¼šæœ‰å¾ˆå¤§çš„å½±å“ï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒéå¸¸å·®ï¼Œé™ä½å±å¹•FPSã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥é‡‡å–å¤šä¸ªMOCé…åˆçš„æ–¹å¼ã€‚</p>

<p>CoreDataå¤šçº¿ç¨‹çš„å‘å±•ä¸­ï¼Œåœ¨iOS5ç»å†äº†ä¸€æ¬¡æ¯”è¾ƒå¤§çš„å˜åŒ–ï¼Œä¹‹åå¯ä»¥æ›´æ–¹ä¾¿çš„ä½¿ç”¨å¤šçº¿ç¨‹ã€‚ä»iOS5å¼€å§‹ï¼Œæ”¯æŒè®¾ç½®MOCçš„parentContextå±æ€§ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è®¾ç½®MOCçš„çˆ¶MOCã€‚ä¸‹é¢ä¼šé’ˆå¯¹iOS5ä¹‹å‰å’Œä¹‹åï¼Œåˆ†åˆ«è®²è§£CoreDataçš„å¤šçº¿ç¨‹ä½¿ç”¨ã€‚</p>

<p>å°½ç®¡ç°åœ¨çš„å¼€å‘ä¸­æ—©å°±ä¸å…¼å®¹iOS5ä¹‹å‰çš„ç³»ç»Ÿäº†ï¼Œä½†æ˜¯ä½œä¸ºäº†è§£è¿™é‡Œè¿˜æ˜¯è¦è®²ä¸€ä¸‹ï¼Œè€Œä¸”è¿™ç§åŒæ­¥æ–¹å¼åœ¨iOS5ä¹‹åä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œä¹Ÿæœ‰å¾ˆå¤šäººè¿˜åœ¨ä½¿ç”¨è¿™ç§åŒæ­¥æ–¹å¼ï¼Œä¸‹é¢å…¶ä»–ç« èŠ‚ä¹Ÿæ˜¯åŒç†ã€‚</p>

<h4>iOS 5ä¹‹å‰ä½¿ç”¨å¤šä¸ªMOC</h4>

<p>åœ¨iOS 5ä¹‹å‰å®ç°MOCçš„å¤šçº¿ç¨‹ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªMOCï¼Œå¤šä¸ªMOCä½¿ç”¨åŒä¸€ä¸ªPSCï¼Œå¹¶è®©å¤šä¸ªMOCå®ç°æ•°æ®åŒæ­¥ã€‚é€šè¿‡è¿™ç§æ–¹å¼ä¸ç”¨æ‹…å¿ƒPSCåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­çš„çº¿ç¨‹é—®é¢˜ï¼ŒMOCåœ¨ä½¿ç”¨PSCè¿›è¡Œsaveæ“ä½œæ—¶ï¼Œä¼šå¯¹PSCè¿›è¡ŒåŠ é”ï¼Œç­‰å½“å‰åŠ é”çš„MOCæ‰§è¡Œå®Œæ“ä½œä¹‹åï¼Œå…¶ä»–MOCæ‰èƒ½ç»§ç»­æ‰§è¡Œæ“ä½œã€‚</p>

<p>æ¯ä¸€ä¸ªPSCéƒ½å¯¹åº”ç€ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åŒºï¼ŒPSCçŸ¥é“å­˜å‚¨åŒºä¸­æ•°æ®å­˜å‚¨çš„æ•°æ®ç»“æ„ï¼Œè€ŒMOCéœ€è¦ä½¿ç”¨è¿™ä¸ªPSCè¿›è¡Œsaveæ“ä½œçš„å®ç°ã€‚</p>

<p><img src="http://al1020119.github.io/images/coredateduoxianchenganquan001.png" title="Caption" ></p>

<h4>å¤šçº¿ç¨‹ç»“æ„</h4>

<p>è¿™æ ·åšæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä¸€ä¸ªMOCå‘ç”Ÿæ”¹å˜å¹¶æŒä¹…åŒ–åˆ°æœ¬åœ°æ—¶ï¼Œç³»ç»Ÿå¹¶ä¸ä¼šå°†å…¶ä»–MOCç¼“å­˜åœ¨å†…å­˜ä¸­çš„NSManagedObjectå¯¹è±¡æ”¹å˜ã€‚æ‰€ä»¥è¿™å°±éœ€è¦æˆ‘ä»¬åœ¨MOCå‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°†å…¶ä»–MOCæ•°æ®æ›´æ–°ã€‚</p>

<p>æ ¹æ®ä¸Šé¢çš„è§£é‡Šï¼Œåœ¨ä¸‹é¢ä¾‹å­ä¸­åˆ›å»ºäº†ä¸€ä¸ªä¸»é˜Ÿåˆ—çš„mainMOCï¼Œä¸»è¦ç”¨äºUIæ“ä½œã€‚ä¸€ä¸ªç§æœ‰é˜Ÿåˆ—çš„backgroundMOCï¼Œç”¨äºé™¤UIä¹‹å¤–çš„è€—æ—¶æ“ä½œï¼Œä¸¤ä¸ªMOCä½¿ç”¨çš„åŒä¸€ä¸ªPSCã€‚</p>

<pre><code>// è·å–PSCå®ä¾‹å¯¹è±¡
- (NSPersistentStoreCoordinator *)persistentStoreCoordinator {
    // åˆ›å»ºæ‰˜ç®¡å¯¹è±¡æ¨¡å‹ï¼Œå¹¶æŒ‡æ˜åŠ è½½Companyæ¨¡å‹æ–‡ä»¶
    NSURL *modelPath = [[NSBundle mainBundle] URLForResource:@"Company" withExtension:@"momd"];
    NSManagedObjectModel *model = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelPath];
       // åˆ›å»ºPSCå¯¹è±¡ï¼Œå¹¶å°†æ‰˜ç®¡å¯¹è±¡æ¨¡å‹å½“åšå‚æ•°ä¼ å…¥ï¼Œå…¶ä»–MOCéƒ½æ˜¯ç”¨è¿™ä¸€ä¸ªPSCã€‚
    NSPersistentStoreCoordinator *PSC = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:model];
    // æ ¹æ®æŒ‡å®šçš„è·¯å¾„ï¼Œåˆ›å»ºå¹¶å…³è”æœ¬åœ°æ•°æ®åº“
    NSString *dataPath = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES).lastObject;
    dataPath = [dataPath stringByAppendingFormat:@"/%@.sqlite", @"Company"];
    [PSC addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[NSURL fileURLWithPath:dataPath] options:nil error:nil];
    return PSC;
}
// åˆå§‹åŒ–ç”¨äºæœ¬åœ°å­˜å‚¨çš„æ‰€æœ‰MOC
- (void)createManagedObjectContext {
    // åˆ›å»ºPSCå®ä¾‹å¯¹è±¡ï¼Œå…¶ä»–MOCéƒ½ç”¨è¿™ä¸€ä¸ªPSCã€‚
    NSPersistentStoreCoordinator *PSC = self.persistentStoreCoordinator;
    // åˆ›å»ºä¸»é˜Ÿåˆ—MOCï¼Œç”¨äºæ‰§è¡ŒUIæ“ä½œ
    NSManagedObjectContext *mainMOC = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType];
    mainMOC.persistentStoreCoordinator = PSC;
    // åˆ›å»ºç§æœ‰é˜Ÿåˆ—MOCï¼Œç”¨äºæ‰§è¡Œå…¶ä»–è€—æ—¶æ“ä½œ
    NSManagedObjectContext *backgroundMOC = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSPrivateQueueConcurrencyType];
    backgroundMOC.persistentStoreCoordinator = PSC;
    // é€šè¿‡ç›‘å¬NSManagedObjectContextDidSaveNotificationé€šçŸ¥ï¼Œæ¥è·å–æ‰€æœ‰MOCçš„æ”¹å˜æ¶ˆæ¯
    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(contextChanged:) name:NSManagedObjectContextDidSaveNotification object:nil];
}
// MOCæ”¹å˜åçš„é€šçŸ¥å›è°ƒ
- (void)contextChanged:(NSNotification *)noti {
    NSManagedObjectContext *MOC = noti.object;
    // è¿™é‡Œéœ€è¦åšåˆ¤æ–­æ“ä½œï¼Œåˆ¤æ–­å½“å‰æ”¹å˜çš„MOCæ˜¯å¦æˆ‘ä»¬å°†è¦åšåŒæ­¥çš„MOCï¼Œå¦‚æœå°±æ˜¯å½“å‰MOCè‡ªå·±åšçš„æ”¹å˜ï¼Œé‚£å°±ä¸éœ€è¦å†åŒæ­¥è‡ªå·±äº†ã€‚
    // ç”±äºé¡¹ç›®ä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªPSCï¼Œæ‰€ä»¥ä¸‹é¢è¿˜éœ€è¦åˆ¤æ–­PSCæ˜¯å¦å½“å‰æ“ä½œçš„PSCï¼Œå¦‚æœä¸æ˜¯å½“å‰PSCåˆ™ä¸éœ€è¦åŒæ­¥ï¼Œä¸è¦å»åŒæ­¥å…¶ä»–æœ¬åœ°å­˜å‚¨çš„æ•°æ®ã€‚
    [MOC performBlock:^{
        // ç›´æ¥è°ƒç”¨ç³»ç»Ÿæä¾›çš„åŒæ­¥APIï¼Œç³»ç»Ÿå†…éƒ¨ä¼šå®ŒæˆåŒæ­¥çš„å®ç°ç»†èŠ‚ã€‚
        [MOC mergeChangesFromContextDidSaveNotification:noti];
    }];
}
</code></pre>

<p>åœ¨ä¸Šé¢çš„Demoä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªPSCï¼Œå¹¶å°†å…¶ä»–MOCéƒ½å…³è”åˆ°è¿™ä¸ªPSCä¸Šï¼Œè¿™æ ·æ‰€æœ‰çš„MOCæ‰§è¡Œæœ¬åœ°æŒä¹…åŒ–ç›¸å…³çš„æ“ä½œæ—¶ï¼Œéƒ½æ˜¯é€šè¿‡åŒä¸€ä¸ªPSCè¿›è¡Œæ“ä½œçš„ã€‚å¹¶åœ¨ä¸‹é¢æ·»åŠ äº†ä¸€ä¸ªé€šçŸ¥ï¼Œè¿™ä¸ªé€šçŸ¥æ˜¯ç›‘å¬æ‰€æœ‰MOCæ‰§è¡Œsaveæ“ä½œåçš„é€šçŸ¥ï¼Œå¹¶åœ¨é€šçŸ¥çš„å›è°ƒæ–¹æ³•ä¸­è¿›è¡Œæ•°æ®çš„åˆå¹¶ã€‚</p>

<h4>iOS5ä¹‹åä½¿ç”¨å¤šä¸ªMOC</h4>

<blockquote><p>åœ¨iOS5ä¹‹åï¼ŒMOCå¯ä»¥è®¾ç½®parentContextï¼Œä¸€ä¸ªparentContextå¯ä»¥æ‹¥æœ‰å¤šä¸ªChildContextã€‚åœ¨ChildContextæ‰§è¡Œsaveæ“ä½œåï¼Œä¼šå°†æ“ä½œpushåˆ°parentContextï¼Œç”±parentContextå»å®ŒæˆçœŸæ­£çš„saveæ“ä½œï¼Œè€ŒChildContextæ‰€æœ‰çš„æ”¹å˜éƒ½ä¼šè¢«parentContextæ‰€çŸ¥æ™“ï¼Œè¿™è§£å†³äº†ä¹‹å‰MOCæ‰‹åŠ¨åŒæ­¥æ•°æ®çš„é—®é¢˜ã€‚</p></blockquote>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ChildContextè°ƒç”¨saveæ–¹æ³•ä¹‹åï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰å°†æ•°æ®å†™å…¥å­˜å‚¨åŒºï¼Œè¿˜éœ€è¦è°ƒç”¨parentContextçš„saveæ–¹æ³•ã€‚å› ä¸ºChildContextå¹¶ä¸æ‹¥æœ‰PSCï¼ŒChildContextä¹Ÿä¸éœ€è¦è®¾ç½®PSCï¼Œæ‰€ä»¥éœ€è¦parentContextè°ƒç”¨PSCæ¥æ‰§è¡ŒçœŸæ­£çš„saveæ“ä½œã€‚ä¹Ÿå°±æ˜¯åªæœ‰æ‹¥æœ‰PSCçš„MOCæ‰§è¡Œsaveæ“ä½œåï¼Œæ‰æ˜¯çœŸæ­£çš„æ‰§è¡Œäº†å†™å…¥å­˜å‚¨åŒºçš„æ“ä½œã€‚</p>

<pre><code>- (void)createManagedObjectContext {
    // åˆ›å»ºPSCå®ä¾‹å¯¹è±¡ï¼Œè¿˜æ˜¯ç”¨ä¸Šé¢Demoçš„å®ä¾‹åŒ–ä»£ç 
    NSPersistentStoreCoordinator *PSC = self.persistentStoreCoordinator;
    // åˆ›å»ºä¸»é˜Ÿåˆ—MOCï¼Œç”¨äºæ‰§è¡ŒUIæ“ä½œ
    NSManagedObjectContext *mainMOC = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType];
    mainMOC.persistentStoreCoordinator = PSC;
    // åˆ›å»ºç§æœ‰é˜Ÿåˆ—MOCï¼Œç”¨äºæ‰§è¡Œå…¶ä»–è€—æ—¶æ“ä½œï¼ŒbackgroundMOCå¹¶ä¸éœ€è¦è®¾ç½®PSC
    NSManagedObjectContext *backgroundMOC = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSPrivateQueueConcurrencyType];
    backgroundMOC.parentContext = mainMOC;
    // ç§æœ‰é˜Ÿåˆ—çš„MOCå’Œä¸»é˜Ÿåˆ—çš„MOCï¼Œåœ¨æ‰§è¡Œsaveæ“ä½œæ—¶ï¼Œéƒ½åº”è¯¥è°ƒç”¨performBlock:æ–¹æ³•ï¼Œåœ¨è‡ªå·±çš„é˜Ÿåˆ—ä¸­æ‰§è¡Œsaveæ“ä½œã€‚
    // ç§æœ‰é˜Ÿåˆ—çš„MOCæ‰§è¡Œå®Œè‡ªå·±çš„saveæ“ä½œåï¼Œè¿˜è°ƒç”¨äº†ä¸»é˜Ÿåˆ—MOCçš„saveæ–¹æ³•ï¼Œæ¥å®ŒæˆçœŸæ­£çš„æŒä¹…åŒ–æ“ä½œï¼Œå¦åˆ™ä¸èƒ½æŒä¹…åŒ–åˆ°æœ¬åœ°
    [backgroundMOC performBlock:^{
        [backgroundMOC save:nil];
        [mainMOC performBlock:^{
            [mainMOC save:nil];
        }];
    }];
}
</code></pre>

<p>ä¸Šé¢ä¾‹å­ä¸­åˆ›å»ºä¸€ä¸ªä¸»é˜Ÿåˆ—çš„mainMOCï¼Œæ¥å®ŒæˆUIç›¸å…³çš„æ“ä½œã€‚åˆ›å»ºç§æœ‰é˜Ÿåˆ—çš„backgroundMOCï¼Œå¤„ç†å¤æ‚é€»è¾‘ä»¥åŠæ•°æ®å¤„ç†æ“ä½œï¼Œåœ¨å®é™…å¼€å‘ä¸­å¯ä»¥æ ¹æ®éœ€æ±‚åˆ›å»ºå¤šä¸ªbackgroundMOCã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨backgroundMOCæ‰§è¡Œå®Œsaveæ–¹æ³•åï¼Œåˆåœ¨mainMOCä¸­æ‰§è¡Œäº†ä¸€æ¬¡saveæ–¹æ³•ï¼Œè¿™æ­¥æ˜¯å¾ˆé‡è¦çš„ã€‚</p>

<h4>iOS5ä¹‹å‰è¿›è¡Œæ•°æ®åŒæ­¥</h4>

<p>å°±åƒä¸Šé¢ç« èŠ‚ä¸­è®²åˆ°çš„ï¼Œåœ¨iOS5ä¹‹å‰å­˜åœ¨å¤šä¸ªMOCçš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªMOCå‘ç”Ÿæ›´æ”¹å¹¶æäº¤å­˜å‚¨åŒºåï¼Œå…¶ä»–MOCå¹¶ä¸çŸ¥é“è¿™ä¸ªæ”¹å˜ï¼Œå…¶ä»–MOCå’Œæœ¬åœ°å­˜å‚¨çš„æ•°æ®æ˜¯ä¸åŒæ­¥çš„ï¼Œæ‰€ä»¥å°±æ¶‰åŠåˆ°æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚</p>

<p>è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œä¼šé‡åˆ°å¤šç§å¤æ‚æƒ…å†µã€‚ä¾‹å¦‚åªæœ‰ä¸€ä¸ªMOCæ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ä»–MOCæ›´æ–°æ—¶å¹¶æ²¡æœ‰å¯¹ç›¸åŒçš„æ•°æ®åšæ”¹å˜ï¼Œè¿™æ ·ä¸ä¼šé€ æˆå†²çªï¼Œå¯ä»¥ç›´æ¥å°†å…¶ä»–MOCæ›´æ–°ã€‚</p>

<p>å¦‚æœåœ¨ä¸€ä¸ªMOCæ•°æ®å‘ç”Ÿæ”¹å˜åï¼Œå…¶ä»–MOCå¯¹ç›¸åŒçš„æ•°æ®åšäº†æ”¹å˜ï¼Œè€Œä¸”æ”¹å˜çš„ç»“æœä¸åŒï¼Œè¿™æ ·åœ¨åŒæ­¥æ—¶å°±ä¼šé€ æˆå†²çªã€‚ä¸‹é¢å°†ä¼šæŒ‰ç…§è¿™ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«è®²ä¸€ä¸‹ä¸åŒæƒ…å†µä¸‹çš„å†²çªå¤„ç†æ–¹å¼ã€‚</p>

<h4>ç®€å•æƒ…å†µä¸‹çš„æ•°æ®åŒæ­¥</h4>

<p>ç®€å•æƒ…å†µä¸‹çš„æ•°æ®åŒæ­¥ï¼Œæ˜¯é’ˆå¯¹äºåªæœ‰ä¸€ä¸ªMOCçš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œå¹¶æäº¤å­˜å‚¨åŒºåï¼Œå…¶ä»–MOCæ›´æ–°æ—¶å¹¶æ²¡æœ‰å¯¹ç›¸åŒçš„æ•°æ®åšæ”¹å˜ï¼Œåªæ˜¯å•çº¯çš„åŒæ­¥æ•°æ®çš„æƒ…å†µã€‚</p>

<p>åœ¨NSManagedObjectContextç±»ä¸­ï¼Œæ ¹æ®ä¸åŒæ“ä½œå®šä¹‰äº†ä¸€äº›é€šçŸ¥ã€‚åœ¨ä¸€ä¸ªMOCå‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ä»–åœ°æ–¹å¯ä»¥é€šè¿‡MOCä¸­å®šä¹‰çš„é€šçŸ¥åï¼Œæ¥è·å–MOCå‘ç”Ÿçš„æ”¹å˜ã€‚åœ¨NSManagedObjectContextä¸­å®šä¹‰äº†ä¸‹é¢ä¸‰ä¸ªé€šçŸ¥ï¼š</p>

<pre><code>NSManagedObjectContextWillSaveNotificationï¼šMOCå°†è¦å‘å­˜å‚¨åŒºå­˜å‚¨æ•°æ®æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªé€šçŸ¥ã€‚åœ¨è¿™ä¸ªé€šçŸ¥ä¸­ä¸èƒ½è·å–å‘ç”Ÿæ”¹å˜ç›¸å…³çš„NSManagedObjectå¯¹è±¡ã€‚

NSManagedObjectContextDidSaveNotificationï¼šMOCå‘å­˜å‚¨åŒºå­˜å‚¨æ•°æ®åï¼Œè°ƒç”¨è¿™ä¸ªé€šçŸ¥ã€‚åœ¨è¿™ä¸ªé€šçŸ¥ä¸­å¯ä»¥è·å–æ”¹å˜ã€æ·»åŠ ã€åˆ é™¤ç­‰ä¿¡æ¯ï¼Œä»¥åŠç›¸å…³è”çš„NSManagedObjectå¯¹è±¡ã€‚

NSManagedObjectContextObjectsDidChangeNotificationï¼šåœ¨MOCä¸­ä»»ä½•ä¸€ä¸ªæ‰˜ç®¡å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªé€šçŸ¥ã€‚ä¾‹å¦‚ä¿®æ”¹æ‰˜ç®¡å¯¹è±¡çš„å±æ€§ã€‚
</code></pre>

<p>é€šè¿‡ç›‘å¬NSManagedObjectContextDidSaveNotificationé€šçŸ¥ï¼Œè·å–æ‰€æœ‰MOCçš„saveæ“ä½œã€‚</p>

<pre><code>[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(settingsContext:) name:NSManagedObjectContextDidSaveNotification object:nil];
</code></pre>

<p>ä¸éœ€è¦åœ¨é€šçŸ¥çš„å›è°ƒæ–¹æ³•ä¸­ï¼Œç¼–å†™ä»£ç å¯¹æ¯”è¢«ä¿®æ”¹çš„æ‰˜ç®¡å¯¹è±¡ã€‚MOCä¸ºæˆ‘ä»¬æä¾›äº†ä¸‹é¢çš„æ–¹æ³•ï¼Œåªéœ€è¦å°†é€šçŸ¥å¯¹è±¡ä¼ å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åŒæ­¥æ•°æ®ã€‚</p>

<pre><code>- (void)mergeChangesFromContextDidSaveNotification:(NSNotification *)notification;
</code></pre>

<p>ä¸‹é¢æ˜¯é€šçŸ¥ä¸­çš„å®ç°ä»£ç ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºé€šçŸ¥æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œåœ¨é€šçŸ¥å¯¹åº”çš„å›è°ƒæ–¹æ³•ä¸­æ‰€å¤„çš„çº¿ç¨‹ï¼Œå’Œå‘å‡ºé€šçŸ¥çš„MOCæ‰§è¡Œæ“ä½œæ—¶æ‰€å¤„çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç³»ç»ŸperformBlock:å›è°ƒæ–¹æ³•åˆ†é…çš„çº¿ç¨‹ã€‚</p>

<p>æ‰€ä»¥å…¶ä»–MOCåœ¨é€šçŸ¥å›è°ƒæ–¹æ³•ä¸­ï¼Œéœ€è¦æ³¨æ„ä½¿ç”¨performBlock:æ–¹æ³•ï¼Œå¹¶åœ¨blockä½“ä¸­æ‰§è¡Œæ“ä½œã€‚</p>

<pre><code>- (void)settingsContext:(NSNotification *)noti {
    [context performBlock:^{
        // è°ƒç”¨éœ€è¦åŒæ­¥çš„MOCå¯¹è±¡çš„mergeæ–¹æ³•ï¼Œç›´æ¥å°†é€šçŸ¥å¯¹è±¡å½“åšå‚æ•°ä¼ è¿›å»å³å¯ï¼Œç³»ç»Ÿä¼šå®ŒæˆåŒæ­¥æ“ä½œã€‚
        [context mergeChangesFromContextDidSaveNotification:noti];
    }];
}
</code></pre>

<h4>å¤æ‚æƒ…å†µä¸‹çš„æ•°æ®åŒæ­¥</h4>

<p>åœ¨ä¸€ä¸ªMOCå¯¹æœ¬åœ°å­˜å‚¨åŒºçš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œè€Œå…¶ä»–MOCä¹Ÿå¯¹åŒæ ·çš„æ•°æ®åšäº†æ”¹å˜ï¼Œè¿™æ ·åé¢æ‰§è¡Œsaveæ“ä½œçš„MOCå°±ä¼šå†²çªï¼Œå¹¶å¯¼è‡´åé¢çš„saveæ“ä½œå¤±è´¥ï¼Œè¿™å°±æ˜¯å¤æ‚æƒ…å†µä¸‹çš„æ•°æ®åˆå¹¶ã€‚</p>

<p>è¿™æ˜¯å› ä¸ºæ¯æ¬¡ä¸€ä¸ªMOCæ‰§è¡Œä¸€æ¬¡fetchæ“ä½œåï¼Œä¼šä¿å­˜ä¸€ä¸ªæœ¬åœ°æŒä¹…åŒ–å­˜å‚¨çš„çŠ¶æ€ï¼Œå½“ä¸‹æ¬¡æ‰§è¡Œsaveæ“ä½œæ—¶ä¼šå¯¹æ¯”è¿™ä¸ªçŠ¶æ€å’Œæœ¬åœ°æŒä¹…åŒ–çŠ¶æ€æ˜¯å¦ä¸€æ ·ã€‚å¦‚æœä¸€æ ·ï¼Œåˆ™ä»£è¡¨æœ¬åœ°æ²¡æœ‰å…¶ä»–MOCå¯¹å­˜å‚¨å‘ç”Ÿè¿‡æ”¹å˜ï¼›å¦‚æœä¸ä¸€æ ·ï¼Œåˆ™ä»£è¡¨æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨è¢«å…¶ä»–MOCæ”¹å˜è¿‡ï¼Œè¿™å°±æ˜¯é€ æˆå†²çªçš„æ ¹æœ¬åŸå› ã€‚</p>

<p>å¯¹äºè¿™ç§å†²çªçš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡MOCå¯¹è±¡æŒ‡å®šè§£å†³å†²çªçš„æ–¹æ¡ˆï¼Œé€šè¿‡mergePolicyå±æ€§æ¥è®¾ç½®æ–¹æ¡ˆã€‚mergePolicyå±æ€§æœ‰ä¸‹é¢å‡ ç§å¯é€‰çš„ç­–ç•¥ï¼Œé»˜è®¤æ˜¯NSErrorMergePolicyæ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªæœ‰NSErrorè¿”å›å€¼çš„é€‰é¡¹ã€‚</p>

<pre><code>NSErrorMergePolicy : é»˜è®¤å€¼ï¼Œå½“å‡ºç°åˆå¹¶å†²çªæ—¶ï¼Œè¿”å›ä¸€ä¸ªNSErrorå¯¹è±¡æ¥æè¿°é”™è¯¯ï¼Œè€ŒMOCå’ŒæŒä¹…åŒ–å­˜å‚¨åŒºä¸å‘ç”Ÿæ”¹å˜ã€‚

NSMergeByPropertyStoreTrumpMergePolicy : ä»¥æœ¬åœ°å­˜å‚¨ä¸ºå‡†ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¥è¦†ç›–å†²çªéƒ¨åˆ†ã€‚

NSMergeByPropertyObjectTrumpMergePolicy : ä»¥MOCçš„ä¸ºå‡†ï¼Œä½¿ç”¨MOCæ¥è¦†ç›–æœ¬åœ°å­˜å‚¨çš„å†²çªéƒ¨åˆ†ã€‚

NSOverwriteMergePolicy : ä»¥MOCä¸ºå‡†ï¼Œç”¨MOCçš„æ‰€æœ‰NSManagedObjectå¯¹è±¡è¦†ç›–æœ¬åœ°å­˜å‚¨çš„å¯¹åº”å¯¹è±¡ã€‚

NSRollbackMergePolicy : ä»¥æœ¬åœ°å­˜å‚¨ä¸ºå‡†ï¼ŒMOCæ‰€æœ‰çš„NSManagedObjectå¯¹è±¡è¢«æœ¬åœ°å­˜å‚¨çš„å¯¹åº”å¯¹è±¡æ‰€è¦†ç›–ã€‚
</code></pre>

<p>ä¸Šé¢äº”ç§ç­–ç•¥ä¸­ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªNSErrorMergePolicyçš„ç­–ç•¥ï¼Œå…¶ä»–å››ç§ä¸­NSMergeByPropertyStoreTrumpMergePolicyå’ŒNSRollbackMergePolicyï¼Œä»¥åŠNSMergeByPropertyObjectTrumpMergePolicyå’ŒNSOverwriteMergePolicyçœ‹èµ·æ¥æ˜¯é‡å¤çš„ã€‚</p>

<p>å…¶å®å®ƒä»¬å¹¶ä¸æ˜¯å†²çªçš„ï¼Œè¿™å››ç§ç­–ç•¥çš„ä¸åŒä½“ç°åœ¨ï¼Œå¯¹æ²¡æœ‰å‘ç”Ÿå†²çªçš„éƒ¨åˆ†åº”è¯¥æ€ä¹ˆå¤„ç†ã€‚NSMergeByPropertyStoreTrumpMergePolicyå’ŒNSMergeByPropertyObjectTrumpMergePolicyå¯¹æ²¡æœ‰å†²çªçš„éƒ¨åˆ†ï¼Œæœªå†²çªéƒ¨åˆ†æ•°æ®å¹¶ä¸ä¼šå—åˆ°å½±å“ã€‚è€ŒNSRollbackMergePolicyå’ŒNSOverwriteMergePolicyåˆ™æ˜¯æ— è®ºæ˜¯å¦å†²çªï¼Œç›´æ¥å…¨éƒ¨æ›¿æ¢ã€‚</p>

<blockquote><p>é¢˜å¤–è¯ï¼šå¯¹äºMOCçš„è¿™ç§åˆå¹¶ç­–ç•¥æ¥çœ‹ï¼Œæœ‰æœ¨æœ‰æ„Ÿè§‰åˆ°CoreDataè§£å†³å†²çªçš„æ–¹å¼ï¼Œå’ŒSVNè§£å†³å†²çªçš„æ–¹å¼ç‰¹åˆ«åƒã€‚ã€‚ã€‚</p></blockquote>

<h4>çº¿ç¨‹å®‰å…¨</h4>

<p>æ— è®ºæ˜¯MOCè¿˜æ˜¯æ‰˜ç®¡å¯¹è±¡ï¼Œéƒ½ä¸åº”è¯¥åœ¨å…¶ä»–MOCçš„çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸¤ä¸ªAPIéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†MOCå¯ä»¥åœ¨å…¶ä»–MOCçº¿ç¨‹ä¸­è°ƒç”¨performBlock:æ–¹æ³•ï¼Œåˆ‡æ¢åˆ°è‡ªå·±çš„çº¿ç¨‹æ‰§è¡Œæ“ä½œã€‚</p>

<p>å¦‚æœå…¶ä»–MOCæƒ³è¦æ‹¿åˆ°æ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶åœ¨è‡ªå·±çš„é˜Ÿåˆ—ä¸­ä½¿ç”¨æ‰˜ç®¡å¯¹è±¡ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ï¼Œæ‰˜ç®¡å¯¹è±¡æ˜¯ä¸èƒ½ç›´æ¥ä¼ é€’åˆ°å…¶ä»–MOCçš„çº¿ç¨‹çš„ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡è·å–NSManagedObjectçš„NSManagedObjectIDå¯¹è±¡ï¼Œåœ¨å…¶ä»–MOCä¸­é€šè¿‡NSManagedObjectIDå¯¹è±¡ï¼Œä»æŒä¹…åŒ–å­˜å‚¨åŒºä¸­è·å–NSManagedObjectå¯¹è±¡ï¼Œè¿™æ ·å°±æ˜¯å…è®¸çš„ã€‚NSManagedObjectIDæ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”å¯ä»¥è·¨çº¿ç¨‹ä½¿ç”¨çš„ã€‚</p>

<p>å¯ä»¥é€šè¿‡MOCè·å–NSManagedObjectIDå¯¹åº”çš„NSManagedObjectå¯¹è±¡ï¼Œä¾‹å¦‚ä¸‹é¢å‡ ä¸ªMOCçš„APIã€‚</p>

<pre><code>NSManagedObject *object = [context objectRegisteredForID:objectID];
NSManagedObject *object = [context objectWithID:objectID];
</code></pre>

<p>é€šè¿‡NSManagedObjectå¯¹è±¡çš„objectIDå±æ€§ï¼Œè·å–NSManagedObjectIDç±»å‹çš„objectIDå¯¹è±¡ã€‚</p>

<p>NSManagedObjectID *objectID = object.objectID;</p>

<h4>CoreDataå¤šçº¿ç¨‹ç»“æ„è®¾è®¡</h4>

<p>ä¸Šé¢ç« èŠ‚ä¸­å†™çš„å¤§å¤šéƒ½æ˜¯æ€ä¹ˆç”¨CoreDataå¤šçº¿ç¨‹ï¼Œåœ¨æŒæ¡å¤šçº¿ç¨‹çš„ä½¿ç”¨åï¼Œå°±å¯ä»¥æ ¹æ®å…¬å¸ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾è®¡ä¸€å¥—CoreDataå¤šçº¿ç¨‹ç»“æ„äº†ã€‚å¯¹äºå¤šçº¿ç¨‹ç»“æ„çš„è®¾è®¡ï¼Œåº”è¯¥æœ¬ç€å°½é‡å‡å°‘ä¸»çº¿ç¨‹å‹åŠ›çš„è§’åº¦å»è®¾è®¡ï¼Œå°†æ‰€æœ‰è€—æ—¶æ“ä½œéƒ½æ”¾åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>

<p>å¯¹äºå…·ä½“çš„è®¾è®¡æˆ‘æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ï¼Œç»™å‡ºä¸¤ç§è®¾è®¡æ–¹æ¡ˆçš„å»ºè®®ã€‚</p>

<h4>ä¸¤å±‚è®¾è®¡æ–¹æ¡ˆ</h4>

<ol>
<li>åœ¨é¡¹ç›®ä¸­å¤šçº¿ç¨‹æ“ä½œæ¯”è¾ƒç®€å•æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸»é˜Ÿåˆ—mainMOCï¼Œå’Œä¸€ä¸ªæˆ–å¤šä¸ªç§æœ‰é˜Ÿåˆ—çš„backgroundMOCã€‚å°†æ‰€æœ‰backgroundMOCçš„parentContextè®¾ç½®ä¸ºmainMOCï¼Œé‡‡å–è¿™æ ·çš„ä¸¤å±‚è®¾è®¡ä¸€èˆ¬å°±èƒ½å¤Ÿæ»¡è¶³å¤§å¤šæ•°éœ€æ±‚äº†ã€‚</li>
</ol>


<p><img src="http://al1020119.github.io/images/coredateduoxianchenganquan002.png" title="Caption" ></p>

<ol>
<li>å°†è€—æ—¶æ“ä½œéƒ½æ”¾åœ¨backgroundMOCä¸­æ‰§è¡Œï¼ŒmainMOCè´Ÿè´£æ‰€æœ‰å’ŒUIç›¸å…³çš„æ“ä½œã€‚æ‰€æœ‰å’ŒUIæ— å…³çš„å·¥ä½œéƒ½äº¤ç»™backgroundMOCï¼Œåœ¨backgroundMOCå¯¹æ•°æ®å‘ç”Ÿæ”¹å˜åï¼Œè°ƒç”¨saveæ–¹æ³•ä¼šå°†æ”¹å˜pushåˆ°mainMOCä¸­ï¼Œå†ç”±mainMOCæ‰§è¡Œsaveæ–¹æ³•å°†æ”¹å˜ä¿å­˜åˆ°å­˜å‚¨åŒºã€‚</li>
</ol>


<p>ä»£ç è¿™é‡Œå°±ä¸å†™äº†ï¼Œå’Œä¸Šé¢ä¾‹å­ä¸­è®¾ç½®parentContextä»£ç ä¸€æ ·ï¼Œä¸»è¦è®²ä¸€ä¸‹è®¾è®¡æ€è·¯ã€‚</p>

<h4>ä¸‰å±‚è®¾è®¡æ–¹æ¡ˆ</h4>

<ul>
<li>ä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œä¸Šé¢çš„saveæ“ä½œæœ€åè¿˜æ˜¯ç”±mainMOCå»æ‰§è¡Œçš„ï¼ŒbackgroundMOCåªæ˜¯è´Ÿè´£å¤„ç†æ•°æ®ã€‚è™½ç„¶mainMOCåªæ‰§è¡Œsaveæ“ä½œå¹¶ä¸ä¼šå¾ˆè€—æ—¶ï¼Œä½†æ˜¯å¦‚æœsaveæ¶‰åŠçš„æ•°æ®æ¯”è¾ƒå¤šï¼Œè¿™æ ·è¿˜æ˜¯ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“çš„ã€‚</li>
</ul>


<p>è™½ç„¶å®¢æˆ·ç«¯å¾ˆå°‘æ¶‰åŠåˆ°å¤§é‡æ•°æ®å¤„ç†çš„éœ€æ±‚ï¼Œä½†æ˜¯å‡è®¾æœ‰è¿™æ ·çš„éœ€æ±‚ã€‚å¯ä»¥è€ƒè™‘åœ¨ä¸¤å±‚ç»“æ„ä¹‹ä¸Šï¼Œç»™mainMOCä¹‹ä¸Šå†æ·»åŠ ä¸€ä¸ªparentMOCï¼Œè¿™ä¸ªparentMOCä¹Ÿæ˜¯ç§æœ‰é˜Ÿåˆ—çš„MOCï¼Œç”¨äºå¤„ç†saveæ“ä½œã€‚</p>

<p><img src="http://al1020119.github.io/images/coredateduoxianchenganquan003.png" title="Caption" ></p>

<ul>
<li>è¿™æ ·CoreDataå­˜å‚¨çš„ç»“æ„å°±æ˜¯ä¸‰å±‚äº†ï¼Œæœ€åº•å±‚æ˜¯backgroundMOCè´Ÿè´£å¤„ç†æ•°æ®ï¼Œä¸­é—´å±‚æ˜¯mainMOCè´Ÿè´£UIç›¸å…³æ“ä½œï¼Œæœ€ä¸Šå±‚ä¹Ÿæ˜¯ä¸€ä¸ªbackgroundMOCè´Ÿè´£æ‰§è¡Œsaveæ“ä½œã€‚è¿™æ ·å°±å°†å½±å“UIçš„æ‰€æœ‰è€—æ—¶æ“ä½œå…¨éƒ½å‰¥ç¦»åˆ°ç§æœ‰é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œä½¿æ€§èƒ½è¾¾åˆ°äº†å¾ˆå¥½çš„ä¼˜åŒ–ã€‚</li>
</ul>


<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡ŒMOCç›¸å…³æ“ä½œæ—¶ï¼Œä¸è¦é˜»å¡å½“å‰ä¸»çº¿ç¨‹ã€‚æ‰€æœ‰MOCçš„æ“ä½œåº”è¯¥æ˜¯å¼‚æ­¥çš„ï¼Œæ— è®ºæ˜¯å­çº¿ç¨‹è¿˜æ˜¯ä¸»çº¿ç¨‹ï¼Œå°½é‡å°‘çš„ä½¿ç”¨åŒæ­¥blockæ–¹æ³•ã€‚</p>

<h4>MOCåŒæ­¥æ—¶æœº</h4>

<p>è®¾ç½®MOCçš„parentContextå±æ€§ä¹‹åï¼Œparentå¯¹äºchildçš„æ”¹å˜æ˜¯çŸ¥é“çš„ï¼Œä½†æ˜¯childå¯¹äºparentçš„æ”¹å˜æ˜¯ä¸çŸ¥é“çš„ã€‚è‹¹æœè¿™æ ·è®¾è®¡ï¼Œåº”è¯¥æ˜¯ä¸ºäº†æ›´å¥½çš„æ•°æ®åŒæ­¥ã€‚</p>

<pre><code>Employee *emp = [NSEntityDescription insertNewObjectForEntityForName:@"Employee" inManagedObjectContext:backgroundMOC];
emp.name = @"lxz";
emp.brithday = [NSDate date];
emp.height = @1.7f;
[backgroundMOC performBlock:^{
    [backgroundMOC save:nil];
    [mainMOC performBlock:^{
        [mainMOC save:nil];
    }];
}];
</code></pre>

<p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼ŒmainMOCæ˜¯backgroundMOCçš„parentContextã€‚åœ¨backgroundMOCæ‰§è¡Œsaveæ–¹æ³•å‰ï¼ŒbackgroundMOCå’ŒmainMOCéƒ½ä¸èƒ½è·å–åˆ°Employeeçš„æ•°æ®ï¼Œåœ¨backgroundMOCæ‰§è¡Œå®Œsaveæ–¹æ³•åï¼Œè‡ªèº«ä¸Šä¸‹æ–‡å‘ç”Ÿæ”¹å˜çš„åŒæ—¶ï¼Œä¹Ÿå°†æ”¹å˜pushåˆ°mainMOCä¸­ï¼ŒmainMOCä¹Ÿå…·æœ‰äº†Employeeå¯¹è±¡ã€‚</p>

<p>æ‰€ä»¥åœ¨backgroundMOCçš„saveæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæ˜¯å¯¹å†…å­˜ä¸­çš„ä¸Šä¸‹æ–‡åšäº†æ”¹å˜ï¼Œå½“æ‹¥æœ‰PSCçš„mainMOCæ‰§è¡Œsaveæ–¹æ³•åï¼Œæ˜¯å¯¹æœ¬åœ°å­˜å‚¨åŒºåšäº†æ”¹å˜ã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CoreDataè£…é€¼æŠ€èƒ½ï¼Ÿ]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/04/coredatedzhuangbi/"/>
    <updated>2016-07-04T14:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/04/coredatedzhuangbi</id>
    <content type="html"><![CDATA[<p>æ­£æ–‡ï¼š</p>

<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œå·²ç»è®²äº†å¾ˆå¤šå…³äºCoreDataä½¿ç”¨ç›¸å…³çš„çŸ¥è¯†ç‚¹ã€‚è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®²ä¸¤ä¸ªæ–¹é¢ï¼ŒNSFetchedResultsControllerå’Œç‰ˆæœ¬è¿ç§»ã€‚</p>

<p>æ–‡ç« é¢˜ç›®ä¸­è™½ç„¶æœ‰â€œé«˜çº§â€ä¸¤ä¸ªå­—ï¼Œå…¶å®è®²çš„ä¸œè¥¿å¹¶ä¸é«˜çº§ï¼Œåªæ˜¯å› ä¸ºä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä¸œè¥¿å¤ªå¤šäº†ï¼ŒæŠŠä¸¤ä¸ªè¾ƒå¤æ‚çš„çŸ¥è¯†ç‚¹æŒªåˆ°è¿™ç¯‡æ–‡ç« ä¸­ã€‚</p>

<!--more-->


<p>æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼</p>

<p>NSFetchedResultsController</p>

<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¼šç»å¸¸ç”¨åˆ°UITableViewè¿™æ ·çš„è§†å›¾ç±»ï¼Œè¿™äº›è§†å›¾ç±»éœ€è¦è‡ªå·±ç®¡ç†å…¶æ•°æ®æºï¼ŒåŒ…æ‹¬ç½‘ç»œè·å–ã€æœ¬åœ°å­˜å‚¨éƒ½éœ€è¦å†™ä»£ç è¿›è¡Œç®¡ç†ã€‚</p>

<p>è€Œåœ¨CoreDataä¸­æä¾›äº†NSFetchedResultsControllerç±»(fetched results controllerï¼Œä¹Ÿå«FRC)ï¼ŒFRCå¯ä»¥ç®¡ç†UITableViewæˆ–UICollectionViewçš„æ•°æ®æºã€‚è¿™ä¸ªæ•°æ®æºä¸»è¦æŒ‡æœ¬åœ°æŒä¹…åŒ–çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ•°æ®æºé…åˆç€ç½‘ç»œè¯·æ±‚æ•°æ®ä¸€èµ·ä½¿ç”¨ï¼Œä¸»è¦çœ‹ä¸šåŠ¡éœ€æ±‚äº†ã€‚</p>

<p>æœ¬ç¯‡æ–‡ç« ä¼šä½¿ç”¨UITableViewä½œä¸ºè§†å›¾ç±»ï¼Œé…åˆNSFetchedResultsControllerè¿›è¡Œåé¢çš„æ¼”ç¤ºï¼ŒUICollectionViewé…åˆNSFetchedResultsControllerçš„ä½¿ç”¨ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸éƒ½è®²äº†ã€‚</p>

<p>ç®€å•ä»‹ç»</p>

<p>å°±åƒä¸Šé¢è¯´åˆ°çš„ï¼ŒNSFetchedResultsControllerå°±åƒæ˜¯ä¸Šé¢ä¸¤ç§è§†å›¾çš„æ•°æ®ç®¡ç†è€…ä¸€æ ·ã€‚FRCå¯ä»¥ç›‘å¬ä¸€ä¸ªMOCçš„æ”¹å˜ï¼Œå¦‚æœMOCæ‰§è¡Œäº†æ‰˜ç®¡å¯¹è±¡çš„å¢åˆ æ”¹æ“ä½œï¼Œå°±ä¼šå¯¹æœ¬åœ°æŒä¹…åŒ–æ•°æ®å‘ç”Ÿæ”¹å˜ï¼ŒFRCå°±ä¼šå›è°ƒå¯¹åº”çš„ä»£ç†æ–¹æ³•ï¼Œå›è°ƒæ–¹æ³•çš„å‚æ•°ä¼šåŒ…æ‹¬æ‰§è¡Œæ“ä½œçš„ç±»å‹ã€æ“ä½œçš„å€¼ã€indexPathç­‰å‚æ•°ã€‚</p>

<p>å®é™…ä½¿ç”¨æ—¶ï¼Œé€šè¿‡FRCâ€œç»‘å®šâ€ä¸€ä¸ªMOCï¼Œå°†UITableViewåµŒå…¥åœ¨FRCçš„æ‰§è¡Œæµç¨‹ä¸­ã€‚åœ¨ä»»ä½•åœ°æ–¹å¯¹è¿™ä¸ªâ€œç»‘å®šâ€çš„MOCå­˜å‚¨åŒºåšä¿®æ”¹ï¼Œéƒ½ä¼šè§¦å‘FRCçš„å›è°ƒæ–¹æ³•ï¼Œåœ¨FRCçš„å›è°ƒæ–¹æ³•ä¸­åµŒå…¥UITableViewä»£ç å¹¶åšå¯¹åº”ä¿®æ”¹å³å¯ã€‚</p>

<p>ç”±æ­¤å¯ä»¥çœ‹å‡ºFRCæœ€å¤§ä¼˜åŠ¿å°±æ˜¯ï¼Œå§‹ç»ˆå’Œæœ¬åœ°æŒä¹…åŒ–çš„æ•°æ®ä¿æŒç»Ÿä¸€ã€‚åªè¦æœ¬åœ°æŒä¹…åŒ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šè§¦å‘FRCçš„å›è°ƒæ–¹æ³•ï¼Œä»è€Œåœ¨å›è°ƒæ–¹æ³•ä¸­æ›´æ–°ä¸Šå±‚æ•°æ®æºå’ŒUIã€‚è¿™ç§æ–¹å¼è®²çš„ç®€å•ä¸€ç‚¹ï¼Œå°±å¯ä»¥å«åšæ•°æ®å¸¦åŠ¨UIã€‚</p>

<p><img src="http://al1020119.github.io/images/4001.png" title="Caption" ></p>

<p>FRC</p>

<p>ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨FRCçš„åˆå§‹åŒ–ä¸­ä¼ å…¥äº†ä¸€ä¸ªMOCå‚æ•°ï¼ŒFRCåªèƒ½ç›‘æµ‹ä¼ å…¥çš„MOCå‘ç”Ÿçš„æ”¹å˜ã€‚å‡è®¾å…¶ä»–MOCå¯¹åŒä¸€ä¸ªå­˜å‚¨åŒºå‘ç”Ÿäº†æ”¹å˜ï¼ŒFRCåˆ™ä¸èƒ½ç›‘æµ‹åˆ°è¿™ä¸ªå˜åŒ–ï¼Œä¸ä¼šåšå‡ºä»»ä½•ååº”ã€‚</p>

<p>æ‰€ä»¥ä½¿ç”¨FRCæ—¶ï¼Œéœ€è¦æ³¨æ„FRCåªèƒ½å¯¹ä¸€ä¸ªMOCçš„å˜åŒ–åšå‡ºååº”ï¼Œæ‰€ä»¥åœ¨CoreDataæŒä¹…åŒ–å±‚è®¾è®¡æ—¶ï¼Œå°½é‡ä¸€ä¸ªå­˜å‚¨åŒºåªå¯¹åº”ä¸€ä¸ªMOCï¼Œæˆ–è®¾ç½®ä¸€ä¸ªè´Ÿè´£UIçš„MOCï¼Œè¿™åœ¨åé¢å¤šçº¿ç¨‹éƒ¨åˆ†ä¼šè¯¦ç»†è®²è§£ã€‚</p>

<p>ä¿®æ”¹æ¨¡å‹æ–‡ä»¶ç»“æ„</p>

<p>åœ¨å†™ä»£ç ä¹‹å‰ï¼Œå…ˆå¯¹ä¹‹å‰çš„æ¨¡å‹æ–‡ä»¶ç»“æ„åšä¸€äº›ä¿®æ”¹ã€‚</p>

<p><img src="http://al1020119.github.io/images/4002.png" title="Caption" ></p>

<p>Employeeç»“æ„</p>

<p>è®²FRCçš„æ—¶å€™ï¼Œåªéœ€è¦ç”¨åˆ°Employeeè¿™ä¸€å¼ è¡¨ï¼Œå…¶ä»–è¡¨å’Œè®¾ç½®ç›´æ¥å¿½ç•¥ã€‚éœ€è¦åœ¨EmployeeåŸæœ‰å­—æ®µçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªStringç±»å‹çš„sectionNameå­—æ®µï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯ç”¨æ¥å­˜å‚¨section titleçš„ï¼Œåœ¨ä¸‹é¢çš„æ–‡ç« ä¸­å°†ä¼šè¯¦ç»†è®²åˆ°ã€‚</p>

<p>åˆå§‹åŒ–FRC</p>

<p>ä¸‹é¢ä¾‹å­æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„FRCåˆå§‹åŒ–æ–¹å¼ï¼Œåˆå§‹åŒ–æ—¶æŒ‡å®šçš„MOCï¼Œè¿˜ç”¨ä¹‹å‰è®²è¿‡çš„MOCåˆå§‹åŒ–ä»£ç ï¼ŒUITableViewåˆå§‹åŒ–ä»£ç è¿™é‡Œä¹Ÿçœç•¥äº†ï¼Œä¸»è¦çªå‡ºFRCçš„åˆå§‹åŒ–ã€‚</p>

<pre><code>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
// è®¾ç½®æ’åºè§„åˆ™ï¼ŒæŒ‡æ˜æ ¹æ®heightå­—æ®µå‡åºæ’åº
NSSortDescriptor *heightSort = [NSSortDescriptor sortDescriptorWithKey:@"height" ascending:YES];
request.sortDescriptors = @[heightSort];
// åˆ›å»ºNSFetchedResultsControlleræ§åˆ¶å™¨å®ä¾‹ï¼Œå¹¶ç»‘å®šMOC
NSError *error = nil;
fetchedResultController = [[NSFetchedResultsController alloc] initWithFetchRequest:request
                                                 managedObjectContext:context
                                        sectionNameKeyPath:@"sectionName"
                                               cacheName:nil];
// è®¾ç½®ä»£ç†ï¼Œå¹¶éµå®ˆåè®®
fetchedResultController.delegate = self;
// æ‰§è¡Œè·å–è¯·æ±‚ï¼Œæ‰§è¡ŒåFRCä¼šä»æŒä¹…åŒ–å­˜å‚¨åŒºåŠ è½½æ•°æ®ï¼Œå…¶ä»–åœ°æ–¹å¯ä»¥é€šè¿‡FRCè·å–æ•°æ®
[fetchedResultController performFetch:&amp;error];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"NSFetchedResultsController init error : %@", error);
}
// åˆ·æ–°UI
[tableView reloadData];
</code></pre>

<p>åœ¨ä¸Šé¢åˆå§‹åŒ–FRCæ—¶ï¼Œä¼ å…¥çš„sectionNameKeyPath:å‚æ•°ï¼Œæ˜¯æŒ‡æ˜å½“å‰æ‰˜ç®¡å¯¹è±¡çš„å“ªä¸ªå±æ€§å½“åšsectionçš„titleï¼Œåœ¨æœ¬æ–‡ä¸­å°±æ˜¯Employeeè¡¨çš„sectionNameå­—æ®µä¸ºsectionçš„titleã€‚ä»NSFetchedResultsSectionInfoåè®®çš„indexTitleå±æ€§è·å–è¿™ä¸ªå€¼ã€‚</p>

<p>åœ¨sectionNameKeyPath:è®¾ç½®å±æ€§ååï¼Œå°±ä»¥è¿™ä¸ªå±æ€§åä½œä¸ºåˆ†ç»„titleï¼Œç›¸åŒçš„titleä¼šè¢«åˆ†åˆ°ä¸€ä¸ªsectionä¸­ã€‚</p>

<p>åˆå§‹åŒ–FRCæ—¶å‚æ•°managedObjectContext:ä¼ å…¥äº†ä¸€ä¸ªMOCå‚æ•°ï¼ŒFRCåªèƒ½ç›‘æµ‹è¿™ä¸ªä¼ å…¥çš„MOCå‘ç”Ÿçš„æœ¬åœ°æŒä¹…åŒ–æ”¹å˜ã€‚å°±åƒä¸Šé¢ä»‹ç»æ—¶è¯´çš„ï¼Œå…¶ä»–MOCå¯¹åŒä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åŒºå‘ç”Ÿçš„æ”¹å˜ï¼ŒFRCåˆ™ä¸èƒ½ç›‘æµ‹åˆ°è¿™ä¸ªå˜åŒ–ã€‚</p>

<p>å†å¾€åé¢çœ‹åˆ°cacheName:å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æˆ‘è®¾ç½®çš„æ˜¯nilã€‚å‚æ•°çš„ä½œç”¨æ˜¯å¼€å¯FRCçš„ç¼“å­˜ï¼Œå¯¹è·å–çš„æ•°æ®è¿›è¡Œç¼“å­˜å¹¶æŒ‡å®šä¸€ä¸ªåå­—ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨deleteCacheWithName:æ–¹æ³•æ‰‹åŠ¨åˆ é™¤ç¼“å­˜ã€‚</p>

<p>ä½†æ˜¯è¿™ä¸ªç¼“å­˜å¹¶æ²¡æœ‰å¿…è¦ï¼Œç¼“å­˜æ˜¯æ ¹æ®NSFetchRequestå¯¹è±¡æ¥åŒ¹é…çš„ï¼Œå¦‚æœå½“å‰è·å–çš„æ•°æ®å’Œä¹‹å‰ç¼“å­˜çš„ç›¸åŒ¹é…åˆ™ç›´æ¥æ‹¿æ¥ç”¨ï¼Œä½†æ˜¯åœ¨è·å–æ•°æ®æ—¶æ¯æ¬¡è·å–çš„æ•°æ®éƒ½å¯èƒ½ä¸åŒï¼Œç¼“å­˜ä¸èƒ½è¢«å‘½ä¸­åˆ™å¾ˆéš¾æ´¾ä¸Šç”¨åœºï¼Œè€Œä¸”ç¼“å­˜è¿˜å ç”¨ç€å†…å­˜èµ„æºã€‚</p>

<p>åœ¨FRCåˆå§‹åŒ–å®Œæˆåï¼Œè°ƒç”¨performFetch:æ–¹æ³•æ¥åŒæ­¥è·å–æŒä¹…åŒ–å­˜å‚¨åŒºæ•°æ®ï¼Œè°ƒç”¨æ­¤æ–¹æ³•åFRCä¿å­˜æ•°æ®çš„å±æ€§æ‰ä¼šæœ‰å€¼ã€‚è·å–åˆ°æ•°æ®åï¼Œè°ƒç”¨tableViewçš„reloadDataæ–¹æ³•ï¼Œä¼šå›è°ƒtableViewçš„ä»£ç†æ–¹æ³•ï¼Œå¯ä»¥åœ¨tableViewçš„ä»£ç†æ–¹æ³•ä¸­è·å–åˆ°FRCçš„æ•°æ®ã€‚è°ƒç”¨performFetch:æ–¹æ³•ç¬¬ä¸€æ¬¡è·å–åˆ°æ•°æ®å¹¶ä¸ä¼šå›è°ƒFRCä»£ç†æ–¹æ³•ã€‚</p>

<p>ä»£ç†æ–¹æ³•</p>

<p>FRCä¸­åŒ…å«UITableViewæ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦çš„ç›¸å…³æ•°æ®ï¼Œå¯ä»¥é€šè¿‡FRCçš„sectionså±æ€§ï¼Œè·å–ä¸€ä¸ªéµå®ˆåè®®çš„å¯¹è±¡æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªsectionã€‚</p>

<p>åœ¨è¿™ä¸ªåè®®ä¸­æœ‰å¦‚ä¸‹å®šä¹‰ï¼Œå¯ä»¥çœ‹å‡ºè¿™äº›å±æ€§å’ŒUITableViewçš„æ‰§è¡Œæµç¨‹æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚</p>

<pre><code>@protocol NSFetchedResultsSectionInfo
/* Name of the section */
@property (nonatomic, readonly) NSString *name;
/* Title of the section (used when displaying the index) */
@property (nullable, nonatomic, readonly) NSString *indexTitle;
/* Number of objects in section */
@property (nonatomic, readonly) NSUInteger numberOfObjects;
/* Returns the array of objects in the section. */
@property (nullable, nonatomic, readonly) NSArray *objects;
@end // NSFetchedResultsSectionInfo
</code></pre>

<p>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åº”è¯¥å°†FRCå’ŒUITableViewç›¸äº’åµŒå¥—ï¼Œåœ¨FRCçš„å›è°ƒæ–¹æ³•ä¸­åµŒå¥—UITableViewçš„è§†å›¾æ”¹å˜é€»è¾‘ï¼Œåœ¨UITableViewçš„å›è°ƒä¸­åµŒå¥—æ•°æ®æ›´æ–°çš„é€»è¾‘ã€‚è¿™æ ·å¯ä»¥å§‹ç»ˆä¿è¯æ•°æ®å’ŒUIçš„åŒæ­¥ï¼Œåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­å°†ä¼šæ¼”ç¤ºFRCå’ŒUITableViewçš„ç›¸äº’åµŒå¥—ã€‚</p>

<pre><code>Table View Delegate

// é€šè¿‡FRCçš„sectionsæ•°ç»„å±æ€§ï¼Œè·å–æ‰€æœ‰sectionçš„countå€¼
- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {
    return fetchedResultController.sections.count;
}
// é€šè¿‡å½“å‰sectionçš„ä¸‹æ ‡ä»sectionsæ•°ç»„ä¸­å–å‡ºå¯¹åº”çš„sectionå¯¹è±¡ï¼Œå¹¶ä»sectionå¯¹è±¡ä¸­è·å–æ‰€æœ‰å¯¹è±¡count
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return fetchedResultController.sections[section].numberOfObjects;
}
// FRCæ ¹æ®indexPathè·å–æ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶ç»™cellèµ‹å€¼
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    Employee *emp = [fetchedResultController objectAtIndexPath:indexPath];
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"identifier" forIndexPath:indexPath];
    cell.textLabel.text = emp.name;
    return cell;
}
// åˆ›å»ºFRCå¯¹è±¡æ—¶ï¼Œé€šè¿‡sectionNameKeyPath:ä¼ é€’è¿›å»çš„section titleçš„å±æ€§åï¼Œåœ¨è¿™é‡Œè·å–å¯¹åº”çš„å±æ€§å€¼
- (NSString *)tableView:(UITableView *)tableView titleForHeaderInSection:(NSInteger)section {
    return fetchedResultController.sections[section].indexTitle;
}
// æ˜¯å¦å¯ä»¥ç¼–è¾‘
- (BOOL)tableView:(UITableView *)tableView canEditRowAtIndexPath:(NSIndexPath *)indexPath {
    return YES;
}
// è¿™é‡Œæ˜¯ç®€å•æ¨¡æ‹ŸUIåˆ é™¤cellåï¼Œæœ¬åœ°æŒä¹…åŒ–åŒºæ•°æ®å’ŒUIåŒæ­¥çš„æ“ä½œã€‚åœ¨è°ƒç”¨ä¸‹é¢MOCä¿å­˜ä¸Šä¸‹æ–‡æ–¹æ³•åï¼ŒFRCä¼šå›è°ƒä»£ç†æ–¹æ³•å¹¶æ›´æ–°UI
- (void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath {
     if (editingStyle == UITableViewCellEditingStyleDelete) {
        // åˆ é™¤æ‰˜ç®¡å¯¹è±¡
        Employee *emp = [fetchedResultController objectAtIndexPath:indexPath];
        [context deleteObject:emp];
        // ä¿å­˜ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶åšé”™è¯¯å¤„ç†
        NSError *error = nil;
        if (![context save:&amp;error]) {
            NSLog(@"tableView delete cell error : %@", error);
        }
    }
}
</code></pre>

<p>ä¸Šé¢æ˜¯UITableViewçš„ä»£ç†æ–¹æ³•ï¼Œä»£ç†æ–¹æ³•ä¸­åµŒå¥—äº†FRCçš„æ•°æ®è·å–ä»£ç ï¼Œè¿™æ ·åœ¨åˆ·æ–°è§†å›¾æ—¶å°±å¯ä»¥ä¿è¯ä½¿ç”¨æœ€æ–°çš„æ•°æ®ã€‚å¹¶ä¸”åœ¨ä»£ç ä¸­ç®€å•å®ç°äº†åˆ é™¤cellåï¼Œé€šè¿‡MOCè°ƒç”¨åˆ é™¤æ“ä½œï¼Œä½¿æœ¬åœ°æŒä¹…åŒ–æ•°æ®å’ŒUIä¿æŒä¸€è‡´ã€‚</p>

<p>å°±åƒä¸Šé¢cellForRowAtIndexPath:æ–¹æ³•ä¸­ä½¿ç”¨çš„ä¸€æ ·ï¼ŒFRCæä¾›äº†ä¸¤ä¸ªæ–¹æ³•è½»æ¾è½¬æ¢indexPathå’ŒNSManagedObjectçš„å¯¹è±¡ï¼Œåœ¨å®é™…å¼€å‘ä¸­è¿™ä¸¤ä¸ªæ–¹æ³•éå¸¸å®ç”¨ï¼Œè¿™ä¹Ÿæ˜¯FRCå’ŒUITableViewã€UICollectionViewæ·±åº¦èåˆçš„è¡¨ç°ã€‚</p>

<pre><code>- (id)objectAtIndexPath:(NSIndexPath *)indexPath;
- (nullable NSIndexPath *)indexPathForObject:(id)object;
</code></pre>

<p>Fetched Results Controller Delegate</p>

<pre><code>// Cellæ•°æ®æºå‘ç”Ÿæ”¹å˜ä¼šå›è°ƒæ­¤æ–¹æ³•ï¼Œä¾‹å¦‚æ·»åŠ æ–°çš„æ‰˜ç®¡å¯¹è±¡ç­‰
- (void)controller:(NSFetchedResultsController *)controller didChangeObject:(id)anObject atIndexPath:(nullable NSIndexPath *)indexPath forChangeType:(NSFetchedResultsChangeType)type newIndexPath:(nullable NSIndexPath *)newIndexPath {
    switch (type) {
        case NSFetchedResultsChangeInsert:
            [tableView insertRowsAtIndexPaths:@[newIndexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeDelete:
            [tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeMove:
            [tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            [tableView insertRowsAtIndexPaths:@[newIndexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeUpdate: {
            UITableViewCell *cell = [tableView cellForRowAtIndexPath:indexPath];
            Employee *emp = [fetchedResultController objectAtIndexPath:indexPath];
            cell.textLabel.text = emp.name;
        }
            break;
    }
}
// Sectionæ•°æ®æºå‘ç”Ÿæ”¹å˜å›è°ƒæ­¤æ–¹æ³•ï¼Œä¾‹å¦‚ä¿®æ”¹section titleç­‰ã€‚
- (void)controller:(NSFetchedResultsController *)controller didChangeSection:(id &lt;nsfetchedresultssectioninfo&gt;)sectionInfo atIndex:(NSUInteger)sectionIndex forChangeType:(NSFetchedResultsChangeType)type {
    switch (type) {
        case NSFetchedResultsChangeInsert:
            [tableView insertSections:[NSIndexSet indexSetWithIndex:sectionIndex] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        case NSFetchedResultsChangeDelete:
            [tableView deleteSections:[NSIndexSet indexSetWithIndex:sectionIndex] withRowAnimation:UITableViewRowAnimationAutomatic];
            break;
        default:
            break;
    }
}
// æœ¬åœ°æ•°æ®æºå‘ç”Ÿæ”¹å˜ï¼Œå°†è¦å¼€å§‹å›è°ƒFRCä»£ç†æ–¹æ³•ã€‚
- (void)controllerWillChangeContent:(NSFetchedResultsController *)controller {
    [tableView beginUpdates];
}
// æœ¬åœ°æ•°æ®æºå‘ç”Ÿæ”¹å˜ï¼ŒFRCä»£ç†æ–¹æ³•å›è°ƒå®Œæˆã€‚
- (void)controllerDidChangeContent:(NSFetchedResultsController *)controller {
    [tableView endUpdates];
}
// è¿”å›sectionçš„titleï¼Œå¯ä»¥åœ¨è¿™é‡Œå¯¹titleåšè¿›ä¸€æ­¥å¤„ç†ã€‚è¿™é‡Œä¿®æ”¹titleåï¼Œå¯¹åº”sectionçš„indexTitleå±æ€§ä¼šè¢«æ›´æ–°ã€‚
- (nullable NSString *)controller:(NSFetchedResultsController *)controller sectionIndexTitleForSectionName:(NSString *)sectionName {
    return [NSString stringWithFormat:@"sectionName %@", sectionName];
}&lt;/nsfetchedresultssectioninfo&gt;
</code></pre>

<p>ä¸Šé¢å°±æ˜¯å½“æœ¬åœ°æŒä¹…åŒ–æ•°æ®å‘ç”Ÿæ”¹å˜åï¼Œè¢«å›è°ƒçš„FRCä»£ç†æ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥åœ¨å¯¹åº”çš„å®ç°ä¸­å®Œæˆè‡ªå·±çš„ä»£ç é€»è¾‘ã€‚</p>

<p>åœ¨ä¸Šé¢çš„ç« èŠ‚ä¸­è®²åˆ°åˆ é™¤cellåï¼Œæœ¬åœ°æŒä¹…åŒ–æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚åœ¨åˆ é™¤cellååœ¨tableViewä»£ç†æ–¹æ³•çš„å›è°ƒä¸­ï¼Œè°ƒç”¨äº†MOCçš„åˆ é™¤æ–¹æ³•ï¼Œä½¿æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨å’ŒUIä¿æŒåŒæ­¥ï¼Œå¹¶å›è°ƒåˆ°ä¸‹é¢çš„FRCä»£ç†æ–¹æ³•ä¸­ï¼Œåœ¨ä»£ç†æ–¹æ³•ä¸­å¯¹UIåšåˆ é™¤æ“ä½œï¼Œè¿™æ ·ä¸€å¥—ç”±UIçš„æ”¹å˜å¼•å‘çš„åˆ é™¤æµç¨‹å°±å®Œæˆäº†ã€‚</p>

<p>ç›®å‰ä¸ºæ­¢å·²ç»å®ç°äº†æ•°æ®å’ŒUIçš„åŒå‘åŒæ­¥ï¼Œå³UIå‘ç”Ÿæ”¹å˜åæœ¬åœ°å­˜å‚¨å‘ç”Ÿæ”¹å˜ï¼Œæœ¬åœ°å­˜å‚¨å‘ç”Ÿæ”¹å˜åUIä¹Ÿéšä¹‹æ”¹å˜ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢æ·»åŠ æ•°æ®çš„ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹ï¼ŒNSFetchedResultsControllerå°±è®²åˆ°è¿™é‡Œäº†ã€‚</p>

<pre><code>- (void)addMoreData {
    Employee *employee = [NSEntityDescription insertNewObjectForEntityForName:@"Employee" inManagedObjectContext:context];
    employee.name = [NSString stringWithFormat:@"lxz 15"];
    employee.height = @(15);
    employee.brithday = [NSDate date];
    employee.sectionName = [NSString stringWithFormat:@"3"];
    NSError *error = nil;
    if (![context save:&amp;error]) {
        NSLog(@"MOC save error : %@", error);
    }
}
</code></pre>

<p>ç‰ˆæœ¬è¿ç§»</p>

<p>CoreDataç‰ˆæœ¬è¿ç§»çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆåœ¨Xcodeä¸­ï¼ŒåŸæœ‰æ¨¡å‹æ–‡ä»¶çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šåšä¸åŒæ–¹å¼çš„ç‰ˆæœ¬è¿ç§»ã€‚</p>

<p>æœ¬ç« èŠ‚å°†ä¼šè®²ä¸‰ç§ä¸åŒçš„ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆï¼Œä½†éƒ½ä¸ä¼šè®²å¤ªæ·±ï¼Œéƒ½æ˜¯ä»ä½¿ç”¨çš„è§’åº¦è®²èµ·ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°ç‰ˆæœ¬è¿ç§»çš„éœ€æ±‚ã€‚</p>

<p>ä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬è¿ç§»ï¼Ÿ</p>

<p>åœ¨å·²ç»è¿è¡Œç¨‹åºå¹¶é€šè¿‡æ¨¡å‹æ–‡ä»¶ç”Ÿæˆæ•°æ®åº“åï¼Œå†å¯¹æ¨¡å‹æ–‡ä»¶è¿›è¡Œçš„ä¿®æ”¹ï¼Œå¦‚æœåªæ˜¯ä¿®æ”¹å·²æœ‰å®ä½“å±æ€§çš„é»˜è®¤å€¼ã€æœ€å¤§æœ€å°å€¼ã€Fetch Requestç­‰å±æ€§è‡ªèº«åŒ…å«çš„å‚æ•°æ—¶ï¼Œå¹¶ä¸ä¼šå‘ç”Ÿé”™è¯¯ã€‚å¦‚æœä¿®æ”¹æ¨¡å‹æ–‡ä»¶çš„ç»“æ„ï¼Œæˆ–ä¿®æ”¹å±æ€§åã€å®ä½“åç­‰ï¼Œé€ æˆæ¨¡å‹æ–‡ä»¶çš„ç»“æ„å‘ç”Ÿæ”¹å˜ï¼Œè¿™æ ·å†æ¬¡è¿è¡Œç¨‹åºå°±ä¼šå¯¼è‡´å´©æºƒã€‚</p>

<p>åœ¨å¼€å‘æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥å°†åŸæœ‰ç¨‹åºå¸è½½å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æœ¬åœ°ä¹‹å‰å­˜å‚¨çš„æ•°æ®ä¹Ÿä¼šæ¶ˆå¤±ã€‚å¦‚æœæ˜¯çº¿ä¸Šç¨‹åºï¼Œå°±æ¶‰åŠåˆ°ç‰ˆæœ¬è¿ç§»çš„é—®é¢˜ï¼Œå¦åˆ™ä¼šå¯¼è‡´å´©æºƒï¼Œå¹¶æç¤ºå¦‚ä¸‹é”™è¯¯ï¼š</p>

<pre><code>CoreData: error: Illegal attempt to save to a file that was never opened. "This NSPersistentStoreCoordinator has no persistent stores (unknown).  It cannot perform a save operation.". No last error recorded.
</code></pre>

<p>ç„¶è€Œåœ¨éœ€æ±‚ä¸æ–­å˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œåç»­ç‰ˆæœ¬è‚¯å®šä¼šå¯¹åŸæœ‰çš„æ¨¡å‹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°ç‰ˆæœ¬è¿ç§»çš„æŠ€æœ¯ï¼Œä¸‹é¢å¼€å§‹è®²ç‰ˆæœ¬è¿ç§»çš„æ–¹æ¡ˆã€‚</p>

<p>åˆ›å»ºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶</p>

<p>æœ¬æ–‡ä¸­è®²çš„å‡ ç§ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆï¼Œåœ¨è¿ç§»ä¹‹å‰éƒ½éœ€è¦å¯¹åŸæœ‰çš„æ¨¡å‹æ–‡ä»¶åˆ›å»ºæ–°ç‰ˆæœ¬ã€‚</p>

<p>é€‰ä¸­éœ€è¦åšè¿ç§»çš„æ¨¡å‹æ–‡ä»¶ -> ç‚¹å‡»èœå•æ Editor -> Add Model Version -> é€‰æ‹©åŸºäºå“ªä¸ªç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶(ä¸€èˆ¬éƒ½æ˜¯é€‰æ‹©ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬)ï¼Œæ–°å»ºæ¨¡å‹æ–‡ä»¶å®Œæˆã€‚</p>

<p>å¯¹äºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶çš„å‘½åï¼Œæˆ‘åœ¨åˆ›å»ºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶æ—¶ï¼Œä¸€èˆ¬ä¼šæ‹¿å½“å‰å·¥ç¨‹ç‰ˆæœ¬å·å½“åšåç¼€ï¼Œè¿™æ ·åœ¨æ¨¡å‹æ–‡ä»¶ç‰ˆæœ¬æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“å°†æ¨¡å‹æ–‡ä»¶ç‰ˆæœ¬å’Œå·¥ç¨‹ç‰ˆæœ¬å¯¹åº”èµ·æ¥ã€‚</p>

<p><img src="http://al1020119.github.io/images/4003.png" title="Caption" ></p>

<p>åˆ›å»ºæ–°ç‰ˆæœ¬æ¨¡å‹æ–‡ä»¶</p>

<p>æ·»åŠ å®Œæˆåï¼Œä¼šå‘ç°ä¹‹å‰çš„æ¨¡å‹æ–‡ä»¶ä¼šå˜æˆä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«ç€å¤šä¸ªæ¨¡å‹æ–‡ä»¶ã€‚</p>

<p><img src="http://al1020119.github.io/images/4004.png" title="Caption" >
æ¨¡å‹æ–‡ä»¶å¤¹</p>

<p>åœ¨æ–°å»ºçš„æ¨¡å‹æ–‡ä»¶ä¸­ï¼Œé‡Œé¢çš„æ–‡ä»¶ç»“æ„å’Œä¹‹å‰çš„æ–‡ä»¶ç»“æ„ç›¸åŒã€‚åç»­çš„ä¿®æ”¹éƒ½åº”è¯¥åœ¨æ–°çš„æ¨¡å‹æ–‡ä»¶ä¸Šï¼Œä¹‹å‰çš„æ¨¡å‹æ–‡ä»¶ä¸è¦å†åŠ¨äº†ï¼Œåœ¨ä¿®æ”¹å®Œæ¨¡å‹æ–‡ä»¶åï¼Œè®°å¾—æ›´æ–°å¯¹åº”çš„æ¨¡å‹ç±»æ–‡ä»¶ã€‚</p>

<p>åŸºäºæ–°çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¯¹Employeeå®ä½“åšå¦‚ä¸‹ä¿®æ”¹ï¼Œä¸‹é¢çš„ç‰ˆæœ¬è¿ç§»ä¹Ÿä»¥æ­¤ä¸ºä¾‹ã€‚</p>

<p><img src="http://al1020119.github.io/images/4005.png" title="Caption" ></p>

<p>ä¿®æ”¹ä¹‹å‰</p>

<p>æ·»åŠ ä¸€ä¸ªStringç±»å‹çš„å±æ€§ï¼Œè®¾ç½®å±æ€§åä¸ºsectionNameã€‚</p>

<p><img src="http://al1020119.github.io/images/4006.png" title="Caption" ></p>

<p>ä¿®æ”¹ä¹‹å</p>

<p>æ­¤æ—¶è¿˜åº”è¯¥é€‰ä¸­æ¨¡å‹æ–‡ä»¶ï¼Œè®¾ç½®å½“å‰æ¨¡å‹æ–‡ä»¶çš„ç‰ˆæœ¬ã€‚è¿™é‡Œé€‰æ‹©å°†æœ€æ–°ç‰ˆæœ¬è®¾ç½®ä¸ºåˆšæ‰æ–°å»ºçš„1.1.0ç‰ˆæœ¬ï¼Œæ¨¡å‹æ–‡ä»¶è®¾ç½®å·¥ä½œå®Œæˆã€‚</p>

<pre><code>Show The File Inspector -&gt; Model Version -&gt; Current è®¾ç½®ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚
</code></pre>

<p><img src="http://al1020119.github.io/images/4007.png" title="Caption" ></p>

<p>è®¾ç½®ç‰ˆæœ¬</p>

<p>å¯¹æ¨¡å‹æ–‡ä»¶çš„è®¾ç½®å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥ç³»ç»Ÿè¿˜è¦çŸ¥é“æˆ‘ä»¬æƒ³è¦æ€æ ·è¿ç§»æ•°æ®ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå­˜åœ¨å¤šç§å¯èƒ½ï¼Œè‹¹æœå°†è¿™ä¸ªçµæ´»æ€§ç•™ç»™äº†æˆ‘ä»¬å®Œæˆã€‚å‰©ä¸‹è¦åšçš„å°±æ˜¯ç¼–å†™è¿ç§»æ–¹æ¡ˆä»¥åŠç»†èŠ‚çš„ä»£ç ã€‚</p>

<p>è½»é‡çº§ç‰ˆæœ¬è¿ç§»</p>

<p>è½»é‡çº§ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆéå¸¸ç®€å•ï¼Œå¤§å¤šæ•°è¿ç§»å·¥ä½œéƒ½æ˜¯ç”±ç³»ç»Ÿå®Œæˆçš„ï¼Œåªéœ€è¦å‘Šè¯‰ç³»ç»Ÿè¿ç§»æ–¹å¼å³å¯ã€‚åœ¨æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨(PSC)åˆå§‹åŒ–å¯¹åº”çš„æŒä¹…åŒ–å­˜å‚¨(NSPersistentStore)å¯¹è±¡æ—¶ï¼Œè®¾ç½®optionså‚æ•°å³å¯ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ã€‚PSCä¼šæ ¹æ®ä¼ å…¥çš„å­—å…¸ï¼Œè‡ªåŠ¨æ¨æ–­ç‰ˆæœ¬è¿ç§»çš„è¿‡ç¨‹ã€‚</p>

<p>å­—å…¸ä¸­è®¾ç½®çš„keyï¼š</p>

<pre><code>    NSMigratePersistentStoresAutomaticallyOptionè®¾ç½®ä¸ºYESï¼ŒCoreDataä¼šè¯•ç€æŠŠä½ç‰ˆæœ¬çš„æŒä¹…åŒ–å­˜å‚¨åŒºè¿ç§»åˆ°æœ€æ–°ç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶ã€‚

    NSInferMappingModelAutomaticallyOptionè®¾ç½®ä¸ºYESï¼ŒCoreDataä¼šè¯•ç€ä»¥æœ€ä¸ºåˆç†åœ°æ–¹å¼è‡ªåŠ¨æ¨æ–­å‡ºæºæ¨¡å‹æ–‡ä»¶çš„å®ä½“ä¸­ï¼ŒæŸä¸ªå±æ€§åˆ°åº•å¯¹åº”äºç›®æ ‡æ¨¡å‹æ–‡ä»¶å®ä½“ä¸­çš„å“ªä¸€ä¸ªå±æ€§ã€‚
</code></pre>

<p>ç‰ˆæœ¬è¿ç§»çš„è®¾ç½®æ˜¯åœ¨åˆ›å»ºMOCæ—¶ç»™PSCè®¾ç½®çš„ï¼Œä¸ºäº†ä½¿ä»£ç æ›´ç›´è§‚ï¼Œä¸‹é¢åªç»™å‡ºå‘ç”Ÿå˜åŒ–éƒ¨åˆ†çš„ä»£ç ï¼Œå…¶ä»–MOCçš„åˆå§‹åŒ–ä»£ç éƒ½ä¸å˜ã€‚</p>

<pre><code>// è®¾ç½®ç‰ˆæœ¬è¿ç§»æ–¹æ¡ˆ
NSDictionary *options = @{NSMigratePersistentStoresAutomaticallyOption : @YES,
                                NSInferMappingModelAutomaticallyOption : @YES};
// åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨ï¼Œå¹¶å°†è¿ç§»æ–¹æ¡ˆçš„å­—å…¸å½“åšå‚æ•°ä¼ å…¥
[coordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[NSURL fileURLWithPath:dataPath] options:options error:nil];
</code></pre>

<p>ä¿®æ”¹å®ä½“å</p>

<p>å‡è®¾éœ€è¦å¯¹å·²å­˜åœ¨å®ä½“è¿›è¡Œæ”¹åæ“ä½œï¼Œéœ€è¦å°†é‡å‘½ååçš„å®ä½“Renaming IDï¼Œè®¾ç½®ä¸ºä¹‹å‰çš„å®ä½“åã€‚ä¸‹é¢æ˜¯Employeeå®ä½“è¿›è¡Œæ“ä½œã€‚</p>

<p><img src="http://al1020119.github.io/images/4008.png" title="Caption" ></p>

<p>ä¿®æ”¹å®ä½“å</p>

<p>ä¿®æ”¹åå†ä½¿ç”¨å®ä½“æ—¶ï¼Œåº”è¯¥å°†å®ä½“åè®¾ä¸ºæœ€æ–°çš„å®ä½“åï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯Employee2ï¼Œè€Œä¸”æ•°æ®åº“ä¸­çš„æ•°æ®ä¹Ÿä¼šè¿ç§»åˆ°Employee2è¡¨ä¸­ã€‚</p>

<pre><code>Employee2 *emp = [NSEntityDescription insertNewObjectForEntityForName:@"Employee2" inManagedObjectContext:context];
emp.name = @"lxz";
emp.brithday = [NSDate date];
emp.height = @1.9;
[context save:nil];
</code></pre>

<p>Mapping Model è¿ç§»æ–¹æ¡ˆ</p>

<p>è½»é‡çº§è¿ç§»æ–¹æ¡ˆåªæ˜¯é’ˆå¯¹å¢åŠ å’Œæ”¹å˜å®ä½“ã€å±æ€§è¿™æ ·çš„ä¸€äº›ç®€å•æ“ä½œï¼Œå‡è®¾æœ‰æ›´å¤æ‚çš„è¿ç§»éœ€æ±‚ï¼Œå°±åº”è¯¥ä½¿ç”¨Xcodeæä¾›çš„è¿ç§»æ¨¡æ¿(Mapping Model)ã€‚é€šè¿‡Xcodeåˆ›å»ºä¸€ä¸ªåç¼€ä¸º.xcmappingmodelçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸“é—¨ç”¨æ¥è¿›è¡Œæ•°æ®è¿ç§»ç”¨çš„ï¼Œä¸€äº›å˜åŒ–å…³ç³»ä¹Ÿä¼šä½“ç°åœ¨æ¨¡æ¿ä¸­ï¼Œçœ‹èµ·æ¥éå¸¸ç›´è§‚ã€‚</p>

<p>è¿™é‡Œè¿˜ä»¥ä¸Šé¢æ›´æ”¹å®ä½“åï¼Œå¹¶è¿ç§»å®ä½“æ•°æ®ä¸ºä¾‹å­ï¼Œå°†Employeeå®ä½“è¿ç§»åˆ°Employee2ä¸­ã€‚é¦–å…ˆå°†Employeeå®ä½“æ”¹åä¸ºEmployee2ï¼Œç„¶ååˆ›å»ºMapping Modelæ–‡ä»¶ã€‚</p>

<p>Command + N æ–°å»ºæ–‡ä»¶ -> é€‰æ‹© Mapping Model -> é€‰æ‹©æºæ–‡ä»¶ Source Model -> é€‰æ‹©ç›®æ ‡æ–‡ä»¶ Target Model -> å‘½å Mapping Model æ–‡ä»¶å -> Create åˆ›å»ºå®Œæˆã€‚</p>

<p><img src="http://al1020119.github.io/images/4009.png" title="Caption" ></p>

<p>Mapping Model æ–‡ä»¶</p>

<p>ç°åœ¨å°±åˆ›å»ºå¥½ä¸€ä¸ªMapping Modelæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æ˜¾ç¤ºäº†å®ä½“ã€å±æ€§ã€Relationshipsï¼Œæºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶ä¹‹é—´çš„å…³ç³»ã€‚å®ä½“å‘½åæ˜¯EntityToEntityçš„æ–¹å¼å‘½åçš„ï¼Œå®ä½“åŒ…å«çš„å±æ€§å’Œå…³è”å…³ç³»ï¼Œéƒ½ä¼šè¢«æ·»åŠ åˆ°è¿ç§»æ–¹æ¡ˆä¸­(Entity Mappingï¼ŒAttribute Mappingï¼ŒRelationship Mapping)ã€‚</p>

<p>åœ¨è¿ç§»æ–‡ä»¶çš„ä¸‹æ–¹æ˜¯æºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶çš„å…³ç³»ã€‚</p>

<p><img src="http://al1020119.github.io/images/4010.png" title="Caption" ></p>

<p>å¯¹åº”å…³ç³»</p>

<p>åœ¨ä¸Šé¢å›¾ä¸­æ”¹ååçš„Employee2å®ä½“å¹¶æ²¡æœ‰è¿ç§»å…³ç³»ï¼Œç”±äºæ˜¯æ”¹ååçš„å®ä½“ï¼Œç³»ç»Ÿè¿˜ä¸çŸ¥é“å®ä½“åº”è¯¥æ€æ ·åšè¿ç§»ã€‚æ‰€ä»¥é€‰ä¸­Mapping Modelæ–‡ä»¶çš„Employee2 Mappingsï¼Œå¯ä»¥çœ‹åˆ°å³ä¾§è¾¹æ çš„Sourceä¸ºinvalid valueã€‚å› ä¸ºè¦ä»Employeeå®ä½“è¿ç§»æ•°æ®è¿‡æ¥ï¼Œæ‰€ä»¥å°†å…¶é€‰æ‹©ä¸ºEmployeeï¼Œè¿ç§»å…³ç³»å°±è®¾ç½®å®Œæˆäº†ã€‚</p>

<p>è®¾ç½®å®Œæˆåï¼Œè¿˜åº”è¯¥å°†ä¹‹å‰EmployeeToEmployeeçš„Mappingsåˆ é™¤ï¼Œå› ä¸ºè¿™ä¸ªå®ä½“å·²ç»è¢«Employee2æ›¿ä»£ï¼Œå®ƒçš„Mappingsä¹Ÿè¢«Employee2 Mappingsæ‰€æ›¿ä»£ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>

<p><img src="http://al1020119.github.io/images/4011.png" title="Caption" ></p>

<p>è®¾ç½®è¿ç§»å…³ç³»</p>

<p>åœ¨å®ä½“çš„è¿ç§»è¿‡ç¨‹ä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡è®¾ç½®Predicateçš„æ–¹å¼ï¼Œæ¥ç®€å•çš„æ§åˆ¶è¿ç§»è¿‡ç¨‹ã€‚ä¾‹å¦‚åªéœ€è¦è¿ç§»ä¸€éƒ¨åˆ†æŒ‡å®šçš„æ•°æ®ï¼Œå°±å¯ä»¥é€šè¿‡Predicateæ¥æŒ‡å®šã€‚å¯ä»¥ç›´æ¥åœ¨å³ä¾§Filter Predicateçš„ä½ç½®è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œæ ¼å¼æ˜¯$source.height &lt; 100ï¼Œ$sourceä»£è¡¨æ•°æ®æºçš„å®ä½“ã€‚</p>

<p><img src="http://al1020119.github.io/images/4012.png" title="Caption" ></p>

<p>Filter Predicate</p>

<p>æ›´å¤æ‚çš„è¿ç§»éœ€æ±‚</p>

<p>å¦‚æœè¿˜å­˜åœ¨æ›´å¤æ‚çš„è¿ç§»éœ€æ±‚ï¼Œè€Œä¸”ä¸Šé¢çš„è¿ç§»æ–¹å¼ä¸èƒ½æ»¡è¶³ï¼Œå¯ä»¥è€ƒè™‘æ›´å¤æ‚çš„è¿ç§»æ–¹å¼ã€‚å‡è®¾è¦åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå¯¹è¿ç§»çš„æ•°æ®è¿›è¡Œæ›´æ”¹ï¼Œè¿™æ—¶å€™ä¸Šé¢çš„è¿ç§»æ–¹æ¡ˆå°±ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†ã€‚</p>

<p>å¯¹äºä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œåœ¨Mapping Modelæ–‡ä»¶ä¸­é€‰ä¸­å®ä½“ï¼Œå¯ä»¥çœ‹åˆ°Custom Policyè¿™ä¸ªé€‰é¡¹ï¼Œé€‰é¡¹å¯¹åº”çš„æ˜¯NSEntityMigrationPolicyçš„å­ç±»ï¼Œå¯ä»¥åˆ›å»ºå¹¶è®¾ç½®ä¸€ä¸ªå­ç±»ï¼Œå¹¶é‡å†™è¿™ä¸ªç±»çš„æ–¹æ³•æ¥æ§åˆ¶è¿ç§»è¿‡ç¨‹ã€‚</p>

<pre><code>- (BOOL)createDestinationInstancesForSourceInstance:(NSManagedObject *)sInstance entityMapping:(NSEntityMapping *)mapping manager:(NSMigrationManager *)manager error:(NSError **)error;
</code></pre>

<p>ç‰ˆæœ¬è¿ç§»æ€»ç»“</p>

<p>ç‰ˆæœ¬è¿ç§»åœ¨éœ€æ±‚çš„å˜æ›´ä¸­è‚¯å®šæ˜¯è¦å‘ç”Ÿçš„ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…è¿™æ ·çš„æƒ…å†µå‘ç”Ÿã€‚åœ¨æœ€å¼€å§‹è®¾è®¡æ¨¡å‹æ–‡ä»¶æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå°±åº”è¯¥è®¾è®¡ä¸€ä¸ªæ¯”è¾ƒå®Œå–„å¹¶ä¸”å®¹æ˜“åº”å¯¹å˜åŒ–çš„ç»“æ„ï¼Œè¿™æ ·åé¢å°±ç®—å‘ç”Ÿå˜åŒ–ä¹Ÿä¸ä¼šå¯¹ç»“æ„ä¸»ä½“é€ æˆå¤§çš„æ”¹åŠ¨ã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CoreDataè¿˜æœ‰æ’’ï¼Ÿ]]></title>
    <link href="http://al1020119.github.io/blog/2016/07/04/coredatechaiyousa/"/>
    <updated>2016-07-04T06:59:42+08:00</updated>
    <id>http://al1020119.github.io/blog/2016/07/04/coredatechaiyousa</id>
    <content type="html"><![CDATA[<p>ä¹‹å‰ä¸¤ç¯‡æ–‡ç« éƒ½æ¯”è¾ƒåç†è®ºï¼Œæ–‡å­—è¡¨è¾¾æ¯”è¾ƒå¤šä¸€äº›ï¼Œä½†éƒ½æ˜¯å¹²è´§ï¼å­¦ä¹ æ—¶å…ˆç†è§£ç†è®ºçŸ¥è¯†ï¼Œæ‰èƒ½æ›´å¥½çš„å¸®åŠ©åé¢çš„ç†è§£ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå°†ä¼šæ¶‰åŠå…³äºCoreDataçš„ä¸€äº›å¤æ‚æ“ä½œï¼Œè¿™äº›æ“ä½œä¼šæ¶‰åŠåˆ†é¡µæŸ¥è¯¢ã€æ¨¡ç³ŠæŸ¥è¯¢ã€æ‰¹å¤„ç†ç­‰é«˜çº§æ“ä½œã€‚é€šè¿‡è¿™äº›æ“ä½œå¯ä»¥æ›´å¥½çš„ä½¿ç”¨CoreDataï¼Œæå‡CoreDataæ€§èƒ½ã€‚æ–‡ç« ä¸­å°†ä¼šå‡ºç°å¤§é‡ç¤ºä¾‹ä»£ç ï¼Œé€šè¿‡ä»£ç çš„æ–¹å¼æ›´æœ‰åŠ©äºç†è§£ã€‚</p>

<p>æ–‡ç« å†…å®¹è¿˜ä¼šæ¯”è¾ƒå¤šï¼Œå¸Œæœ›å„ä½è€å¿ƒçœ‹å®Œã€‚æ–‡ç« ä¸­å¦‚æœ‰ç–æ¼æˆ–é”™è¯¯ï¼Œè¿˜è¯·å„ä½åŠæ—¶æå‡ºï¼Œè°¢è°¢ï¼</p>

<p>NSPredicate</p>

<!--more-->


<p>æ¦‚è¿°</p>

<p>åœ¨iOSå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šéœ€æ±‚éƒ½éœ€è¦ç”¨åˆ°è¿‡æ»¤æ¡ä»¶ã€‚ä¾‹å¦‚è¿‡æ»¤ä¸€ä¸ªé›†åˆå¯¹è±¡ä¸­å­˜å‚¨çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡Foundationæ¡†æ¶ä¸‹çš„NSPredicateç±»æ¥æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</p>

<p>CoreDataä¸­å¯ä»¥é€šè¿‡è®¾ç½®NSFetchRequestç±»çš„predicateå±æ€§ï¼Œæ¥è®¾ç½®ä¸€ä¸ªNSPredicateç±»å‹çš„è°“è¯å¯¹è±¡å½“åšè¿‡æ»¤æ¡ä»¶ã€‚é€šè¿‡è®¾ç½®è¿™ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œå¯ä»¥åªè·å–ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä¸ä¼šå°†æ‰€æœ‰æ‰˜ç®¡å¯¹è±¡éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·æ˜¯éå¸¸èŠ‚çœå†…å­˜å’ŒåŠ å¿«æŸ¥æ‰¾é€Ÿåº¦çš„ï¼Œè®¾è®¡ä¸€ä¸ªå¥½çš„NSPredicateå¯ä»¥ä¼˜åŒ–CoreDataæœç´¢æ€§èƒ½ã€‚</p>

<p>è¯­æ³•</p>

<p>NSPredicateæ›´åŠ åå‘äºè‡ªç„¶è¯­è¨€ï¼Œä¸åƒSQLiteä¸€æ ·æœ‰å¾ˆå¤šå›ºå®šçš„è¯­æ³•ï¼Œçœ‹èµ·æ¥ä¹Ÿæ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚ä¾‹å¦‚ä¸‹é¢éœ€è¦æŸ¥æ‰¾æ¡ä»¶ä¸ºå¹´é¾„30å²ä»¥ä¸Šï¼Œå¹¶ä¸”åŒ…æ‹¬30å²çš„æ¡ä»¶ã€‚
1</p>

<pre><code>[NSPredicate predicateWithFormat:@"age &gt;= 30"]
</code></pre>

<p>è¿‡æ»¤é›†åˆå¯¹è±¡</p>

<p>å¯ä»¥é€šè¿‡NSPredicateå¯¹iOSä¸­çš„é›†åˆå¯¹è±¡æ‰§è¡Œè¿‡æ»¤æ“ä½œï¼Œå¯ä»¥æ˜¯NSArrayã€NSSetåŠå…¶å­ç±»ã€‚</p>

<p>å¯¹ä¸å¯å˜æ•°ç»„NSArrayæ‰§è¡Œçš„è¿‡æ»¤ï¼Œè¿‡æ»¤åä¼šè¿”å›ä¸€ä¸ªNSArrayç±»å‹çš„ç»“æœæ•°ç»„ï¼Œå…¶ä¸­å­˜å‚¨ç€ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„å¯¹è±¡ã€‚
1</p>

<pre><code>NSArray *results = [array filteredArrayUsingPredicate:predicate]
</code></pre>

<p>å¯¹å¯å˜æ•°ç»„NSMutableArrayæ‰§è¡Œçš„è¿‡æ»¤æ¡ä»¶ï¼Œè¿‡æ»¤åä¼šç›´æ¥æ”¹å˜åŸé›†åˆå¯¹è±¡å†…éƒ¨å­˜å‚¨çš„å¯¹è±¡ï¼Œåˆ é™¤ä¸ç¬¦åˆæ¡ä»¶çš„å¯¹è±¡ã€‚
1</p>

<pre><code>[arrayM filterUsingPredicate:predicate]
</code></pre>

<p>å¤åˆè¿‡æ»¤æ¡ä»¶</p>

<p>è°“è¯ä¸åªå¯ä»¥è¿‡æ»¤ç®€å•æ¡ä»¶ï¼Œè¿˜å¯ä»¥è¿‡æ»¤å¤æ‚æ¡ä»¶ï¼Œè®¾ç½®å¤åˆè¿‡æ»¤æ¡ä»¶ã€‚
1</p>

<pre><code>[NSPredicate predicateWithFormat:@"(age &lt; 25) AND (firstName = XiaoZhuang)"]
</code></pre>

<p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡NSCompoundPredicateå¯¹è±¡æ¥è®¾ç½®å¤åˆè¿‡æ»¤æ¡ä»¶ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªNSPredicateçš„å­ç±»NSCompoundPredicateå¯¹è±¡ã€‚
1</p>

<pre><code>[[NSCompoundPredicate alloc] initWithType:NSAndPredicateType subpredicates:@[predicate1, predicate2]]
</code></pre>

<p>æšä¸¾å€¼NSCompoundPredicateTypeå‚æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸‰ç§å¤åˆæ¡ä»¶ï¼Œæšä¸¾å€¼éå¸¸ç›´è§‚å¾ˆå®¹æ˜“çœ‹æ‡‚ã€‚</p>

<pre><code>NSNotPredicateType

NSAndPredicateType

NSOrPredicateType
</code></pre>

<p>åŸºç¡€è¯­æ³•</p>

<p>ä¸‹é¢æ˜¯åˆ—ä¸¾çš„ä¸€äº›NSPredicateçš„åŸºç¡€è¯­æ³•ï¼Œè¿™äº›è¯­æ³•çœ‹èµ·æ¥éå¸¸å®¹æ˜“ç†è§£ï¼Œæ›´å¤æ‚çš„ç”¨æ³•å¯ä»¥å»çœ‹è‹¹æœçš„å®˜æ–¹APIã€‚</p>

<p><img src="http://al1020119.github.io/images/3001.png" title="Caption" ></p>

<p>æ­£åˆ™è¡¨è¾¾å¼</p>

<p>NSPredicateä¸­è¿˜å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å®Œæˆä¸€äº›å¤æ‚éœ€æ±‚ï¼Œè¿™ä½¿å¾—è°“è¯çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œä¾‹å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰‹æœºå·éªŒè¯çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
1
2</p>

<pre><code>NSString *mobile = @"^1(3[0-9]|5[0-35-9]|8[025-9])\\d{8}$";
NSPredicate *regexmobile = [NSPredicate predicateWithFormat:@"SELF MATCHES %@", mobile];
</code></pre>

<p>æ¨¡ç³ŠæŸ¥è¯¢</p>

<p>NSPredicateæ”¯æŒå¯¹æ•°æ®çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¾‹å¦‚ä¸‹é¢ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…åŒ…å«lxzçš„ç»“æœï¼Œå…·ä½“CoreDataä¸­çš„ä½¿ç”¨åœ¨ä¸‹é¢ä¼šè®²åˆ°ã€‚
1</p>

<pre><code>[NSPredicate predicateWithFormat:@"name LIKE %@", @"*lxz*"]
</code></pre>

<p>keyPath</p>

<p>NSPredicateåœ¨åˆ›å»ºæŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œè¿˜æ”¯æŒè®¾ç½®è¢«åŒ¹é…ç›®æ ‡çš„keyPathï¼Œä¹Ÿå°±æ˜¯è®¾ç½®æ›´æ·±å±‚è¢«åŒ¹é…çš„ç›®æ ‡ã€‚ä¾‹å¦‚ä¸‹é¢è®¾ç½®employeeçš„nameå±æ€§ä¸ºæŸ¥æ‰¾æ¡ä»¶ï¼Œå°±æ˜¯ç”¨ç‚¹è¯­æ³•è®¾ç½®çš„keyPathã€‚
1</p>

<pre><code>[NSPredicate predicateWithFormat:@"employee.name = %@", @"lxz"]
</code></pre>

<p>è®¾ç½®æŸ¥è¯¢æ¡ä»¶</p>

<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæ‰§è¡Œä¸‹é¢MOCçš„fetchRequestæ–¹æ³•ï¼Œä¸€èˆ¬éƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ªNSFetchRequestç±»å‹çš„å‚æ•°ã€‚è¿™ä¸ªrequestå‚æ•°å¯ä»¥åšä¸€äº›è®¾ç½®æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥ä»¥è¾ƒä¼˜çš„æ€§èƒ½è·å–æŒ‡å®šçš„æ•°æ®ã€‚
1</p>

<pre><code>- (nullable NSArray *)executeFetchRequest:(NSFetchRequest *)request error:(NSError **)error;
</code></pre>

<p>NSFetchRequest</p>

<p>åœ¨æ‰§è¡Œfetchæ“ä½œå‰ï¼Œå¯ä»¥ç»™NSFetchRequestè®¾ç½®ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°åŒ…æ‹¬è°“è¯ã€æ’åºç­‰æ¡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€äº›åŸºç¡€çš„è®¾ç½®ã€‚</p>

<pre><code>è®¾ç½®æŸ¥æ‰¾å“ªä¸ªå®ä½“ï¼Œä»æ•°æ®åº“çš„è§’åº¦æ¥çœ‹å°±æ˜¯æŸ¥æ‰¾å“ªå¼ è¡¨ï¼Œé€šè¿‡fetchRequestWithEntityName:æˆ–åˆå§‹åŒ–æ–¹æ³•æ¥æŒ‡å®šè¡¨åã€‚

é€šè¿‡NSPredicateç±»å‹çš„å±æ€§ï¼Œå¯ä»¥è®¾ç½®æŸ¥æ‰¾æ¡ä»¶ï¼Œè¿™ä¸ªå±æ€§åœ¨å¼€å‘ä¸­ç”¨å¾—æœ€å¤šã€‚NSPredicateå¯ä»¥åŒ…æ‹¬å›ºå®šæ ¼å¼çš„æ¡ä»¶ä»¥åŠæ­£åˆ™è¡¨è¾¾å¼ã€‚

é€šè¿‡sortDescriptorså±æ€§ï¼Œå¯ä»¥è®¾ç½®è·å–ç»“æœæ•°ç»„çš„æ’åºæ–¹å¼ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è®¾ç½®å¤šç§æ’åºæ¡ä»¶ã€‚(ä½†æ˜¯æ³¨æ„æ¡ä»¶ä¸è¦å†²çª)

é€šè¿‡fetchOffsetå±æ€§è®¾ç½®ä»æŸ¥è¯¢ç»“æœçš„ç¬¬å‡ ä¸ªå¼€å§‹è·å–ï¼Œé€šè¿‡fetchLimitå±æ€§è®¾ç½®æ¯æ¬¡è·å–å¤šå°‘ä¸ªã€‚ä¸»è¦ç”¨äºåˆ†é¡µæŸ¥è¯¢ï¼Œåé¢ä¼šè®²ã€‚
</code></pre>

<p>MOCæ‰§è¡Œfetchæ“ä½œåï¼Œè·å–çš„ç»“æœæ˜¯ä»¥æ•°ç»„çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„å°±æ˜¯æ‰˜ç®¡å¯¹è±¡ã€‚NSFetchRequestæä¾›äº†å‚æ•°resultTypeï¼Œå‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥è®¾ç½®æ‰§è¡Œfetchæ“ä½œåè¿”å›çš„æ•°æ®ç±»å‹ã€‚</p>

<pre><code>NSManagedObjectResultType: è¿”å›å€¼æ˜¯NSManagedObjectçš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯æ‰˜ç®¡å¯¹è±¡ï¼Œè¿™æ˜¯é»˜è®¤é€‰é¡¹

NSManagedObjectIDResultType: è¿”å›NSManagedObjectIDç±»å‹çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯NSManagedObjectçš„IDï¼Œå¯¹å†…å­˜å ç”¨æ¯”è¾ƒå°ã€‚MOCå¯ä»¥é€šè¿‡NSManagedObjectIDå¯¹è±¡è·å–å¯¹åº”çš„æ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç¼“å­˜NSManagedObjectIDå‚æ•°æ¥èŠ‚çœå†…å­˜æ¶ˆè€—

NSDictionaryResultType: è¿”å›å­—å…¸ç±»å‹å¯¹è±¡

NSCountResultType: è¿”å›è¯·æ±‚ç»“æœçš„countå€¼ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å‘ç”Ÿåœ¨æ•°æ®åº“å±‚çº§çš„ï¼Œå¹¶ä¸éœ€è¦å°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­
</code></pre>

<p>è®¾ç½®è·å–æ¡ä»¶</p>

<pre><code>// å»ºç«‹è·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
// è®¾ç½®è¯·æ±‚æ¡ä»¶ï¼Œé€šè¿‡è®¾ç½®çš„æ¡ä»¶ï¼Œæ¥è¿‡æ»¤å‡ºéœ€è¦çš„æ•°æ®
NSPredicate *predicate = [NSPredicate predicateWithFormat:@"name = %@", @"lxz"];
request.predicate = predicate;
// è®¾ç½®è¯·æ±‚ç»“æœæ’åºæ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–ä¸€ç»„æ’åºæ–¹å¼ï¼Œæœ€åå°†æ‰€æœ‰çš„æ’åºæ–¹å¼æ·»åŠ åˆ°æ’åºæ•°ç»„ä¸­
NSSortDescriptor *sort = [NSSortDescriptor sortDescriptorWithKey:@"height" ascending:YES];
// NSSortDescriptorçš„æ“ä½œéƒ½æ˜¯åœ¨SQLiteå±‚çº§å®Œæˆçš„ï¼Œä¸ä¼šå°†å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥å¯¹å†…å­˜çš„æ¶ˆè€—æ˜¯éå¸¸å°çš„
request.sortDescriptors = @[sort];
// æ‰§è¡Œè·å–è¯·æ±‚æ“ä½œï¼Œè·å–çš„æ‰˜ç®¡å¯¹è±¡å°†ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­å¹¶è¿”å›
NSError *error = nil;
NSArray *employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    NSLog(@"Employee Name : %@, Height : %@, Brithday : %@", obj.name, obj.height, obj.brithday);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"CoreData Fetch Data Error : %@", error);
}
</code></pre>

<p>è¿™é‡Œè®¾ç½®NSFetchRequestå¯¹è±¡çš„ä¸€äº›è¯·æ±‚æ¡ä»¶ï¼Œè®¾ç½®æŸ¥æ‰¾Employeeè¡¨ä¸­nameä¸ºlxzçš„æ•°æ®ï¼Œå¹¶ä¸”å°†æ‰€æœ‰ç¬¦åˆçš„æ•°æ®ç”¨heightå€¼å‡åºçš„æ–¹å¼æ’åˆ—ã€‚</p>

<p>æœ‰å®ä½“å…³è”å…³ç³»</p>

<p>ä¸€ä¸ªæ¨¡å‹æ–‡ä»¶ä¸­çš„ä¸åŒå®ä½“é—´ï¼Œå¯ä»¥è®¾ç½®å®ä½“é—´çš„å…³è”å…³ç³»ï¼Œè¿™ä¸ªåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è®²è¿‡ã€‚å®ä½“å…³è”å…³ç³»åˆ†ä¸ºå¯¹ä¸€æˆ–å¯¹å¤šï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ˜¯å¦åŒå‘å…³è”ã€‚</p>

<p>è¿™é‡Œæ¼”ç¤ºçš„å®ä½“åªæ˜¯ç®€å•çš„To Oneçš„å…³ç³»ï¼Œå¹¶ä¸”ä¸‹é¢ä¼šç»™å‡ºè®¾ç½®æ˜¯å¦åŒå‘å…³è”çš„åŒºåˆ«å¯¹æ¯”ã€‚</p>

<p>æ’å…¥å®ä½“</p>

<pre><code>// åˆ›å»ºæ‰˜ç®¡å¯¹è±¡ï¼Œå¹¶å°†å…¶å…³è”åˆ°æŒ‡å®šçš„MOCä¸Š
Employee *zsEmployee = [NSEntityDescription insertNewObjectForEntityForName:@"Employee" inManagedObjectContext:context];
zsEmployee.name = @"zhangsan";
zsEmployee.height = @1.9f;
zsEmployee.brithday = [NSDate date];
Employee *lsEmployee = [NSEntityDescription insertNewObjectForEntityForName:@"Employee" inManagedObjectContext:context];
lsEmployee.name = @"lisi";
lsEmployee.height = @1.7f;
lsEmployee.brithday = [NSDate date];
Department *iosDepartment = [NSEntityDescription insertNewObjectForEntityForName:@"Department" inManagedObjectContext:context];
iosDepartment.departName = @"iOS";
iosDepartment.createDate = [NSDate date];
iosDepartment.employee = zsEmployee;
Department *androidDepartment = [NSEntityDescription insertNewObjectForEntityForName:@"Department" inManagedObjectContext:context];
androidDepartment.departName = @"android";
androidDepartment.createDate = [NSDate date];
androidDepartment.employee = lsEmployee;
// æ‰§è¡Œå­˜å‚¨æ“ä½œ
NSError *error = nil;
if (context.hasChanges) {
    [context save:&amp;error];
}
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"Association Table Add Data Error : %@", error);
}
</code></pre>

<p>ä¸Šé¢åˆ›å»ºäº†å››ä¸ªå®ä½“ï¼Œå¹¶ä¸”å°†Employeeéƒ½å…³è”åˆ°Departmentä¸Šï¼Œå®Œæˆå…³è”æ“ä½œåé€šè¿‡MOCå­˜å‚¨åˆ°æœ¬åœ°ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢æ‰€æœ‰çš„æ‰˜ç®¡å¯¹è±¡åˆ›å»ºæ—¶ï¼Œéƒ½ä½¿ç”¨NSEntityDescriptionçš„insertæ–¹æ³•åˆ›å»ºï¼Œå¹¶å’Œä¸Šä¸‹æ–‡å»ºç«‹å…³ç³»ã€‚è¿™æ—¶å°±æƒ³é—®äº†ï¼Œæˆ‘èƒ½ç›´æ¥é‡‡ç”¨ä¼ ç»Ÿçš„initæ–¹æ³•åˆ›å»ºå—ï¼Ÿ</p>

<p>ä¼šå´©çš„ï¼åˆ›å»ºæ‰˜ç®¡å¯¹è±¡æ—¶éœ€è¦æŒ‡å®šMOCï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€çš„ç”Ÿæˆsetã€getæ–¹æ³•ã€‚ä½†æ˜¯ç›´æ¥é€šè¿‡initæ–¹æ³•åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œç³»ç»Ÿæ˜¯ä¸çŸ¥é“è¿™é‡Œæ˜¯éœ€è¦ç³»ç»Ÿè‡ªèº«ç”Ÿæˆsetã€getæ–¹æ³•çš„ï¼Œè€Œä¸”ç³»ç»Ÿä¹Ÿä¸çŸ¥é“åº”è¯¥å¯¹åº”å“ªä¸ªMOCï¼Œä¼šå¯¼è‡´æ–¹æ³•æœªå®ç°çš„å´©æºƒã€‚æ‰€ä»¥å°±å‡ºç°äº†å¼€å‘ä¸­ç»å¸¸å‡ºç°çš„é”™è¯¯ï¼Œå¦‚ä¸‹é¢å´©æºƒä¿¡æ¯ï¼š
1</p>

<pre><code>-[Employee setName:]: unrecognized selector sent to instance 0x7fa665900f60
</code></pre>

<p>åŒå‘å…³è”</p>

<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°è¿‡åŒå‘å…³è”çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è®¾ç½®Relationshipæ—¶Inverseæ˜¯å¦ä¸ºç©ºã€‚ä¸‹é¢æ˜¯Employeeå’ŒDepartmentåœ¨æ•°æ®åº“ä¸­ï¼Œè®¾ç½®inverseå’Œæ²¡æœ‰è®¾ç½®inverseçš„ä¸¤ç§æ•°æ®å­˜å‚¨ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çš„å¯¹æ¯”å‡ºè®¾ç½®åŒå‘å…³è”çš„åŒºåˆ«ã€‚</p>

<p>æµ‹è¯•ä»£ç è¿˜æ˜¯ç”¨ä¸Šé¢æ’å…¥å®ä½“çš„ä»£ç ï¼Œåªæ˜¯æ›´æ”¹inverseé€‰é¡¹ã€‚</p>

<p>è®¾ç½®åŒå‘å…³è”</p>

<p><img src="http://al1020119.github.io/images/3002.png" title="Caption" ></p>

<p>Employee</p>

<p><img src="http://al1020119.github.io/images/3003.png" title="Caption" ></p>

<p>Department</p>

<p>æœªè®¾ç½®åŒå‘å…³è”</p>

<p><img src="http://al1020119.github.io/images/3004.png" title="Caption" ></p>

<p>Employee</p>

<p><img src="http://al1020119.github.io/images/3005.png" title="Caption" ></p>

<p>Department</p>

<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœªè®¾ç½®åŒå‘å…³è”çš„å®ä½“ï¼ŒDepartmentå…³è”Employeeä¸ºå±æ€§å¹¶å­˜å‚¨åï¼ŒDepartmentè¡¨ä¸­çš„å…³ç³»æ˜¯å­˜åœ¨çš„ï¼Œä½†Employeeè¡¨ä¸­çš„å…³ç³»ä¾ç„¶æ˜¯ç©ºçš„ã€‚è€Œè®¾ç½®åŒå‘å…³è”åçš„å®ä½“ï¼Œåœ¨Departmentå…³è”Employeeä¸ºå±æ€§å¹¶å­˜å‚¨åï¼ŒEmployeeåœ¨è¡¨ä¸­è‡ªåŠ¨è®¾ç½®äº†å’ŒDepartmentçš„å…³ç³»ã€‚</p>

<p>åŒå‘å…³è”çš„å…³ç³»ä¸åªä½“ç°åœ¨æ•°æ®åº“ä¸­ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ‰˜ç®¡å¯¹è±¡çš„å…³è”å±æ€§ï¼Œä¹Ÿæ˜¯éšç€å‘ç”Ÿå˜åŒ–çš„ã€‚åŒå‘å…³è”çš„åŒæ–¹ï¼Œä¸€æ–¹çš„å…³è”å±æ€§è®¾ç½®å…³ç³»åï¼Œå¦ä¸€æ–¹å…³è”å±æ€§çš„å…³ç³»ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚ç”¨ä¸‹é¢çš„ä»£ç æ‰“å°ä¸€ä¸‹å„è‡ªçš„å…³è”å±æ€§ï¼Œç»“æœå’Œä¸Šé¢æ•°æ®åº“çš„å˜åŒ–æ˜¯ä¸€æ ·çš„ã€‚
1</p>

<pre><code>NSLog(@"Department : %@, Employee : %@", androidDepartment.employee, lsEmployee.department);
</code></pre>

<p>æŸ¥è¯¢æ“ä½œ</p>

<pre><code>// åˆ›å»ºè·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œDepartmentè¡¨
NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Department"];
// è®¾ç½®è¯·æ±‚æ¡ä»¶ï¼Œè®¾ç½®employeeçš„nameä¸ºè¯·æ±‚æ¡ä»¶ã€‚NSPredicateçš„å¥½å¤„åœ¨äºï¼Œå¯ä»¥è®¾ç½®keyPathæ¡ä»¶
NSPredicate *predicate = [NSPredicate predicateWithFormat:@"employee.name = %@", @"lxz"];
request.predicate = predicate;
// æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œ
NSError *error = nil;
NSArray *departments = [context executeFetchRequest:request error:&amp;error];
[departments enumerateObjectsUsingBlock:^(Department * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    NSLog(@"Department Search Result DepartName : %@, employee name : %@", obj.departName, obj.employee.name);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"Department Search Error : %@", error);
}
</code></pre>

<p>æŸ¥æ‰¾Departmentå®ä½“ï¼Œå¹¶æ‰“å°å®ä½“å†…å®¹ã€‚å°±åƒä¸Šé¢è®²çš„åŒå‘å…³ç³»ä¸€æ ·ï¼Œæœ‰å…³è”å…³ç³»çš„å®ä½“ï¼Œè‡ªå·±è¢«æŸ¥æ‰¾å‡ºæ¥åï¼Œä¹Ÿä¼šå°†ä¸ä¹‹å…³è”çš„å…¶ä»–å®ä½“ä¹ŸæŸ¥æ‰¾å‡ºæ¥ï¼Œå¹¶ä¸”æŸ¥æ‰¾å‡ºæ¥çš„å®ä½“éƒ½æ˜¯å…³è”ç€MOCçš„ã€‚</p>

<p>åˆ†é¡µæŸ¥è¯¢</p>

<p>åœ¨ä»æœ¬åœ°å­˜å‚¨åŒºè·å–æ•°æ®æ—¶ï¼Œå¯ä»¥æŒ‡å®šä»ç¬¬å‡ ä¸ªè·å–ï¼Œä»¥åŠæœ¬æ¬¡æŸ¥è¯¢è·å–å¤šå°‘ä¸ªæ•°æ®ï¼Œè”åˆèµ·æ¥ä½¿ç”¨å°±æ˜¯åˆ†é¡µæŸ¥è¯¢ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œå•ç‹¬ä½¿ç”¨è¿™ä¸¤ä¸ªAPIã€‚</p>

<p>è¿™ç§éœ€æ±‚åœ¨å®é™…å¼€å‘ä¸­éå¸¸å¸¸è§ï¼Œä¾‹å¦‚TableViewä¸­ï¼Œä¸Šæ‹‰åŠ è½½æ•°æ®ï¼Œæ¯æ¬¡åŠ è½½20æ¡æ•°æ®ï¼Œå°±å¯ä»¥åˆ©ç”¨åˆ†é¡µæŸ¥è¯¢è½»æ¾å®ç°ã€‚</p>

<pre><code>// åˆ›å»ºè·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
// è®¾ç½®æŸ¥æ‰¾èµ·å§‹ç‚¹ï¼Œè¿™é‡Œæ˜¯ä»æœç´¢ç»“æœçš„ç¬¬å…­ä¸ªå¼€å§‹è·å–
request.fetchOffset = 6;
// è®¾ç½®åˆ†é¡µï¼Œæ¯æ¬¡è¯·æ±‚è·å–å…­ä¸ªæ‰˜ç®¡å¯¹è±¡
request.fetchLimit = 6;
// è®¾ç½®æ’åºè§„åˆ™ï¼Œè¿™é‡Œè®¾ç½®èº«é«˜å‡åºæ’åº
NSSortDescriptor *descriptor = [NSSortDescriptor sortDescriptorWithKey:@"height" ascending:YES];
request.sortDescriptors = @[descriptor];
// æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ
NSError *error = nil;
NSArray *employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    NSLog(@"Page Search Result Name : %@, height : %@", obj.name, obj.height);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"Page Search Data Error : %@", error);
}
</code></pre>

<p>ä¸Šé¢æ˜¯ä¸€ä¸ªæŒ‰ç…§èº«é«˜å‡åºæ’åºï¼Œåˆ†é¡µè·å–æœç´¢ç»“æœçš„ä¾‹å­ã€‚æŸ¥æ‰¾Employeeè¡¨ä¸­çš„å®ä½“ï¼Œå°†ç»“æœæŒ‰ç…§heightå­—æ®µå‡åºæ’åºï¼Œå¹¶ä»ç»“æœçš„ç¬¬å…­ä¸ªå¼€å§‹æŸ¥æ‰¾ï¼Œå¹¶ä¸”è®¾ç½®è·å–çš„æ•°é‡ä¹Ÿæ˜¯å…­ä¸ªã€‚</p>

<p>æ¨¡ç³ŠæŸ¥è¯¢</p>

<p>æœ‰æ—¶éœ€è¦è·å–å…·æœ‰æŸäº›ç›¸åŒç‰¹å¾çš„æ•°æ®ï¼Œè¿™æ ·å°±éœ€è¦å¯¹æŸ¥è¯¢çš„ç»“æœåšæ¨¡ç³ŠåŒ¹é…ã€‚åœ¨CoreDataæ‰§è¡Œæ¨¡ç³ŠåŒ¹é…æ—¶ï¼Œå¯ä»¥é€šè¿‡NSPredicateæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</p>

<pre><code>// åˆ›å»ºè·å–æ•°æ®çš„è¯·æ±‚å¯¹è±¡ï¼Œè®¾ç½®å¯¹Employeeè¡¨è¿›è¡Œæ“ä½œ
NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
// åˆ›å»ºæ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶ã€‚è¿™é‡Œè®¾ç½®çš„å¸¦é€šé…ç¬¦çš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯ç»“æœåŒ…å«lxz
NSPredicate *predicate = [NSPredicate predicateWithFormat:@"name LIKE %@", @"*lxz*"];
request.predicate = predicate;
// æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ
NSError *error = nil;
NSArray *employees = [context executeFetchRequest:request error:&amp;error];
[employees enumerateObjectsUsingBlock:^(Employee * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    NSLog(@"Fuzzy Search Result Name : %@, height : %@", obj.name, obj.height);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"Fuzzy Search Data Error : %@", error);
}
</code></pre>

<p>ä¸Šé¢æ˜¯ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼ŒNSPredicateæ”¯æŒå¤šç§å½¢å¼çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¸‹é¢åˆ—ä¸¾ä¸€äº›ç®€å•çš„åŒ¹é…æ–¹å¼ã€‚æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥æŸ¥è¯¢æ¡ä»¶å¤§å°å†™å‡å¯ã€‚</p>

<pre><code>ä»¥lxzå¼€å¤´
</code></pre>

<p>1</p>

<pre><code>NSPredicate *predicate = [NSPredicate predicateWithFormat:@"name BEGINSWITH %@", @"lxz"];

ä»¥lxzç»“å°¾
</code></pre>

<p>1</p>

<pre><code>NSPredicate *predicate = [NSPredicate predicateWithFormat:@"name ENDSWITH %@", @"lxz"];

å…¶ä¸­åŒ…å«lxz
</code></pre>

<p>1</p>

<pre><code>NSPredicate *predicate = [NSPredicate predicateWithFormat:@"name contains %@", @"lxz"];

æŸ¥è¯¢æ¡ä»¶ç»“æœåŒ…å«lxz
</code></pre>

<p>1</p>

<pre><code>NSPredicate *predicate = [NSPredicate predicateWithFormat:@"name LIKE %@", @"*lxz*"];
</code></pre>

<p>åŠ è½½è¯·æ±‚æ¨¡æ¿</p>

<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è°ˆåˆ°åœ¨æ¨¡å‹æ–‡ä»¶ä¸­è®¾ç½®è¯·æ±‚æ¨¡æ¿ï¼Œä¹Ÿå°±æ˜¯åœ¨.xcdatamodeldæ–‡ä»¶ä¸­ï¼Œè®¾ç½®Fetch Requestsï¼Œä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡å¯¹åº”çš„NSManagedObjectModelè·å–è®¾ç½®å¥½çš„æ¨¡æ¿ã€‚</p>

<p>&hellip;. çœç•¥ä¸Šä¸‹æ–‡åˆ›å»ºæ­¥éª¤ &hellip;.</p>

<pre><code>// é€šè¿‡MOCè·å–æ¨¡å‹æ–‡ä»¶å¯¹åº”çš„æ‰˜ç®¡å¯¹è±¡æ¨¡å‹
NSManagedObjectModel *model = context.persistentStoreCoordinator.managedObjectModel;
// é€šè¿‡.xcdatamodeldæ–‡ä»¶ä¸­è®¾ç½®çš„æ¨¡æ¿åï¼Œè·å–è¯·æ±‚å¯¹è±¡
NSFetchRequest *fetchRequest = [model fetchRequestTemplateForName:@"EmployeeFR"];
// è¯·æ±‚æ•°æ®ï¼Œä¸‹é¢çš„æ“ä½œå’Œæ™®é€šè¯·æ±‚ä¸€æ ·
NSError *error = nil;
NSArray *dataList = [context executeFetchRequest:fetchRequest error:&amp;error];
[dataList enumerateObjectsUsingBlock:^(Employee * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    NSLog(@"Employee.count = %ld, Employee.height = %f", dataList.count, [obj.height floatValue]);
}];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"Execute Fetch Request Error : %@", error);
}
</code></pre>

<p>è·å–ç»“æœCountå€¼</p>

<p>å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ—¶éœ€è¦åªè·å–æ‰€éœ€æ•°æ®çš„Countå€¼ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œè·å–æ“ä½œåæ•°ç»„ä¸­æ‰€å­˜å‚¨çš„å¯¹è±¡æ•°é‡ã€‚é‡åˆ°è¿™ä¸ªéœ€æ±‚ï¼Œå¦‚æœåƒä¹‹å‰ä¸€æ ·MOCæ‰§è¡Œè·å–æ“ä½œï¼Œè·å–åˆ°æ•°ç»„ç„¶åå–Countï¼Œè¿™æ ·å¯¹å†…å­˜æ¶ˆè€—æ˜¯å¾ˆå¤§çš„ã€‚</p>

<p>å¯¹äºè¿™ä¸ªéœ€æ±‚ï¼Œè‹¹æœæä¾›äº†ä¸¤ç§å¸¸ç”¨çš„æ–¹å¼è·å–è¿™ä¸ªCountå€¼ã€‚è¿™ä¸¤ç§è·å–æ“ä½œï¼Œéƒ½æ˜¯åœ¨æ•°æ®åº“ä¸­å®Œæˆçš„ï¼Œå¹¶ä¸éœ€è¦å°†æ‰˜ç®¡å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¯¹å†…å­˜çš„å¼€é”€ä¹Ÿæ˜¯å¾ˆå°çš„ã€‚</p>

<pre><code>æ–¹æ³•1ï¼Œè®¾ç½®resultType


// è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è®¾ç½®è‡ªå·±çš„è¿‡æ»¤æ¡ä»¶
NSPredicate *predicate = [NSPredicate predicateWithFormat:@"height &lt; 2"];
// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest *fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
fetchRequest.predicate = predicate;
// è¿™ä¸€æ­¥æ˜¯å…³é”®ã€‚è®¾ç½®è¿”å›ç»“æœç±»å‹ä¸ºCountï¼Œè¿”å›ç»“æœä¸ºNSNumberç±»å‹
fetchRequest.resultType = NSCountResultType;
// æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›çš„ç»“æœè¿˜æ˜¯æ•°ç»„ï¼Œæ•°ç»„ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯è®¡ç®—å‡ºçš„Countå€¼
NSError *error = nil;
NSArray *dataList = [context executeFetchRequest:fetchRequest error:&amp;error];
NSInteger count = [dataList.firstObject integerValue];
NSLog(@"fetch request result Employee.count = %ld", count);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"fetch request result error : %@", error);
}
</code></pre>

<p>æ–¹æ³•1ä¸­è®¾ç½®NSFetchRequestå¯¹è±¡çš„resultTypeä¸ºNSCountResultTypeï¼Œè·å–åˆ°ç»“æœçš„Countå€¼ã€‚è¿™ä¸ªæšä¸¾å€¼åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æåˆ°è¿‡ï¼Œé™¤äº†Countå‚æ•°ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–ä¸‰ç§å‚æ•°ã€‚</p>

<pre><code>æ–¹æ³•2ï¼Œä½¿ç”¨MOCæä¾›çš„æ–¹æ³•


// è®¾ç½®è¿‡æ»¤æ¡ä»¶
NSPredicate *predicate = [NSPredicate predicateWithFormat:@"height &lt; 2"];
// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest *fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
fetchRequest.predicate = predicate;
// é€šè¿‡è°ƒç”¨MOCçš„countForFetchRequest:error:æ–¹æ³•ï¼Œè·å–è¯·æ±‚ç»“æœcountå€¼ï¼Œè¿”å›ç»“æœç›´æ¥æ˜¯NSUIntegerç±»å‹å˜é‡
NSError *error = nil;
NSUInteger count = [context countForFetchRequest:fetchRequest error:&amp;error];
NSLog(@"fetch request result count is : %ld", count);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"fetch request result error : %@", error);
}
</code></pre>

<p>MOCæä¾›äº†ä¸“é—¨è·å–è¯·æ±‚ç»“æœCountå€¼çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªNSUIntegerç±»å‹çš„Countå€¼ï¼Œä½¿ç”¨èµ·æ¥æ¯”ä¸Šé¢çš„æ–¹æ³•æ›´æ–¹ä¾¿ç‚¹ï¼Œå…¶ä»–éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>ä½è¿ç®—</p>

<p>å‡è®¾æœ‰éœ€æ±‚æ˜¯å¯¹Employeeè¡¨ä¸­ï¼Œæ‰€æœ‰æ‰˜ç®¡å¯¹è±¡çš„heightå±æ€§è®¡ç®—æ€»å’Œã€‚è¿™ä¸ªéœ€æ±‚åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå°†æ‰€æœ‰æ‰˜ç®¡å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­æ˜¯éå¸¸æ¶ˆè€—å†…å­˜çš„ï¼Œå°±ç®—æ‰¹é‡åŠ è½½ä¹Ÿæ¯”è¾ƒè€—æ—¶è€—å†…å­˜ã€‚</p>

<p>CoreDataå¯¹äºè¿™æ ·çš„éœ€æ±‚ï¼Œæä¾›äº†ä½è¿ç®—çš„åŠŸèƒ½ã€‚MOCåœ¨æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œæ˜¯æ”¯æŒå¯¹æ•°æ®è¿›è¡Œä½è¿ç®—çš„ã€‚è¿™ä¸ªæ“ä½œä¾ç„¶æ˜¯åœ¨æ•°æ®åº“å±‚å®Œæˆçš„ï¼Œå¯¹å†…å­˜çš„å ç”¨éå¸¸å°ã€‚</p>

<pre><code>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest *fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
// è®¾ç½®è¿”å›å€¼ä¸ºå­—å…¸ç±»å‹ï¼Œè¿™æ˜¯ä¸ºäº†ç»“æœå¯ä»¥é€šè¿‡è®¾ç½®çš„nameåå–å‡ºï¼Œè¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„
fetchRequest.resultType = NSDictionaryResultType;
// åˆ›å»ºæè¿°å¯¹è±¡
NSExpressionDescription *expressionDes = [[NSExpressionDescription alloc] init];
// è®¾ç½®æè¿°å¯¹è±¡çš„nameï¼Œæœ€åç»“æœéœ€è¦ç”¨è¿™ä¸ªnameå½“åškeyæ¥å–å‡ºç»“æœ
expressionDes.name = @"sumOperatin";
// è®¾ç½®è¿”å›å€¼ç±»å‹ï¼Œæ ¹æ®è¿ç®—ç»“æœè®¾ç½®ç±»å‹
expressionDes.expressionResultType = NSFloatAttributeType;
// åˆ›å»ºå…·ä½“æè¿°å¯¹è±¡ï¼Œç”¨æ¥æè¿°å¯¹é‚£ä¸ªå±æ€§è¿›è¡Œä»€ä¹ˆè¿ç®—(å¯æ‰§è¡Œçš„è¿ç®—ç±»å‹å¾ˆå¤šï¼Œè¿™é‡Œæè¿°çš„æ˜¯å¯¹heightå±æ€§ï¼Œåšsumè¿ç®—)
NSExpression *expression = [NSExpression expressionForFunction:@"sum:" arguments:@[[NSExpression expressionForKeyPath:@"height"]]];
// åªèƒ½å¯¹åº”ä¸€ä¸ªå…·ä½“æè¿°å¯¹è±¡
expressionDes.expression = expression;
// ç»™è¯·æ±‚å¯¹è±¡è®¾ç½®æè¿°å¯¹è±¡ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è®¾ç½®å¤šä¸ªæè¿°å¯¹è±¡
fetchRequest.propertiesToFetch = @[expressionDes];
// æ‰§è¡Œè¯·æ±‚ï¼Œè¿”å›å€¼è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯å­˜å‚¨è®¡ç®—ç»“æœçš„å­—å…¸
NSError *error = nil;
NSArray *resultArr = [context executeFetchRequest:fetchRequest error:&amp;error];
// é€šè¿‡ä¸Šé¢è®¾ç½®çš„nameå€¼ï¼Œå½“åšè¯·æ±‚ç»“æœçš„keyå–å‡ºè®¡ç®—ç»“æœ
NSNumber *number = resultArr.firstObject[@"sumOperatin"];
NSLog(@"fetch request result is %f", [number floatValue]);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"fetch request result error : %@", error);
}
</code></pre>

<p>æ‰§è¡Œç»“æœï¼š</p>

<p><img src="http://al1020119.github.io/images/3006.png" title="Caption" ></p>

<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒMOCå¯¹æ‰€æœ‰æŸ¥æ‰¾åˆ°çš„æ‰˜ç®¡å¯¹è±¡heightå±æ€§æ‰§è¡Œäº†æ±‚å’Œæ“ä½œï¼Œå¹¶å°†ç»“æœæ”¾åœ¨å­—å…¸ä¸­è¿”å›ã€‚ä½è¿ç®—ä¸»è¦æ˜¯é€šè¿‡NSFetchRequestå¯¹è±¡çš„propertiesToFetchå±æ€§è®¾ç½®ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥è®¾ç½®å¤šä¸ªæè¿°å¯¹è±¡ï¼Œæœ€åé€šè¿‡ä¸åŒçš„nameå½“åškeyæ¥å–å‡ºç»“æœå³å¯ã€‚</p>

<p>NSExpressionç±»å¯ä»¥æè¿°å¤šç§è¿ç®—ï¼Œå¯ä»¥åœ¨NSExpression.hæ–‡ä»¶ä¸­çš„æ³¨é‡Šéƒ¨åˆ†ï¼Œçœ‹åˆ°æ‰€æœ‰æ”¯æŒçš„è¿ç®—ç±»å‹ï¼Œå¤§æ¦‚çœ‹äº†ä¸€ä¸‹æœ‰äºŒåå¤šç§è¿ç®—ã€‚è€Œä¸”é™¤äº†ä¸Šé¢NSExpressionè°ƒç”¨çš„æ–¹æ³•ï¼Œæ­¤ç±»è¿˜æ”¯æŒç‚¹è¯­æ³•çš„ä½è¿ç®—ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚
1</p>

<pre><code>[NSExpression expressionWithFormat:@"@sum.height"];
</code></pre>

<p>æ‰¹å¤„ç†</p>

<p>åœ¨ä½¿ç”¨CoreDataä¹‹å‰ï¼Œæˆ‘å’Œå…¬å¸åŒäº‹ä¹Ÿè®¨è®ºè¿‡ï¼Œå‡è®¾é‡åˆ°éœ€è¦å¤§é‡æ•°æ®å¤„ç†çš„æ—¶å€™æ€ä¹ˆåŠã€‚CoreDataå¯¹äºå¤§é‡æ•°æ®å¤„ç†çš„çµæ´»æ€§è‚¯å®šä¸å¦‚SQLiteï¼Œè¿™æ—¶å€™è¿˜éœ€è¦è‡ªå·±ä½¿ç”¨å…¶ä»–æ–¹å¼ä¼˜åŒ–æ•°æ®å¤„ç†ã€‚è™½ç„¶åœ¨ç§»åŠ¨ç«¯è¿™ç§æƒ…å†µå¾ˆå°‘å‡ºç°ï¼Œä½†æ˜¯åœ¨æŒä¹…å±‚è®¾è®¡æ—¶è¿˜æ˜¯è¦è€ƒè™‘è¿™æ–¹é¢ã€‚</p>

<p>å½“éœ€è¦è¿›è¡Œæ•°æ®çš„å¤„ç†æ—¶ï¼ŒCoreDataéœ€è¦å…ˆå°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åæ‰èƒ½å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚è¿™æ ·å¯¹äºå¤§é‡æ•°æ®æ¥è¯´ï¼Œéƒ½åŠ è½½åˆ°å†…å­˜ä¸­æ˜¯éå¸¸æ¶ˆè€—å†…å­˜çš„ï¼Œè€Œä¸”å®¹æ˜“å¯¼è‡´å´©æºƒçš„å‘ç”Ÿã€‚å¦‚æœé‡åˆ°æ›´æ”¹æ‰€æœ‰æ•°æ®çš„æŸä¸ªå­—æ®µè¿™æ ·çš„ç®€å•éœ€æ±‚ï¼Œéœ€è¦å°†ç›¸å…³çš„æ‰˜ç®¡å¯¹è±¡éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åè¿›è¡Œæ›´æ”¹ã€ä¿å­˜ã€‚</p>

<p>å¯¹äºä¸Šé¢è¿™æ ·çš„é—®é¢˜ï¼ŒCoreDataåœ¨iOS8æ¨å‡ºäº†æ‰¹é‡æ›´æ–°APIï¼Œé€šè¿‡è¿™ä¸ªAPIå¯ä»¥ç›´æ¥åœ¨æ•°æ®åº“ä¸€å±‚å°±å®Œæˆæ›´æ–°æ“ä½œï¼Œè€Œä¸éœ€è¦å°†æ•°æ®åŠ è½½åˆ°å†…å­˜ã€‚é™¤äº†æ‰¹é‡æ›´æ–°æ“ä½œï¼Œåœ¨iOS9ä¸­è¿˜æ¨å‡ºäº†æ‰¹é‡åˆ é™¤APIï¼Œä¹Ÿæ˜¯åœ¨æ•°æ®åº“ä¸€å±‚å®Œæˆçš„æ“ä½œã€‚å…³äºæ‰¹å¤„ç†çš„APIå¾ˆå¤šéƒ½æ˜¯iOS8ã€iOS9å‡ºæ¥çš„ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ç‰ˆæœ¬å…¼å®¹ã€‚</p>

<p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæ‰¹é‡æ›´æ–°å’Œæ‰¹é‡åˆ é™¤çš„ä¸¤ä¸ªAPIï¼Œéƒ½æ˜¯ç›´æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œæ›´æ–°å®Œä¹‹åä¼šå¯¼è‡´MOCç¼“å­˜å’Œæœ¬åœ°æŒä¹…åŒ–æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚æ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ·æ–°å—å½±å“çš„MOCä¸­å­˜å‚¨çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä½¿MOCå’Œæœ¬åœ°ç»Ÿä¸€ã€‚å‡è®¾ä½ ä½¿ç”¨äº†NSFetchedResultsControllerï¼Œä¸ºäº†ä¿è¯ç•Œé¢å’Œæ•°æ®çš„ç»Ÿä¸€ï¼Œè¿™ä¸€æ­¥æ›´æ–°æ“ä½œæ›´éœ€è¦åšã€‚</p>

<p>æ‰¹é‡æ›´æ–°</p>

<pre><code>// åˆ›å»ºæ‰¹é‡æ›´æ–°å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨ã€‚
NSBatchUpdateRequest *updateRequest = [NSBatchUpdateRequest batchUpdateRequestWithEntityName:@"Employee"];
// è®¾ç½®è¿”å›å€¼ç±»å‹ï¼Œé»˜è®¤æ˜¯ä»€ä¹ˆéƒ½ä¸è¿”å›(NSStatusOnlyResultType)ï¼Œè¿™é‡Œè®¾ç½®è¿”å›å‘ç”Ÿæ”¹å˜çš„å¯¹è±¡Countå€¼
updateRequest.resultType = NSUpdatedObjectsCountResultType;
// è®¾ç½®å‘ç”Ÿæ”¹å˜å­—æ®µçš„å­—å…¸
updateRequest.propertiesToUpdate = @{@"height" : [NSNumber numberWithFloat:5.f]};
// æ‰§è¡Œè¯·æ±‚åï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªç‰¹å®šçš„resultå¯¹è±¡ï¼Œé€šè¿‡resultçš„å±æ€§è·å–è¿”å›çš„ç»“æœã€‚MOCçš„è¿™ä¸ªAPIæ˜¯ä»iOS8å‡ºæ¥çš„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ç‰ˆæœ¬å…¼å®¹ã€‚
NSError *error = nil;
NSBatchUpdateResult *result = [context executeRequest:updateRequest error:&amp;error];
NSLog(@"batch update count is %ld", [result.result integerValue]);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"batch update request result error : %@", error);
}
// æ›´æ–°MOCä¸­çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä½¿MOCå’Œæœ¬åœ°æŒä¹…åŒ–åŒºæ•°æ®åŒæ­¥
[context refreshAllObjects];
</code></pre>

<p>ä¸Šé¢å¯¹Employeeè¡¨ä¸­æ‰€æœ‰çš„æ‰˜ç®¡å¯¹è±¡heightå€¼åšäº†æ‰¹é‡æ›´æ–°ï¼Œåœ¨æ›´æ–°æ—¶é€šè¿‡è®¾ç½®propertiesToUpdateå­—å…¸æ¥æ§åˆ¶æ›´æ–°å­—æ®µå’Œæ›´æ–°çš„å€¼ï¼Œè®¾ç½®æ ¼å¼æ˜¯å­—æ®µå : æ–°å€¼ã€‚é€šè¿‡è®¾ç½®æ‰¹å¤„ç†å¯¹è±¡çš„predicateå±æ€§ï¼Œè®¾ç½®ä¸€ä¸ªè°“è¯å¯¹è±¡æ¥æ§åˆ¶å—å½±å“çš„å¯¹è±¡ã€‚</p>

<p>è¿˜å¯ä»¥å¯¹å¤šä¸ªå­˜å‚¨åŒº(æ•°æ®åº“)åšåŒæ ·æ‰¹å¤„ç†æ“ä½œï¼Œé€šè¿‡è®¾ç½®å…¶çˆ¶ç±»çš„affectedStoreså±æ€§ï¼Œç±»å‹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥åŒ…å«å—å½±å“çš„å­˜å‚¨åŒºï¼Œå¤šä¸ªå­˜å‚¨åŒºçš„æ“ä½œå¯¹æ‰¹é‡åˆ é™¤åŒæ ·é€‚ç”¨ã€‚</p>

<p>MOCåœ¨æ‰§è¡Œè¯·æ±‚æ–¹æ³•æ—¶ï¼Œå‘ç°æ–¹æ³•åä¹Ÿä¸ä¸€æ ·äº†ï¼Œæ‰§è¡Œçš„æ˜¯executeRequest: error:æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä»iOS8ä¹‹åå‡ºæ¥çš„ã€‚æ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯NSBatchUpdateRequestç±»ï¼Œæ­¤ç±»å¹¶ä¸æ˜¯ç»§æ‰¿è‡ªNSFetchRequestç±»ï¼Œè€Œæ˜¯ç›´æ¥ç»§æ‰¿è‡ªNSPersistentStoreRequestï¼Œå’ŒNSFetchRequestæ˜¯å¹³çº§å…³ç³»ã€‚</p>

<p>æ‰¹é‡åˆ é™¤</p>

<pre><code>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜å¯¹Employeeè¡¨åšæ“ä½œ
NSFetchRequest *fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
// é€šè¿‡è°“è¯è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œè®¾ç½®æ¡ä»¶ä¸ºheightå°äº1.7
NSPredicate *predicate = [NSPredicate predicateWithFormat:@"height &lt; %f", 1.7f];
fetchRequest.predicate = predicate;
// åˆ›å»ºæ‰¹é‡åˆ é™¤è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„è¯·æ±‚å¯¹è±¡å½“åšå‚æ•°è¿›è¡Œåˆå§‹åŒ–
NSBatchDeleteRequest *deleteRequest = [[NSBatchDeleteRequest alloc] initWithFetchRequest:fetchRequest];
// è®¾ç½®è¯·æ±‚ç»“æœç±»å‹ï¼Œè®¾ç½®ä¸ºå—å½±å“å¯¹è±¡çš„Count
deleteRequest.resultType = NSBatchDeleteResultTypeCount;
// ä½¿ç”¨NSBatchDeleteResultå¯¹è±¡æ¥æ¥å—è¿”å›ç»“æœï¼Œé€šè¿‡idç±»å‹çš„å±æ€§resultè·å–ç»“æœ
NSError *error = nil;
NSBatchDeleteResult *result = [context executeRequest:deleteRequest error:&amp;error];
NSLog(@"batch delete request result count is %ld", [result.result integerValue]);
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"batch delete request error : %@", error);
}
// æ›´æ–°MOCä¸­çš„æ‰˜ç®¡å¯¹è±¡ï¼Œä½¿MOCå’Œæœ¬åœ°æŒä¹…åŒ–åŒºæ•°æ®åŒæ­¥
[context refreshAllObjects];
</code></pre>

<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¶‰åŠåˆ°æ‰˜ç®¡å¯¹è±¡çš„æ“ä½œï¼Œéƒ½éœ€è¦å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­å®Œæˆã€‚æ‰€ä»¥ä½¿ç”¨CoreDataæ—¶ï¼Œéœ€è¦æ³¨æ„å†…å­˜çš„ä½¿ç”¨ï¼Œä¸è¦åœ¨å†…å­˜ä¸­å­˜åœ¨è¿‡å¤šçš„æ‰˜ç®¡å¯¹è±¡ã€‚åœ¨å·²ç»åšç³»ç»Ÿå…¼å®¹çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå¤§é‡æ•°æ®çš„æ“ä½œæ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨æ‰¹å¤„ç†æ¥å®Œæˆæ“ä½œã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒrefreshAllObjectsæ˜¯ä»iOS9å‡ºæ¥çš„ï¼Œåœ¨iOS9ä¹‹å‰å› ä¸ºè¦åšç‰ˆæœ¬å…¼å®¹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨refreshObject: mergeChanges:æ–¹æ³•æ›´æ–°æ‰˜ç®¡å¯¹è±¡ã€‚</p>

<p>å¼‚æ­¥è¯·æ±‚</p>

<pre><code>// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æŒ‡æ˜æ“ä½œEmployeeè¡¨
NSFetchRequest *fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@"Employee"];
// åˆ›å»ºå¼‚æ­¥è¯·æ±‚å¯¹è±¡ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªblockè¿›è¡Œå›è°ƒï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªNSAsynchronousFetchResultç±»å‹å‚æ•°
NSAsynchronousFetchRequest *asycFetchRequest = [[NSAsynchronousFetchRequest alloc] initWithFetchRequest:fetchRequest completionBlock:^(NSAsynchronousFetchResult * _Nonnull result) {
    [result.finalResult enumerateObjectsUsingBlock:^(Employee * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        NSLog(@"fetch request result Employee.count = %ld, Employee.name = %@", result.finalResult.count, obj.name);
    }];
}];
// æ‰§è¡Œå¼‚æ­¥è¯·æ±‚ï¼Œå’Œæ‰¹é‡å¤„ç†æ‰§è¡ŒåŒä¸€ä¸ªè¯·æ±‚æ–¹æ³•
NSError *error = nil;
[context executeRequest:asycFetchRequest error:&amp;error];
// é”™è¯¯å¤„ç†
if (error) {
    NSLog(@"fetch request result error : %@", error);
}
</code></pre>

<p>ä¸Šé¢é€šè¿‡NSAsynchronousFetchRequestå¯¹è±¡åˆ›å»ºäº†ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå¹¶é€šè¿‡blockè¿›è¡Œå›è°ƒã€‚å¦‚æœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶å‘èµ·ï¼Œä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œç³»ç»Ÿä¼šå°†æ‰€æœ‰çš„å¼‚æ­¥è¯·æ±‚æ·»åŠ åˆ°ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ï¼Œåœ¨å‰ä¸€ä¸ªä»»åŠ¡è®¿é—®æ•°æ®åº“æ—¶ï¼ŒCoreDataä¼šå°†æ•°æ®åº“åŠ é”ï¼Œç­‰å‰é¢çš„æ‰§è¡Œå®Œæˆæ‰ä¼šç»§ç»­æ‰§è¡Œåé¢çš„æ“ä½œã€‚</p>

<p>NSAsynchronousFetchRequestæä¾›äº†cancelæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå°†è¿™ä¸ªè¯·æ±‚å–æ¶ˆã€‚è¿˜å¯ä»¥é€šè¿‡ä¸€ä¸ªNSProgressç±»å‹çš„å±æ€§ï¼Œè·å–è¯·æ±‚å®Œæˆè¿›åº¦ã€‚NSAsynchronousFetchRequestç±»ä»iOS8å¼€å§‹å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥ä½ç‰ˆæœ¬éœ€è¦åšç‰ˆæœ¬å…¼å®¹ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œè¯·æ±‚æ—¶MOCå¹¶å‘ç±»å‹ä¸èƒ½æ˜¯NSConfinementConcurrencyTypeï¼Œè¿™ä¸ªå¹¶å‘ç±»å‹å·²ç»è¢«æŠ›å¼ƒï¼Œä¼šå¯¼è‡´å´©æºƒã€‚</p>

<pre><code>Q Qï¼š2211523682/790806573

å¾®ä¿¡ï¼š18370997821/13148454507

å¾®åšWB:http://weibo.com/u/3288975567?is_hot=1

gitåšæ–‡ï¼šhttp://al1020119.github.io/

githubï¼šhttps://github.com/al1020119
</code></pre>

<p><img src="http://al1020119.github.io/images/iCocosCoder.jpg" title="Caption" ></p>

<p><img src="http://al1020119.github.io/images/iCocosPublic.jpg" title="Caption" ></p>
]]></content>
  </entry>
  
</feed>
